---
title: "[GXPC-S 2025] 花 / flower"
layout: "post"
diff: 普及+/提高
pid: B4374
tag: ['线段树', '2025', '广西', '分块']
---
# [GXPC-S 2025] 花 / flower
## 题目背景

题目来源：2025 年广西中小学生程序设计挑战赛复赛（进阶组[试题](https://mp.weixin.qq.com/s?__biz=MzI3NDM3MzcwNQ==&mid=2247490166&idx=5&sn=e7ba7e3bc8126027b9abd662518c208b&chksm=ea9c06dd4d18206ed9d88124cc78b947298df2555889e98620204c2ea1471f58c135c00f99fb&mpshare=1&scene=23&srcid=0724dNJdhMxpUHag1dqkhiqL&sharer_shareinfo=7e47197d6e5c044ae705613db988029c&sharer_shareinfo_first=7e47197d6e5c044ae705613db988029c#rd)）。

## 题目描述


小明在放学路上发现了一棵神奇的花树，假设 $1$ 为这棵树的根节点，并且在这棵树上一共有 $n$ 个节点，每个节点上都有一朵美丽的花，我们定义第 $i$ 朵花的美丽值为 $a_i$，接下来将会经过 $m$ 天，每一天可能会发生下面两种事件中的一种：

- 给出三个整数 $1\,u\,w$ 表示把第 $u$ 朵花的美丽值变为 $w$。  
- 给出两个整数 $2\,u$ 表示询问以 $u$ 为根节点的子树中美丽值最大的节点的值。

小明想在母亲节那天为妈妈摘下整棵树中最美丽的花朵作为礼物，因此他需要每天准确掌握这棵树的每个事件，请你帮助他设计一个程序来完成吧。

## 输入格式


第一行输入两个整数 $n, m$ ，分别代表节点个数和将会经过的天数。  
接下来的一行有 $n$ 个整数，第 $i$ 个整数 $a_i$ 代表这朵花的美丽值。  
接下来的 $n-1$ 行每行有两个整数 $u$ 和 $v$ 表示节点 $u$ 和 $v$ 之间有一条边。  
接下来的 $m$ 行将会保证以下格式：  
  - 一行中给出三个整数 $1\,u\,w$。  
  - 一行中给出两个整数 $2\,u$。  
## 输出格式


对于每一种事件 $2$，每行给出一个整数代表答案。
## 样例

### 样例输入 #1
```
6 5
1 2 3 4 5 6
1 2
1 3
2 4
2 5
5 6
2 2
2 3
1 3 7
2 1
2 2
```
### 样例输出 #1
```
6
3
7
6
```
### 样例输入 #2
```
10 12
6 97 10 47 28 29 18 66 48 45
2 1
1 3
4 8
1 7
6 10
5 1
4 6
4 9
1 4
2 9
2 4
2 1
1 10 11
2 5
2 5
1 1 10
2 3
1 4 11
2 4
2 3
1 9 3
```
### 样例输出 #2
```
48
66
97
28
28
10
66
10
```
## 提示


#### 样例解释

对于样例 1，第一天以 2 为根节点的子树中美丽值最大的节点是 6，它的美丽值是 6。

第二天以 3 为根节点的子树只有它自己一个节点，所以最大美丽值节点就是它自己，值为 3。

接下来第三天将节点 3 的值变为 7。

第四天以 1 为根节点的子树就是这棵树本身，同时美丽值最大的节点为 3，它的美丽值为 7。

最后第五天以 2 为根节点的子树中美丽值最大的节点是 6，它的美丽值是 6。

#### 数据范围

- 对于 30% 的数据，保证 $1 \le n,m \le 5 \times 10^3$。  
- 对于另外存在 20% 的数据保证只有事件 $2$。  
- 对于 100% 的数据，保证 $1 \le n,m \le 2 \times 10^5, \;1 \le a_i, w \le 1 \times 10^9$。  



---

---
title: "数组的划分"
layout: "post"
diff: 普及+/提高
pid: P11901
tag: ['线段树', '后缀自动机 SAM', '动态树 LCT', '哈希 hashing', '分块']
---
# 数组的划分
## 题目背景

本来这里应该有一段一脉相承的背景故事。但是因为福尔魔斯验题的时候写吐了，所以背景故事没了。
## 题目描述

给出 $m$ 个数组 $s_1, s_2, \cdots s_m$ 和一个长为 $n$ 的数组 $t$。

定义 $f(l,r)$ 表示在所有 "把 $t_l...t_r$ 分成若干段，要求每一段都是 $s$ 中某个数组的子段" 的方式中，划分段数的最小值。

有以下操作：

1. 强制限定 $p,p+1$ 处必须划分，如果已经有了则取消。

2. 将 $t$ 的区间 $[l, r]$ 改成数组 $a$，会给出 $a$，每次的 $a$ 可能不一样。

3. 询问 $f(l,r)$，保证有解。

请你完成这些操作。

## 输入格式

第一行四个数，$n,m,q,id$，表示 $t$ 的长度，总共有多少个文本数组 $s$，操作数，以及数据类型（参见说明）。

接下来 $m$ 行，每行先给出一个数 $k$，代表 $s_i$ 的长度，然后 $k$ 个数给出 $s_i$ 这个数组的元素。

下一行，给出 $n$ 个数，表示 $t$ 中的元素。

接下来 $q$ 行，每行表示一个操作，分别如下：

1. $1\ x$，表示若 $x,x+1$ 处不必须划分，则标为必须划分，否则取消。

2. $2\ l\ r\ a_1\ a_2 \cdots a_{r-l+1}$，表示令 $\forall l \le i \le r，t_i = a_{i-l+1}$。

3. $3\ l\ r$，表示询问 $f(l,r)$。
## 输出格式

对于每次询问，输出一个数表示答案。每个答案占一行。
## 样例

### 样例输入 #1
```
5 3 7 0
3 1 2 3 
4 3 2 2 2 
3 3 2 2 
2 3 3 2 1 
3 1 5
1 3
3 1 5
2 2 4 1 3 2
3 1 5
1 3
3 1 5
```
### 样例输出 #1
```
3
4
5
4
```
### 样例输入 #2
```
10 5 20 0
3 1 2 3 
5 3 3 1 1 3 
10 1 2 1 1 2 3 2 1 1 3 
2 1 1 
2 1 3 
1 3 2 3 3 1 3 3 2 3 
1 4
2 7 7 3 
3 3 9
1 4
1 2
2 5 5 2 
1 2
2 7 7 2 
1 1
3 5 8
2 4 4 1 
3 3 8
1 1
1 3
2 6 6 1 
2 1 1 1 
2 4 4 2 
1 7
3 1 5
3 1 9
```
### 样例输出 #2
```
4
2
3
4
6
```
## 提示

## 样例解释

对于第一组样例，初始数组为 $[2,3,3,2,1]$ ，段数最小分割的方式为 $[2,3|3,2|1]$ ，故输出 $3$ 。然后限制了 $3,4$ 之间必须分割，故最小的分割方式为 $[2,3|3|2|1]$ ，输出为 $4$ 。之后数组被修改为 $[2,1,3,2,1]$ ，段数最小的分割方式为 $[2|1|3|2|1]$ ，故输出 $5$ 。最后取消了 $3,4$ 之间必须分割的限制，最小分割方式为 $[2|1|3,2|1]$ ，输出 $4$ 。

-----

## 数据范围

记 $\sum\limits_{i=1}^m |s_i|= M$ ，对于所有操作 2， $\sum\limits_{i=1}^t |r_i-l_i+1| = T$ ，其中 $t$ 是操作 2 的出现次数， $V$ 为数组中和修改后的数组中的元素的最大值，则各数据点的限制如下：

| 测试点 | $n, M, q \leq$ | $T\leq$ | $V\leq$ | $id=$ | 特殊性质|
| :-----------: | :-----------: |  :-----------: | :-----------: | :-----------: | :-----------: |
| $1\sim3$ | $50$ | $10^5$ | $10^9$ | $1$ | 无 |
| $4$ | $1000$ | $1000$ | $10^9$ | $2$ | 无 |
| $5$ | $1000$ | $0$ | $4$ | $3$ | 保证没有操作 1, 2 |
| $6\sim7$ | $1000$ | $0$ | $4$ | $4$ | 保证没有操作 2 |
| $8\sim11$ | $1000$ | $1000$ | $4$| $5$ | 无 |
| $12$ | $10^5$ | $10^5$ | $10^9$| $6$ | 无 |
| $13\sim14$ | $10^5$ | $0$ | $4$| $7$ | 保证没有操作 1, 2 |
| $15\sim17$ | $10^5$ | $0$ | $4$| $8$ | 保证没有操作 2 |
| $18\sim25$ | $10^5$ | $10^5$ | $4$| $9$ | 无 |

对于所有数据，保证 $1\le n,M,q\le10^5, 0\le T\le 10^5,1\le V\le10^9, 1\le id\le9, l\le r$ 。$a,t$ 中的所有数都在 $s$ 中出现。

**保证给出的数组随机，但是询问的区间与询问的操作并不随机**。具体而言，初始给出的 $s,t$ 以及询问时可能给出的 $a$ 在符合上文所述限制之下的所有可能情况中等概率选取。而其他数据则不是随机的。


---

---
title: "面包题"
layout: "post"
diff: 普及+/提高
pid: P12021
tag: ['数论', 'Fibonacci 数列', '整除分块']
---
# 面包题
## 题目背景

面包（bread）
## 题目描述

从 $1 \sim n$ 的自然数中选出若干个数（可以不选），满足以下条件：

- 若选择了 $x$，则不能选择 $kx$。

求总共有多少种选法（不考虑顺序）。

答案需要**对** ${998244353}$ **取模**。
## 输入格式

第一行一个正整数 $T$ 表示数据组数。

接下来每组数据一行输入两个正整数：$n,k$，含义同题面所示。
## 输出格式

一共 $T$ 行，每行一个正整数表示对应的答案。
## 样例

### 样例输入 #1
```
3
4 2
2 2
10 20
```
### 样例输出 #1
```
10
3
1024
```
## 提示

### 样例解释

对于第一组数据，满足条件的 $S$ 有 $\varnothing,\{1\},\{1,3\},\{1,4\},\{1,3,4\},\{2\},\{2,3\},\{3\},\{3,4\},\{4\}$，共 $10$ 种 $S$ 满足上述条件。

对于第二组数据，满足条件的 $S$ 有 $\varnothing,\{1\},\{2\}$，共 $3$ 种 $S$ 满足上述条件。

对于第三组数据，任意满足 $S\subseteq\{1,2,3,\dots,10\}$ 的 $S$ 都符合条件，因此答案为 $2^{10}=1024$。

### 数据范围

对于 $20\%$ 的数据：$1\leq T\leq 10$，$2\leq n,k \leq 15$

对于 $40\%$ 的数据：$1\leq T\leq 10^2$，$2\leq n,k \leq 10^5$

对于 $100\%$ 的数据：$1\leq T\leq 10^5$，$2\leq n,k \leq 10^9$



---

---
title: "【MX-X13-T4】「KDOI-12」好胜是人的本能，功利是社会的本性。"
layout: "post"
diff: 普及+/提高
pid: P13009
tag: ['动态规划 DP', '贪心', 'O2优化', '整除分块', '梦熊比赛']
---
# 【MX-X13-T4】「KDOI-12」好胜是人的本能，功利是社会的本性。
## 题目描述

给定一个长度为 $n$ 的正整数序列 $a_1, \ldots, a_n$ 以及一个正整数 $m$ 满足 $m \ge \max a_i$。

你可以对序列进行任意次操作（也可以不操作）。每次操作你可以选择一个区间 $[l,r]$，然后对于所有 $l\leq i\leq r$，令 $a_i\gets\bigl\lfloor\frac{m}{a_i}\bigr\rfloor$。

求可以得到的 $\sum_{j=1}^na_j$ 的最大值以及对应的最少操作次数。
## 输入格式

**本题有多组测试数据。**

第一行，一个正整数 $T$，表示测试数据组数。对于每组测试数据：

* 第一行，两个正整数 $n,m$。
* 第二行，$n$ 个正整数 $a_1, \ldots, a_n$。
## 输出格式

对于每组测试数据，一行，两个非负整数，分别表示 $\sum_{j=1}^na_j$ 的最大值以及对应的最少操作次数。
## 样例

### 样例输入 #1
```
3
2 5
1 2
5 10
1 5 2 4 3
10 10
1 4 2 5 1 6 2 7 1 10
```
### 样例输出 #1
```
7 1
28 3
80 5
```
## 提示

**【样例解释】**

对于样例的第二组测试数据：选择以下 $3$ 组 $[l,r]$ 即可得到最大值 $28$：

* $[1,2]$；
* $[2,5]$；
* $[4,5]$。

可以证明该方案是最优的之一。

**【数据范围】**

**本题使用捆绑测试。**

| 子任务编号 | 分值 | $n\leq$ | $\sum n\leq$ | 特殊性质 |
|:--:|:--:|:--:|:--:|:--:|
| $1$ | $9$ | $4$ | $400$ | 无 |
| $2$ | $27$ | $10^3$ | $10^4$ | 无 |
| $3$ | $11$ | $10^5$ | $10^6$ | A |
| $4$ | $16$ | $10^5$ | $10^6$ | B |
| $5$ | $37$ | $10^5$ | $10^6$ | 无 |

* 特殊性质 A：$a_i\leq\sqrt m$；
* 特殊性质 B：$a_i\mid m$。

对于所有数据：$1\leq T\leq 10^5$，$1\leq n\leq 10^5$，$1\leq\sum n\leq10^6$，$1\leq a_i\leq m\leq10^{12}$。


---

---
title: "[GDCPC 2024] Menji 和 gcd"
layout: "post"
diff: 普及+/提高
pid: P13357
tag: ['2024', '广东', 'XCPC', '整除分块']
---
# [GDCPC 2024] Menji 和 gcd
## 题目背景

数据、标程、题解等资源的获取：<https://gitlink.org.cn/thusaa/gdcpc2024>
## 题目描述

Menji 喜欢最大公约数，特别是最大公约数大的正整数对。

令 $\gcd(x,y)$ 表示 $x,y$ 的最大公约数，多次给定 $L,R$，保证 $L<R$，求 $\max\limits_{L\leq x<y\leq R}\gcd(x,y)$。
## 输入格式

第一行一个正整数 $T(1\leq T\leq 10)$，表示数据组数。

之后 $T$ 行，每行两个正整数 $L,R(1\leq L<R\leq 10^{12})$，表示一组询问。
## 输出格式

对于每个询问 $L,R$，输出一行一个正整数 $\max\limits_{L\leq x<y\leq R}\gcd(x,y)$。
## 样例

### 样例输入 #1
```
10
1 2
2 4
6 10
11 21
147 154
1470 1540
2890 3028
998244353 1000000007
34827364537 41029384775
147147147147 154154154154
```
### 样例输出 #1
```
1
2
3
7
7
70
126
1754385
5861340682
7007007007
```


---

---
title: "守墓人"
layout: "post"
diff: 普及+/提高
pid: P2357
tag: ['线段树', '树状数组', '分块']
---
# 守墓人
## 题目背景

 ![](https://cdn.luogu.com.cn/upload/pic/1406.png) 

在一个荒凉的墓地上，有一个令人尊敬的守墓人， 他看守的墓地从来没有被盗过， 所以人们很放心的把自己的先人的墓安顿在他那

守墓人能看好这片墓地是必然而不是偶然……

因为……守墓人懂风水 0.0
## 题目描述

他把墓地分为主要墓碑和次要墓碑， 主要墓碑只能有 $1$ 个， 守墓人把他记为 $1$ 号， 而次要墓碑有 $n-1$ 个，守墓人将之编号为 $2,3\dots n$，所以构成了一个有 $n$ 个墓碑的墓地。

而每个墓碑有一个初始的风水值，这些风水值决定了墓地的风水的好坏，所以守墓人需要经常来查询这些墓碑。

善于运用风水的守墓人，通过一次次逆天改命，使得自己拥有了无限寿命，没人知道他活了多久。这天，你幸运的拜访到了他，他要求你和他共同见证接下来几年他的战果，但不过他每次统计风水值之和都需要你来帮他计算，算错了他会要你命 QAQ

风水也不是不可变，除非遭遇特殊情况，已知在接下来的 $2147483647$ 年里，会有 $f$ 次灾难，守墓人会有几个操作：

1. 将 $[l,r]$ 这个区间所有的墓碑的风水值增加 $k$。

2.将主墓碑的风水值增加 $k$

3.将主墓碑的风水值减少 $k$

4.统计 $[l,r]$ 这个区间所有的墓碑的风水值之和

5.求主墓碑的风水值

上面也说了，很多人会把先人的墓安居在这里，而且守墓人活了很多世纪→\_→，墓碑的数量会多的你不敢相信= =

守墓人和善的邀请你帮他完成这些操作，要不然哪天你的旅馆爆炸了，天上下刀子.....

为了活命，还是帮他吧

## 输入格式

第一行，两个正整数 $n,f$ 表示共有 $n$ 块墓碑，并且在接下来的 $2147483647 $年里，会有 $f$ 次世界末日

第二行，$n$ 个正整数，表示第 $i$ 块墓碑的风水值

接下来 $f$ 行，每行都会有一个针对世界末日的解决方案，如题所述，标记同题

## 输出格式

输出会有若干行，对 $4$ 和 $5$ 的提问做出回答

## 样例

### 样例输入 #1
```
5 7
0 0 0 0 0
1 1 5 1
1 1 3 3
2 3
3 1
4 1 5
2 1
5
```
### 样例输出 #1
```
16
7
```
## 提示

$20\%$ 的数据满足：$1\leq n\leq 100$

$50\%$ 的数据满足：$1\leq n\leq 6000$

$100\%$ 的数据满足：$1\leq n,f\leq 2 \times 10^5$，答案不超过 64 位整数。



---

---
title: "[TJOI2009] 开关"
layout: "post"
diff: 普及+/提高
pid: P3870
tag: ['2009', '线段树', '各省省选', '分块', '天津']
---
# [TJOI2009] 开关
## 题目描述

现有 $n$ 盏灯排成一排，从左到右依次编号为：$1$，$2$，……，$n$。然后依次执行 $m$ 项操作。

操作分为两种：

1. 指定一个区间 $[a,b]$，然后改变编号在这个区间内的灯的状态（把开着的灯关上，关着的灯打开）；
2. 指定一个区间 $[a,b]$，要求你输出这个区间内有多少盏灯是打开的。

**灯在初始时都是关着的。**
## 输入格式

第一行有两个整数 $n$ 和 $m$，分别表示灯的数目和操作的数目。

接下来有 $m$ 行，每行有三个整数，依次为：$c$、$a$、$b$。其中 $c$ 表示操作的种类。

- 当 $c$ 的值为 $0$ 时，表示是第一种操作。
- 当 $c$ 的值为 $1$ 时，表示是第二种操作。

$a$ 和 $b$ 则分别表示了操作区间的左右边界。
## 输出格式

每当遇到第二种操作时，输出一行，包含一个整数，表示此时在查询的区间中打开的灯的数目。
## 样例

### 样例输入 #1
```
4 5
0 1 2
0 2 4
1 2 3
0 2 4
1 1 4

```
### 样例输出 #1
```
1
2
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $2\le n\le 10^5$，$1\le m\le 10^5$，$1\le a,b\le n$，$c\in\{0,1\}$。


---

---
title: "〈 TREEのOI 2022 Spring 〉Counting By Ternary"
layout: "post"
diff: 普及+/提高
pid: P8308
tag: ['数学', '递推', 'O2优化', '前缀和', '分块']
---
# 〈 TREEのOI 2022 Spring 〉Counting By Ternary
## 题目背景

黑土地上，一棵小苗破土而出。

几个月里，它吮吸着甘甜的雨露，享受着温暖的阳光，愈发翠绿了起来。

![](https://cdn.pixabay.com/photo/2019/03/05/12/52/plant-4036131_960_720.jpg)

它越长越高，越长越壮，似乎要突破云霄。

它长成了一棵大树，渴望着去天空中，看一看这美丽的世界。

![](https://cdn.pixabay.com/photo/2015/02/24/15/41/wolf-647528_960_720.jpg)
## 题目描述

**请留意本题并不寻常的时空限制。**

给定一个数 $x$，用如下规则建立一棵有根树：

- 根节点为 $\lang0,x\rang$。  

- 对于一个节点 $\lang i,j\rang$，若 $j < 3$，则它是叶子节点，否则它的子节点为对于任意 $1 \le k$ 且 $j$ 的位数 $\ge k$， $\lang j_k, k\rang$，其中 $j_k$ 为它三进制表示从左向右的第 $k$ 位。  

求这棵树的叶子节点的数目。
## 输入格式

一行两个整数 $p, q$，表示 $x = p^q$。
## 输出格式

一行一个整数，即为所求。  

题目保证答案在 $\tt int64$ 范围内。
## 样例

### 样例输入 #1
```
9 1
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
27 1
```
### 样例输出 #2
```
6
```
## 提示



**本题采用 SubTask 捆绑测试。**

| SubTask 编号 | 分值 | 特殊性质 |
| :-----------: | :-----------: | :-----------: |
| $0$ | $10$ | $p\le 3^{15}$，$q=1$ |
| $1$ | $10$ | $p\le 3^{35}$，$q=1$ |
| $2$ | $20$ | $p=3$，$q\le 3^{15}$ |
| $3$ | $60$ | $p=3$，$q\le 3^{35}$ |


对于 $100\%$ 的数据，$p^q \le 3^{3^{35}}$（$10^{10^9} \lt 3^{3^{35} } \lt 10^{2.5 \times 10^9}$），保证 $p = 3^l(l\in \mathbb N^+)$。 



---


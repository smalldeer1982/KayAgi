---
title: "[厦门小学生 C++ 2022] 序列问题"
layout: "post"
diff: 普及+/提高
pid: B4153
tag: ['2022', '福建', '前缀和', '差分', '小学科创活动']
---
# [厦门小学生 C++ 2022] 序列问题
## 题目背景

2022 年厦门市小学生 C++ 语言复赛试题，数据为洛谷自造。

考虑到评测机性能差异，本题时限相较原题下调 0.5s。
## 题目描述

高老师是一位经验丰富的信息学竞赛指导教师，善于开发学生的创造性思维。周末课上，他给学生留下一道关于 $01$ 串的思考题（所谓 $01$ 串就是由字符 $0$ 和 $1$ 组成的字符串）：给定一个长度为 $n$ 的 $01$ 串，他想知道有多少个子串，满足其中 $1$ 的个数比 $0$ 的个数多。现在高老师请会编程的你来帮忙计算答案。 
## 输入格式

第一行一个整数，表示字符串的长度。 

第二行一个字符串，表示 $01$ 串。
## 输出格式

输出一行，包括一个整数，表示满足条件的子串的个数。 
## 样例

### 样例输入 #1
```
3
111
```
### 样例输出 #1
```
6
```
## 提示

### 样例解释

满足条件的子串有：$1$，$1$，$1$，$11$，$11$，$111$

### 数据范围

- 对于 $20\%$ 的数据，$n\leq 3000$。
- 对于另外的 $10\%$ 的数据，$n\leq 10^7$，字符串全为 $1$。
- 对于另外的 $20\%$ 的数据，$n\leq 2\times 10^5$。
- 对于另外的 $20\%$ 的数据，$n\leq 2\times 10^6$。
- 对于另外的 $100\%$ 的数据，$n\leq 10^7$。


---

---
title: "[BCSP-X 2024 12 月小学高年级组] 操作序列"
layout: "post"
diff: 普及+/提高
pid: B4161
tag: ['2024', '北京', '差分', 'BCSP-X']
---
# [BCSP-X 2024 12 月小学高年级组] 操作序列
## 题目描述

有 $n$ 个变量 $x[1 \sim n]$，初始值都为 0。

依次给出 $m$ 个操作的信息，操作分为 2 种：

- $(1, id, v)$: 代表将 $x[id]$ 的值加上 $v$；
- $2$: 代表将所有变量的值乘 $2$；

所有运算在 $(\bmod \ 10^4)$ 下执行，提示：模意义下的加减乘运算

- 加：`c = (a + b) % mod`；
- 减：`c = (a - b + mod) % mod`；
- 乘：`c = a * b % mod`；

现在给出一个操作序列，请问依次执行序列中的所有操作之后，每个变量的值是多少。

具体的，操作序列以 $q$ 个区间 $[l[i], r[i]]$ 的形式给出，依次执行每个区间、每个区间按编号从小->大执行区间内的操作，即完整的操作序列为：

- $l[1] \sim r[1], l[2] \sim r[2], l[3] \sim r[3], \ldots, l[q] \sim r[q]$
## 输入格式

第一行 $3$ 个整数 $n, m, q$，代表变量数量，操作数量，操作序列中区间数量。

接下来 $m$ 行，每行 $3$ 个整数 $op, id, v$ 或者 $1$ 个整数 $op$，给出所有操作的信息。

接下来 $q$ 行，每行 $2$ 个整数 $l[i], r[i]$ 代表一个操作区间。
## 输出格式

输出一行 $n$ 个整数，代表所有操作执行完之后每个变量的值。
## 样例

### 样例输入 #1
```
5 5 5
2
1 1 3
2
2
1 3 3
2 5
1 2
1 1
2 2
3 4
```
### 样例输出 #1
```
228 0 48 0 0
```
### 样例输入 #2
```
10 10 10
1 4 1
1 7 3
1 4 5
1 1 3
2
1 5 5
2
2
1 8 2
1 7 1
1 8
1 1
7 8
1 4
8 9
3 9
2 10
4 7
3 6
6 9
```
### 样例输出 #2
```
2536 0 0 8952 3560 0 6304 4674 0 0
```
## 提示

### 样例 3-8

见附件。

### 数据范围

对于所有数据，$1 \leq n, m, q \leq 2 \times 10^5, op = \{1, 2\}, 1 \leq id \leq n, 1 \leq v \leq 10^9$，假设 $m$ 种操作中第 1、2 种操作的总数为 $m_1, m_2$，满足 $m_1 + m_2 = m$。

本题采用捆绑测试，你必须通过子任务中的所有数据点以及其依赖的子任务，才能获得子任务对应的分数。

| 子任务编号 | 分值 | 数据范围 | 特殊性质 | 子任务依赖 |
|:------------:|:------:|:----------:|:----------:|:------------:|
| 1          | 15   | $n, m, q \leq 500$ |          |            |
| 2          | 19   | $n, m, q \leq 5000$ |          | 1          |
| 3          | 11   | $n, m, q \leq 2 \times 10^5$ | $m_2 = 0$ |            |
| 4          | 17   | $n, m, q \leq 2 \times 10^5$ | $m_1 = 1, m_2 = m - 1$ |            |
| 5          | 17   | $n, m, q \leq 2 \times 10^5$ | $m_1 = m - 1, m_2 = 1$ |            |
| 6          | 21   | $n, m, q \leq 2 \times 10^5$ |          | 1,2,3,4,5          |


---

---
title: "[中山市赛 2023] 组合数问题"
layout: "post"
diff: 普及+/提高
pid: B4338
tag: ['数学', '2023', '广东', '前缀和', '差分', '科创活动', '小学活动']
---
# [中山市赛 2023] 组合数问题
## 题目描述

众所周知，骐度空间·莫羯座·十一月的萧彰同学擅长计算，尤其擅长计算组合数。

定义组合数 $\binom{i}{j}=\begin{cases}\frac{i!}{j!(i-j)!}&i\ge j\ge 0\\0&其他情况\end{cases}$，可以证明对于任意 $i,j$，$\binom{i}{j}$ 总是整数。

这天，骐度空间·莫羯座·十一月的萧彰遇到了一道难题。有一个 $n\times n$ 的矩阵，$(i,j)$ 表示第 $i$ 行第 $j$ 列，有 $Q$ 次操作，每次操作给定子矩阵的两个端点（分别为 $(x1,y1)$ 和 $(x2,y2)$），对于所有原矩阵中的所有位置 $(x,y)$ 满足 $x1\le x\le x2$，$y1\le y\le y2$ 加上 $\binom{x-x1}{y-y1}$。

骐度空间·莫羯座·十一月的萧彰凭借超强的能力在 $0.0001s$ 内算出了答案，但他想考考你，顺便帮忙验证一下。

骐度空间·莫羯座·十一月的萧彰想知道最后的矩阵长什么样，由于数很大，为了方便，每个位置的值都要对 $10^9 + 7$ 取模。

然而输出量很大，骐度空间·莫羯座·十一月的萧彰无法快速比较这是否是正确答案，所以你只需要输出每一行的异或和和每一列的异或和即可。

骐度空间·莫羯座·十一月的萧彰担心你不知道什么是异或运算，所以他直接给你的输出答案的模板：

```cpp
int ans[5010][5010];//假设这是最终的答案矩阵
void print(){
    for(int i=1;i<=n;i++){
        int s=0;
        for(int j=1;j<=n;j++) s^=ans[i][j];
        printf("%d ",s);
    }
    printf("\n");
    for(int i=1;i<=n;i++){
        int s=0;
        for(int j=1;j<=n;j++) s^=ans[j][i];
        printf("%d ",s);
    }
}

```
## 输入格式

第一行两个正整数 $n$，$Q$。

接下来 $Q$ 行，每行四个正整数 $x1, y1, x2, y2$，表示每次操作的子矩阵的两个端点。
## 输出格式

第一行 $n$ 个数，第 $i$ 个数表示最终矩阵第 $i$ 行的异或和。

第二行 $n$ 个数，第 $i$ 个数表示最终矩阵第 $i$ 列的异或和。
## 样例

### 样例输入 #1
```
3 2
1 1 3 2
1 3 3 3

```
### 样例输出 #1
```
0 1 2
1 3 1

```
### 样例输入 #2
```
5 3
1 1 3 3
2 2 5 4
1 2 5 5

```
### 样例输出 #2
```
0 3 0 2 8
1 6 7 12 5

```
### 样例输入 #3
```
10 9
1 2 9 8
2 4 3 6
7 5 9 10
1 2 10 9
1 1 10 10
2 5 6 8
1 4 4 10
1 3 9 10
1 9 9 10

```
### 样例输出 #3
```
2 0 1 10 5 1 66 9 238 246
0 0 44 84 3 81 66 40 0 30

```
## 提示

### 样例解释 1

最终的矩阵如下：

```
1 0 1
1 1 1
1 2 1
```

### 样例解释 2

最终的矩阵如下：

```
1 1 0 0 0
1 3 1 0 0
1 4 4 1 0
0 2 5 4 1
0 2 7 9 4
```

### 数据范围

对于 $10\%$ 的数据，满足 $1 \le n, Q \le 10$。

对于 $30\%$ 的数据，满足 $1 \le n, Q \le 100$。

对于 $40\%$ 的数据，满足 $1 \le n, Q \le 500$。

对于另外 $20\%$ 的数据，满足所有操作的 $x2, y2$ 均等于 $n$。

对于 $100\%$ 的数据，满足 $1 \le n, Q \le 5000$。

对于所有数据 $1 \le x1 \le x2 \le n, 1 \le y1 \le y2 \le n$。


---

---
title: "[中山市赛 2023] 树的改造"
layout: "post"
diff: 普及+/提高
pid: B4339
tag: ['2023', '广东', '最近公共祖先 LCA', '差分', '科创活动', '小学活动']
---
# [中山市赛 2023] 树的改造
## 题目描述

空白这一次的来到了森精种的家园，精灵都喜欢贴近大自然，~~喜欢住在树洞里~~，所以他们的家园是一棵神树！他们非常喜欢艺术，就是说喜欢改造他们所居住的神树！

他们现在居住的树的形态可以描述成一颗有 $n$ 个树洞的树 $A$，一共有 $n-1$ 条边连接，使得树洞两两可以到达，且树洞根据编号是可区分的。

现在菲尔带来了下一代神树的设计图，假设为树 $B$，现在她想考一考空白，如果根据如下规则调整神树，至少需要调整多少次才可以将 $A$ 树变成 $B$ 树。

一次调整可以选择一个节点 $x$，然后将 $x$ 以及和 $x$ 相邻的节点（也就是有边直接相连的节点）打上魔法标记，然后断开 $x$ 的所有邻边，然后再在所有打上魔法标记的点直接添加若干条新边，形成一棵新的树，同时魔法标记消失。
## 输入格式

第一行一个正整数 $n$，表示树的大小。

接下来 $n-1$ 行，每行两个整数 $u,v$，表示 $A$ 树上的边 $(u,v)$。

然后还有 $n-1$ 行，每行两个整数 $u,v$，表示 $B$ 树上的边 $(u,v)$。
## 输出格式

一行一个整数表示最少调整次数。
## 样例

### 样例输入 #1
```
5
1 2
1 3
3 4
3 5
1 2
1 4
4 3
3 5

```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
7
1 2
2 3
2 6
2 4
4 5
5 7
6 3
3 2
2 1
1 5
7 5
5 4

```
### 样例输出 #2
```
2
```
## 提示

### 样例解释 1

可以选择 $x=3$ 进行调整，这时候 $1,3,4,5$ 都被打上了魔法标记。

删去了边 $(3, 1)$，$(3, 4)$，$(3, 5)$，添加边 $(1, 4)$，$(4, 3)$，$(3, 5)$。

### 数据范围

对于 $20\%$ 的数据，$n \le 8$。

对于 $60\%$ 的数据，$n \le 5000$。

对于 $100\%$ 的数据，$n \le 10^6$。


---

---
title: "「Daily OI Round 3」Tower"
layout: "post"
diff: 普及+/提高
pid: P10127
tag: ['洛谷原创', 'O2优化', '差分']
---
# 「Daily OI Round 3」Tower
## 题目背景

定义 $(x_1,y_1),(x_2,y_2)$ 的 `A 距离` 为 $\max\{|x_1-x_2|,|y_1-y_2|\}+1$，下文中的距离都指的是 `A 距离`。

比如说，$(1,1)$ 和 $(3,8)$ 的 `A 距离` 为 $\max\{|1-3|,|1-8|\}+1=8$。

比如说，$(46,1)$ 和 $(35,9)$ 的 `A 距离` 为 $\max\{|46-35|,|1-9|\}+1=12$。
## 题目描述

A 国的国土可以看成是 $n\times m$ 的矩阵，第 $x$ 行第 $y$ 列坐标为 $(x,y)$。

国土可以是山地，用 `#` 表示，可以是平地，用 `.` 表示。

A 国在每一个平地建了一个能量塔，能量塔搜集能量的范围是正方形的。如果 $e$ 满足到该能量塔 `A 距离` **不超过** $e$ 的地方是 A 国的国土，并且该地方是平地，则称 $e$ 是该能量塔的基准能量。

一个能量塔的综合能量 $E$ 为该能量塔基准能量 $e$ 的最大值。

特殊地，如果这个地方没有能量塔，该处综合能量 $E=0$，否则，该处的综合能量就是能量塔的综合能量。

记第 $i$ 行第 $j$ 列的综合能量为 $E_{i,j}$。

记一个国家的能量总和 $\xi=\sum\limits^n_{i=1}\sum\limits_{j=1}^mE_{i,j}^2$。

你需要求一个国家的能量总和 $\xi$。

当然，由于特殊的原因（比如宇宙射线的影响），某一个地方的平地可能会突然变成山地，当地的能量塔也会被摧毁，而且影响到附近能量塔的综合能量 $E$。

作为 A 国的参谋，国王想让你预备方案，看看每一个非山地的点变成山地之后，该国家的能量总和是多少。
## 输入格式

第一行两个整数 $n,m$。

下面是一个 $n\times m$ 的矩阵，第 $i$ 行第 $j$ 列为 `#` 或 `.`，描述 A 国的地形。
## 输出格式

输出共 $n+1$ 行。

第一行一个整数 $\xi$，表示 A 国开始的能量总和。

下面是一个 $n\times m$ 的矩阵，第 $i+1$ 行第 $j$ 个整数表示 $(i,j)$ 变成山地之后该国家的能量总和 $\xi_{i,j}$，特殊地，如果 $(i,j)$ 原来是山地，输出 $-1$。
## 样例

### 样例输入 #1
```
3 4
....
...#
....
```
### 样例输出 #1
```
14
10 10 10 13
10 10 10 -1
10 10 10 13
```
### 样例输入 #2
```
5 6
...#..
#.....
......
......
...#..
```
### 样例输出 #2
```
39
38 38 38 -1 38 38
-1 35 32 29 32 35
35 32 29 29 32 35
35 32 29 29 32 35
35 35 35 -1 38 38
```
### 样例输入 #3
```
7 7
....#..
.#.....
.......
.......
.#...##
..#####
.......
```
### 样例输出 #3
```
51
50 50 50 50 -1 50 50
50 -1 47 44 41 44 47
50 50 44 41 38 44 47
50 50 44 41 38 44 47
50 -1 47 47 47 -1 -1
50 50 -1 -1 -1 -1 -1
50 50 50 50 50 50 50
```
## 提示

#### 【样例解释 #1】

下面举 $3$ 个例子：

开始，这个国家的 $E_{i,j}$ 如下：

```
1 1 1 1 
1 2 1 0
1 1 1 1
```

$(1,1)$ 变成山地后，$E_{i,j}$ 如下：

```
0 1 1 1
1 1 1 0
1 1 1 1
```



$(3,4)$ 变成山地后，$E_{i,j}$ 如下：

```
1 1 1 1
1 2 1 0
1 1 1 0
```

#### 【数据范围】

对于全部数据保证：$1\le n,m\le600$。


---

---
title: "[AHOI2024 初中组] 操作"
layout: "post"
diff: 普及+/提高
pid: P10374
tag: ['模拟', '线段树', '树状数组', '2024', '安徽', 'O2优化', '差分']
---
# [AHOI2024 初中组] 操作
## 题目描述

小可可有一个数组 $\{a_n\}$（初始值为 $\{a_n\}=\{0,0,\ldots,0\}$）和从左到右的 $m$ 个机器，其中第 $i$ 个机器有类别 $o_i \in \{1,2\}$ 和参数 $x_i,y_i$。第 $i$ 个机器执行的操作如下：

- 若 $o_i=1$，则将 $a_{(x_i)}$ 加上 $y_i$，此时保证 $1 \le x_i \le n$，$1 \le y_i \le 10^4$。
- 若 $o_i=2$，则执行第 $x_i \sim y_i$ 个机器的操作各一次，此时保证 $1 \le x_i \le y_i \le i-1$。
- 特别地，保证 $o_1=1$。

现在，小可可依次执行了第 $c_1,c_2,\ldots,c_k$ 个机器的操作各一次，她想知道最后得到的数组 $\{a_n\}$ 是什么。

由于数组中元素的值可能很大，你只需要帮她求出每个元素除以 $10007$ 的余数即可。
## 输入格式

第一行三个正整数 $n,m,k$。

接下来一行 $k$ 个正整数 $\{c_k\}$。

接下来 $m$ 行，第 $i$ 行三个正整数 $o_i,x_i,y_i$。
## 输出格式

一行 $n$ 个非负整数，表示数组 $\{a_n\}$ 中每个元素的值除以 $10007$ 的余数。
## 样例

### 样例输入 #1
```
2 3 3
1 2 3
1 1 2
2 1 1
2 1 2
```
### 样例输出 #1
```
8 0
```
## 提示

### 样例 1 解释

先执行第 $1$ 个机器的操作，给 $a_1$ 加上了 $2$。

然后执行第 $2$ 个机器的操作，它操作了第 $1$ 个机器，给 $a_1$ 加上了 $2$。

然后执行第 $3$ 个机器的操作。它先操作了第 $1$ 个机器，给 $a_1$ 加上了 $2$；然后操作了第 $2$ 个机器，第 $2$ 个机器又操作了第 $1$ 个机器，给 $a_1$ 加上了 $2$。

综上所述，最后得到的数组为 $\{8,0\}$。

### 数据范围


对于 $10\%$ 的数据，$n,m,k \le 10$。

对于 $30\%$ 的数据，$n,m,k \le 1000$。

对于另外 $20\%$ 的数据，$n=1$。

对于另外 $20\%$ 的数据，$k=1$。

对于 $100\%$ 的数据，$1 \le n,m,k \le 2 \times 10^5$，$1 \le c_i \le n$，$o_i \in \{1,2\}$，$o_1=1$。此外，对于第 $i$ 个机器，保证：

- 若 $o_i=1$，则 $1 \le x_i \le n$，$1 \le y_i \le 10^4$。
- 若 $o_i=2$，则 $1 \le x_i \le y_i \le i-1$。


---

---
title: "「QFOI R2」钟声远带斜阳"
layout: "post"
diff: 普及+/提高
pid: P10412
tag: ['贪心', '洛谷原创', 'O2优化', '前缀和', '差分', '洛谷月赛']
---
# 「QFOI R2」钟声远带斜阳
## 题目描述

**注意：本题中的所有数列下标从 $0$ 开始。**

小 R 是一个可爱的女孩子，她喜欢研究无穷数列。

她称一个无穷数列 $b$ 是美妙的，当且仅当存在自然数 $k_0$，使得对于所有 $k\ge k_0$，都满足 $b$ 中下标在区间 $[k_0,k]$ 内的所有数的和非负（即 $\sum_{i=k_0}^kb_i\ge 0$）。例如，数列 $\alpha_i=i-5$ 是美妙的，取 $k_0=5$ 符合要求；但 $\beta_i=-i$ 不是美妙的。

她目前只有一个长度为 $n$ 的有穷数列 $a$，可以进行任意次以下三种操作：

1. 花费 $p$ 的代价，选择一个整数 $i$（$0\le i < n$），将 $a_i$ 增加一。
1. 花费 $q$ 的代价，选择一个整数 $i$（$0\le i < n$），将 $a_i$ 删除，同时更新 $n$ 为新的数列长度。**不能将数列删空。**
1. 花费 $r$ 的代价，选择两个整数 $i,j$（$0\le i < j < n$），交换 $a_i$ 与 $a_j$。

她希望在若干次操作后，用无限个有穷数列 $a$ 依次相接得到无穷数列 $b$（即 $b_i=a_{i\bmod n}$），使得 $b$ 是美妙的。请你求出最小的代价。
## 输入格式

第一行四个整数 $n,p,q,r$。

第二行 $n$ 个整数，表示数列 $a$。
## 输出格式

一行，一个整数，表示最小代价。
## 样例

### 样例输入 #1
```
5 1 2 5
2 -2 3 -3 -1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5 2 1 5
2 -2 3 -3 -1
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
5 1 1 1
0 1 2 3 4
```
### 样例输出 #3
```
0
```
## 提示

**样例 $1$ 解释**

花费 $p=1$ 的代价将 $a_3$ 增加一，得到数列 $b=[2,-2,3,-2,-1,2,-2,3,-2,-1,\cdots]$ 是美妙的，取 $k_0=2$ 符合要求。

可以证明不存在代价更小的方案。

---

**样例 $2$ 解释**

花费 $q=1$ 的代价将 $a_1$ 删除，得到数列 $b=[2,3,-3,-1,2,3,-3,-1,\cdots]$ 是美妙的，取 $k_0=0$ 符合要求。

可以证明不存在代价更小的方案。

---

**数据范围**

**本题采用捆绑测试。只有通过子任务中所有测试点以及所有依赖的子任务，才能获得相应的分数。**

对于全部数据：$1\le n\le 10^5$，$1\le p,q,r\le 10^9$，$|a_i|\le 10^9$。

- 子任务一（$10$ 分）：$n=1$。
- 子任务二（$10$ 分）：$n\le 10$。依赖子任务一。
- 子任务三（$20$ 分）：$|a_i|\le 1$。
- 子任务四（$20$ 分）：$\sum|a_i|\le 10^5$。依赖子任务三。
- 子任务五（$40$ 分）：无特殊限制。依赖子任务一、二、三、四。


---

---
title: "『FLA - I』云音泛"
layout: "post"
diff: 普及+/提高
pid: P10837
tag: ['模拟', '离散化', '洛谷原创', 'O2优化', '排序', '前缀和', '队列', '差分', '洛谷月赛']
---
# 『FLA - I』云音泛
## 题目背景

**[English statement.](/problem/U458238) You must submit your code at the Chinese version of the statement.**

“……这些年来，过得可好？”

“……无所谓好或不好，人生一场空虚大梦，韶华白首，不过转瞬。惟有天道恒在，往复循环，不曾更改...”
## 题目描述

在梦中，秋种下了 $n$ 朵凋零玫瑰。他记得，第 $i$ 朵玫瑰是在时刻 $t_i$ 种植的。

凋零玫瑰在被种下的那个时刻就立即开放，但每一株玫瑰只会开放 $m$ 个时刻（在时刻 $T$ 种植的玫瑰会且仅会在从时刻 $T$ 到时刻 $T+m-1$ 的 $m$ 个时刻开放），在 $m$ 个时刻后便化作再也无法挽留的灰尘，飘散在凛冽的寒风中。

他问你，假如他可以改变不超过一朵玫瑰的种植时间（选定一个 $t_i$ 并将其修改为任意正整数），那么最多有多少个时刻有且仅有一株凋零玫瑰开放？
## 输入格式

第一行输入两个正整数 $n,m$。

第二行输入 $n$ 个正整数，第 $i$ 个正整数为 $t_i$。
## 输出格式

输出一行一个正整数表示答案。
## 样例

### 样例输入 #1
```
5 4
11 9 1 3 12

```
### 样例输出 #1
```
14

```
### 样例输入 #2
```
13 7
6 42 58 41 20 60 2 61 45 28 45 28 12

```
### 样例输出 #2
```
38

```
## 提示

**「样例解释 #1」**

如图，使用金色标记有且仅有一株凋零玫瑰开放的时刻，使用黑色和红色标记每朵凋零玫瑰开放的时刻。

![example1](https://cdn.luogu.com.cn/upload/image_hosting/1u42cn1k.png)

将使用红色标记的玫瑰的种植时刻改为 $17$（将 $t_1$ 的值修改为 $17$，如下图）后有 $14$ 个时刻有且仅有一株凋零玫瑰开放。可以证明不存在能够使有且仅有一株凋零玫瑰开放的时刻数量大于 $14$ 的修改方案。

![example2](https://cdn.luogu.com.cn/upload/image_hosting/ig0pgy5w.png)

**「数据范围」**

|测试点编号|$n \leq$|$m \leq$|$t_i \leq$|
|:-:|:-:|:-:|:-:|
|$1 \sim 6$|$5000$|$5000$|$5000$|
|$7 \sim 12$|$2 \times 10^5$|$2 \times 10^5$|$2 \times 10^5$|
|$13 \sim 14$|$2 \times 10^5$|$1$|$10^9$|
|$15 \sim 20$|$2 \times10^5$|$10^9$|$10^9$|

对于所有测试数据，$1 \leq n \leq 2 \times 10^5$，$1 \leq m,t_i \leq 10^9$。


---

---
title: "[USACO24DEC] Deforestation S"
layout: "post"
diff: 普及+/提高
pid: P11453
tag: ['贪心', '线段树', '二分', 'USACO', '堆', '2024', '差分约束']
---
# [USACO24DEC] Deforestation S
## 题目描述

Farmer John 正在扩大他的农场！他已经找到了完美的位置——红黑森林，由数轴上的 $N$ 棵树（$1≤N≤10^5$）组成，第 $i$ 棵树位于位置 $x_i$（$−10^9≤x_i≤10^9$）。

环境保护法限制了 Farmer John 可以砍伐哪些树来为他的农场腾出空间。有 $K$ 个限制（$1≤K≤10^5$），规定在线段 $[l_i,r_i]$（包含端点）中必须始终至少存在 $t_i$ 棵树（$−10^9≤l_i,r_i≤10^9$）。输入保证红黑森林初始时满足这些限制。

Farmer John 想要他的农场尽可能大。请帮助他计算他可以砍伐的树的最大数量，同时仍然满足所有限制！
## 输入格式

每个测试点包含 $T$（$1≤T≤10$）个独立的测试用例。输入保证一个测试点中的所有 $N$ 之和以及 $K$ 之和均不超过 $3⋅10^5$。

输入的第一行包含 $T$。每个测试用例的格式如下：

- 第一行包含整数 $N$ 和 $K$。
- 下一行包含 $N$ 个整数 $x_1,\cdots,x_N$。
- 以下 $K$ 行，每行包含三个空格分隔的整数 $l_i$，$r_i$ 和 $t_i$。
## 输出格式

对于每个测试用例，输出一行，包含一个整数，表示 Farmer John 可以砍伐的树的最大数量。
## 样例

### 样例输入 #1
```
3
7 1
8 4 10 1 2 6 7
2 9 3
7 2
8 4 10 1 2 6 7
2 9 3
1 10 1
7 2
8 4 10 1 2 6 7
2 9 3
1 10 4
```
### 样例输出 #1
```
4
4
3
```
## 提示

### 样例解释

对于第一个测试用例，Farmer John 可以砍伐前 $4$ 棵树，留下位于 $x_i=2,6,7$ 的树来满足限制。

对于第二个测试用例，额外的限制不会影响 Farmer John 可以砍伐哪些树，因此他可以砍伐相同的树并同时满足两个限制。

对于第三个测试用例，Farmer John 至多只能砍伐 $3$ 棵树，因为初始时有 $7$ 棵树，但第二个限制要求他至少留下 $4$ 棵树不砍伐。

### 测试点性质

测试点性质：
- 测试点 1：样例。
- 测试点 2：$N,K≤16$。
- 测试点 3-5：$N,K≤1000$。
- 测试点 6-7：对于所有的 $i=1,\cdots,K$ 有 $ti=1$。
- 测试点 8-11：没有额外限制。


---

---
title: "「LAOI-9」Update"
layout: "post"
diff: 普及+/提高
pid: P11894
tag: ['倍增', 'O2优化', '差分']
---
# 「LAOI-9」Update
## 题目描述

给定长度为 $n$ 的序列 $a$，接下来 $m$ 次操作，每次操作形如：

- 给定 $l,r$，对于 $i \in [l,r]$，令 $a_i \leftarrow a_i + \lfloor \log_2 a_i \rfloor $。

$m$ 次操作后，输出 $a$ 序列。
## 输入格式

第一行两个正整数 $n$ 和 $m$。

接下来一行 $n$ 个正整数，第 $i$ 个表示 $a_i$。

接下来 $m$ 行，每行两个正整数 $l$ 和 $r$。
## 输出格式

一行 $n$ 个正整数，第 $i$ 个表示 $a_i$。相邻正整数间用空格分隔。
## 样例

### 样例输入 #1
```
5 2
2 3 4 5 6
2 3
1 1
```
### 样例输出 #1
```
3 4 6 5 6
```
## 提示

**本题目采用捆绑测试**。

| 子任务编号 | $n,m \le$ | 特殊性质 | 分值 |
| :-----: | :------: | :------: | :------: |
| $1$ | $10^3$ | 无 | $30$ |
| $2$ | $10^5$ | A | $20$ |
| $3$ | $10^5$ | 无 | $50$ |

特殊性质 A：$a_i \le 100$。 

对于 $100 \%$ 的数据，满足 $1 \le n,m \le 10^5$，$1 \le a_i \le 10^5$，$1 \le l \le r \le n$。


---

---
title: "[GESP202503 八级] 割裂"
layout: "post"
diff: 普及+/提高
pid: P11967
tag: ['倍增', '2025', '最近公共祖先 LCA', '差分', 'GESP']
---
# [GESP202503 八级] 割裂
## 题目描述


小杨有一棵包含 $ n $ 个节点的树，其中节点的编号从 1 到 $ n $。

小杨设置了一个好点对 $\{\langle u_1, v_1 \rangle, \langle u_2, v_2 \rangle, \dots, \langle u_a, v_a \rangle\}$ 和一个坏点对 $\langle b_u, b_v \rangle$。一个节点能被删除，当且仅当：

- 删除该节点后对于所有的 $ 1 \leq i \leq a $，好点对 $ u_i $ 和 $ v_i $ 仍然连通；
- 删除该节点后坏点对 $ b_u $ 和 $ b_v $ 不连通。

如果点对中的任意一个节点被删除，其视为不连通。

小杨想知道，还有多少个节点能被删除。

## 输入格式


第一行包含两个非负整数 $ n $, $ a $，含义如下题面所示。

接下来 $n - 1$ 行，每行包含两个正整数 $ x_i, y_i $，代表存在一条连接节点 $ x_i $ 和 $ y_i $ 的边；

之后 $ a $ 行，每行包含两个正整数 $ u_i, v_i $，代表一个好点对 $ \langle u_i, v_i \rangle $；

最后一行包含两个正整数 $ b_u, b_v $，代表坏点对 $ \langle b_u, b_v \rangle $。
## 输出格式

输出一个非负整数，代表删除的节点个数。

## 样例

### 样例输入 #1
```
6 2
1 3
1 5
3 6
3 2
5 4
5 4
5 3
2 6
```
### 样例输出 #1
```
2
```
## 提示


| 子任务编号 | 分值 | $ n $ | $ a $ |
|:-:|:-:|:-:|:-:|
| 1          | $20$  | $=10$     | $=0$      |
| 2          | $20$  | $ \leq 100 $ | $ \leq 100 $ |
| 3          | $60$  | $ \leq 10^6 $ | $ \leq 10^5 $ |

对于全部数据，保证有 $ 1 \leq n \leq 10^6 $, $ 0 \leq a \leq 10^5 $, $ u_i \neq v_i $, $ b_u \neq b_v $。






---

---
title: "工程规划"
layout: "post"
diff: 普及+/提高
pid: P1260
tag: ['图论', 'Special Judge', '差分约束']
---
# 工程规划
## 题目描述

造一幢大楼是一项艰巨的工程，它是由 $n$ 个子任务构成的，给它们分别编号 $1,2,\cdots,n\ (5≤n≤1000)$。由于对一些任务的起始条件有着严格的限制，所以每个任务的起始时间 $T_1,T_2,\cdots,T_n$ 并不是很容易确定的(但这些起始时间都是非负整数，因为它们必须在整个工程开始后启动)。例如：挖掘完成后，紧接着就要打地基；但是混凝土浇筑完成后，却要等待一段时间再去掉模板。

这种要求就可以用 $m\ (5≤m≤5000)$ 个不等式表示，不等式形如 $T_i-T_j≤b$ 代表 $i$ 和 $j$ 的起始时间必须满足的条件。每个不等式的右边都是一个常数 $b$，这些常数可能不相同，但是它们都在区间 $(-100,100)$ 内。

你的任务就是写一个程序，给定像上面那样的不等式，找出一种可能的起始时间序列 $T_1,T_2,\cdots,T_n$，或者判断问题无解。对于有解的情况，要使最早进行的那个任务和整个工程的起始时间相同，也就是说，$T_1,T_2,\cdots,T_n$ 中至少有一个为 $0$。

## 输入格式

第一行是用空格隔开的两个正整数 $n$ 和 $m$，下面的 $m$ 行每行有三个用空格隔开的整数 $i,j,b$ 对应着不等式 $T_i-T_j≤b$。

## 输出格式

如果有可行的方案，那么输出 $n$ 行，每行都有一个非负整数且至少有一个为 $0$，按顺序表示每个任务的起始时间。如果没有可行的方案，就输出信息 `NO SOLUTION`。

## 样例

### 样例输入 #1
```
5 8
1 2 0
1 5 -1
2 5 1
3 1 5
4 1 4
4 3 -1
5 3 -1
5 4 -3
```
### 样例输出 #1
```
0
2
5
4
1

```
### 样例输入 #2
```
5 5
1 2 -3
1 5 -1
2 5 -1
5 1 -5
4 1 4
```
### 样例输出 #2
```
NO SOLUTION

```
## 提示

由@zhouyonglong提供SPJ



---

---
title: "[蓝桥杯 2025 国 Python A] 心意"
layout: "post"
diff: 普及+/提高
pid: P12877
tag: ['2025', 'KMP 算法', '差分', '蓝桥杯国赛']
---
# [蓝桥杯 2025 国 Python A] 心意
## 题目描述

小蓝有一个序列 $a$，同时他的朋友小乔有一个序列 $b$。

我们认为两个序列是和谐的，当且仅当存在某个数 $x$，使得对于所有的 $i$ 有 $a_i + x = b_i$。

现在小蓝可以让序列 $a$ 旋转，即通过一次参数为 $k$ 的旋转可以将序列 $a_1, a_2, \cdots, a_n$ 变为 $a_{1+k}, a_{2+k}, \cdots, a_n, a_1, a_2, \cdots, a_k$。

小蓝希望知道，是否存在这样的旋转操作，能够让序列 $a$ 和 $b$ 是和谐的。

输出共一行，一个自然数 $k$ 表示参数为 $k$ 的旋转操作能够让 $a, b$ 是和谐的，如果存在多个这样的 $k$，请输出最小的 $k$，如果不存在这样的 $k$，请输出 $-1$。
## 输入格式

输入的第一行包含一个正整数 $n$。

第二行包含 $n$ 个正整数 $a_1, a_2, \cdots, a_n$，相邻整数之间使用一个空格分隔。

第三行包含 $n$ 个正整数 $b_1, b_2, \cdots, b_n$，相邻整数之间使用一个空格分隔。
## 输出格式

输出一行包含一个整数表示答案，如果不存在，请输出整数 $-1$。
## 样例

### 样例输入 #1
```
4
2 3 4 5
2 3 4 1
```
### 样例输出 #1
```
1
```
## 提示

**【样例说明】**

小蓝可以让序列 $a$ 旋转得到 $3 \ 4 \ 5 \ 2$，根据和谐序列的定义，令 $x = -1$，那么此时 $a, b$ 就是和谐的。

**【评测用例规模与约定】**

对于 $50\%$ 的评测用例，$n \leq 3000$；

对于 $80\%$ 的评测用例，对于任意 $i \neq j$ 有 $a_i \neq a_j$；

对于所有评测用例，$1 \leq n \leq 5 \times 10^5$，$1 \leq a_i, b_i \leq 10^9$。


---

---
title: "受力分析 Force"
layout: "post"
diff: 普及+/提高
pid: P12976
tag: ['O2优化', '差分约束']
---
# 受力分析 Force
## 题目背景

还在写题的 Comentropy 突然收到了挑战，竟然是一道力学题！他感到震惊，一看到数据范围就知道该怎么写了，但是过程冗长，于是找到你帮他精简一下。

注：本题没有严格的物理理论基础，且本题并不要求物理基础。

**建议阅读形式化题意。**
## 题目描述

现在有 $n\times n$ 个正方体物块摆成一个方阵，物块有自己的重量，你现在需要控制它们平衡不动。这就要求对于第 $i$ 行第 $j$ 列的物块，它底面受到的支持力在区间 $[l_{i,j},r_{i,j}]$ 中。

出题人们给出横纵方向各 $n$ 根钢丝用以给底面支持力，并把物块放置在钢丝交点处。现在你可以给这 $2n$ 根钢丝分别施加力。（注意同一根钢丝处处的力是相同的）

规定：在数值上，物块受到的支持力就是你施加给其下的两根钢丝的力的和。

![](https://cdn.luogu.com.cn/upload/image_hosting/shg5p17w.png)

如图，有两组钢丝一组横着放，施加给它们的力分别是：$[x_1,x_2,\dots,x_n]$；一组竖着放，施加给它们的力分别是：$[y_1,y_2,\dots,y_n]$，交点 $(i,j)$ 处的合力即为：$x_i+y_j$。

请你求出每根钢丝的使用力的情况。出题人们为了难倒 Comentropy，还要求序列 $[x_1,x_2,\dots,x_n,y_1,y_2\dots,y_n]$ 的字典序最小。你能帮他处理这个问题吗？

**每个力都应当是非负整数，方向向上。**

**形式化地**：
给出两个 $n\times n$ 的矩阵 $l,r$，要求 $l_{i,j}\leq x_i+y_j \leq r_{i,j}$，求一个字典序最小的非负整数解的序列 $\{x\}$, $\{y\}$（把 $x$ 和 $y$ 的序列并起来 $[x_1,x_2,\dots,x_n,y_1,y_2,\dots,y_n]$ 的字典序最小）。
## 输入格式

第一行，一个正整数 $n(1\leq n \leq 500)$ 表示这是一个 $n \times n$ 的矩阵。

第 $2$ 到 $n+1$ 行，一个矩阵表示受力下界 $l$。

第 $n+2$ 到第 $2n+1$ 行，又一个矩阵表示受力上界 $r$。
## 输出格式

如果无解，直接输出 ```-1```。

否则：

第一行 $n$ 个数，表示横排钢丝的受力 $x_1,...,x_n$。

第二行 $n$ 个数，表示竖排钢丝的受力 $y_1,...,y_n$。

**注意如有多组答案，请输出字典序最小的一组。**
## 样例

### 样例输入 #1
```
2
2 4
1 5
3 5
2 7
```
### 样例输出 #1
```
0 0 
2 5
```
## 提示

**样例 1 解释：** 可能有另一组解 $x_1=2,x_2=2,y_1=0,y_2=3$，但是 $\{0,0\},\{2,5\}$ 是一组字典序更小的解，且能证明字典序最小。

对于 $10\%$ 的数据，保证 $1\leq n\leq 7,0 \leq r_{i,j}\leq 7$。

对于 $20\%$ 的数据，保证 $1\leq n\leq 50$，$1 \leq l_{i,j}\leq r_{i,j} \leq 200$。

对于 $40\%$ 的数据，保证 $1\leq n\leq 200$。

对于另外 $20\%$ 的数据，保证 $l_{i,j}=r_{i,j}$。

对于 $100\%$ 的数据，保证 $1\leq n\leq 500$，$0 \leq l_{i,j} \leq r_{i,j} \leq 10^9$。

**请注意常数给程序带来的运行效率影响。**


---

---
title: "无聊的数列"
layout: "post"
diff: 普及+/提高
pid: P1438
tag: ['线段树', '树状数组', '递归', '洛谷原创', '差分']
---
# 无聊的数列
## 题目背景

无聊的 YYB 总喜欢搞出一些正常人无法搞出的东西。有一天，无聊的 YYB 想出了一道无聊的题：无聊的数列。。。
## 题目描述

维护一个数列 $a_i$，支持两种操作：

 - `1 l r K D`：给出一个长度等于 $r-l+1$ 的等差数列，首项为 $K$，公差为 $D$，并将它对应加到 $[l,r]$ 范围中的每一个数上。即：令 $a_l=a_l+K,a_{l+1}=a_{l+1}+K+D\ldots a_r=a_r+K+(r-l) \times D$。

 - `2 p`：询问序列的第 $p$ 个数的值 $a_p$。
## 输入格式

第一行两个整数数 $n,m$ 表示数列长度和操作个数。

第二行 $n$ 个整数，第 $i$ 个数表示 $a_i$。

接下来的 $m$ 行，每行先输入一个整数 $opt$。

若 $opt=1$ 则再输入四个整数 $l\ r\ K\ D$；

若 $opt=2$ 则再输入一个整数 $p$。

## 输出格式

对于每个询问，一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 2
1 2 3 4 5
1 2 4 1 2
2 3

```
### 样例输出 #1
```
6
```
## 提示

#### 数据规模与约定

对于 $100\%$ 数据，$0\le n,m \le 10^5,-200\le a_i,K,D\le 200, 1 \leq l \leq r \leq n, 1 \leq p \leq n$。


---

---
title: "小 K 的农场"
layout: "post"
diff: 普及+/提高
pid: P1993
tag: ['图论', '广度优先搜索 BFS', '差分约束']
---
# 小 K 的农场
## 题目描述

小 K 在 MC 里面建立很多很多的农场，总共 $n$ 个，以至于他自己都忘记了每个农场中种植作物的具体数量了，他只记得一些含糊的信息（共 $m$ 个），以下列三种形式描述：  
- 农场 $a$ 比农场 $b$ 至少多种植了 $c$ 个单位的作物；
- 农场 $a$ 比农场 $b$ 至多多种植了 $c$ 个单位的作物；
- 农场 $a$ 与农场 $b$ 种植的作物数一样多。  

但是，由于小 K 的记忆有些偏差，所以他想要知道存不存在一种情况，使得农场的种植作物数量与他记忆中的所有信息吻合。  

## 输入格式

第一行包括两个整数 $n$ 和 $m$，分别表示农场数目和小 K 记忆中的信息数目。  

接下来 $m$ 行：  
- 如果每行的第一个数是 $1$，接下来有三个整数 $a,b,c$，表示农场 $a$ 比农场 $b$ 至少多种植了 $c$ 个单位的作物；  
- 如果每行的第一个数是 $2$，接下来有三个整数 $a,b,c$，表示农场 $a$ 比农场 $b$ 至多多种植了 $c$ 个单位的作物;  
- 如果每行的第一个数是 $3$，接下来有两个整数 $a,b$，表示农场 $a$ 种植的的数量和 $b$ 一样多。  
## 输出格式

如果存在某种情况与小 K 的记忆吻合，输出 `Yes`，否则输出 `No`。  
## 样例

### 样例输入 #1
```
3 3
3 1 2
1 1 3 1
2 2 3 2

```
### 样例输出 #1
```
Yes

```
## 提示

对于 $100\%$ 的数据，保证 $1 \le n,m,a,b,c \le 5 \times 10^3$。


---

---
title: "[HNOI2005] 狡猾的商人"
layout: "post"
diff: 普及+/提高
pid: P2294
tag: ['2005', '并查集', '各省省选', '湖南', '差分约束', '前缀和']
---
# [HNOI2005] 狡猾的商人
## 题目描述

刁姹接到一个任务，为税务部门调查一位商人的账本，看看账本是不是伪造的。账本上记录了 $n$ 个月以来的收入情况，其中第 $i$ 个月的收入额为 $a_i$，$i=1,2,\ldots,n-1,n$。当 $a_i>0$ 时表示这个月盈利 $a_i$ 元，当 $a_i<0$ 时表示这个月亏损 $|a_i|$ 元。所谓一段时间内的总收入，就是这段时间内每个月的收入额的总和。

刁姹的任务是秘密进行的，为了调查商人的账本，她只好跑到商人那里打工。她趁商人不在时去偷看账本，可是她无法将账本偷出来，每次偷看账本时她都只能看某段时间内账本上记录的收入情况，并且她只能记住这段时间内的总收入。

现在，姹总共偷看了 $m$ 次账本，当然也就记住了 $m$ 段时间内的总收入，你的任务是根据记住的这些信息来判断账本是不是假的。

## 输入格式

第一行为一个正整数 $w$，其中 $w<100$，表示有 $w$ 组数据，即 $w$ 个账本，需要你判断。

每组数据的第一行为两个正整数 $n$ 和 $m$，其中 $n<100,m<1000$，分别表示对应的账本记录了多少个月的收入情况以及偷看了多少次账本。

接下来的 $m$ 行表示刁姹偷看 $m$ 次账本后记住的 $m$ 条信息，每条信息占一行，有三个整数 $s,t$ 和 $v$，表示从第 $s$ 个月到第 $t$ 个月（包含第 $t$ 个月）的总收入为 $v$，这里假设 $s$ 总是小于等于 $t$。

## 输出格式

包含 $w$ 行，每行是 `true` 或 `false`，其中第 $i$ 行为 `true` 当且仅当第 $i$ 组数据，即第 $i$ 个账本不是假的；第 $i$ 行为 `false` 当且仅当第 $i$ 组数据，即第 $i$ 个账本是假的。

## 样例

### 样例输入 #1
```
2
3 3
1 2 10
1 3 -5
3 3 -15
5 3
1 5 100
3 5 50
1 2 51

```
### 样例输出 #1
```
true
false

```


---

---
title: "[USACO15DEC] Max Flow P"
layout: "post"
diff: 普及+/提高
pid: P3128
tag: ['2015', 'USACO', '最近公共祖先 LCA', '树链剖分', '差分']
---
# [USACO15DEC] Max Flow P
## 题目描述

Farmer John has installed a new system of $N-1$ pipes to transport milk between the $N$ stalls in his barn ($2 \leq N \leq 50,000$), conveniently numbered $1 \ldots N$. Each pipe connects a pair of stalls, and all stalls are connected to each-other via paths of pipes.

FJ is pumping milk between $K$ pairs of stalls ($1 \leq K \leq 100,000$). For the $i$th such pair,  you are told two stalls $s_i$ and $t_i$, endpoints of a path along which milk is being pumped at a unit rate. FJ is concerned that some stalls might end up overwhelmed with all the milk being pumped through them, since a stall can serve as a waypoint along many of the $K$ paths along which milk is being pumped. Please help him determine the maximum amount of milk being pumped through any stall. If milk is being pumped along a path from $s_i$ to $t_i$, then it counts as being pumped through the endpoint stalls $s_i$ and $t_i$, as well as through every stall along the path between them.
## 输入格式

The first line of the input contains $N$ and $K$.

The next $N-1$ lines each contain two integers $x$ and $y$ ($x \ne y$) describing a pipe between stalls $x$ and $y$.

The next $K$ lines each contain two integers $s$ and $t$ describing the endpoint stalls of a path through which milk is being pumped.

## 输出格式

An integer specifying the maximum amount of milk pumped through any stall in the barn.
## 样例

### 样例输入 #1
```
5 10
3 4
1 5
4 2
5 4
5 4
5 4
3 5
4 3
4 3
1 3
3 5
5 4
1 5
3 4
```
### 样例输出 #1
```
9
```
## 提示

$2 \le N \le 5 \times 10^4,1 \le K \le 10^5$
## 题目翻译

### 题目描述

Farmer John 在他的谷仓中安装了 $N-1$ 条管道，用于在 $N$ 个牛棚之间运输牛奶（$2 \leq N \leq 50,000$），牛棚方便地编号为 $1 \ldots N$。每条管道连接一对牛棚，所有牛棚通过这些管道相互连接。

FJ 正在 $K$ 对牛棚之间泵送牛奶（$1 \leq K \leq 100,000$）。对于第 $i$ 对牛棚，你被告知两个牛棚 $s_i$ 和 $t_i$，这是牛奶以单位速率泵送的路径的端点。FJ 担心某些牛棚可能会因为过多的牛奶通过它们而不堪重负，因为一个牛棚可能会作为许多泵送路径的中转站。请帮助他确定通过任何一个牛棚的最大牛奶量。如果牛奶沿着从 $s_i$ 到 $t_i$ 的路径泵送，那么它将被计入端点牛棚 $s_i$ 和 $t_i$，以及它们之间路径上的所有牛棚。

### 输入格式

输入的第一行包含 $N$ 和 $K$。

接下来的 $N-1$ 行每行包含两个整数 $x$ 和 $y$（$x \ne y$），描述连接牛棚 $x$ 和 $y$ 的管道。

接下来的 $K$ 行每行包含两个整数 $s$ 和 $t$，描述牛奶泵送路径的端点牛棚。

### 输出格式

输出一个整数，表示通过谷仓中任何一个牛棚的最大牛奶量。

### 说明/提示

$2 \le N \le 5 \times 10^4,1 \le K \le 10^5$。


---

---
title: "[JLOI2014] 松鼠的新家"
layout: "post"
diff: 普及+/提高
pid: P3258
tag: ['2014', '线段树', '吉林', '最近公共祖先 LCA', '树链剖分', '差分']
---
# [JLOI2014] 松鼠的新家
## 题目描述

松鼠的新家是一棵树，前几天刚刚装修了新家，新家有$n$ 个房间，并且有 $n-1$ 根树枝连接，每个房间都可以相互到达，且俩个房间之间的路线都是唯一的。天哪，他居然真的住在“树”上。

松鼠想邀请小熊维尼前来参观，并且还指定一份参观指南，他希望维尼能够按照他的指南顺序，先去 $a_1$，再去 $a_2$，……，最后到 $a_n$，去参观新家。可是这样会导致重复走很多房间，懒惰的维尼不停地推辞。可是松鼠告诉他，每走到一个房间，他就可以从房间拿一块糖果吃。

维尼是个馋家伙，立马就答应了。现在松鼠希望知道为了保证维尼有糖果吃，他需要在每一个房间各放至少多少个糖果。

因为松鼠参观指南上的最后一个房间 $a_n$ 是餐厅，餐厅里他准备了丰盛的大餐，所以当维尼在参观的最后到达餐厅时就不需要再拿糖果吃了。
## 输入格式

第一行一个正整数 $n$，表示房间个数第二行 $n$ 个正整数，依次描述 $a_1, a_2,\cdots,a_n$。

接下来 $n-1$ 行，每行两个正整数 $x,y$，表示标号 $x$ 和 $y$ 的两个房间之间有树枝相连。
## 输出格式

一共 $n$ 行，第 $i$ 行输出标号为 $i$ 的房间至少需要放多少个糖果，才能让维尼有糖果吃。
## 样例

### 样例输入 #1
```
5
1 4 5 3 2
1 2
2 4
2 3
4 5
```
### 样例输出 #1
```
1
2
1
2
1
```
## 提示

对于全部的数据，$2 \le n \le 3 \times 10^5$，$1 \le a_i \le n$。


---

---
title: "三步必杀"
layout: "post"
diff: 普及+/提高
pid: P4231
tag: ['前缀和', '差分']
---
# 三步必杀
## 题目背景

### （三）旧都

离开狭窄的洞穴，眼前豁然开朗。

天空飘着不寻常的雪花。

一反之前的幽闭，现在面对的，是繁华的街市，可以听见酒碗碰撞的声音。

这是由被人们厌恶的鬼族和其他妖怪们组成的小社会，一片其乐融融的景象。

诶，不远处突然出现了一些密密麻麻的小点，好像大颗粒扬尘一样。

离得近了点，终于看清楚了。

长着角的鬼们聚在一起，围观着另一只鬼的表演。

那”扬尘”，其实都是弹幕。

勇仪的招数之一，三步之内，所到之处弹幕云集，几乎没有生存可能。

为了强化这一技能，勇仪将对着一排柱子进行攻击。

旧地狱的柱子虽然无比坚固，但保险起见还是先要了解一下这样一套攻击对柱子有多少损伤，顺带也能检验练习的效果。

勇仪决定和其它鬼们商量商量...

“我知道妖怪之山的河童一族有一种叫做计算机的神奇道具，说不定可以借来用用”，萃香说道。

于是旧地狱的鬼族就决定请河城荷取来帮忙了。

“要记录【所有柱子的损伤程度】吗”，荷取问道。

经过进一步的询问，荷取发现他们仅仅需要【所有攻击都完成后】柱子的损伤程度。

任务了解地差不多了，荷取将其中的重要部分提取了出来，记录在了她的工作笔记本上：

(记录的内容见题目描述)

那么实验就这样开始了。

在惊天动地的碰撞声中，勇仪每完成一轮攻击，荷取都忠实地记录下对每根柱子产生的伤害。而此时勇仪就在旁边等待着记录完成，然后再进行下一轮的攻击。

地面上，天色渐晚。

“不想在这里留到深夜啊，不然就回不了家了”，荷取这样想着，手中依然在重复地向计算机中输入新产生的信息。

“真的必须一次一次地记录下每轮攻击对每个柱子产生的伤害吗？有没有更高效的方法？”这一念头在荷取的心中闪过...

（后续剧情在题解中，接下来请看T3）

## 题目描述

### 问题摘要：

$N$个柱子排成一排，一开始每个柱子损伤度为0。

接下来勇仪会进行$M$次攻击，每次攻击可以用4个参数$l$,$r$,$s$,$e$来描述：

表示这次攻击作用范围为第$l$个到第$r$个之间所有的柱子(包含$l$,$r$)，对第一个柱子的伤害为$s$，对最后一个柱子的伤害为$e$。

攻击产生的伤害值是一个等差数列。若$l=1$,$r=5$,$s=2$,$e=10$，则对第1~5个柱子分别产生2,4,6,8,10的伤害。

鬼族们需要的是所有攻击完成之后每个柱子的损伤度。
## 输入格式

第一行2个整数$N$,$M$，用空格隔开，下同。

接下来$M$行，每行4个整数$l$,$r$,$s$,$e$，含义见题目描述。

数据保证对每个柱子产生的每次伤害值都是整数。

## 输出格式

由于输出数据可能过大无法全部输出，为了确保你真的能维护所有柱子的损伤度，只要输出它们的异或和与最大值即可。

（异或和就是所有数字按位异或起来的值）

（异或运算符在c++里为^）
## 样例

### 样例输入 #1
```
5 2
1 5 2 10
2 4 1 1

```
### 样例输出 #1
```
3 10
```
### 样例输入 #2
```
6 2
1 5 2 10
2 4 1 1
```
### 样例输出 #2
```
3 10
```
## 提示

### 样例解释：

样例1：

第一次攻击产生的伤害:2 4 6 8 10

第二次攻击产生的伤害:0 1 1 1 0

所有攻击结束后每个柱子的损伤程度:2 5 7 9 10。

输出异或和与最大值，就是3 10。

样例2：

没有打到第六根柱子，答案不变

### 数据范围：

本题满分为100分，下面是4个子任务。(x/y)表示(得分/测试点数量)

妖精级(18/3):$1\leqslant n$,$m\leqslant1000$。这种工作即使像妖精一样玩玩闹闹也能完成吧？

河童级(10/1):$s=e$,这可以代替我工作吗？

天狗级(20/4):$1\leqslant n\leqslant10^5$,$1\leqslant m\leqslant10^5$。小打小闹不再可行了呢。

鬼神级(52/2):没有特殊限制。要真正开始思考了。

以上四部分数据不相交。

对于全部的数据:$1\leqslant n\leqslant10^7$,$1\leqslant m\leqslant3\times 10^5$，$1\leqslant l<r\leqslant n$.

所有输入输出数据以及柱子受损伤程度始终在$[0,9\times 10^{18}]$范围内。

### 提示：

由于种种原因，时间限制可能会比较紧，C++选手请不要使用cin读入数据。


by orangebird


---

---
title: "[Poetize6] IncDec Sequence"
layout: "post"
diff: 普及+/提高
pid: P4552
tag: ['差分']
---
# [Poetize6] IncDec Sequence
## 题目描述

给定一个长度为 $n$ 的数列 ${a_1,a_2,\cdots,a_n}$，每次可以选择一个区间$[l,r]$，使这个区间内的数都加 $1$ 或者都减 $1$。 
  
请问至少需要多少次操作才能使数列中的所有数都一样，并求出在保证最少次数的前提下，最终得到的数列有多少种。
## 输入格式

第一行一个正整数 $n$   
接下来 $n$ 行,每行一个整数,第 $i+1 $行的整数表示 $a_i$。
## 输出格式

第一行输出最少操作次数   
第二行输出最终能得到多少种结果

## 样例

### 样例输入 #1
```
4
1
1
2
2
```
### 样例输出 #1
```
1
2
```
## 提示

对于 $100\%$ 的数据，$n\le 100000, 0 \le a_i \le 2^{31}$。


---

---
title: "[COCI 2012/2013 #6] BUREK"
layout: "post"
diff: 普及+/提高
pid: P4623
tag: ['2012', '前缀和', '差分', 'COCI（克罗地亚）']
---
# [COCI 2012/2013 #6] BUREK
## 题目背景

COCI
## 题目描述

给定 $N$ 个三角形，和 $M$ 条直线，直线要么平行于 $x$ 轴，要么平行于 $y$ 轴，问这 $M$ 条直线分别穿过多少个三角形。

**（一条直线穿过一个三角形，当且仅当这条直线可以将这个三角形分成两个面积均大于零的多边形）。**
## 输入格式

输入的第一行包含一个正整数 $N$，表示三角形的个数。

接下来 $N$ 行，每行三个坐标 $(x_1,y_1)$，$(x_2,y_2)$，$(x_3,y_3)$ 表示三个点，且这三点不共线，描述一个三角形。所有坐标均为非负整数，三角形可以重叠。

接下来一行包含一个正整数 $M$，表示直线的条数。

接下来 $M$ 行，每行一个字符串 `x = c` 或 `y = c`（注意等号两边的空格），描述一条直线。其中 `c` 为非负整数。
## 输出格式

对于每一条直线输出一个整数，表示它穿过的三角形的个数。
## 样例

### 样例输入 #1
```
3
1 0 0 2 2 2
1 3 3 5 4 0
5 4 4 5 4 4
4
x = 4
x = 1
y = 3
y = 1
```
### 样例输出 #1
```
0
1
1
2
```
### 样例输入 #2
```
4
2 7 6 0 0 5
7 1 7 10 11 11
5 10 2 9 6 8
1 9 10 10 4 1
4
y = 6
x = 2
x = 4
x = 9
```
### 样例输出 #2
```
3
2
3
2
```
## 提示

**【数据范围】**

对于 $40 \%$ 的数据，$M \le 300$；

另有 $40 \%$ 的数据，所有三角形的坐标 $< 1000$；

对于 $100 \%$ 的数据，$2 \le N,M \le 10^5$，$0 \le x_1,y_1,x_2,y_2,x_3,y_3 < 10^6$。


---

---
title: "Preprefix sum"
layout: "post"
diff: 普及+/提高
pid: P4868
tag: ['树状数组', '前缀和', '差分']
---
# Preprefix sum
## 题目描述

前缀和（prefix sum）$S_i=\sum_{k=1}^i a_k$。

前前缀和（preprefix sum）则把 $S_i$ 作为原序列再进行前缀和。记再次求得前缀和第 $i$ 个是 $SS_i$。

给一个长度 $n$ 的序列 $a_1, a_2, \cdots, a_n$，有两种操作：

1. `Modify i x`：把 $a_i$ 改成 $x$。
2. `Query i`：查询 $SS_i$。

## 输入格式

第一行给出两个整数 $N,M$。分别表示序列长度和操作个数。  
接下来一行有 $N$ 个数，即给定的序列 $a_1,a_2,\cdots,a_n$。  
接下来 $M$ 行，每行对应一个操作，格式见题目描述。  
## 输出格式

对于每个询问操作，输出一行，表示所询问的 $SS_i$ 的值。
## 样例

### 样例输入 #1
```
5 3
1 2 3 4 5
Query 5
Modify 3 2
Query 5
```
### 样例输出 #1
```
35
32
```
## 提示

$1\le N,M\le 10^5$，且在任意时刻 $0\le A_i\le 10^5$。


---

---
title: "[USACO05DEC] Layout G"
layout: "post"
diff: 普及+/提高
pid: P4878
tag: ['2005', 'USACO', '最短路', '差分约束', '差分']
---
# [USACO05DEC] Layout G
## 题目背景

14组数据，前10组为原数据，后4组为hack数据
## 题目描述

Like everyone else, cows like to stand close to their friends when queuing for feed. FJ has N (2 <= N <= 1,000) cows numbered 1..N standing along a straight line waiting for feed. The cows are standing in the same order as they are numbered, and since they can be rather pushy, it is possible that two or more cows can line up at exactly the same location (that is, if we think of each cow as being located at some coordinate on a number line, then it is possible for two or more cows to share the same coordinate). 

Some cows like each other and want to be within a certain distance of each other in line. Some really dislike each other and want to be separated by at least a certain distance. A list of ML (1 <= ML <= 10,000) constraints describes which cows like each other and the maximum distance by which they may be separated; a subsequent list of MD constraints (1 <= MD <= 10,000) tells which cows dislike each other and the minimum distance by which they must be separated. 

Your job is to compute, if possible, the maximum possible distance between cow 1 and cow N that satisfies the distance constraints.
## 输入格式

Line 1: Three space-separated integers: N, ML, and MD. 

Lines 2..ML+1: Each line contains three space-separated positive integers: A, B, and D, with 1 <= A < B <= N. Cows A and B must be at most D (1 <= D <= 1,000,000) apart. 

Lines ML+2..ML+MD+1: Each line contains three space-separated positive integers: A, B, and D, with 1 <= A < B <= N. Cows A and B must be at least D (1 <= D <= 1,000,000) apart.
## 输出格式

Line 1: A single integer. If no line-up is possible, output -1. If cows 1 and N can be arbitrarily far apart, output -2. Otherwise output the greatest possible distance between cows 1 and N.

## 样例

### 样例输入 #1
```
4 2 1
1 3 10
2 4 20
2 3 3
```
### 样例输出 #1
```
27
```
## 提示

Explanation of the sample: 

There are 4 cows. Cows #1 and #3 must be no more than 10 units apart, cows #2 and #4 must be no more than 20 units apart, and cows #2 and #3 dislike each other and must be no fewer than 3 units apart. 

The best layout, in terms of coordinates on a number line, is to put cow #1 at 0, cow #2 at 7, cow #3 at 10, and cow #4 at 27.
## 题目翻译

正如其他物种一样，奶牛们也喜欢在排队打饭时与它们的朋友挨在一起。FJ 有编号为 $1\dots N$ 的 $N$ 头奶牛 $(2\le N\le 1000)$。开始时，奶牛们按照编号顺序来排队。奶牛们很笨拙，因此可能有多头奶牛在同一位置上。

有些奶牛是好基友，它们希望彼此之间的距离小于等于某个数。有些奶牛是情敌，它们希望彼此之间的距离大于等于某个数。

给出 $M_L$ 对好基友的编号，以及它们希望彼此之间的距离小于等于多少；又给出 $M_D$ 对情敌的编号，以及它们希望彼此之间的距离大于等于多少 $(1\le M_L,$ $M_D\le 10^4)$。

请计算：如果满足上述所有条件，$1$ 号奶牛和 $N$ 号奶牛之间的距离最大为多少。

## 输入输出格式

### 输入格式

第一行：三个整数 $N, M_L, M_D$，用空格分隔。

第 $2\dots M_L+1$ 行：每行三个整数 $A, B, D$，用空格分隔，表示 $A$ 号奶牛与 $B$ 号奶牛之间的距离须 $\le D$。保证 $1\le A<B\le N,$ $1\le D\le 10^6$. 

第 $M_L+2\dots M_L+M_D+1$ 行：每行三个整数 $A, B, D$，用空格分隔，表示 $A$ 号奶牛与 $B$ 号奶牛之间的距离须 $\ge D$。保证 $1\le A<B\le N,$ $1\le D\le 10^6$. 

### 输出格式

一行，一个整数。如果没有合法方案，输出 `-1`. 如果有合法方案，但 $1$ 号奶牛可以与 $N$ 号奶牛相距无穷远，输出 `-2`. 否则，输出 $1$ 号奶牛与 $N$ 号奶牛间的最大距离。


---

---
title: "Agent2"
layout: "post"
diff: 普及+/提高
pid: P4939
tag: ['树状数组', 'O2优化', '差分']
---
# Agent2
## 题目背景

炎炎夏日还没有过去，`Agent`们没有一个想出去外面搞事情的。每当`ENLIGHTENED总部`组织活动时，人人都说有空，结果到了活动日，却一个接着一个`咕咕咕`了。只有不咕鸟`Lyn_king`一个人冒着太阳等了半个多小时，然后居然看到连`ENLIGHTENED行动参谋`都`咕咕咕`了，果然`咕咕咕`是人类的本性啊。
## 题目描述

作为一个`ENLIGHTENED行动指挥`，自然不想看到这一点，于是他偷取到了那些经常`咕咕咕`的`Agent`的在下来$N$天的`活动安排表`，并且叫上了你来整理。在整理过程中，`ENLIGHTENED行动指挥`对你说了$M$条命令，命令操作如下。
1. 输入$0,a,b$，这代表在第$a$天到第$b$天，有一名`Agent`要咕咕咕。
2. 输入$1$ $a$，这代表`ENLIGHTENED行动指挥`询问你根据目前的信息，在第$a$天有多少名`Agent`会咕咕咕。

作为同是不咕鸟的你，也想要惩戒那些经常`咕咕咕`的人，所以，请协助完成`ENLIGHTENED行动指挥`完成整理，并且在他每次询问时，输出正确的答案。
## 输入格式

第一行输入两个整数输$N,M$，
下来$M$行,每行输入一个命令，命令格式见题目描述。
## 输出格式

对于每一次询问的操作，都要输出询问的答案。答案之间用换行隔开。
## 样例

### 样例输入 #1
```
5 5
0 1 2
0 1 5
1 1
0 3 5
1 5
```
### 样例输出 #1
```
2
2
```
## 提示

对于$20\%$的数据 $N,M \leq 10$

对于$40\%$的数据 $N,M \leq 10^3$

对于$60\%$的数据 $N,M \leq 10^5$

对于$100\%$的数据 $1 \leq a,b \leq N \leq 10^7,M \leq 4*10^5$


---

---
title: "Lycanthropy"
layout: "post"
diff: 普及+/提高
pid: P5026
tag: ['线段树', '差分']
---
# Lycanthropy
## 题目背景

小正方形亲眼看见了自己昔日的朋友被卷进了黑暗的深渊，然而它无力阻止……

现在它的朋友已经向它发起了攻击，因此小正方形不得不抵抗。
## 题目描述

我们把山顶上的湖泊看作一条长度为 $m$ 的直线，一开始水深都在水平线上，我们视作此时的水深为 '0'

接下来，在一瞬间，小正方形的"朋友"们跳起并扎入水中，导致在入水点的水降低而远离入水点的水升高，注意两个 "朋友" 可能在同一地点入水。

小正方形的每个朋友有一个体积数值 $v$，当体积为 $v$ 的一个朋友跳入水中，我们设入水点为 $i$，将会导致 $i - v + 1$ 到 $i$ 的水位依次降低 $1,2,\cdots,v$

同样地，第 $i$ 到 $i + v - 1$ 的水位会依次降低 $v,v - 1,\cdots,1$.

相对应地，$i - v$ 的水位不变， $i - v - 1$ 到 $i - 2 * v$ 水位依次增加 $1,2,\cdots,v$， $i - 2 * v$ 到 $i - 3 * v + 1$ 水位依次增加 $v,v - 1,\cdots,1$

同样，$i + v$ 水位不变，$i + v + 1$ 到 $i + 2 * v$ 水位增加 $1,2,\cdots,v$，$i + 2 * v$ 到 $i + 3 * v - 1$ 水位依次增加 $v,v - 1,\cdots,1$

现在小正方形想要穿过这个湖，他想要知道在这 $n$ 个"朋友"跳入水中后湖上每个节点的水位，你能帮帮它吗？
## 输入格式

第一行为两个整数 $n$,$m$，表示"朋友"的数目与湖泊的宽度。

接下来 $n$ 行，一行两个整数 $v,x$，表示第 $i + 1$ 个朋友的体积与入水点。
## 输出格式

一行 $m$ 个整数，第 $i$ 个整数表示 $i$ 号位的水深。
## 样例

### 样例输入 #1
```
1 10
1 5
```
### 样例输出 #1
```
0 0 1 0 -1 0 1 0 0 0 
```
### 样例输入 #2
```
2 10
2 6
3 1
```
### 样例输出 #2
```
-2 0 0 0 0 0 2 2 2 2
```
## 提示

对于 $30\%$ 的数据，$n <= 50,m <= 500$

对于 $70\%$ 的数据，$n <= 10^5,m <= 10^5$

对于 $100\%$ 的数据，$n <= 10^6,m <= 10^6,1 <= v <= 10000,1 <= x <= m$


---

---
title: "【模板】差分约束"
layout: "post"
diff: 普及+/提高
pid: P5960
tag: ['Special Judge', '差分约束']
---
# 【模板】差分约束
## 题目描述

给出一组包含 $m$ 个不等式，有 $n$ 个未知数的形如：

$$ \begin{cases} x_{c_1}-x_{c'_1}\leq y_1 \\x_{c_2}-x_{c'_2} \leq y_2 \\ \cdots\\ x_{c_m} - x_{c'_m}\leq y_m\end{cases}$$

的不等式组，求任意一组满足这个不等式组的解。
## 输入格式

第一行为两个正整数 $n,m$，代表未知数的数量和不等式的数量。

接下来 $m$ 行，每行包含三个整数 $c,c',y$，代表一个不等式 $x_c-x_{c'}\leq y$。
## 输出格式

一行，$n$ 个数，表示 $x_1 , x_2 \cdots x_n$ 的一组可行解，如果有多组解，请输出任意一组，无解请输出 `NO`。
## 样例

### 样例输入 #1
```
3 3
1 2 3
2 3 -2
1 3 1
```
### 样例输出 #1
```
5 3 5
```
## 提示

**样例解释**

$\begin{cases}x_1-x_2\leq 3 \\ x_2 - x_3 \leq -2 \\ x_1 - x_3 \leq 1 \end{cases}$

一种可行的方法是 $x_1 = 5, x_2 = 3, x_3 = 5$。

$\begin{cases}5-3  = 2\leq 3 \\ 3 - 5 = -2 \leq -2 \\ 5 - 5  = 0\leq 1 \end{cases}$

**数据范围**

对于 $100\%$ 的数据，$1\leq n,m \leq 5\times 10^3$，$-10^4\leq y\leq 10^4$，$1\leq c,c'\leq n$，$c \neq c'$。

**评分策略**

你的答案符合该不等式组即可得分，请确保你的答案中的数据在 `int` 范围内。

如果并没有答案，而你的程序给出了答案，SPJ 会给出 `There is no answer, but you gave it`，结果为 WA；    
如果并没有答案，而你的程序输出了 `NO`，SPJ 会给出 `No answer`，结果为 AC；       
如果存在答案，而你的答案错误，SPJ 会给出 `Wrong answer`，结果为 WA；    
如果存在答案，且你的答案正确，SPJ 会给出 `The answer is correct`，结果为 AC。


---

---
title: "『MdOI R1』Decrease"
layout: "post"
diff: 普及+/提高
pid: P6070
tag: ['模拟', 'O2优化', '差分']
---
# 『MdOI R1』Decrease
## 题目描述

给定一个 $n \times n$ 的矩阵，你可以进行若干次操作。

每次操作，你可以将一个 $k \times k$ 的 **连续** 子矩阵里的所有数全都加上 $1$ 或者全都减去 $1$。

初始时，矩阵中有 $m$ 个位置上的数不为 $0$，其它位置上的数均为 $0$。

请你求出至少需要多少次操作，可以将矩形中所有数都变为 $0$。
## 输入格式

第一行三个整数 $n,m,k$，分别表示矩阵大小，非 $0$ 格数和每次修改的连续子矩阵大小。

接下来 $m$ 行，每行三个整数 $x,y,z$，表示初始时矩阵的第 $x$ 行第 $y$ 列上的数为 $z$。


## 输出格式

一行一个整数，表示最少操作次数。

特别地，如果无法使矩阵中所有数都变为 $0$，输出 `-1`。  
## 样例

### 样例输入 #1
```
4 14 3
1 1 1
1 2 1
1 3 1
2 1 1
2 2 3
2 3 3
2 4 2
3 1 1
3 2 3
3 3 3
3 4 2
4 2 2
4 3 2
4 4 2

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
3 1 2
1 1 1

```
### 样例输出 #2
```
-1

```
### 样例输入 #3
```
4 5 1
1 1 5
2 2 -3
2 3 -4
3 3 1
4 4 2

```
### 样例输出 #3
```
15

```
## 提示

【样例 1 解释】:  

给出的矩阵为：  

```plain
1 1 1 0
1 3 3 2
1 3 3 2
0 2 2 2
```

具体步骤：  

先将以第一行第一列为左上角的连续子矩阵执行 **减 1 操作** 一次；

再将以第二行第二列为左上角的连续子矩阵执行 **减 1 操作** 两次。

总共三次。

```plain
1 1 1 0  0 0 0 0  0 0 0 0  0 0 0 0
1 3 3 2  0 2 2 2  0 1 1 1  0 0 0 0
1 3 3 2  0 2 2 2  0 1 1 1  0 0 0 0
0 2 2 2  0 2 2 2  0 1 1 1  0 0 0 0
```

【样例 2 解释】：  

给出的矩阵为：  

```plain
1 0 0
0 0 0
0 0 0
```

只通过 $2\times 2$ 的连续子矩阵操作不可能使得所有格子上的数都变为 $0$。

【数据范围】   

**本题采用捆绑测试。**

| 子任务编号 |    $n\leq$     | $k\leq$ | 分值 |
| :--------: | :------------: | :-----: | :--: |
|     1      |     $10^3$     |   $1$   |  11  |
|     2      |      $20$      |  $20$   |  14  |
|     3      |     $100$      |  $100$  |  17  |
|     4      |     $10^3$     | $10^3$  |  34  |
|     5      | $5\times 10^3$ | $10^3$  |  24  |

对于所有数据，$1\leq n\leq 5\times 10^3$，$1\leq m\leq \min(n^2,5\times 10^5)$，$1\leq k\leq \min(n,10^3)$，$1\leq x,y\leq n$，每对 $(x,y)$ 至多出现一次，$1 \le |z| \leq 10^9$。

数据保证如果有解，答案不超过 $2^{63}-1$。

---

【提示】

本题读入量较大，建议使用较快的读入方式。  


---

---
title: "[省选联考 2020 B 卷] 幸运数字"
layout: "post"
diff: 普及+/提高
pid: P6627
tag: ['2020', '各省省选', '离散化', '差分']
---
# [省选联考 2020 B 卷] 幸运数字
## 题目描述

为庆祝疫情防治取得重大进展，某商场举行酬宾活动，给顾客一些优惠额度，规则如下：

1. 每位顾客可以任意选择一个整数作为自己的幸运数字。
2. 每位顾客的初始优惠额度为 $0$ 元。
3. 商场有 $n$ 个奖励条件，对应不同的奖励额度 $w_i$。
4. 每位顾客需要依次比对这 $n$ 个奖励条件，如果该位顾客选择的幸运数字满足第 $i$ 个条件，那么他的优惠额度就会**异或**上这个条件所对应的奖励额度。

奖励条件共有三种，假设顾客选择的幸运数字为 $x$：

1. 区间型条件，其有两个参数 $L$ 与 $R$，满足条件为 $L \le x\le R$。保证 $L < R$。
2. 相等型条件，其有一个参数 $A$，满足条件为 $x = A$。
3. 不等型条件，其有一个参数 $B$，满足条件为 $x \neq B$。

小炎同学获知了所有奖励条件的信息，他希望知道一位顾客能够得到的最大优惠额度以及对应的幸运数字是多少，请你帮他计算。

## 输入格式

第一行包含一个正整数 $n$，代表奖励条件的数量。

接下来 $n$ 行，每行三个或四个整数表示一个奖励条件。每行第一个整数 $t_i$ 代表奖励条件的类型：

1. $t_i = 1$ 则该条件是区间型条件，接下来三个整数，分别代表 $L, R, w_i$。
2. $t_i = 2$ 则该条件是相等型条件，接下来两个整数，分别代表 $A, w_i$。
3. $t_i = 3$ 则该条件是不等型条件，接下来两个整数，分别代表 $B, w_i$。

## 输出格式

输出一行两个整数，第一个数代表能够得到的最大优惠额度，第二个数代表对应的幸运数字。

如果有多个幸运数字能够得到最大优惠额度，输出绝对值最小的那个。如果还有多个，则输出值最大的。

## 样例

### 样例输入 #1
```
4
1 -100 -80 37
2 -3 3
3 4 64
1 -10 1024 156
```
### 样例输出 #1
```
223 -3
```
## 提示

**样例解释**

幸运数字 $-3$ 满足奖励条件 $2, 3, 4$，奖励额度为 $3\oplus 64\oplus 156 = 223$，其中 $\oplus$ 表
示异或运算。

**数据范围与约定**

$20\%$ 的数据满足：$n, |L|, |R|, |A|, |B| \le 1000$。  
$40\%$ 的数据满足：$n\le 1000$。  
$100\%$ 的数据满足：$1\le n\le 10^5, |L|, |R|, |A|, |B|\le 10^9, 1\le w_i\le 10^9$。



---

---
title: "「EZEC-4」可乐"
layout: "post"
diff: 普及+/提高
pid: P6824
tag: ['贪心', '字典树 Trie', '差分']
---
# 「EZEC-4」可乐
## 题目背景

很久以前，有一个 pigstd，非常迷恋美味的可乐。为了得到美味的可乐，他几乎用尽了所有的钱，他甚至对自己的 npy 也漠不关心~~其实是因为他没有npy~~，更不爱好看戏。除非买了新可乐，才会坐上马车出门炫耀一番。每一天，每个钟头他都要喝上一瓶新可乐。

pigstd 最近又买了许多箱新可乐——当然，这些可乐只有聪明的人才能喝到。
## 题目描述

pigstd 现在有 $n$ 箱可乐，第 $i$ 箱可乐上标着一个正整数 $a_{i}$。

若 pigstd 的聪明值为一个非负整数 $x$，对于第 $i$ 箱可乐，如果 $(a_{i} \oplus x )\le k$，那么 pigstd 就能喝到这箱可乐。

现在 pigstd 告诉了你 $k$ 与序列 $a$，你可以决定 pigstd 的聪明值 $x$，使得他能喝到的可乐的箱数最大。求出这个最大值。
## 输入格式

第一行两个由空格分隔开的整数 $n,k$。

接下来 $n$ 行，每行一个整数 $a_i$，表示第 $i$ 箱可乐上标的数。
## 输出格式

一行一个正整数，表示 pigstd 最多能喝到的可乐的箱数。
## 样例

### 样例输入 #1
```
3 5
2
3
4
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4 625
879
480
671
853

```
### 样例输出 #2
```
4
```
## 提示

### 提示

**pigstd 的聪明值 $x$ 可以为 $0$。**

### 样例解释

样例 1 解释：容易构造当 $x = 0$ 时，可以喝到所有可乐。

样例 2 解释：容易构造 $x = 913$，可以喝到所有可乐。

**样例解释未必是唯一的方法。**

### 数据范围

**本题采用捆绑测试。**

- Subtask 1（29 points）：$1 \le n,k,a_{i} \le 1000$。

- Subtask 2（1 points）：$a_{i} \le k$。

- Subtask 3（70 points）：无特殊限制。

对于所有数据，保证 $1 \le n,k,a_{i} \le 10^6$。

$\oplus$ 代表异或，如果您不知道什么是异或，请单击[这里](https://baike.baidu.com/item/%E5%BC%82%E6%88%96/10993677?fr=aladdin)。


---

---
title: "[COCI 2019/2020 #5] Putovanje"
layout: "post"
diff: 普及+/提高
pid: P6869
tag: ['2019', '差分', 'COCI（克罗地亚）']
---
# [COCI 2019/2020 #5] Putovanje
## 题目描述

给你一棵有 $n$ 个点的树，节点编号从 $1$ 到 $n$。

你会按编号从小到大顺序访问每个节点。

经过树上的边需要收费。第 $i$ 条边有单程票（只能用一次）价格 $c_{i1}$ 和多程票（珂以用无限次）价格 $c_{i2}$。你在访问途中可能会重复走一条边，所以多程票有时更划算。

请你求出从 $1$ 访问到 $n$ 最少需要多少费用。
## 输入格式

- 第一行：一个正整数 $n$。

- 接下来的 $n-1$ 行描述 $n-1$ 条边：有 $4$ 个正整数 $a_i,b_i,c_{i1},c_{i2}$，表示有一条连接 $a_i$ 和 $b_i$ 的单程票价格为 $c_{i1}$、多程票价格为 $c_{i2}$ 的边。
## 输出格式

一行一个正整数：你的答案。
## 样例

### 样例输入 #1
```
4
1 2 3 5
1 3 2 4
2 4 1 3

```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
4
1 4 5 5
3 4 4 7
2 4 2 6

```
### 样例输出 #2
```
16
```
### 样例输入 #3
```
5
1 2 2 3
1 3 2 3
1 4 2 3
1 5 2 3

```
### 样例输出 #3
```
11
```
## 提示

### 样例#1 解释

- $1\to 2$：多程票，费用 $5$。
- $2\to 1\to 3$：$2\to 1$ 使用买过的多程票，无费用；$1\to 3$ 单程票，费用 $2$。
- $3\to 1\to 2\to 4$：$3\to 1$ 单程票，费用 $2$；$1\to 2$ 使用买过的多程票，无费用；$2\to 4$ 单程票，费用 $1$。
- 费用共 $5+2+2+1=10$。

### 数据范围

**本题捆绑测试。**

- 对于 $20 pts$ 的数据，$2\leq n\leq 2000$。

- 对于另外 $25 pts$ 的数据，每个城镇最多与另外两个城镇直接相连。

- 对于所有的数据，$2\leq n\leq 200000$，$1\leq a_i,b_i\leq n$，$1\leq c_{i1}\leq c_{i2}\leq 100000$。

### 说明

**题目译自 [COCI2019-2020](https://hsin.hr/coci/archive/2019_2020/) [CONTEST #5](https://hsin.hr/coci/archive/2019_2020/contest5_tasks.pdf)  _T4 Putovanje_**。


---

---
title: "「Wdoi-4」芙兰？姆Q！贤者与谜题"
layout: "post"
diff: 普及+/提高
pid: P7871
tag: ['贪心', '2021', '洛谷原创', '差分', '洛谷月赛']
---
# 「Wdoi-4」芙兰？姆Q！贤者与谜题
## 题目背景

题目背景不包含解题的关键信息，可以跳过。

---

芙兰朵露·斯卡蕾特是曾居住在红魔馆地下室的吸血鬼。与众不同的是，芙兰朵露有着彩色结晶的特殊翅膀，与其他吸血鬼蝙蝠一般的翅膀不同：颜色各异的结晶按照顺序一字排开。

芙兰朵露翅膀的彩色结晶的颜色从内到外分别是天蓝、蓝、紫、粉、橙、黄、淡绿和天蓝。因此事实上，芙兰朵露的翅膀很可能就是帕秋莉的「贤者之石」组成的。

但是芙兰朵露并不关心这些，她只关心排列成翅膀形状的贤者之石之间发生的能量流动——如果一块贤者之石被赋予了能量，就会处于激发态。处于激发态的贤者之石很不稳定——它大量能量的爆发会波及周围的贤者之石，以造成能量的转移。

芙兰朵露非常感兴趣，并以此出了一个谜题来考考帕秋莉。但是作为贤者的帕秋莉不想思考只想摸鱼，于是任务就交给你啦！![](https://www.luogu.com.cn/paste/tkub6dq3)
## 题目描述

芙兰朵露从帕秋莉那里搞来了 $n$ 块贤者之石，并从左往右排成了一列。帕秋莉可以赋予每块贤者之石一定的能级，这会决定贤者之石之间能量的传递。值得注意的是，**能级必须要是正整数，并且不能有两块贤者之石能级相同**。

如果第 $i$ 块贤者之石被赋予了能量（处于激发态），它就会将能量传递给第 $i-1$ 和第 $i+1$ 块里**能级较小**的那一块。特别地，如果某块贤者之石周围只有一块，那么它只会向这一块发送能量。注意，即使第 $i$ 块的能级低于第 $i-1$ 和第 $i+1$ 块，它**照样可以传输能量**。

现在芙兰有 $q$ 个条件——每个条件给定两个正整数 $s,t$，表示如果芙兰激活了第 $s$ 块贤者之石的能量，那么能量最终会经过第 $t$ 块。

然而由于帕秋莉有哮喘的老毛病，设定贤者之石的能级是很费力的。因此，如果存在一种合法的赋予贤者之石能级的方案，请你找出其中**字典序最小**的那个方案。对于两种方案 $A,B$，我们称 $A$ 的字典序小于 $B$，当且仅当存在一个 $p$，使得 $\forall i<p$ 有 $A_i=B_i$，且 $A_p<B_p$。 

如果存在合法方案，请你输出字典序最小的方案；否则输出 `QED`。
## 输入格式

第一行有两个整数 $n,q$，表示贤者之石的块数和芙兰的条件个数。  
接下来 $q$ 行，每行有两个整数 $s_i,t_i$，描述一组条件。
## 输出格式

若不存在合法方案，输出 `QED`；否则输出 $n$ 个整数，表示字典序最小的那个方案。
## 样例

### 样例输入 #1
```
10 4
1 2
3 7
8 10
5 6
```
### 样例输出 #1
```
1 4 8 3 7 2 6 10 5 9
```
## 提示

输入/输出样例 $2$ 见下发的附件 $\textbf{\textit{qed2.in}/\textit{qed2.out}}$。

输入/输出样例 $3$ 见下发的附件 $\textbf{\textit{qed3.in}/\textit{qed3.out}}$。

---

### 数据范围及约定

对于 $100\%$ 的数据，$0\le q \le 3\times 10^5$，$3\le n \le 3\times 10^5$，$1\le s_i,t_i \le n$。

$$
\def{\arraystretch}{1.5}
\begin{array}{|c|c|c|c|} \hline
\textbf{测试点} & \bm{n\le} & \bm{q\le} & \textbf{特殊限制} \cr \hline
1\sim 3 & 7 & 7 & - \cr \hline
4\sim6 & 100 & 100 & - \cr \hline
7 & 10^5 & 1 & -\cr \hline
8\sim 10 & 3\times 10^5 & 3\times 10^5 & s_i\le t_i \cr \hline
11\sim 12 & 10^5 & 10 & - \cr \hline
13\sim 20 & 3\times 10^5 & 3\times 10^5 & -\cr \hline
\end{array}$$



---

---
title: "「Wdsr-3」迷途竹林"
layout: "post"
diff: 普及+/提高
pid: P8008
tag: ['计算几何', 'Special Judge', 'O2优化', '线段相交', '差分']
---
# 「Wdsr-3」迷途竹林
## 题目背景

迷途竹林是生长着高耸入云的、无边无际的竹子的竹林。由于特殊地势的缘故，所有竹子都向着一侧倾斜生长。由于竹子顶部的叶片交错在一起，因此即使竹子的下端已经被砍掉，仍然会因为其他竹子的相互作用而无法掉落。

作为白玉楼的亭师，白玉楼的实际管家，魂魄妖梦时常需要收集一些竹子用于维修竹制家具以及竹楼。因为她拥有精湛的剑术，因此可以在瞬间砍伐一大片的竹子作为材料。当然，妖梦并不希望拥有过多的竹子。因此她会选择一个多边形区域进行采集。在那一瞬间，妖梦会用楼观剑顺着多边形的边进行砍伐。

不过，由于掉落下来的竹子数量实在太多，因此妖梦无暇统计砍下来的竹子。你能帮帮她吗？
## 题目描述

妖梦在迷途竹林里选定的竹子，可以看作在同一平面上。竹子可以看作有 $+\infty$ 根，每相邻两根竹子间距相等，并且每根竹子的倾斜程度相同。竹子的高度可以看作是无限高。

妖梦选定了一块多边形区域进行竹子的砍伐。**只有在多边形内的部分**才会被收集到。多边形共有 $n$ 条边，为了防止出现歧义，保证任意一条边都不和竹子平行；保证多边形是[简单多边形](https://baike.baidu.com/item/%E7%AE%80%E5%8D%95%E5%A4%9A%E8%BE%B9%E5%BD%A2/18891697)。

我们会使用两个实数 $\theta$ 和 $a$ 来描述这些竹子。这两个字母表示的含义可以参考下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/7j0tx5xy.png)

现在妖梦需要知道她砍下来的竹子的总长度，也就是求出这些竹子（图中橙色的这些线段）的长度之和。
## 输入格式

- 第一行有一个正整数 $n$，表示多边形的边数。  
- 接下来 $n$ 行，将会**按照顺时针顺序**给出多边形的 $n$ 个顶点的坐标，第 $i$ 个点与第 $i+1$ 个点连接 $(1\le i<n)$，第 $n$ 个点与第 $1$ 个点连接。
- 接着给出描述线段的参数 $\theta$ 和 $a$。
## 输出格式

- 共一行，一个实数，表示所求得的竹子的总长。你的答案 $\mathit{ans}$ 被认为是正确的，当且仅当与标准答案 $\mathit{std}$ 满足 $\dfrac{|\mathit{ans}-\mathit{std}\ |}{\max(1.0,\mathit{std}\ )}\le 10^{-6}$。
## 样例

### 样例输入 #1
```
4
2.0000 2.0000
2.0000 -2.0000
-2.0000 -2.0000
-2.0000 2.0000
45.0000 1.0000
```
### 样例输出 #1
```
22.6274169980
```
### 样例输入 #2
```
8
0.0000 2.5000
1.0000 1.5000
2.5000 1.0000
2.0000 -1.0000
1.0000 -2.0000
-2.0000 -2.0000
-2.5000 1.0000
-1.0000 2.0000
60.0000 0.8000
```
### 样例输出 #2
```
23.1662217484
```
## 提示

#### 样例 1 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/ajm42r7v.png)

容易发现，竹子总长（即橘红色线段的总长度）为 $16\sqrt 2$。

#### 样例 2 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/anqb86a9.png)

我有一个精妙绝伦的方法解释样例 $2$，可惜这里空白太小写不下。

#### 数据范围及约定

$$
\def{\arraystretch}{1.5}
\begin{array}{|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n\le} & \textbf{特殊性质} & \textbf{分值}\cr\hline
1 & 10 & \text{A} & 30 \cr\hline
2 & 10^3 & - & 20 \cr\hline
3 & 10^5 & \text{B} & 20 \cr\hline
4 & 10^5 & - & 30 \cr\hline
\end{array}
$$

**特殊性质** $\textbf{A}$：保证 $\theta\in[80,100);|x_i|,|y_i|\le 10$。  
**特殊性质** $\textbf{B}$：保证 $\theta=90$。

- 对于 $100\%$ 的数据，保证 $3\le n\le 10^5;|x_i|,|y_i|\le 10^4;\theta\in[1,179);\alpha\in[0.1,100]$。输入数据当中出现的浮点数均保留四位小数。


---

---
title: "「Wdoi-5」模块化核熔炉"
layout: "post"
diff: 普及+/提高
pid: P8228
tag: ['洛谷原创', 'O2优化', '差分', '洛谷月赛']
---
# 「Wdoi-5」模块化核熔炉
## 题目背景

为了通过使用核聚变获得能源，守矢神社在旧地狱修建了巨大的核融合控制中心。控制中心形如双层八卦炉，通过各种电路紧密地调控着核融合的精密运行。获得了八咫鸟力量的阿空会在核反应炉的中心点燃神火。

但是正八边形的八卦炉并不利于进行拓展与维护。为了方便地实现电路，河童打算对核控制中心进行模块化改造，以实现核熔炉的维护。具体而言，河童打算将核控制中心设计成由若干个正六边形组成的巨大结构。

![](https://cdn.luogu.com.cn/upload/image_hosting/ohyfxv02.png)

被赋予了神力的阿空可以依次激发其中的一些模块，而这些被激发的模块会快速影响到一定范围内的其他的模块。通过模块间的链接实现能量的产生。

但是因为阿空脑袋空空，由于它已经激发了多次模块，它已经记不清每个模块当中产生的核融合程度了。你能帮帮它吗？
## 题目描述

核控制中心可以看作由若干个正六边形模块组成的六边形阵列。阵列当中每个模块都可以储存核融合能量（一个非负整数）。左图就是一个核控制中心示意图。

![](https://cdn.luogu.com.cn/upload/image_hosting/78y7b98x.png)

我们使用如下方式对控制中心中每个模块进行标号。

![](https://cdn.luogu.com.cn/upload/image_hosting/9ffz2m5o.png)

以阵列中心为原点延伸出三根射线作为三根轴，每两根轴之间的夹角为 $120\degree$。这三根轴将平面划分为了三个部分。每个模块都可以使用一个三元组 $(x,y,z)$ 描述它的坐标，表示从原点开始按如图所示的 $x,y,z$ 方向各走若干步之后到达的地方。为了防止出现多个坐标表示同一个模块的情况，做出如下规定：原点的坐标为 $(0,0,0)$；对于中心在坐标轴上的模块，它的坐标就是从原点向所在轴走过的距离；对于其他情况，我们将平面划分为了三个区域（如第二张图的红蓝绿三个区域），一个模块的坐标就是沿着它两侧的轴分别需要走的距离。例如模块 $P$ 的坐标为 $(2,4,0)$。容易发现，每个坐标唯一对应一个模块，一个模块唯一对应一个坐标。

同时定义，两个模块的**距离**为从一个模块到另一个模块需要经过模块（包括起点和终点）的最少个数。在第一张图中，红色部分的模块到其中心距离均不超过 $3$，绿色部分的模块到其中心距离均不超过 $3$，而蓝色部分的模块到其中心距离均不超过 $2$。

核控制中心可以视为到达原点距离不超过 $n$ 的模块组成的阵列。现在阿空会执行以下操作 $m$ 次：

- $\colorbox{f0f0f0}{\verb!x y z r k!}$ ：激活坐标为 $(x,y,z)$ 的模块。它会使控制中心中到它距离不超过 $r$ 的**所有**的模块的核融合能量增加 $k$。保证 $(x,y,z)$ 在控制中心当中。

现在需要求出，执行完 $m$ 个操作后，每个模块里核融合能量值。
## 输入格式

- 第一行共两个正整数 $n,m$，分别表示控制中心的大小、操作个数。
- 接下来 $m$ 行，每行有五个整数 $x_i,y_i,z_i,r_i,k_i$，表示将距离 $(x_i,y_i,z_i)$ 不超过 $r$ 的所有模块的核融合能量增加 $k_i$。
## 输出格式

- 共一行，若干个整数。按照从左往右从上往下的顺序，依次输出每个模块当中核融合能量值。每两个值之间使用空格隔开。

下图当中的红色箭头展示了「从左往右从上往下」的顺序。

![](https://cdn.luogu.com.cn/upload/image_hosting/vziqfo7l.png)
## 样例

### 样例输入 #1
```
4 3
0 1 1 3 4
3 0 3 3 3
1 0 0 2 2
```
### 样例输出 #1
```
4 4 4 0 4 4 4 4 3 4 4 4 4 7 3 0 4 4 6 9 3 3 0 4 6 6 5 3 0 0 2 2 3 0 0 0 0
```
## 提示

样例 $2$ 见下发的附件 $\textbf{\textit{nuclear2.in/nuclear2.ans}}$。  
样例 $3$ 见下发的附件 $\textbf{\textit{nuclear3.in/nuclear3.ans}}$。满足特殊性质 $\text{A}$（见下文）。  
样例 $4$ 见下发的附件 $\textbf{\textit{nuclear4.in/nuclear4.ans}}$。满足特殊性质 $\text{B}$（见下文）。  
样例 $5$ 见下发的附件 $\textbf{\textit{nuclear5.in/nuclear5.ans}}$。

#### 样例 1 解释

如图所示（所有未标出数字的模块的核融合能量值均为 $0$）：

![](https://cdn.luogu.com.cn/upload/image_hosting/6y7bm2eb.png)



按照从左往右、从上往下的顺序依次输出每个数值，即可得到答案。

#### 数据范围及约定

本题共有 $20$ 个测试点，每个测试点 $5$ 分。最终分数为所有测试点分数之和。

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|}\hline
\textbf{Task} & \bm{n\le } & \bm{m\le} & \textbf{特殊性质} \cr\hline
1\sim 3 & 10 & 10 & \text{A} \cr\hline
4\sim 7 & 100 & 300 & - \cr\hline
8\sim 10 & 800 & 3\times 10^5 & \text{B} \cr\hline
11\sim 14 & 800 & 3\times 10^5 & \text{A} \cr\hline
15\sim 20 & 800 & 3\times 10^5 & - \cr\hline
\end{array}
$$

**特殊性质** $\textbf{A}$：保证对于第 $i$ 次操作，被激活的模块到控制中心边缘上的模块的距离不小于 $r_i$。  
**特殊性质** $\textbf{B}$：保证对于第 $i$ 次操作，被激活的模块均为 $(0,0,0)$。

对于全部数据，保证 $n\le 800$，$m\le 3\times 10^5$，$1\le k_i\le 5\times 10^3$，$1\le r_i\le 10^9$。每次激活的模块都在控制中心里。


---

---
title: "[蓝桥杯 2018 省 A] 三体攻击"
layout: "post"
diff: 普及+/提高
pid: P8666
tag: ['2018', '二分', '差分', '蓝桥杯省赛']
---
# [蓝桥杯 2018 省 A] 三体攻击
## 题目描述

三体人将对地球发起攻击。为了抵御攻击，地球人派出了 $A\times B\times C$ 艘战舰，在太空中排成一个 $A$ 层 $B$ 行 $C$ 列的立方体。其中，第 $i$ 层第 $j$ 行第 $k$ 列的战舰（记为战舰 $(i, j, k)$）的生命值为 $d(i, j, k)$。

三体人将会对地球发起 $m$ 轮“立方体攻击”，每次攻击会对一个小立方体中的所有战舰都造成相同的伤害。具体地，第 $t$ 轮攻击用 $7$ 个参数 $la_t, ra_t, lb_t, rb_t, lc_t, rc_t, h_t$ 描述；

所有满足 $i\in [la_t, ra_t],j\in [lb_t, rb_t],k\in [lc_t, rc_t]$ 的战舰 $(i, j, k)$ 会受到 $h_t$ 的伤害。如果一个战舰累计受到的总伤害超过其防御力，那么这个战舰会爆炸。

地球指挥官希望你能告诉他，第一艘爆炸的战舰是在哪一轮攻击后爆炸的。

## 输入格式

从标准输入读入数据。

第一行包括 $4$ 个正整数 $A$，$B$，$C$，$m$；

第二行包含 $A\times B\times C$ 个整数，其中第 $((i − 1)\times B + (j − 1)) \times C + (k − 1)+1$ 个数为 $d(i, j, k)$；

第 $3$ 到第 $m + 2$ 行中，第 $(t + 2)$ 行包含 $7$ 个正整数 $la_t, ra_t, lb_t, rb_t, lc_t, rc_t, h_t$。

## 输出格式

输出到标准输出。

输出第一个爆炸的战舰是在哪一轮攻击后爆炸的。保证一定存在这样的战舰。

## 样例

### 样例输入 #1
```
2 2 2 3
1 1 1 1 1 1 1 1
1 2 1 2 1 1 1
1 1 1 2 1 2 1
1 1 1 1 1 1 2
```
### 样例输出 #1
```
2
```
## 提示

**【样例解释】**

在第 $2$ 轮攻击后，战舰 $(1,1,1)$ 总共受到了 $2$ 点伤害，超出其防御力导致爆炸。

**【数据约定】**

对于 $10\%$ 的数据，$B = C = 1$；

对于 $20\%$ 的数据，$C = 1$；

对于 $40\%$ 的数据，$A\times B \times C, m\le10000$；

对于 $70\%$ 的数据，$A, B, C \le 200$；

对于所有数据，$1\le A\times B\times C \le 10^6$，$1\le m \le 10^6$，$0 \le  (i, j, k)$, $h_t\le 10^9$。


---

---
title: "[蓝桥杯 2022 国 C] 打折"
layout: "post"
diff: 普及+/提高
pid: P8812
tag: ['2022', '枚举', '差分', '蓝桥杯国赛']
---
# [蓝桥杯 2022 国 C] 打折
## 题目描述

小蓝打算采购 $n$ 种物品，每种物品各需要 $1$ 个。

小蓝所住的位置附近一共有 $m$ 个店铺，每个店铺都出售着各种各样的物品。

第 $i$ 家店铺会在第 $s_i$ 天至第 $t_i$ 天打折，折扣率为 $p_i$，对于原件为 $b$ 的物品，折后价格为 $\lfloor\frac {b\cdot p_j}{100}\rfloor$。其它时间需按原价购买。

小蓝很忙，他只能选择一天的时间去采购这些物品。请问，他最少需要花多少钱才能买到需要的所有物品。

题目保证小蓝一定能买到需要的所有物品。
## 输入格式

输入的第一行包含两个整数 $n,m$，用一个空格分隔，分别表示物品的个数和店铺的个数。


接下来依次包含每个店铺的描述。每个店铺由若干行组成，其中第一行包含四个整数 $s_i,t_i, p_i,c_i$，相邻两个整数之间用一个空格分隔，分别表示商店优惠的起始和结束时间、折扣率以及商店内的商品总数。之后接 $c_i$ 行，每行包含两个整数 $a_j,b_j$，用一个空格分隔，分别表示该商店的第 $j$ 个商品的类型和价格。商品的类型由 $1$ 至 $n$ 编号。
## 输出格式

输出一行包含一个整数表示小蓝需要花费的最少的钱数。
## 样例

### 样例输入 #1
```
2 2
1 2 89 1
1 97
3 4 77 1
2 15
```
### 样例输出 #1
```
101
```
## 提示

对于 $40\%$ 的评测用例，$n,m≤500，s_i ≤t_i ≤100，\sum c_i ≤2000$；

对于 $70\%$ 的评测用例，$n,m≤5000，\sum c_i ≤20000$；

对于所有评测用例，$1 ≤ n,m ≤ 10^5，1 ≤ c_i ≤ n，\sum c_i ≤ 4\times10^5，1 ≤ s_i ≤t_i ≤10^9，1 < p_i < 100，1≤a_j ≤n，1≤b_j ≤10^9$。

蓝桥杯 2022 国赛 C 组 I 题。


---

---
title: "[传智杯 #5 初赛] G-二人的花纹纸游戏"
layout: "post"
diff: 普及+/提高
pid: P8875
tag: ['前缀和', '差分', '传智杯']
---
# [传智杯 #5 初赛] G-二人的花纹纸游戏
## 题目背景

梅莉买到了一张特殊的带有花纹的纸。整张纸的图案可以视为，由一个较小的图案，沿着横向与纵向无限循环而成。同时，这个基本图案部分透明，部分不透明。

于是，如果将这张纸覆盖在书本上，那么一些字可以被看见，另一些字看不见。

莲子突发奇想：假使她制作一张很大很大的数表，将花纹纸覆盖在上面，那么就会有很多数字被遮挡。那些没有被遮挡的数字的和是多少呢？
## 题目描述

事实上，二人的问题可以转化成如下描述：给定一个 $n$ 行 $m$ 列的普通矩阵 $A$，以及一个 $r$ 行 $c$ 列的 $01$ 矩阵 $B$。$B$ 中为 $1$ 的格子是黑色，不透明；为 $0$ 的格子是透明的。

![](https://cdn.luogu.com.cn/upload/image_hosting/6z0uo690.png)

使用 $B$ 矩阵，循环生成一个**无穷大**的矩阵 $M$：

![](https://cdn.luogu.com.cn/upload/image_hosting/laycum3q.png)

现在有 $q$ 次询问。每次将 $M$ 矩阵左上角和 $(x_1,y_1)$ 对齐，此时此时会有一些 $A$ 中的元素被遮挡，另一些元素可以被看见。

![](https://cdn.luogu.com.cn/upload/image_hosting/dtpe8m5u.png)

求出此时，$A$ 当中以 $(x_1,y_1)$ 作为左上角，$(x_2,y_2)$ 作为右下角的子矩阵中，可以被看见的元素之和。结果对 $998{,}244{,}353$ 取模。

在上面的例子里，$(x_1,y_1)=(2,3)$，$(x_2,y_2)=(4,7)$。可以被看见的元素之和为 $a_{2,3}+a_{2,5}+a_{2,6}+a_{3,5}+a_{4,3}+a_{4,5}+a_{4,6}$。

### 形式化题面

给定一个 $n$ 行 $m$ 列的普通矩阵 $A$，以及一个 $r$ 行 $c$ 列的 $01$ 矩阵 $B$。使用 $B$ 矩阵，生成一个**无穷大**的矩阵 $M$：

$$M=
\begin{pmatrix}
B & B & B  &\cdots \\
B & B & B  &\cdots \\
B & B & B  &\cdots \\
\vdots &\vdots &\vdots &
\end{pmatrix}
=\begin{pmatrix}
b_{1,1} & b_{1,2} & \cdots & b_{1,c} & b_{1,1} & b_{1,2} & \cdots & b_{1,c} & b_{1,1} & \cdots \\
b_{2,1} & b_{2,2} & \cdots & b_{2,c} & b_{2,1} & b_{2,2} & \cdots & b_{2,c} & b_{2,1} & \cdots \\
\vdots & \vdots & & \vdots & \vdots & \vdots & & \vdots & \vdots &  \\
b_{r,1} & b_{r,2} & \cdots & b_{r,c} & b_{r,1} & b_{r,2} & \cdots & b_{r,c} & b_{r,1} & \cdots \\
b_{1,1} & b_{1,2} & \cdots & b_{1,c} & b_{1,1} & b_{1,2} & \cdots & b_{1,c} & b_{1,1} & \cdots \\
b_{2,1} & b_{2,2} & \cdots & b_{2,c} & b_{2,1} & b_{2,2} & \cdots & b_{2,c} & b_{2,1} & \cdots \\
\vdots & \vdots & & \vdots & \vdots & \vdots & & \vdots & \vdots &  \\
b_{r,1} & b_{r,2} & \cdots & b_{r,c} & b_{r,1} & b_{r,2} & \cdots & b_{r,c} & b_{r,1} & \cdots \\
\vdots & \vdots & & \vdots & \vdots & \vdots & & \vdots & \vdots &  \\
\end{pmatrix}$$

现在有 $q$ 次询问，每次给出一个子矩阵的左上角坐标 $(x_1,y_1)$ 和右下角坐标 $(x_2,y_2)$，你需要求出：

$$S=\left(\sum_{i=x_1}^{x_2}\sum_{j=y_1}^{y_2}a_{i,j}\times [M_{i-x_1+1,j-y_1+1}=0] \right)\bmod 998{,}244{,}353$$

其中 $[P]$ 表示艾弗森括号。若 $P$ 为真，则 $[P]=1$，否则 $[P]=0$。
## 输入格式

- 第一行有两个正整数 $n,m$，描述矩阵 $A$ 的大小。
- 接下来 $n$ 行 $m$ 列，每行一个非负整数，描述 $A$ 中的元素 $a_{i,j}$。
- 下一行有两个正整数 $r,c$，描述矩阵 $B$ 的大小。
- 接下来 $r$ 行 $c$ 列，每行一个非负整数，描述 $B$ 中的元素 $b_{i,j}$。
- 下一行有一个正整数 $q$，表示询问的次数。
- 接下来 $q$ 行，每行有四个正整数 $x_1,y_1,x_2,y_2$，描述一组询问。保证 $x_1\le x_2$，$y_1\le y_2$。
## 输出格式

- 输出共 $q$ 行。每行输出该次询问的答案。
## 样例

### 样例输入 #1
```
3 4
1 2 3 4
5 6 7 8
9 10 11 12
2 2
1 0
0 1
2
1 1 3 4
1 2 3 3

```
### 样例输出 #1
```
40
20

```
### 样例输入 #2
```
4 4
1 3 2 4
5 4 2 3
4 1 2 3
3 4 4 3
1 3
1 0 0
3
1 1 3 4
2 2 4 4
1 2 3 2

```
### 样例输出 #2
```
14
17
0

```
## 提示

### 样例 1 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/z7yeiipu.png)

- 对于第一次询问，结果为 $2+4+5+7+10+12=40$；
- 对于第二次询问，结果为 $3+6+11=20$。

### 数据范围及约定

对于全部数据，保证 $1\le n,m\le 10^3$，$1\le q\le 10^4$，$1\le r,c\le 50$，$0\le a_{i,j}<998{,}244{,}353$，$b_{i,j}\in\{0,1\}$。


---

---
title: "「TERRA-OI R1」别得意，小子"
layout: "post"
diff: 普及+/提高
pid: P8929
tag: ['数学', '二分', 'O2优化', '差分']
---
# 「TERRA-OI R1」别得意，小子
## 题目背景

战至中途，蓝紫色天空瞬间变为黑压压一片，噬神者身上一些紫色外壳开始脱落，化为更小的蟒蛇，这些小家伙从出现开始便不要命的向你冲过来，刚清理掉这些小家伙，迷雾中忽然涌现出一张血盆大口，噬神者正向你冲击而来......
## 题目描述

现给定一个有 $n$ 段的分段函数，每一段可能是一个一次函数或者一个二次函数，并有 $q$ 次询问，每次询问 $x=k$ 时 $y$ 的取值或是 $y=k$ 与函数有多少个交点。


## 输入格式

第一行两个用空格分隔的整数 $n,q$，表示函数段数与询问次数。

从第 $2$ 行到 $n+1$ 行，先给出 $l_i$ $r_i$，表示这个分段函数对应的取值范围为 $(l_i,r_i]$（保证 $l_1=0$，$\forall i\in [1,n-1],r_i=l_{i+1}$）。然后读入有以下两种情况：

- $1$ $k$ $b$，表示这个区间内是 $y=kx+b$ 的一个一次函数（保证 $k\ne 0$）。
- $2$ $a$ $b$ $c$，表示这个区间内是 $y=ax^2+bx+c$ 的二次函数（保证 $a\ne 0$）。

从第 $n+2$ 行到第 $n+q+1$ 行，每行两个用空格分隔的整数 $op,k$：

- 若 $op=1$ ，表示求出当 $x=k$ 时 $y$ 的值（保证 $k\in (0,r_n]$）。
- 若 $op=2$ ，表示求出直线 $y=k$ 在 $(0,r_n]$ 范围内与整个分段函数有几个交点。
## 输出格式

一共 $q$ 行，每行一个整数表示对于每个询问的答案。
## 样例

### 样例输入 #1
```
3 4
0 3 1 1 2
3 6 2 1 -2 1
6 10 1 1 0
1 4
2 5
2 114514
2 2
```
### 样例输出 #1
```
9
2
0
0
```
### 样例输入 #2
```
6 8
0 4 2 1 -4 0 
4 6 1 2 -10 
6 11 1 1 -19 
11 19 2 -1 -30 559 
19 29 1 1 -58 
29 38 1 1 -68 
1 11
2 4
2 -1
1 21
2 -5
2 2
1 34
2 1

```
### 样例输出 #2
```
-8
1
4
-37
1
2
-34
2

```
## 提示

#### 【样例解释 #1】

三段函数分别为 $y=x+2$，$y=x^2-2x+1$，$y=x$。

对于当 $x=4$ 时套入第二段函数可以得到结果为 $9$。

而直线 $y=5$ 只与第一段与第二段函数相交，并且各只有一个交点，所以结果为 $2$。

显而易见，第三个询问对应的直线不与函数相交。

第四个询问虽然与第一段函数交于 $x=0$ 的位置，但 $0$ 不在该函数区间内，故舍去。

------------

#### 【数据范围】

**本题采用捆绑测试。**

| Subtask | Score | $n,q\le$ | limit |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10$ | $100$ | 无 |
| $2$ | $15$ | $10^3$ | $r_n\le 5\times 10^3$ |
| $3$ | $20$ | $2\times 10^5$ | 不存在询问 $2$ |
| $4$ | $25$ | $2\times 10^5$ | 不存在二次函数 |
| $5$ | $30$ | $2\times 10^5$ | 无 |

对于 $100\%$ 的数据，$1\le n,q\le 2\times 10^5$，$0\le l_i,r_i\le10^9$，$\forall i\in [1,n],r_i>l_i$ 。

所有的函数系数均在 **$64$ 位有符号整型变量**存储范围内，并且运算结果与每个函数式中任何一项的最大值与最小值不会超过 **$64$ 位有符号整型变量**存储范围。所有询问参数均在 **$32$ 位有符号整型变量**范围内。

（即 $-4\times 10^{18}\le k,a,b,c\le 4\times 10^{18}$，$-10^9\le x\le 10^9$）

------------
#### 【提示】

采用浮点数据时建议使用 long double，避免产生精度问题。

upd：添加一组 hack 数据，未通过会显示为“Unaccepted 100pts”。


---


---
title: "斐波那契"
layout: "post"
diff: 普及+/提高
pid: P3938
tag: ['2017', '二分', 'O2优化', '最近公共祖先 LCA', '斐波那契数列']
---
# 斐波那契
## 题目背景

大样例可在页面底部「附件」中下载。
## 题目描述

小 C 养了一些很可爱的兔子。 有一天，小 C 突然发现兔子们都是严格按照伟大的数学家斐波那契提出的模型来进行 繁衍：一对兔子从出生后第二个月起，每个月刚开始的时候都会产下一对小兔子。我们假定， 在整个过程中兔子不会出现任何意外。

小 C 把兔子按出生顺序，把兔子们从 1 开始标号，并且小 C 的兔子都是 1 号兔子和 1 号兔子的后代。如果某两对兔子是同时出生的，那么小 C 会将父母标号更小的一对优先标 号。

如果我们把这种关系用图画下来，前六个月大概就是这样的：

 
  ![](https://cdn.luogu.com.cn/upload/pic/9806.png) 

其中，一个箭头 $A \to B$ 表示 $A$ 是 $B$ 的祖先，相同的颜色表示同一个月出生的兔子。

为了更细致地了解兔子们是如何繁衍的，小 C 找来了一些兔子，并且向你提出了 $m$ 个问题：她想知道关于每两对兔子 $a_i$ 和 $b_i$，他们的最近公共祖先是谁。你能帮帮小 C 吗？

一对兔子的祖先是这对兔子以及他们父母（如果有的话）的祖先，而最近公共祖先是指 两对兔子所共有的祖先中，离他们的距离之和最近的一对兔子。比如，$5$ 和 $7$ 的最近公共祖 先是 $2,1$ 和 $2$ 的最近公共祖先是 $1,6$ 和 $6$ 的最近公共祖先是 $6$。

## 输入格式

输入第一行，包含一个正整数 $m$。输入接下来 $m$ 行，每行包含 $2$ 个正整数，表示 $a_i$ 和 $b_i$。

## 输出格式

输出一共 $m$ 行，每行一个正整数，依次表示你对问题的答案。

## 样例

### 样例输入 #1
```
5 
1 1 
2 3 
5 7 
7 13 
4 12
```
### 样例输出 #1
```
1 
1 
2 
2 
4 
```
## 提示

【数据范围与约定】 子任务会给出部分测试数据的特点。如果你在解决题目中遇到了困难，可以尝试只解决一部分测试数据。 每个测试点的数据规模及特点如下表：

 ![](https://cdn.luogu.com.cn/upload/pic/9807.png) 

特殊性质 $1$：保证 $a_i$, $b_i$ 均为某一个月出生的兔子中标号最大的一对兔子。例如，对 于前六个月，标号最大的兔子分别是 $1, 2, 3, 5, 8, 13$。

特殊性质 $2$：保证 $|a_i-b_i|\le 1$。



---

---
title: "萃香的请柬"
layout: "post"
diff: 普及+/提高
pid: P4275
tag: ['数学', '斐波那契数列']
---
# 萃香的请柬
## 题目背景

**管理员提示：数据中存在 $l=0$，请等同于 $l=1$ 处理。**

现在是宴会开始前一天

![](https://cdn.luogu.com.cn/upload/pic/15052.png)
## 题目描述

萃香在小时候就一直有一个梦想，就是邀请全乡居民一起参加宴会，在上次发动异变被灵梦退治之后她仍旧没有放弃，而是在元宵节前早早准备好了难以计数的请柬。

现在，宴会即将开始，萃香却还是有一大堆请柬没有送出。经过大数学家琪露诺的严谨推算，到2018年时幻想乡的居民数目已经远远超过了外界，而这就使得宴会的邀请变得极为困难。

但是，拥有"操纵密度程度的能力"的萃香可以分成大大小小的萃香一起去送请柬。由于小萃香的移动速度过慢，因此她决定只让大萃香曲去送请柬。

开始时有S只萃香，之后每过一秒每一个大萃香会分成一大一小两个萃香，与此同时上一次分出的小萃香会积聚能量变大为大萃香。

直观的说，下面是开始只有一个大萃香时前四秒的变化情况(大萃香用"B"表示，小萃香用"L"表示)
![](https://cdn.luogu.com.cn/upload/pic/15043.png)

(很容易看出，第一次的大萃香经过一秒后分成了一大一小两只萃香，之后一秒刚才分出的大萃香继续分裂，而刚才的小萃香长大为大萃香)

可是，我们这位"小小的百鬼夜行"发现了一个严重的问题:在**经过无限长的时间**后，萃香的数目太多了。于是她决定每一次只让一段区间内的大萃香去送请柬，而她现在想要知道每一次能够送出的请柬个数。

如果你能帮她完成这个任务，她就会送给你两个奖励——100分和宴会的请柬!
## 输入格式

第一行 $S$ 个大写字母 $\verb!B!$ 或 $\verb!L!$，表示开始时萃香的状态。

之后是一个整数 $n$ 表示询问的个数。

接下来 $n$ 行每行两个整数 $l,r$ 表示询问的区间。

## 输出格式

共 $n$ 行，每行一个整数 $k$，表示区间 $[l,r]$ 中大萃香的个数。
## 样例

### 样例输入 #1
```
B
2
2 3
1 5
```
### 样例输出 #1
```
1
3
```
## 提示

【数据范围】:

![](https://cdn.luogu.com.cn/upload/pic/15239.png)


---


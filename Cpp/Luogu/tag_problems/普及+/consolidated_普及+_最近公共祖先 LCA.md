---
title: "[中山市赛 2024] 树上开花"
layout: "post"
diff: 普及+/提高
pid: B4189
tag: ['二分', '2024', '广东', '最近公共祖先 LCA', '排列组合', '科创活动', '小学活动']
---
# [中山市赛 2024] 树上开花
## 题目描述

你有一棵以 1 为根的树，统计点对 $(x, y)$，满足 $a_{lca(x,y)}$ 是 $a_x$ 和 $a_y$ 的公约数。注意当
$x \neq y$ 时 $(x, y)$ 和 $(y, x)$ 视为不同的点对。


## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个整数 $a_i$。

第三到 $n + 1$ 行，每行两个整数，表示树上的边。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
2 3 2 5 4
1 2
1 3
2 4
2 5
```
### 样例输出 #1
```
11
```
## 提示

### 样例解释

以下点对满足条件：$(1, 1)$，$(1, 3)$，$(1, 5)$，$(2, 2)$，$(3, 1)$，$(3, 3)$，$(3, 5)$，$(4, 4)$，$(5, 1)$，$(5, 3)$，$(5, 5)$。

### 数据范围

本题数据分为多个子任务，具体如下：

| 子任务编号 | $n$ | 附加条件 | 子任务分数 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $\leq 150$ | 无 | $10$ |
| $2$ | $\leq 1500$ | 无 | $10$ |
| $3$ | $\leq 10^5$ | 树为随机生成 | $10$ |
| $4$ | $=99998$ | $a_i\leq 300$ | $10$ |
| $5$ | $=99998$ | $a$ 为 $1\sim n$ 的排列 | $10$ |
| $6$ | $\leq 10^5$ | 无 | $50$ |


对于所有数据，保证 $1 \leq a_i \leq n$。


---

---
title: "[中山市赛 2023] 树的改造"
layout: "post"
diff: 普及+/提高
pid: B4339
tag: ['2023', '广东', '最近公共祖先 LCA', '差分', '科创活动', '小学活动']
---
# [中山市赛 2023] 树的改造
## 题目描述

空白这一次的来到了森精种的家园，精灵都喜欢贴近大自然，~~喜欢住在树洞里~~，所以他们的家园是一棵神树！他们非常喜欢艺术，就是说喜欢改造他们所居住的神树！

他们现在居住的树的形态可以描述成一颗有 $n$ 个树洞的树 $A$，一共有 $n-1$ 条边连接，使得树洞两两可以到达，且树洞根据编号是可区分的。

现在菲尔带来了下一代神树的设计图，假设为树 $B$，现在她想考一考空白，如果根据如下规则调整神树，至少需要调整多少次才可以将 $A$ 树变成 $B$ 树。

一次调整可以选择一个节点 $x$，然后将 $x$ 以及和 $x$ 相邻的节点（也就是有边直接相连的节点）打上魔法标记，然后断开 $x$ 的所有邻边，然后再在所有打上魔法标记的点直接添加若干条新边，形成一棵新的树，同时魔法标记消失。
## 输入格式

第一行一个正整数 $n$，表示树的大小。

接下来 $n-1$ 行，每行两个整数 $u,v$，表示 $A$ 树上的边 $(u,v)$。

然后还有 $n-1$ 行，每行两个整数 $u,v$，表示 $B$ 树上的边 $(u,v)$。
## 输出格式

一行一个整数表示最少调整次数。
## 样例

### 样例输入 #1
```
5
1 2
1 3
3 4
3 5
1 2
1 4
4 3
3 5

```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
7
1 2
2 3
2 6
2 4
4 5
5 7
6 3
3 2
2 1
1 5
7 5
5 4

```
### 样例输出 #2
```
2
```
## 提示

### 样例解释 1

可以选择 $x=3$ 进行调整，这时候 $1,3,4,5$ 都被打上了魔法标记。

删去了边 $(3, 1)$，$(3, 4)$，$(3, 5)$，添加边 $(1, 4)$，$(4, 3)$，$(3, 5)$。

### 数据范围

对于 $20\%$ 的数据，$n \le 8$。

对于 $60\%$ 的数据，$n \le 5000$。

对于 $100\%$ 的数据，$n \le 10^6$。


---

---
title: "[蓝桥杯 2024 省 A] 零食采购"
layout: "post"
diff: 普及+/提高
pid: P10391
tag: ['2024', '最近公共祖先 LCA', '蓝桥杯省赛', '状压 DP']
---
# [蓝桥杯 2024 省 A] 零食采购
## 题目描述

小蓝准备去星际旅行，出发前想在本星系采购一些零食，星系内有 $n$ 颗星球，由 $n-1$ 条航路连接为连通图，第 $i$ 颗星球卖第 $c_i$ 种零食特产。小蓝想出了 $q$ 个采购方案，第 $i$ 个方案的起点为星球 $s_i$ ，终点为星球 $t_i$ ，对于每种采购方案，小蓝将从起点走最短的航路到终点，并且可以购买所有经过的星球上的零食（包括起点终点），请计算每种采购方案最多能买多少种不同的零食。
## 输入格式

输入的第一行包含两个正整数 $n$，$q$，用一个空格分隔。  
第二行包含 $n$ 个整数 $c_1,c_2,\cdots, c_n$，相邻整数之间使用一个空格分隔。  
接下来 $n - 1$ 行，第 $i$ 行包含两个整数 $u_i,v_i$，用一个空格分隔，表示一条
航路将星球 $u_i$ 与 $v_i$ 相连。  
接下来 $q$ 行，第 $i$ 行包含两个整数 $s_i
, t_i $，用一个空格分隔，表示一个采购方案。
## 输出格式

输出 $q$ 行，每行包含一个整数，依次表示每个采购方案的答案。
## 样例

### 样例输入 #1
```
4 2
1 2 3 1
1 2
1 3
2 4
4 3
1 4
```
### 样例输出 #1
```
3
2
```
## 提示

第一个方案路线为 $\{4, 2, 1, 3\}$，可以买到第 $1, 2, 3$ 种零食；  
第二个方案路线为 $\{1, 2, 4\}$，可以买到第 $1, 2$ 种零食。

对于 20% 的评测用例，$1 ≤ n, q ≤ 5000 $；    
对于所有评测用例，$1 ≤ n, q ≤ 10^5，1 ≤ c_i ≤ 20，1 ≤ u_i
, v_i ≤ n，1 ≤ s_i
, t_i ≤ n$。


---

---
title: "[COCI 2024/2025 #3] 林卡树 / Stablo"
layout: "post"
diff: 普及+/提高
pid: P11477
tag: ['2024', '最近公共祖先 LCA', 'COCI（克罗地亚）']
---
# [COCI 2024/2025 #3] 林卡树 / Stablo
## 题目背景


译自 [COCI 2024/2025 #3](https://hsin.hr/coci/) T4。$\texttt{2s,0.5G}$。满分为 $120$。

## 题目描述


给定 $n$ 个节点的有根树，根节点为 $1$。点 $i$ 的点权为 $v_i$。

定义函数 

$$f(y)=\sum_{x\in \operatorname{subtree}(y)} \operatorname{dist}(x,y)\cdot v_x$$

其中，$\operatorname{subtree}(y)$ 表示 $y$ 的子树内所有点构成的集合（包括 $y$），$\operatorname{dist}(x,y)$ 表示 $x,y$ 之间的最短路径上的边数。换言之，$f(y)$ 是 $y$ 子树内所有点的点权乘以到 $y$ 的距离求和。

有 $q$ 次操作，每次操作给定两个节点 $x,y$。在一次操作中：

- 将 $x$ 的所有儿子接到 $x$ 的父亲上；
- 将 $x$ 删掉；
- 令 $y$ 的儿子中，包含 $x$ 的为 $z$。将 $x$ 插入到 $y$ 和 $z$ 之间。
- 求出 $f(y)$。

保证 $x\in \operatorname{subtree}(y)$，且 $x\neq y$。特别地，若 $y$ 是 $x$ 的父亲，则原树的形态保持不变。

需要注意的是，**操作之间相互独立**。也就是说，每次操作都是在初始形态的树上操作（而不是在上一次操作的基础上操作）。


## 输入格式


第一行，两个正整数 $n,q$。

第二行，$n$ 个正整数 $v_1,v_2,\cdots,v_n$。

第三行，$(n-1)$ 个正整数 $p_2,\cdots,p_n$，其中 $p_i$ 表示 $i$ 号节点的父亲。

接下来 $q$ 行，每行两个正整数 $x,y$，描述一次操作。
## 输出格式

输出 $q$ 行，每行一个正整数，表示答案。

## 样例

### 样例输入 #1
```
3 1
1 2 3
1 2
3 1
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
3 2
4 5 6
1 1
2 1
3 1
```
### 样例输出 #2
```
11
11
```
### 样例输入 #3
```
5 3
2 5 2 2 2
1 2 3 2
4 3
3 2
5 1
```
### 样例输出 #3
```
2
8
26
```
## 提示



### 样例解释

样例 $1$ 中，操作后，有 $\operatorname{dist}(1,3)=1,\operatorname{dist}(1,2)=2$。所求为 $3+2\cdot 2=7$。

### 数据范围


对于 $100\%$ 的数据，保证：

- $1\le n,q\le 5\times 10^5$；
- $1\le v_i\le 10^6$；
- $1\le p_i\lt i$；
- $1\le x,y\in n$；
- $x\neq y$，$x\in \operatorname{subtree}(y)$。


| 子任务编号 | $n,q\le$ |  特殊性质 | 得分 |  
| :--: | :--: | :--: |:--: | 
| $ 1 $    | $10^3$ |  |   $ 21 $   |  
| $ 2 $    | $5\times 10^5$ | A  |  $ 37 $   |  
| $ 3 $    | $5\times 10^5$ | B  |  $ 22 $   |  
| $ 4 $    | $5\times 10^5$ |  |  $ 40 $   |  

- 特殊性质 A：树的形态是链。换言之，$p_i=i-1$。
- 特殊性质 B：每个节点最多有 $20$ 个儿子。




---

---
title: "[GESP202503 八级] 割裂"
layout: "post"
diff: 普及+/提高
pid: P11967
tag: ['倍增', '2025', '最近公共祖先 LCA', '差分', 'GESP']
---
# [GESP202503 八级] 割裂
## 题目描述


小杨有一棵包含 $ n $ 个节点的树，其中节点的编号从 1 到 $ n $。

小杨设置了一个好点对 $\{\langle u_1, v_1 \rangle, \langle u_2, v_2 \rangle, \dots, \langle u_a, v_a \rangle\}$ 和一个坏点对 $\langle b_u, b_v \rangle$。一个节点能被删除，当且仅当：

- 删除该节点后对于所有的 $ 1 \leq i \leq a $，好点对 $ u_i $ 和 $ v_i $ 仍然连通；
- 删除该节点后坏点对 $ b_u $ 和 $ b_v $ 不连通。

如果点对中的任意一个节点被删除，其视为不连通。

小杨想知道，还有多少个节点能被删除。

## 输入格式


第一行包含两个非负整数 $ n $, $ a $，含义如下题面所示。

接下来 $n - 1$ 行，每行包含两个正整数 $ x_i, y_i $，代表存在一条连接节点 $ x_i $ 和 $ y_i $ 的边；

之后 $ a $ 行，每行包含两个正整数 $ u_i, v_i $，代表一个好点对 $ \langle u_i, v_i \rangle $；

最后一行包含两个正整数 $ b_u, b_v $，代表坏点对 $ \langle b_u, b_v \rangle $。
## 输出格式

输出一个非负整数，代表删除的节点个数。

## 样例

### 样例输入 #1
```
6 2
1 3
1 5
3 6
3 2
5 4
5 4
5 3
2 6
```
### 样例输出 #1
```
2
```
## 提示


| 子任务编号 | 分值 | $ n $ | $ a $ |
|:-:|:-:|:-:|:-:|
| 1          | $20$  | $=10$     | $=0$      |
| 2          | $20$  | $ \leq 100 $ | $ \leq 100 $ |
| 3          | $60$  | $ \leq 10^6 $ | $ \leq 10^5 $ |

对于全部数据，保证有 $ 1 \leq n \leq 10^6 $, $ 0 \leq a \leq 10^5 $, $ u_i \neq v_i $, $ b_u \neq b_v $。






---

---
title: "在小小的奶龙山里面挖呀挖呀挖"
layout: "post"
diff: 普及+/提高
pid: P12001
tag: ['洛谷原创', 'O2优化', '最近公共祖先 LCA', '素数判断,质数,筛法', '洛谷月赛']
---
# 在小小的奶龙山里面挖呀挖呀挖
## 题目背景

夏天快要到了，去兴绍奶龙山参加 ION5202 的 0p 决定探究奶龙山的性质。
## 题目描述

奶龙山内部存在复杂的奶龙山隧道，但是聪明的 0p 一眼就看出了 $n-1$ 条奶龙山隧道的结构是一颗树。其中任意两个隧道只在 $n$ 个休息点处相交，两两休息点之间都有路径联通，第 $i$ 个休息点有一个权值 $a_i$，对于每一个素数 $p$，若 $p\mid a_i$ 则说明 $p$ 公司参与了休息点建设。想要经过一个休息点，就必须和所有参与了休息点建设的公司搞好关系。

0p 有 $q$ 条心仪的路线，第 $i$ 条是从休息点 $u$ 走到休息点 $v$，对于每一条路线，0p 想知道，他需要与多少公司搞好关系才可以成功地走完这一条路线。


**请注意算法常数对时间效率的影响**。
## 输入格式

第一行，两个正整数 $n,q$。

第二行，共 $n$ 个正整数，第 $i$ 个正整数表示 $a_i$。

接下来 $n-1$ 行，每行两个正整数 $u,v$，表示一条树边。

接下来 $q$ 行，每行两个正整数 $u,v$，表示一条路线。
## 输出格式

输出共 $q$ 行，对于每一条路线，输出所求的答案。
## 样例

### 样例输入 #1
```
3 1
7 2 1
1 2
1 3
2 3
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
10 7
9 9 8 2 4 4 3 5 3 97
1 2
1 3
3 4
5 2
6 4
7 5
9 1
10 2
3 8
4 5
2 3
4 6
2 4
1 2
4 10
1 1
```
### 样例输出 #2
```
2
2
1
2
1
3
1
```
## 提示

对于 $20\%$ 的数据，满足 $n,q\leq 100$。

对于 $70\%$ 的数据，满足 $n,q\leq 1000$。

对于 $100\%$ 的数据，满足 $1\leq n,q\leq 5\times 10^4$，$1\leq a_i\leq 10^5$，$1\leq u,v\leq n$，保证给出的树合法。


---

---
title: "Brooklyn Round 1 & NNOI Round 1 D - Apples"
layout: "post"
diff: 普及+/提高
pid: P12680
tag: ['动态规划 DP', 'O2优化', '最近公共祖先 LCA']
---
# Brooklyn Round 1 & NNOI Round 1 D - Apples
## 题目描述

小 X 有一颗 $n$ 个结点的树，树的根结点为 $1$，规定根结点的深度为 $1$。树是指一个由 $n$ 个结点，$n-1$ 条双向边组成的连通块。你通过每条边都需要 $1$ 秒。你在每秒钟可以停在原地，也可以经过 $1$ 条边。

树的结点会随机刷新 $m$ 次，第 $i$ 次在 $t_i$ 时刻在 $w_i$ 号结点刷新出 $p_i$ 个苹果，但存在时间只有 $1$，过后会消失。

这颗树有两个特殊的性质：

+ 最深的结点深度不会超过 $s$。

+ 所有的 $t_i$ 均不相同。

最开始时，你在根结点，请问你最多能采多少个苹果。
## 输入格式

第一行 $n,m,s$。

后面 $n-1$ 行，每行两个数，$u_i,v_i$，代表，描述树的一条边。


后面 $m$ 行，每行三个数，$w_i,t_i,p_i$ 代表 $t_i$ 时刻在 $w_i$ 刷新 $p_i$ 个苹果。
## 输出格式

输出一个数，代表最多能摘到的苹果个数。
## 样例

### 样例输入 #1
```
5 3 5
1 2
1 3
2 4
2 5
1 5 3
2 7 8
3 8 10
```
### 样例输出 #1
```
13
```
## 提示

**本题采用捆绑测试。**
| 子任务编号 | $n$ | $m$ | 特殊性质 | 分值|
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $= 5$ | $= 5$ |无 |$10$|
| $2$ | $= 20$ | $= 20$ | 无 |$10$|
| $3$ | 无 | 无 | A |$20$|
| $4$ | 无 | 无 | B |$20$|
| $5$| $= 10^3$ | $= 10^3$ | 无 |$20$|
| $6$| 无 | 无 | 无 |$20$|

对于 $100\%$ 的数据，$1 \le n \le 8 \times 10^4,1 \le m \le 2 \times 10^4,1 \le s \le 10^3,1 \le p_i,t_i \le 10^9,1 \le w_i \le n$。

特殊性质 A：$s = 2$。

特殊性质 B：这棵树是一条以根节点为端点的链。


---

---
title: "[GESP202506 八级] 树上旅行"
layout: "post"
diff: 普及+/提高
pid: P13019
tag: ['倍增', '2025', '最近公共祖先 LCA', 'GESP']
---
# [GESP202506 八级] 树上旅行
## 题目描述



给定一棵有 $ n $ 个结点的 **有根树**，结点依次以 $1,2,\dots,n$ 编号，其中根结点的编号为 $1$。

小 A 计划在这棵有根树上进行 $q$ 次旅行。在第 $i$ 次旅行中，小 A 首先选定结点 $s_i$ 作为起点，并移动若干次。移动分为以下两种：

1. 移动至当前结点的父结点。特殊地，如果当前位于根结点，则不进行移动。
2. 移动至当前结点的所有子结点中**编号最小**的结点。特殊地，如果当前位于叶子结点，则不进行移动。

由于移动次数可能很大，对于第 $i$ 次旅行，旅行中的移动以 $k_i$ 个不为零的整数构成的序列 $a_{i,1}, a_{i,2}, \dots, a_{i,k_i}$ 表示。对 $a_{i,j}$，若 $a_{i,j} > 0$ 则代表进行 $a_{i,j}$ 次第一种移动；若 $a_{i,j} < 0$ 则代表进行 $-a_{i,j}$ 次第二种移动。根据给出的序列从左至右完成所有移动后，小 A 所在的结点即是旅行的**终点**。

给定每次旅行的起点与移动序列，请你求出旅行终点的结点编号。

## 输入格式



第一行，两个正整数 $n, q$，分别表示有根树的结点数量，以及旅行次数。

第二行，$n-1$ 个整数 $p_2, p_3, \dots, p_n$，其中 $p_i$ 表示结点 $i$ 的父结点编号。

接下来 $2q$ 行中的第 $2i-1$ 行（$1 \leq i \leq q$）包含两个正整数 $s_i, k_i$，分别表示第 $i$ 次旅行的起点编号，以及移动序列的长度。第 $2i$ 行包含 $k_i$ 个整数 $a_{i,1}, a_{i,2}, \dots, a_{i,k_i}$，表示移动序列。
## 输出格式


输出共 $q$ 行，第 $i$ 行包含一个整数，表示第 $i$ 次旅行终点的结点编号。
## 样例

### 样例输入 #1
```
5 4
1 1 2 2
3 3
1 -1 -1
2 5
1 -1 1 -1 1
5 8
1 1 1 -1 -1 -1 -1 -1
5 3
-1 -1 1
```
### 样例输出 #1
```
4
1
4
2
```
### 样例输入 #2
```
8 3
5 4 2 1 3 6 6
8 1
8
8 2
8 -8
8 3
8 -8 8
```
### 样例输出 #2
```
1
7
1
```
## 提示



| 子任务编号 | 测试点占比 | $n$ | $q$ | $\sum k_i$ | 特殊性质 |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $1$          | $20\%$         | $\leq 100$ | $\leq 100$ | $\leq 1000$ | 保证 $a_{i,j}$ 为 $1$ 或 $-1$ |
| $2$          | $20\%$         | $\leq 10^4$ | $\leq 10^4$ | $\leq 4 \times 10^4$ | 仅包含第一种移动 |
| $3$          | $20\%$         | $\leq 10^4$ | $\leq 10^4$ | $\leq 4 \times 10^4$ | 仅包含第二种移动 |
| $4$          | $40\%$         | $\leq 10^5$ | $\leq 2 \times 10^4$ | $\leq 10^5$ | - |

对于所有测试点，保证：

- $1 \leq n \leq 10^5$
- $1 \leq q \leq 2 \times 10^4$
- $1 \leq p_i \leq n$
- $1 \leq s_i \leq n$
- $k_i \geq 1$ 且 $\sum k_i \leq 10^5$
- $1 \leq |a_{i,j}| \leq n$



---

---
title: "[USACO09JAN] Laserphones S"
layout: "post"
diff: 普及+/提高
pid: P2937
tag: ['2009', 'USACO', '并查集', '广度优先搜索 BFS', '深度优先搜索 DFS', '最短路', '最近公共祖先 LCA']
---
# [USACO09JAN] Laserphones S
## 题目描述

The cows have a new laser-based system so they can have casual conversations while out in the pasture which is modeled as a W x H grid of points (1 <= W <= 100; 1 <= H <= 100).

The system requires a sort of line-of-sight connectivity in order to sustain communication. The pasture, of course, has rocks and trees that disrupt the communication but the cows have purchased diagonal mirrors ('/' and '\' below) that deflect the laser beam through a 90 degree turn. Below is a map that illustrates the

problem.

H is 8 and W is 7 for this map.  The two communicating cows are notated as 'C's; rocks and other blocking elements are notated as '\*'s:

```plain
7 . . . . . . .         7 . . . . . . . 
6 . . . . . . C         6 . . . . . /-C 
5 . . . . . . *         5 . . . . . | * 
4 * * * * * . *         4 * * * * * | * 
3 . . . . * . .         3 . . . . * | . 
2 . . . . * . .         2 . . . . * | . 
1 . C . . * . .         1 . C . . * | . 
0 . . . . . . .         0 . \-------/ . 
0 1 2 3 4 5 6           0 1 2 3 4 5 6 
```
Determine the minimum number of mirrors M that must be installed to maintain laser communication between the two cows, a feat which is always possible in the given test data.

## 输入格式

\* Line 1: Two space separated integers: W and H

\* Lines 2..H+1: The entire pasture.

## 输出格式

\* Line 1: A single integer: M

## 样例

### 样例输入 #1
```
7 8 
....... 
......C 
......* 
*****.* 
....*.. 
....*.. 
.C..*.. 
....... 

```
### 样例输出 #1
```
3 

```
## 题目翻译

奶牛们都改用激光进行通讯了。

在 $W\times H$ 的牧场上，一些地方有树木和石头遮挡激光，所以，奶牛打算使用对角镜来进行激光通讯。两只奶牛的位置是固定的，对角镜能把光线旋转 $90$ 度。

下图是一个例子：

```plain
7 . . . . . . .         7 . . . . . . . 
6 . . . . . . C         6 . . . . . /-C 
5 . . . . . . *         5 . . . . . | * 
4 * * * * * . *         4 * * * * * | * 
3 . . . . * . .         3 . . . . * | . 
2 . . . . * . .         2 . . . . * | . 
1 . C . . * . .         1 . C . . * | . 
0 . . . . . . .         0 . \-------/ . 
0 1 2 3 4 5 6           0 1 2 3 4 5 6 
```

其中 $\verb!*!$ 表示障碍物，$\verb!C!$ 表示奶牛，$\verb!/!$ 和 $\verb!\!$ 表示两种对角镜。

请求出最少需要安装的对角镜的数量，使得两只奶牛可以通讯。


---

---
title: "[USACO15DEC] Max Flow P"
layout: "post"
diff: 普及+/提高
pid: P3128
tag: ['2015', 'USACO', '最近公共祖先 LCA', '树链剖分', '差分']
---
# [USACO15DEC] Max Flow P
## 题目描述

Farmer John has installed a new system of $N-1$ pipes to transport milk between the $N$ stalls in his barn ($2 \leq N \leq 50,000$), conveniently numbered $1 \ldots N$. Each pipe connects a pair of stalls, and all stalls are connected to each-other via paths of pipes.

FJ is pumping milk between $K$ pairs of stalls ($1 \leq K \leq 100,000$). For the $i$th such pair,  you are told two stalls $s_i$ and $t_i$, endpoints of a path along which milk is being pumped at a unit rate. FJ is concerned that some stalls might end up overwhelmed with all the milk being pumped through them, since a stall can serve as a waypoint along many of the $K$ paths along which milk is being pumped. Please help him determine the maximum amount of milk being pumped through any stall. If milk is being pumped along a path from $s_i$ to $t_i$, then it counts as being pumped through the endpoint stalls $s_i$ and $t_i$, as well as through every stall along the path between them.
## 输入格式

The first line of the input contains $N$ and $K$.

The next $N-1$ lines each contain two integers $x$ and $y$ ($x \ne y$) describing a pipe between stalls $x$ and $y$.

The next $K$ lines each contain two integers $s$ and $t$ describing the endpoint stalls of a path through which milk is being pumped.

## 输出格式

An integer specifying the maximum amount of milk pumped through any stall in the barn.
## 样例

### 样例输入 #1
```
5 10
3 4
1 5
4 2
5 4
5 4
5 4
3 5
4 3
4 3
1 3
3 5
5 4
1 5
3 4
```
### 样例输出 #1
```
9
```
## 提示

$2 \le N \le 5 \times 10^4,1 \le K \le 10^5$
## 题目翻译

### 题目描述

Farmer John 在他的谷仓中安装了 $N-1$ 条管道，用于在 $N$ 个牛棚之间运输牛奶（$2 \leq N \leq 50,000$），牛棚方便地编号为 $1 \ldots N$。每条管道连接一对牛棚，所有牛棚通过这些管道相互连接。

FJ 正在 $K$ 对牛棚之间泵送牛奶（$1 \leq K \leq 100,000$）。对于第 $i$ 对牛棚，你被告知两个牛棚 $s_i$ 和 $t_i$，这是牛奶以单位速率泵送的路径的端点。FJ 担心某些牛棚可能会因为过多的牛奶通过它们而不堪重负，因为一个牛棚可能会作为许多泵送路径的中转站。请帮助他确定通过任何一个牛棚的最大牛奶量。如果牛奶沿着从 $s_i$ 到 $t_i$ 的路径泵送，那么它将被计入端点牛棚 $s_i$ 和 $t_i$，以及它们之间路径上的所有牛棚。

### 输入格式

输入的第一行包含 $N$ 和 $K$。

接下来的 $N-1$ 行每行包含两个整数 $x$ 和 $y$（$x \ne y$），描述连接牛棚 $x$ 和 $y$ 的管道。

接下来的 $K$ 行每行包含两个整数 $s$ 和 $t$，描述牛奶泵送路径的端点牛棚。

### 输出格式

输出一个整数，表示通过谷仓中任何一个牛棚的最大牛奶量。

### 说明/提示

$2 \le N \le 5 \times 10^4,1 \le K \le 10^5$。


---

---
title: "[JLOI2014] 松鼠的新家"
layout: "post"
diff: 普及+/提高
pid: P3258
tag: ['2014', '线段树', '吉林', '最近公共祖先 LCA', '树链剖分', '差分']
---
# [JLOI2014] 松鼠的新家
## 题目描述

松鼠的新家是一棵树，前几天刚刚装修了新家，新家有$n$ 个房间，并且有 $n-1$ 根树枝连接，每个房间都可以相互到达，且俩个房间之间的路线都是唯一的。天哪，他居然真的住在“树”上。

松鼠想邀请小熊维尼前来参观，并且还指定一份参观指南，他希望维尼能够按照他的指南顺序，先去 $a_1$，再去 $a_2$，……，最后到 $a_n$，去参观新家。可是这样会导致重复走很多房间，懒惰的维尼不停地推辞。可是松鼠告诉他，每走到一个房间，他就可以从房间拿一块糖果吃。

维尼是个馋家伙，立马就答应了。现在松鼠希望知道为了保证维尼有糖果吃，他需要在每一个房间各放至少多少个糖果。

因为松鼠参观指南上的最后一个房间 $a_n$ 是餐厅，餐厅里他准备了丰盛的大餐，所以当维尼在参观的最后到达餐厅时就不需要再拿糖果吃了。
## 输入格式

第一行一个正整数 $n$，表示房间个数第二行 $n$ 个正整数，依次描述 $a_1, a_2,\cdots,a_n$。

接下来 $n-1$ 行，每行两个正整数 $x,y$，表示标号 $x$ 和 $y$ 的两个房间之间有树枝相连。
## 输出格式

一共 $n$ 行，第 $i$ 行输出标号为 $i$ 的房间至少需要放多少个糖果，才能让维尼有糖果吃。
## 样例

### 样例输入 #1
```
5
1 4 5 3 2
1 2
2 4
2 3
4 5
```
### 样例输出 #1
```
1
2
1
2
1
```
## 提示

对于全部的数据，$2 \le n \le 3 \times 10^5$，$1 \le a_i \le n$。


---

---
title: "仓鼠找 sugar"
layout: "post"
diff: 普及+/提高
pid: P3398
tag: ['倍增', 'Tarjan', '最近公共祖先 LCA', '洛谷月赛']
---
# 仓鼠找 sugar
## 题目描述

小仓鼠的和他的基（mei）友（zi）sugar 住在地下洞穴中，每个节点的编号为 $1\sim n$。地下洞穴是一个树形结构。这一天小仓鼠打算从从他的卧室（$a$）到餐厅（$b$），而他的基友同时要从他的卧室（$c$）到图书馆（$d$）。他们都会走最短路径。现在小仓鼠希望知道，有没有可能在某个地方，可以碰到他的基友？


小仓鼠那么弱，还要天天被 zzq 大爷虐，请你快来救救他吧！

## 输入格式

第一行两个正整数 $n$ 和 $q$，表示这棵树节点的个数和询问的个数。

接下来 $n-1$ 行，每行两个正整数 $u$ 和 $v$，表示节点 $u$ 到节点 $v$ 之间有一条边。

接下来 $q$ 行，每行四个正整数 $a$、$b$、$c$ 和 $d$，表示节点编号，也就是一次询问，其意义如上。

## 输出格式

对于每个询问，如果有公共点，输出大写字母 `Y`；否则输出`N`。

## 样例

### 样例输入 #1
```
5 5
2 5
4 2
1 3
1 4
5 1 5 1
2 2 1 4
4 1 3 4
3 1 1 5
3 5 1 4
```
### 样例输出 #1
```
Y
N
Y
Y
Y
```
## 提示

**本题时限 1s，内存限制 128M，因新评测机速度较为接近 NOIP 评测机速度，请注意常数问题带来的影响。**


$20\%$ 的数据 $n, q\le200$。

$40\%$ 的数据 $n, q\le 2\times10^3$。

$70\%$ 的数据 $n, q\le 5\times10^4$。

$100\%$ 的数据 $1\le n, q\le10^5$。



---

---
title: "斐波那契"
layout: "post"
diff: 普及+/提高
pid: P3938
tag: ['2017', '二分', 'O2优化', '最近公共祖先 LCA', '斐波那契数列']
---
# 斐波那契
## 题目背景

大样例可在页面底部「附件」中下载。
## 题目描述

小 C 养了一些很可爱的兔子。 有一天，小 C 突然发现兔子们都是严格按照伟大的数学家斐波那契提出的模型来进行 繁衍：一对兔子从出生后第二个月起，每个月刚开始的时候都会产下一对小兔子。我们假定， 在整个过程中兔子不会出现任何意外。

小 C 把兔子按出生顺序，把兔子们从 1 开始标号，并且小 C 的兔子都是 1 号兔子和 1 号兔子的后代。如果某两对兔子是同时出生的，那么小 C 会将父母标号更小的一对优先标 号。

如果我们把这种关系用图画下来，前六个月大概就是这样的：

 
  ![](https://cdn.luogu.com.cn/upload/pic/9806.png) 

其中，一个箭头 $A \to B$ 表示 $A$ 是 $B$ 的祖先，相同的颜色表示同一个月出生的兔子。

为了更细致地了解兔子们是如何繁衍的，小 C 找来了一些兔子，并且向你提出了 $m$ 个问题：她想知道关于每两对兔子 $a_i$ 和 $b_i$，他们的最近公共祖先是谁。你能帮帮小 C 吗？

一对兔子的祖先是这对兔子以及他们父母（如果有的话）的祖先，而最近公共祖先是指 两对兔子所共有的祖先中，离他们的距离之和最近的一对兔子。比如，$5$ 和 $7$ 的最近公共祖 先是 $2,1$ 和 $2$ 的最近公共祖先是 $1,6$ 和 $6$ 的最近公共祖先是 $6$。

## 输入格式

输入第一行，包含一个正整数 $m$。输入接下来 $m$ 行，每行包含 $2$ 个正整数，表示 $a_i$ 和 $b_i$。

## 输出格式

输出一共 $m$ 行，每行一个正整数，依次表示你对问题的答案。

## 样例

### 样例输入 #1
```
5 
1 1 
2 3 
5 7 
7 13 
4 12
```
### 样例输出 #1
```
1 
1 
2 
2 
4 
```
## 提示

【数据范围与约定】 子任务会给出部分测试数据的特点。如果你在解决题目中遇到了困难，可以尝试只解决一部分测试数据。 每个测试点的数据规模及特点如下表：

 ![](https://cdn.luogu.com.cn/upload/pic/9807.png) 

特殊性质 $1$：保证 $a_i$, $b_i$ 均为某一个月出生的兔子中标号最大的一对兔子。例如，对 于前六个月，标号最大的兔子分别是 $1, 2, 3, 5, 8, 13$。

特殊性质 $2$：保证 $|a_i-b_i|\le 1$。



---

---
title: "[AHOI2008] 紧急集合 / 聚会"
layout: "post"
diff: 普及+/提高
pid: P4281
tag: ['2008', '倍增', '各省省选', '安徽', '最近公共祖先 LCA', '树链剖分']
---
# [AHOI2008] 紧急集合 / 聚会
## 题目描述

欢乐岛上有个非常好玩的游戏，叫做“紧急集合”。在岛上分散有 $n$ 个等待点，有 $n-1$ 条道路连接着它们，每一条道路都连接某两个等待点，且通过这些道路可以走遍所有的等待点，通过道路从一个点到另一个点要花费一个游戏币。

参加游戏的人三人一组，开始的时候，所有人员均任意分散在各个等待点上（每个点同时允许多个人等待），每个人均带有足够多的游戏币（用于支付使用道路的花费）、地图（标明等待点之间道路连接的情况）以及对话机（用于和同组的成员联系）。当集合号吹响后，每组成员之间迅速联系，了解到自己组所有成员所在的等待点后，迅速在 $n$ 个等待点中确定一个集结点，组内所有成员将在该集合点集合，集合所用花费最少的组将是游戏的赢家。

小可可和他的朋友邀请你一起参加这个游戏，由你来选择集合点，聪明的你能够完成这个任务，帮助小可可赢得游戏吗？

## 输入格式

第一行两个正整数 $n$ 和 $m$，分别表示等待点的个数（等待点也从 $1$ 到 $n$ 进行编号）和获奖所需要完成集合的次数。

随后 $n-1$ 行，每行两个正整数 $a,b$，表示编号为 $a$ 和编号为 $b$ 的等待点之间有一条路。

随后 $m$ 行，每行用三个正整数 $x,y,z$，表示某次集合前小可可、小可可的朋友以及你所在等待点的编号。
## 输出格式

输出共 $m$ 行，每行两个用空格隔开的整数 $p,c$。其中第 $i$ 行表示第 $i$ 次集合点选择在编号为 $p$ 的等待点，集合总共的花费是 $c$ 个游戏币。
## 样例

### 样例输入 #1
```
6 4  
1 2  
2 3  
2 4 
4 5
5 6
4 5 6
6 3 1
2 4 4 
6 6 6
```
### 样例输出 #1
```
5 2
2 5
4 1
6 0



```
## 提示

对于 $40\%$ 的数据，$n\leq2\times10^3$，$m\leq2\times 10^3$。

对于 $100\%$ 的数据，$1\leq x,y,z\leq n\leq 5\times10^5$，$1\leq m\leq 5\times 10^5$。


---

---
title: "[BJOI2018] 求和"
layout: "post"
diff: 普及+/提高
pid: P4427
tag: ['2018', '倍增', '各省省选', '北京', 'O2优化', '深度优先搜索 DFS', '最近公共祖先 LCA', '树链剖分', '前缀和']
---
# [BJOI2018] 求和
## 题目描述

master 对树上的求和非常感兴趣。他生成了一棵有根树，并且希望多次询问这棵树上一段路径上所有节点深度的 $k$ 次方和，而且每次的 $k$ 可能是不同的。此处节点深度的定义是这个节点到根的路径上的边数。他把这个问题交给了 pupil，但 pupil 并不会这么复杂的操作，你能帮他解决吗？
## 输入格式

第一行包含一个正整数 $n$，表示树的节点数。

之后 $n-1$ 行每行两个空格隔开的正整数 $i, j$，表示树上的一条连接点 $i$ 和点 $j$ 的边。

之后一行一个正整数 $m$，表示询问的数量。

之后每行三个空格隔开的正整数 $i, j, k$，表示询问从点 $i$ 到点 $j$ 的路径上所有节点深度的 $k$ 次方和。由于这个结果可能非常大，输出其对 $998244353$ 取模的结果。

树的节点从 $1$ 开始标号，其中 $1$ 号节点为树的根。
## 输出格式

对于每组数据输出一行一个正整数表示取模后的结果。

## 样例

### 样例输入 #1
```
5
1 2
1 3
2 4
2 5
2
1 4 5
5 4 45
```
### 样例输出 #1
```
33
503245989
```
## 提示

### 样例解释

以下用 $d (i)$ 表示第 $i$ 个节点的深度。

对于样例中的树，有 $d (1) = 0, d (2) = 1, d (3) = 1, d (4) = 2, d (5) = 2$。

因此第一个询问答案为 $(2^5 + 1^5 + 0^5) \bmod 998244353 = 33$，第二个询问答案为$(2^{45} + 1^{45} + 2^{45}) \bmod 998244353 = 503245989$。

### 数据范围

对于 $30\%$ 的数据，$1 \leq n,m \leq 100$。

对于 $60\%$ 的数据，$1 \leq n,m \leq 1000$。

对于 $100\%$ 的数据，$1 \leq n,m \leq 300000$，$1 \leq k \leq 50$。

另外存在 5 个不计分的 hack 数据。

### 提示

数据规模较大，请注意使用较快速的输入输出方式。


---

---
title: "[USACO19DEC] Milk Visits S"
layout: "post"
diff: 普及+/提高
pid: P5836
tag: ['树形数据结构', '2019', 'USACO', '并查集', '最近公共祖先 LCA']
---
# [USACO19DEC] Milk Visits S
## 题目描述

Farmer John 计划建造 $N$ 个农场，用 $N-1$ 条道路连接，构成一棵树（也就是说，所有农场之间都互相可以到达，并且没有环）。每个农场有一头奶牛，品种为更赛牛或荷斯坦牛之一。

Farmer John 的 $M$ 个朋友经常前来拜访他。在朋友 $i$ 拜访之时，Farmer John 会与他的朋友沿着从农场 $A_i$ 到农场 $B_i$ 之间的唯一路径行走（可能有 $A_i = B_i$）。除此之外，他们还可以品尝他们经过的路径上任意一头奶牛的牛奶。由于 Farmer John 的朋友们大多数也是农场主，他们对牛奶有着极强的偏好。他的有些朋友只喝更赛牛的牛奶，其余的只喝荷斯坦牛的牛奶。任何 Farmer John 的朋友只有在他们访问时能喝到他们偏好的牛奶才会高兴。

请求出每个朋友在拜访过后是否会高兴。
## 输入格式

输入的第一行包含两个整数 $N$ 和 $M$。

第二行包含一个长为 $N$ 的字符串。如果第 $i$ 个农场中的奶牛是更赛牛，则字符串中第 $i$ 个字符为 `G`，如果第 $i$ 个农场中的奶牛是荷斯坦牛则为 `H`。

以下 $N-1$ 行，每行包含两个不同的整数 $X$ 和 $Y$（$1 \leq X, Y \leq N$），表示农场 $X$ 与 $Y$ 之间有一条道路。

以下 $M$ 行，每行包含整数 $A_i$，$B_i$，以及一个字符 $C_i$。$A_i$ 和 $B_i$ 表示朋友 $i$ 拜访时行走的路径的端点，$C_i$ 是 `G` 或 `H` 之一，表示第 $i$ 个朋友喜欢更赛牛的牛奶或是荷斯坦牛的牛奶。
## 输出格式

输出一个长为 $M$ 的二进制字符串。如果第 $i$ 个朋友会感到高兴，则字符串的第 $i$ 个字符为 `1`，否则为 `0`。
## 样例

### 样例输入 #1
```
5 5
HHGHG
1 2
2 3
2 4
1 5
1 4 H
1 4 G
1 3 G
1 3 H
5 5 H
```
### 样例输出 #1
```
10110
```
## 提示

在这里，从农场 1 到农场 4 的路径包括农场 1、2 和 4。所有这些农场里都是荷斯坦牛，所以第一个朋友会感到满意，而第二个朋友不会。

关于部分分：

测试点 $1$ 样例。

测试点 $2\sim 5$ 满足 $N\le 10^3$，$M\le 2\cdot 10^3$。

对于 $100\%$ 的数据，$1 \leq N \leq 10^5$，$1 \leq M \leq 10^5$。

供题：Spencer Compton


---

---
title: "[蓝桥杯 2022 国 B] 机房"
layout: "post"
diff: 普及+/提高
pid: P8805
tag: ['2022', '最近公共祖先 LCA', '前缀和', '蓝桥杯国赛']
---
# [蓝桥杯 2022 国 B] 机房
## 题目描述

这天，小明在机房学习。

他发现机房里一共有 $n$ 台电脑，编号为 1 到 $n$，电脑和电脑之间有网线连接，一共有 $n-1$ 根网线将 $n$ 台电脑连接起来使得任意两台电脑都直接或者间接地相连。

小明发现每台电脑转发、发送或者接受信息需要的时间取决于这台电脑和多少台电脑直接相连，而信息在网线中的传播时间可以忽略。比如如果某台电脑用网线直接连接了另外 $d$ 台电脑, 那么任何经过这台电脑的信息都会延迟 $d$ 单位时间 (发送方和接收方也会产生这样的延迟，当然如果发送方和接收方都是 同一台电脑就只会产生一次延迟)。

小明一共产生了 $m$ 个疑问：如果电脑 $u_{i}$ 向电脑 $v_{i}$ 发送信息，那么信息从 $u_{i}$ 传到 $v_{i}$ 的最短时间是多少?

## 输入格式

输入共 $n+m$ 行，第一行为两个正整数 $n, m$ 。

后面 $n-1$ 行，每行两个正整数 $x, y$ 表示编号为 $x$ 和 $y$ 的两台电脑用网线 直接相连。

后面 $m$ 行，每行两个正整数 $u_{i}, v_{i}$ 表示小明的第 $i$ 个疑问。

## 输出格式

输出共 $m$ 行，第 $i$ 行一个正整数表示小明第 $i$ 个疑问的答案。
## 样例

### 样例输入 #1
```
4 3
1 2
1 3
2 4
2 3
3 4
3 3
```
### 样例输出 #1
```
5
6
1
```
## 提示

**【样例说明】**

这四台电脑各自的延迟分别为 $2,2,1,1$ 。

对于第一个询问, 从 $2$ 到 $3$ 需要经过 $2,1,3$, 所以时间和为 $2+2+1=5$。对于第二个询问，从 $3$ 到 $4$ 需要经过 $3,1,2,4$，所以时间和为 $1+2+2+1=6$。

对于第三个询问，从 $3$ 到 $3$ 只会产生一次延迟, 所以时间为 1。

**【评测用例规模与约定】**

对于 $30 \%$ 的数据，保证 $n, m \leq 1000$;

对于 $100 \%$ 的数据，保证 $n, m \leq 10^5$。

蓝桥杯 2022 国赛 B 组 H 题。


---

---
title: "[POI 2002] 商务旅行"
layout: "post"
diff: 普及+/提高
pid: P8855
tag: ['2002', 'POI（波兰）', '最近公共祖先 LCA']
---
# [POI 2002] 商务旅行
## 题目描述

某地首都的商人要经常到其他城镇去做生意，他们会按自己的路线去走。

有 $N$ 个城镇，首都编号为 $1$。商人从首都出发，其他各城镇之间都有道路连接。

任意两个城镇之间如果有直连道路，在他们之间行驶需要花费单位时间。如果从首都出发，能到达任意一个城镇。

请你求出商人最短的旅行时间。
## 输入格式

第一行有一个整数 $N$，为城镇的数目。

接下来 $N-1$ 行，每行两个整数 $a$ 和 $b$，表示城镇 $a$ 和城镇 $b$ 有公路连接。

接下来一个整数 $M$，然后 $M$ 行，每行有该商人需要顺次经过的各城镇编号。
## 输出格式

一行，输出商人最短的旅行时间。
## 样例

### 样例输入 #1
```
5
1 2
1 5
3 5
4 5
4
1
3
2
5
```
### 样例输出 #1
```
7
```
## 提示

数据范围：$1 \le N \le 30000$。**保证公路网络不会存在环。**


---

---
title: "『GROI-R1』 一切都已过去"
layout: "post"
diff: 普及+/提高
pid: P8972
tag: ['图论', 'O2优化', '最近公共祖先 LCA']
---
# 『GROI-R1』 一切都已过去
## 题目背景

悦关上窗，拉上帘布。

果然还是想不起来啊。

隐约记得曾和什么人一起做过这样的事。

仰面躺下，手执一只木笺。

「究竟如何，才能拥有“过去”啊……」

她闭上双眼。

「6 岁前的记忆……究竟如何才能寻回？」
## 题目描述

悦正在寻找她的记忆。忽然，她来到了有 $n$ 个节点的一棵树上。树上每一条边都有各自边权，每一个点都有各自的点权。

「把经历都聚拢起来，能完整地复原吗……」

悦从树上的一个点，慢慢地走到了另一个点，可是她什么也没找到。但是，她不知道，玘一直在远处望着她走过的道路。

玘发现，悦全程****没有走回头路****。他想把悦****走过的每一条边的边权乘起来****，可惜他发现他遇到了一个这一生未曾见到过的数字。

「为什么会这样呢？」

玘想到悦是突然出现在树上的，最初的点一定有蹊跷！他****把最初那个点的点权乘上****……

突然，一束彼岸花的红光亮起！世界重新安静了下来。

悦看到了玘留下的字样，可惜她不能从中看出任何过去的记忆。现在，你要帮她判断：把经历都聚拢起来，****能完整地复原过去吗****？我们称悦的一条路径能“复原过去”，当且仅当玘****留下的乘积是一个整数****。

**形式化题面**

给定一棵 $n$ 个节点的树和 $q$ 次询问。每次询问给出两个整数 $x,y$，表示询问树上以 $x$ 和 $y$ 为端点的简单路径上边权乘积与点 $x$ 的点权相乘是否为整数。
## 输入格式

第一行两个正整数 $n$ 和 $q$，表示树上有 $n$ 个节点编号为 $1\sim n$，悦在树上走了 $q$ 条路径。

接下来一行 $n$ 个非负整数表示每个点的点权 $a_i$。

接下来 $n-1$ 行每行两个正整数 $u,v$ 和一个非负实数 $w$ 表示 $u,v$ 间有一条边权为 $w$ 的边。

接下来 $q$ 行，每行两个正整数 $x,y$，表示悦从点 $x$ 开始走到了点 $y$。
## 输出格式

对于悦的每一次询问，你需要输出一行一个字符串。如果悦能够成功复原她的过去，请输出 `Yes`，否则请输出 `No`。
## 样例

### 样例输入 #1
```
5 3
1 2 3 4 5
1 2 0.1
2 3 0.20
3 4 0.5
2 5 0.99
1 5
1 4
4 3
```
### 样例输出 #1
```
No
No
Yes
```
## 提示

**样例解释**

根据输入可以得到下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/3e4jqu6f.png)

对于第一个询问 $(1,5)$ 可以发现悦经过的边的边权分别是 $0.1$ 和 $0.99$，她出发的 $1$ 号点的点权为 $1$。$1\times0.1\times0.99=0.099$ 不是整数。所以输出 `No`。

对于后面两次询问同理。

**数据范围**

**本题采用捆绑测试。**

| 子任务编号 | 数据范围 | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| $\text{Subtask1}$ | $n,q\le3\times 10^3$ |  | $15$ |
| $\text{Subtask2}$ | $n\le500$，$q\le10^5$ |  | $10$ |
| $\text{Subtask3}$ | $n,q\le10^5$ | $\text{BE}$ | $10$ |
| $\text{Subtask4}$ | $n,q\le10^5$ | $\text{A}$ | $5$ |
| $\text{Subtask5}$ | $n,q\le10^5$ | $\text{B}$ | $10$ |
| $\text{Subtask6}$ | $n,q\le10^5$ | $\text{C}$ | $5$ |
| $\text{Subtask7}$ | $n,q\le10^5$ | $\text{D}$ | $10$ |
| $\text{Subtask8}$ | $n,q\le2×10^5$ |  | $35$ |

特殊性质 $\text{A}$：保证树退化成一条链。

特殊性质 $\text{B}$：保证树随机生成（即对于每一个节点随机选择它的父亲节点）。

特殊性质 $\text{C}$：保证 $w\in\{0.1,0.3,0.5,0.7,0.9\}$。

特殊性质 $\text{D}$：保证 $w\in\{0.1,0.2,0.3,0.4,0.6,0.7,0.8,0.9\}$。

特殊性质 $\text{E}$：保证 $w\le2$ 且 $w$ 小数位数不超过 $1$ 位。

对于 $100\%$ 的数据满足 $1\le n,q\le2\times10^5$，$0\le a_i\le10^9$，$0\le w\le10^4$，$1\le u,v,x,y\le n$，$x\ne y$，$w$ 小数位数不超过 $4$ 位。


---

---
title: "「TAOI-1」Apollo"
layout: "post"
diff: 普及+/提高
pid: P9218
tag: ['O2优化', '深度优先搜索 DFS', '最近公共祖先 LCA', '进制', '字典树 Trie', '单调栈']
---
# 「TAOI-1」Apollo
## 题目背景

Execution.

这题原来叫 `std::cout << std::fixed << std::setprecision(1) << 6.5 << '\n';`。

[被当事人删掉的图片.jpg]

**【Upd 2023/04/15 21:42】添加了一组 Hack 数据位于 Subtask 2，#13。现在所有赛时的 $\bm{50}$ 分提交理论上均只能获得 $\bm{30}$ 分。**
## 题目描述

给出 $n$ 个十进制小数 $a_1 \dots a_n$。

对于一个 **数** $a$，定义其精度 $f(a)$ 表示最小的非负整数 $k$ 使得 $10^k\times a$ 为整数；对于整数 $a$，定义 $f(a) = 0$。对于两个十进制小数 $a, b$，定义 $g(a, b)$ 为对于所有 **数** $c \in [\min(a,b), \max(a,b)]$ 的 $f(c)$ 的最小值。

对于所有 $1 \leq i \leq n$，你需要求出 $\sum\limits_{j=1}^ng(a_i, a_j)$ 的值并输出。

定义十进制小数是一个含有整数部分和小数部分的数，其小数部分不为 $0$。之所以描述得这么愚蠢是因为保证输入的每个数都有小数点，但是好像无论什么写法都会有人提出不满，真是抱歉了。~~所以还是得看看被当事人删掉的图片。所以我在这里写闲话有人看得到吗。~~
## 输入格式

第一行一个整数 $n$。

接下来 $n$ 行，每行一个十进制小数 $a_i$。
## 输出格式

$n$ 行，每行一个整数，分别表示 $i = 1 \dots n$ 对应的答案。
## 样例

### 样例输入 #1
```
5
11.4514
11.4778
11.1338
11.1236
11.4789
```
### 样例输出 #1
```
10
11
9
9
11
```
### 样例输入 #2
```
8
1.1145
1.114
1.1145
1.514
1.19198
1.1154
1.114
1.1145
```
### 样例输出 #2
```
24
21
24
10
18
22
21
24
```
## 提示

### 数据范围

**本题采用捆绑测试。**

令 $\sum\limits_{i=1}^n f(a_i) = t$。

- Subtask 1（15 points）：$a_i \leq 10$，$n \leq 5$，$t \leq 10$。
- Subtask 2（15 points）：$a_i \leq 10$，$n \leq 100$，$t \leq 1000$。
- Subtask 3（20 points）：$n \leq 1722$。
- Subtask 4（15 points）：$a_i \leq 1$。
- Subtask 5（35 points）：无特殊限制。

对于所有数据，$0 \lt a_i \lt 10^9$，$1 \leq n \leq 10^5$，$1 \leq t \leq 3 \times 10^6$，**保证 $\bm{a_i}$ 没有后导 [$\color{black}\bm 0$](https://cdn.luogu.com.cn/upload/image_hosting/pg66fm1z.png)，不保证 $\bm{a_i}$ 互不相同**。

### 样例解释

以 $i = 1$ 为例：

+ $j = 1$：取 $c = 11.4514$，$f(c) = 4$；
+ $j = 2$：取 $c = 11.46$，$f(c) = 2$；
+ $j = 3$：取 $c = 11.2$，$f(c) = 1$；
+ $j = 4$：取 $c = 11.3$，$f(c) = 1$；
+ $j = 5$：取 $c = 11.47$，$f(c) = 2$。

故 $\sum\limits_{j=1}^n g(a_1, a_j) = 4 + 2 + 1 + 1 + 2 = 10$。对于同一个 $j$，上文给出的所有 $c$，都可能有其它的不同的 $c$ 满足 $f(c)$ 同样最小。


---

---
title: "[蓝桥杯 2023 省 B] 景区导游"
layout: "post"
diff: 普及+/提高
pid: P9245
tag: ['2023', '最近公共祖先 LCA', '蓝桥杯省赛']
---
# [蓝桥杯 2023 省 B] 景区导游
## 题目描述

某景区一共有 $N$ 个景点，编号 $1$ 到 $N$。景点之间共有 $N-1$ 条双向的摆渡车线路相连，形成一棵树状结构。在景点之间往返只能通过这些摆渡车进行，需要花费一定的时间。

小明是这个景区的资深导游，他每天都要按固定顺序带客人游览其中 $K$ 个景点：$A_{1},A_{2},\ldots,A_{K}$。今天由于时间原因，小明决定跳过其中一个景点，只带游客按顺序游览其中 $K-1$ 个景点。具体来说，如果小明选择跳过 $A_{i}$，那么他会按顺序带游客游览 $A_{1},A_{2},\ldots,A_{i-1},A_{i+1},\ldots,A_{K}(1 \leq i \leq K)$。

请你对任意一个 $A_{i}$，计算如果跳过这个景点，小明需要花费多少时间在景点之间的摆渡车上？
## 输入格式

第一行包含 $2$ 个整数 $N$ 和 $K$。

以下 $N-1$ 行，每行包含 $3$ 个整数 $u，v, t$，代表景点 $u$ 和 $v$ 之间有摆渡车线路，花费 $t$ 个单位时间。

最后一行包含 $K$ 个整数 $A_{1},A_{2},\ldots,A_{K}$ 代表原定游览线路。
## 输出格式

输出 $K$ 个整数，其中第 $i$ 个代表跳过 $A_{i}$ 之后，花费在摆渡车上的时间。
## 样例

### 样例输入 #1
```
6 4
1 2 1
1 3 1
3 4 2
3 5 2
4 6 3
2 6 5 1
```
### 样例输出 #1
```
10 7 13 14

```
## 提示

**【样例说明】**

原路线是 $2 \rightarrow 6 \rightarrow 5 \rightarrow 1$。

当跳过 $2$ 时，路线是 $6 \rightarrow 5 \rightarrow 1$，其中 $6 \rightarrow 5$ 花费时间 $3+2+2=7$，$5 \rightarrow 1$ 花费时间 $2+1=3$，总时间花费 $10$。

当跳过 $6$ 时，路线是 $2 \rightarrow 5 \rightarrow 1$，其中 $2 \rightarrow 5$ 花费时间 $1+1+2=4$，$5 \rightarrow 1$ 花费时间 $2+1=3$，总时间花费 $7$。

当跳过 $5$ 时，路线是 $2 \rightarrow 6 \rightarrow 1$，其中 $2 \rightarrow 6$ 花费时间 $1+1+2+3=7$，$6 \rightarrow 1$ 花费时间 $3+2+1=6$ ，总时间花费 $13$。

当跳过 $1$ 时，路线时 $2 \rightarrow 6 \rightarrow 5$，其中 $2 \rightarrow 6$ 花费时间 $1+1+2+3=7$，$6 \rightarrow 5$ 花费时间 $3+2+2=7$ ，总时间花费 $14$。


**【评测用例规模与约定】**

对于 $20 \%$ 的数据，$2 \leq K \leq N \leq 100$。

对于 $40 \%$ 的数据，$2 \leq K \leq N \leq 10^{4}$。

对于 $100 \%$ 的数据，$2 \leq K \leq N \leq 10^{5}$，$1 \leq u,v,A_{i} \leq N$，$1 \leq t \leq 10^{5}$。保证 $A_{i}$ 两两不同。 

蓝桥杯 2023 省赛 B 组 I 题。


---

---
title: "[蓝桥杯 2023 省 B] 砍树"
layout: "post"
diff: 普及+/提高
pid: P9246
tag: ['2023', '最近公共祖先 LCA', '蓝桥杯省赛']
---
# [蓝桥杯 2023 省 B] 砍树
## 题目描述

给定一棵由 $n$ 个结点组成的树以及 $m$ 个不重复的无序数对 $\left(a_{1},b_{1}\right),\left(a_{2},b_{2}\right),\ldots,\left(a_{m},b_{m}\right)$，其中 $a_{i}$ 互不相同，$b_{i}$ 互不相同，$a_{i} \neq b_{j}(1 \leq i,j \leq m)$。

小明想知道是否能够选择一条树上的边砍断，使得对于每个 $\left(a_{i},b_{i}\right)$ 满足 $a_{i}$ 和 $b_{i}$ 不连通，如果可以则输出应该断掉的边的编号 (编号按输入顺序从 $1$ 开始)，否则输出 `-1`。

## 输入格式

输入共 $n+m$ 行，第一行为两个正整数 $n,m$。

后面 $n-1$ 行，每行两个正整数 $x_{i},y_{i}$ 表示第 $i$ 条边的两个端点。

后面 $m$ 行，每行两个正整数 $a_{i},b_{i}$。
## 输出格式

一行一个整数，表示答案，如有多个答案，输出编号最大的一个。

## 样例

### 样例输入 #1
```
6 2
1 2
2 3
4 3
2 5
6 5
3 6
4 5

```
### 样例输出 #1
```
4
```
## 提示

**【样例说明】**

断开第 $2$ 条边后形成两个连通块：$\{3,4\},\{1,2,5,6\}$，满足 $3$ 和 $6$ 不连通，$4$ 和 $5$ 不连通。

断开第 $4$ 条边后形成两个连通块：$\{1,2,3,4\},\{5,6\}$，同样满足 $3$ 和 $6$ 不连通，$4$ 和 $5$ 不连通。

$4$ 编号更大，因此答案为 $4$。

**【评测用例规模与约定】**

对于 $30 \%$ 的数据，保证 $1<n \leq 10^3$。

对于 $100 \%$ 的数据，保证 $1<n \leq 10^{5}$，$1 \leq m \leq \frac{n}{2}$。

蓝桥杯 2023 省赛 B 组 J 题。


---


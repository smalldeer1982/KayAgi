---
title: "「Cfz Round 2」Max of Distance"
layout: "post"
diff: 普及+/提高
pid: P10309
tag: ['数学', '洛谷原创', 'Special Judge', 'O2优化', '树的直径', '树论', '构造', '洛谷月赛']
---
# 「Cfz Round 2」Max of Distance
## 题目描述

给定一棵包含 $n$ 个结点的树 $G$ 和一个整数 $E$。

你需要构造树 $G$ 中每条边的整数边权 $w_i$，满足：

- $1 \le w_i \le 10^9$；
- 均匀随机选择一个结点 $u$，$\max\limits_{v=1}^n\operatorname{dis}(u,v)$ 的期望对 $998244353$ 取模的值等于 $E$；

或报告无解。

其中，$\operatorname{dis}(u,v)$ 表示结点 $u,v$ 之间简单路径上的边权和。

如果你不知道如何计算期望对 $998244353$ 取模的结果，请移步 [P2613 【模板】有理数取余](https://www.luogu.com.cn/problem/P2613)。
## 输入格式

第一行输入一个整数 $n$。

接下来 $n-1$ 行，每行输入两个正整数 $u_i,v_i$，表示树 $G$ 中结点 $u_i,v_i$ 之间存在一条边 $(u_i,v_i)$。

接下来一行，输入一个整数 $E$。
## 输出格式

输出一行或 $n-1$ 行：

- 若有解，则输出 $n-1$ 行，每行输出一个整数 $w_i$，表示你构造的树 $G$ 中边 $(u_i,v_i)$ 的边权；
- 若无解，则输出一行，包含一个整数 $-1$。

**所有满足要求的输出均可通过。**
## 样例

### 样例输入 #1
```
3
1 2
2 3
665496238
```
### 样例输出 #1
```
1
2
```
## 提示

#### 「样例解释 #1」

所有 $\operatorname{dis}$ 的值如下表，其中标红的是行首结点的 $\operatorname{dis}$ 的最大值。

|$\operatorname{dis}$|$1$|$2$|$3$|
|:-:|:-:|:-:|:-:|
|$1$|$0$|$1$|$\color{red}3$|
|$2$|$1$|$0$|$\color{red}2$|
|$3$|$\color{red}3$|$2$|$0$|

可以验证，$E=\dfrac{3+2+3}{3}=\dfrac{8}{3}\equiv 665496238\pmod {998244353} $。

#### 「数据范围」

对于所有数据，$2\le n\le 10^5$，$1 \le u_i,v_i \le n$，$0\le E < 998244353$，保证输入数据形成一棵树。

**只有你通过本题的所有测试点，你才能获得本题的分数。**


---

---
title: "【MX-X7-T3】[LSOT-3] 寄存器"
layout: "post"
diff: 普及+/提高
pid: P11562
tag: ['贪心', '并查集', 'O2优化', '树的直径', '梦熊比赛']
---
# 【MX-X7-T3】[LSOT-3] 寄存器
## 题目背景

原题链接：<https://oier.team/problems/X7D>。

这里不是 APIO，所以这个题也不是让你手搓 CPU。
## 题目描述

有 $n$ 个寄存器，编号为 $1 \sim n$。这些寄存器由 $n-1$ 条带有开关的电线连接。为了保证交换信息的顺利，保证每两个寄存器都可以通过若干条电线连接。

初始时每个寄存器存储的信息都是 $0$。小 H 每次可以独立地操纵所有电线的开关然后选择一个寄存器通电。若一个寄存器与一个通电的寄存器有**开启的电线**相连，则这个寄存器也会通电。所有通电的寄存器都会反转存储的信息（$0$ 会变成 $1$，$1$ 会变成 $0$）。小 H 想让寄存器存储他想要的信息，他希望你告诉他最少需要进行多少次**通电**。
## 输入格式

第一行，一个正整数 $n$，表示寄存器个数。

第二行，$n$ 个非负整数 $a_1, \ldots, a_n$，表示小 H 希望寄存器 $i$ 存储 $a_i$。保证 $a_i$ 为 $0$ 或 $1$。

接下来 $n - 1$ 行，每行两个正整数 $u, v$，表示寄存器 $u$ 和 $v$ 之间有一根电线。保证每两个寄存器都可以通过若干条电线连接。
## 输出格式

仅一行，一个非负整数，表示最少进行多少次**通电**。
## 样例

### 样例输入 #1
```
5
1 0 0 1 0
1 2
2 3
2 4
3 5

```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
15
1 0 0 0 0 1 0 1 1 1 0 0 1 1 0
10 2
1 7
1 5
9 7
14 2
4 11
6 5
9 15
4 5
5 3
5 14
13 5
5 8
5 12

```
### 样例输出 #2
```
4

```
## 提示

**【样例解释 #1】**

先将电线 $(1, 2)$ 关闭，其余开启，给寄存器 $1$ 通电，此时 $1$ 的信息翻转，所有寄存器存储的信息变为 `1 0 0 0 0`。

然后将电线 $(2, 4)$ 关闭，其余开启，给寄存器 $4$ 通电，此时 $4$ 的信息翻转，所有寄存器存储的信息变为 `1 0 0 1 0`，满足要求。

可以证明不存在更优的方案。

**【数据范围】**

**本题采用捆绑测试。**

- 子任务 1（20 分）：$n\le 5$。
- 子任务 2（20 分）：对于第 $i$ 根电线，$u=i$，$v=i+1$。
- 子任务 3（30 分）：不存在一对相邻的寄存器希望储存的信息相同。
- 子任务 4（30 分）：无特殊性质。

对于全部的数据，$1\le n\le 10^6$，$1\le u,v\le n$，$0 \le a_i \le 1$，每两个寄存器都可以通过若干条电线连接。


---

---
title: "[POI 2019/2020 R2] 假期 Wakacje Bajtazara"
layout: "post"
diff: 普及+/提高
pid: P12895
tag: ['动态规划 DP', '2020', 'POI（波兰）', 'Special Judge', '树的直径']
---
# [POI 2019/2020 R2] 假期 Wakacje Bajtazara
## 题目背景

翻译来自于 [LibreOJ](https://loj.ac/p/4844)。
## 题目描述

**题目译自 [XXVII Olimpiada Informatyczna – II etap](https://sio2.mimuw.edu.pl/c/oi27-2/dashboard/) [Wakacje Bajtazara](https://szkopul.edu.pl/problemset/problem/pXcijJbDyC_jRAjkoxBH9sCO/statement/)**

众所周知，Bajtazar 是一个非常忙碌的人，他从不畏惧字节王国中的任何生活挑战。不过，他终于决定给自己放个假，于是前往比特王国度假。比特王国中有 $n$ 座城市，通过 $n-1$ 条双向道路连接，确保任意两座城市之间都可以通行。Bajtazar 不想连续两天待在同一座城市，但他也不喜欢长途跋涉，所以每天晚上他计划只通过一条道路前往邻近城市。他为每座城市设定了吸引力系数，用来衡量游览这座城市的愉悦程度。当然，他希望度过一个尽可能愉快的假期。

然而，Bajtazar 就是 Bajtazar，他总是喜欢将愉快与实用相结合。这次假期也不例外，他打算利用假期时间开始撰写回忆录。具体来说，他计划在假期中每隔一天游览城市，其余日子用来写作。

他希望规划一个长度为 $2k-1$ 天的假期，其中在 $k$ 个奇数日游览城市，在 $k-1$ 个偶数日写作回忆录。游览过的城市的吸引力系数总和必须尽可能大，同时他不想重复游览同一座城市。不过，在写作的日子，他并不介意待在之前已经去过的城市。请你帮助他规划一个最愉快的假期。
## 输入格式

输入的第一行包含一个整数 $n$ $(1 \leq n \leq 1000000)$，表示比特王国中的城市数量。城市编号从 $1$ 到 $n$。

第二行包含 $n$ 个整数 $w_{1}, w_{2}, \ldots, w_{n}$ $(1 \leq w_{i} \leq 1000000)$，用单个空格分隔，$w_{i}$ 表示编号为 $i$ 的城市的吸引力系数。

接下来的 $n-1$ 行描述比特王国的道路，每行包含两个整数 $a_{i}$ 和 $b_{i}$ $(1 \leq a_{i}, b_{i} \leq n)$，用单个空格分隔，表示编号为 $a_{i}$ 和 $b_{i}$ 的城市之间有一条双向道路。
## 输出格式

你的程序应输出三行内容：

第一行包含一个整数 $W$，表示 Bajtazar 假期中能获得的最大吸引力系数总和。

第二行包含一个整数 $k$，表示 Bajtazar 在假期中游览的城市数量。

第三行包含 $2k-1$ 个整数，用单个空格分隔，表示 Bajtazar 在假期各天所在的城市编号。如果存在多种最大 $W$ 的方案，你的程序可以输出任意一种。
## 样例

### 样例输入 #1
```
8
3 8 5 4 1 2 1 1
1 2
2 3
2 4
5 4
4 6
7 6
8 7

```
### 样例输出 #1
```
13
4
3 2 1 2 4 6 7
```
## 提示

**样例 1 解释**

下图展示了比特王国的道路网络示意图。Bajtazar 将游览城市 $3$、$1$、$4$ 和 $7$，这些城市的吸引力系数总和为 $5+3+4+1=13$。

![](https://cdn.luogu.com.cn/upload/image_hosting/hb2mrr0b.png)

**附加样例**

1. 该样例满足四座城市连成一条路径，每座城市的吸引力系数均为 $1$。
2. 该样例满足七座城市构成一棵满二叉树，每座城市的吸引力系数等于其所在深度（根节点深度为 $1$）。
3. 该样例满足一千座城市，每座城市（除了城市 $1$）都与城市 $1$ 直接相连，每座城市的吸引力系数均为 $1$。
4. 该样例满足一百万座城市连成一条路径，每座城市的吸引力系数为 $1$、$2$ 或 $3$。

详细子任务附加限制及分值如下表所示。

如果你的程序正确输出了第一行（即 $W$），但其他行不正确，可以获得该测试点 $40\%$ 的分数。

| 子任务 | 附加限制 | 分值 |
| :---: | :--: | :---: |
| $1$      | $n \leq 1000$，所有 $w_{i}=1$ | $20$   |
| $2$      | $n \leq 1000$         | $10$   |
| $3$      | 所有 $w_{i}=1$        | $40$   |
| $4$      | 无附加限制            | $30$   |


---

---
title: "HXY造公园"
layout: "post"
diff: 普及+/提高
pid: P2195
tag: ['搜索', '图论', '并查集', '广度优先搜索 BFS', '树的直径']
---
# HXY造公园
## 题目描述

现在有一个现成的公园，有 $n$ 个休息点和 $m$ 条双向边连接两个休息点。众所周知，HXY 是一个 SXBK 的强迫症患者，所以她打算施展魔法来改造公园并即时了解改造情况。她可以进行以下两种操作：

1. 对某个休息点 $x$，查询公园中可以与该点互相到达的休息点组成的路径中的最长路径。
2. 对于两个休息点 $x,y$，如果 $x,y$ 已经可以互相到达则忽略此次操作。否则，在 $x$ 可到达的所有休息点和 $y$ 可到达的所有休息点（包括 $x,y$ 自身）分别选择一个休息点，然后在这两个休息点之间连一条边，并且这个选择应该满足对于连接后的公园，$x$ 和 $y$ 所在的区域（即 $x,y$ 可达到的所有休息点和边组成的集合）中的最长路径的长度最小。

HXY打算进行 $q$ 个操作，请你回答她的对于公园情况的询问（操作 1）或者执行她的操作（操作 2）。

注：所有边的长度皆为 $1$。保证不存在环。最长路径定义为：对于点 $v_1,v_2\cdots v_k$，如果对于其中任意的 $v_i$ 和 $v_{i+1}\quad (1\le i\le k-1)$，都有边相连接，那么 $v_j\quad(1\le j\le k)$ 所在区域的最长路径就是 $k-1$。

## 输入格式

- 第一行，三个正整数，分别为 $n,m,q$。
- 接下来的 $m$ 行，每一行有两个正整数 $x_i,y_i$，表示 $x_i$ 和 $y_i$ 有一条双向边相连。
- 再接下来的 $q$ 行，每一行表示一个操作。
  - 若该行第一个数为 $1$，则表示操作 1，之后还有一个正整数 $x_i$，表示要查询的休息点。
  - 若该行第一个数为 $2$，则表示操作 2，之后还有两个正整数 $x_i,y_i$，表示需要执行操作的两个休息点。

## 输出格式

输出行数为操作 1 的个数。

每行输出对于操作 1 询问的回答。

## 样例

### 样例输入 #1
```
6 0 6
2 1 2
2 3 4
2 5 6
2 3 2
2 5 3
1 1
```
### 样例输出 #1
```
4

```
## 提示

### 数据范围及约定

- 对于 $10\%$ 的数据，只存在操作 1。
- 对于 $30\%$ 的数据，$1\le m<n\le 20$，$1\le q\le5$。
- 对于 $60\%$ 的数据，$1\le m<n \le 2000$，$1\le q\le 1000$。
- 对于 $100\%$ 的数据，$1 \le m<n \le 3\times 10^5$，$1\le q\le 3\times 10^5$。



---

---
title: "[ZJOI2012] 旅游"
layout: "post"
diff: 普及+/提高
pid: P2610
tag: ['动态规划 DP', '2012', '各省省选', '浙江', '广度优先搜索 BFS', '树形 DP', '树的直径']
---
# [ZJOI2012] 旅游
## 题目描述

到了难得的暑假，为了庆祝小白在数学考试中取得的优异成绩，小蓝决定带小白出去旅游~~

经过一番抉择，两人决定将 T 国作为他们的目的地。T 国的国土可以用一个凸 $n$ 边形来表示，$n$ 个顶点表示 $n$ 个入境/出境口。T 国包含 $n-2$ 个城市，每个城市都是顶点均为 $n$ 边形顶点的三角形（换而言之，**城市组成了关于 T 国的一个三角剖分**）。**两人的旅游路线可以看做是连接 $n$ 个顶点中不相邻两点的线段**。

![](https://cdn.luogu.com.cn/upload/pic/1409.png) 

为了能够买到最好的纪念品，小白希望旅游路线上经过的城市尽量多。作为小蓝的好友，你能帮帮小蓝吗？
## 输入格式

每个输入文件中仅包含一个测试数据。

第一行包含一个正整数 $n$，$n$ 的含义如题目所述。

接下来有 $n-2$ 行，每行包含三个整数 $p,q,r$，表示该城市三角形的三个顶点的编号（T 国的 $n$ 个顶点按顺时间方向从 $1$ 至 $n$ 编号）。
## 输出格式

输出文件共包含一行，表示最多经过的城市数目。（**一个城市被当做经过当且仅当其与线路有至少两个公共点**）
## 样例

### 样例输入 #1
```
6

1 2 4

2 3 4

1 4 5

1 5 6
```
### 样例输出 #1
```
4
```
## 提示

对于 $20\%$ 的数据，$n\le 2000$。

对于 $100\%$ 的数据，$4\le n \le 200000$。


---

---
title: "[SDOI2013] 直径"
layout: "post"
diff: 普及+/提高
pid: P3304
tag: ['2013', '山东', '深度优先搜索 DFS', '树的直径']
---
# [SDOI2013] 直径
## 题目描述

小 Q 最近学习了一些图论知识。根据课本，有如下定义。树：无回路且连通的无向图，每条边都有正整数的权值来表示其长度。如果一棵树有 $N$ 个节点，可以证明其有且仅有 $N-1$ 条边。

路径：一棵树上，任意两个节点之间最多有一条简单路径。我们用 $\text{dis}(a,b)$ 表示点 $a$ 和点 $b$ 的路径上各边长度之和。称 $\text{dis}(a,b)$ 为 $a,b$ 两个节点间的距离。

直径：一棵树上，最长的路径为树的直径。树的直径可能不是唯一的。

现在小 Q 想知道，对于给定的一棵树，其直径的长度是多少，以及有多少条边满足所有的直径都经过该边。

## 输入格式

第一行包含一个整数 $N$，表示节点数。

接下来 $N-1$ 行，每行三个整数 $a,b,c$，表示点 $a$ 和点 $b$ 之间有一条长度为 $c$ 的无向边。

## 输出格式

共两行。第一行一个整数，表示直径的长度。第二行一个整数，表示被所有直径经过的边的数量。

## 样例

### 样例输入 #1
```
6
3 1 1000
1 4 10
4 2 100
4 5 50
4 6 100
```
### 样例输出 #1
```
1110 
2
```
## 提示

【样例说明】 

直径共有两条，$3$ 到 $2$ 的路径和 $3$ 到 $6$ 的路径。这两条直径都经过边 $(3,1)$ 和边$(1, 4)$。

对于 $100\%$ 的测试数据：$2\le N\le 200000$，所有点的编号都在 $1\sim N$ 的范围内，边的权值 $\le10^9$。



---

---
title: "【XR-3】核心城市"
layout: "post"
diff: 普及+/提高
pid: P5536
tag: ['贪心', '堆', 'O2优化', '树的直径']
---
# 【XR-3】核心城市
## 题目描述

X 国有 $n$ 座城市，$n - 1$ 条长度为 $1$ 的道路，每条道路连接两座城市，且任意两座城市都能通过若干条道路相互到达，显然，城市和道路形成了一棵树。

X 国国王决定将 $k$ 座城市钦定为 X 国的核心城市，这 $k$ 座城市需满足以下两个条件：

1. 这 $k$ 座城市可以通过道路，在不经过其他城市的情况下两两相互到达。
2. 定义某个非核心城市与这 $k$ 座核心城市的距离为，这座城市与 $k$ 座核心城市的距离的最小值。那么所有非核心城市中，与核心城市的距离最大的城市，其与核心城市的距离最小。你需要求出这个最小值。
## 输入格式

第一行 $2$ 个正整数 $n,k$。

接下来 $n - 1$ 行，每行 $2$ 个正整数 $u,v$，表示第 $u$ 座城市与第 $v$ 座城市之间有一条长度为 $1$ 的道路。

**数据范围：**

- $1 \le k < n \le 10 ^ 5$。
- $1 \le u,v \le n, u \ne v$，保证城市与道路形成一棵树。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
6 3
1 2
2 3
2 4
1 5
5 6

```
### 样例输出 #1
```
1

```
## 提示

【样例说明】

钦定 $1,2,5$ 这 $3$ 座城市为核心城市，这样 $3,4,6$ 另外 $3$ 座非核心城市与核心城市的距离均为 $1$，因此答案为 $1$。


---

---
title: "「MCOI-01」Village 村庄"
layout: "post"
diff: 普及+/提高
pid: P6722
tag: ['动态规划 DP', '搜索', '图论', '二分图', '树的直径']
---
# 「MCOI-01」Village 村庄
## 题目背景

今天，珂爱善良的0x3喵酱骑着一匹小马来到了一个村庄。

“诶，这个村庄的布局 ……”   
“好像之前我玩 Ciste 的地方啊 qwq”

0x3喵酱有一个地图，地图有着这个村庄的信息。

然后0x3喵酱要通过这张地图来判断 Ciste 有解无解啦 ~

注：Ciste 是《请问您今天要来点兔子吗》中的一种藏宝图游戏
## 题目描述

村庄被简化为一个 $n$ 个节点（编号为 $1$ 到 $n$）和 $n-1$ 条边构成的无向连通图。

0x3喵酱认为这个无向图里的信息跟满足以下条件的新图有关：

- 新图的点集与原图相同
- 在新图中 $u,v$ 之间有无向边 是 在原图中 $dis(u,v) \ge k$ 的**充分必要条件** （$k$ 为给定常量，$dis(u,v)$ 表示编号为 $u$ 的点到编号为 $v$ 的点最短路的长度）

0x3喵酱还认为这个"新图"如果为二分图，则 Ciste "有解"，如果"新图"不是二分图这个 Ciste "无解"。（如果您不知道二分图请翻到提示）

那么0x3喵酱想请您判断一下这个 Ciste 是否"有解"。
## 输入格式

第一行包含一个正整数 $ T $，表示有 $ T $ 组数据。  
对于每组数据第一行包含两个正整数 $ n,k $。接下来 $ n-1 $ 行，每行包含三个正整数 $ x,y,v $ 表示编号为 $ x $ 的点到编号为 $ y $ 的点有一条边权为 $ v $  的无向边。  
输入数据保证合法。

## 输出格式

对于每一组数据包含一行，如果“有解”输出 `Yes`，否则输出 `Baka Chino`。
## 样例

### 样例输入 #1
```
5
5 2
1 2 1
2 3 1
3 4 1
4 5 1
5 3
1 2 1
2 3 1
3 4 1
4 5 1
5 8
1 3 3
1 2 1
2 4 6
2 5 2
5 2
1 3 3
1 2 1
2 4 6
2 5 2
7 4
1 2 3
1 3 3
2 5 3
2 6 3
3 7 3
2 4 2
```
### 样例输出 #1
```
Baka Chino
Yes
Yes
Baka Chino
Baka Chino
```
## 提示

#### 样例解析

对于样例中的 **第一组** 数据：

原图：

![](https://cdn.luogu.com.cn/upload/image_hosting/9f9zh4b2.png)
新图：

![](https://cdn.luogu.com.cn/upload/image_hosting/dg4es91e.png)

新图不为二分图，故输出 `Baka Chino`。

对于 **第三组** 数据：

原图：

![](https://cdn.luogu.com.cn/upload/image_hosting/mku4v6uo.png)

新图：

![](https://cdn.luogu.com.cn/upload/image_hosting/15o3x3zz.png)

新图为二分图，故输出 `Yes`。

#### 数据规模与约定

**本题采用捆绑测试**。

- Subtask 1（16 pts）$\ $ ：$n \le 10$。
- Subtask 2（24 pts）$\ $ ：$n \le 100$。
- Subtask 3（8 pts）$\ $ ：$n \le 1000$。
- Subtask 4（28 pts）：图退化成一条链。
- Subtask 5（24 pts）：无特殊限制。

对于 $100\%$ 的数据，$n \le 10^5$，$T \le 10$，$v \le 1000$，$k \le 1000000$。

本题数据使用 [CYaRon](https://www.luogu.org/discuss/show?postid=11410) 生成。

#### 提示


**二分图** 又称作二部图，是图论中的一种特殊模型。设 $G=(V,E)$ 是一个无向图，如果顶点 $V$ 可分割为两个互不相交的子集 $(A,B)$，并且图中的每条边 $(i,j)$ 所关联的两个顶点 $i$ 和 $j$ 分别属于这两个不同的顶点集 $(i \in A,j \in B)$，则称图 $G$ 为一个二分图。（摘自[百度百科](https://baike.baidu.com/item/%E4%BA%8C%E5%88%86%E5%9B%BE/9089095?fr=aladdin)）

#### 说明

Minecraft OI Round 1 A

- Idea：0x3喵酱
- Solution/Std：0x3喵酱
- Data：0x3喵酱
- Tester：tarjin


---


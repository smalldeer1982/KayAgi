---
title: "233 Matrix"
layout: "post"
diff: 普及+/提高
pid: P10503
tag: ['O2优化', '矩阵加速']
---
# 233 Matrix
## 题目描述

In our daily life we often use 233 to express our feelings. Actually, we may say 2333, 23333, or 233333 ... in the same meaning. And here is the question: Suppose we have a matrix called 233 matrix. In the first line, it would be 233, 2333, 23333... (it means $a _ {0,1} = 233$, $a_{0,2} = 2333$, $a_{0,3} = 23333$...) Besides, in 233 matrix, we got $a_{i,j} = a_{i-1,j} +a_{i,j-1}( i,j \neq 0)$. Now you have known $a_{1,0},a_{2,0},\dots,a_{n,0}$, could you tell me $a_{n,m}$ in the 233 matrix?
## 输入格式

There are multiple test cases. Please process till EOF.

For each case, the first line contains two postive integers $n,m(n \le 10,m \le 10^9)$. The second line contains n integers, $a_{1,0},a_{2,0},...,a_{n,0}$ ($0 \le a_i,0 < 2^{31}$).
## 输出格式

For each case, output $a_{n,m}$ mod 10000007.
## 样例

### 样例输入 #1
```
1 1
1
2 2
0 0
3 7
23 47 16
```
### 样例输出 #1
```
234
2799
72937
```
## 提示

![](https://cdn.luogu.com.cn/upload/image_hosting/ndjcn0l1.png)
## 题目翻译

**【题目描述】**

在我们的日常生活中，我们经常用 233 来表达我们的情感。实际上，我们可能会说 2333、23333 或者 233333... 都表示同样的意思。现在有一个问题：假设我们有一个称为 233 矩阵。在第一行，它可能是 233、2333、23333...（表示 $a _ {0,1} = 233$，$a_{0,2} = 2333$，$a_{0,3} = 23333$...）。此外，在 233 矩阵中，我们有 $a_{i,j} = a_{i-1,j} +a_{i,j-1}( i,j \neq 0)$。现在已知 $a_{1,0},a_{2,0},\dots,a_{n,0}$，你能告诉我 233 矩阵中的 $a_{n,m}$ 吗？

**【输入格式】**

有多个测试用例，请处理直到 EOF。

对于每个案例，第一行包含两个正整数 $n,m(n \le 10,m \le 10^9)$。第二行包含 n 个整数，$a_{1,0},a_{2,0},...,a_{n,0}$（$0 \le a_i,0 < 2^{31}$）。

**【输出格式】**

对于每个案例，输出 $a_{n,m}$ 模 10000007。

翻译来自于：[ChatGPT](https://chatgpt.com/)


---

---
title: "「KFCOI Round #1」回首"
layout: "post"
diff: 普及+/提高
pid: P11765
tag: ['洛谷原创', 'O2优化', '矩阵加速', '矩阵乘法', '洛谷比赛']
---
# 「KFCOI Round #1」回首
## 题目背景

控制住不爱一个人很难，因为爱是自由意识的沉沦。

其实从始至终，只要你回首，他就永远都陪伴在你身后。
## 题目描述

你一共有 $n$ 条重要的回忆，每条回忆有一个重要系数 $k_i$，并且这 $n$ 条回忆彼此之间有 $m$ 个前后关系。

每一条关系 $u,v(1\le u,v\le n)$ 表示 $u$ 发生的时间**恰好**在 $v$ 前。

可能是因为时间过久导致你的记忆错乱，在时间线中可能会出现环。

一开始，所有点的重要度均为 $0$，一共你会进行 $T$ 次回想操作。

若当前正在进行第 $t$ 次操作：

* 操作前，对于一条回忆 $x_i$，它的重要度会乘上重要系数 $k_i$。

* 操作中，对于一条回忆 $x_i$，如果有**恰好**发生在回忆 $x_i$ 前的回忆 $y_i$，那么将回忆 $x_i$ 的重要度增加 $y_i$ 在本次乘上重要系数 $k_i$ **之前**的重要度。否则回忆 $x_i$ 的重要度增加 $t$。

当然，为了防止一条回忆过于重要，输出每条回忆的重要度对 $998244353$ 取余的结果。

****

形式化题意：

给定一个 $n$ 个节点，$m$ 条边的有向图，并保证不会出现重边。初始所有点的点权都为 $0$。

一共将进行 $T$ 次操作。

对于第 $t$ 次操作，首先将所有点的点权乘上一个给定的值 $k_i$。

接下来，对于一个点 $x_i$，如果有连向它的点 $y_i$，那么将 $x_i$ 的权值加上 $y_i$ 在本次乘上 $k_i$ 之前的权值。否则如果没有连向它的点，$x_i$ 的权值加上 $t$。

输出的所有点的权值对 $998244353$ 取余的结果。
## 输入格式

本题输入均为正整数。

第一行三个数 $n,m,T$，表示一共有 $n$ 条回忆，$m$ 个关系，以及一共进行 $T$ 次回想操作。

第二行 $n$ 个数，表示重要系数 $k_i$。

接下来 $m$ 行，每行两个数 $x_i,y_i$，表示 $x_i$ 发生的时间恰好先于 $y_i$。
## 输出格式

输出共一行 $n$ 个数，第 $i$ 个数表示第 $i$ 个点的重要度对 $998244353$ 取余的结果。
## 样例

### 样例输入 #1
```
5 5 3
1 2 3 4 5
1 2
2 3
1 4
2 4
4 5
```
### 样例输出 #1
```
6 5 1 8 1
```
## 提示

样例解释 1：

![](https://cdn.luogu.com.cn/upload/image_hosting/9h5jwi1l.png)

第一次操作时，所有的点重要度为 $0$。

乘上重要系数后依旧为 $0$。

第一个点的重要度加上当前正在进行的回想操作次数 $1$。

其余点均加上 $0$。

第一次操作后，所有点的重要度分别为 `1,0,0,0,0`。

类似的，第二次操作后，所有点的重要度分别为 `3,1,0,1,0`。

第三次操作后，所有点的重要度分别为 `6,5,1,8,1`。

****

### 数据范围

**本题采用捆绑测试**。

- Subtask 1（20 points）：$1\le n \le 10$，$1\le T \le 10$。
- Subtask 2（20 points）：$1\le T\le 10^5$。
- Subtask 3（60 points）：无特殊限制。

对于所有测试数据，$1\le n\le100$，$1\le m\le300$，$1\le T\le10^{18}$，$1\le k_i\le10^9$，$1\le x_i,y_i\le n$。




---

---
title: "[GCJ 2008 #1A] Numbers"
layout: "post"
diff: 普及+/提高
pid: P13459
tag: ['数学', '2008', '矩阵加速', 'Google Code Jam']
---
# [GCJ 2008 #1A] Numbers
## 题目描述

In this problem, you have to find the last three digits before the decimal point for the number $(3 + \sqrt{5})^n$.

For example, when $n = 5$, $(3 + \sqrt{5})^5 = 3935.73982\dots$ The answer is $935$.

For $n = 2$, $(3 + \sqrt{5})^2 = 27.4164079\dots$ The answer is $027$.
## 输入格式

The first line of input gives the number of cases, $T$. $T$ test cases follow, each on a separate line. Each test case contains one positive integer $n$.

## 输出格式

For each input case, you should output:

Case #$X$: $Y$

where $X$ is the number of the test case and $Y$ is the last three integer digits of the number $(3 + \sqrt{5})^n$. In case that number has fewer than three integer digits, add leading zeros so that your output contains exactly three digits.
## 样例

### 样例输入 #1
```
2
5
2
```
### 样例输出 #1
```
Case #1: 935
Case #2: 027
```
## 提示

**Limits**

- $1 \leq T \leq 100$

**Small dataset (15 Pts, Test set 1 - Visible)**

- $2 \leq n \leq 30$

**Large dataset (35 Pts, Test set 2 - Hidden)**

- $2 \leq n \leq 20000000000$



---

---
title: "[TJOI2017] 可乐"
layout: "post"
diff: 普及+/提高
pid: P3758
tag: ['2017', '倍增', '各省省选', '矩阵加速', '天津']
---
# [TJOI2017] 可乐
## 题目描述

加里敦星球的人们特别喜欢喝可乐。因而，他们的敌对星球研发出了一个可乐机器人，并且放在了加里敦星球的 $1$ 号城市上。这个可乐机器人有三种行为： 停在原地，去下一个相邻的城市，自爆。它每一秒都会随机触发一种行为。现在给加里敦星球城市图，在第 $0$ 秒时可乐机器人在 $1$ 号城市，问经过了 $t$ 秒，可乐机器人的行为方案数是多少？

## 输入格式

第一行输入两个正整数 $N$，$M$。$N$ 表示城市个数，$M$ 表示道路个数。

接下来 $M$ 行每行两个整数 $u$，$v$，表示 $u$，$v$ 之间有一条道路。保证两座城市之间只有一条路相连，且没有任何一条道路连接两个相同的城市。

最后一行是一个整数 $t$，表示经过的时间。
## 输出格式

输出可乐机器人的行为方案数，答案可能很大，请输出对 $2017$ 取模后的结果。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
2
```
### 样例输出 #1
```
8
```
## 提示

#### 样例输入输出 1 解释


- $1$ ->爆炸。
- $1$ -> $1$ ->爆炸。
- $1$ -> $2$ ->爆炸。
- $1$ -> $1$ -> $1$。
- $1$ -> $1$ -> $2$。
- $1$ -> $2$ -> $1$。
- $1$ -> $2$ -> $2$。
- $1$ -> $2$ -> $3$。

---

#### 数据范围与约定

- 对于 $20\%$ 的数据，保证 $t \leq 1000$。
- 对于$100\%$的数据，保证 $1 < t \leq 10^6$，$1 \leq N \leq30$，$0 < M < 100$，$1 \leq u, v \leq N$。


---

---
title: "【XR-1】分块"
layout: "post"
diff: 普及+/提高
pid: P5343
tag: ['动态规划 DP', '动态规划优化', '矩阵加速', '矩阵乘法']
---
# 【XR-1】分块
## 题目背景

xht37 喜欢分块，以至于对一道**不需要分块**的题也要分块做。
## 题目描述

有一个长度为 $n$ 的序列，xht37 现在想分块维护它。

PinkRabbit 要求他只准将序列分成 $PR$ 种长度的块。

NaCly_Fish 要求他只准将序列分成 $NF$ 种长度的块。

同一个人可能会要求 xht37 多次相同的块长。

xht37 想同时满足 PinkRabbit 和 NaCly_Fish 要求，只好使用两个人都允许的长度分块。

xht37 想知道，有多少种不同的分块方案，答案对 $10 ^ 9 + 7$ 取模。
## 输入格式

第一行一个正整数 $n$，表示序列的长度。

第二行一个正整数 $PR$，表示 PinkRabbit 要求的分块长度的种类数。

第三行 $PR$ 个正整数，表示 PinkRabbit 要求的 $PR$ 种分块长度。

第四行一个正整数 $NF$，表示 NaCly_Fish 要求的分块长度的种类数。

第五行 $NF$ 个正整数，表示 NaCly_Fish 要求的 $NF$ 种分块长度。
## 输出格式

输出一行一个整数，表示不同分块方案的种类数对 $10 ^ 9 + 7$ 取模的值。
## 样例

### 样例输入 #1
```
4
3
1 2 3
3
1 2 4
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
19260817
7
8 9 6 3 7 2 1
7
4 5 2 9 7 8 3
```
### 样例输出 #2
```
859254329
```
## 提示

【样例 $1$ 说明】

PinkRabbit 和 NaCly_Fish 都允许的块长为 $\{1,2\}$。

长度为 $4$ 的序列分块，每块长度为 $\{1,2\}$ 的方案有：

- $1\ 1\ 1\ 1$
- $1\ 1\ 2$
- $1\ 2\ 1$
- $2\ 1\ 1$
- $2\ 2$

共 $5$ 种。

【数据规模与约定】

设最大块长为 $x$。

对于 $60 \%$ 的数据，$1 \le n \le 10 ^ 6$，$1 \le PR,NF,x \le 10$，保证同一个人不会要求多次相同的块长。

对于 $100 \%$ 的数据，$1 \le n \le 10 ^ {18}$，$1 \le PR,NF,x \le 100$。


---

---
title: "[蓝桥杯 2015 省 AB] 垒骰子"
layout: "post"
diff: 普及+/提高
pid: P8624
tag: ['动态规划 DP', '2015', '矩阵加速', '蓝桥杯省赛']
---
# [蓝桥杯 2015 省 AB] 垒骰子
## 题目描述

赌圣 atm 晚年迷恋上了垒骰子，就是把骰子一个垒在另一个上边，不能歪歪扭扭，要垒成方柱体。

经过长期观察，atm 发现了稳定骰子的奥秘：有些数字的面贴着会互相排斥！

我们先来规范一下骰子：$1$ 的对面是 $4$，$2$ 的对面是 $5$，$3$ 的对面是 $6$。

假设有 $m$ 组互斥现象，每组中的那两个数字的面紧贴在一起，骰子就不能稳定的垒起来。

atm 想计算一下有多少种不同的可能的垒骰子方式。

两种垒骰子方式相同，当且仅当这两种方式中对应高度的骰子的对应数字的朝向都相同。

由于方案数可能过多，请输出模 $10^9+7$ 的结果。

不要小看了 atm 的骰子数量哦～。
## 输入格式

第一行两个整数 $n$，$m$。

$n$ 表示骰子数目。

接下来 $m$ 行，每行两个整数 $a$，$b$，表示 $a$ 和 $b$ 数字不能紧贴在一起。
## 输出格式

一行一个数，表示答案模 $10^9+7$ 的结果。
## 样例

### 样例输入 #1
```
2 1
1 2

```
### 样例输出 #1
```
544
```
## 提示

对于 $30\%$ 的数据：$n \le 5$。

对于 $60\%$ 的数据：$n \le 100$。

对于 $100\%$ 的数据：$0<n \le 10^9,m \le 36$。

时限 2 秒, 256M

蓝桥杯 2015 年省赛 AB 组 I 题。


---

---
title: "The Da Vinci Code"
layout: "post"
diff: 普及+/提高
pid: P8944
tag: ['动态规划 DP', '数学', '2023', '洛谷原创', 'O2优化', '矩阵加速']
---
# The Da Vinci Code
## 题目背景

> 圣杯在罗斯琳教堂下静待。  
> 大师杰作掩映中相拥入眠。  
> 剑刃圣杯守护着她的门宅。  
> 星空下她可安息无碍。

好的题目不需要花里胡哨的背景。
## 题目描述

给定一个长度为 $n$ 的数列 $a$，初始情况下 $a_i=i$。

另有一个取值在 $[1,n]$ 内的随机的整数 $x$，它取 $i$ 的概率为 $b_i$。

接下来进行 $k$ 次操作，每次**均匀随机**地选两个 $[1,n]$ 中的整数 $i,j$（允许 $i=j$），交换 $a_i,a_j$ 的值（如果 $i=j$ 则什么也不干）。问最后 $x$ 在位置 $i$ 上的概率，你需要对所有 $1\leq i\leq n$ 求出答案。你需要输出答案模 $3221225473$ 的值。

我们定义 $x$ 在位置 $i$ 上指 $a_i=x$。
## 输入格式

一行三个整数 $n,k,seed$。接下来使用如下代码生成 $b_i$：

```cpp
#include <cstdio>

typedef unsigned long long ull;
typedef unsigned int uint;
typedef long long ll;

const uint mod = 3221225473u;
const int N = 20000010;

ull seed;

ull getnext() {
	seed ^= seed << 13;
	seed ^= seed >> 17;
	seed ^= seed << 5;
	return seed;
}

uint rd(uint l, uint r) {
	return getnext() % (r - l + 1) + l;
}

int n;
ull k;
uint b[N];

int main() {
	scanf("%d%llu%llu", &n, &k, &seed);
	ull sum = 0;
	for (int i = 1; i < n; ++ i) b[i] = rd(2u, mod - 1), (sum += b[i]) %= mod;
	b[n] = mod + 1 - sum;
}
```

## 输出格式

设 $ans_i$ 表示 $x$ 在位置 $i$ 上的概率模 $3221225473$，则输出 $ans_i\times i$ 的异或和。
## 样例

### 样例输入 #1
```
2 9 998244353

```
### 样例输出 #1
```
2684354563

```
### 样例输入 #2
```
7 3 123456789

```
### 样例输出 #2
```
24313281849

```
### 样例输入 #3
```
10 9000000000000000000 1000000000000000000

```
### 样例输出 #3
```
20026214895

```
### 样例输入 #4
```
4 0 123456789

```
### 样例输出 #4
```
12357556560

```
## 提示

#### 【样例解释】

对于样例 #1：

$b$ 数组为 $\{2134949164 ,1086276310\}$，操作 $9$ 次后 $x$ 在两个位置的概率均为 $\dfrac12$。

对于样例 #2：

$b$ 数组为 $\{1863763622,1043615898,1055155266,1556793106,1763540175,1239801170,1141007183\}$。

#### 【数据范围】
对于 $100\%$ 的数据：

* $2\leq n\leq2\times10^7$，$0\leq k,seed<2^{64}$。
* $1<b_i<3221225473$，$\sum\limits_{i=1}^n b_i\equiv 1\pmod{3221225473}$。
* 数据保证 $1<b_n<3221225473$ 且 $3221225473$ 是质数。

---

**本题采用捆绑测试**。

| $\text{Subtask}$ |$n\le$|$k\le$|分值|
|:-:|:-:|:-:|:-:|
|$0$|$2$|$2^{64}-1$|$1$|
|$1$|$5$|$5$|$4$|
|$2$|$200$|$200$|$6$|
|$3$|$200$|$2^{64}-1$|$9$|
|$4$|$2000$|$2000$|$7$|
|$5$|$2\times10^7$|$1$|$5$|
|$6$|$10^6$|$10^6$|$8$|
|$7$|$2\times10^7$|$10^7$|$10$|
|$8$|$10^6$|$2^{64}-1$|$15$|
|$9$|$2\times10^7$|$2^{64}-1$|$35$|


---

---
title: "[HUSTFC 2023] Fujisaki 讨厌数学"
layout: "post"
diff: 普及+/提高
pid: P9777
tag: ['2023', 'O2优化', '矩阵加速', '高校校赛']
---
# [HUSTFC 2023] Fujisaki 讨厌数学
## 题目描述

众所周知，Fujisaki 在微积分（一）（上）、微积分（一）（下）、线性代数、离散数学（一）、概率论与数理统计这些课程中，只取得了非常低的分数，这导致他十分痛恨高等数学，因此他给大家带来了一道初等数学题。

已知 $x+x^{-1}=k$，其中 $k$ 是一个整数且 $k\ge 2$，Fujisaki 想让你帮他求出 $x^n+x^{-n}$ 的值。可以证明对于任意的整数 $n \ge 0$，这个值都是一个整数。由于结果可能会非常大，你只需要求出其对 $M$ 取模后的值。
## 输入格式

一行包含三个整数 $M\ (3\le M\le 998\,244\,353)$，$k\ (2\le k<M)$ 和 $n\ (0\le n\le 10^{18})$，其含义如题目所述。
## 输出格式

输出一个整数，表示答案对 $M$ 取模后的值。
## 样例

### 样例输入 #1
```
998244353 10 1

```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
998244353 2 3

```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
100 4 5

```
### 样例输出 #3
```
24
```


---


---
title: "「GXPC-S 2024」演唱会"
layout: "post"
diff: 普及+/提高
pid: B4169
tag: ['线段树', '2024', '广西']
---
# 「GXPC-S 2024」演唱会
## 题目背景

小林最近迷上了参加演唱会。
## 题目描述

有 $n$ 名粉丝在演唱会现场坐成一排，第 $i$ 名粉丝的应援力度为 $a_i$。

聚光灯每次会照射到一个区间 $[l,r]$，传达出的**应援力度**为区间中所有粉丝的应援力度之和乘以区间中最大的应援力度。

为了更好的应援，某个粉丝可能会更改他的应援力度。

请你帮小林算出，每次聚光灯照射过来的时候，传达出的应援力度的值。
## 输入格式

输入共 $(m+2)$ 行。

第一行包含两个整数 $n,m$，表示粉丝的数量 $n$ 以及操作的数量 $m$。
第二行包含 $n$ 个整数，第 $i$ 个数表示第 $i$ 名粉丝的应援力度 $a_i$。
接下来 $m$ 行，每行三个正整数 $\rm{opt},x,y$。

- 当 $\rm{opt}=1$ 时，表示查询区间 $[x,y]$ 中传达出的应援力度；

- 当 $\rm{opt}=2$ 时，表示将第 $x$ 名粉丝的应援力度修改为 $y$。
## 输出格式


对于每个查询操作，输出一行一个整数，表示对应区间中传达出的应援力度。
## 样例

### 样例输入 #1
```
5 5
1 2 3 4 5
1 1 3
1 3 5
2 1 4
1 1 3
1 1 5
```
### 样例输出 #1
```
18
60
36
90
```
## 提示


**本题采用捆绑测试。**

- Subtask 1（30pts）：保证 $n,m\le 10^3$；
- Subtask 2（20pts）：保证无修改操作；
- Subtask 3（50pts）：无额外约束。

对于 $100\%$ 的数据，保证：

- $1\le n,m,a_i\le 10^5$；
- $\rm{opt}\in \{1,2\}$；
- 当 $\rm{opt}=1$ 时，$1\le x\le y\le n$；
- 当 $\rm{opt}=2$ 时，$1\le x\le n$，$1\le y\le 10^5$。





---

---
title: "[GXPC-S 2025] 花 / flower"
layout: "post"
diff: 普及+/提高
pid: B4374
tag: ['线段树', '2025', '广西', '分块']
---
# [GXPC-S 2025] 花 / flower
## 题目背景

题目来源：2025 年广西中小学生程序设计挑战赛复赛（进阶组[试题](https://mp.weixin.qq.com/s?__biz=MzI3NDM3MzcwNQ==&mid=2247490166&idx=5&sn=e7ba7e3bc8126027b9abd662518c208b&chksm=ea9c06dd4d18206ed9d88124cc78b947298df2555889e98620204c2ea1471f58c135c00f99fb&mpshare=1&scene=23&srcid=0724dNJdhMxpUHag1dqkhiqL&sharer_shareinfo=7e47197d6e5c044ae705613db988029c&sharer_shareinfo_first=7e47197d6e5c044ae705613db988029c#rd)）。

## 题目描述


小明在放学路上发现了一棵神奇的花树，假设 $1$ 为这棵树的根节点，并且在这棵树上一共有 $n$ 个节点，每个节点上都有一朵美丽的花，我们定义第 $i$ 朵花的美丽值为 $a_i$，接下来将会经过 $m$ 天，每一天可能会发生下面两种事件中的一种：

- 给出三个整数 $1\,u\,w$ 表示把第 $u$ 朵花的美丽值变为 $w$。  
- 给出两个整数 $2\,u$ 表示询问以 $u$ 为根节点的子树中美丽值最大的节点的值。

小明想在母亲节那天为妈妈摘下整棵树中最美丽的花朵作为礼物，因此他需要每天准确掌握这棵树的每个事件，请你帮助他设计一个程序来完成吧。

## 输入格式


第一行输入两个整数 $n, m$ ，分别代表节点个数和将会经过的天数。  
接下来的一行有 $n$ 个整数，第 $i$ 个整数 $a_i$ 代表这朵花的美丽值。  
接下来的 $n-1$ 行每行有两个整数 $u$ 和 $v$ 表示节点 $u$ 和 $v$ 之间有一条边。  
接下来的 $m$ 行将会保证以下格式：  
  - 一行中给出三个整数 $1\,u\,w$。  
  - 一行中给出两个整数 $2\,u$。  
## 输出格式


对于每一种事件 $2$，每行给出一个整数代表答案。
## 样例

### 样例输入 #1
```
6 5
1 2 3 4 5 6
1 2
1 3
2 4
2 5
5 6
2 2
2 3
1 3 7
2 1
2 2
```
### 样例输出 #1
```
6
3
7
6
```
### 样例输入 #2
```
10 12
6 97 10 47 28 29 18 66 48 45
2 1
1 3
4 8
1 7
6 10
5 1
4 6
4 9
1 4
2 9
2 4
2 1
1 10 11
2 5
2 5
1 1 10
2 3
1 4 11
2 4
2 3
1 9 3
```
### 样例输出 #2
```
48
66
97
28
28
10
66
10
```
## 提示


#### 样例解释

对于样例 1，第一天以 2 为根节点的子树中美丽值最大的节点是 6，它的美丽值是 6。

第二天以 3 为根节点的子树只有它自己一个节点，所以最大美丽值节点就是它自己，值为 3。

接下来第三天将节点 3 的值变为 7。

第四天以 1 为根节点的子树就是这棵树本身，同时美丽值最大的节点为 3，它的美丽值为 7。

最后第五天以 2 为根节点的子树中美丽值最大的节点是 6，它的美丽值是 6。

#### 数据范围

- 对于 30% 的数据，保证 $1 \le n,m \le 5 \times 10^3$。  
- 对于另外存在 20% 的数据保证只有事件 $2$。  
- 对于 100% 的数据，保证 $1 \le n,m \le 2 \times 10^5, \;1 \le a_i, w \le 1 \times 10^9$。  



---

---
title: "[ROIR 2022] 跳跃机器人 (Day 1)"
layout: "post"
diff: 普及+/提高
pid: P10087
tag: ['动态规划 DP', '数学', '树形数据结构', '线段树', '线性数据结构', '树状数组', '单调队列', '2022', 'Special Judge', '\ufeff基础算法', '动态规划优化', '队列', '其它技巧', 'ROIR（俄罗斯）']
---
# [ROIR 2022] 跳跃机器人 (Day 1)
## 题目背景

翻译自 [ROIR 2022 D1T2](https://neerc.ifmo.ru/school/archive/2021-2022/ru-olymp-regional-2022-day1.pdf)。

某公司正在开发一种跳跃机器人。为了测试机器人，他们在一个多边形平台上设置了一个由 $n$ 个特殊平台组成的环形路线，平台从 $1$ 到 $n$ 编号。第 $i$ 个平台与 $i+1$ 个平台之间的距离为 $d_i$，最后一个平台与第一个平台之间的距离为 $d_n$（假设长度分别为 $d_1,d_2,\dots,d_n$ 的边可以组成一个 $n$ 边形）。

机器人配备了人工智能，在测试过程中学习跳得更远。在任何时刻，机器人通过一个整数 $a$ 来表示它的灵敏度。如果 $a$ 大于等于 $d_i$，机器人可以从平台 $i$ 跳到平台 $i+1$；同样地，如果 $a$ 大于等于 $d_n$，机器人可以从最后一个平台跳到第一个平台。每次跳跃后，机器人的灵敏度增加 $1$。
## 题目描述

机器人的开发人员选择一个平台作为起始平台。如果机器人可以完成 $n$ 次跳跃，回到原来的平台，他们认为实验是成功的。开发人员需要确定机器人的最小起始灵敏度是多少，并选择哪个平台作为起始平台。
## 输入格式

第一行包含一个整数 $n$。

第二行包含一个整数 $f$。

- 如果 $f = 1$，则第三行包含 $n$ 个整数 $d_1, d_2, \dots , d_n$，意义见题目背景。
- 如果 $f = 2$，则第三行包含一个整数 $m$，以及三个整数 $x,y,z$。第四行包含 $m$ 个整数 $c_1, c_2, \dots , c_m$。此时距离值 $d_i$ 根据以下公式计算：
   - 如果 $1 \le i \le m$，则 $d_i = c_i$。
   - 如果 $m + 1 \le i \le n$，则 $d_i = ((x \times d_{i−2} + y \times d_{i−1} + z) \bmod 10^9) + 1$。
## 输出格式

输出两个整数，即最小允许的起始灵敏度 $a$ 和可用于放置机器人的起始平台编号。如果有多个最小起始灵敏度对应的起始平台，可以输出任意一个。
## 样例

### 样例输入 #1
```
5
1
3 7 4 2 5
```
### 样例输出 #1
```
4 3
```
### 样例输入 #2
```
10
2
5 1 2 3
1 2 3 4 5
```
### 样例输出 #2
```
653 1
```
## 提示

样例说明：

在第二个示例中，距离数组为 $[1, 2, 3, 4, 5, 18, 45, 112, 273, 662]$。

根据公式计算 $d_6$ 到 $d_{10}$ 的值：

- $d_6 = ((1 \cdot d_4 + 2 \cdot d_5 + 3) \bmod 10^9) + 1 = ((1 \cdot 4 + 2 \cdot 5 + 3) \bmod 10^9) + 1 = 18$；
- $d_7 = ((1 \cdot d_5 + 2 \cdot d_6 + 3) \bmod 10^9) + 1 = ((1 \cdot 5 + 2 \cdot 18 + 3) \bmod 10^9) + 1 = 45$；
- $d_8 = ((1 \cdot d_6 + 2 \cdot d_7 + 3) \bmod 10^9) + 1 = ((1 \cdot 18 + 2 \cdot 45 + 3) \bmod 10^9) + 1 = 112$；
- $d_9 = ((1 \cdot d_7 + 2 \cdot d_8 + 3) \bmod 10^9) + 1 = ((1 \cdot 45 + 2 \cdot 112 + 3) \bmod 10^9) + 1 = 273$；
- $d_{10} = ((1 \cdot d_8 + 2 \cdot d_9 + 3) \bmod 10^9) + 1 = ((1 \cdot 112 + 2 \cdot 273 + 3) \bmod 10^9) + 1 = 662$。

本题使用捆绑测试。

| 子任务 | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: |
| $0$ | $15$ | $n\le300,f=1,d\le300$ |
| $1$ | $17$ | $n\le5000,f=2$ |
| $2$ | $10$ | $n\le100000,f=1$ 且保证从第一个平台开始跳是最佳选择 |
| $3$ | $20$ | $n\le100000,f=1$ |
| $4$ | $5$ | $f=2$ 且保证从第一个平台开始跳是最佳选择 |
| $5$ | $33$ | $f=2$ |

对于 $100\%$ 的数据，$3 \le n \le 10^7$。当 $f=1$ 时 $1 \le d_i \le 10^9$，当 $f=2$ 时 $2 \le m \le \min(n, 10^5)$，$0 \le x, y, z \le 10^9$，$1 \le c_i \le 10^9$。

注：本题的算法标签部分参考了官方题解中用到的解法。


---

---
title: "[USACO24JAN] Cowmpetency S"
layout: "post"
diff: 普及+/提高
pid: P10134
tag: ['贪心', '线段树', 'USACO', '2024', '排序']
---
# [USACO24JAN] Cowmpetency S
## 题目描述

Farmer John 正在为他的奶牛们雇用一位新的牛群领队。为此，他面试了 $N$（$2\le N\le 10^5$）头奶牛来担任该职位。在面试第 $i$ 个候选牛后，他会为候选牛分配一个 $1$ 到 $C$（$1\le C\le 10^9$）范围内的整数「牲任力」分数 $c_i$，与她们的领导能力相关。

由于 Farmer John 面试了如此多的奶牛，他没能记得所有奶牛的牲任力分数。然而，他确实记得 $Q$（$1\le Q<N$）对数字 $(a_j,h_j)$，其中奶牛 $h_j$ 是第一头比奶牛 $1$ 到 $a_j$ 拥有严格更高牲任力分数的奶牛（所以 $1\le a_j<h_j\le N$）。

Farmer John 现在告诉你序列 $c_1,\ldots,c_N$
（其中 $c_i=0$ 表示他忘记了奶牛 $i$ 的牲任力分数）和 $Q$ 对 $(a_j,h_j)$。帮助他求出与此信息一致的最小字典序的牲任力分数序列，或者判断不存在这样的序列！如果一个分数序列比另一个分数序列于这两个序列不同的第一个位置上的奶牛分配了更小的分数，则这个分数序列的字典序更小。

每个测试点包含 $T$（$1\le T\le 20$）个独立的测试用例。输入保证所有测试用例的 $N$ 之和不超过 $3\cdot 10^5$。 
## 输入格式

输入的第一行包含 $T$，独立的测试用例的数量。每个测试用例描述如下：

 1. 第一行包含 $N$，$Q$ 和 $C$。
 2. 第二行包含序列 $c_1,\ldots,c_N$（$0\le c_i\le C$）。
 3. 最后 $Q$ 行，每行包含一个数对 $(a_j,h_j)$。输入保证同一测试用例内的所有 $a_j$ 各不相同。
## 输出格式

 对于每个测试用例，输出一行，包含与 Farmer John 记忆一致的最小字典序牲任力分数序列，或者如果这样的序列不存在时输出 $−1$。
## 样例

### 样例输入 #1
```
1
7 3 5
1 0 2 3 0 4 0
1 2
3 4
4 5
```
### 样例输出 #1
```
1 2 2 3 4 4 1
```
### 样例输入 #2
```
5
7 6 10
0 0 0 0 0 0 0
1 2
2 3
3 4
4 5
5 6
6 7
8 4 9
0 0 0 0 1 6 0 6
1 3
6 7
4 7
2 3
2 1 1
0 0
1 2
10 4 10
1 2 0 2 1 5 8 6 0 3
4 7
1 2
5 7
3 7
10 2 8
1 0 0 0 0 5 7 0 0 0
4 6
6 9
```
### 样例输出 #2
```
1 2 3 4 5 6 7
1 1 2 6 1 6 7 6
-1
1 2 5 2 1 5 8 6 1 3
-1
```
## 提示

### 样例解释 1

我们可以看到给定的输出满足所有 Farmer John 记得的数对。

- $\max(c_1)=1$，$c_2=2$ 且 $1<2$，故第一个数对是满足的
- $\max(c_1,c_2,c_3)=2$，$c_4=3$ 且 $2<3$，故第二个数对是满足的
- $\max(c_1,c_2,c_3,c_4)=3$，$c_5=4$ 且 $3<4$，故第三个数对是满足的

存在一些其他的序列与 Farmer John 的记忆相一致，如

$1\ 2\ 2\ 3\ 5\ 4\ 1$  
$1\ 2\ 2\ 3\ 4\ 4\ 5$

然而，其中没有序列比给定的输出字典序更小。 

### 样例解释 2

在测试用例 $3$ 中，由于 $C=1$，唯一可能的序列是

$1\ 1$

然而，在这种情况下，奶牛 $2$ 的分数并不比奶牛 $1$ 高，因此我们无法满足条件。

在测试用例 $5$ 中，$a_1$ 和 $h_1$ 告诉我们奶牛 $6$ 是第一头分数严格高于奶牛 $1$ 到 $4$ 的奶牛。因此，奶牛 $1$ 到 $6$ 的最高得分是奶牛 $6$，为 $5$。由于奶牛 $7$ 的分数为 $7$，所以奶牛 $7$ 是第一头比奶牛 $1$ 到 $6$ 得分更高的奶牛。因此，第二个陈述「奶牛 $9$ 是第一头比奶牛 $1$ 到 $6$ 得分更高的奶牛」不能成立。 

### 测试点性质

 - 测试点 $3$：$N \le 10$ 且 $Q,C\le 4$。
 - 测试点 $4-8$：$N\le 1000$。
 - 测试点 $9-12$：没有额外限制。


---

---
title: "[yLCPC2024] E. Latent Kindom"
layout: "post"
diff: 普及+/提高
pid: P10237
tag: ['线段树', '二分', '洛谷原创', '洛谷月赛']
---
# [yLCPC2024] E. Latent Kindom
## 题目背景

扶苏和 10circle 老师正在拼机游玩最新最热歌曲 Latent Kindom（LK）！

LK 这首歌共有 $n$ 个难度的谱面，第 $i$ 个难度的谱面有 $l_i$ 个音符，分别是 $a_{i, 1}, a_{i, 2}, \dots a_{i, l_i}$，构成了一个序列。

扶苏想知道，如果她开难度为 $i$ 的谱面，10circle 老师开难度为 $j$ 的谱面，那么两个谱面的音符序列合并起来的中位数是多少。
## 题目描述

给定 $n$ 个序列 $a_1, a_2, \dots a_n$。你要回答 $q$ 次询问，每次询问会给出 $i, j$，你要求出序列 $a_i$ 和 $a_j$ 拼接后的中位数是多少。

拼接两个序列 $x, y$ 指的是把 $y$ 序列中的数依次写在 $x$ 序列后面。如果得到的序列长度为 $t$，中位数指的是序列中第 $\left\lceil\frac t 2 \right\rceil$ 小的数字。其中 $\left\lceil x \right\rceil$ 表示不小于 $x$ 的最小整数。

需要注意的是，本题的询问是独立的。也就是说，虽然你要回答假设 $a_i$ 和 $a_j$ 拼接后的中位数，但是不会真的进行对数列拼接的操作。
## 输入格式

**本题单个测试点内有多组测试数据**。输入的第一行是一个正整数 $T$，表示数据组数。对每组数据：

第一行是两个整数 $n,q$（$2 \leq n, q \leq 10^6$），表示序列的个数和询问的次数。  
接下来 $n$ 行，每行表示一个序列。第 $i$ 行首先有一个整数 $l_i$（$1 \leq l_i \leq 10^6$），表示序列 $a_i$ 的长度。接下来 $l_i$ 个整数，表示序列 $a_i$。保证序列里的数都是不大于 $10^{18}$ 的正整数。  
接下来 $q$ 行，每行两个整数 $i,j$（$1 \leq i,j \leq n$，$i \neq j$）表示一组询问。

数据保证单个测试点内的 $n,q,l_i$ 之和均不超过 $10^6$。
## 输出格式

对每组数据的每组询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
1
3 3
1 1
2 2 3
3 4 5 6
1 2
1 3
2 3
```
### 样例输出 #1
```
2
4
4
```
## 提示

#### 提示

请注意大量的数据读入输出对程序效率造成的影响，使用合适的读入输出方式，不要频繁刷新输出缓冲区，避免超时。


---

---
title: "[AHOI2024 初中组] 操作"
layout: "post"
diff: 普及+/提高
pid: P10374
tag: ['模拟', '线段树', '树状数组', '2024', '安徽', 'O2优化', '差分']
---
# [AHOI2024 初中组] 操作
## 题目描述

小可可有一个数组 $\{a_n\}$（初始值为 $\{a_n\}=\{0,0,\ldots,0\}$）和从左到右的 $m$ 个机器，其中第 $i$ 个机器有类别 $o_i \in \{1,2\}$ 和参数 $x_i,y_i$。第 $i$ 个机器执行的操作如下：

- 若 $o_i=1$，则将 $a_{(x_i)}$ 加上 $y_i$，此时保证 $1 \le x_i \le n$，$1 \le y_i \le 10^4$。
- 若 $o_i=2$，则执行第 $x_i \sim y_i$ 个机器的操作各一次，此时保证 $1 \le x_i \le y_i \le i-1$。
- 特别地，保证 $o_1=1$。

现在，小可可依次执行了第 $c_1,c_2,\ldots,c_k$ 个机器的操作各一次，她想知道最后得到的数组 $\{a_n\}$ 是什么。

由于数组中元素的值可能很大，你只需要帮她求出每个元素除以 $10007$ 的余数即可。
## 输入格式

第一行三个正整数 $n,m,k$。

接下来一行 $k$ 个正整数 $\{c_k\}$。

接下来 $m$ 行，第 $i$ 行三个正整数 $o_i,x_i,y_i$。
## 输出格式

一行 $n$ 个非负整数，表示数组 $\{a_n\}$ 中每个元素的值除以 $10007$ 的余数。
## 样例

### 样例输入 #1
```
2 3 3
1 2 3
1 1 2
2 1 1
2 1 2
```
### 样例输出 #1
```
8 0
```
## 提示

### 样例 1 解释

先执行第 $1$ 个机器的操作，给 $a_1$ 加上了 $2$。

然后执行第 $2$ 个机器的操作，它操作了第 $1$ 个机器，给 $a_1$ 加上了 $2$。

然后执行第 $3$ 个机器的操作。它先操作了第 $1$ 个机器，给 $a_1$ 加上了 $2$；然后操作了第 $2$ 个机器，第 $2$ 个机器又操作了第 $1$ 个机器，给 $a_1$ 加上了 $2$。

综上所述，最后得到的数组为 $\{8,0\}$。

### 数据范围


对于 $10\%$ 的数据，$n,m,k \le 10$。

对于 $30\%$ 的数据，$n,m,k \le 1000$。

对于另外 $20\%$ 的数据，$n=1$。

对于另外 $20\%$ 的数据，$k=1$。

对于 $100\%$ 的数据，$1 \le n,m,k \le 2 \times 10^5$，$1 \le c_i \le n$，$o_i \in \{1,2\}$，$o_1=1$。此外，对于第 $i$ 个机器，保证：

- 若 $o_i=1$，则 $1 \le x_i \le n$，$1 \le y_i \le 10^4$。
- 若 $o_i=2$，则 $1 \le x_i \le y_i \le i-1$。


---

---
title: "「HOI R1」杂赛选比"
layout: "post"
diff: 普及+/提高
pid: P10381
tag: ['动态规划 DP', '线段树', '并查集', '2024', 'O2优化', '洛谷比赛']
---
# 「HOI R1」杂赛选比
## 题目背景

你说得对，但是小 $\iiint$ 在打 CF 时将 Earn or Unlock 错看成了下面的鬼畜样子，痛失 2h 遗憾离场，希望大家引以为戒。
## 题目描述

给定一个长度为 $n$ 的数组 $a$，初始只有 $a_1$ 是已被解锁的。现在有一个整数 $i$，初始值为 $1$。现在小 $\iiint$ 在对这个数组进行一个游戏：

- 如果 $a_i$ 未被解锁，游戏结束。
- 否则他可以将 $a_{i+1\sim i+a_i}$ 设置成已被解锁的，或是获得 $a_i$ 个金币（如果 $a_i=0$ 则无法解锁任何元素），然后将 $i$ 加 $1$。

请你求出游戏结束后你能获得的最大金币数量。
## 输入格式

**本题有多组测试数据。**

第一行一个整数 $T$，表示测试数据组数。

对于每一组数据，第一行一个正整数 $n$。

接下来一行 $n$ 个非负整数 $a_{1\sim n}$。
## 输出格式

对于每一组数据，一行一个数，表示答案。
## 样例

### 样例输入 #1
```
3
2
1 2
5
2 4 5 0 1
4
0 4 4 4

```
### 样例输出 #1
```
2
9
0

```
### 样例输入 #2
```
1
10
1 1 4 5 1 4 1 9 1 9
```
### 样例输出 #2
```
26

```
## 提示

#### 【样例 1 解释】

对于第一组数据，你可以解锁 $a_2$，再获得 $a_2$ 个金币。而对于第三组数据，你无法解锁 $a_2$，因此只能获得 $0$ 个金币。

对于第二组数据，你可以解锁 $a_2,a_3$，并获得 $9$ 个金币。

#### 【样例 2 解释】

将第 $1,2,3,6$ 个位置用于解锁为最优方案。

#### 【数据范围】

对于 $100\%$ 的数据，$1\le n\le10^5$，$0\le a_i\le10^5$，$T\le 5$。

|测试点编号|$n\leq$|$a_i\leq$|$T=$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$10$|$0$|$1$|/|
|$2\sim3$|$10$|$5$|$1$|/|
|$4\sim5$|$600$|$600$|$1$|/|
|$6\sim8$|$5000$|$5000$|$1$|/|
|$9\sim10$|$10^5$|$5$|$5$|/|
|$11\sim12$|$5\times10^4$|$10^5$|$5$|$a_i>n$|
|$13\sim20$|$10^5$|$10^5$|$5$|/|


---

---
title: "「XSOI-R1」跳跃游戏"
layout: "post"
diff: 普及+/提高
pid: P10403
tag: ['线段树', '二分', '2024', '洛谷原创', 'O2优化', '枚举', 'ST 表', '双指针 two-pointer']
---
# 「XSOI-R1」跳跃游戏
## 题目背景

本来可怜的 $\texttt{MhxMa}$ 想出这道题，但是已经被 $\texttt{Ferm\_Tawn}$ 抢了，此时 $\texttt{MhxMa}$ 坐在电脑面前，看着马上要造好的数据，想象着自己的题难倒一大片选手的梦想破灭了。
## 题目描述

这是一个跳跃游戏。在游戏中你可以跳到任意位置，其中有 $n$ 个点：$1 , 2 , 3, \cdots , n$，跳到那里会有奖励分数 $a_1 , a_2 , \cdots , a_n$。

显然，这个游戏很简单，$\texttt{MhxMa}$ 没过多久就获得了所有分数，于是改进了代码，添加了经验值这个参数。

对于有奖励分数的 $n$ 个点，若从点 $x$ 跳到点 $y$，会获得经验值 $\operatorname{score}_{x , y}(1\le x\le y\le n)$：

$$\operatorname{score}_{x,y}=\begin{cases}\operatorname{len}  & \operatorname{gcd}(a_x , a_{x+1} , \dots , a_y)=2 , \operatorname{len \ mod} 2 = 0  \\ \operatorname{len} &\gcd(a_x , a_{x + 1} , \dots , a_y)=3 , \operatorname{len \ mod} 2 = 1\\ 0 & \operatorname{others} \end{cases}$$

其中，$\operatorname {len}$ 表示区间的长度，即 $y-x+1$。

**对于每一对位置 $(x,y)$，多次跳跃只会获得一次经验值。**

为了向 $\texttt{MhxMa}$ 展现你的编程实力，你决定写一个代码算出这个游戏能刷到的最大经验值。
## 输入格式

输入共两行。

输入第一行包含一个整数 $n$。

第二行包含 $n$ 个整数 $a_i$。
## 输出格式

输出一个整数，表示答案。
## 样例

### 样例输入 #1
```
5
2 3 6 3 9
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
5
2 2 2 2 2
```
### 样例输出 #2
```
16
```
### 样例输入 #3
```
9
6 2 3 6 4 6 8 2 5
```
### 样例输出 #3
```
19
```
## 提示

**请使用较快的读入方式。**

### 样例解释 #1

$\operatorname{score_{2 , 2}}= 1$。

$\operatorname{score_{2 , 4}}= 3$。

$\operatorname{score_{3 , 5}}= 3$。

$\operatorname{score_{4 , 4}}= 1$。

$1+3+3+1=8$。

### 样例解释 #2

$\operatorname{score_{1 , 2}}= 2$。

$\operatorname{score_{1 , 4}}= 4$。

$\operatorname{score_{2 , 3}}= 2$。

$\operatorname{score_{2 , 5}}= 4$。

$\operatorname{score_{3 , 4}}= 2$。

$\operatorname{score_{4 , 5}}= 2$。

$2+ 4 + 2 + 4 + 2 + 2 = 16$。

------------
### 数据规模与约定

**本题采用捆绑测试**。

- Subtask 0（20 pts）：$n \le 10^2$。 

- Subtask 1（10 pts）：$n \le 2 \times 10^3$。

- Subtask 2（20 pts）：$n \le 10^4$。

- Subtask 3（50 pts）：$n \le 6 \times 10^5 $。


对于所有测试数据，$1 \le n \le 6 \times 10^5$，$1 \le a_i \le 10^7$。


---

---
title: "【MX-S1-T2】催化剂"
layout: "post"
diff: 普及+/提高
pid: P10673
tag: ['数学', '贪心', '线段树', '树状数组', 'O2优化', '梦熊比赛']
---
# 【MX-S1-T2】催化剂
## 题目背景

原题链接：<https://oier.team/problems/S1B>。
## 题目描述

小朋友们很喜欢糖果。

现在，小 K 有一些糖果，每个糖果上有一个数字代表它的种类。

有 $q$ 次事件，每次事件会加入一个糖果、或删除一个糖果、或提出一次询问。

每次询问会给出一个 $k$，表示小 K 现在需要将所有糖果分给 $k$ 个小朋友，并且每个小朋友都需要得到至少一个糖果。同时，小朋友们不喜欢得到相同的糖果。具体的，在一个小朋友得到了糖果 $i$ 时，如果 Ta 在这个糖果之前就已经获得过糖果 $i$，那么 Ta 就会感到非常生气，Ta 的愤怒值就会增加 $1$。

小 K 不喜欢看到小朋友们生气，但小 K 无法解决这么困难的问题，所以你需要帮小 K 求出一种分糖果的方式，最小化所有小朋友的愤怒值之和。

保证存在一种分糖果的方案，使得每个小朋友都分到至少一个糖果。

每次询问并没有真正的分糖果，即每次询问后小 K 拥有的糖果不会改变。

注意，分糖果的过程可以理解为将小 K 拥有的所有糖果划分到 $k$ 个非空序列，可以重排。
## 输入格式

第一行两个正整数 $n,q$。

第二行 $n$ 个正整数 $a_1,a_2,\dots,a_n$，描述初始时小 K 拥有的糖果。

接下来 $q$ 行，每行两个正整数，描述一次操作，共有三种可能的输入：

`1 x`：表示小 K 又拥有了一个种类为 $x$ 的糖果。

`2 x`：表示小 K 丢失了一个种类为 $x$ 的糖果，保证此时小 K 拥有至少一个种类为 $x$ 的糖果。

`3 k`：表示此时小 K 需要把糖果分给 $k$ 个小朋友，你需要求出最小的所有小朋友的愤怒值之和。令 $S$ 表示此时小 K 拥有的糖果数量，保证 $1\le k\le S$。
## 输出格式

对于每次询问，输出一行一个整数，表示你求出的答案。
## 样例

### 样例输入 #1
```
5 4
3 5 2 5 5
3 2
2 5
1 5
3 1
```
### 样例输出 #1
```
1
2
```
### 样例输入 #2
```
5 15
2 5 2 5 1
2 1
1 1
1 2
1 4
1 1
3 2
1 1
3 1
1 5
3 1
1 2
3 1
2 1
3 3
2 2

```
### 样例输出 #2
```
1
5
6
7
1

```
## 提示

__【样例解释 1】__

第一次询问时，小 K 手上的糖果为 $\{3,5,2,5,5\}$，分给 $2$ 个小朋友的糖果为 $\{2,3,5\},\{5,5\}$，小朋友的愤怒值为 $0,1$。可以证明没有愤怒值之和更小的方案。

__【数据范围】__

__本题使用子任务捆绑测试。__

对于 $100\%$ 的数据，$1\le n,q\le 10^6$，$1\le a_i,x\le n$。每次询问时，令 $S$ 表示此时小 K 拥有的糖果数量，保证 $1\le k\le S$。

| 子任务编号 | $n\le $ | $q\le $ | 特殊性质      | 分值 |
| ---------- | ------- | ------- | ------------- | ---- |
| $1$        | $5$     | $15$    | 无            | $20$ |
| $2$        | $2000$  | $2000$  | 无            | $20$ |
| $3$        | $10^5$  | $10^5$  | 无            | $20$ |
| $4$        | $10^6$  | $10^6$  | $a_i,x\le 50$ | $10$ |
| $5$        | $10^6$  | $10^6$  | $k\le 50$     | $10$ |
| $6$        | $10^6$  | $10^6$  | 无            | $20$ |



---

---
title: "[EPXLQ2024 fall round] 神奇磁铁"
layout: "post"
diff: 普及+/提高
pid: P11414
tag: ['数学', '线段树']
---
# [EPXLQ2024 fall round] 神奇磁铁
## 题目背景


lzy 给了 Cute_QiQi 很多组神奇的磁铁。

注：想拿到**快速 AK 变换奖**请在代码注释部分写明本题代码正确性证明。
## 题目描述

一组神奇的磁铁由 $2x$ 个磁铁排成一排组成，编号 $1,2,\dots,2x$，有激活和未激活两种状态。它们与普通的磁铁不同，不会简单地吸在一起。对于一组磁铁，当且仅当存在 $y \in [1,x]$，使得不存在两个激活的磁铁满足两者之间的距离为 $y$，整组磁铁才会吸在一起。不同组的磁铁之间不相互影响。

对于编号为 $i,j$ 的两个磁铁，它们之间的距离为 $|i-j|$。具体地，当 $x=2$ 时，磁铁组为 $\{1,2,3,4\}$。当激活的磁铁为 $\{1,2\}$ 时，整组磁铁可以吸在一起，因为对于 $y=2$，不存在两个磁铁之间的距离为 $2$。而激活的磁铁为 $\{1,2,3\}$ 时整组磁铁不能吸在一起。

lzy 给了 Cute_QiQi $n$ 组磁铁。现在，Cute_QiQi 希望把这 $n$ 组磁铁排成一排作为装饰，同组磁铁堆在一起。未被吸在一起的磁铁不便于摆放，因此，Cute_QiQi 希望所有的磁铁组内的磁铁都吸在一起。在此基础上，Cute_QiQi 希望激活**尽可能多**的磁铁。

另外，有时 lzy 会给 Cute_QiQi 一些额外的磁铁。

磁铁实在是太多了，以至于 Cute_QiQi 计算不出她最多能激活多少磁铁。因此，她希望你帮她写一个程序，支持下面两种操作：

- `1 l r x`，表示 lzy 给 $[l,r]$ 内所有的磁铁组添加了 $2x$ 个磁铁；
- `2 l r`，表示 Cute_QiQi 想知道在激活最多磁铁的情况下，$[l,r]$ 内的磁铁组总共有多少个磁铁被激活。
## 输入格式

输入第一行为 $n,q$，其中 $q$ 表示操作的个数。

第二行为 $n$ 个整数 $a_1,a_2,.\dots,a_n$，表示每个磁铁组中初始的磁铁数量 $2a_i$。

以下 $q$ 行，每行一个操作，格式如下：

- `1 l r x`，表示 lzy 给 $[l,r]$ 内所有的磁铁组添加了 $2x$ 个磁铁；
- `2 l r`，表示 Cute_QiQi 想知道在激活最多磁铁的情况下，$[l,r]$ 内的磁铁组总共有多少个磁铁被激活。
## 输出格式

对于每个 `2 l r` 操作，输出一行表示答案。
## 样例

### 样例输入 #1
```
6 6
1 1 4 5 1 4
2 1 6
1 1 3 2
2 1 4
2 1 6
1 1 3 -2
2 1 6
```
### 样例输出 #1
```
19
22
28
19
```
## 提示

### 样例解释

初始时对应的激活磁铁的最大数量依次为 $1,1,5,6,1,5$。

进行修改操作后，对应的激活磁铁最大数量依次为 $4,4,8,6,1,5$。

可以证明，不可能再激活更多的磁铁。

### 数据规模与约定

**本题采用捆绑测试。**

设 $v$ 表示任意时刻，磁铁数最多的磁铁组内磁铁的数量。

| $\text{Subtask}$ | $n \le$ | $q \le$ | $v \le$ | 分值 |
| :-: | :-: | :-: | :-: | :-: |
| $0$ | $1000$ | $1000$ | $20$ | $10$ |
| $1$ | $1000$ | $1000$ | $10^9$ | $15$ |
| $2$ | $5 \times 10^5$ | $5 \times 10^5$ | $20$ | $10$ |
| $3$ | $5 \times 10^5$ | $5 \times 10^5$ | $5000$ | $25$ |
| $4$ | $5 \times 10^5$ | $5 \times 10^5$ | $10^9$ | $40$ |

对于所有数据，保证 $1 \le n,q \le 5 \times 10^5, 1 \le l \le r \le n, 1 \le v,a_i \le 10^9, -10^9 \le x \le 10^9$。


---

---
title: "[USACO24DEC] Deforestation S"
layout: "post"
diff: 普及+/提高
pid: P11453
tag: ['贪心', '线段树', '二分', 'USACO', '堆', '2024', '差分约束']
---
# [USACO24DEC] Deforestation S
## 题目描述

Farmer John 正在扩大他的农场！他已经找到了完美的位置——红黑森林，由数轴上的 $N$ 棵树（$1≤N≤10^5$）组成，第 $i$ 棵树位于位置 $x_i$（$−10^9≤x_i≤10^9$）。

环境保护法限制了 Farmer John 可以砍伐哪些树来为他的农场腾出空间。有 $K$ 个限制（$1≤K≤10^5$），规定在线段 $[l_i,r_i]$（包含端点）中必须始终至少存在 $t_i$ 棵树（$−10^9≤l_i,r_i≤10^9$）。输入保证红黑森林初始时满足这些限制。

Farmer John 想要他的农场尽可能大。请帮助他计算他可以砍伐的树的最大数量，同时仍然满足所有限制！
## 输入格式

每个测试点包含 $T$（$1≤T≤10$）个独立的测试用例。输入保证一个测试点中的所有 $N$ 之和以及 $K$ 之和均不超过 $3⋅10^5$。

输入的第一行包含 $T$。每个测试用例的格式如下：

- 第一行包含整数 $N$ 和 $K$。
- 下一行包含 $N$ 个整数 $x_1,\cdots,x_N$。
- 以下 $K$ 行，每行包含三个空格分隔的整数 $l_i$，$r_i$ 和 $t_i$。
## 输出格式

对于每个测试用例，输出一行，包含一个整数，表示 Farmer John 可以砍伐的树的最大数量。
## 样例

### 样例输入 #1
```
3
7 1
8 4 10 1 2 6 7
2 9 3
7 2
8 4 10 1 2 6 7
2 9 3
1 10 1
7 2
8 4 10 1 2 6 7
2 9 3
1 10 4
```
### 样例输出 #1
```
4
4
3
```
## 提示

### 样例解释

对于第一个测试用例，Farmer John 可以砍伐前 $4$ 棵树，留下位于 $x_i=2,6,7$ 的树来满足限制。

对于第二个测试用例，额外的限制不会影响 Farmer John 可以砍伐哪些树，因此他可以砍伐相同的树并同时满足两个限制。

对于第三个测试用例，Farmer John 至多只能砍伐 $3$ 棵树，因为初始时有 $7$ 棵树，但第二个限制要求他至少留下 $4$ 棵树不砍伐。

### 测试点性质

测试点性质：
- 测试点 1：样例。
- 测试点 2：$N,K≤16$。
- 测试点 3-5：$N,K≤1000$。
- 测试点 6-7：对于所有的 $i=1,\cdots,K$ 有 $ti=1$。
- 测试点 8-11：没有额外限制。


---

---
title: "中位数"
layout: "post"
diff: 普及+/提高
pid: P1168
tag: ['线段树', '二分', '堆', '树状数组']
---
# 中位数
## 题目描述

给定一个长度为 $N$ 的非负整数序列 $A$，对于前奇数项求中位数。
## 输入格式

第一行一个正整数 $N$。

第二行 $N$ 个正整数 $A_{1\dots N}$。
## 输出格式

共 $\lfloor \frac{N + 1}2\rfloor$ 行，第 $i$ 行为 $A_{1\dots 2i - 1}$ 的中位数。

## 样例

### 样例输入 #1
```
7
1 3 5 7 9 11 6
```
### 样例输出 #1
```
1
3
5
6
```
### 样例输入 #2
```
7
3 1 5 9 8 7 6
```
### 样例输出 #2
```
3
3
5
6
```
## 提示

对于 $20\%$ 的数据，$N \le 100$；

对于 $40\%$ 的数据，$N \le 3000$；

对于 $100\%$ 的数据，$1 \le N ≤ 100000$，$0 \le A_i \le 10^9$。



---

---
title: "[PA 2017] 烧饼 2"
layout: "post"
diff: 普及+/提高
pid: P11805
tag: ['2017', '线段树', 'PA（波兰）']
---
# [PA 2017] 烧饼 2
## 题目背景


译自 [PA 2017](https://sio2.mimuw.edu.pl/c/pa-2017-1/) R2T1。


## 题目描述

有 $n$ 个人买烧饼。第 $i$ 个人会在时刻 $t_i$ 到达。

顾客只会买新鲜出炉的烧饼。也就是说，第 $i$ 个人拿到的烧饼必须在时刻 $t_i$ 或者之后**出炉**。

有 $m$ 种烤箱，第 $i$ 种烤箱需要 $d_i$ 单位时间来烤烧饼。也就是说，如果从时刻 $a$ 开始烤烧饼，那么出炉时间为时刻 $(a+d_i)$。

对于每一种烤箱，计算：如果用**一台**这种烤箱，从 $0$ 时刻起烤烧饼，计算最优策略下顾客等待时间和的最小值。

## 输入格式

第一行，两个正整数 $n,m$。

第二行，$n$ 个非负整数 $t_1,t_2,\cdots,t_n$。

第三行，$m$ 个正整数 $d_1,d_2,\cdots,d_m$。
## 输出格式

输出 $m$ 行，第 $i$ 行一个非负整数，表示选择第 $i$ 种烤箱的答案。
## 样例

### 样例输入 #1
```
4 3
3 10 11 23
4 2 5
```
### 样例输出 #1
```
4
1
6
```
## 提示

- $1\le n,m\le 2\times 10^5$；
- $0\le t_1\le t_2\le \cdots\le t_n\le 10^{12}$；
- $1\le d_i\le 10^6$。


---

---
title: "数组的划分"
layout: "post"
diff: 普及+/提高
pid: P11901
tag: ['线段树', '后缀自动机 SAM', '动态树 LCT', '哈希 hashing', '分块']
---
# 数组的划分
## 题目背景

本来这里应该有一段一脉相承的背景故事。但是因为福尔魔斯验题的时候写吐了，所以背景故事没了。
## 题目描述

给出 $m$ 个数组 $s_1, s_2, \cdots s_m$ 和一个长为 $n$ 的数组 $t$。

定义 $f(l,r)$ 表示在所有 "把 $t_l...t_r$ 分成若干段，要求每一段都是 $s$ 中某个数组的子段" 的方式中，划分段数的最小值。

有以下操作：

1. 强制限定 $p,p+1$ 处必须划分，如果已经有了则取消。

2. 将 $t$ 的区间 $[l, r]$ 改成数组 $a$，会给出 $a$，每次的 $a$ 可能不一样。

3. 询问 $f(l,r)$，保证有解。

请你完成这些操作。

## 输入格式

第一行四个数，$n,m,q,id$，表示 $t$ 的长度，总共有多少个文本数组 $s$，操作数，以及数据类型（参见说明）。

接下来 $m$ 行，每行先给出一个数 $k$，代表 $s_i$ 的长度，然后 $k$ 个数给出 $s_i$ 这个数组的元素。

下一行，给出 $n$ 个数，表示 $t$ 中的元素。

接下来 $q$ 行，每行表示一个操作，分别如下：

1. $1\ x$，表示若 $x,x+1$ 处不必须划分，则标为必须划分，否则取消。

2. $2\ l\ r\ a_1\ a_2 \cdots a_{r-l+1}$，表示令 $\forall l \le i \le r，t_i = a_{i-l+1}$。

3. $3\ l\ r$，表示询问 $f(l,r)$。
## 输出格式

对于每次询问，输出一个数表示答案。每个答案占一行。
## 样例

### 样例输入 #1
```
5 3 7 0
3 1 2 3 
4 3 2 2 2 
3 3 2 2 
2 3 3 2 1 
3 1 5
1 3
3 1 5
2 2 4 1 3 2
3 1 5
1 3
3 1 5
```
### 样例输出 #1
```
3
4
5
4
```
### 样例输入 #2
```
10 5 20 0
3 1 2 3 
5 3 3 1 1 3 
10 1 2 1 1 2 3 2 1 1 3 
2 1 1 
2 1 3 
1 3 2 3 3 1 3 3 2 3 
1 4
2 7 7 3 
3 3 9
1 4
1 2
2 5 5 2 
1 2
2 7 7 2 
1 1
3 5 8
2 4 4 1 
3 3 8
1 1
1 3
2 6 6 1 
2 1 1 1 
2 4 4 2 
1 7
3 1 5
3 1 9
```
### 样例输出 #2
```
4
2
3
4
6
```
## 提示

## 样例解释

对于第一组样例，初始数组为 $[2,3,3,2,1]$ ，段数最小分割的方式为 $[2,3|3,2|1]$ ，故输出 $3$ 。然后限制了 $3,4$ 之间必须分割，故最小的分割方式为 $[2,3|3|2|1]$ ，输出为 $4$ 。之后数组被修改为 $[2,1,3,2,1]$ ，段数最小的分割方式为 $[2|1|3|2|1]$ ，故输出 $5$ 。最后取消了 $3,4$ 之间必须分割的限制，最小分割方式为 $[2|1|3,2|1]$ ，输出 $4$ 。

-----

## 数据范围

记 $\sum\limits_{i=1}^m |s_i|= M$ ，对于所有操作 2， $\sum\limits_{i=1}^t |r_i-l_i+1| = T$ ，其中 $t$ 是操作 2 的出现次数， $V$ 为数组中和修改后的数组中的元素的最大值，则各数据点的限制如下：

| 测试点 | $n, M, q \leq$ | $T\leq$ | $V\leq$ | $id=$ | 特殊性质|
| :-----------: | :-----------: |  :-----------: | :-----------: | :-----------: | :-----------: |
| $1\sim3$ | $50$ | $10^5$ | $10^9$ | $1$ | 无 |
| $4$ | $1000$ | $1000$ | $10^9$ | $2$ | 无 |
| $5$ | $1000$ | $0$ | $4$ | $3$ | 保证没有操作 1, 2 |
| $6\sim7$ | $1000$ | $0$ | $4$ | $4$ | 保证没有操作 2 |
| $8\sim11$ | $1000$ | $1000$ | $4$| $5$ | 无 |
| $12$ | $10^5$ | $10^5$ | $10^9$| $6$ | 无 |
| $13\sim14$ | $10^5$ | $0$ | $4$| $7$ | 保证没有操作 1, 2 |
| $15\sim17$ | $10^5$ | $0$ | $4$| $8$ | 保证没有操作 2 |
| $18\sim25$ | $10^5$ | $10^5$ | $4$| $9$ | 无 |

对于所有数据，保证 $1\le n,M,q\le10^5, 0\le T\le 10^5,1\le V\le10^9, 1\le id\le9, l\le r$ 。$a,t$ 中的所有数都在 $s$ 中出现。

**保证给出的数组随机，但是询问的区间与询问的操作并不随机**。具体而言，初始给出的 $s,t$ 以及询问时可能给出的 $a$ 在符合上文所述限制之下的所有可能情况中等概率选取。而其他数据则不是随机的。


---

---
title: "[JSOI2008] 最大数"
layout: "post"
diff: 普及+/提高
pid: P1198
tag: ['2008', '线段树', '二分', '各省省选', '江苏', '栈', 'ST 表']
---
# [JSOI2008] 最大数
## 题目描述

现在请求你维护一个数列，要求提供以下两种操作：

1.  查询操作。

语法：`Q L`

功能：查询当前数列中末尾 $L$ 个数中的最大的数，并输出这个数的值。

限制：$L$ 不超过当前数列的长度。$(L > 0)$

2. 插入操作。

语法：`A n`

功能：将 $n$ 加上 $t$，其中 $t$ 是最近一次查询操作的答案（如果还未执行过查询操作，则 $t=0$），并将所得结果对一个固定的常数 $D$ 取模，将所得答案插入到数列的末尾。

限制：$n$ 是整数（可能为负数）并且在长整范围内。

注意：初始时数列是空的，没有一个数。

## 输入格式

第一行两个整数，$M$ 和 $D$，其中 $M$ 表示操作的个数，$D$ 如上文中所述。

接下来的 $M$ 行，每行一个字符串，描述一个具体的操作。语法如上文所述。
## 输出格式

对于每一个查询操作，你应该按照顺序依次输出结果，每个结果占一行。

## 样例

### 样例输入 #1
```
5 100
A 96
Q 1
A 97
Q 1
Q 2

```
### 样例输出 #1
```
96
93
96

```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq M \leq 2 \times 10^5$，$1 \leq D \leq 2 \times 10^9$。


---

---
title: "跳舞机"
layout: "post"
diff: 普及+/提高
pid: P12247
tag: ['动态规划 DP', '线段树', '堆', '洛谷原创', 'O2优化', '扫描线', '洛谷月赛']
---
# 跳舞机
## 题目描述

小 O 想要经营电 van 城，跳舞机的运营非常重要。

小 O 的电 van 城有一台跳舞机，跳舞机在同一时间**至多有一名玩家游玩**，每局游戏需要完整且连续地游玩 $k$ 分钟。

电 van 城将营业 $m$ 分钟。期间有 $n$ 名玩家想要游玩跳舞机，编号 $1\sim n$。编号为 $i$ 的玩家会在营业的第 $l_i$ 分钟到第 $r_i$ 分钟（包括 $l_i$ 和 $r_i$）待在电 van 城，在此期间可以游玩任意局跳舞机。并且，每游玩一局，会产生 $w_i$ 的兴奋值。注意，如果玩家 $i$ 要玩一局跳舞机，则每局游戏的 $k$ 分钟必须完全包含于玩家的停留时间 $[l_i,r_i]$。

小 O 想要最大化所有玩家的兴奋值之和，请你帮他求出最大的兴奋值之和。
## 输入格式

输入共 $n+1$ 行。

第一行输入三个整数 $n,m,k$，分别表示玩家个数、营业时间、游玩一局跳舞机需要的时间。

第 $2\sim n+1$ 行，第 $i+1$ 行有三个整数 $l_i,r_i,w_i$，表示编号为 $i$ 的玩家的停留时间和游玩一局产生的兴奋值。
## 输出格式

输出共一行一个整数，表示最大的兴奋值之和。
## 样例

### 样例输入 #1
```
3 6 2
1 5 1
5 6 2
5 6 3

```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4 7 3
1 7 1
2 5 4
4 7 5
1 2 10
```
### 样例输出 #2
```
9
```
## 提示

#### 样例 #1 解释

可以让编号为 $1$ 的玩家在第 $1\sim2$ 分钟、第 $3\sim 4$ 分钟玩一局跳舞机，编号为 $3$ 的玩家在第 $5\sim 6$ 分钟玩一局。兴奋值的总和为 $1+1+3=5$，可以发现没有让兴奋值总和更大的方案。 

#### 样例 #2 解释

可以让编号为 $2$ 的玩家在第 $2\sim4$ 分钟玩一局跳舞机，编号为 $3$ 的玩家在第 $5\sim 7$ 分钟玩一局。兴奋值的总和为 $4+5=9$，可以发现没有让兴奋值总和更大的方案。

### 数据范围

对于所有数据，满足：

- $1\le n,m,k\le 5\times 10^5$
；
- $k\le m$；
- $1\le l_i\le r_i\le m$；
- $1\le w_i\le 10^9$。

设 $L_i=r_i-l_i+1$，则具体测试点限制如下：

| 测试点编号 | $n$ 的范围 | $m$ 的范围 | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |
| $1\sim 3$ | $n\le 5$ | $m\le 10$ | $w_i\le 20$ |
| $4\sim 6$ | $n\le 10^5$ | $m\le 10^5$ |  $k=1$ |
| $7\sim10$ | $n\le 1000$ | $m\le 1000$ |  无 |
| $11\sim 13$ | $n\le 10^5$ | $m\le 10^5$ | $L_i=k$ |
| $14\sim 16$ | $n\le 100$ | $m\le 10^5$ | 无 |
| $17\sim 20$ | $n\le 10^5$ | $m\le 10^5$ | $w_i=1$ |
| $21,22$ | $n\le 10^5$ | $m\le 10^5$ | 无 |
| $23\sim 25$ | $n\le 5\times 10^5$ | $m\le 5\times 10^5$ | 无 |


---

---
title: "[蓝桥杯 2025 省 A 第二场] 栈与乘积"
layout: "post"
diff: 普及+/提高
pid: P12347
tag: ['线段树', '2025', '栈', '蓝桥杯省赛']
---
# [蓝桥杯 2025 省 A 第二场] 栈与乘积
## 题目背景

目前测试数据可能较水，我们之后会加强数据。
## 题目描述

给定一个栈，给出若干次如下类型的操作：

1. $1 \ x$: 将 $x$ 加入栈顶。
2. $2$: 将栈顶的数弹出（如果栈是空的，则什么都不做）。
3. $3 \ y$: 查询栈内的最顶端 $y$ 个数的乘积。如果大于等于 $2^{32}$，输出 `OVERFLOW`。如果栈内不足 $y$ 个数，输出 `ERROR`。
## 输入格式

输入的第一行包含一个正整数 $Q$，表示操作次数。

接下来 $Q$ 行，每行包含一个或两个正整数表示一个操作，如果一行包含两个整数，两个整数之间用一个空格分隔。
## 输出格式

对于每个 $3 \ y$ 形式的操作，输出一行包含一个整数，表示答案。
## 样例

### 样例输入 #1
```
9
1 65536
1 65536
3 2
3 3
2
1 1024
1 2
3 2
3 3
```
### 样例输出 #1
```
OVERFLOW
ERROR
2048
134217728
```
## 提示

### 评测用例规模与约定

- 对于 $30\%$ 的评测用例，$Q \leq 5000$；
- 对于所有评测用例，$1 \leq Q \leq 10^5$，$0 \leq x < 2^{30}$，$1 \leq y < 2^{30}$。


---

---
title: "[蓝桥杯 2022 省 Python B] 最优清零方案"
layout: "post"
diff: 普及+/提高
pid: P12372
tag: ['线段树', '2022', '蓝桥杯省赛']
---
# [蓝桥杯 2022 省 Python B] 最优清零方案
## 题目描述

给定一个长度为 $N$ 的数列 $A_1, A_2, \cdots, A_N$。现在小蓝想通过若干次操作将这个数列中每个数字清零。

每次操作小蓝可以选择以下两种之一：

1. 选择一个大于 $0$ 的整数，将它减去 $1$；
2. 选择连续 $K$ 个大于 $0$ 的整数，将它们各减去 $1$。

小蓝最少经过几次操作可以将整个数列清零？
## 输入格式

输入第一行包含两个整数 $N$ 和 $K$。

第二行包含 $N$ 个整数 $A_1, A_2, \cdots, A_N$。
## 输出格式

输出一个整数表示答案。
## 样例

### 样例输入 #1
```
4 2
1 2 3 4
```
### 样例输出 #1
```
6
```
## 提示

### 评测用例规模与约定

- 对于 $20\%$ 的评测用例，$1 \leq K \leq N \leq 10$。
- 对于 $40\%$ 的评测用例，$1 \leq K \leq N \leq 100$。
- 对于 $50\%$ 的评测用例，$1 \leq K \leq N \leq 1000$。
- 对于 $60\%$ 的评测用例，$1 \leq K \leq N \leq 10000$。
- 对于 $70\%$ 的评测用例，$1 \leq K \leq N \leq 100000$。
- 对于所有评测用例，$1 \leq K \leq N \leq 1000000$，$0 \leq A_i \leq 1000000$。


---

---
title: "扶苏的问题"
layout: "post"
diff: 普及+/提高
pid: P1253
tag: ['2018', '线段树', 'O2优化']
---
# 扶苏的问题
## 题目描述

给定一个长度为 $n$ 的序列 $a$，要求支持如下三个操作：

1. 给定区间 $[l, r]$，将区间内每个数都修改为 $x$。
2. 给定区间 $[l, r]$，将区间内每个数都加上 $x$。
3. 给定区间 $[l, r]$，求区间内的最大值。
## 输入格式

第一行是两个整数，依次表示序列的长度 $n$ 和操作的个数 $q$。  
第二行有 $n$ 个整数，第 $i$ 个整数表示序列中的第 $i$ 个数 $a_i$。  
接下来 $q$ 行，每行表示一个操作。每行首先有一个整数 $op$，表示操作的类型。
- 若 $op = 1$，则接下来有三个整数 $l, r, x$，表示将区间 $[l, r]$ 内的每个数都修改为 $x$。
- 若 $op = 2$，则接下来有三个整数 $l, r, x$，表示将区间 $[l, r]$ 内的每个数都加上 $x$。
- 若 $op = 3$，则接下来有两个整数 $l, r$，表示查询区间 $[l, r]$ 内的最大值。
## 输出格式

对于每个 $op = 3$ 的操作，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
6 6
1 1 4 5 1 4
1 1 2 6
2 3 4 2
3 1 4
3 2 3
1 1 6 -1
3 1 6

```
### 样例输出 #1
```
7
6
-1
```
### 样例输入 #2
```
4 4
10 4 -3 -7
1 1 3 0
2 3 4 -4
1 2 4 -9
3 1 4
```
### 样例输出 #2
```
0
```
## 提示

### 数据规模与约定

- 对于 $10\%$ 的数据，$n = q = 1$。
- 对于 $40\%$ 的数据，$n, q \leq 10^3$。
- 对于 $50\%$ 的数据，$0 \leq a_i, x \leq 10^4$。
- 对于 $60\%$ 的数据，$op \neq 1$。
- 对于 $90\%$ 的数据，$n, q \leq 10^5$。
- 对于 $100\%$ 的数据，$1 \leq n, q \leq 10^6$，$1 \leq l, r \leq n$，$op \in \{1, 2, 3\}$，$|a_i|, |x| \leq 10^9$。

### 提示

请注意大量数据读入对程序效率造成的影响。


---

---
title: "[XJTUPC 2025] 结束乐队"
layout: "post"
diff: 普及+/提高
pid: P12539
tag: ['线段树', '二分', '2025', 'O2优化', '高校校赛']
---
# [XJTUPC 2025] 结束乐队
## 题目描述

**「我是来结束乐队的」**

某个少女乐队正在进行合照，可摄影师不怀好意，她打算对拍出的照片进行处理后再发布社交媒体，引起粉丝们的不满，这会导致乐队中某些成员人气的升降。她觉得这样就能结束这支乐队了。她的计划如下：

已知少女乐队有 $n$ 个成员，从左到右排成一排照相，其中每个成员的初始人气排名并不相同，分别从排名第 $1$ 到第 $n$。摄影师打算拍 $k$ 张照片并在每次拍完之后公开到社交媒体，她的每张照片只包含乐队成员排列中连续的一段，这样这段照片中未出现成员中的人气排名最靠前的成员的粉丝就会红温脱粉，导致这名成员的排名下降一名（原低一名的成员排名会上升）。通过 $k$ 次操作，她成功打乱了乐队成员的排名，她的目的就达到了。 

但现在她遇到了一个问题，因为乐队的成员太多了，对于每次截取下来的某一段照片，她不能判断哪个未出现的成员排名最靠前，所以她求助于你，希望你帮她解决问题。

形式化的，给定一个从 $1$ 到 $n$ 的排列 $a_1, a_2, \dots, a_n$，进行 $k$ 次操作，每次操作：

- 给定一个区间 $[l,r]$，求 **当前排列中区间 $[l,r]$ 上未出现的最小正整数** 是多少，并设此数为 $x$（即 $x=\min\{p\mid \forall i \in [l,r],p\neq a_i,p\geq 1\}$）；
  - 若 $x<n$，则输出 $x$，并交换当前排列 $a_1, a_2, \dots, a_n$ 中数字 $x$ 与 $x+1$ 的位置；
  - 若 $x\ge n$，则输出字符串 $\tt{peace}$。

其中，从 $1$ 到 $n$ 的排列 $a_1, a_2, \dots, a_n$，是指满足 $\{a_1, a_2, \dots, a_n\} = \{1, 2, \dots n\}$ 的一组数。
## 输入格式

第一行包含一个正整数 $n$ ($1\le n\le 5\times 10^5$)，表示排列的大小。

第二行包含 $n$ 个正整数 $a_i$，用一个空格分隔，表示初始排列 $a_1, a_2, \dots, a_n$ ($\{a_1, a_2, \dots, a_n\} = \{1, 2, \dots n\}$)。

第三行一个正整数 $k$ ($1\le k\le 10^5$)，表示操作的次数。

接下来 $k$ 行，每行两个正整数 $l$ 和 $r$ ($1\le l\le r\le n$)，用一个空格分隔，表示操作的区间。
## 输出格式

对于每个测试数据中的每次操作，给出答案，并执行修改。

记排列 $a_1, a_2, \dots, a_n$ 在区间 $[l,r]$ 上未出现的最小正整数为 $x$：
  - 若 $x<n$，则输出 $x$，并交换当前排列 $a_1, a_2, \dots, a_n$ 中数字 $x$ 与 $x+1$ 的位置；
  - 若 $x\ge n$，则输出字符串 $\tt{peace}$。
## 样例

### 样例输入 #1
```
5
4 3 1 2 5
5
2 4
2 5
1 3
1 3
1 5
```
### 样例输出 #1
```
4
peace
2
3
peace
```
### 样例输入 #2
```
10
10 9 4 3 2 1 6 5 8 7
3
1 10
2 9
3 9
```
### 样例输出 #2
```
peace
7
8
```
## 提示

对于第一组样例：

第一次操作 $[2,4]$，当前排列为 $4,3,1,2,5$。

区间 $[2,4]$ 内未出现的最小正整数为 $4$，输出 $4$ 并交换排列中 $4$ 和 $5$ 的位置。

第二次操作 $[2,5]$，当前排列为 $5,3,1,2,4$。

区间 $[2,5]$ 内未出现的最小正整数为 $5$，输出 $\tt{peace}$，排列不变。

第三次操作 $[1,3]$，当前排列为 $5,3,1,2,4$。

区间 $[1,3]$ 内未出现的最小正整数为 $2$，输出 $2$ 并交换排列中 $2$ 和 $3$ 的位置。

第四次操作 $[1,3]$，当前排列为 $5,2,1,3,4$。

区间 $[1,3]$ 内未出现的最小正整数为 $3$，输出 $3$ 并交换排列中 $3$ 和 $4$ 的位置。

第五次操作 $[1,5]$，当前排列为 $5,2,1,4,3$。

区间 $[1,5]$ 内未出现的最小正整数为 $6$，输出 $\tt{peace}$，排列不变。


---

---
title: "[UOI 2023] An Array and Medians of Subarrays"
layout: "post"
diff: 普及+/提高
pid: P12570
tag: ['线段树', '二分', '堆', '树状数组', '2023', 'UOI（乌克兰）']
---
# [UOI 2023] An Array and Medians of Subarrays
## 题目描述

Let's call the median of an array of length $(2 \cdot k + 1)$ the number that appears in position $(k + 1)$ after sorting its elements in non-decreasing order. For example, the medians of the arrays $[1]$, $[4,2,5]$, and $[6,5,1,2,3]$ are $1$, $4$, and $3$, respectively.

You are given an array of integers $a$ of **even** length $n$.

Determine whether it is possible to split $a$ into several subarrays of **odd** length such that all the medians of these subarrays are pairwise equal.

Formally, you need to determine whether there exists a sequence of integers $i_1, i_2, \ldots, i_k$ such that the following conditions are satisfied:

- $1 = i_1 < i_2 < \ldots < i_k = (n + 1)$;
- $(i_2 - i_1) \bmod 2 = (i_3 - i_2) \bmod 2 = \ldots = (i_k - i_{k - 1}) \bmod 2 = 1$;
- $f(a[i_1..(i_2-1)]) = f(a[i_2..(i_3-1)]) = \ldots = f(a[i_{k - 1}..(i_k - 1)])$, where $a[l..r]$ denotes the subarray consisting of elements $a_l, a_{l + 1}, \ldots, a_r$, and $f(a)$ denotes the median of the array $a$.
## 输入格式

The first line contains a single even integer $n$ ($2 \le n \le 2 \cdot 10^5$) --- the length of the array.

The second line contains $n$ integers $a_1,a_2,\ldots,a_n$ ($1\le a_i\le 10^9)$ --- the elements of the array.

It is guaranteed that $n$ is even.
## 输出格式

Output $\tt{Yes}$ if it is possible to divide $a$ into several subarrays of odd length in such a way that all medians of these subarrays are pairwise equal, and $\tt{No}$ otherwise.
## 样例

### 样例输入 #1
```
4
1 1 1 1
```
### 样例输出 #1
```
Yes
```
### 样例输入 #2
```
6
1 2 3 3 2 1
```
### 样例输出 #2
```
Yes
```
### 样例输入 #3
```
6
1 2 1 3 2 3
```
### 样例输出 #3
```
No
```
## 提示

In the first example, the array $[1,1,1,1]$ can be divided into the arrays $[1]$ and $[1,1,1]$ with medians equal to $1$.

In the second example, the array $[1,2,3,3,2,1]$ can be divided into the arrays $[1,2,3]$ and $[3,2,1]$ with medians equal to $2$.

In the third example, the array $[1,2,1,3,2,3]$ cannot be divided into several arrays of odd length with the same median values.

### Scoring

- ($3$ points): $n=2$;
- ($14$ points): $1 \le a_i \le 2$ for $1\le i\le n$;
- ($12$ points): $a_i \le a_{i+1}$ for $1\le i < n$;
- ($16$ points): $1 \le a_i \le 3$ for $1 \le i \le n$; each value occurs in $a$ no more than $n \over 2$ times;
- ($17$ points): $n \le 100$;
- ($18$ points): $n \le 2000$;
- ($20$ points): no additional restrictions.


---

---
title: "[POI 2018 R2] 电信中继站 Transceivers"
layout: "post"
diff: 普及+/提高
pid: P12762
tag: ['2018', '线段树', 'POI（波兰）']
---
# [POI 2018 R2] 电信中继站 Transceivers
## 题目背景

翻译来自于 [LibreOJ](https://loj.ac/p/5070)。
## 题目描述

**题目译自 [XXV Olimpiada Informatyczna — II etap](https://sio2.mimuw.edu.pl/c/oi25-2/dashboard/) [Przekaźniki telekomunikacyjne](https://szkopul.edu.pl/problemset/problem/GmAagCBetbskP0qiKlgVd-6A/statement/)**

国王 Bajtazar 顺应时代潮流，决定为拜托尼亚王国铺设移动电话网络，覆盖所有村庄和城市。这些地点分布在一条笔直的道路上，可视为数轴。

新任命的电信顾问需要一个程序，测试中继站天线杆的位置。每根天线杆顶端装有中继站，由参数 $s$ 和 $a$ 描述。在杆位置 $x$，信号强度为 $s$；在其他点，信号强度随距离线性下降，即在点 $x \pm d$，强度为 $\max(0, s - a \cdot d)$。

道路上某点的信号覆盖强度为所有中继站信号强度的总和。

程序需支持添加或移除天线杆，以及查询某段整数点平均信号覆盖强度的操作。
## 输入格式

第一行包含两个整数 $n, m$ $(n \geq 2, m \geq 1)$，分别表示道路长度和操作数量。

接下来的 $m$ 行描述操作，每行以单个字符开头，表示操作类型，后跟一至三个整数：
- $\texttt{P}\ x\ s\ a$：在点 $x$ 架设天线杆，安装中继站，参数为 $s, a$ $(1 \leq x \leq n, 1 \leq s, a \leq 100000)$。
- $\texttt{U}\ x$：移除点 $x$ $(1 \leq x \leq n)$ 的天线杆。
- $\texttt{Z}\ x_1\ x_2$：查询区间 $[x_1, x_2]$ 内所有整数点 $x$ $(x_1 \leq x \leq x_2, 1 \leq x_1 \leq x_2 \leq n)$ 的平均信号覆盖强度。

各行数据以单空格分隔。保证操作 $\texttt{P}$ 时点 $x$ 无天线杆，操作 $\texttt{U}$ 时点 $x$ 有天线杆。
## 输出格式

输出与输入中 $\texttt{Z}$ 操作数量相同的行，每行包含一个整数，表示对应查询的平均信号覆盖强度，向下取整。
## 样例

### 样例输入 #1
```
11 7
P 5 30 10
Z 6 7
P 10 22 5
Z 6 7
Z 6 6
U 5
Z 6 6

```
### 样例输出 #1
```
15
19
22
2

```
## 提示

**样例 1 解释**

| 操作 | 结果 | 说明 |
|:------:|:------:|:------:|
| $\texttt{P}\ 5\ 30\ 10$ | - | 在点 $x=5$ 架设天线杆，中继站参数 $s=30, a=10$。 |
| $\texttt{Z}\ 6\ 7$ | $15$ | 点 $6$ 信号强度为 $30-10=20$，点 $7$ 为 $30-2 \cdot 10=10$，区间 $[6,7]$ 整数点的平均强度为 $(20+10)/2=15$。 |
| $\texttt{P}\ 10\ 22\ 5$ | - | 在点 $x=10$ 架设天线杆，中继站参数 $s=22, a=5$。 |
| $\texttt{Z}\ 6\ 7$ | $19$ | 两杆存在，点 $6$ 强度为 $20+2=22$，点 $7$ 为 $10+7=17$，平均强度为 $(22+17)/2=19.5$，向下取整为 $19$。 |
| $\texttt{Z}\ 6\ 6$ | $22$ | 点 $6$ 强度为 $22$，平均为 $22$。 |
| $\texttt{U}\ 5$ | - | 移除点 $x=5$ 的天线杆。 |
| $\texttt{Z}\ 6\ 6$ | $2$ | 点 $6$ 强度为 $2$（仅剩 $x=10$ 的中继站）。 |

**附加样例**

1. $n=101, m=500$，道路首尾中各一杆，随机查询。
2. $n=300000$，点 $1$ 有一杆，$s=100000, a=100$，查询各前缀 $[1, i]$ 的平均强度，$1 \leq i \leq 300000$。
3. $n=300000, m=500000$，每点有杆，$s=1000, a=1$，查询整条路的平均强度。

详细子任务附加限制及分值如下表所示。

| 子任务 | 附加限制 | 分值 |
| :---: | :--: | :---: |
| $1$    | $n, m \leq 2000$         | $8$  |
| $2$    | $n \leq 300000, m \leq 500000$，$\texttt{Z}$ 操作在所有 $\texttt{P}$、$\texttt{U}$ 操作后 | $24$ |
| $3$    | $n \leq 300000, m \leq 500000$，同时最多 $50$ 个中继站 | $16$ |
| $4$    | $n \leq 300000, m \leq 500000$，$\texttt{Z}$ 操作总有 $x_1=x_2$ | $15$ |
| $5$    | $n, m \leq 100000$       | $15$ |
| $6$    | $n \leq 300000, m \leq 500000$，$\texttt{P}$ 操作总有 $a=1$ | $12$ |
| $7$    | $n \leq 300000, m \leq 500000$ | $10$ |


---

---
title: "[GCJ 2008 #1B] Mousetrap"
layout: "post"
diff: 普及+/提高
pid: P13462
tag: ['2008', '线段树', 'Google Code Jam']
---
# [GCJ 2008 #1B] Mousetrap
## 题目描述

Mousetrap is a simple card game for one player. It is played with a shuffled deck of cards numbered $1$ through $K$, face down. You play by revealing the top card of the deck and then putting it on the bottom of the deck, keeping count of how many cards you have revealed. If you reveal a card whose number matches the current count, remove it from the deck and reset the count. If the count ever reaches $K+1$, you have lost. If the deck runs out of cards, you win.

Suppose you have a deck of $5$ cards, in the order $2, 5, 3, 1, 4$. You will reveal the $2$ on count $1$, the $5$ on count $2$, then the $3$ on count $3$. Since the value matches the count, you remove the $3$ from the deck, and reset the count. You now have $4$ cards left in the order $1, 4, 2, 5$. You then reveal the $1$ on count $1$, and remove it as well (you're doing great so far!). Continuing in this way you will remove the $2$, then the $4$, and then finally the $5$ for victory.

You would like to set up a deck of cards in such a way that you will win the game and remove the cards in increasing order. We'll call a deck organized in this way "perfect." For example, with $4$ cards you can organize the deck as $1, 4, 2, 3$, and you will win by removing the cards in the order $1, 2, 3, 4$.
## 输入格式

The first line of input gives the number of cases, $T$. Each test case starts with a line containing $K$, the number of cards in a deck. The next line starts with an integer $n$, which is followed by $n$ integers $(d_1, d_2, \ldots)$, indices into the deck.

## 输出格式

For each test case, output one line containing "Case #$x$: " followed by $n$ integers $(k_1, k_2, \ldots)$, where $k_i$ is the value of the card at index $d_i$ of a perfect deck of size $K$. The numbers in the output should be separated by spaces, and there must be at least one space following the colon in each "Case #$x$: " line.
## 样例

### 样例输入 #1
```
2
5
5 1 2 3 4 5
15
4 3 4 7 10
```
### 样例输出 #1
```
Case #1: 1 3 2 5 4
Case #2: 2 8 13 4
```
## 提示

**Small dataset (15 Pts, Test set 1 - Visible)**

- Time limit: ~~60~~ 6 seconds.
- $T = 100,$
- $1 \leq K \leq 5000,$
- $1 \leq n \leq 100,$
- $1 \leq d_i \leq K.$

**Large dataset (Test set 2 - Hidden)**

- Time limit: ~~180~~ 18 seconds.
- $T = 10,$
- $1 \leq K \leq 1000000,$
- $1 \leq n \leq 100,$
- $1 \leq d_i \leq K.$



---

---
title: "[KOI 2025 #2] 存放箱子"
layout: "post"
diff: 普及+/提高
pid: P13520
tag: ['线段树', '树状数组', '2025', '离散化', 'Dilworth 定理', 'KOI（韩国）']
---
# [KOI 2025 #2] 存放箱子
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

小郑想要在仓库里存放箱子。总共有 $N$ 个箱子，编号从 1 到 $N$。第 $i$ ($1 \le i \le N$) 号箱子的大小为 $s_i$，收纳容量为 $c_i$。所有箱子的收纳容量都比其自身的大小要小，即满足 $c_i < s_i$。

小郑觉得仓库里的箱子太多、太杂乱，因此想把一些箱子装到另一些箱子里来存放。此时，必须满足以下条件：

*   一个箱子可以装入大小**不小于**其收纳容量的箱子。
*   已经装有其他箱子的箱子，也可以被装入另一个箱子中。
*   一个箱子**直接容纳**的箱子最多只能有一个。换句话说，一个箱子内最多可以直接放入一个其他的箱子，但允许这个被放入的箱子内部还装有别的箱子。

存放箱子的成本，等于没有被装在任何其他箱子里的箱子的数量。

例如，假设 $N = 4$，四个箱子的大小和收纳容量分别如下表所示。

| **编号** | **大小** | **收纳容量** |
| :---: | :---: | :---: |
|   1   |   6   |   4   |
|   2   |   5   |   1   |
|   3   |   9   |   8   |
|   4   |   2   |   1   |

此时，如下图所示，如果将 4 号箱子放入 1 号箱子，再将 1 号箱子放入 3 号箱子，那么没有被装在其他箱子里的箱子就有 2 个 (3 号箱子和 2 号箱子)，因此存放箱子的成本为 2。

![](https://cdn.luogu.com.cn/upload/image_hosting/sxmrnti7.png)

但是，如下图所示，如果将 2 号箱子和 4 号箱子都放入 3 号箱子中，由于 3 号箱子内直接容纳了两个箱子，因此不满足条件。

![](https://cdn.luogu.com.cn/upload/image_hosting/k8bcx8pi.png)

仓库里不必非要放下所有的箱子，所以小郑计划只保留编号较小的一部分箱子，并丢弃其余的。小郑目前还没有决定要使用多少个箱子。

请你帮助小郑，对于从 1 到 $N$ 的所有 $i$，编写一个程序来计算存放 $1, 2, \ldots, i$ 号箱子所需的最小成本。
## 输入格式

第一行给定箱子的数量 $N$。

从第二行开始的 $N$ 行，给出了各个箱子的信息。其中第 $i$ 行（指这 $N$ 行中的第 $i$ 行，即文件的第 $i+1$ 行）是关于第 $i$ 号箱子的，给出了其大小 $s_i$ 和收纳容量 $c_i$，以空格分隔。
## 输出格式

输出 $N$ 行。

第 $i$ ($1 \le i \le N$) 行输出存放 $1, 2, \ldots, i$ 号箱子所需的最小成本。
## 样例

### 样例输入 #1
```
4
6 4
5 1
9 8
2 1
```
### 样例输出 #1
```
1
2
2
2
```
### 样例输入 #2
```
6
3 2
5 4
3 2
4 3
4 3
3 2
```
### 样例输出 #2
```
1
1
2
2
2
3
```
### 样例输入 #3
```
8
13 6
7 5
9 4
11 10
4 2
15 5
16 7
8 3
```
### 样例输出 #3
```
1
2
3
3
3
4
4
5
```
## 提示

### 限制条件

*   所有给定的数都是整数。
*   $2 \le N \le 2 \times 10^5$
*   $1 \le c_i < s_i \le 10^9$ ($1 \le i \le N$)

### 子任务

1.  (7 分) $N \le 6$。
2.  (12 分) 对于所有 $i$，$s_i = c_i + 1$。
3.  (26 分) $N \le 1000$。
4.  (17 分) 对于所有 $i$，$s_i \le 100$。
5.  (38 分) 无额外限制条件。


---

---
title: "[CERC 2021] Single-track railway"
layout: "post"
diff: 普及+/提高
pid: P13773
tag: ['线段树', '二分', '树状数组', '2021', 'ICPC', 'CERC']
---
# [CERC 2021] Single-track railway
## 题目描述

Trains running on a single-track railway can only meet at the stations. Suppose that a pair of trains simultaneously leave in the opposite directions, one from the initial and the other from the final station, i.e. the initial station in the opposite direction. It is likely that one of the trains will have to wait for the other one at one of the stations along the railway. To minimize the delays, the trains meet at the station such that the waiting time is minimized.

We know the travel time between each two adjacent stations, equal in both directions. Unfortunately, the travel times constantly change because of the works along the railway. You are given the initial travel times and an updated travel time for the affected section after each change. Write a program that computes the shortest possible waiting time for a pair of trains leaving from the opposite ends of the railway after each of the changes.
## 输入格式

The first line specifies the number of stations, $n$. In the second line, $n-1$ numbers are given, corresponding to the initial travel times between the adjacent stations (the $i$-th number is the travel time between stations $i$ and $i+1$). The third line specifies the number of changes, $k$. This is followed by $k$ lines, each containing two numbers: the first one, $j \in [1, n-1]$, specifies the station, and the second gives the updated travel time between stations $j$ and $j+1$. Keep in mind that the first station is numbered 1 rather than 0.
## 输出格式

Output $n+1$ lines, where the $i$-th line will contain the shortest possible waiting time after $i-1$ changes (the first one should correspond to the situation before any changes).
## 样例

### 样例输入 #1
```
6
20 70 40 10 50
2
4 80
2 30
```
### 样例输出 #1
```
10
0
40
```
## 提示

### Comment

At the beginning, the trains leaving in the opposite directions should meet at station 3. The first train will reach that station in 90 minutes, and the second will arrive there in 100 minutes; the waiting time will thus be 10 minutes. Following the first change, the optimal meeting point becomes station 4. Both trains will take 130 minutes to get there, so neither will have to wait. After the second change, they will also meet at station 4. This time, however, the train that arrives first will have to wait for 40 minutes.

### Input limits

* $2 \leq n \leq 200\,000$
* $0 \leq k \leq 200\,000$
* All travel times (both the initial and the updated ones) are integers from the interval $[1, 10^6]$.


---

---
title: "线段树 1.5"
layout: "post"
diff: 普及+/提高
pid: P13825
tag: ['线段树', '离散化']
---
# 线段树 1.5
## 题目描述

如题，已知一个长度为 $n$ 的数列 $\{a_i\}$（$1 \leq i \leq n$），初始时 $a$ 序列满足 $a_i = i$。你需要进行下面两种操作：

1. 将某区间每一个数加上 $k$。
2. 求出某区间每一个数的和。
## 输入格式

第一行包含两个整数 $n, m$，分别表示该数列数字的个数和操作的总个数。

接下来 $m$ 行每行包含 $3$ 或 $4$ 个整数，表示一个操作，具体如下：

1. `1 l r k`：将区间 $[l,r]$ 内每个数加上 $k$。
2. `2 l r`：输出区间 $[l,r]$ 内每个数的和。
## 输出格式

输出包含若干行整数，即为所有操作 2 的结果。
## 样例

### 样例输入 #1
```
5 5
2 2 4
1 2 3 2
2 3 4
1 1 5 1
2 1 4
```
### 样例输出 #1
```
9
9
18
```
## 提示

对于 $30\%$ 的数据，$n \le 8$，$m \le 10$。  
对于 $50\%$ 的数据，$n \le {10}^5$。    
对于 $100\%$ 的数据，$1 \le m,k \le {10}^5$，$1 \leq l \leq r \leq n\leq 10^9$。


---

---
title: "无聊的数列"
layout: "post"
diff: 普及+/提高
pid: P1438
tag: ['线段树', '树状数组', '递归', '洛谷原创', '差分']
---
# 无聊的数列
## 题目背景

无聊的 YYB 总喜欢搞出一些正常人无法搞出的东西。有一天，无聊的 YYB 想出了一道无聊的题：无聊的数列。。。
## 题目描述

维护一个数列 $a_i$，支持两种操作：

 - `1 l r K D`：给出一个长度等于 $r-l+1$ 的等差数列，首项为 $K$，公差为 $D$，并将它对应加到 $[l,r]$ 范围中的每一个数上。即：令 $a_l=a_l+K,a_{l+1}=a_{l+1}+K+D\ldots a_r=a_r+K+(r-l) \times D$。

 - `2 p`：询问序列的第 $p$ 个数的值 $a_p$。
## 输入格式

第一行两个整数数 $n,m$ 表示数列长度和操作个数。

第二行 $n$ 个整数，第 $i$ 个数表示 $a_i$。

接下来的 $m$ 行，每行先输入一个整数 $opt$。

若 $opt=1$ 则再输入四个整数 $l\ r\ K\ D$；

若 $opt=2$ 则再输入一个整数 $p$。

## 输出格式

对于每个询问，一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 2
1 2 3 4 5
1 2 4 1 2
2 3

```
### 样例输出 #1
```
6
```
## 提示

#### 数据规模与约定

对于 $100\%$ 数据，$0\le n,m \le 10^5,-200\le a_i,K,D\le 200, 1 \leq l \leq r \leq n, 1 \leq p \leq n$。


---

---
title: "色板游戏"
layout: "post"
diff: 普及+/提高
pid: P1558
tag: ['线段树', '位运算']
---
# 色板游戏
## 题目背景

阿宝上学了，今天老师拿来了一块很长的涂色板。

## 题目描述

色板长度为 $L$，$L$ 是一个正整数，所以我们可以均匀地将它划分成 $L$ 块 $1$ 厘米长的小方格。并从左到右标记为 $1, 2, \dots L$。

现在色板上只有一个颜色，老师告诉阿宝在色板上只能做两件事：

1. `C A B C` 指在 $A$ 到 $B$ 号方格中涂上颜色 $C$。
2. `P A B` 指老师的提问：$A$ 到 $B$ 号方格中有几种颜色。

学校的颜料盒中一共有 $T$ 种颜料。为简便起见，我们把他们标记为 $1, 2, \dots T$. 开始时色板上原有的颜色就为 $1$ 号色。 面对如此复杂的问题，阿宝向你求助，你能帮助他吗？

## 输入格式

第一行有3个整数 $L (1 \le L \le 10^5), T (1 \le T \le 30) 和 O (1 \le O \le 10^5)$。 在这里 $O$ 表示事件数。 

接下来 $O$ 行, 每行以 `C A B C` 或 `P A B` 得形式表示所要做的事情（这里 $A, B, C$ 为整数, 可能 $A> B$，这样的话需要你交换 $A$ 和 $B$）。

## 输出格式

对于老师的提问，做出相应的回答。每行一个整数。

## 样例

### 样例输入 #1
```
2 2 4
C 1 1 2
P 1 2
C 2 2 2
P 1 2
```
### 样例输出 #1
```
2
1
```


---

---
title: "三元上升子序列"
layout: "post"
diff: 普及+/提高
pid: P1637
tag: ['线段树', '树状数组', '分治']
---
# 三元上升子序列
## 题目描述

Erwin 最近对一种叫 `thair` 的东西巨感兴趣。。。

在含有 $n$ 个整数的序列 $a_1,a_2,\ldots,a_n$ 中，三个数被称作`thair`当且仅当 $i<j<k$ 且 $a_i<a_j<a_k$。

求一个序列中 `thair` 的个数。
## 输入格式

开始一行一个正整数 $n$,

以后一行 $n$ 个整数 $a_1,a_2,\ldots,a_n$。
## 输出格式

一行一个整数表示 `thair` 的个数。
## 样例

### 样例输入 #1
```
4
2 1 3 4
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
5
1 2 2 3 4
```
### 样例输出 #2
```
7
```
## 提示

#### 样例2 解释

$7$ 个 `thair` 分别是：

- 1 2 3
- 1 2 4
- 1 2 3
- 1 2 4
- 1 3 4
- 2 3 4
- 2 3 4

#### 数据规模与约定

- 对于 $30\%$ 的数据 保证 $n\le100$；
- 对于 $60\%$ 的数据 保证 $n\le2000$；
- 对于 $100\%$ 的数据 保证 $1 \leq n\le3\times10^4$，$1\le a_i\leq 10^5$。


---

---
title: "[USACO04DEC] Cleaning Shifts S"
layout: "post"
diff: 普及+/提高
pid: P1668
tag: ['动态规划 DP', '图论', '贪心', '2004', '线段树', 'USACO', '最短路']
---
# [USACO04DEC] Cleaning Shifts S
## 题目描述

一天有 $T(1\le T\le 10^6)$ 个时段。约翰正打算安排他的 $N(1\le N\le 2.5\times 10^4)$ 只奶牛来值班，打扫打扫牛棚卫生。每只奶牛都有自己的空闲时间段 $ [S_i,E_i](1\le S_i\le E_i\le T)$，只能把空闲的奶牛安排出来值班。而且，每个时间段必需有奶牛在值班。

那么，最少需要动用多少奶牛参与值班呢？如果没有办法安排出合理的方案，就输出 $-1$。
## 输入格式

第 $1$ 行：$N$，$T$。

第 $2$ 到 $N+1$ 行：$S_i$，$E_i$。
## 输出格式

一行，输出最少安排的奶牛数。
## 样例

### 样例输入 #1
```
3 10
1 7
3 6
6 10
```
### 样例输出 #1
```
2
```
## 提示

$1\le T\le 10^6$，$N\le 2.5\times 10^4$，$1\le S_i\le E_i\le T$。

$\text{Update On 2023/08/08}$：添加了一组hack数据，详情见[这里](https://www.luogu.com.cn/discuss/613052)。叉掉了时间复杂度为 $\mathcal O(nt)$ 的错解。


---

---
title: "黑匣子"
layout: "post"
diff: 普及+/提高
pid: P1801
tag: ['线段树', '平衡树', '堆', 'NOI 导刊', 'O2优化']
---
# 黑匣子
## 题目描述

Black Box 是一种原始的数据库。它可以储存一个整数数组，还有一个特别的变量 $i$。最开始的时候 Black Box 是空的．而 $i=0$。这个 Black Box 要处理一串命令。

命令只有两种：

- `ADD(x)`：把 $x$ 元素放进 Black Box;

- `GET`：$i$ 加 $1$，然后输出 Black Box 中第 $i$ 小的数。

记住：第 $i$ 小的数，就是 Black Box 里的数的按从小到大的顺序排序后的第 $i$ 个元素。

我们来演示一下一个有11个命令的命令串。（如下表所示）

| 序号 | 操作 | $i$ | 数据库 | 输出 |
| :--: | :--- | :------: | ------ | :----: |
|   1  | `ADD(3)`     |   $0$    |  $3$  | / |
|   2  | `GET` |   $1$    |  $3$  | $3$ |
|   3  |`ADD(1)`|$1$|$1,3$|/|
|   4  |`GET`|$2$|$1,3$|$3$|
|   5  |`ADD(-4)`|$2$|$-4,1,3$|/|
|   6  |`ADD(2)`|$2$|$-4,1,2,3$|/|
|   7  |`ADD(8)`|$2$|$-4,1,2,3,8$|/|
|   8  |`ADD(-1000)`|$2$|$-1000,-4,1,2,3,8$|/|
|   9  |`GET`|$3$|$-1000,-4,1,2,3,8$|$1$|
|  10  |`GET`|$4$|$-1000,-4,1,2,3,8$|$2$|
|  11  |`ADD(2)`|$4$|$-1000,-4,1,2,2,3,8$|/|

现在要求找出对于给定的命令串的最好的处理方法。`ADD` 命令共有 $m$ 个，`GET` 命令共有 $n$ 个。现在用两个整数数组来表示命令串：

1. $a_1,a_2,\cdots,a_m$：一串将要被放进 Black Box 的元素。例如上面的例子中 $a=[3,1,-4,2,8,-1000,2]$。

2. $u_1,u_2,\cdots,u_n$：表示第 $u_i$ 个元素被放进了 Black Box 里后就出现一个 `GET` 命令。例如上面的例子中 $u=[1,2,6,6]$ 。输入数据不用判错。
## 输入格式

第一行两个整数 $m$ 和 $n$，表示元素的个数和 `GET` 命令的个数。

第二行共 $m$ 个整数，从左至右第 $i$ 个整数为 $a_i$，用空格隔开。

第三行共 $n$ 个整数，从左至右第 $i$ 个整数为 $u_i$，用空格隔开。
## 输出格式

输出 Black Box 根据命令串所得出的输出串，一个数字一行。 
## 样例

### 样例输入 #1
```
7 4
3 1 -4 2 8 -1000 2
1 2 6 6

```
### 样例输出 #1
```
3
3
1
2

```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，$1 \leq n,m \leq 10^{4}$。
- 对于 $50\%$ 的数据，$1 \leq n,m \leq 10^{5}$。
- 对于 $100\%$ 的数据，$1 \leq n,m \leq 2 \times 10^{5},|a_i| \leq 2 \times 10^{9}$，保证 $u$ 序列单调不降。


---

---
title: "[IOI 1998 ] [USACO5.5] 矩形周长Picture"
layout: "post"
diff: 普及+/提高
pid: P1856
tag: ['1998', '线段树', 'USACO', 'IOI', '扫描线']
---
# [IOI 1998 ] [USACO5.5] 矩形周长Picture
## 题目背景

墙上贴着许多形状相同的海报、照片。它们的边都是水平和垂直的。每个矩形图片可能部分或全部的覆盖了其他图片。所有矩形合并后的边长称为周长。

## 题目描述

编写一个程序计算周长。

![](https://cdn.luogu.com.cn/upload/image_hosting/2eo4hzl6.png)

如图 $1$ 所示 $7$ 个矩形。

![](https://cdn.luogu.com.cn/upload/image_hosting/buk96amj.png)

如图 $2$ 所示，所有矩形的边界。所有矩形顶点的坐标都是整数。

## 输入格式

输入文件的第一行是一个整数 $N$，表示有多少个矩形。接下来 $N$ 行给出了每一个矩形左下角坐标和右上角坐标。
## 输出格式

输出文件只有一个正整数，表示所有矩形的周长。

## 样例

### 样例输入 #1
```
7
-15 0 5 10
-5 8 20 25
15 -4 24 14
0 -6 16 4
2 15 10 22
30 10 36 20
34 0 40 16
```
### 样例输出 #1
```
228
```
## 提示

### 数据范围及约定

对于全部数据，$1 \le N<5000$，所有坐标的数值范围都在 $-10^4$ 到 $10^4$ 之间。


---

---
title: "[AHOI2009] 维护序列"
layout: "post"
diff: 普及+/提高
pid: P2023
tag: ['2009', '线段树', '各省省选', '安徽']
---
# [AHOI2009] 维护序列
## 题目背景

老师交给小可可一个维护数列的任务，现在小可可希望你来帮他完成。
## 题目描述

有一个长为 $n$ 的数列 $\{a_n\}$，有如下三种操作形式：

1. 格式 `1 t g c`，表示把所有满足 $t\le i\le g$ 的 $a_i$ 改为 $a_i\times c$ ;
2. 格式 `2 t g c` 表示把所有满足 $t\le i\le g$ 的 $a_i$ 改为 $a_i+c$ ;
3. 格式 `3 t g` 询问所有满足 $t\le i\le g$ 的 $a_i$ 的和，由于答案可能很大，你只需输出这个数模 $p$ 的值。
## 输入格式

第一行两个整数 $n$ 和 $p$。

第二行含有 $n$ 个非负整数，表示数列 $\{a_i\}$ 。

第三行有一个整数 $m$，表示操作总数。

从第四行开始每行描述一个操作，同一行相邻两数之间用一个空格隔开，每行开头和末尾没有多余空格。
## 输出格式

对每个操作 3，按照它在输入中出现的顺序，依次输出**一行一个整数**表示询问结果。
## 样例

### 样例输入 #1
```
7 43
1 2 3 4 5 6 7
5
1 2 5 5
3 2 4
2 3 7 9
3 1 3
3 4 7
```
### 样例输出 #1
```
2
35
8

```
## 提示

#### 样例输入输出 1 解释

- 初始时数列为 $\{1,2,3,4,5,6,7\}$。
- 经过第 $1$ 次操作后，数列为 $\{1,10,15,20,25,6,7\}$。
- 对第 $2$ 次操作，和为 $10+15+20=45$，模 $43$ 的结果是 $2$。
- 经过第 $3$ 次操作后，数列为 $\{1,10,24,29,34,15,16\}$。
- 对第 $4$ 次操作，和为 $1+10+24=35$，模 $43$ 的结果是 $35$。
- 对第 $5$ 次操作，和为 $29+34+15+16=94$，模 $43$ 的结果是$8$。


#### 数据规模与约定

测试数据规模如下表所示：

| 数据点编号 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9,10 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $n=$ | $10$ | $1000$ | $1000$ | $10000$ | $60000$ | $70000$ | $80000$ | $90000$ | $100000$ |
| $m=$ | $10$ | $1000$ | $1000$ | $10000$ | $60000$ | $70000$ | $80000$ | $90000$ | $100000$ |

对于全部的测试点，保证 $0 \leq p, a_i, c \leq 10^9$，$1 \leq t \leq g \leq n$。


---

---
title: "统计和"
layout: "post"
diff: 普及+/提高
pid: P2068
tag: ['线段树', '树状数组']
---
# 统计和
## 题目描述

给定一个长度为 $n(n\leq 100000)$，初始值都为 $0$ 的序列，$x(x\leq 100000)$ 次的修改某些位置上的数字，每次加上一个数，然后提出 $y(y\leq 100000)$ 个问题，求每段区间的和。

## 输入格式

第一行 $1$ 个整数，表示序列的长度 $n$。

第二行 $1$ 个整数，表示操作的次数 $w$。

后面依次是 $w$ 行，分别表示加入和询问操作。

其中，加入用 `x` 表示，询问用 `y` 表示。

$x$的格式为 `x a b` 表示在序列上第 $a$ 个数加上 $b$。保证 $1 \leq a \leq n$，$1 \leq b \leq 10^9$。

$y$ 的格式为 `y a b` 表示询问 $a$ 到 $b$ 区间的加和。保证 $1 \leq a \leq b \leq n$。

## 输出格式

每行一个正整数，分别是每次询问的结果

## 样例

### 样例输入 #1
```
5
4
x 3 8
y 1 3
x 4 9
y 3 4
```
### 样例输出 #1
```
8
17

```


---

---
title: "贪婪大陆"
layout: "post"
diff: 普及+/提高
pid: P2184
tag: ['线段树']
---
# 贪婪大陆
## 题目背景

面对蚂蚁们的疯狂进攻，小 FF 的 Tower defence 宣告失败……人类被蚂蚁们逼到了 Greed Island 上的一个海湾。现在，小 FF 的后方是一望无际的大海，前方是变异了的超级蚂蚁。小 FF 还有大好前程，他可不想命丧于此， 于是他派遣手下最后一批改造 SCV 布置地雷以阻挡蚂蚁们的进攻。
## 题目描述

小 FF 最后一道防线是一条长度为 $n$ 的战壕，小 FF 拥有无数多种地雷，而 SCV 每次可以在 $[L, R]$ 区间埋放同一种不同于之前已经埋放的地雷。由于情况已经十万火急，小 FF 在某些时候可能会询问你在 $[L',R']$ 区间内有多少种不同的地雷，他希望你能尽快的给予答复。

## 输入格式

第一行为两个整数 $n$ 和 $m$，$n$ 表示防线长度，$m$ 表示 SCV 布雷次数及小 FF 询问的次数总和。

接下来有 $m$ 行，每行三个整数 $q,l,r$：

- 若 $q=1$，则表示 SCV 在 $[l, r]$ 这段区间布上一种地雷；
- 若 $q=2$，则表示小 FF 询问当前 $[l, r]$ 区间总共有多少种地雷。
## 输出格式

对于小 FF 的每次询问，输出一个答案（单独一行），表示当前区间地雷总数。
## 样例

### 样例输入 #1
```
5 4
1 1 3
2 2 5
1 2 4
2 3 5

```
### 样例输出 #1
```
1
2

```
## 提示

### 数据规模与约定

- 对于 $30\%$ 的数据，$0 \le n$，$m \le 1000$。
- 对于 $100\%$ 的数据，$0 \le n$，$m \le 10^5$。


---

---
title: "守墓人"
layout: "post"
diff: 普及+/提高
pid: P2357
tag: ['线段树', '树状数组', '分块']
---
# 守墓人
## 题目背景

 ![](https://cdn.luogu.com.cn/upload/pic/1406.png) 

在一个荒凉的墓地上，有一个令人尊敬的守墓人， 他看守的墓地从来没有被盗过， 所以人们很放心的把自己的先人的墓安顿在他那

守墓人能看好这片墓地是必然而不是偶然……

因为……守墓人懂风水 0.0
## 题目描述

他把墓地分为主要墓碑和次要墓碑， 主要墓碑只能有 $1$ 个， 守墓人把他记为 $1$ 号， 而次要墓碑有 $n-1$ 个，守墓人将之编号为 $2,3\dots n$，所以构成了一个有 $n$ 个墓碑的墓地。

而每个墓碑有一个初始的风水值，这些风水值决定了墓地的风水的好坏，所以守墓人需要经常来查询这些墓碑。

善于运用风水的守墓人，通过一次次逆天改命，使得自己拥有了无限寿命，没人知道他活了多久。这天，你幸运的拜访到了他，他要求你和他共同见证接下来几年他的战果，但不过他每次统计风水值之和都需要你来帮他计算，算错了他会要你命 QAQ

风水也不是不可变，除非遭遇特殊情况，已知在接下来的 $2147483647$ 年里，会有 $f$ 次灾难，守墓人会有几个操作：

1. 将 $[l,r]$ 这个区间所有的墓碑的风水值增加 $k$。

2.将主墓碑的风水值增加 $k$

3.将主墓碑的风水值减少 $k$

4.统计 $[l,r]$ 这个区间所有的墓碑的风水值之和

5.求主墓碑的风水值

上面也说了，很多人会把先人的墓安居在这里，而且守墓人活了很多世纪→\_→，墓碑的数量会多的你不敢相信= =

守墓人和善的邀请你帮他完成这些操作，要不然哪天你的旅馆爆炸了，天上下刀子.....

为了活命，还是帮他吧

## 输入格式

第一行，两个正整数 $n,f$ 表示共有 $n$ 块墓碑，并且在接下来的 $2147483647 $年里，会有 $f$ 次世界末日

第二行，$n$ 个正整数，表示第 $i$ 块墓碑的风水值

接下来 $f$ 行，每行都会有一个针对世界末日的解决方案，如题所述，标记同题

## 输出格式

输出会有若干行，对 $4$ 和 $5$ 的提问做出回答

## 样例

### 样例输入 #1
```
5 7
0 0 0 0 0
1 1 5 1
1 1 3 3
2 3
3 1
4 1 5
2 1
5
```
### 样例输出 #1
```
16
7
```
## 提示

$20\%$ 的数据满足：$1\leq n\leq 100$

$50\%$ 的数据满足：$1\leq n\leq 6000$

$100\%$ 的数据满足：$1\leq n,f\leq 2 \times 10^5$，答案不超过 64 位整数。



---

---
title: "XOR的艺术"
layout: "post"
diff: 普及+/提高
pid: P2574
tag: ['线段树', '洛谷原创']
---
# XOR的艺术
## 题目描述

AKN 觉得第一题太水了，不屑于写第一题，所以他又玩起了新的游戏。在游戏中，他发现，这个游戏的伤害计算有一个规律，规律如下：

1. 拥有一个伤害串，是一个长度为 $n$ 的只含字符 ``0`` 和字符 ``1`` 的字符串。规定这个字符串的首字符是第一个字符，即下标从 $1$ 开始。
2. 给定一个范围 $[l,~r]$，伤害为伤害串的这个范围内中字符 ``1`` 的个数。
3. 会修改伤害串中的数值，修改的方法是把 $[l,~r]$ 中所有原来的字符 ``0`` 变成 ``1``，将 ``1`` 变成 ``0``。

AKN 想知道一些时刻的伤害，请你帮助他求出这个伤害。
## 输入格式

输入的第一行有两个用空格隔开的整数，分别表示伤害串的长度 $n$，和操作的个数 $m$。

输入第二行是一个长度为 $n$ 的字符串 $S$，代表伤害串。

第 $3$ 到第 $(m + 2)$ 行，每行有三个用空格隔开的整数 $op, l, r$。代表第 $i$ 次操作的方式和区间，规则是：

- 若 $op = 0$，则表示将伤害串的 $[l,~r]$ 区间内的 ``0`` 变成 ``1``，``1`` 变成 ``0``。
- 若 $op = 1$，则表示询问伤害串的 $[l,~r]$ 区间内有多少个字符 ``1``。
## 输出格式

对于每次询问，输出一行一个整数，代表区间内 ``1`` 的个数。

## 样例

### 样例输入 #1
```
10 6
1011101001
0 2 4
1 1 5
0 3 7
1 1 10
0 1 4
1 2 6

```
### 样例输出 #1
```
3
6
1

```
## 提示

#### 样例输入输出 $1$ 解释

原伤害串为 ``1011101001``。

对于第一次操作，改变 $[2,~4]$ 的字符，伤害串变为 ``1100101001``。

对于第二次操作，查询 $[1,~5]$ 内 ``1`` 的个数，共有 $3$ 个。

对于第三次操作，改变 $[3,~7]$ 的字符，伤害串变为 ``1111010001``。

对于第四次操作，查询 $[1,~10]$ 内 ``1`` 的个数，共有 $6$ 个。

对于第五次操作，改变 $[1,~4]$ 的字符，伤害串变为 ``0000010001``。

对于第六次操作，查询 $[2,~6]$ 内 ``1`` 的个数，共有 $1$ 个。

#### 数据范围与约定

对于 $10\%$ 的数据，保证 $n, m \leq 10$。

另有 $30\%$ 的数据，保证 $n, m \leq 2 \times 10^3$。

对于 $100\%$ 的数据，保证 $2 \leq n, m \leq 2 \times 10^5$，$0 \leq op \leq 1$，$1 \leq l \leq r \leq n$，$S$ 中只含字符 ``0`` 和字符 ``1``。


---

---
title: "[USACO08NOV] Light Switching G"
layout: "post"
diff: 普及+/提高
pid: P2846
tag: ['2008', '线段树', 'USACO']
---
# [USACO08NOV] Light Switching G
## 题目描述

Farmer John tries to keep the cows sharp by letting them play with intellectual toys. One of the larger toys is the lights in the barn. Each of the $N (2 \le N \le 10^5)$ cow stalls conveniently numbered $1\ldots N$ has a colorful light above it.

At the beginning of the evening, all the lights are off. The cows control the lights with a set of N pushbutton switches that toggle the lights; pushing switch i changes the state of light i from off to on or from on to off.

The cows read and execute a list of $M(1\le M \le 10^5)$ operations expressed as one of two integers ( $0 \le$ operation $\le 1$ ).

The first kind of operation (denoted by a $0$ command) includes two subsequent integers $S_i$ and $E_i (1 \le S_i \le E_i \le N)$ that indicate a starting switch and ending switch. They execute the operation by pushing each pushbutton from $S_i$ through $E_i$ inclusive exactly once.

The second kind of operation (denoted by a $1$ command) asks the cows to count how many lights are on in the range given by two integers $S_i$ and $E_i (1 \le S_i \le E_i \le N)$ which specify the inclusive range in which the cows should count the number of lights that are on.

Help FJ ensure the cows are getting the correct answer by processing the list and producing the proper counts.

农夫约翰试图让奶牛玩智力玩具来保持它们的敏锐。谷仓里的灯是较大的玩具之一。$N (2 \le N \le 10^5)$ 个牛栏编号为 $1 \ldots N$，每个牛栏上面都有一盏灯。起初所有的灯都关着。

共有 $M$ 次操作，分为两种。
1. 指定一个区间 $[S_i,E_i]$，然后改变编号在这个区间内的灯的状态（把开着的灯关上，关着的灯打开）；
2. 指定一个区间 $[S_i,E_i]$，要求你输出这个区间内有多少盏灯是打开的。






## 输入格式

第 $1$ 行: 用空格隔开的两个整数 $N$ 和 $M$，$N$ 是灯数。

第 $2\ldots M+1$ 行: 每行表示一个操作, 有三个用空格分开的整数: 指令号, $S_i$ 和 $E_i$。

若指令号为 $0$，则表示改变 $[S_i,E_i]$ 区间内的灯的状态（把开着的灯关上，关着的灯打开）。

若指令号为 $1$，则表示输出 $[S_i,E_i]$ 这个区间内有多少盏灯是打开的。
## 样例

### 样例输入 #1
```
4 5
0 1 2
0 2 4
1 2 3
0 2 4
1 1 4
```
### 样例输出 #1
```
1
2
```
## 提示

| 数据点编号 | $N$ | $M$ |
| :----------: | :----------: | :----------: |
| $1\sim 2$ | $\le 100$ | $\le 100$ |
| $3\sim 4$ | $\le 1000$ | $\le 1000$ |
| $5\sim 6$ | $\le 10000$ | $\le 10000$ |
| $7\sim 8$ | $\le 10^5$ | $\le 100$ |
| $9\sim 10$ | $\le 100$ | $\le 10^5$ |
| $11\sim 12$ | $\le 1000$ | $\le 10^5$ |
| $13\sim 14$ | $\le 10^5$ | $\le 1000$ |
| $15\sim 16$ | $\le 10000$ | $\le 10000$ |
| $17\sim 18$ | $\le 10$ | $\le 10^5$ |
| $19\sim 20$ | $\le 2000$ | $\le 10^6$ |



---

---
title: "[USACO06FEB] Cellphones G"
layout: "post"
diff: 普及+/提高
pid: P2856
tag: ['贪心', '2006', '线段树', 'USACO', '前缀和']
---
# [USACO06FEB] Cellphones G
## 题目描述

The cows have started using cellphones to cowmunicate with each other, but have found that the button layout doesn't suit their hooves very well. They are designing a special cellphone with fewer but larger buttons.


One feature they liked on the standard cellphones was predictive text. Each button has a few letters associated with it, and one types a word by pushing the associated buttons. Because there is more than one letter for each button, this can be ambiguous for some words.  However, most of the time the ambiguity can be resolved by using a dictionary to determine what word the user wanted.


Since the cows are designing a custom cellphone, they are also going to replace the English alphabet with the Cow alphabet. By an amazing coincidence, the cow alphabet is simply the first L (1 <= L <= 26) letters of the English alphabet, in the same order. They want to find out how to assign the letters of the Cow alphabet to the B buttons (1 <= B <= L) in such a way that the maximum number of words in their dictionary are unambiguous when entered with predictive text. Like normal cellphones, they want the letters on each button to be a contiguous section (one or more consecutive letters) of the alphabet.

奶牛的名字都是由英文字母表的前1(1 < K 26)个字母构成的.现在想设计一种手机， 有个按键.请你把这L个字母按顺序分配给B个按键，使能够通过按这些键而唯一确 定的奶牛数尽量多.

## 输入格式

Line 1: Two space-separated integers: B and L




Line 2: D, the number of words in the dictionary (1 <= D <= 1000)




Lines 3..D+2: Each line contains one word from the dictionary in upper case and of length 1..10 characters. The words are presented in alphabetical order and with no duplicates.

## 输出格式

Line 1: The number of words in the Cow dictionary that have unique button sequences.




Lines 2..B+1: The nth line contains the letters that appear on button n, in upper case and alphabetical order. The lines must be listed in alphabetical order, and every Cow letter must appear exactly once. If there is more than one optimal solution, use the one that places the most letters on button 1. Ties are broken by placing the most letters on button 2, etc.

## 样例

### 样例输入 #1
```
3 13
11
ALL
BALL
BELL
CALK
CALL
CELL
DILL
FILL
FILM
ILL
MILK
```
### 样例输出 #1
```
7
AB
CDEFGHIJK
LM
```
## 提示

Explanation of the sample:




Button 1 contains AB, button two contains C-K, and button 3 contains LM. The words CELL, DILL, FILL and FILM are all entered as 2233, while the remaining 7 words are all entered uniquely.



---

---
title: "[USACO06JAN] Corral the Cows G"
layout: "post"
diff: 普及+/提高
pid: P2862
tag: ['2006', '线段树', '二分', 'USACO']
---
# [USACO06JAN] Corral the Cows G
## 题目描述

Farmer John wishes to build a corral for his cows. Being finicky beasts, they demand that the corral be square and that the corral contain at least C (1 <= C <= 500) clover fields for afternoon treats. The corral's edges must be parallel to the X,Y axes.


FJ's land contains a total of N (C <= N <= 500) clover fields, each a block of size 1 x 1 and located at with its lower left corner at integer X and Y coordinates each in the range 1..10,000. Sometimes more than one clover field grows at the same location; such a field would have its location appear twice (or more) in the input. A corral surrounds a clover field if the field is entirely located inside the corral's borders.


Help FJ by telling him the side length of the smallest square containing C clover fields.

Farmer John 希望为他的奶牛们建立一个畜栏。

这些挑剔的奶牛要求畜栏必须是正方形的，而且至少要包含 $C$ 片三叶草，来当做它们的下午茶。

约翰的土地里一共包含 $N$ 片三叶草，每单位三叶草位于一个 $1\times 1$ 的土地区域内。坐标都为整数，范围在 $1$ 到 $10000$ 以内。

**多片的三叶草可能会位于同一个 $1\times 1$ 的区域内，所以在输入内，同一个区域坐标可能出现多次。**

请你帮 Farmer John 计算一下，在能包含至少 $C$ 片三叶草的情况下，畜栏的最小边长是多少。

$1\le C\le N\le 500$。
## 输入格式

Line 1: Two space-separated integers: C and N




Lines 2..N+1: Each line contains two space-separated integers that are the X,Y coordinates of a clover field.

## 输出格式

Line 1: A single line with a single integer that is length of one edge of the minimum size square that contains at least C clover fields.

## 样例

### 样例输入 #1
```
3 4
1 2
2 1
4 1
5 2
```
### 样例输出 #1
```
4
```
## 提示

Explanation of the sample:



```php
|*   *
| * *
+------
```

Below is one 4x4 solution (C's show most of the corral's area); many others exist.

```php
|CCCC
|CCCC
|*CCC*
|C*C*
+------
```


---

---
title: "[USACO15DEC] Counting Haybale P"
layout: "post"
diff: 普及+/提高
pid: P3130
tag: ['2015', '线段树', 'USACO']
---
# [USACO15DEC] Counting Haybale P
## 题目描述

Farmer John is trying to hire contractors to help rearrange his farm, but so far all of them have quit when they saw the complicated sequence of instructions FJ wanted them to follow.  Left to complete the project by himself, he realizes that indeed, he has made the project perhaps more  complicated than necessary.  Please help him follow his instructions to  complete the farm upgrade.

FJ's farm consists of $N$ fields in a row, conveniently numbered $1 \ldots N$. In each field there can be any number of haybales.  Farmer John's instructions contain three types of entries:

1) Given a contiguous interval of fields, add a new haybale to each field.

2) Given a contiguous interval of fields, determine the minimum number of haybales in a field within that interval.

3) Given a contiguous interval of fields, count the total number of haybales  inside that interval.
## 输入格式

The first line contains two positive integers, $N$ ($1 \leq N \leq 200,000$) and $Q$ ($1 \leq Q \leq 100,000$).

The next line contains $N$ nonnegative integers, each at most 100,000, indicating how many haybales are initially in each field.

Each of the next $Q$ lines contains a single uppercase letter, either M, P or S, followed by either two positive integers $A$ and $B$ ($1 \leq A \leq B \leq N$), or three positive integers $A$, $B$, and $C$ ($1 \leq A \leq B \leq N$; $1 \leq C \leq 100,000$).  There will be three positive integers if and only if the uppercase letter is P.

If the letter is M, print the minimum number of haybales in the interval of fields from $A \ldots B$.

If the letter is P, put $C$ new haybales in each field in the interval of fields from $A \ldots B$.

If the letter is S, print the total number of haybales found within interval of fields from $A \ldots B$.
## 输出格式

A line in the output should appear in response to every 'M' or 'S' entry in FJ's instructions.
## 样例

### 样例输入 #1
```
4 5
3 1 2 4
M 3 4
S 1 3
P 2 3 1
M 3 4
S 1 3
```
### 样例输出 #1
```
2
6
3
8
```
## 题目翻译

### 题目描述

Farmer John 正在尝试雇佣承包商来帮助他重新安排农场，但到目前为止，所有承包商在看到 FJ 希望他们遵循的复杂指令序列后都辞职了。FJ 不得不自己完成这个项目，他意识到自己可能把项目搞得比必要的还要复杂。请帮助他按照指令完成农场的升级。

FJ 的农场由一排 $N$ 个田地组成，编号为 $1 \ldots N$。每个田地里可以有任意数量的干草堆。Farmer John 的指令包含三种类型的条目：

1) 给定一个连续的田地区间，向每个田地添加一个新的干草堆。

2) 给定一个连续的田地区间，确定该区间内田地中干草堆的最小数量。

3) 给定一个连续的田地区间，计算该区间内干草堆的总数。

### 输入格式

第一行包含两个正整数，$N$（$1 \leq N \leq 200,000$）和 $Q$（$1 \leq Q \leq 100,000$）。

第二行包含 $N$ 个非负整数，每个整数最多为 $100,000$，表示每个田地中初始的干草堆数量。

接下来的 $Q$ 行每行包含一个大写字母，可能是 M、P 或 S，后跟两个正整数 $A$ 和 $B$（$1 \leq A \leq B \leq N$），或者三个正整数 $A$、$B$ 和 $C$（$1 \leq A \leq B \leq N$；$1 \leq C \leq 100,000$）。只有当大写字母是 P 时，才会有三个正整数。

如果字母是 M，输出从 $A \ldots B$ 的田地区间内干草堆的最小数量。

如果字母是 P，向从 $A \ldots B$ 的田地区间内的每个田地添加 $C$ 个新的干草堆。

如果字母是 S，输出从 $A \ldots B$ 的田地区间内干草堆的总数。

### 输出格式

对于 FJ 指令中的每一个 'M' 或 'S' 条目，输出一行相应的结果。


---

---
title: "[JLOI2014] 松鼠的新家"
layout: "post"
diff: 普及+/提高
pid: P3258
tag: ['2014', '线段树', '吉林', '最近公共祖先 LCA', '树链剖分', '差分']
---
# [JLOI2014] 松鼠的新家
## 题目描述

松鼠的新家是一棵树，前几天刚刚装修了新家，新家有$n$ 个房间，并且有 $n-1$ 根树枝连接，每个房间都可以相互到达，且俩个房间之间的路线都是唯一的。天哪，他居然真的住在“树”上。

松鼠想邀请小熊维尼前来参观，并且还指定一份参观指南，他希望维尼能够按照他的指南顺序，先去 $a_1$，再去 $a_2$，……，最后到 $a_n$，去参观新家。可是这样会导致重复走很多房间，懒惰的维尼不停地推辞。可是松鼠告诉他，每走到一个房间，他就可以从房间拿一块糖果吃。

维尼是个馋家伙，立马就答应了。现在松鼠希望知道为了保证维尼有糖果吃，他需要在每一个房间各放至少多少个糖果。

因为松鼠参观指南上的最后一个房间 $a_n$ 是餐厅，餐厅里他准备了丰盛的大餐，所以当维尼在参观的最后到达餐厅时就不需要再拿糖果吃了。
## 输入格式

第一行一个正整数 $n$，表示房间个数第二行 $n$ 个正整数，依次描述 $a_1, a_2,\cdots,a_n$。

接下来 $n-1$ 行，每行两个正整数 $x,y$，表示标号 $x$ 和 $y$ 的两个房间之间有树枝相连。
## 输出格式

一共 $n$ 行，第 $i$ 行输出标号为 $i$ 的房间至少需要放多少个糖果，才能让维尼有糖果吃。
## 样例

### 样例输入 #1
```
5
1 4 5 3 2
1 2
2 4
2 3
4 5
```
### 样例输出 #1
```
1
2
1
2
1
```
## 提示

对于全部的数据，$2 \le n \le 3 \times 10^5$，$1 \le a_i \le n$。


---

---
title: "【模板】线段树 1"
layout: "post"
diff: 普及+/提高
pid: P3372
tag: ['线段树']
---
# 【模板】线段树 1
## 题目描述

如题，已知一个数列 $\{a_i\}$，你需要进行下面两种操作：

1. 将某区间每一个数加上 $k$。
2. 求出某区间每一个数的和。

## 输入格式

第一行包含两个整数 $n, m$，分别表示该数列数字的个数和操作的总个数。

第二行包含 $n$ 个用空格分隔的整数 $a_i$，其中第 $i$ 个数字表示数列第 $i$ 项的初始值。

接下来 $m$ 行每行包含 $3$ 或 $4$ 个整数，表示一个操作，具体如下：

1. `1 x y k`：将区间 $[x, y]$ 内每个数加上 $k$。
2. `2 x y`：输出区间 $[x, y]$ 内每个数的和。
## 输出格式

输出包含若干行整数，即为所有操作 2 的结果。
## 样例

### 样例输入 #1
```
5 5
1 5 4 2 3
2 2 4
1 2 3 2
2 3 4
1 1 5 1
2 1 4
```
### 样例输出 #1
```
11
8
20
```
## 提示

对于 $15\%$ 的数据：$n \le 8$，$m \le 10$。  
对于 $35\%$ 的数据：$n \le {10}^3$，$m \le {10}^4$。    
对于 $100\%$ 的数据：$1 \le n, m \le {10}^5$，$a_i,k$ 为正数，且任意时刻数列的和不超过 $2\times 10^{18}$。

**【样例解释】**

![](https://cdn.luogu.com.cn/upload/pic/2251.png)


---

---
title: "【模板】线段树 2"
layout: "post"
diff: 普及+/提高
pid: P3373
tag: ['线段树', 'O2优化']
---
# 【模板】线段树 2
## 题目描述

如题，已知一个数列，你需要进行下面三种操作：

- 将某区间每一个数乘上 $x$；
- 将某区间每一个数加上 $x$；
- 求出某区间每一个数的和。

## 输入格式

第一行包含三个整数 $n,q,m$，分别表示该数列数字的个数、操作的总个数和模数。

第二行包含 $n$ 个用空格分隔的整数，其中第 $i$ 个数字表示数列第 $i$ 项的初始值。

接下来 $q$ 行每行包含若干个整数，表示一个操作，具体如下：

操作 $1$： 格式：`1 x y k`  含义：将区间 $[x,y]$ 内每个数乘上 $k$

操作 $2$： 格式：`2 x y k`  含义：将区间 $[x,y]$ 内每个数加上 $k$

操作 $3$： 格式：`3 x y`  含义：输出区间 $[x,y]$ 内每个数的和对 $m$ 取模所得的结果

## 输出格式

输出包含若干行整数，即为所有操作 $3$ 的结果。

## 样例

### 样例输入 #1
```
5 5 38
1 5 4 2 3
2 1 4 1
3 2 5
1 2 4 2
2 3 5 5
3 1 4
```
### 样例输出 #1
```
17
2
```
## 提示

【数据范围】

对于 $30\%$ 的数据：$n \le 8$，$q \le 10$。  
对于 $70\%$ 的数据：$n \le 10^3 $，$q \le 10^4$。  
对于 $100\%$ 的数据：$1 \le n \le 10^5$，$1 \le q \le 10^5$。

除样例外，$m = 571373$。

（数据已经过加强 ^\_^）

样例说明：

 ![](https://cdn.luogu.com.cn/upload/pic/2255.png) 

故输出应为 $17$、$2$（$40 \bmod 38 = 2$）。


---

---
title: "[USACO17JAN] Cow Dance Show S"
layout: "post"
diff: 普及+/提高
pid: P3611
tag: ['模拟', '2017', '线段树', '二分', 'USACO', '优先队列', '队列']
---
# [USACO17JAN] Cow Dance Show S
## 题目描述

After several months of rehearsal, the cows are just about ready to put on their annual dance performance; this year they are performing the famous bovine ballet "Cowpelia".

The only aspect of the show that remains to be determined is the size of the stage. A stage of size $K$ can support $K$ cows dancing simultaneously. The $N$ cows in the herd ($1 \leq N \leq 10,000$) are conveniently numbered $1 \ldots N$ in the order in which they must appear in the dance. Each cow $i$ plans to dance for a specific duration of time $d(i)$. Initially, cows $1 \ldots K$ appear on stage and start dancing. When the first of these cows completes her part, she leaves the stage and cow $K+1$ immediately starts dancing, and so on, so there are always $K$ cows dancing (until the end of the show, when we start to run out of cows). The show ends when the last cow completes her dancing part, at time $T$.

Clearly, the larger the value of $K$, the smaller the value of $T$. Since the show cannot last too long, you are given as input an upper bound $T_{max}$ specifying the largest possible value of $T$. Subject to this constraint, please determine the smallest possible value of $K$.


## 输入格式

The first line of input contains $N$ and $T_{max}$, where $T_{max}$ is an integer of value at most 1 million.

The next $N$ lines give the durations $d(1) \ldots d(N)$ of the dancing parts for cows $1 \ldots N$. Each $d(i)$ value is an integer in the range $1 \ldots 100,000$.

It is guaranteed that if $K=N$, the show will finish in time.


## 输出格式

Print out the smallest possible value of $K$ such that the dance performance will take no more than $T_{max}$ units of time.


## 样例

### 样例输入 #1
```
5 8
4
7
8
6
4
```
### 样例输出 #1
```
4

```
## 题目翻译

### 题目描述

经过几个月的排练，奶牛们基本准备好展出她们的年度舞蹈表演。今年她们要表演的是著名的奶牛芭蕾——“cowpelia”。

表演唯一有待决定的是舞台的尺寸。一个大小为 $K$ 的舞台可以支持 $K$ 头牛同时在舞台上跳舞。在牛群中的 $N$ 头牛按照她们必须出现在舞蹈中的顺序方便地编号为 $1,2,\dots,N$。第 $i$ 头牛计划跳 $d_i$ 的特定持续时间。
一开始，第 $1,2,\dots,K$ 头牛出现在舞台上并开始跳舞。当这些牛中的某一头牛首先完成了她的部分，她会马上离开舞台并且第 $K+1$ 头牛会出现在舞台上并开始跳舞。所以，舞台上总有 $K$ 头奶牛在跳舞（直到表演的尾声，奶牛不够的时候）。当最后一头奶牛完成了她的舞蹈部分，表演结束，共花了 $T$ 个单位时间。

显然，$K$ 的值越大，$T$ 就越小。由于表演不能拖太长，你得知了指定 $T$ 的最大可能值的上限 $T_{max}$。请根据这个约束，确定 $K$ 的最小值。

### 输入格式

第一行包括 $N$ 和 $T_{max}$ 两个整数。

接下来的 $N$ 行，第 $i$ 行给出了第 $i$ 头牛跳舞的持续时间 $d_i$。第 $i$ 行包括一个整数 $d_i$。

保证 $K=N$ 时表演会按时完成。

### 输出格式

输出在表演时间不大于 $T_{max}$ 时的 $K$ 的最小可能值。

### 提示说明

对于 $100\%$ 的数据，$1 \le N \le 10^4$，$T_{max} \le 10^6$，$1 \le d_i \le 10^5$。


---

---
title: "[HAOI2014] 贴海报"
layout: "post"
diff: 普及+/提高
pid: P3740
tag: ['2014', '河南', '线段树', '各省省选', '离散化', '枚举']
---
# [HAOI2014] 贴海报
## 题目描述

Bytetown 城市要进行市长竞选，所有的选民可以畅所欲言地对竞选市长的候选人发表言论。为了统一管理，城市委员会为选民准备了一个张贴海报的 electoral 墙。

张贴规则如下：

1. electoral 墙是一个长度为 $N$ 个单位的长方形，每个单位记为一个格子；

2. 所有张贴的海报的高度必须与 electoral 墙的高度一致的；

3. 每张海报以 `A B` 表示，即从第 $A$ 个格子到第 $B$ 个格子张贴海报；

4. 后贴的海报可以覆盖前面已贴的海报或部分海报。

现在请你判断，张贴完所有海报后，在 electoral 墙上还可以看见多少张海报。
## 输入格式

第一行，两个正整数 $N,M$，分别表示 electoral 墙的长度和海报个数。

接下来 $M$ 行，每行两个正整数 $A_i,B_i$，表示每张海报张贴的位置。

## 输出格式

输出贴完所有海报后，在 electoral 墙上还可以看见的海报数。
## 样例

### 样例输入 #1
```
100 5
1 4
2 6
8 10
3 4
7 10

```
### 样例输出 #1
```
4
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/5209.png) 

**约束条件**

$10\le N \le 10000000,1\le M\le 1000,1\le A_i \le B_i \le 10000000$

所有的数据都是正整数，数据之间有一个空格。


---

---
title: "红色的幻想乡"
layout: "post"
diff: 普及+/提高
pid: P3801
tag: ['线段树', '树状数组', '洛谷原创', '容斥原理']
---
# 红色的幻想乡
## 题目背景

蕾米莉亚的红雾异变失败后，很不甘心。

## 题目描述

经过上次失败后，蕾米莉亚决定再次发动红雾异变，但为了防止被灵梦退治，她决定将红雾以奇怪的阵势释放。

我们将幻想乡看做是一个 $n \times m$的方格地区，一开始没有任何一个地区被红雾遮盖。蕾米莉亚每次站在某一个地区上，向东南西北四个方向各发出一条无限长的红雾，可以影响到整行/整列，但不会影响到她所站的那个地区。如果两阵红雾碰撞，则会因为密度过大而沉降消失。灵梦察觉到了这次异变，决定去解决它。但在解决之前，灵梦想要了解一片范围红雾的密度。可以简述为两种操作:

``1 x y`` 蕾米莉亚站在坐标 $(x,y)$ 的位置向四个方向释放无限长的红雾。

``2 x1 y1 x2 y2`` 询问左上点为$(x1,y1)$，右下点为 $(x2,y2)$ 的矩形范围内，被红雾遮盖的地区的数量。

## 输入格式

第一行三个整数 $n,m,q$，表示幻想乡大小为 $n \times m$，有 $q$ 个询问。

接下来 $q$ 行，每行 $3$ 个或 $5$ 个整数,用空格隔开，含义见题目描述。
## 输出格式

对于每一个操作 $2$，输出一行一个整数，表示对应询问的答案。
## 样例

### 样例输入 #1
```
4 4 3
1 2 2
1 4 4
2 1 1 4 4

```
### 样例输出 #1
```
8
```
## 提示

#### 样例输入输出 1 解释

用``o``表示没有红雾，``x``表示有红雾，两次释放红雾后幻想乡地图如下:

```
oxox
xoxo
oxox
xoxo
```

---

#### 数据规模与约定

- 对于 $20\%$ 的数据，$1 \le n,m,q \le 200$。
- 对于 $40\%$ 的数据，$1 \le n,m,q \le 10^3$。
- 对于 $100\%$ 的数据，$1 \le n,m,q \le 10^5$，$1 \le x_1,x_2,x \le n$，$x_1 \le x_2$，$1 \le y_1,y_2,y \le m$，$y_1 \le y_2$。


---

---
title: "[TJOI2009] 开关"
layout: "post"
diff: 普及+/提高
pid: P3870
tag: ['2009', '线段树', '各省省选', '分块', '天津']
---
# [TJOI2009] 开关
## 题目描述

现有 $n$ 盏灯排成一排，从左到右依次编号为：$1$，$2$，……，$n$。然后依次执行 $m$ 项操作。

操作分为两种：

1. 指定一个区间 $[a,b]$，然后改变编号在这个区间内的灯的状态（把开着的灯关上，关着的灯打开）；
2. 指定一个区间 $[a,b]$，要求你输出这个区间内有多少盏灯是打开的。

**灯在初始时都是关着的。**
## 输入格式

第一行有两个整数 $n$ 和 $m$，分别表示灯的数目和操作的数目。

接下来有 $m$ 行，每行有三个整数，依次为：$c$、$a$、$b$。其中 $c$ 表示操作的种类。

- 当 $c$ 的值为 $0$ 时，表示是第一种操作。
- 当 $c$ 的值为 $1$ 时，表示是第二种操作。

$a$ 和 $b$ 则分别表示了操作区间的左右边界。
## 输出格式

每当遇到第二种操作时，输出一行，包含一个整数，表示此时在查询的区间中打开的灯的数目。
## 样例

### 样例输入 #1
```
4 5
0 1 2
0 2 4
1 2 3
0 2 4
1 1 4

```
### 样例输出 #1
```
1
2
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $2\le n\le 10^5$，$1\le m\le 10^5$，$1\le a,b\le n$，$c\in\{0,1\}$。


---

---
title: "数颜色"
layout: "post"
diff: 普及+/提高
pid: P3939
tag: ['线段树', '二分', 'O2优化', '可持久化线段树']
---
# 数颜色
## 题目背景

大样例可在页面底部「附件」中下载。
## 题目描述

小 C 的兔子不是雪白的，而是五彩缤纷的。每只兔子都有一种颜色，不同的兔子可能有 相同的颜色。小 C 把她标号从 1 到 $n$ 的 $n$ 只兔子排成长长的一排，来给他们喂胡萝卜吃。 排列完成后，第 $i$ 只兔子的颜色是 $a_i$。

俗话说得好，“萝卜青菜，各有所爱”。小 C 发现，不同颜色的兔子可能有对胡萝卜的 不同偏好。比如，银色的兔子最喜欢吃金色的胡萝卜，金色的兔子更喜欢吃胡萝卜叶子，而 绿色的兔子却喜欢吃酸一点的胡萝卜……为了满足兔子们的要求，小 C 十分苦恼。所以，为 了使得胡萝卜喂得更加准确，小 C 想知道在区间 $[l_j,r_j]$ 里有多少只颜色为 $c_j$ 的兔子。

不过，因为小 C 的兔子们都十分地活跃，它们不是很愿意待在一个固定的位置；与此同 时，小 C 也在根据她知道的信息来给兔子们调整位置。所以，有时编号为 $x_j$ 和 $x_j+1$ 的两 只兔子会交换位置。  小 C 被这一系列麻烦事给难住了。你能帮帮她吗？

## 输入格式

从标准输入中读入数据。 输入第 1 行两个正整数 $n$,$m$。

输入第 2 行 $n$ 个正整数，第 $i$ 个数表示第 $i$ 只兔子的颜色 $a_i$。

输入接下来 $m$ 行，每行为以下两种中的一种：

- “$1\ l_j\ r_j\ c_j$” ：询问在区间 $[l_j,r_j]$ 里有多少只颜色为 $c_j$ 的兔子；

- “$2\ x_j$”： $x_j$ 和 $x_j+1$ 两只兔子交换了位置。

## 输出格式

输出到标准输出中。

对于每个 1 操作，输出一行一个正整数，表示你对于这个询问的答案。

## 样例

### 样例输入 #1
```
6 5 
1 2 3 2 3 3  
1 1 3 2 
1 4 6 3  
2 3 
1 1 3 2  
1 4 6 3
```
### 样例输出 #1
```
1 
2 
2 
3 

```
## 提示

【样例 1 说明】

前两个 1 操作和后两个 1 操作对应相同；在第三次的 2 操作后，3 号兔子和 4 号兔子

交换了位置，序列变为 1 2 2 3 3 3。

【数据范围与约定】

子任务会给出部分测试数据的特点。如果你在解决题目中遇到了困难，可以尝试只解 决一部分测试数据。 对于所有测试点，有 $1 \le l_j < r_j \le n,1 \le x_j < n$。 每个测试点的数据规模及特点如下表：

 ![](https://cdn.luogu.com.cn/upload/pic/9808.png) 

特殊性质 1：保证对于所有操作 1，有 $|r_j - l_j| \le 20$ 或 $|r_j - l_j| \le n - 20$。

特殊性质 2：保证不会有两只相同颜色的兔子。



---

---
title: "[USACO17DEC] Haybale Feast G"
layout: "post"
diff: 普及+/提高
pid: P4085
tag: ['2017', '线段树', 'USACO', '前缀和', 'ST 表', '双指针 two-pointer']
---
# [USACO17DEC] Haybale Feast G
## 题目描述

Farmer John is preparing a delicious meal for his cows! In his barn, he has $N$ haybales ($1 \le N \le 100,000$). The $i$th haybale has a certain flavor $F_i$ ($1 \le F_i \le 10^9$) and a certain spiciness $S_i$ ($1 \le S_i \le 10^9$).

The meal will consist of a single course, being a contiguous interval containing one or more consecutive haybales (Farmer John cannot change the order of the haybales). The total flavor of the meal is the sum of the flavors in the interval. The spiciness of the meal is the maximum spiciness of all haybales in the interval.


Farmer John would like to determine the minimum spiciness his single-course meal could achieve, given that it must have a total flavor of at least $M$ ($1 \le M \le 10^{18}$).

## 输入格式

The first line contains the integers $N$ and $M$, the number of haybales and the minimum total flavor the meal must have, respectively. The next $N$ lines describe the $N$ haybales with two integers per line, first the flavor $F$ and then the spiciness $S$.

## 输出格式

Please output the minimum spiciness in a single course meal that satisfies the minimum flavor requirement. There will always be at least one single-course meal that satisfies the flavor requirement.

## 样例

### 样例输入 #1
```
5 10
4 10
6 15
3 5
4 9
3 6
```
### 样例输出 #1
```
9
```
## 题目翻译

### 题目描述

农夫约翰正在为他的奶牛准备一顿美味的晚餐！在他的谷仓里，他有 $N$ 个干草捆 $(1 \le N \le 10^5)$ 。第 $i$ 个干草捆有一定的风味 $F_i(1 \le F_i \le 10^9)$ 和一定的辣度 $S_i(1 \le S_i \le 10^9)$ 。

这顿饭将由一道菜组成，是一个连续的区间，包含一个或多个连续的干草捆(农夫约翰不能改变干草捆的顺序)。这顿饭的总体的风味是这段区间里风味的总和。这顿饭的总体辣度是区间中所有草包的最大辣度。

农夫约翰想确定他的这道菜所能达到的最小辣度，但是这道菜的总风味必须至少为 $M(1 \le M \le 10^{18})$ 。

### 输入格式

第一行包含两个整数 $N$ 和 $M$ ，分别是干草包的数量和这顿饭必须有的最小风味之和。

接下来的 $N$ 行，每行两个整数描述这 $N$ 个草包，首先是风味 $F_i$，然后是辣度 $S_i$。

### 输出格式

请输出这道菜中在满足最低风味时的最低辣度。保证至少有一顿单道菜的饭能满足风味的要求。


---

---
title: "[BalticOI 2007] Sound 静音问题"
layout: "post"
diff: 普及+/提高
pid: P4392
tag: ['搜索', '2007', '线段树', '树状数组', 'BalticOI（波罗的海）']
---
# [BalticOI 2007] Sound 静音问题
## 题目描述

数字录音中，声音是用表示空气压力的数字序列描述的，序列中的每个值称为一个采样，每个采样之间间隔一定的时间。 

很多声音处理任务都需要将录到的声音分成由静音隔开的几段非静音段。为了避免分成过多或者过少的非静音段，静音通常是这样定义的：$m$ 个采样的序列，该序列中采样的最大值和最小值之差不超过一个特定的阈值 $c$。 

请你写一个程序，检测 $n$ 个采样中的静音。
## 输入格式

第一行有三个整数 $n,m,c$（$1\le n\le10^6$，$1\le m\le10^4$，$0\le c\le10^4$），分别表示总的采样数、静音的长度和静音中允许的最大噪音程度。

第 $2$ 行 $n$ 个整数 $a_i$（$0\le a_i\le 10^6$），表示声音的每个采样值，每两个整数之间用空格隔开。
## 输出格式

列出了所有静音的起始位置 $i$（$i$ 满足$\max\{a_i,a_{i+1}\cdots a_{i+m-1}\}-\min\{a_i,a_{i+1}\cdots a_{i+m-1}\}\le c$），每行表示一段静音的起始位置，按照出现的先后顺序输出。如果没有静音则输出 `NONE`。

## 样例

### 样例输入 #1
```
7 2 0
0 1 1 2 3 2 2
```
### 样例输出 #1
```
2
6
```


---

---
title: "[TJOI2018] 数学计算"
layout: "post"
diff: 普及+/提高
pid: P4588
tag: ['2018', '线段树', '各省省选', '天津']
---
# [TJOI2018] 数学计算
## 题目描述

小豆现在有一个数 $x$，初始值为 $1$。小豆有 $Q$ 次操作，操作有两种类型：

`1 m`：将 $x$ 变为 $x \times m$，并输出 $x \bmod M$

`2 pos`：将 $x$ 变为 $x$ 除以第 $pos$ 次操作所乘的数（保证第 $pos$ 次操作一定为类型 1，对于每一个类型 1 的操作至多会被除一次），并输出 $x \bmod M$。
## 输入格式

一共有  $t$ 组输入。

对于每一组输入，第一行是两个数字 $Q,M$。

接下来 $Q$ 行，每一行为操作类型 $op$，操作编号或所乘的数字 $m$（保证所有的输入都是合法的）。
## 输出格式

对于每一个操作，输出一行，包含操作执行后的 $x \bmod M$ 的值。
## 样例

### 样例输入 #1
```
1
10 1000000000
1 2
2 1
1 2
1 10
2 3
2 4
1 6
1 7
1 12
2 7
```
### 样例输出 #1
```
2
1
2
20
10
1
6
42
504
84
```
## 提示

对于 $20\%$ 的数据，$1 \le Q \le 500$。

对于 $100\%$ 的数据，$1 \le Q \le 10^5$，$t \le 5, M \le 10^9$，$0 < m \leq 10^9$。


---

---
title: "[BalticOI 2011] Switch the Lamp On 电路维修 (Day1)"
layout: "post"
diff: 普及+/提高
pid: P4667
tag: ['2011', '线段树', '优先队列', '最短路', 'BalticOI（波罗的海）']
---
# [BalticOI 2011] Switch the Lamp On 电路维修 (Day1)
## 题目描述

Casper is designing an electronic circuit on a $N \times M$ rectangular grid plate. There are $N \times M$ square tiles that are aligned to the grid on the plate. Two (out of four) opposite corners of each tile are connected by a wire.

A power source is connected to the top left corner of the plate. A lamp is connected to the bottom right corner of the plate. The lamp is on only if there is a path of wires connecting power source to lamp. In order to switch the lamp on, any number of tiles can be turned by 90° (in both directions).

![0](http://ruanx.pw/bzojch/file/2346_0.jpg)

In the picture above the lamp is off. If any one of the tiles in the second column from the right is turned by 90° , power source and lamp get connected, and the lamp is on.

Write a program to find out the minimal number of tiles that have to be turned by 90° to switch the lamp on.
## 输入格式

The first line of input contains two integer numbers $N$ and $M$, the dimensions of the plate. In each of the following $N$ lines there are $M$ symbols – either \ or / – which indicate the direction of the wire connecting the opposite vertices of the corresponding tile.
## 输出格式

There must be exactly one line of output. If it is possible to switch the lamp on, this line must contain only one integer number: the minimal number of tiles that have to be turned to switch on the lamp. If it is not possible, output the string: ``NO SOLUTION``
## 样例

### 样例输入 #1
```
3 5
\\/\\
\\///
/\\\\
```
### 样例输出 #1
```
1
```
## 提示

对于 $40\%$ 的数据，$1 \le N \le 4$，$1 \le M \le 5$。

对于所有数据，$1 \le N,M \le 500$。
## 题目翻译

### 题目描述
Casper 正在设计电路。有一种正方形的电路元件，在它的两组相对顶点中，有一组会用导线连接起来，另一组则不会。有 $N\times M$ 个这样的元件，你想将其排列成 $N$ 行，每行 $M$ 个。 电源连接到板的左上角。灯连接到板的右下角。只有在电源和灯之间有一条电线连接的情况下，灯才会亮着。为了打开灯，任何数量的电路元件都可以转动 90°（两个方向）。

![](https://cdn.luogu.com.cn/upload/pic/1286.png)

![](https://cdn.luogu.com.cn/upload/pic/1285.png)

在上面的图片中，灯是关着的。如果右边的第二列的任何一个电路元件被旋转 90°，电源和灯都会连接，灯被打开。现在请你编写一个程序，求出最小需要多少旋转多少电路元件。

### 输入输出格式

#### 输入格式
输入的第一行包含两个整数 $N$ 和 $M$，表示盘子的尺寸。 在以下 $N$ 行中，每一行有 $M$ 个符号 `\` 或 `/`，表示连接对应电路元件对角线的导线的方向。
#### 输出格式：
如果可以打开灯，那么输出只包含一个整数，表示最少转动电路元件的数量。

如果不可能打开灯，输出 `NO SOLUTION`。


---

---
title: "全村最好的嘤嘤刀"
layout: "post"
diff: 普及+/提高
pid: P4970
tag: ['模拟', '线段树']
---
# 全村最好的嘤嘤刀
## 题目背景

**重阳节**到了，我们最好的八重樱拥有全村最好的嘤嘤刀……
## 题目描述

在绯玉丸力量的影响下，八重村成了一条长度为 $n$ 的八重街，并且绯玉丸可以带着八重樱出现在街上的任意地点。而我们的八重樱则会在街上任意穿梭来获取某一地点上的嘤嘤嘤能量，用以升级她的嘤嘤刀。

**出题人：March_H**

在每个时刻，都会发生以下 $3$ 个事件：

$1$ $x$ $val$ 表示在 $x$ 地点出现了携带着 $val$ 点嘤嘤嘤能量的绯狱丸，并且绯狱丸会吞噬该点的嘤嘤嘤能量，使得该点的嘤嘤嘤能量变为 $ val - a_i$ 点，$a_i$ 为出现绯狱丸的前一刻，该点所存在的嘤嘤嘤能量。

$2$ $l$ $r$ 表示绯玉丸会带着八重樱出现在[ $l$ , $r$ ]间的任意一点。八重樱为了尽快升级她的嘤嘤刀，会获取该区间上最大的嘤嘤嘤能量。特殊的，为了保卫八重村，当 $l$ , $r$ 之间存在绯狱丸时，八重樱会优先用她的嘤嘤刀对付绯狱丸，并获得绯狱丸此时拥有的 $a_i$ 点嘤嘤嘤能量。

$3$ $l$ $r$ $val$ 绯玉丸会嘤嘤嘤，使得[ $l$ , $r$ ]上的每一个地点的嘤嘤嘤能量增加 $val$ 点(包括绯狱丸)。
## 输入格式

第一行为 $2$ 个数 $n$ , $m$。

第二行为 $n$ 个数，分别表示八重街上每个地点的初始嘤嘤嘤能量。

接下来 $m$ 行，每行会发生 $3$ 个事件中的一个，输入格式为题目描述中的格式。
## 输出格式

对于每一个事件 $2$ ，你应当输出八重樱在该事件中获取的嘤嘤嘤能量并换行。

当所有事件结束时，如果嘤嘤刀积累的能量小于 $10000$ ，你应当输出 $QAQ$ 。

如果在[ $10000$ , $10000000$ )间，你应当输出 $Sakura$。

如果都不符合，请输出 $ice$。
## 样例

### 样例输入 #1
```
10 10
1 2 3 4 5 6 7 8 9 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10

```
### 样例输出 #1
```
10
9
8
7
6
5
4
3
2
1
QAQ
```
### 样例输入 #2
```
10 11
0 0 0 0 0 0 0 0 0 0
3 1 10 1
3 2 10 1
3 3 10 1
3 4 10 1
3 5 10 1
3 6 10 1
3 7 10 1
3 8 10 1
3 9 10 1
3 10 10 1
2 1 10

```
### 样例输出 #2
```
10
QAQ
```
### 样例输入 #3
```
10 13
0 0 0 0 0 0 0 0 0 0
1 10 10000
1 9 9000
1 8 8000
1 7 7000
1 6 6000
1 5 5000
1 4 4000
1 3 3000
1 2 2000
1 1 1000
2 10 10
2 8 8
2 8 10

```
### 样例输出 #3
```
10000
8000
9000
Sakura
```
## 提示

对于所有的数据：

最终答案都会在 $[0,2^{31}-1]$ 范围内；

$n$ , $m$ $\leqslant$ $100000$。

值得注意的是，无论八重樱是获取了某一地点的嘤嘤嘤能量还是击败了某一地点的绯狱丸，该地点的嘤嘤嘤值都应当清零而不是保留原来的数值。

对于事件 $2$ ，题目保证每个事件中最多出现 $1$ 只绯狱丸。如果出现多个最大值，在每次比较时，请选择靠右的(std默认的)。


---

---
title: "Lycanthropy"
layout: "post"
diff: 普及+/提高
pid: P5026
tag: ['线段树', '差分']
---
# Lycanthropy
## 题目背景

小正方形亲眼看见了自己昔日的朋友被卷进了黑暗的深渊，然而它无力阻止……

现在它的朋友已经向它发起了攻击，因此小正方形不得不抵抗。
## 题目描述

我们把山顶上的湖泊看作一条长度为 $m$ 的直线，一开始水深都在水平线上，我们视作此时的水深为 '0'

接下来，在一瞬间，小正方形的"朋友"们跳起并扎入水中，导致在入水点的水降低而远离入水点的水升高，注意两个 "朋友" 可能在同一地点入水。

小正方形的每个朋友有一个体积数值 $v$，当体积为 $v$ 的一个朋友跳入水中，我们设入水点为 $i$，将会导致 $i - v + 1$ 到 $i$ 的水位依次降低 $1,2,\cdots,v$

同样地，第 $i$ 到 $i + v - 1$ 的水位会依次降低 $v,v - 1,\cdots,1$.

相对应地，$i - v$ 的水位不变， $i - v - 1$ 到 $i - 2 * v$ 水位依次增加 $1,2,\cdots,v$， $i - 2 * v$ 到 $i - 3 * v + 1$ 水位依次增加 $v,v - 1,\cdots,1$

同样，$i + v$ 水位不变，$i + v + 1$ 到 $i + 2 * v$ 水位增加 $1,2,\cdots,v$，$i + 2 * v$ 到 $i + 3 * v - 1$ 水位依次增加 $v,v - 1,\cdots,1$

现在小正方形想要穿过这个湖，他想要知道在这 $n$ 个"朋友"跳入水中后湖上每个节点的水位，你能帮帮它吗？
## 输入格式

第一行为两个整数 $n$,$m$，表示"朋友"的数目与湖泊的宽度。

接下来 $n$ 行，一行两个整数 $v,x$，表示第 $i + 1$ 个朋友的体积与入水点。
## 输出格式

一行 $m$ 个整数，第 $i$ 个整数表示 $i$ 号位的水深。
## 样例

### 样例输入 #1
```
1 10
1 5
```
### 样例输出 #1
```
0 0 1 0 -1 0 1 0 0 0 
```
### 样例输入 #2
```
2 10
2 6
3 1
```
### 样例输出 #2
```
-2 0 0 0 0 0 2 2 2 2
```
## 提示

对于 $30\%$ 的数据，$n <= 50,m <= 500$

对于 $70\%$ 的数据，$n <= 10^5,m <= 10^5$

对于 $100\%$ 的数据，$n <= 10^6,m <= 10^6,1 <= v <= 10000,1 <= x <= m$


---

---
title: "[CQOI2006] 简单题"
layout: "post"
diff: 普及+/提高
pid: P5057
tag: ['2006', '重庆', '线段树', '各省省选', '树状数组']
---
# [CQOI2006] 简单题
## 题目描述

有一个 $n$ 个元素的数组，每个元素初始均为 $0$。有 $m$ 条指令，每条指令为两种操作中的一种：
1. 让其中一段连续序列数字反转；（即 $0$ 变 $1$，$1$ 变 $0$）
2. 询问某个元素的值。

例如当 $n=20$ 时，$10$ 条指令如下：

![](https://cdn.luogu.com.cn/upload/pic/44663.png)

## 输入格式

第一行包含两个整数 $n,m$，表示数组的长度和指令的条数。

接下来 $m$ 行，每行的第一个数 $t$ 表示操作的种类：

* 若 $t=1$，则接下来有两个数 $L,R$，表示反转区间 $[L,R]$ 的每个数；
* 若 $t=2$，则接下来只有一个数 $i$，表示询问的下标。
## 输出格式

每个操作 $2$ 输出一行（非 $0$ 即 $1$），表示每次操作 $2$ 的回答。
## 样例

### 样例输入 #1
```
20 10
1 1 10
2 6
2 12
1 5 12
2 6
2 15
1 6 16
1 11 17
2 12
2 6
```
### 样例输出 #1
```
1
0
0
0
1
1
```
## 提示

对于 $50\%$ 的数据，$1 \le n \le 10^3$，$1 \le m \le 10^4$；

对于 $100\%$ 的数据，$1 \le n \le 10^5$，$1 \le m \le 5 \times 10^5$，保证 $L \le R$。


---

---
title: "【模板】康托展开"
layout: "post"
diff: 普及+/提高
pid: P5367
tag: ['线段树', '平衡树', '树状数组', '康托展开']
---
# 【模板】康托展开
## 题目描述

求 $1\sim N$ 的一个给定全排列在所有 $1\sim N$ 全排列中的排名。结果对 $998244353$ 取模。
## 输入格式

第一行一个正整数 $N$。

第二行 $N$ 个正整数，表示 $1\sim N$ 的一种全排列。
## 输出格式

一行一个非负整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3
2 1 3
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4
1 2 4 3
```
### 样例输出 #2
```
2
```
## 提示

对于$10\%$数据，$1\le N\le 10$。

对于$50\%$数据，$1\le N\le 5000$。

对于$100\%$数据，$1\le N\le 1000000$。


---

---
title: "[BJOI2016] 回转寿司"
layout: "post"
diff: 普及+/提高
pid: P5459
tag: ['2016', '线段树', '各省省选', '树状数组', '离散化', '北京', 'cdq 分治', 'O2优化']
---
# [BJOI2016] 回转寿司
## 题目描述

酷爱日料的小Z经常光顾学校东门外的回转寿司店。在这里，一盘盘寿司通过传送带依次呈现在小Z眼前。  

不同的寿司带给小Z的味觉感受是不一样的，我们定义小Z对每盘寿司都有一个满意度。  

例如小Z酷爱三文鱼，他对一盘三文鱼寿司的满意度为 $10$；小Z觉得金枪鱼没有什么味道，他对一盘金枪鱼寿司的满意度只有 $5$；小Z最近看了电影《美人鱼》，被里面的八爪鱼恶心到了，所以他对一盘八爪鱼刺身的满意度是 $-100$。   

特别地，小Z是个著名的吃货，他吃回转寿司有一个习惯，我们称之为“狂吃不止”。具体地讲，当他吃掉传送带上的一盘寿司后，他会毫不犹豫地吃掉它后面的寿司，直到他不想再吃寿司了为止。  

今天，小Z再次来到了这家回转寿司店，$N$ 盘寿司将依次经过他的面前。其中，小Z对第 $i$ 盘寿司的满意度为$a_i$。  

小Z可以选择从哪盘寿司开始吃，也可以选择吃到哪盘寿司为止。他想知道共有多少种不同的选择，使得他的满意度之和不低于 $L$，且不高于 $R$。

注意，虽然这是回转寿司，但是我们不认为这是一个环上的问题，而是一条线上的问题。即，小Z能吃到的是输入序列的一个连续子序列；最后一盘转走之后，第一盘并不会再出现一次。
## 输入格式

第一行三个正整数 $N,L,R$，表示寿司盘数，满意度的下限和上限。  
第二行包含 $N$ 个整数 $a_i$，表示小Z对寿司的满意度。  

## 输出格式

一行一个整数，表示有多少种方案可以使得小Z的满意度之和不低于 $L$ 且不高于 $R$。
## 样例

### 样例输入 #1
```
5 5 9
1 2 3 4 5
```
### 样例输出 #1
```
6
```
## 提示

【数据范围】  

$1\le N \le 10^5$  
$|a_i| \le 10^5$   
$0\le L,R \le 10^9$


---

---
title: "Mivik的神力"
layout: "post"
diff: 普及+/提高
pid: P5648
tag: ['线段树', '倍增']
---
# Mivik的神力
## 题目背景

$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$发怒了，机房的$\textcolor{grey}{\text{deco}}$瑟瑟发抖
## 题目描述

$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$要写一篇文章，在写文章时，他有$n$个备选的单词，第$i$个单词有一个长度$a_i$，$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$可以选择从第$i$个单词开始写作，一共写$k$秒，第$j$秒会写上第$i+j-1(j\in[1,k])$个单词，并且他在写作时每秒都会获得愉悦值，第$j$秒的愉悦值为$max_{l=i}^{i+j-1} a_l$，现在，请你帮他算出，他每一次写作获得的愉悦值之和

**一句话题意：给出一个序列和多组询问 $(l,q)$ ，求**

$$
\sum_{i=l}^{l+q-1} \max_{l\le j\le i}a_j
$$

**数据要求强制在线**
## 输入格式

第一行，两个数，$n$，$t$，代表词汇个数和问题个数

第二行，$n$个数，第$i$个数代表$a_i$

接下来$t$行，每行两个数，$u$，$v$，$l=1+(u ⊕ lastans)\%n$，$q=1+(v ⊕ (lastans+1))\%(n-l+1)$，代表查询从第 $l$ 秒开始，写作 $q$ 秒的愉悦度之和

$lastans$表示上一次查询的答案，初始$lastans$为$0$
## 输出格式

对于每个询问，回答一行，代表答案
## 样例

### 样例输入 #1
```
3 2
1 2 3
1 1
1 2
```
### 样例输出 #1
```
2
3
```
## 提示

**样例解释**

第一个询问 $1,1$，解密后得到 $l=2,q=1$ ，则按题意可得所求即为区间 $[2,2]$ 的最大值，为 $2$

第一个询问 $1,2$ ，解密后得到 $l=1,q=2$ ，则所求即为区间 $[1,1]$ 和区间 $[1,2]$ 的最大值之和，为 $3$

-----

对于$20\%$的数据，$n \leq 1000$，$t \leq 1000$

对于$100\%$的数据，$n\leq 500000$，$t\leq 500000$，$1 \leq a_i\leq 10^9(i\in [1,n])$


---

---
title: "[USACO20OPEN] Haircut G"
layout: "post"
diff: 普及+/提高
pid: P6278
tag: ['2020', '线段树', 'USACO', '树状数组']
---
# [USACO20OPEN] Haircut G
## 题目描述

Farmer John 由于对整理他难以整平的头发感到疲惫，于是决定去理发。他有一排 $N$ 缕头发，第 $i$ 缕头发初始时长度为 $A_i$ 微米（$0\le A_i\le N$）。理想情况下，他想要他的头发在长度上单调递增，所以他定义他的头发的“不良度”为逆序对的数量：满足 $i < j$ 及 $A_i > A_j$ 的二元对 $(i,j)$。  
对于每一个 $j=0,1,\ldots,N-1$，Farmer John 想要知道他所有长度大于 $j$ 的头发的长度均减少到 $j$ 时他的头发的不良度。

-----

（有趣的事实：人类平均确实有大约 $10^5$ 根头发！）
## 输入格式

输入的第一行包含 $N$。  
第二行包含 $A_1,A_2,\ldots,A_N$。
## 输出格式

对于每一个 $j=0,1,\ldots,N-1$，用一行输出 Farmer John 头发的不良度。

-----

  
**注意这个问题涉及到的整数大小可能需要使用 $64$ 位整数型存储（例如，C/C++ 中的“long long”）。**
## 样例

### 样例输入 #1
```
5
5 2 3 3 0
```
### 样例输出 #1
```
0
4
4
5
7
```
## 提示

#### 样例解释：

输出的第四行描述了 Farmer John 的头发长度减少到 $3$ 时的逆序对数量。   
$A=[3,2,3,3,0]$ 有五个逆序对：$A_1>A_2,\,A_1>A_5,\,A_2>A_5,\,A_3>A_5,$ 和 $A_4>A_5$。

----

对于 $100\%$ 的数据，$1\le N\le 10^5$。

共 $13$ 个测试点，其中 $1$ 为样例，其余性质如下：
  
测试点 $2$ 满足 $N\le 100$。  
测试点 $3\sim 5$ 满足 $N\le 5000$。  
测试点 $6\sim 13$ 没有额外限制。  

-----


出题人：Dhruv Rohatgi



---

---
title: "「MCOI-02」Ancestor 先辈"
layout: "post"
diff: 普及+/提高
pid: P6812
tag: ['线段树', 'O2优化']
---
# 「MCOI-02」Ancestor 先辈
## 题目背景

这题跟 MC 有关的就是题目背景出现了三次 MC，提示说明出现了一次 MC。

```
           ▃▆█▇▄▖
       ▟◤▖　　　  ◥█  
   ◢◤ 　  ◢▐　　     ▐▉
 ▗◤　  　   ▂ ▗▖　 ▕ █▎
 ◤　▗▅▖ ◥▄　 ▀▀▀◣　█▊
▐　▕▎  ◥▖◣◤　 　　◢██
█◣　◥▅█▀　     　▐███◤
▐█▙▂　　　      ◢███◤
　◥██◣　　　　 ◢▄◤
　　　▀██▅▇▀▎▇
```
## 题目描述

对于两个序列 $a,b$，如果满足：

$$ \forall i \leq \min(n,m),s.t.\ a_i \leq b_i $$

那么我们称 $a$ 比 $b$ 屑（$n$ 为 $a$ 的长度，$m$ 为 $b$ 的长度）。

如果对于一个序列 $a$，它比它的所有后缀都屑，那么我们称这个序列为先辈。

给定一个长为 $n$ 的序列 $a_i$，共有 $k$ 次操作，包括以下两种：

- `1 l r x` 区间 $[l,r]$ 加上 $x$。
- `2 l r` 查询区间 $[l,r]$ 是不是先辈。
## 输入格式

第一行两个整数 $n,k$ 代表序列长度与操作数。     
第二行 $n$ 个整数 $a_i$ 代表数列每一项的值。    
接下来 $k$ 行每行首先三个整数 $opt,l,r$：

- 如果 $opt=1$，接下来一个整数 $x$ 代表操作 $1$。
- 如果 $opt=2$，代表操作 $2$。

**由于数据故障，$r$ 可能取到 $n+1$，请在这类情况下自行令 $r=n$，谢谢。**
## 输出格式

对于每个操作 $2$，输出询问结果。
## 样例

### 样例输入 #1
```
7 5
1 9 1 9 8 1 0
2 1 3
1 3 4 9
2 1 4
1 5 6 11
2 2 6
```
### 样例输出 #1
```
No
Yes
No
```
## 提示

#### 样例说明

对于样例 $1$：

1. 询问区间 $[1,3]$ 是否为先辈，不是，输出 `No`。
2. 区间 $[3,4]$ 加上 $9$，现在序列为 $\{1,9,10,18,8,1,0\}$。
3. 询问区间 $[1,4]$ 是否为先辈，是，输出 `Yes`。
4. 区间 $[5,6]$ 加上 $11$，现在序列为 $\{1,9,10,18,19,12,0\}$。
5. 询问区间 $[2,6]$ 是否为先辈，不是，输出 `No`。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（1 pts）$\ \ $：询问操作的区间长度均为 $1$。
- Subtask 2（9 pts）$\ \ $：$n,k \le 10^3$。
- Subtask 3（10 pts）：$n,k\le 5\times 10^3$。
- Subtask 4（10 pts）：只有查询操作。
- Subtask 5（10 pts）：修改操作的数量不超过 $100$。
- Subtask 6（20 pts）：$n,k \le 10^5$。
- Subtask 7（40 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n,k \le 10^6$，$|a_i|,|x| \le 10^9$。

**本题强制 $O2$ 优化。**

#### 说明

Minecraft OI Round 2 C

- Maker：happydef
- Tester：tarjin


---

---
title: "[COCI 2011/2012 #1] SORT"
layout: "post"
diff: 普及+/提高
pid: P7629
tag: ['2011', '线段树', '树状数组', 'COCI（克罗地亚）']
---
# [COCI 2011/2012 #1] SORT
## 题目描述

考虑如下的排序算法：

```
reverse-sort(sequence a)
    while (a is not in nondecreasing order)
        partition a into the minimum number of slopes
        for every slope with length greater than one
            reverse(slope)
```

定义 `slope` 为 `a` 的递减子串，`reverse()` 将翻转一段序列。

给定一个 $1$ ~ $N$ 的排列，保证在第一次划分时每个 `slope` 的长度都为偶数，求如果使用这种排序算法对给定的排列进行排序，需要调用多少次 `reverse(slope)`。
## 输入格式

输入的第一行包含一个正整数 $N$。

第二行包含 $N$ 个互不相同的的正整数，代表待排序的排列。
## 输出格式

输出一行一个整数，表示 `reverse(slope)` 需要被调用的次数。
## 样例

### 样例输入 #1
```
2
2 1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
4
4 3 2 1
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
4
3 1 4 2
```
### 样例输出 #3
```
3
```
## 提示

#### 【数据范围】

对于 $100\%$ 的数据，$2 \le N \le 10^5$。

#### 【说明】

本题分值按 COCI 原题设置，满分 $140$。

题目译自 **[COCI2011-2012](https://hsin.hr/coci/archive/2011_2012/) [CONTEST #1](https://hsin.hr/coci/archive/2011_2012/contest1_tasks.pdf)** ___T5 SORT___。


---

---
title: "[JRKSJ R2] Upper"
layout: "post"
diff: 普及+/提高
pid: P7810
tag: ['动态规划 DP', '线段树', '2021', '洛谷原创', 'O2优化', '素数判断,质数,筛法']
---
# [JRKSJ R2] Upper
## 题目描述

有 $n$ 张扑克，第 $i$ 张扑克上写有一个正整数 $a_i$。

现在要把扑克划分成若干个合法的连续子段，其中，一个连续子段 $[l,r]$ “合法”当且仅当这个子段同时满足两个条件： 

* $a_l< a_r$
* $\gcd(a_l,a_r)>1$ 

请问最多能划分多少段。如果没有合法的划分方案，输出 $-1$ 即可。

如果您不知道 $\gcd$ 是什么意思，请看“提示”部分。
## 输入格式

第一行一个整数 $n$。\
第二行 $n$ 个整数表示序列 $a$。
## 输出格式

一个整数，如题目描述所示。
## 样例

### 样例输入 #1
```
5
2 1 8 3 9
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
5
5 4 3 2 1
```
### 样例输出 #2
```
-1
```
### 样例输入 #3
```
20
20 9 36 36 40 8 3 10 9 20 18 12 30 20 30 15 8 9 27 45
```
### 样例输出 #3
```
7
```
## 提示

### 数据范围
本题采用捆绑测试。

对于 $100\%$ 的数据，$2\le n\le 10^5$，$1\le a_i\le 10^9$。

| $\text{Subtask}$ | $n\le$ | $a_i\le$ | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $5$ | $10^9$ | 无 | $5$ |
| $2$ | $3\times10^3$ | $10^9$ | 无 | $15$ |
| $3$ | $2\times10^4$ | $10^6$ | 无 | $20$ |
| $4$ | $2\times 10^4$ | $10^9$ | 无 | $10$ |
| $5$ | $10^5$ | $10^9$ | 数据随机 | $10$ |
| $6$ | $10^5$ | $10^9$ | 无 | $40$ |

### 样例解释
对于样例 $1$，有且仅有一种划分方案 $\{2,1,8\},\{3,9\}$。\
对于样例 $2$，无合法的划分方案。

### 提示
对于两个正整数 $a,b$，$\gcd(a,b)$ 为它们的最大公因数，即满足既是 $a$ 的因数又是 $b$ 的因数的数中最大的数。


---

---
title: "「EVOI-RD1」无人机航拍"
layout: "post"
diff: 普及+/提高
pid: P7865
tag: ['线段树']
---
# 「EVOI-RD1」无人机航拍
## 题目背景

T 市举行活动需要拍摄高空俯瞰图，找来了一个无人机机队负责拍摄工作。 [一E孤行](https://www.luogu.com.cn/user/229919) 是队伍的队长，他根据广场的规模来安排无人机的位置。
## 题目描述

有一个广场，可以看做是一个 $n \times m$ 的矩形；一E孤行 一共有 $s$ 架无人机，每架无人机的拍摄范围也可以看做是一个矩形，无人机机队的拍摄范围为所有无人机拍摄范围的并。

一E孤行 负责安排无人机的位置，而总负责人 WuuTue 要验收~~她~~他的方案。WuuTue 的验收方法是列举出 $L$ 个重要的区域，每个重要区域也是一个矩形。 一E孤行 方案的优秀程度取决于有多少个重要区域完全在无人机机队的拍摄范围中。

因此，对于每一个重要区域， 一E孤行 想知道它是否完全在无人机机队的拍摄范围中。
## 输入格式

第一行，用空格隔开的两个整数 $n$ 和 $m$，用来描述广场的大小。

第二行，一个整数 $s$，表示无人机队伍中无人机的总数量。

第三行到第 $s+2$ 行，每行四个用空格隔开的整数，$a_1,b_1,a_2,b_2$，用来描述一架无人机的拍摄范围。其中 $a_1,b_1$ 表示矩形的左下角坐标，$a_2,b_2$ 表示右上角的坐标。

第 $s+3$ 行，一个整数 $L$，表示活动总负责人列出的重要区域的数量 $L$。

最后 $L$ 行，每行四个用空格隔开的整数 $r_1,c_1,r_2,c_2$，用来描述一个重要区域。其中 $r_1,c_1$ 表示矩形区域左下角坐标，$r_2,c_2$ 表示右上角坐标。
## 输出格式

输出 $L$ 行，对于每个重要区域，如果完全在机队的拍摄范围内就输出 `Yes`，否则出 `No`。每个答案占一行。
## 样例

### 样例输入 #1
```
9 9 
3 
2 1 4 4 
2 5 4 9 
5 2 7 6 
2 
3 3 6 6 
5 6 8 8
```
### 样例输出 #1
```
Yes 
No
```
## 提示

**样例说明**

如下图所示，区域 $A,B,C$ 分别是某某安排的无人机能够覆盖的范围，区域 $D,E$ 是 WuuTue 要验收时列举的重点区域，区域 $D$ 能够被完全覆盖，区域 $E$ 不能被全部覆盖。

![](https://cdn.luogu.com.cn/upload/image_hosting/60pq06qo.png)   

**数据规模与约定**

**本题采用捆绑测试。**

对于 $40\%$ 的数据：$1 \le n \le 1000$，$1 \le s \le 100$ 。  
对于 $100\%$ 的数据：

- $1 \le n, m \le 3 \times 10^{3}$。 
- $1 \le s,L \le 10^6$。
- $1 \le x_1 < x_2 \le n$。
- $1 \le r_1 < r_2 \le n$。
- $1 \le y_1 < y_2 \le m$。
- $1 \le c_1 < c_2 \le m$。



---

---
title: "[Aya Round 1 H] 破碎的历史"
layout: "post"
diff: 普及+/提高
pid: P8473
tag: ['线段树', '二分', '洛谷原创', 'Special Judge', 'O2优化', '洛谷月赛']
---
# [Aya Round 1 H] 破碎的历史
## 题目背景

幻想乡迎来了它的毁灭，幻想的载体也已经遁入了幻想。

所幸的是，幻想乡中的乡民们还侥幸存活着，她们在尝试恢复幻想乡的历史。然而历史之中的大大小小的事情不计其数，人们只能记得起一些大事情罢了。

或许，根据那些重要的事情，可以把次要的事件推导出来呢？
## 题目描述

数轴的正半轴上有 $n$ 个互不相同的被黑白染色的特殊整点，位置从左到右依次为 $p_1,p_2,\cdots,p_n$。维护初始为空的**可重**线段集合 $S$。

$q$ 次操作。操作分若干种，具体格式如下：

- `1 l r`：将所有满足 $l \le x \le y \le r$ 且两端点均为特殊整点的线段 $[x,y]$ 加入 $S$。
- `2 x`：撤回第 $x$ 次操作添加的线段。

在初始时和每次操作后，假设你可以进行任意次（可以是零次）染色。每次从 $S$ 中选出一条线段 $[x,y]$，满足位于点 $x$ 和点 $y$ 的特殊整点均为黑色，然后将所有在线段内的白色特殊整点染黑。试判断是否存在至少一种合法染色方式使得正半轴上的所有特殊整点均被染黑（即，不存在白色特殊整点）。**注意：所有的询问均为「假设」，即各组询问之间独立，不会造成对数轴的实际修改。**

## 输入格式

- 第一行输入两个整数 $n,q$。
- 第二行输入 $n$ 个整数 $p_1,p_2,\cdots,p_n$，表示 $n$ 个特殊整点从左到右的位置。
- 第三行输入 $n$ 个整数 $a_1,a_2,\cdots,a_n$，表示特殊整点的颜色。其中 $a_i=0$ 表示白色，$a_i=1$ 表示黑色。
- 接下来 $q$ 行，每行二至三个整数，表示一次操作。

## 输出格式

- 输出共 $(q+1)$ 行。
- 在初始时和每次操作后，输出一行一个字符串：
  - `yes` 代表存在合法染色方式。
  - `no` 代表不存在合法染色方式。
- 你可以输出字符串的任意大小写形式。例如：字符串 `yes`、`Yes`、`YES` 均会被视为表示存在合法染色方式。
## 样例

### 样例输入 #1
```
6 3
1 2 3 5 8 13
1 0 0 1 0 1
1 5 10
1 1 15
2 2

```
### 样例输出 #1
```
No
No
Yes
No
```
## 提示

### 样例解释

六个特殊点的位置/颜色在数轴正半轴上如图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/i1hfjrk8.png)

容易发现，并非所有点都是黑点。因此在进行操作前，输出 $\verb!NO!$。

第一次操作后，一共往 $S$ 加入了三条线段：$[5,5],[8,8],[5,8]$（图中省略了端点重叠的线段）。容易发现，此时无法进行任何操作，因此没法将所有点变成黑点。输出 $\verb!NO!$。

![](https://cdn.luogu.com.cn/upload/image_hosting/ayeijyli.png)

第二次操作后，又往 $S$ 中加入了 $20$ 条线段。除去端点重叠的选段，在 $S$ 中如图所示。（以示区别，上一次操作加入的边标成了深蓝色）。

![](https://cdn.luogu.com.cn/upload/image_hosting/icw9ar9m.png)

可以找出一种方案，将图上所有特殊点变成黑点。具体而言，首先选择 $S$ 中 $[1,5]$ 线段（容易发现位于 $1$ 和 $5$ 的特殊点均为黑点，因此可以进行染色），那么可以把位于 $2$ 和 $3$ 的点染色。

![](https://cdn.luogu.com.cn/upload/image_hosting/3k1uvul0.png)

此时又可以选择 $S$ 中 $[3,13]$ 线段（在上一轮操作中，$3$ 号点变为了黑点，因此 $[3,13]$ 符合条件），将点 $8$ 染为黑色。

![](https://cdn.luogu.com.cn/upload/image_hosting/7ebafj63.png)

此时所有点都为黑色，因此输出 $\verb!YES!$。再次强调，询问之间互相独立，且只是询问是否存在染色方案，而不会对特殊整点进行实际上的染色操作。

![](https://cdn.luogu.com.cn/upload/image_hosting/pjqpqvtr.png)

第三个操作撤回了第二个操作往 $S$ 里加入的所有线段。因此退回到了只有第一个操作的情况。不存在一种方案将所有点染黑，因此输出 $\verb!NO!$。

### 数据范围

对于所有数据，$1 \le n,q \le 5 \times 10^5$，$a_i \in \{0,1\}$，$1 \le l< r \le 10^9$，$1 \le p_i \le 10^9$。保证 $p_i$ 单调递增，$2$ 操作撤销的只会是 $1$ 操作，且每个操作最多被撤销一次。



---

---
title: "「Wdoi-2」来自地上的支援"
layout: "post"
diff: 普及+/提高
pid: P8539
tag: ['贪心', '线段树', '洛谷原创', 'O2优化', '洛谷月赛']
---
# 「Wdoi-2」来自地上的支援
## 题目背景

波光粼粼的山顶湖与庄严神圣的神社之下，是一座复合型活火山。  
沿幻想风穴而下，便能到达火山之下，废弃已久的地狱原址。   
>在旧地狱中，有一座大都市。那里是旧地狱还是地狱的时候在那工作的众鬼们居住的地方，只有那里亡者们是无法踏入去的。后来地狱体制改革，机构搬离了这个地方。  
因为这个缘故这块地狱变成了废墟，但却有一部分看上了那里的妖怪擅作主张占领了那里，于是就成了如今的旧地狱了。
这里比地上更没有秩序可言。悍匪恶霸，特别是惹人类讨厌的家伙都喜欢搬到这边定居下来。

自旧地狱喷泻而出的间歇泉，给妖怪之山带来了优良的温泉，也喷出了大量的怨灵。

为了解决这次异变，乐园的巫女和普通的魔法使结伴而行，在来自地上的支援下，自幻想风穴直冲地底。

先后结（bao）识（da）了黑暗洞窟中的明亮之网、地壳下的嫉妒心、人们所谈论的怪力乱神后，二人来到了遗址中心的洋馆，地灵殿。

受这里主人的指引，二人来到了位于深处的间歇泉地下中心。
## 题目描述

### 简要题意
给定正整数 $n$、$v$ 和长度为 $n$ 的数组 $\{A_i\}$。

有一个长度为 $n$ 的数组 $B$，初始值与 $A$ 相同。 
执行 $n$ 次操作，第 $i$ 次操作在 $[1,i]$ 中按如下规则选取一个正整数 $j$，然后把 $B_j$ 变成 $B_j+v$：
- 选取 $B_j$ 最大的 $j$。
- $B_j$ 相同时选择 $A_j$ 最大的 $j$。
- $A_j,B_j$ 均相同，选择较小的 $j$。

我们称这是选中了一次 $j$。

有 $m$ 次询问，每次询问给定 $x_i,k_i$。表示求最小的 $s$，使得**若**将 $A_{x_i}$ 的初始值改为 $s$（注意此时 $B_{x_i}$ 的初始值也会跟着改变），$x_i$ 至少被选中 $k_i$ 次，或报告不存在（**结果为** $0$）。请注意，$s$ 不存在最小值时也是报告不存在（**结果为** $0$）。

询问之间互相独立，也就是每次询问不会对 $A_{x_i}$ 和 $B_{x_i}$ 产生实质性更改。

### 原始题意

到达控制中心之后，主角组和灵乌路空进行了激烈的狗斗大赛。负责技术维护的河童需要接受荷取来自地上指挥部的指令，保障生产安全。

具体地，有 $n$ 个核反应机组依次排开，第 $i$ 个机组的活动强度为 $A_i$。为了维护平衡，控制系统依次操作 $n$ 次，第 $i$ 次操作会在前 $i$ 个机组中找到一个**当前活动度最高的**机组，进行一次调节平衡操作，并将其活动度增加 $v$。倘若有多个机组活动度最高，就应当选择初始活动度**最大**的，若还是无法比较，则取编号最小。

为了在自动控制系统的基础上调节平衡，荷取会发出 $m$ 条指令，形如她每次会给出两个整数 $x_i,k_i$，表示她会修改第 $x_i$ 个机组的初始活动度。她希望通过修改（必须改成一个**非负整数** $s$）后，$x_i$ 号机组至少被平衡 $k_i$ 次。如果无论如何都无法达到要求，那么结果就是 $0$；否则请求出满足条件的**最小的** $s$。
## 输入格式

- 第一行有三个整数 $n, m, v$。
- 接下来一行，有 $n$ 个整数，描述 $a_i$。
- 接下来 $m$ 行，每行有两个整数 $x_i,k_i$，描述一次询问。
## 输出格式

- 一行，输出两个整数，表示所有结果的**异或和**与**加法和**。
## 样例

### 样例输入 #1
```
7 2 3
1 4 1 5 4 1 1
3 3
6 4
```
### 样例输出 #1
```
7 7
```
### 样例输入 #2
```
10 10 9
14 91 84 13 97 92 23 64 31 10 
5 2
5 5
9 1
2 6
9 1
5 4
3 5
2 8
8 2
5 4

```
### 样例输出 #2
```
245 1177

```
## 提示

### 样例 1 解释

对于第一次询问，我们将 $A_3$ 修改为 $7$。

- 第一次操作选择了位置 $1$，于是 $B_1$ 变为 $4$。
- 第二次操作选择了位置 $2$，于是 $B_2$ 变为 $7$。虽然操作前 $B_1=B_2$，但是 $A_2>A_1$，因此选择位置 $2$。
- 第三次操作选择了位置 $3$，于是 $B_3$ 变为 $10$。
- 第四次操作选择了位置 $3$，于是 $B_3$ 变为 $13$。
- 第五次操作选择了位置 $3$，于是 $B_3$ 变为 $16$。
- 第六次操作选择了位置 $3$，于是 $B_3$ 变为 $19$。
- 第七次操作选择了位置 $3$，于是 $B_3$ 变为 $22$。

于是位置 $3$ 一共被选择了 $5$ 次，满足题意。可以证明，如果把 $A_3$ 的初始值设为 $6$，无法达成要求。于是该询问结果为 $7$。

对于第二个询问，容易发现不可能有 $4$ 次以上操作选择位置 $6$。因此该询问结果为 $0$。

$7\oplus 0=7$，$7+0=7$，因此输出 $7,7$。

### 数据范围

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n,m\le} & \bm {a_i\le } & \bm{v\le} & \textbf{分值} \cr\hline
1 & 10 & 100 & 10 & 10 \cr\hline
2 & 100 & 5\times 10^3 & 50 & 20 \cr\hline
3 & 10^3 & 10^9 & 100 & 10 \cr\hline
4 & 10^5 & 10^9 & 100 & 25 \cr\hline
5 & 2\times 10^6 & 10^9 & 100 & 35 \cr\hline
\end{array}$$

对于全部数据，满足 $1 \le n,m \le 2\times 10^6$，$1 \le v \le 100$，$1 \le a_i \le 10 ^ 9$，$1 \le x,k \le n$。

**本题 IO 量较大，请选择合适的输入方式。**


---

---
title: "[蓝桥杯 2022 省 A] 选数异或"
layout: "post"
diff: 普及+/提高
pid: P8773
tag: ['2020', '线段树', '2022', 'ST 表', '蓝桥杯省赛']
---
# [蓝桥杯 2022 省 A] 选数异或
## 题目描述

给定一个长度为 $n$ 的数列 $A_{1}, A_{2}, \cdots, A_{n}$ 和一个非负整数 $x$, 给定 $m$ 次查询, 每次询问能否从某个区间 $[l, r]$ 中选择两个数使得他们的异或等于 $x$ 。

## 输入格式

输入的第一行包含三个整数 $n, m, x$ 。

第二行包含 $n$ 个整数 $A_{1}, A_{2}, \cdots, A_{n}$。

接下来 $m$ 行，每行包含两个整数 $l_{i}, r_{i}$ 表示询问区间 $\left[l_{i}, r_{i}\right]$ 。

## 输出格式

对于每个询问, 如果该区间内存在两个数的异或为 $x$ 则输出 `yes`, 否则输出 `no`。
## 样例

### 样例输入 #1
```
4 4 1
1 2 3 4
1 4
1 2
2 3
3 3
```
### 样例输出 #1
```
yes
no
yes
no
```
## 提示

**【样例说明】**

显然整个数列中只有 2,3 的异或为 1 。

**【评测用例规模与约定】**

对于 $20 \%$ 的评测用例, $1 \leq n, m \leq 100$;

对于 $40 \%$ 的评测用例, $1 \leq n, m \leq 1000$;

对于所有评测用例, $1 \leq n, m \leq 10^5,0 \leq x<2^{20}, 1 \leq l_{i} \leq r_{i} \leq n$ ， $0 \leq A_{i}<2^{20}$ 。

蓝桥杯 2022 省赛 A 组 D 题。


---

---
title: "[CSP-S 2022] 策略游戏"
layout: "post"
diff: 普及+/提高
pid: P8818
tag: ['贪心', '线段树', '2022', 'O2优化', 'ST 表', 'CSP-S 提高级']
---
# [CSP-S 2022] 策略游戏
## 题目描述

小 L 和小 Q 在玩一个策略游戏。

有一个长度为 $n$ 的数组 $A$ 和一个长度为 $m$ 的数组 $B$，在此基础上定义一个大小为 $n \times m$ 的矩阵 $C$，满足 $C_{i j} = A_i \times B_j$。所有下标均从 $1$ 开始。

游戏一共会进行 $q$ 轮，在每一轮游戏中，会事先给出 $4$ 个参数 $l_1, r_1, l_2, r_2$，满足 $1 \le l_1 \le r_1 \le n$、$1 \le l_2 \le r_2 \le m$。

游戏中，小 L 先选择一个 $l_1 \sim r_1$ 之间的下标 $x$，然后小 Q 选择一个 $l_2 \sim r_2$ 之间的下标 $y$。定义这一轮游戏中二人的得分是 $C_{x y}$。

小 L 的目标是使得这个得分尽可能大，小 Q 的目标是使得这个得分尽可能小。同时两人都是足够聪明的玩家，每次都会采用最优的策略。

请问：按照二人的最优策略，每轮游戏的得分分别是多少？
## 输入格式

第一行输入三个正整数 $n, m, q$，分别表示数组 $A$，数组 $B$ 的长度和游戏轮数。

第二行：$n$ 个整数，表示 $A_i$，分别表示数组 $A$ 的元素。

第三行：$m$ 个整数，表示 $B_i$，分别表示数组 $B$ 的元素。

接下来 $q$ 行，每行四个正整数，表示这一次游戏的 $l_1, r_1, l_2, r_2$。
## 输出格式

输出共 $q$ 行，每行一个整数，分别表示每一轮游戏中，小 L 和小 Q 在最优策略下的得分。
## 样例

### 样例输入 #1
```
3 2 2
0 1 -2
-3 4
1 3 1 2
2 3 2 2

```
### 样例输出 #1
```
0
4

```
### 样例输入 #2
```
6 4 5
3 -1 -2 1 2 0
1 2 -1 -3
1 6 1 4
1 5 1 4
1 4 1 2
2 6 3 4
2 5 2 3

```
### 样例输出 #2
```
0
-2
3
2
-1

```
## 提示

**【样例解释 \#1】**

这组数据中，矩阵 $C$ 如下：

$$ \begin{bmatrix} 0 & 0 \\ -3 & 4 \\ 6 & -8 \end{bmatrix} $$

在第一轮游戏中，无论小 L 选取的是 $x = 2$ 还是 $x = 3$，小 Q 都有办法选择某个 $y$ 使得最终的得分为负数。因此小 L 选择 $x = 1$ 是最优的，因为这样得分一定为 $0$。

而在第二轮游戏中，由于小 L 可以选 $x = 2$，小 Q 只能选 $y = 2$，如此得分为 $4$。

**【样例 \#3】**

见附件中的 `game/game3.in` 与 `game/game3.ans`。

**【样例 \#4】**

见附件中的 `game/game4.in` 与 `game/game4.ans`。

**【数据范围】**

对于所有数据，$1 \le n, m, q \le {10}^5$，$-{10}^9 \le A_i, B_i \le {10}^9$。对于每轮游戏而言，$1 \le l_1 \le r_1 \le n$，$1 \le l_2 \le r_2 \le m$。

| 测试点编号 | $n, m, q \le$ | 特殊条件 |
|:-:|:-:|:-:|
| $1$ | $200$ | 1, 2 |
| $2$ | $200$ | 1 |
| $3$ | $200$ | 2 |
| $4 \sim 5$ | $200$ | 无 |
| $6$ | $1000$ | 1, 2 |
| $7 \sim 8$ | $1000$ | 1 |
| $9 \sim 10$ | $1000$ | 2 |
| $11 \sim 12$ | $1000$ | 无 |
| $13$ | ${10}^5$ | 1, 2 |
| $14 \sim 15$ | ${10}^5$ | 1 |
| $16 \sim 17$ | ${10}^5$ | 2 |
| $18 \sim 20$ | ${10}^5$ | 无 |

其中，特殊性质 1 为：保证 $A_i, B_i > 0$。  
特殊性质 2 为：保证对于每轮游戏而言，要么 $l_1 = r_1$，要么 $l_2 = r_2$。


---

---
title: "[POI 2002] 火车线路"
layout: "post"
diff: 普及+/提高
pid: P8856
tag: ['2002', '线段树', 'POI（波兰）']
---
# [POI 2002] 火车线路
## 题目描述

某列火车从 $1$ 号城市出发，前往编号为 $C$ 的城市。该火车有 $S$ 个座位，现在有 $R$ 个车票订购需求。

一个订购由 $O,D,N$ 三个整数组成，表示从起点站 $O$ 到目标站 $D$ 需要订购 $N$ 个座位。

如果在该订购范围内有能满足的空座位，就称该订购可以被满足，否则就不可以。

请你按订购给出顺序处理，判断是否可以满足该订购需求。
## 输入格式

第一行为三个整数 $C,S,R$。

接下来 $R$ 行，每行为三个整数 $O,D,N$，分别表示每一个预定。
## 输出格式

对第 $i$ 个预定，如果能满足，输出 ```T```，否则输出 ```N```。
## 样例

### 样例输入 #1
```
4 6 4
1 4 2
1 3 2
2 4 3
1 2 3
```
### 样例输出 #1
```
T
T
N
N
```
## 提示

数据范围：$1 \le C,S,R \le 60000$。


---

---
title: "[CCC 2021 S5]  Math Homework"
layout: "post"
diff: 普及+/提高
pid: P9027
tag: ['线段树', '2021', 'Special Judge', 'CCC（加拿大）', 'ST 表', '构造']
---
# [CCC 2021 S5]  Math Homework
## 题目描述

构造一个长度为 $N$ 的整数序列 $A$，使得：

1. $\forall i,1\leq A_i\leq 10^9$；
2. $\forall i,\gcd(A_{X_i},A_{X_i+1},\cdots,A_{Y_i})=Z_i$。

或者报告无解。
## 输入格式

第一行，$N,M$。

接下来 $M$ 行，每行有 $X_i,Y_i,Z_i$，描述一个限制 2.
## 输出格式

一行，序列 $A$，或者 `Impossible`。
## 样例

### 样例输入 #1
```
2 2
1 2 2
2 2 6

```
### 样例输出 #1
```
4 6
```
### 样例输入 #2
```
2 2
1 2 2
2 2 5

```
### 样例输出 #2
```
Impossible
```
## 提示

$$1\leq N\leq 150000,1\leq M\leq 150000,1\leq Z_i\leq 16$$

译自 [CCC2021 S5](https://cemc.math.uwaterloo.ca/contests/computing/past_ccc_contests/2021/ccc/seniorEF.pdf)。

spj 在附件里，发现锅了请联系[我](/user/90693)。


---

---
title: "[JOI 2023 Final] Stone Arranging 2"
layout: "post"
diff: 普及+/提高
pid: P9349
tag: ['模拟', '线段树', '2023', 'JOI（日本）']
---
# [JOI 2023 Final] Stone Arranging 2
## 题目描述

JOI-kun has $N$ go stones. The stones are numbered from $1$ to $N$. The color of each stone is an integer between $1$ and $10^9$, inclusive. In the beginning, the color of Stone $i$ ($1 \le i \le N$) is $A_i$.

From now, JOI-kun will perform $N$ operations. He will put the stones on the table in a line. The operation $i$ ($1 \le i \le N$) will be performed as follows:

1. JOI-kun will put Stone $i$ on the immediate right of Stone $i - 1$. However, when $i = 1$, JOI-kun will put Stone 1 on the table.
2. If there is a stone among Stones $1,2,\cdots,i-1$ whose current color is the same as Stone $i$, let $j$ be the maximum index of such stones, and JOI-kun will paint all of Stones $j+1,j+2,\cdots,i-1$ with the color $A_i$.

In order to confirm whether the operations are correctly performed, JOI-kun wants to know in advance the colors of the stones after all the operations are performed.

Given information of the go stones, write a program which determines the colors of the stones after the $N$ operations are performed.
## 输入格式

Read the following data from the standard input.

> $N$  
> $A_1$  
> $A_2$  
> $\vdots$  
> $A_N$
## 输出格式

Write $N$ lines to the standard output. The $i$-th line ($1 \le i \le N$) should contain the color of Stone $i$ after the $N$ operations are performed.
## 样例

### 样例输入 #1
```
6
1
2
1
2
3
2

```
### 样例输出 #1
```
1
1
1
2
2
2

```
### 样例输入 #2
```
10
1
1
2
2
1
2
2
1
1
2

```
### 样例输出 #2
```
1
1
1
1
1
1
1
1
1
2

```
## 提示

## Samples

### Sample 1

The operations are performed as in the following table.

![](https://cdn.luogu.com.cn/upload/image_hosting/0newqhzt.png)

Finally, the colors of Stones 1, 2, 3, 4, 5, 6 will be 1, 1, 1, 2, 2, 2, respectively.

This sample input satisfies the constraints of Subtasks 1, 3.

### Sample 2

This sample input satisfies the constraints of all the subtasks.

## Constraints

- $1 \le N \le 2\times 10^5$.
- $1 \le A_i \le 10^9$ ($1 \le i \le N$).
- Given values are all integers.

## Subtasks

1. (25 points) $N \le 2 000$.
2. (35 points) $A_i \le 2$ ($1 \le i \le N$).
3. (40 points) No additional constraints.
## 题目翻译

JOI 君有 $N$ 枚棋子，棋子从 $1$ 到 $N$ 编号。每个棋子的颜色是介于 $1$ 和 $10^9$ 之间的整数，包括 $1$ 和 $10^9$。一开始，第 $i$（$1 \le i \le N$）枚棋子的颜色是 $A_i$。

接下来，JOI 君将执行 $N$ 步操作。他将把棋子放在桌子上排成一行。第 $i$（$1 \le i \le N$）步操作如下：

1. JOI 君会将第 $i$ 枚棋子放在第 $i - 1$ 枚棋子的紧邻的右侧。 特别地，当 $i = 1$ 时，JOI 君会直接将第 1 枚棋子放在桌子上。
2. 如果前 $i-1$ 枚棋子中有至少一枚棋子当前的颜色与棋子 $i$ 相同，设 $j$ 为这些棋子的编号的最大值，那么 JOI 君会把第 $j+1,j+2,\cdots,i-1$ 枚棋子的颜色都涂成 $A_i$。

为了确认操作有没有正确完成，JOI 君想提前知道所有操作完成后棋子的颜色。

给定棋子的信息，编写一个程序，确定在执行 $N$ 次操作后每枚棋子的颜色。


---

---
title: "「LAOI-1」小熊游景点"
layout: "post"
diff: 普及+/提高
pid: P9487
tag: ['线段树', '倍增', '洛谷原创', 'O2优化', '树形 DP', '树链剖分', 'ST 表', '分类讨论']
---
# 「LAOI-1」小熊游景点
## 题目描述

小熊的地图上有 $n$ 个景点，每个景点有分数 $s_i$。

$n-1$ 个点对之间有双向直达的公交线路，每条线路有收费 $w_i$。

现在小熊在 $a$ 景点，总司令在 $b$ 景点，他们要**沿简单路径**在 $a\to b$ 路径上的 $p$ 景点汇合，然后**沿简单路径**一起去 $q$ 景点。（$q$ 为任意点，每个人不会游览两次 $p$ 景点）

$m$ 次询问，给定 $a,b$，求 $p,q$，使得小熊和总司令花费之和最小的前提下他们经过的景点分数之和最大，输出他们经过的景点分数之和。（指小熊经过的景点分数之和 $+$ 总司令经过的景点分数之和）

**重复经过的线路收费重复计算，重复经过的景点分数重复计算。**
## 输入格式

第一行两个整数 $n,m$。分别表示景点个数和询问次数。

接下来一行 $n$ 个整数 第 $i$ 个整数 $s_i$ 表示第 $i$ 个景点的权值。

接下来 $n-1$ 行，每行 $3$ 个整数 $u,v,w$，表示 $u$ 节点和 $v$ 节点之间有一条收费 $w$ 的双向公交路线。

接下来 $m$ 行，每行两个整数 $a$ 和 $b$，表示小熊和总司令所在的景点位置。
## 输出格式

对于每组询问，每行输出一个整数表示结果。
## 样例

### 样例输入 #1
```
7 1
1 1 1 1 1 1 1
1 2 3
3 6 -4
2 5 2
1 3 6
2 4 1
3 7 5
4 7
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
10 10
786755 -687509 368192 154769 647117 -713535 337677 913223 -389809 -824004 
1 2 -785875
1 3 -77082
1 4 -973070
3 5 -97388
2 6 -112274
3 7 657757
4 8 741733
3 9 5656
4 10 -35190
3 3
3 10
7 3
5 1
2 10
10 10
1 6
7 2
8 9
9 1

```
### 样例输出 #2
```
971424
-1257332
1309101
3420605
-2313033
-2567048
-2467802
352646
759321
1368370

```
## 提示

### 样例说明
对于第一组样例，小熊的地图如图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ktyzyrx7.png)

其中 $a=4,b=7$，令 $p=3,q=6$。

小熊的路径为 $4\to2\to1\to3\to6$，花费之和为 $1+3+6+(-4)=6$，景点分数之和为 $1+1+1+1+1=5$。

总司令的路径为 $7\to3\to6$，花费之和为 $5+(-4)=1$，景点分数之和为 $1+1+1=3$。

小熊和总司令花费之和为 $6+1=7$，经过的景点分数之和为 $5+3=8$。

可以证明此时小熊和总司令花费之和最小的前提下他们经过的景点分数之和最大。

------------

### 数据范围
**本题采用捆绑测试。**

| Subtask | $n,m$ | $s_i,w_i$ | 特殊性质 | 分数 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $=3\times10^5$ | $\in\lbrack0,10^6\rbrack$ | 无 | $10$ |
| $2$ | $=3\times10^5$ | $\in\lbrack-10^6,10^6\rbrack$ | 小熊的地图是一条链 | $10$ |
| $3$ | $=3\times10^2$ | $\in\lbrack-10^6,10^6\rbrack$ | 无 | $5$ |
| $4$ | $=3\times10^3$ | $\in\lbrack-10^6,10^6\rbrack$ | 无 | $15$ |
| $5$ | $\le 3\times10^5$ | $\in\lbrack-10^6,10^6\rbrack$ | 无 | $60$ |

对于 $100\%$ 的数据，$1\le n,m\le 3\times 10^5$，$\vert s_i\vert,\vert w_i\vert\le10^6$，小熊的地图是一棵树。

（小熊都可以游览景点了，公交价格和景点分数怎么不可以是负数呢？）


---

---
title: "「Cfz Round 1」Elevator"
layout: "post"
diff: 普及+/提高
pid: P9579
tag: ['动态规划 DP', '贪心', '线段树', '树状数组', '洛谷原创', 'O2优化', '排序', '洛谷月赛']
---
# 「Cfz Round 1」Elevator
## 题目背景

电梯是一个可以让人充分思考的空间。
## 题目描述

给定两个长度为 $n$ 的数组 $a,b$。我们称序列 $p$ 是满足条件的，设 $p$ 的长度为 $m$，当且仅当：

- $p_1=1$；  
- 对于所有的 $1\le i<m$，都有 $|p_i-p_{i+1}|=1$；  
- 对于所有的 $1\le k\le n$，都存在一个有序数对 $(i,j)$，满足 $1 \le i < j \le m$ 且 $p_i=a_k$，$p_j=b_k$。

你需要输出所有满足条件的序列 $p$ 中，$p$ 的长度的最小值。
## 输入格式

第一行一个整数 $n$。

接下来 $n$ 行，第 $i$ 行两个整数 $a_i,b_i$。
## 输出格式

一个整数，表示所有满足条件的序列 $p$ 中，$p$ 的长度的最小值。
## 样例

### 样例输入 #1
```
2
3 2
2 5
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
4
4 7
10 8
9 11
4 2
```
### 样例输出 #2
```
18
```
## 提示

#### 【样例解释 #1】

序列 $p$ 的长度的最小值为 $7$，此时的序列 $p$ 为 $\{1,2,3,2,3,4,5\}$。

#### 【数据范围】

对于所有数据，$1 \le n \le 5\times10^5$，$1 \le a_i,b_i \le 10^9$，保证 $a_i \neq b_i$。

**本题采用捆绑测试。**

|子任务编号|分值|$n \le$|特殊性质|
|:---:|:---:|:---:|:---:|
|$1$|$9$|$1$|无|
|$2$|$9$|$5\times10^5$|保证 $a_i < b_i$|
|$3$|$21$|$5\times10^5$|数据随机生成|
|$4$|$27$|$2000$|无|
|$5$|$34$|$5\times10^5$|无|


---

---
title: "「MXOI Round 2」队列"
layout: "post"
diff: 普及+/提高
pid: P9588
tag: ['线段树', '倍增', '二分', '平衡树', '树状数组', '单调队列', '洛谷原创', 'O2优化', '优先队列', '前缀和', '队列', '洛谷月赛']
---
# 「MXOI Round 2」队列
## 题目描述

小 C 有一个队列，他要对这个队列进行 $q$ 次操作。操作共四种，参数分别如下：

$1\ x$：这是第一种操作，表示从队尾依次插入 $1,2,3,\cdots,x$；

$2\ y$：这是第二种操作，表示弹出队头的前 $y$ 个元素；

$3\ z$：这是第三种操作，表示查询队列中的第 $z$ 个元素；

$4$：这是第四种操作，表示查询队列中所有元素的最大值。

你需要帮助他维护这个队列，并对于每个第三种操作和第四种操作，输出查询的答案。
## 输入格式

第一行两个整数 $c,q$，其中 $c$ 表示测试点编号。$c=0$ 表示该测试点为样例。

接下来 $q$ 行，每行 $1 \sim 2$ 个整数，表示一个操作，格式见【**题目描述**】。
## 输出格式

对于每个第三种操作和第四种操作，输出一行一个整数，表示查询的答案。
## 样例

### 样例输入 #1
```
0 9
1 5
1 3
2 2
1 4
3 6
3 8
2 4
4
3 3
```
### 样例输出 #1
```
3
2
4
1
```
## 提示

#### 【样例解释 #1】

在进行第四次操作后，队列中的元素依次为 $3,4,5,1,2,3,1,2,3,4$。

在进行第七次操作后，队列中的元素依次为 $2,3,1,2,3,4$。

#### 【样例 #2】

见附加文件中的 `queue/queue2.in` 与 `queue/queue2.ans`。

该样例满足测试点 $1$ 的限制。

#### 【样例 #3】

见附加文件中的 `queue/queue3.in` 与 `queue/queue3.ans`。

该样例满足测试点 $4$ 的限制。

#### 【样例 #4】

见附加文件中的 `queue/queue4.in` 与 `queue/queue4.ans`。

该样例满足测试点 $11$ 的限制。

#### 【样例 #5】

见附加文件中的 `queue/queue5.in` 与 `queue/queue5.ans`。

该样例满足测试点 $15$ 的限制。

#### 【样例 #6】

见附加文件中的 `queue/queue6.in` 与 `queue/queue6.ans`。

该样例满足测试点 $20$ 的限制。

#### 【数据范围】

设 $\sum x$ 表示单个测试点内 $x$ 之和。

对于 $100\%$ 的数据，$1 \le q \le 2\times 10^5$，$1 \le x,y,z \le 10^9$，$0 \le \sum x \le 2\times10^{14}$，保证在进行第二种操作前队列内元素个数不小于 $y$，在进行第三种操作前队列内元素个数不小于 $z$，在进行第四种操作前队列内元素个数大于 $0$。

|测试点编号|$q \le$|$x \le$|$\sum x \le$|特殊性质|
|:---:|:---:|:---:|:---:|:---:|
|$1\sim3$|$500$|$500$|$2\times10^5$|C|
|$4\sim8$|$5000$|$5000$|$2\times10^7$|无|
|$9\sim10$|$2\times10^5$|$10^9$|$2\times10^{14}$|AB|
|$11\sim12$|$2\times10^5$|$10^9$|$2\times10^{14}$|B|
|$13\sim14$|$2\times10^5$|$10^9$|$2\times10^9$|AC|
|$15\sim16$|$2\times10^5$|$10^9$|$2\times10^9$|C|
|$17\sim18$|$2\times10^5$|$500$|$2\times10^7$|无|
|$19$|$2\times10^5$|$10^9$|$2\times10^9$|无|
|$20$|$2\times10^5$|$10^9$|$2\times10^{14}$|无|

特殊性质 A：没有第二种操作。

特殊性质 B：没有第三种操作。

特殊性质 C：没有第四种操作。


---

---
title: "「TFOI R1」Tree Home"
layout: "post"
diff: 普及+/提高
pid: P9704
tag: ['线段树', 'O2优化', 'ST 表']
---
# 「TFOI R1」Tree Home
## 题目背景

阳光开朗大男孩天才 Z 今天要向蕉太狼表白力！

众所周知，蕉太狼是一个很可爱的女孩纸。
从前的天才 Z 总是担心因为自己表白失败而受到别人的嘲笑。但是今天，天才 Z 就要做出自己一生中最重要的一件事，那就是真诚地表白，无论后果如何。

出乎意料，蕉太狼其实也喜欢着天才 Z！

天才 Z 开心得像个 0#。

但是没过多久，天才 Z 就被甩力，原因蕉太狼发现天才 Z 对自己的闺蜜有非分之想。

天才 Z 拿出了自己的树状家谱，问候起了自己的祖宗们。
## 题目描述

有一个由 $n - 1$ 条**带权无向边**连接成的有 $n$ 个节点的树，每个节点都有它对应的**编号**以及**权值** $v_{i}$，整棵树的根节点为编号为 $1$ 的节点。

令 $f(a, b, c) = (a - b) \times \left[a^2 + b^2 + a \times b + 3 \times c \times (a + b + c)\right]$，其中 $a,b,c$ 可以为任意整数。同时用 $d_i$ 表示 $i$ 到根节点的每条边的**边权**之和。

现在天才 Z 要进行 $T$ 次询问，每次询问给定四个正整数 $l_{1},r_{1},l_{2},r_{2}$，你要从**编号**在区间 $[l_{1}, r_{1}]$ 和 $[l_{2}, r_{2}]$ 的点中各选择一个点 $p$ 和 $q$，当然你选择的两个点需要保证 $p \neq q$。用 $r$ 表示 $p$ 和 $q$ 的最近公共祖先，要使得 $|f(d_{p} - d_{r}, d_{q} - d_{r}, d_{r})| + |v_{p} - v_{q}|$ 的值最大，而你需要对每次询问输出这个最大值。
## 输入格式

第一行输入两个正整数 $n$ 和 $T$，表示这棵树的节点个数以及询问次数。

第二行输入 $n$ 个整数，第 $i$ 个数表示编号为 $i$ 的节点的权值。

接下来 $n - 1$ 行，每行输入三个整数 $u,v,w$，表示节点 $u$ 到节点 $v$ 之间有一条边权为 $w$ 的无向边。

接下来 $T$ 行，每行输入四个整数 $l_{1},r_{1},l_{2},r_{2}$，表示一次询问（意义如题面所述）。
## 输出格式

输出 $T$ 行，每行输出一个整数，表示每次询问的答案。
## 样例

### 样例输入 #1
```
7 2
5 1 7 12 5 9 6
1 2 5
3 1 1
6 2 9
4 6 14
7 6 4
5 2 10
2 4 5 7
1 1 3 3
```
### 样例输出 #1
```
19211
3
```
## 提示

#### 样例解释

对于第一次询问，我们在两个区间分别取 $4$ 号点和 $6$ 号点即可得出答案 $19211$。

对于第二次询问，两个区间都只能取一个节点，所以答案为 $3$。


#### 数据范围

**本题采用捆绑测试**。

- Subtask 1（5 points）：$1 \leqslant n, T \leqslant 10$。
- Subtask 2（10 points）：$1 \leqslant n, T \leqslant 100$。
- Subtask 3（30 points）：$1 \leqslant n, T \leqslant 3000$。
- Subtask 4（55 points）：无特殊限制。

对于所有数据，$1 \leqslant n, T \leqslant 2 \times 10^5$，$0 \leqslant |w| \leqslant 25$，$1 \leqslant v_{x} \leqslant 10^9$，$1 \leqslant l_{1} \leqslant r_{1} \leqslant n$，$1 \leqslant l_{2} \leqslant r_{2} \leqslant n$，保证树中最大深度不超过 $100$。

**注意：两个区间 $[l_{1}, r_{1}]$ 和 $[l_{2}, r_{2}]$ 可能有重合部分。**


---


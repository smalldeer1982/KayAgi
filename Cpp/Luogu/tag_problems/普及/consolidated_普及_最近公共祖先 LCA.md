---
title: "[GESP202312 八级] 大量的工作沟通"
layout: "post"
diff: 普及/提高-
pid: P10113
tag: ['2023', '最近公共祖先 LCA', 'GESP']
---
# [GESP202312 八级] 大量的工作沟通
## 题目描述

某公司有 $N$ 名员工，编号从 $0$ 至 $N-1$。其中，除了 $0$ 号员工是老板，其余每名员工都有一个直接领导。我们假设编号为 $i$ 的员工的直接领导是 $f_i$。

该公司有严格的管理制度，每位员工只能受到本人或直接领导或间接领导的管理。具体来说，规定员工 $x$ 可以管理员工 $y$，当且仅当 $x=y$，或 $x=f_y$，或 $x$ 可以管理 $f_y$。特别地，$0$ 号员工老板只能自我管理，无法由其他任何员工管理。

现在，有一些同事要开展合作，他们希望找到一位同事来主持这场合作，这位同事必须能够管理参与合作的所有同事。如果有多名满足这一条件的员工，他们希望找到编号最大的员工。你能帮帮他们吗？
## 输入格式

第一行一个整数 $N$ ，表示员工的数量。

第二行 $N-1$ 个用空格隔开的正整数，依次为 $f_1, f_2, \dots f_{N-1}$。

第三行一个整数 $Q$ ，表示共有 $Q$ 场合作需要安排。

接下来 $Q$ 行，每行描述一场合作：开头是一个整数 $m$（$2 \leq m \leq N$），表示参与本次合作的员工数量；接着是 $m$ 个整数，依次表示参与本次合作的员工编号（保证编号合法且不重复）。

保证公司结构合法，即不存在任意一名员工，其本人是自己的直接或间接领导。
## 输出格式

输出 $Q$ 行，每行一个整数，依次为每场合作的主持人选。

## 样例

### 样例输入 #1
```
5
0 0 2 2
3
2 3 4
3 2 3 4
2 1 4
```
### 样例输出 #1
```
2
2
0
```
### 样例输入 #2
```
7
0 1 0 2 1 2
5
2 4 6
2 4 5
3 4 5 6
4 2 4 5 6
2 3 4
```
### 样例输出 #2
```
2
1
1
1
0
```
## 提示

**样例解释 1**

对于第一场合作，员工 $3,4$ 有共同领导 $2$ ，可以主持合作。

对于第二场合作，员工 $2$ 本人即可以管理所有参与者。

对于第三场合作，只有 $0$ 号老板才能管理所有员工。

**数据范围**

对于 $25\%$ 的测试点，保证 $N \leq 50$。 

对于 $50\%$ 的测试点，保证 $N \leq 300$。

对于所有测试点，保证 $3 \leq N \leq 10^5$，$Q \leq 100$，$m \leq 10^4$。


------------
2024/2/8 添加一组 hack 数据。


---

---
title: "[蓝桥杯 2025 国 Python A] 巡逻"
layout: "post"
diff: 普及/提高-
pid: P12874
tag: ['图论', '2025', '树的遍历', '最近公共祖先 LCA', '前缀和', '蓝桥杯国赛']
---
# [蓝桥杯 2025 国 Python A] 巡逻
## 题目背景

建议 Python 用户选择 PyPy3 提交本题。
## 题目描述

边境森林中分布着若干重要的哨站，所有哨站之间由隐秘小径相连，形成一张天然的巡逻网络。这张网络的结构恰好是一棵树。为了防止敌人渗透，小蓝每天需要执行固定长度为 $k$ 的巡逻任务。每次巡逻从一个哨站出发，经过不重复地恰好 $k$ 条道路，最终到达另一个哨站。每条道路都有一定的危险值，巡逻路径上危险值的和代表该次巡逻时的风险。两次巡逻路径不相同当且仅当它们的起点不同或终点不同。

现在指挥官希望知道，所有可能的长度为 $k$ 的巡逻路线的风险之和是多少？
## 输入格式

输入的第一行包含两个正整数 $n, k$ ，用一个空格分隔。

接下来 $n-1$ 行，每行包含三个正整数 $u_i, v_i, w_i$ ，相邻整数之间使用一个空格分隔。表示结点 $u_i$ 和结点 $v_i$ 之间有一条危险值为 $w_i$ 边。

## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
7 2
1 2 3
2 4 5
1 3 7
3 5 3
3 6 4
6 7 2
```
### 样例输出 #1
```
104
```
## 提示

**【样例说明】**

所有可能的路径及其风险值如下：

- $1 \rightarrow 2 \rightarrow 4: 8$
- $2 \rightarrow 1 \rightarrow 3: 10$
- $1 \rightarrow 3 \rightarrow 5: 10$
- $1 \rightarrow 3 \rightarrow 6: 11$
- $5 \rightarrow 3 \rightarrow 6: 7$
- $3 \rightarrow 6 \rightarrow 7: 6$

以上路径反过来也是合法的，所以总共有 14 条不同的路径，风险之和为 104。

**【评测用例规模与约定】**

对于 40% 的评测用例，$1 \leq n \leq 500$；

对于所有评测用例，$1 \leq n \leq 5000$，$1 \leq k \leq n$，$1 \leq u_i, v_i \leq n$，$1 \leq w_i \leq 10^6$。


---

---
title: "[GESP202506 六级] 最大因数"
layout: "post"
diff: 普及/提高-
pid: P13016
tag: ['图论', '2025', '数论', '最近公共祖先 LCA', 'GESP']
---
# [GESP202506 六级] 最大因数
## 题目描述



给定一棵有 $10^9$ 个结点的有根树，这些结点依次以 $1, 2, \dots, 10^9$ 编号，根结点的编号为 $1$。对于编号为 $k$（$2 \leq k \leq 10^9$）的结点，其父结点的编号为 $k$ 的因数中除 $k$ 以外最大的因数。

现在有 $q$ 组询问，第 $i$（$1 \leq i \leq q$）组询问给定 $x_i, y_i$，请你求出编号分别为 $x_i, y_i$ 的两个结点在这棵树上的距离。两个结点之间的距离是连接这两个结点的简单路径所包含的边数。

## 输入格式


第一行，一个正整数 $q$，表示询问组数。

接下来 $q$ 行，每行两个正整数 $x_i, y_i$，表示询问结点的编号。
## 输出格式


输出共 $q$ 行，每行一个整数，表示结点 $x_i, y_i$ 之间的距离。
## 样例

### 样例输入 #1
```
3
1 3
2 5
4 8
```
### 样例输出 #1
```
1
2
1
```
### 样例输入 #2
```
1
120 650
```
### 样例输出 #2
```
9
```
## 提示


对于 $60\%$ 的测试点，保证 $1 \leq x_i, y_i \leq 1000$。

对于所有测试点，保证 $1 \leq q \leq 1000$，$1 \leq x_i, y_i \leq 10^9$。


---

---
title: "[NOIP 2014 提高组] 联合权值"
layout: "post"
diff: 普及/提高-
pid: P1351
tag: ['动态规划 DP', '2014', 'NOIP 提高组', '树形 DP', '最近公共祖先 LCA']
---
# [NOIP 2014 提高组] 联合权值
## 题目背景

NOIP2014 提高组 D1T2
## 题目描述

无向连通图 $G$ 有 $n$ 个点，$n-1$ 条边。点从 $1$ 到 $n$ 依次编号,编号为 $i$ 的点的权值为 $W_i$，每条边的长度均为 $1$。图上两点 $(u, v)$ 的距离定义为 $u$ 点到 $v$ 点的最短距离。对于图 $G$ 上的点对 $(u, v)$，若它们的距离为 $2$，则它们之间会产生 $W_v \times W_u$ 的联合权值。

请问图 $G$ 上所有可产生联合权值的有序点对中，联合权值最大的是多少？所有联合权值之和是多少？
## 输入格式

第一行包含 $1$ 个整数 $n$。

接下来 $n-1$ 行,每行包含 $2$ 个用空格隔开的正整数 $u,v$，表示编号为 $u$ 和编号为 $v$ 的点之间有边相连。

最后 $1$ 行，包含 $n$ 个正整数，每两个正整数之间用一个空格隔开，其中第 $i$ 个整数表示图 $G$ 上编号为 $i$ 的点的权值为 $W_i$。
## 输出格式

输出共 $1$ 行，包含 $2$ 个整数，之间用一个空格隔开,依次为图 $G$ 上联合权值的最大值和所有联合权值之和。由于所有联合权值之和可能很大，输出它时要对 $10007$ 取余。
## 样例

### 样例输入 #1
```
5  
1 2  
2 3
3 4  
4 5  
1 5 2 3 10 
```
### 样例输出 #1
```
20 74
```
## 提示

**样例解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/5zkpab9k.png)

本例输入的图如上所示，距离为 $2$ 的有序点对有$(1,3)$ 、$(2,4)$ 、$(3,1)$ 、$(3,5) $、$(4,2)$ 、$(5,3) $。

其联合权值分别为 $2,15,2,20,15,20$。其中最大的是 $20$，总和为 $74$。

 
**数据说明**

- 对于 $30\%$ 的数据，$1 < n \leq 100$；
- 对于 $60\%$ 的数据，$1 < n \leq 2000$；
- 对于 $100\%$ 的数据，$1 < n \leq 2\times 10^5$，$0 < W_i \leq 10000$。

保证一定存在可产生联合权值的有序点对。


---

---
title: "【模板】最近公共祖先（LCA）"
layout: "post"
diff: 普及/提高-
pid: P3379
tag: ['O2优化', '最近公共祖先 LCA']
---
# 【模板】最近公共祖先（LCA）
## 题目描述

如题，给定一棵有根多叉树，请求出指定两个点直接最近的公共祖先。

## 输入格式

第一行包含三个正整数 $N,M,S$，分别表示树的结点个数、询问的个数和树根结点的序号。

接下来 $N-1$ 行每行包含两个正整数 $x, y$，表示 $x$ 结点和 $y$ 结点之间有一条直接连接的边（数据保证可以构成树）。

接下来 $M$ 行每行包含两个正整数 $a, b$，表示询问 $a$ 结点和 $b$ 结点的最近公共祖先。

## 输出格式

输出包含 $M$ 行，每行包含一个正整数，依次为每一个询问的结果。

## 样例

### 样例输入 #1
```
5 5 4
3 1
2 4
5 1
1 4
2 4
3 2
3 5
1 2
4 5
```
### 样例输出 #1
```
4
4
1
4
4

```
## 提示

对于 $30\%$ 的数据，$N\leq 10$，$M\leq 10$。

对于 $70\%$ 的数据，$N\leq 10000$，$M\leq 10000$。

对于 $100\%$ 的数据，$1 \leq N,M\leq 500000$，$1 \leq x, y,a ,b \leq N$，**不保证** $a \neq b$。


样例说明：

该树结构如下：

 ![](https://cdn.luogu.com.cn/upload/pic/2282.png) 

第一次询问：$2, 4$ 的最近公共祖先，故为 $4$。

第二次询问：$3, 2$ 的最近公共祖先，故为 $4$。

第三次询问：$3, 5$ 的最近公共祖先，故为 $1$。

第四次询问：$1, 2$ 的最近公共祖先，故为 $4$。

第五次询问：$4, 5$ 的最近公共祖先，故为 $4$。

故输出依次为 $4, 4, 1, 4, 4$。


2021/10/4 数据更新 @fstqwq：应要求加了两组数据卡掉了暴力跳。



---

---
title: "专心OI - 找祖先"
layout: "post"
diff: 普及/提高-
pid: P5002
tag: ['搜索', '枚举', '最近公共祖先 LCA']
---
# 专心OI - 找祖先
## 题目背景

Imakf 是一个小蒟蒻，他最近刚学了 LCA，他在手机 APPstore 里看到一个游戏也叫做 LCA 就下载了下来。
## 题目描述

这个游戏会给出你一棵树，这棵树有 $N$ 个节点，根结点是 $R$，系统会选中 $M$ 个点 $P_1,P_2 \cdots P_M$，要Imakf 回答有多少组点对 $(u_i,v_i)$ 的最近公共祖先是 $P_i$。Imakf 是个小蒟蒻，他就算学了 LCA 也做不出，于是只好求助您了。


## 输入格式

第一行三个整数 $N , R , M$。

此后 $N-1$ 行，每行两个数 $a,b$，表示 $a,b$ 之间有一条边。

此后 $1 $行，共 $M$ 个数，表示$P_i$。

保证给出的边形成一棵树。
## 输出格式

输出共 $M$ 行，每行一个数，第 $i$ 行的数表示有多少组点对 $(u_i,v_i)$ 的最近公共祖先是 $P_i$。
## 样例

### 样例输入 #1
```
7 1 3
1 2
1 3
2 4
2 5
3 6
3 7
1 2 4
```
### 样例输出 #1
```
31
7
1
```
## 提示

样例 1 的树如下图所示：

![](https://cdn.luogu.com.cn/upload/pic/37971.png)

 对于询问 1 $~(1,1)
(1,2)
(1,3)
(1,4)
(1,5)
(1,6)
(1,7)
(2,1)
(2,3)
(2,6)
(2,7)
(3,1)
(3,2)
(3,4)
(3,5)
(4,1)
(4,3)$

$
(4,6)
(4,7)
(5,1)
(5,3)
(5,6)
(5,7)
(6,1)
(6,2)
(6,4)
(6,5)
(7,1)
(7,2)
(7,4)
(7,5)$ 共 $31$ 组点对。

询问 2 $(2,2)
(2,4)
(2,5)
(4,2)
(4,5)
(5,2)
(5,4)$ 共 $7$ 组点对。

对于询问 3 $(4,4)$ 共 $1$ 组点对。

$1\le R\le N\leq10000$，$0\le M\leq50000$。


---


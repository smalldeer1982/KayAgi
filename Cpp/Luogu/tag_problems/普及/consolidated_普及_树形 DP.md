---
title: "[蓝桥杯青少年组省赛 2023] 活动人数"
layout: "post"
diff: 普及/提高-
pid: B4275
tag: ['2023', '树形 DP', '蓝桥杯青少年组']
---
# [蓝桥杯青少年组省赛 2023] 活动人数
## 题目描述

有一个大型企业集团，由 $N$ 个部门组成，编号从 $1$ 到 $N$。这些部门之间的层次关系形成了一个树状结构，一个上级部门可能会有 $1$ 个或多个直接下级部门，一个下级部门只有一个直接上级部门。  

本月集团举办了一个大型活动，这次的活动组织方按如下要求安排活动：  

1. 来的人越多越好；  
2. 如果一个上级部门参加本次活动，那么他们的直接下级部门就不能参加，而他的间接下级部门可以参加（如下图，如果部门 $1$ 参加，那么部门 $2,3$ 不能参加，而部门 $4,5,6$ 可以参加）。  

请你帮他们计算一下，如何安排可以使参加活动的人数最多，并输出参加活动的最多人数。  

例如：当 $N=6$，每个部门编号为 $1$ 到 $6$，部门上下级关系和部门的人数如下图所示：  

![](https://cdn.luogu.com.cn/upload/image_hosting/ej7lvi7g.png)

注意：示例中，部门 $1$ 是层级最高的部门，没有直接上级，故将其直接上级部门设为 $0$；  

当安排（$1,4,5,6$）这 $4$ 个部门参加活动时，人数最多，为 $11$，所以输出 $11$。  
## 输入格式

第一行输入一个正整数 $N$（$1 \leq N \leq 100000$），表示集团所有部门的数量。

接下来有 $N$ 行，每行输入三个非负整数 $F$、$S$ 和 $C$，（$0 \leq F \leq N$，$1 \leq S \leq N$，$F \neq S$，$1 \leq C \leq 1000$），$F$ 表示是部门 $S$ 的直接上级，$C$ 表示部门 $S$ 的人数，整数之间用一个空格隔开。  

注意：如果是最上层的部门，其直接上级部门编号为 $0$。
## 输出格式

输出一个整数，表示参加活动的最多人数。
## 样例

### 样例输入 #1
```
6
0 1 2
1 2 4
1 3 3
2 4 3
3 5 2
3 6 4
```
### 样例输出 #1
```
11
```
## 提示

**【评分标准】**

- $10$ 分：能正确输出第一组数据；  
- $10$ 分：能正确输出第二组数据；  
- $10$ 分：能正确输出第三组数据；  
- $10$ 分：能正确输出第四组数据；  
- $10$ 分：能正确输出第五组数据；  
- $10$ 分：能正确输出第六组数据；  
- $10$ 分：能正确输出第七组数据；  
- $10$ 分：能正确输出第八组数据；  
- $10$ 分：能正确输出第九组数据；  
- $10$ 分：能正确输出第十组数据。


---

---
title: "[蓝桥杯青少年组国赛 2024] 第六题"
layout: "post"
diff: 普及/提高-
pid: B4311
tag: ['2024', '树形 DP', '蓝桥杯青少年组']
---
# [蓝桥杯青少年组国赛 2024] 第六题
## 题目描述

某城市的道路构成了一个巨大的树形结构，每一条道路可视为该结构的一条边，而道路的交叉点或端点视为其中的一个节点。该城市共有 $n$ 个节点，编号分别为 $1, 2, 3, \ldots, n$。

为了实时记录道路情况，需要在某些节点部署监控设备。当部署好后，与该节点直接相连的所有道路均能被监控到。为了优化资源分配，在保证整座城市的所有道路都被监控到的前提下，部署监控设备的费用要尽可能少。给定每个节点部署监控设备的费用，请计算要使所有道路都能被监控到的最少花费是多少？
## 输入格式

- 第一行输入一个整数 $n$ ($2 \leq n \leq 10^4$)，表示城市中节点（即道路交叉点或端点）的数量；
- 第二行输入 $n$ 个整数 ($1 <$ 整数 $\leq 10^5$)，分别表示 $1$ 号到 $n$ 号节点部署监控设备的费用；
- 接下来 $n-1$ 行，每行输入两个整数 $a$, $b$，表示节点 $a$ 和节点 $b$ 之间有一条道路。

## 输出格式

输出一个整数，表示要使所有道路均能被监控到的最少花费。
## 样例

### 样例输入 #1
```
8
33 12 30 22 18 10 31 28
1 2
1 3
2 4
2 5
2 6
3 7
3 8
```
### 样例输出 #1
```
42
```


---

---
title: "[USACO24JAN] Potion Farming S"
layout: "post"
diff: 普及/提高-
pid: P10135
tag: ['USACO', '2024', '树形 DP']
---
# [USACO24JAN] Potion Farming S
## 题目描述

你正在玩你最喜欢的手机游戏。为了有机会击败传说中的奶牛 Boss，你正在试着刷药水。游戏地图是由 $N$（$2\le N\le 10^5$）个编号为 $1\ldots N$ 的房间组成，由 $N−1$ 条边连接，形成一棵树。

你可以通过一系列的「遍历」来探索地图。一次遍历是从房间 $1$ 到树中任何其他房间的一条简单路径。当你完成一次遍历后，你可以从房间 $1$ 再次开始遍历。一旦地图的每个房间都被至少一次遍历访问过，这个地图就通关了。你的主要目标是以最小的遍历次数通关这一地图。

你的次要目标是刷到尽可能多的药水。在一次遍历开始前，地图上的某个房间内会生成一瓶药水。你可以通过在当次遍历中访问生成药水的房间来拾取药水。如果你没有拾取药水，那么当次遍历结束它就会消失，你无法在未来的遍历中拾取它。

由于你是一位聪明的程序员，在查看游戏文件后，你成功知道了在接下来的 $N$ 次遍历之前药水的出现位置。如果你以最小的遍历次数通关地图，你可以从地图内刷到的最大药水数量是多少？ 
## 输入格式

输入的第一行包含一个整数 $N$，为地图内的房间数量。

以下一行包含 $N$ 个空格分隔的整数 $p_1p_2\ldots p_N$，其中 $p_i$ 为第 $i$ 次遍历之前药水出现的房间。

最后 $N−1$ 行每行包含两个空格分隔的整数 $a\ b$（$1\le a,b\le N$），表示房间 $a$ 和 $b$ 之间的一条边。输入保证所有边形成一棵树。
## 输出格式

输出一行，包含一个整数，为以最小的遍历次数可以从地图内刷到的最大药水数量。 
## 样例

### 样例输入 #1
```
5
5 4 3 2 1
1 2
1 3
3 4
3 5
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释 1

在这个测试用例中，通关地图所需的最小遍历次数为 $3$。

一个在三次遍历中拾取两瓶药水的最佳方案如下：

- 遍历 $1$：$1\to 3\to 5$（于房间 $5$ 拾取药水）
- 遍历 $2$：$1\to 3\to 4$（于房间 $4$ 拾取药水）
- 遍历 $3$：$1\to 2$（被迫通关地图，无视房间 $3$ 的药水）

或者，我们也可以计划我们的遍历如下：

- 遍历 $1$：$1\to 2$（没有药水）
- 遍历 $2$：$1\to 3\to 4$（于房间 $4$ 拾取药水）
- 遍历 $3$：$1\to 3\to 5$（于房间 $3$ 拾取药水）

### 测试点性质

- 测试点 $2-7$：$N\le 1000$。
- 测试点 $8-15$：没有额外限制。


---

---
title: "最大子树和"
layout: "post"
diff: 普及/提高-
pid: P1122
tag: ['动态规划 DP', '树形 DP']
---
# 最大子树和
## 题目描述

小明对数学饱有兴趣，并且是个勤奋好学的学生，总是在课后留在教室向老师请教一些问题。一天他早晨骑车去上课，路上见到一个老伯正在修剪花花草草，顿时想到了一个有关修剪花卉的问题。于是当日课后，小明就向老师提出了这个问题：

一株奇怪的花卉，上面共连有 $N$ 朵花，共有 $N-1$ 条枝干将花儿连在一起，并且未修剪时每朵花都不是孤立的。每朵花都有一个“美丽指数”，该数越大说明这朵花越漂亮，也有“美丽指数”为负数的，说明这朵花看着都让人恶心。所谓“修剪”，意为：去掉其中的一条枝条，这样一株花就成了两株，扔掉其中一株。经过一系列“修剪“之后，还剩下最后一株花（也可能是一朵）。老师的任务就是：通过一系列“修剪”（也可以什么“修剪”都不进行），使剩下的那株（那朵）花卉上所有花朵的“美丽指数”之和最大。

老师想了一会儿，给出了正解。小明见问题被轻易攻破，相当不爽，于是又拿来问你。
## 输入格式

第一行一个整数 $n\ (1\le N\le 16000)$。表示原始的那株花卉上共 $n$ 朵花。

第二行有 $n$ 个整数，第 $i$ 个整数表示第 $i$ 朵花的美丽指数。

接下来 $n-1$ 行每行两个整数 $a,b$，表示存在一条连接第 $a$ 朵花和第 $b$ 朵花的枝条。
## 输出格式

一个数，表示一系列“修剪”之后所能得到的“美丽指数”之和的最大值。保证绝对值不超过 $2147483647$。

## 样例

### 样例输入 #1
```
7
-1 -1 -1 1 1 1 0
1 4
2 5
3 6
4 7
5 7
6 7

```
### 样例输出 #1
```
3
```
## 提示

### 数据范围及约定

- 对于 $60\%$ 的数据，有 $1\le N\le 1000$；
- 对于 $100\%$ 的数据，有 $1\le N\le 16000$。


---

---
title: "[NOIP 2014 提高组] 联合权值"
layout: "post"
diff: 普及/提高-
pid: P1351
tag: ['动态规划 DP', '2014', 'NOIP 提高组', '树形 DP', '最近公共祖先 LCA']
---
# [NOIP 2014 提高组] 联合权值
## 题目背景

NOIP2014 提高组 D1T2
## 题目描述

无向连通图 $G$ 有 $n$ 个点，$n-1$ 条边。点从 $1$ 到 $n$ 依次编号,编号为 $i$ 的点的权值为 $W_i$，每条边的长度均为 $1$。图上两点 $(u, v)$ 的距离定义为 $u$ 点到 $v$ 点的最短距离。对于图 $G$ 上的点对 $(u, v)$，若它们的距离为 $2$，则它们之间会产生 $W_v \times W_u$ 的联合权值。

请问图 $G$ 上所有可产生联合权值的有序点对中，联合权值最大的是多少？所有联合权值之和是多少？
## 输入格式

第一行包含 $1$ 个整数 $n$。

接下来 $n-1$ 行,每行包含 $2$ 个用空格隔开的正整数 $u,v$，表示编号为 $u$ 和编号为 $v$ 的点之间有边相连。

最后 $1$ 行，包含 $n$ 个正整数，每两个正整数之间用一个空格隔开，其中第 $i$ 个整数表示图 $G$ 上编号为 $i$ 的点的权值为 $W_i$。
## 输出格式

输出共 $1$ 行，包含 $2$ 个整数，之间用一个空格隔开,依次为图 $G$ 上联合权值的最大值和所有联合权值之和。由于所有联合权值之和可能很大，输出它时要对 $10007$ 取余。
## 样例

### 样例输入 #1
```
5  
1 2  
2 3
3 4  
4 5  
1 5 2 3 10 
```
### 样例输出 #1
```
20 74
```
## 提示

**样例解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/5zkpab9k.png)

本例输入的图如上所示，距离为 $2$ 的有序点对有$(1,3)$ 、$(2,4)$ 、$(3,1)$ 、$(3,5) $、$(4,2)$ 、$(5,3) $。

其联合权值分别为 $2,15,2,20,15,20$。其中最大的是 $20$，总和为 $74$。

 
**数据说明**

- 对于 $30\%$ 的数据，$1 < n \leq 100$；
- 对于 $60\%$ 的数据，$1 < n \leq 2000$；
- 对于 $100\%$ 的数据，$1 < n \leq 2\times 10^5$，$0 < W_i \leq 10000$。

保证一定存在可产生联合权值的有序点对。


---

---
title: "没有上司的舞会"
layout: "post"
diff: 普及/提高-
pid: P1352
tag: ['动态规划 DP', '福建省历届夏令营', '树形 DP']
---
# 没有上司的舞会
## 题目描述

某大学有 $n$ 个职员，编号为 $1\ldots n$。

他们之间有从属关系，也就是说他们的关系就像一棵以校长为根的树，父结点就是子结点的直接上司。

现在有个周年庆宴会，宴会每邀请来一个职员都会增加一定的快乐指数 $r_i$，但是呢，如果某个职员的直接上司来参加舞会了，那么这个职员就无论如何也不肯来参加舞会了。

所以，请你编程计算，邀请哪些职员可以使快乐指数最大，求最大的快乐指数。
## 输入格式

输入的第一行是一个整数 $n$。

第 $2$ 到第 $(n + 1)$ 行，每行一个整数，第 $(i+1)$ 行的整数表示 $i$ 号职员的快乐指数 $r_i$。

第 $(n + 2)$ 到第 $2n$ 行，每行输入一对整数 $l, k$，代表 $k$ 是 $l$ 的直接上司。
## 输出格式

输出一行一个整数代表最大的快乐指数。
## 样例

### 样例输入 #1
```
7
1
1
1
1
1
1
1
1 3
2 3
6 4
7 4
4 5
3 5

```
### 样例输出 #1
```
5

```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1\leq n \leq 6 \times 10^3$，$-128 \leq r_i\leq 127$，$1 \leq l, k \leq n$，且给出的关系一定是一棵树。


---

---
title: "魔族密码"
layout: "post"
diff: 普及/提高-
pid: P1481
tag: ['树形 DP', '哈希 hashing', '字典树 Trie', '差分']
---
# 魔族密码
## 题目背景

风之子刚走进他的考场，就……

花花：当当当当~~偶是魅力女皇——花花！！^^（华丽出场，礼炮，鲜花）

风之子：我呕……（杀死人的眼神）快说题目！否则……-\_-###
## 题目描述



花花：……咦~~好冷~~我们现在要解决的是魔族的密码问题（自我陶醉：搞不好魔族里面还会有人用密码给我和菜虫写情书咧，哦活活，当然是给我的比较多拉\*^\_^\*）。

魔族现在使用一种新型的密码系统。每一个密码都是一个给定的仅包含小写字母的英文单词表，每个单词至少包含 $1$ 个字母，至多 $75$ 个字母。如果在一个由一个词或多个词组成的表中，除了最后一个以外，每个单词都被其后的一个单词所包含，即前一个单词是后一个单词的前缀，则称词表为一个词链。例如下面单词组成了一个词链：

- $\verb!i!$；
- $\verb!int!$；
- $\verb!integer!$。

但下面的单词不组成词链：

- $\verb!integer!$；
- $\verb!intern!$。

现在你要做的就是在一个给定的单词表中取出一些词，组成最长的词链，就是包含单词数最多的词链。将它的单词数统计出来，就得到密码了。

风之子：密码就是最长词链所包括的单词数阿……

## 输入格式

这些文件的格式是，第一行为单词表中的单词数 $N$（$1 \le N \le 2000$），下面每一行有一个单词，按字典顺序排列，中间也没有重复的单词。
## 输出格式

输出共一行，一个整数，表示密码。
## 样例

### 样例输入 #1
```
5
i
int
integer
intern
internet

```
### 样例输出 #1
```
4

```


---

---
title: "战略游戏"
layout: "post"
diff: 普及/提高-
pid: P2016
tag: ['动态规划 DP', '树形 DP']
---
# 战略游戏
## 题目背景

Bob 喜欢玩电脑游戏，特别是战略游戏。但是他经常无法找到快速玩过游戏的办法。现在他有个问题。

## 题目描述

他要建立一个古城堡，城堡中的路形成一棵无根树。他要在这棵树的结点上放置最少数目的士兵，使得这些士兵能瞭望到所有的路。

注意，某个士兵在一个结点上时，与该结点相连的所有边将都可以被瞭望到。

请你编一程序，给定一树，帮 Bob 计算出他需要放置最少的士兵。
## 输入格式

第一行一个整数 $n$，表示树中结点的数目。

第二行至第 $n+1$ 行，每行描述每个结点信息，依次为：一个整数 $i$，代表该结点标号，一个自然数 $k$，代表后面有 $k$ 条无向边与结点 $i$ 相连。接下来 $k$ 个整数，分别是每条边的另一个结点标号 $r_1,r_2,\cdots,r_k$，表示 $i$ 与这些点间各有一条无向边相连。

对于一个 $n$ 个结点的树，结点标号在 $0$ 到 $n-1$ 之间，在输入数据中每条边只出现一次。保证输入是一棵树。
## 输出格式

输出文件仅包含一个整数，为所求的最少的士兵数目。

## 样例

### 样例输入 #1
```
4
0 1 1
1 2 2 3
2 0
3 0

```
### 样例输出 #1
```
1

```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq n \leq 1500$。


---

---
title: "[USACO08JAN] Cell Phone Network G"
layout: "post"
diff: 普及/提高-
pid: P2899
tag: ['2008', 'USACO', '排序', '树形 DP', '拓扑排序']
---
# [USACO08JAN] Cell Phone Network G
## 题目描述

Farmer John has decided to give each of his cows a cell phone in hopes to encourage their social interaction. This, however, requires him to set up cell phone towers on his N (1 ≤ N ≤ 10,000) pastures (conveniently numbered 1..N) so they can all communicate.

Exactly N-1 pairs of pastures are adjacent, and for any two pastures A and B (1 ≤ A ≤ N; 1 ≤ B ≤ N; A ≠ B) there is a sequence of adjacent pastures such that A is the first pasture in the sequence and B is the last. Farmer John can only place cell phone towers in the pastures, and each tower has enough range to provide service to the pasture it is on and all pastures adjacent to the pasture with the cell tower.

Help him determine the minimum number of towers he must install to provide cell phone service to each pasture.

Farmer John 想让他的所有牛用上手机以便相互交流。他需要建立几座信号塔在 $N$ 块草地中。已知与信号塔相邻的草地能收到信号。给你 $N-1$ 个草地 $(A,B)$ 的相邻关系，问：最少需要建多少个信号塔能实现所有草地都有信号。

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N: Each line specifies a pair of adjacent pastures with two space-separated integers: A and B

## 输出格式

\* Line 1: A single integer indicating the minimum number of towers to install

## 样例

### 样例输入 #1
```
5
1 3
5 2
4 3
3 5

```
### 样例输出 #1
```
2

```


---

---
title: "[蓝桥杯 2015 省 B] 生命之树"
layout: "post"
diff: 普及/提高-
pid: P8625
tag: ['2015', '树形 DP', '蓝桥杯省赛']
---
# [蓝桥杯 2015 省 B] 生命之树
## 题目描述

在 X 森林里，上帝创建了生命之树。

他给每棵树的每个节点（叶子也称为一个节点）上，都标了一个整数，代表这个点的和谐值。

上帝要在这棵树内选出一个节点集合 $S$（允许为空集），使得对于 $S$ 中的任意两个点 $a,b$，都存在一个点列 ${a,v_1,v_2, \cdots ,v_k,b}$ 使得这个点列中的每个点都是 $S$ 里面的元素，且序列中相邻两个点间有一条边相连。

在这个前提下，上帝要使得 $S$ 中的点所对应的整数的和尽量大。

这个最大的和就是上帝给生命之树的评分。

经过 atm 的努力，他已经知道了上帝给每棵树上每个节点上的整数。但是由于 atm 不擅长计算，他不知道怎样有效的求评分。他需要你为他写一个程序来计算一棵树的分数。
## 输入格式

第一行一个整数 $n$ 表示这棵树有 $n$ 个节点。

第二行 $n$ 个整数，依次表示每个节点的评分。

接下来 $n-1$ 行，每行 $2$ 个整数 $u,v$，表示存在一条 $u$ 到 $v$ 的边。由于这是一棵树，所以是不存在环的。

## 输出格式

输出一行一个数，表示上帝给这棵树的分数。
## 样例

### 样例输入 #1
```
5
1 -2 -3 4 5
4 2
3 1
1 2
2 5
```
### 样例输出 #1
```
8
```
## 提示

对于 $30\%$ 的数据，$n \le 10$。

对于 $100\%$ 的数据，$0<n \le 10^5,$ 每个节点的评分的绝对值不超过 $10^6$。

时限 3 秒, 256M。

蓝桥杯 2015 省赛 B 组 J 题。


---

---
title: "[蓝桥杯 2021 省 A] 左孩子右兄弟"
layout: "post"
diff: 普及/提高-
pid: P8744
tag: ['2021', '树形 DP', '蓝桥杯省赛']
---
# [蓝桥杯 2021 省 A] 左孩子右兄弟
## 题目描述

对于一棵多叉树，我们可以通过“左孩子右兄弟”表示法，将其转化成一棵二叉树。

如果我们认为每个结点的子结点是无序的，那么得到的二叉树可能不唯一。换句话说，每个结点可以选任意子结点作为左孩子，并按任意顺序连接右兄弟。

给定一棵包含 $N$ 个结点的多叉树，结点从 $1$ 至 $N$ 编号，其中 $1$ 号结点是根，每个结点的父结点的编号比自己的编号小。请你计算其通过"左孩子右兄弟"表示法转化成的二叉树，高度最高是多少。（只有根结点这一个结点的树高度为 $0$）

例如如下的多叉树：

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_29_d8f144a59f4c0ce9322ag-11.jpg)

可能有以下 $3$ 种 (这里只列出 $3$ 种, 并不是全部) 不同的 “左孩子右兄弟” 表示: 

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_29_d8f144a59f4c0ce9322ag-12.jpg)

其中最后一种高度最高, 为 $4$。
## 输入格式

输入的第一行包含一个整数 $N$ 。

以下 $N-1$ 行, 每行包含一个整数, 依次表示 $2$ 至 $N$ 号结点的父结点编号。
## 输出格式

输出一个整数表示答案。
## 样例

### 样例输入 #1
```
5
1
1
1
2
```
### 样例输出 #1
```
4
```
## 提示

对于 $30 \%$ 的评测用例，$1 \leq N \leq 20$;

对于所有评测用例，$1 \leq N \leq 10^5$ 。 

蓝桥杯 2021 第一轮省赛 A 组 H 题。


---


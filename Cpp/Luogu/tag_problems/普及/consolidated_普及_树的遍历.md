---
title: "Subway tree systems"
layout: "post"
diff: 普及/提高-
pid: P10477
tag: ['深度优先搜索 DFS', '图遍历', '树的遍历']
---
# Subway tree systems
## 题目描述

Some major cities have subway systems in the form of a tree, i.e. between any pair of stations, there is one and only one way of going by subway. Moreover, most of these cities have a unique central station. Imagine you are a tourist in one of these cities and you want to explore all of the subway system. You start at the central station and pick a subway line at random and jump aboard the subway car. Every time you arrive at a station, you pick one of the subway lines you have not yet travelled on. If there is none left to explore at your current station, you take the subway line back on which you first came to the station, until you eventually have travelled along all of the lines twice,once for each direction. At that point you are back at the central station. Afterwards, all you remember of the order of your exploration is whether you went further away from the central station or back towards it at any given time, i.e. you could encode your tour as a binary string, where 0 encodes taking a subway line getting you one station further away from the central station, and 1 encodes getting you one station closer to the central station.

![](https://cdn.luogu.com.cn/upload/image_hosting/57sf9gvq.png)
## 输入格式

On the first line of input is a single positive integer n, telling the number of test scenarios to follow.Each test scenario consists of two lines, each containing a string of the characters '0' and '1' of length at most 3000, both describing a correct exploration tour of a subway tree system.
## 输出格式

exploration tours of the same subway tree system, or the text "different" if the two strings cannot be exploration tours of the same subway tree system.
## 样例

### 样例输入 #1
```
2
0010011101001011
0100011011001011
0100101100100111
0011000111010101
```
### 样例输出 #1
```
same
different
```
## 题目翻译

**【题目描述】**

一些主要城市的地铁系统采用树状结构，即在任何两个车站之间，只有一条且仅有一条地铁线路。此外，大多数这些城市都有一个独特的中央车站。想象一下，你是这些城市中的一名游客，你想要探索整个地铁系统。你从中央车站出发，随机选择一条地铁线路，跳上地铁列车。每当你到达一个车站，你就会选择一条你尚未乘坐过的地铁线路。如果在当前车站没有其他要探索的地铁线路了，你就会乘坐第一次到达该车站的地铁线路返回，直到最终你沿着所有的线路都行驶了两次，即每个方向都行驶了一次。在那时，你回到了中央车站。之后，你所记得的探索顺序只是在任何给定时间是否向中央车站更远或更近，也就是说，你可以将你的旅程编码为一个二进制字符串，其中 0 表示乘坐一条地铁线路使你离中央车站更远一站，而 1 表示使你离中央车站更近一站。

**【输入格式】**

输入的第一行是一个正整数 $n$，表示接下来要跟随的测试方案的数量。每个测试方案包括两行，每行包含一个长度最多为 $3000$ 的由字符 '0' 和 '1' 组成的字符串，描述了地铁树系统的正确探索旅程。

**【输出格式】**

对于每个测试方案，如果两个字符串可以表示相同地铁树系统的探索旅程，则输出 "same"；如果两个字符串不能表示相同地铁树系统的探索旅程，则输出 "different"。

翻译来自于：ChatGPT。


---

---
title: "[GESP202406 六级] 二叉树"
layout: "post"
diff: 普及/提高-
pid: P10722
tag: ['树形数据结构', '2024', '图遍历', '树的遍历', 'GESP']
---
# [GESP202406 六级] 二叉树
## 题目描述

小杨有⼀棵包含 $n$ 个节点的二叉树，且根节点的编号为 $1$。这棵二叉树任意⼀个节点要么是白色，要么是黑色。之后小杨会对这棵二叉树进行 $q$ 次操作，每次小杨会选择⼀个节点，将以这个节点为根的子树内所有节点的颜色反转，即黑色变成白色，白色变成黑色。

小杨想知道 $q$ 次操作全部完成之后每个节点的颜色。
## 输入格式

第⼀行一个正整数 $n$，表示二叉树的节点数量。

第二行 $(n-1)$ 个正整数，第 $i$（$1\le i\le n-1$）个数表示编号为 $(i+1)$ 的节点的父亲节点编号，数据保证是⼀棵二叉树。

第三行一个长度为 $n$ 的 $\texttt{01}$ 串，从左到右第 $i$（$1\le i\le n$）位如果为 $\texttt{0}$，表示编号为 $i$ 的节点颜色为白色，否则为黑色。

第四行⼀个正整数 $q$，表示操作次数。

接下来 $q$ 行每行⼀个正整数 $a_i$（$1\le a_i\le n$），表示第 $i$ 次操作选择的节点编号。
## 输出格式

输出一行一个长度为 $n$ 的 $\texttt{01}$ 串，表示 $q$ 次操作全部完成之后每个节点的颜色。从左到右第 $i$（$1\le i\le n$） 位如果为 $\texttt{0}$，表示编号为 $i$ 的节点颜色为白色，否则为黑色。
## 样例

### 样例输入 #1
```
6
3 1 1 3 4
100101
3
1
3
2
```
### 样例输出 #1
```
010000
```
## 提示

#### 样例解释

第一次操作后，节点颜色为：$\texttt{011010}$

第二次操作后，节点颜色为：$\texttt{000000}$

第三次操作后，节点颜色为：$\texttt{010000}$

#### 数据范围

| 子任务编号 | 得分 | $n$ | $q$ | 特殊条件 |
| :--: | :--: | :--: | :--: | :--: |
| $1$ |  $20$ | $\le 10^5$ | $\le 10^5$ |对于所有 $i\ge 2$，节点 $i$ 的父亲节点编号为 $i-1$
| $2$ |  $40$ | $\le 1000$ | $\le 1000$ | |
| $3$ | $40$ | $\le 10^5$ | $\le 10^5$ | |

对于全部数据，保证有 $n,q\le 10^5$。


---

---
title: "「Cfz Round 9」Dove"
layout: "post"
diff: 普及/提高-
pid: P11206
tag: ['洛谷原创', 'Special Judge', 'O2优化', '树的遍历', '构造', '洛谷比赛']
---
# 「Cfz Round 9」Dove
## 题目描述

你的面前有一棵树。

这棵树共有 $n$ 个结点，这些结点之间由 $n-1$ 根树枝相连，每个结点上都有一只鸽子。

她希望你对所有鸽子进行编号。设第 $i$ 只鸽子的编号为 $p_i$，你需要满足：

- 序列 $p$ 为一个 $1 \sim n$ 的排列，即 $1\sim n$ 中的每个数在所有鸽子的编号中恰好出现一次；
- 对于结点 $u,v$，若结点 $u$ 与结点 $v$ 之间存在一根树枝，则结点 $u$ 上的鸽子的编号与结点 $v$ 上的鸽子的编号之和不大于 $n+1$，即 $p_u+p_v \le n+1$。

你想求出一种满足条件的对鸽子进行编号的方式。可以证明，一定存在至少一组解。
## 输入格式

**本题有多组测试数据。**

输入的第一行包含一个正整数 $T$，表示测试数据组数。

接下来依次输入每组测试数据。对于每组测试数据：

- 第一行一个正整数 $n$。
- 接下来 $n-1$ 行，每行两个正整数 $u_i,v_i$，表示结点 $u_i$ 与结点 $v_i$ 之间存在一根树枝。
## 输出格式

对于每组测试数据，输出一行 $n$ 个正整数，其中第 $i$ 个正整数表示你求出的对鸽子进行编号的方式中 $p_i$ 的值，即结点 $i$ 上的鸽子的编号。

可以证明，一定存在至少一组解。

**所有满足要求的输出均可通过。**
## 样例

### 样例输入 #1
```
2
3
1 2
1 3
5
4 2
1 5
3 1
2 1
```
### 样例输出 #1
```
1 3 2
1 2 3 4 5
```
## 提示

#### 「样例解释 #1」

对于第 $1$ 组测试数据，结点 $1$ 上的鸽子的编号为 $1$，结点 $2$ 上的鸽子的编号为 $3$，结点 $3$ 上的鸽子的编号为 $2$，由于 $1+2$ 和 $1+3$ 均不大于 $4$，所以这种对鸽子进行编号的方式满足条件。

对于第 $2$ 组测试数据，另一种满足条件的对鸽子进行编号的方式为：令结点 $1,2,3,4,5$ 上的鸽子的编号分别为 $2,1,4,5,3$。

#### 「数据范围」

对于所有测试数据，保证：

- $1 \le T \le 10$；
- $2 \le n \le 10^5$；
- $1 \le u_i,v_i \le n$；
- 输入数据形成一棵树。

**本题采用捆绑测试。**

- Subtask 0（21 points）：$n \le 8$。
- Subtask 1（25 points）：$n \le 1000$。
- Subtask 2（11 points）：对于任意小于 $n$ 的正整数 $i$，都满足 $u_i=1$ 且 $v_i=i+1$。
- Subtask 3（18 points）：对于任意小于 $n$ 的正整数 $i$，都满足 $u_i=i$ 且 $v_i=i+1$。
- Subtask 4（25 points）：无特殊限制。


---

---
title: "[GESP202412 七级] 燃烧"
layout: "post"
diff: 普及/提高-
pid: P11378
tag: ['2024', '树的遍历', 'GESP']
---
# [GESP202412 七级] 燃烧
## 题目描述

小杨有一棵包含 $n$ 个节点的树，其中节点的编号从 $1$ 到 $n$。节点 $i$ 的权值为 $a_i$。

小杨可以选择一个初始节点引燃，每个燃烧的节点会将其相邻节点中权值**严格小于**自身权值的在节点间扩散直到不会有新的节点被引燃。

小杨想知道在合理选择初始节点的情况下，最多可以燃烧多少个节点。
## 输入格式

第一行包含一个正整数 $n$，表示节点数量。

第二行包含 $n$ 个正整数 $a_1,a_2,\dots,a_n$，代表节点权值。

之后 $n-1$ 行，每行包含两个正整数 $u_i,v_i$，代表存在一条连接节点 $u_i$ 和 $v_i$ 的边。
## 输出格式

输出一个正整数，代表最多燃烧的节点个数。

## 样例

### 样例输入 #1
```
5
6 2 3 4 5
1 2
2 3
2 5
1 4
```
### 样例输出 #1
```
3
```
## 提示

| 子任务编号 | 数据点占比 |     $n$     |
| :--------: | :--------: | :---------: |
|    $1$     |   $20\%$   |  $\leq 10$  |
|    $2$     |   $20\%$   | $\leq 100$  |
|    $3$     |   $60\%$   | $\leq 10^5$ |

对于全部数据，保证有 $1\leq n\leq 10^5$，$1\leq a_i\leq 10^6$。


---

---
title: "[GESP202412 八级] 树上移动"
layout: "post"
diff: 普及/提高-
pid: P11379
tag: ['2024', '树的遍历', 'GESP']
---
# [GESP202412 八级] 树上移动
## 题目描述

小杨有一棵包含 $n$ 个节点的树，其中节点的编号从 $1$ 到 $n$，每个节点的颜色要么是白色要么是黑色，小杨可以任意选择节点 $s$ 和节点 $t$ 并从节点 $s$ 出发移动到节点 $t$，移动过程中小杨不能够经过重复节点。

小杨希望自己在至多经过 $k$ 个黑色节点的前提下，经过的总节点数尽可能多，请你帮小杨选择经过最多的节点数是多少。
## 输入格式

第一行包含两个正整数 $n,k$，代表节点数量和至多经过的黑色节点数。

第二行包含 $n$ 个正整数 $a_1,a_2,\dots,a_n$，代表节点颜色，如果 $a_i=0$，代表节点颜色为白色，如果 $a_i=1$，代表节点颜色为黑色。

之后 $n-1$ 行，每行包含两个正整数 $u_i,v_i$，代表存在一条连接 $u_i$ 和 $v_i$ 的边。
## 输出格式

输出一个正整数，代表最多经过的节点数。
## 样例

### 样例输入 #1
```
5 1
0 0 1 1 1
1 2
2 3
2 5
1 4
```
### 样例输出 #1
```
3
```
## 提示

| 子任务编号 | 数据点占比 |     $n$     | $k$         |     特殊性质     |
| :--------: | :--------: | :---------: | ----------- | :--------------: |
|    $1$     |   $20\%$   | $\leq 100$  | $\leq 100$  | 树的形态为一条链 |
|    $2$     |   $20\%$   | $\leq 1000$ | $0$         |                  |
|    $3$     |   $60\%$   | $\leq 1000$ | $\leq 1000$ |                  |


对于全部数据，保证有 $1\leq n\leq 1000$，$0\leq k\leq 1000$，$0\leq a_i\leq 1$。


---

---
title: "[迷宫寻路 Round 3] 挂掉的模板"
layout: "post"
diff: 普及/提高-
pid: P11624
tag: ['O2优化', '树的遍历']
---
# [迷宫寻路 Round 3] 挂掉的模板
## 题目背景

**upd : [2025/1/27] Hack 数据已添加。**

某人把 LCA 板子写挂了，然后就有了这道题。
## 题目描述

有一颗 $n$ 个节点的有根树。

定义 `FakeLCA` 函数代码如下：

```cpp
int FakeLCA(int u, int v) {
	while (u != v) u = fa[u], v = fa[v];
	return u;
}
```

其中 `fa[i]` 表示节点 $i$ 的父节点，**特别的，根的父节点是根本身。**

现在给定节点数 $n$ 和每个节点的父节点，问有多少个有序数对 $(u,v)$，满足 $1\le u,v\le n$ 且 `FakeLCA(u, v)` 的结果是 $u$ 和 $v$ 的真正的最近公共祖先。
## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个整数，第 $i$ 个整数表示节点 $i$ 的父节点。
## 输出格式

一行一个数表示答案。
## 样例

### 样例输入 #1
```
1
1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5
1 1 1 2 2
```
### 样例输出 #2
```
21
```
### 样例输入 #3
```
10
1 1 1 2 2 3 3 3 4 4
```
### 样例输出 #3
```
78
```
### 样例输入 #4
```
20
1 1 2 2 2 2 2 4 4 4 4 3 3 3 4 4 7 7 9 10
```
### 样例输出 #4
```
190
```
### 样例输入 #5
```
50
1 1 1 1 1 1 1 1 1 2 2 3 4 3 3 4 5 7 2 4 4 3 2 4 6 9 3 8 7 6 12 13 2 12 5 28 17 27 20 36 5 3 2 8 7 6 5 47 26 1
```
### 样例输出 #5
```
2336
```
## 提示

**提示：请仔细阅读题目中关于根的说明，根节点不一定是 1 号点！**

**本题采用捆绑测试。**

对于所有数据，$1\le n\le 10^6$。

| 子任务编号 | $n\leq$ | 分数 |
| :----------: | :----------: | :----------: |
| $0$ | $100$ | $25$ |
| $1$ | $1000$ | $25$ |
| $2$ | $7000$ | $25$ |
| $3$ | $10^6$ | $25$ |


---

---
title: "[蓝桥杯 2024 省 B 第二场] 狡兔 k 窟"
layout: "post"
diff: 普及/提高-
pid: P12126
tag: ['2024', '树的遍历', '蓝桥杯省赛']
---
# [蓝桥杯 2024 省 B 第二场] 狡兔 k 窟
## 题目描述

一只兔子名叫小蓝，它异常狡猾，在土中挖了若干洞窟并且设置了很多出入口来应对紧急情况。它一共有 $n$ 个通往地面的出入口，在地面上这 $n$ 个出入口之间由 $n - 1$ 条长度为 $1$ 的双向通路连成一个连通图。第 $i$ 个出入口属于第 $c_i$ 个洞窟，因此小蓝可以在任意一个属于 $c_i$ 的出入口从地面进入洞窟然后从任意一个属于 $c_i$ 的出入口跑出到达地面。

小蓝提出了 $m$ 个逃跑路线，第 $i$ 个路线希望从出入口 $s_i$ 逃往 $t_i$，它希望在逃跑的过程中在地面上跑动的距离尽可能短，请为每条路线计算逃跑时在地面上跑动的最短距离。
## 输入格式

输入的第一行包含两个正整数 $n, m$，用一个空格分隔。

第二行包含 $n$ 个正整数 $c_1, c_2, \dots , c_n$，相邻整数之间使用一个空格分隔。

接下来 $n - 1$ 行，第 $i$ 行包含两个整数 $u_i, v_i$，用一个空格分隔，表示地面上的一条通路连接 $u_i$ 和 $v_i$。

接下来 $m$ 行，第 $i$ 行包含两个整数 $s_i, t_i$，用一个空格分隔。
## 输出格式

输出 $m$ 行，每行包含一个整数，依次表示每个询问的答案。
## 样例

### 样例输入 #1
```
6 3
1 3 2 1 2 3
1 2
1 3
2 4
2 5
3 6
2 6
3 2
4 3
```
### 样例输出 #1
```
0
1
1
```
## 提示

### 评测用例规模与约定
- 对于 $20\%$ 的评测用例，$1 \leq n, m, c_i \leq 100$；
- 对于所有评测用例，$1 \leq n, m, c_i \leq 5000$，$1 \leq u_i, v_i, s_i, t_i \leq n$。


---

---
title: "[蓝桥杯 2024 国 C] 树的结点值"
layout: "post"
diff: 普及/提高-
pid: P12317
tag: ['2024', '深度优先搜索 DFS', '树的遍历', '蓝桥杯国赛']
---
# [蓝桥杯 2024 国 C] 树的结点值
## 题目描述

给定一棵包含 $n$ 个结点的树，其树根编号为 $1$。我们规定其第 $i$ 个结点的值为其对应的子树内所有与 $i$ 奇偶性相同的结点数量。请按编号从小到大的顺序输出其每个结点的值。
## 输入格式

输入的第一行包含一个整数 $n$。

接下来 $n-1$ 行描述每个结点的父结点，其中第 $i$ 行包含一个整数 $F_{i+1}$，表示第 $i+1$ 个结点的父结点。
## 输出格式

输出 $n$ 行，每行包含一个整数表示编号为 $i$ 的结点的值。
## 样例

### 样例输入 #1
```
5
1
2
1
2
```
### 样例输出 #1
```
3
1
1
1
1
```
## 提示

### 评测用例规模与约定

- 对于 $40\%$ 的评测用例，$1 \leq n \leq 5000$；
- 对于所有评测用例，$1 \leq n \leq 2 \times 10^5$，$1 \leq F_i < i$。


---

---
title: "[蓝桥杯 2025 省 AB/Python B 第二场] 树上寻宝"
layout: "post"
diff: 普及/提高-
pid: P12343
tag: ['图论', '2025', '树的遍历', '蓝桥杯省赛']
---
# [蓝桥杯 2025 省 AB/Python B 第二场] 树上寻宝
## 题目描述

小蓝正在一棵含有 $n$ 个结点的树的根结点 $1$ 上，他准备在这棵树上寻宝。结点 $i$ 上有一个物品，价值为 $w_i$。然而，小蓝每次寻宝只能从根节点出发走不超过 $k$ 步，每步只能选择走 $1$ 条边或者 $2$ 条边，之后会自动拾取最终停留的结点上的物品并被传送回根结点。请求出小蓝最终能获得的物品的总价值。
## 输入格式

输入的第一行包含两个正整数 $n, k$，用一个空格分隔。

第二行包含 $n$ 个正整数 $w_1, w_2, \cdots, w_n$，相邻整数之间使用一个空格分隔。

接下来 $n-1$ 行，每行包含两个正整数 $u_i, v_i$，用一个空格分隔，表示结点 $u_i$ 和结点 $v_i$ 之间有一条边。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
8 2
6 3 3 1 5 4 3 4
1 2
2 3
2 4
4 5
5 6
6 7
7 8
```
### 样例输出 #1
```
22
```
## 提示

### 样例说明

- 走 $0$ 步能到的结点：$1$；
- 走 $1$ 步能到的结点：$2, 3, 4$；
- 走 $2$ 步能到的结点：$3, 4, 5, 6$；

因此能到的结点为：$1, 2, 3, 4, 5, 6$，能获得的总价值为 $22$。

### 评测用例规模与约定

- 对于 $20\%$ 的评测用例，$1 \leq n \leq 15$；
- 对于所有评测用例，$0 \leq k < n \leq 10^5$，$1 \leq w_i \leq 10^6$，$1 \leq u_i, v_i \leq n$。


---

---
title: "[KOI 2023 Round 1] 加油站"
layout: "post"
diff: 普及/提高-
pid: P12659
tag: ['贪心', '2023', '树的遍历', 'KOI（韩国）']
---
# [KOI 2023 Round 1] 加油站
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

KOI 国家由 $N$ 个村庄组成。每个村庄从 1 到 $N$ 编号。国家中共有 $N - 1$ 条道路，每条道路连接两个不同的村庄，编号从 1 到 $N - 1$。第 $i$ 条道路连接的是第 $x_i$ 个村庄与第 $y_i$ 个村庄。

KOI 国家中的任意两个村庄之间，恰好存在一条路径将它们连接起来。

从第 $x$ 个村庄到第 $y$ 个村庄的路径可以表示为一个村庄序列：$x$ - $z_1$ - $z_2$ - ⋯ - $z_t$ - $y$，该路径满足以下两个条件：

- 路径上相邻两个村庄之间，即 $x$ 与 $z_1$，$z_1$ 与 $z_2$，⋯，$z_t$ 与 $y$ 之间都存在道路直接连接。
- 路径中不得有重复村庄。也就是说，$x$，$z_1$，⋯，$z_t$，$y$ 均为互不相同的村庄。

路径的“长度”定义为该路径上所经过的道路数，即 $t + 1$。

现在，计划在若干个村庄中设置加油站。根据 KOI 国家法律，加油站必须满足以下条件：

- 对于任意长度为 $k$ 的路径，路径中必须至少有一个村庄设有加油站。

在满足上述条件的前提下，找出设置加油站所需的最小数量。
## 输入格式

第一行包含两个整数 $N$ 和 $k$，以空格分隔，表示村庄的数量与路径长度限制。

接下来 $N - 1$ 行，每行包含两个整数 $x_i$ 和 $y_i$，表示道路直接连接的两个村庄编号。

## 输出格式

输出一行，表示满足条件所需的最少加油站数量。

## 样例

### 样例输入 #1
```
6 2
1 2
1 3
2 4
2 5
4 6
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
7 2
1 2
1 3
2 4
2 5
4 6
6 7
```
### 样例输出 #2
```
2
```
## 提示

**样例 1 说明**

只需在第 $2$ 个村庄设置加油站即可满足所有长度为 $2$ 的路径。

**样例 2 说明**

仅在第 $2$ 个村庄设置加油站不能满足所有长度为 $2$ 的路径（例如路径 $4-6-7$ 不包含加油站）。若再在第 $6$ 个村庄也设置加油站，则所有长度为 $2$ 的路径都包含至少一个加油站。因此最小加油站数量为 $2$。

**限制条件**

- 所有输入均为整数。
- $2 \leq N \leq 200\,000$
- $1 \leq k \leq N - 1$
- $1 \leq x_i, y_i \leq N$
- $x_i \ne y_i$
- 任意两个村庄之间，存在唯一一条路径相连。
- 至少存在一条长度为 $k$ 的路径。

**子问题**

1. （9 分）对于每条道路 $i$（$1 \leq i \leq N - 1$），连接的是第 $i$ 个村庄和第 $i + 1$ 个村庄。
2. （10 分）$k = 1$
3. （11 分）对于每条道路 $i$（$1 \leq i \leq N - 1$），连接的是第 $i + 1$ 个村庄和 $\lfloor \frac{i + 1}{2} \rfloor$ 个村庄。这里 $\lfloor x \rfloor$ 表示不大于 $x$ 的最大整数。
4. （12 分）$N \leq 15$
5. （15 分）$N \leq 300$
6. （17 分）$N \leq 3\,000$
7. （26 分）无额外限制

翻译由 ChatGPT-4o 完成


---

---
title: "[蓝桥杯 2025 国 Python A] 巡逻"
layout: "post"
diff: 普及/提高-
pid: P12874
tag: ['图论', '2025', '树的遍历', '最近公共祖先 LCA', '前缀和', '蓝桥杯国赛']
---
# [蓝桥杯 2025 国 Python A] 巡逻
## 题目背景

建议 Python 用户选择 PyPy3 提交本题。
## 题目描述

边境森林中分布着若干重要的哨站，所有哨站之间由隐秘小径相连，形成一张天然的巡逻网络。这张网络的结构恰好是一棵树。为了防止敌人渗透，小蓝每天需要执行固定长度为 $k$ 的巡逻任务。每次巡逻从一个哨站出发，经过不重复地恰好 $k$ 条道路，最终到达另一个哨站。每条道路都有一定的危险值，巡逻路径上危险值的和代表该次巡逻时的风险。两次巡逻路径不相同当且仅当它们的起点不同或终点不同。

现在指挥官希望知道，所有可能的长度为 $k$ 的巡逻路线的风险之和是多少？
## 输入格式

输入的第一行包含两个正整数 $n, k$ ，用一个空格分隔。

接下来 $n-1$ 行，每行包含三个正整数 $u_i, v_i, w_i$ ，相邻整数之间使用一个空格分隔。表示结点 $u_i$ 和结点 $v_i$ 之间有一条危险值为 $w_i$ 边。

## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
7 2
1 2 3
2 4 5
1 3 7
3 5 3
3 6 4
6 7 2
```
### 样例输出 #1
```
104
```
## 提示

**【样例说明】**

所有可能的路径及其风险值如下：

- $1 \rightarrow 2 \rightarrow 4: 8$
- $2 \rightarrow 1 \rightarrow 3: 10$
- $1 \rightarrow 3 \rightarrow 5: 10$
- $1 \rightarrow 3 \rightarrow 6: 11$
- $5 \rightarrow 3 \rightarrow 6: 7$
- $3 \rightarrow 6 \rightarrow 7: 6$

以上路径反过来也是合法的，所以总共有 14 条不同的路径，风险之和为 104。

**【评测用例规模与约定】**

对于 40% 的评测用例，$1 \leq n \leq 500$；

对于所有评测用例，$1 \leq n \leq 5000$，$1 \leq k \leq n$，$1 \leq u_i, v_i \leq n$，$1 \leq w_i \leq 10^6$。


---

---
title: "[USACO19OPEN] Cow Evolution B"
layout: "post"
diff: 普及/提高-
pid: P1701
tag: ['2019', 'USACO', 'O2优化', '树的遍历']
---
# [USACO19OPEN] Cow Evolution B
## 题目描述

现在是 3019 年，在过去的一千年里发生了不计其数的牛类进化，产生了具有各种有趣特性的奶牛。

牛类进化的记录可以用一棵树来表示，起源是位于树根位置的没有特殊特性的奶牛。树上每一个产生后代的结点，有可能所有的奶牛都进化出了一种新的特性（比如说喷火（fire breathing），如下图所示，其中所有斑点（spots）奶牛最后都能喷火），或者是奶牛种群产生了分支进化，其中有些进化出了新的特性（比如，飞（flying）），有的没有。 

![](https://cdn.luogu.com.cn/upload/image_hosting/q7v0zhg4.png)

树底部的叶结点表示 3019 年所有产生的奶牛的子种群。没有不同的叶结点（子种群）具有完全相同的一组特性。例如，子种群 #1 是没有特殊特性的奶牛，子种群 #3 是能够心灵感应的（telepathic）会飞的奶牛。相比之下，子种群 #2 是会飞但不能心灵感应的奶牛。子种群 #3 是唯一既会飞又会心灵感应的。

像上图这样每一种进化出的新特性都恰好在树中的一条边上产生（也就是说，在整个进化历史中仅在一个时间点产生），这样的进化树被称为是“合法的”。例如，如果斑点这一特性在两个不同分支中均进化产生，这棵进化树就不是合法的。给定 3019 年奶牛子种群的描述，请判断是否这可以由一棵合法的进化树所解释。 
## 输入格式

输入的第一行包含子种群的数量 $N$（$2\le N\le 25$）。以下 $N$ 行每行描述一个子种群。每行包含一个整数 $K$（$0\le K\le 25$），之后是 $K$ 个该子种群奶牛所拥有的特性。特性是由至多 $20$ 个小写字母（`a..z`）组成的字符串。没有两个子种群拥有完全相同的特性。 
## 输出格式

 如果可能构造一棵可以解释所有子种群产生途径的进化树，输出 `yes`，否则输出 `no`。 
## 样例

### 样例输入 #1
```
4
2 spots firebreathing
0
1 flying
2 telepathic flying
```
### 样例输出 #1
```
yes
```
## 提示

### 样例解释 1


这个输入样例与上图所示的合法进化树一致。 


---

---
title: "「DTOI-5」3-1"
layout: "post"
diff: 普及/提高-
pid: P9304
tag: ['树形数据结构', 'O2优化', '深度优先搜索 DFS', '树的遍历']
---
# 「DTOI-5」3-1
## 题目背景

——『太阳』这种东西，以前似乎是存在的。

传说是这么讲的——白色的火焰发出闪耀的光芒，天空则是清澄无比的蔚蓝。

据说诸神与其创造物所掀起的『大战』，使得大地化为焦土，灰烬遮蔽了苍穹。

灰烬冲击到天上流动的星辰之力——精灵回廊，发出了光芒，将天空染成红色。

而那样的红色，覆盖了仍然持续着互相残杀的每一块土地。

或者那是这个星球本身发出的悲鸣与流出的鲜血吧……

血色的天空上，只有——蓝色的灰飘然落下。

~~回来吧3579，我最骄傲的信仰/ll~~
## 题目描述

里克在视线可及的范围内发现了一颗古老的「神树」。

神树是一颗树，树上有 $n$ 个含有魔法装置的位置。经过初步「考察」，有 $n - 1$ 条魔法连接，第 $i(1 \leq i \leq n - 1)$ 条连接 $u_i, v_i$ 两个魔法装置，保证 $u_i \neq v_i$ 且 $1\leq u_i,v_i\leq n$。这两个装置可以相互**双向地**在 $1$ 单位时间内通行，保证仅由这 $n - 1$ 条连接，每个魔法装置都可以相互到达。

此外，有 $n - 1$ 条特殊连接，对于每个魔法装置 $i \in [2, n]$，可以**瞬间**传送到第 $1$ 个魔法装置，花费 $0$ 单位时间。**特殊连接总共只能使用一次**。

里克初始在魔法装置 $1$ 处。现在，给出这棵「神树」的结构，里克想要在若干时间内研究尽可能多的魔法装置。我们假定，研究一个魔法装置只需要到达该装置处，并且不需要花费额外时间。

里克想让你尽快计算出，对所有 $k \in [1, n]$，如果要恰好研究 $k$ 个不同的魔法装置，**并且随之返回魔法装置 $\bm 1$**，最少应花费多少时间。
## 输入格式

第一行，一个整数 $n$。

接下来 $n - 1$ 行，每行两个整数 $u_i, v_i$。
## 输出格式

共 $n$ 行，第 $i$ 行一个整数表示 $k = i$ 的答案。
## 样例

### 样例输入 #1
```
5
1 2
1 3
2 4
2 5
```
### 样例输出 #1
```
0
1
2
4
6
```
### 样例输入 #2
```
见下发的 hope/hope2.in
```
### 样例输出 #2
```
见下发的 hope/hope2.ans
```
## 提示

**【样例解释 $\bm 1$】**

+ $k = 1$ 时，里克只需要呆在装置 $1$ 处。
+ $k = 2$ 时，里克的路径可以是 $1 \rightarrow 2 \Rightarrow 1$。
+ $k = 3$ 时，里克的路径可以是 $1 \rightarrow 2 \rightarrow 4 \Rightarrow 1$。
+ $k = 4$ 时，里克的路径可以是 $1 \rightarrow 2 \rightarrow 4 \Rightarrow 1 \rightarrow 3\rightarrow 1$。
+ $k = 5$ 时，里克的路径可以是 $1 \rightarrow 3\rightarrow 1 \rightarrow 2 \rightarrow 5 \rightarrow 2 \rightarrow 4 \Rightarrow 1$。

**【样例解释 $\bm 2$】**

这组数据满足测试点编号 $13 \sim 20$ 的性质。

**【数据规模与约定】**

| 测试点编号 | 特殊限制 |
| :--------: | :------: |
| $1 \sim 2$ | $n = 3$ |
| $3 \sim 4$ | $n = 5$ |
| $5 \sim 6$ | $n = 100$ |
| $7 \sim 8$ | $n = 1000$ |
| $9 \sim 10$ | $u_i = 1, v_i = i + 1$ |
| $11 \sim 12$ | $u_i = i, v_i = i + 1$ |
| $13 \sim 20$ | 无特殊限制 |

对于所有数据，$1 \leq n \leq 10^5$，$1 \leq u_i, v_i \leq n$。


---


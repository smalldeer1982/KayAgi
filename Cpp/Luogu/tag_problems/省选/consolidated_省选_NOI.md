---
title: "[NOISG 2024 Prelim] Amusement Park"
layout: "post"
diff: 省选/NOI-
pid: P10711
tag: ['线段树', '2024', 'NOISG（新加坡）']
---
# [NOISG 2024 Prelim] Amusement Park
## 题目背景

翻译自 [NOI SG 2024 Prelim D.Amusement Park](https://github.com/noisg/noi-2024-prelim)。
## 题目描述

有一家游乐园，在大门处有一项观光车服务。很显然，一辆观光车只能承载有限的人数，那么如果一个团队来到大门时，发现观光车不够坐时，他们需要决定是否愿意分开。有些团队愿意，有些不愿意。

为了解决这个复杂的问题，公园的管理者蜗牛 Stuart 想请你帮忙写一个程序，支持以下三种操作：

- `join`：一个新的团队进入了队列。我们用两个整数 $s,w$ 描述此次操作：$s$ 表示该团队的总人数；如果 $w=1$，那么这个团队愿意在乘坐观光车时分开；如果 $w=0$，表示他们不愿意分开。假设这次操作是所有操作中第 $i$ 次 `join` 操作，则该团队的编号为 $i$。

- `leave`：给定 $i$，编号为 $i$ 的团队从队伍中离开。

- `board`：给定 $b$，表示新开来一辆能坐 $b$ 人的观光车。从队头开始，如果到一个团队时，观光车可以承载所有人，那么所有人上车；否则如果该团队愿意分开，那么部分人上车；否则该团队留在原位置，在下一个团队重复该过程，直到观光车坐满，或没有人愿意上车。
## 输入格式

第一行，一个整数 $q$；

接下来 $q$ 行，每行一次操作，分为以下三种：

- `1 s w`：描述一次 `join` 操作；

- `2 i`：描述一次 `leave` 操作；

- `3 b`：描述一次 `board` 操作。
## 输出格式

对于 `join` 和 `leave` 操作，你不需要输出任何内容。

对于每一次 `board` 操作，设有 $k$ 个团队有至少一个人上了观光车，你需要输出 $k+1$ 行：

- 第一行一个整数 $k$。

- 接下来 $k$ 行，每行两个整数，第一个表示团队编号，第二个表示该团队上观光车的人数。**注意：团队编号应从小到大输出。**（如果 $k=0$，忽略此部分。）
## 样例

### 样例输入 #1
```
7
1 2 0
1 6 0
1 6 1
3 5
2 2
1 3 0
3 123456789012
```
### 样例输出 #1
```
2
1 2
3 3
2
3 3
4 3
```
### 样例输入 #2
```
5
1 1 0
1 1 0
1 1 0
3 2
1 1 0
```
### 样例输出 #2
```
2
1 1
2 1

```
### 样例输入 #3
```
4
1 19 1
3 10
3 10
3 10

```
### 样例输出 #3
```
1
1 10
1
1 9
0

```
## 提示

### 【数据范围】

|$\text{Subtask}$|分值|特殊性质|
|:-:|:-:|:-:|
|$0$|$0$|样例|
|$1$|$12$|$q\le1000$|
|$2$|$7$|$s=1,w=0$，没有 `leave` 操作|
|$3$|$20$|$s\le10,w=0$，没有 `leave` 操作|
|$4$|$16$|$s\le10$，没有 `leave` 操作|
|$5$|$10$|$s\le10$|
|$6$|$35$|无特殊性质|

对于 $100\%$ 的数据：

- $1 \le q \le 200000$

- 对于所有 `join` 操作，$1 \le s \le 200000,0 \le w \le 1$。

- 对于所有 `leave` 操作，保证所有 $i$ 在操作时都在队列中。

- 对于所有 `board` 操作，$1 \le b \le 10^{12}$。

- 至少有一次 `board` 操作。


---

---
title: "[NOISG 2024 Prelim] Explosives"
layout: "post"
diff: 省选/NOI-
pid: P10712
tag: ['动态规划 DP', '2024', 'Special Judge', 'NOISG（新加坡）']
---
# [NOISG 2024 Prelim] Explosives
## 题目背景

翻译自 [NOI SG 2024 Prelim E.Explosives](https://github.com/noisg/noi-2024-prelim)。
## 题目描述

你是一名运送炸弹的卡车司机。

有 $n$ 座工厂（生产炸弹）和 $n$ 座矿井（需要炸弹）排列在一条直线上。第 $i$ 座工厂的坐标为 $a_i$，第 $j$ 座矿井的坐标为 $b_j$。并且，所有 $a_i$ 和 $b_j$ 都均不相等。

你今天需要在每一座工厂各领取一个炸弹，并将每一个炸弹送到某一个矿井中。初始时，你的坐标为 $0$。为了完成此任务，你可以进行以下两种操作：

- `pickup(x)`：从你当前的位置驾驶卡车到坐落在 $x$ 的工厂。执行这次操作需要同时满足以下两个条件：

	- 有一个 $i$，满足 $x=a_i$。
    
   - 你的卡车最多装了 $c-1$ 个炸弹。
   
- `offload(x)`：从你当前的位置驾驶卡车到坐落在 $x$ 的矿井。执行这次操作需要同时满足以下两个条件：

	- 有一个 $j$，满足 $x=b_j$。
    
   - 你的卡车最少装了 $1$ 个炸弹。
   
由于炸弹十分危险，所以在你的卡车上需要一名安全员。如果你从点 $x$ 到点 $y$，且车上装有炸弹，那么你需要付给安全员 $|x-y|$ 元。如果车上没有炸药，则你不需要支付任何费用。

请求出在花费最小的情况下的操作序列。
## 输入格式

第一行，两个整数 $n,c$；

第二行，一行 $n$ 个整数，表示 $a$。

第三行，一行 $n$ 个整数，表示 $b$。
## 输出格式

第一行，一个整数表示最小花费。

第二行，输出 $2n$ 个整数，表示你访问的工厂和矿井坐标，按照访问顺序输出。

例如你执行了四次操作：`pickup(3)`，`offload(5)`，`pickup(6)`，`offload(2)`，则你应该输出 `3 5 6 2`。
## 样例

### 样例输入 #1
```
3 2
12 14 4
9 5 8

```
### 样例输出 #1
```
7
4 5 14 12 9 8
```
## 提示

### 【样例 #1 解释】

按照顺序访问工厂 $3$，矿井 $2$，工厂 $2$，工厂 $1$，矿井 $1$，矿井 $3$，即可得到最小值 $7$。

以此样例为例，如果你只输出正确的最小代价 $7$，你将可以得到该测试点 $50\%$ 的分数。

### 【数据范围】

|$\text{Subtask}$|分值|特殊性质|
|:-:|:-:|:-:|
|$0$|$0$|样例|
|$1$|$16$|$c=1$|
|$2$|$22$|$a_i\le 5000,b_i>5000$|
|$3$|$62$|无|

对于 $100\%$ 的数据，$1 \le n,c \le 1000,1 \le a_i,b_i \le 10000$。


---

---
title: "[NOISG 2021 Qualification] Departure"
layout: "post"
diff: 省选/NOI-
pid: P10772
tag: ['2021', 'NOISG（新加坡）']
---
# [NOISG 2021 Qualification] Departure
## 题目描述

有一个城市，城市里有 $N$ 条路线，每条路线上，在每天午夜会有一辆巴士从起点出发，第二天午夜到达终点。第 $i$ 辆公交车的起点为 $S_i$，终点为 $E_i$。人们可以在巴士路线上的的**任何地方**上车、下车或者换乘。

体育馆是这个城市的中心，坐标为 $0$。在体育馆西边 $x$ 千米的点，坐标为 $-x$，在体育馆东边 $x$ 千米的点，坐标为 $x$。

现在有 $M$ 个人需要从体育馆回家，你需要求出每一个人回家的最短时间。
## 输入格式

第 $1$ 行两个整数 $N,M$。

第 $2$ 至 $N+1$ 行，每行两个整数 $S_i,E_i$。

第 $N+2$ 行 $M$ 个整数 $P_j$，表示每一个人的家。
## 输出格式

$M$ 行，每行两个整数 $a,b$（$\gcd(a,b)=1$），表示这个人最早能在 $\dfrac{a}{b}$ 天后回家。
## 样例

### 样例输入 #1
```
5 8
0 5
3 11
1 -8
4 10
1 -3
1 2 5 6 8 -3 -7 11
```
### 样例输出 #1
```
1 5
2 5
1 1
4 3
13 8
4 9
8 9
2 1
```
### 样例输入 #2
```
3 2
-1 4
-2 5
0 -5
4 -4
```
### 样例输出 #2
```
6 7
4 5
```
### 样例输入 #3
```
5 3
0 2
2 4
4 6
6 8
8 10
9 10 10
```
### 样例输出 #3
```
9 2
5 1
5 1
```
## 提示

#### 数据范围

**本题采用捆绑测试。**

以下定义 $\operatorname{sign}(x) = \begin{cases}
1 &\text{if } x > 0 \\
0 &\text{if } x = 0 \\
-1 &\text{if } x < 0 \\
\end{cases}$。

Subtask0 为样例。

Subtask1（10 pts）$N \leq 10^4$，$M \leq 10^3$，$\operatorname{sign}(S_i)\neq\operatorname{sign}(E_i)$。

Subtask2（14 pts）$N \leq 100$，$M \leq 10^3$。

Subtask3（12 pts）$N \leq 10^3$，$M \leq 10^5$，保证最后答案的值均不大于 $10^3$，保证任意坐标在不超过 $10^2$ 条线路上。

Subtask4（8 pts）$M \leq 10^3$，保证任意坐标在不超过 $10^4$ 条线路上。

Subtask5（15 pts）$M \leq 10^4$，保证最后答案的值均不大于 $10^2$。

Subtask6（13 pts）$\operatorname{sign}(S_i)\neq\operatorname{sign}(E_i)$。

Subtask7（28 pts）无特殊限制。

数据保证 $1 \leq N,M \leq 10^6$，$-10^6 \leq S_i,E_i,P_j \leq 10^6$，$S_i \neq E_i$，$P_j \neq 0$。


---

---
title: "[NOISG 2021 Qualification] Truck"
layout: "post"
diff: 省选/NOI-
pid: P10773
tag: ['2021', 'NOISG（新加坡）']
---
# [NOISG 2021 Qualification] Truck
## 题目描述

有一棵树，每条边有两个权值 $D_i$ 和 $T_i$，给定 $Q$ 次操作。操作分为两种：

`0 x y t`：表示把 $x$ 和 $y$ 之间的一条道路的 $T_i$ 值改为 $t$。

`1 x y`：表示查询 $x$ 到 $y$ 的费用。

定义 $x$ 到 $y$ 的费用为：给定参数 $G$（对每组询问都相同），要求 $x$ 运送一些价值到 $y$，每经过一条权值为 $D_i$ 和 $T_i$ 的边，运送的价值会减少 $T_i$，然后会产生运送的价值的 $D_i$ 倍的费用。在运送到 $y$ 节点时，若运送到的价值刚好为 $G$，产生的费用就为 $x$ 到 $y$ 的费用。

你要对每组询问计算费用。由于费用可能比较大，请输出对 $10^9+7$ 取模的值。
## 输入格式

第 $1$ 行两个整数 $N,G$。

第 $2 \sim N$ 行，每行四个整数 $A_i,B_i,D_i,T_i$，表示树上 $A_i$ 和 $B_i$ 有一条边，边权为 $D_i$ 和 $T_i$。

第 $N+1$ 行一个整数 $Q$，表示操作个数。

下面 $Q$ 行，每行一个操作，格式见上。
## 输出格式

若干行，对于每个查询操作，你需要求出费用。每行一个回答。
## 样例

### 样例输入 #1
```
6 2
1 2 2 1
2 3 1 2
2 4 2 3
4 5 2 2
4 6 1 4
3
1 3 6
0 4 5 5
1 2 5

```
### 样例输出 #1
```
23
18
```
### 样例输入 #2
```
4 3
1 2 3 0
2 3 1 0
3 4 4 0
1
1 1 4
```
### 样例输出 #2
```
24
```
## 提示

#### 数据范围

**本题采用捆绑测试。**

Subtask0 为样例。

Subtask1（5 pts）只有查询操作，每个节点度不超过 $2$，且 $T_i=0$。

Subtask2（9 pts）只有查询操作，且 $T_i = 0$。

Subtask3（12 pts）只有查询操作，$D_i=1$，且所有 $T_i$ 相等。

Subtask4（17 pts）只有查询操作，且每个节点度不超过 $2$。

Subtask5（20 pts）每个节点度不超过 $2$。

Subtask6（18 pts）$N,Q \leq 5000$。

Subtask7（19 pts）无特殊限制。

数据保证 $2 \leq N \leq 10^5$，$1 \leq Q \leq 10^5$，$1 \leq A_i,B_i \leq N$，$1 \leq D_i,T_i,G \leq 10^9$。


---

---
title: "[NOI2024] 集合"
layout: "post"
diff: 省选/NOI-
pid: P10785
tag: ['2024', 'NOI', 'O2优化']
---
# [NOI2024] 集合
## 题目描述

小 Y 和小 S 在玩一个游戏。

给定正整数 $m$，定义**基本集合**为大小为 $3$，元素在 $1\sim m$ 内的集合。例如：给定 $m=4$，则集合 $\{1,2,3\}$ 与集合 $\{2,3,4\}$ 都是基本集合。

定义**集合序列**为由基本集合构成的序列，例如，$A=[\{1,2,3\},\{2,3,4\}]$ 是一个集合序列，其中 $A[1]=\{1,2,3\}$，$A[2]=\{2,3,4\}$ 都是基本集合。

对于一个 $1\sim m$ 的排列 $p[1],p[2],\dots,p[m]$ 与集合 $S\subseteq \{1,2,\dots,m\}$，定义 $f_p(S)$ 为将 $S$ 内每一个元素 $x$ 置换为 $p[x]$ 后所得到的集合，即 $f_p(S)=\{p[x]|x\in S\}$。

对于两个长度为 $k$ 的集合序列 $A,B$，定义 $A$ 和 $B$ **等价**当且仅当存在一个 $1\sim m$ 的排列 $p$，使得 $A$ 置换排列 $p$ 后得到 $B$，即对于所有 $1\leq i\leq k$，$f_p(A[i])=B[i]$。

给定两个长度为 $n$ 的集合序列 $A,B$，有 $q$ 次询问。每次小 S 会询问小 Y，在给定 $l,r$ 的情况下，判断集合序列 $[A[l],A[l+1],\dots,A[r]]$ 与集合序列 $[B[l],B[l+1],\dots,B[r]]$ 是否等价。

时光荏苒，小 S 和小 Y 也会散去。而我们和一个人保持连接的方式就是记住，仅此而已。
## 输入格式

输入的第一行包含三个正整数 $n,m,q$，分别表示集合序列的长度，元素范围和询问次数。

输入的第二行包含 $3n$ 个正整数，第 $3i-2,3i-1,3i$（$1\leq i\leq n$）个正整数分别表示 $A[i]$ 的三个元素。保证这三个元素均在 $[1,m]$ 范围内且互不相同。

输入的第三行包含 $3n$ 个正整数，第 $3i-2,3i-1,3i$（$1\leq i\leq n$）个正整数分别表示 $B[i]$ 的三个元素。保证这三个元素均在 $[1,m]$ 范围内且互不相同。

接下来 $q$ 行，每行包含两个正整数 $l,r$，表示一次询问。
## 输出格式

输出 $q$ 行，每行包含一个字符串 $\tt{Yes}$ 或 $\tt{No}$，表示对应询问的两个序列是否等价。
## 样例

### 样例输入 #1
```
4 4 10
1 2 3 1 2 3 1 2 4 1 2 3
1 2 4 2 3 4 1 2 3 2 3 4
1 1
1 2
1 3
1 4
2 2
2 3
2 4
3 3
3 4
4 4
```
### 样例输出 #1
```
Yes
No
No
No
Yes
Yes
Yes
Yes
Yes
Yes
```
### 样例输入 #2
```
见 set2.in/ans
这个样例满足测试点 1-3 的约束条件。
```
### 样例输出 #2
```

```
### 样例输入 #3
```
见 set3.in/ans
这个样例满足测试点 8 的约束条件。
```
### 样例输出 #3
```

```
### 样例输入 #4
```
见 set4.in/ans
这个样例满足测试点 15、16 的约束条件。
```
### 样例输出 #4
```

```
## 提示

**【样例 1 解释】**

以下用 $(l,r)$ 表示对 $l,r$ 的询问：
- 对于询问 $(1,1)$，令排列 $p=[1,2,4,3]$，则 $f_p(A_1)=\{p[1],p[2],p[3]\}=\{1,2,4\}=B[1]$，因此该询问对应的两个序列等价。
- 对于询问 $(1,2),(1,3),(1,4)$，由于 $A[1]=A[2]$ 但 $B[1]\neq B[2]$，因此这些询问对应的两个序列都不等价。
- 对于询问 $(2,2),(2,3),(2,4),(3,3),(3,4),(4,4)$，令排列 $p=[2,3,4,1]$，则 $f_p(A_2)=\{p[1],p[2],p[3]\}=\{2,3,4\}=B_2$，$f_p(A_3)=\{p[1],p[2],p[4]\}=\{1,2,3\}=B_3$，$f_p(A_4)=\{p[1],p[2],p[3]\}=\{2,3,4\}=B_4$，因此这些询问对应的两个序列都等价。

**【数据范围】**

对于所有测试数据保证：$1\leq n\leq 2\times 10^5$，$3\leq m\leq 6\times 10^5$，$1\leq q\leq 10^6$，$1\leq l\leq r\leq n$。

| 测试点编号 | $n\leq$ | $m\leq$ | $q\leq$ |
| :----------: | :----------: | :----------: | :----------: |
| $1\sim 3$ | $50$ | $4$ | $50$ |
| $4\sim 6$ | $50$ | $5$ | $50$ |
| $7$ | $200$ | $4$ | $200$ |
| $8$ | $200$ | $5$ | $200$ |
| $9$ | $200$ | $4$ | $2\times 10^5$ |
| $10$ | $200$ | $5$ | $2\times 10^5$ |
| $11$ | $2\times 10^5$ | $4$ | $2\times 10^5$ |
| $12$ | $2\times 10^5$ | $5$ | $2\times 10^5$ |
| $13,14$ | $2\,000$ | $6\,000$ | $10^3$ |
| $15,16$ | $2\,000$ | $6\,000$ | $10^6$ |
| $17,18$ | $2\times 10^4$ | $6\times 10^4$ | $10^2$ |
| $19,20$ | $2\times 10^5$ | $6\times 10^5$ | $10^6$ |



---

---
title: "[NOI2024] 百万富翁"
layout: "post"
diff: 省选/NOI-
pid: P10786
tag: ['2024', 'NOI', '交互题', 'Special Judge', 'O2优化']
---
# [NOI2024] 百万富翁
## 题目背景

**本题仅支持 C++ 语言评测。由于平台限制，使用 C++14 (GCC 9) 提交代码会导致 CE。请使用其他版本的 C++ 提交（推荐 C++14 及以上）。**

与 NOI 要求的提交格式不同，你的程序中**不应该**包含头文件 `richest.h`。同时，你的程序中应当在包含 `vector` 头文件的前提下，包含对以下函数的声明：

```cpp
std::vector<int> ask(std::vector<int> a, std::vector<int> b);
```

除此之外，其余要求与 NOI 要求一致。
## 题目描述

小 Y 的银行有 $N$ 个客户，编号为 $0$ 到 $N-1$。客户 $i$ 有 $W_i$ 元存款，且**客户之间的存款金额互不相同**。

小 P 是小 Y 的深度合作伙伴，他希望知道哪个客户的存款最多。小 P 无法直接获取客户的存款金额，但他可以依次发送若干次**请求**，每次请求包含若干个**查询**，每个查询是一个二元组 $(i,j)$，表示小 P 想知道客户 $i$ 和客户 $j$ 的存款金额哪个更多。如果 $W_i>W_j$，小 Y 会回答 $i$，否则回答 $j$。

小 P 的**请求数** $t$ 和所有请求的**查询**次数总和 $s$ 有上限，他希望你帮他写一个程序，来找到存款最多的客户。
## 输入格式

选手不需要，也不应该实现 main 函数。

选手应确保提交的程序包含头文件 `richest.h`，可在程序开头加入以下代码实现：

```cpp
#include "richest.h"
```

选手需要实现以下函数：
```cpp
int richest(int N,int T,int S);
```
- $N$ 表示客户的数量；
- $T$ 表示对于当前函数调用，**请求**数 $t$ 不应超过此值；
- $S$ 表示对于当前函数调用，所有请求的**查询**次数总和 $s$ 不应超过此值；
- 该函数需要返回存款最多的客户的编号；
- 对于每个测试点，该函数**会被交互库调用恰好 $10$ 次**；

选手可以通过调用以下函数向交互库发送一次**请求**：
```cpp
std::vector <int> ask(std::vector <int> a, std::vector <int> b);
```
- 在调用 `ask` 函数时需要保证传入参数 $a$ 和 $b$ 的长度相同，且其中的每个元素都必须是小于 $N$ 的非负整数，表示该**请求**中的所有**查询**。
- 该函数会返回一个类型为 `std::vector <int>` 且长度与 $a$ 和 $b$ 相同的变量，设为 $c$，其中 $c[i]$ 表示在客户 $a[i]$ 和 $b[i]$ 中存款较多的客户的编号。

题目保证在规定的**请求**和**查询**次数限制下，交互库运行的时间不超过 $3$ 秒，交互库使用的内存大小固定，且不超过 $256$ MiB。

**试题目录下的 `grader.cpp` 是提供的交互库参考实现，最终测试所用的交互库与该参考实现有所不同，因此选手的解法不应该依赖交互库实现。**

选手可以在本题目录下使用如下命令编译得到可执行程序：

```
g++ grader.cpp richest.cpp -o richest -O2 -std=c++14 -static
```

对于编译得到的可执行程序：
- 可执行文件将从**标准输入**读入以下格式的数据：
  - 输入的第一行包含四个非负整数 $N,T,S,R$，其中 $R$ 是交互库生成测试数据的随机种子。
- 输入完成后，交互库将调用 $10$ 次函数 `richest`，用输入的参数生成的测试数据进行测试。`richest` 函数返回后，交互库会输出以下信息：
  - 输出的前 $10$ 行中，每行首先包含三个整数 $r,t,s$，表示该次执行的结果。其中 $r$ 是 `richest` 函数的返回值，$t$ 和 $s$ 的含义如题目描述中所示，然后包含该次运行的正确性等消息。
  - 输出的第 $11$ 行包含 $10$ 次运行的总信息。
## 输出格式

假设可执行文件生成的测试数据为 $N=4$，$W=[101,103,102,100]$，$T=100$，$S=100$，下面是一个正确的交互过程：

| 选手程序 | 交互库 | 说明 |
| :----------: | :----------: | :----------: |
|  | 调用 `richest(4,100,100)` | 开始测试 |
| 调用 `ask([0,2],[1,3])` | 返回 $[1,2]$ | $W_0<W_1,W_2>W_3$ |
| 调用 `ask([0,2,3],[1,1,1])` | 返回 $[1,1,1]$ | $W_0<W_1,W_2<W_1,W_3<W_1$ |
| 运行结束并返回 $1$ | 向屏幕打印交互结果 | 交互结束，结果正确 |

在这个例子中，$r=1,t=2,s=5$ 满足请求与查询次数的限制。
## 提示

**【下发文件说明】**

在本试题目录下：
- `grader.cpp` 是提供的交互库参考实现。
- `richest.h` 是头文件，选手不用关心具体内容。
- `template_richest.cpp` 是提供的示例代码，选手可在此代码的基础上实现。

选手注意对所有下发文件做好备份，最终评测时只测试本试题目录下的 `richest.cpp`，对该程序以外文件的修改不会影响评测结果。

**【数据范围】**

对于所有测试数据保证：所有 $W_i$ 两两不同。

本题共 $2$ 个测试点，每个测试点的分值和数据范围见下表。

| 测试点编号 | 分值 | $N=$ | $T=$ | $S=$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $15$ | $1\,000$ | $1$ | $499\,500$ |
| $2$ | $85$ | $1\,000\,000$ | $20$ | $2\,000\,000$ |

**【评分方式】**

注意：
- 选手不应通过非法方式获取交互库的内部信息，如试图直接读取数组 $W$ 的值，或直接与标准输入、输出流进行交互。此类行为将被视为作弊。
- **最终的评测交互库与样例交互库的实现不同，且可能是适应性的：在不与 `ask` 此前返回的结果相矛盾的前提下，最终的评测交互库可能会动态调整 $W$ 的值。**

**本题首先会受到和传统相同的限制**。例如编译错误会导致整道题目得 $0$ 分，运行时错误、超过时间限制、超过空间限制都会导致相应测试点得 0 分。选手只能在程序中访问自己定义的和交互库给出的变量或数据，及其相应的内存空间。尝试访问其他位置空间将可能导致编译错误或运行错误。

在每次 `richest` 函数调用中，程序使用的请求次数 $t$ 和所有请求的查询次数总和 $s$ 需在对应限制下，否则将会获得 $0$ 分。

在上述条件基础上：
- 在测试点 $1$ 中，程序得到满分当且仅当 `ask` 函数调用合法且 `richest` 函数返回的答案正确；
- 在测试点 $2$ 中，程序得到的分数将按照以下方式计算：
  - 若 `ask` 函数调用不合法，则获得 $0$ 分；
  - 若 `ask` 函数调用均合法，设 $\max t$ 表示多次调用 `richest` 函数所得的 $t$ 的最大值，$\max s$ 表示 $s$ 的最大值，则程序将获得 $\lfloor 85 \cdot f(\max t) \cdot g(\max s)\rfloor$ 分，其中 $f$ 与 $g$ 的计算方式如下表所示：
  
| $\max t$ | $f(\max t)$ |
| :----------: | :----------: |
| $\max t\leq 8$ | $1$ |
| $9\leq \max t\leq 20$ | $1-\dfrac{1}{4}\sqrt{\max t-8}$ |

| $\max s$ | $g(\max s)$ |
| :----------: | :----------: |
| $\max s\leq 1\,099\,944$ | $1$ |
| $1\,099\,945\leq \max s\leq 1\,100\,043$ | $1-\dfrac{1}{6} \log_{10} (\max s-1\,099\,943)$ |
| $1\,100\,044\leq \max s\leq 2\,000\,000$ | $\dfrac{2}{3}-\dfrac{1}{1\,500}\sqrt{\max s-1\,100\,043}$|

以下是测试点 $2$ 中，不同的 $t$ 和 $s$ 对得分影响的示例。

| $\max t$ |            $\max s$            | 测试点 $2$ 的得分 |
| :------: | :----------------------------: | :---------------: |
|  $=20$   |       $\le 1\,099\,944$        |       $11$        |
|  $=19$   |       $\le 1\,099\,944$        |       $14$        |
|  $=18$   |       $\le 1\,099\,944$        |       $17$        |
|  $=17$   |       $\le 1\,099\,944$        |       $21$        |
|  $=16$   |       $\le 1\,099\,944$        |       $24$        |
|  $=15$   |       $\le 1\,099\,944$        |       $28$        |
|  $=14$   |       $\le 1\,099\,944$        |       $32$        |
|  $=13$   |       $\le 1\,099\,944$        |       $37$        |
|  $=12$   |       $\le 1\,099\,944$        |       $42$        |
|  $=11$   |       $\le 1\,099\,944$        |       $48$        |
|  $=10$   |       $\le 1\,099\,944$        |       $54$        |
|   $=9$   |       $\le 1\,099\,944$        |       $63$        |
| $\le 8$  | $\in [1\,099\,974,1\,099\,978]$ |       $63$        |
| $\le 8$  | $\in [1\,099\,969,1\,099\,973]$ |       $64$        |
| $\le 8$  | $\in [1\,099\,965,1\,099\,968]$ |       $65$        |
| $\le 8$  | $\in [1\,099\,962,1\,099\,964]$ |       $66$        |
| $\le 8$  | $\in [1\,099\,959,1\,099\,961]$ |       $67$        |
| $\le 8$  | $\in [1\,099\,957,1\,099\,958]$ |       $68$        |
| $\le 8$  | $\in [1\,099\,955,1\,099\,956]$ |       $69$        |
| $\le 8$  | $\in [1\,099\,953,1\,099\,954]$ |       $70$        |
| $\le 8$  |         $=1\,099\,952$          |       $71$        |
| $\le 8$  |         $=1\,099\,951$          |       $72$        |
| $\le 8$  | $\in [1\,099\,949,1\,099\,950]$ |       $73$        |
| $\le 8$  |         $=1\,099\,948$          |       $75$        |
| $\le 8$  |         $=1\,099\,947$          |       $76$        |
| $\le 8$  |         $=1\,099\,946$          |       $78$        |
| $\le 8$  |         $=1\,099\,945$          |       $80$        |
| $\le 8$  |       $\le 1\,099\,944$        |       $85$        |


---

---
title: "[NOIP 2012 提高组] 开车旅行"
layout: "post"
diff: 省选/NOI-
pid: P1081
tag: ['2012', '倍增', 'NOIP 提高组']
---
# [NOIP 2012 提高组] 开车旅行
## 题目描述

小 $\text{A}$ 和小 $\text{B}$ 决定利用假期外出旅行，他们将想去的城市从 $1 $ 到 $n$ 编号，且编号较小的城市在编号较大的城市的西边，已知各个城市的海拔高度互不相同，记城市 $i$ 的海拔高度为$h_i$，城市 $i$ 和城市 $j$ 之间的距离 $d_{i,j}$ 恰好是这两个城市海拔高度之差的绝对值，即 $d_{i,j}=|h_i-h_j|$。
 
旅行过程中，小 $\text{A}$ 和小 $\text{B}$ 轮流开车，第一天小 $\text{A}$ 开车，之后每天轮换一次。他们计划选择一个城市 $s$ 作为起点，一直向东行驶，并且最多行驶 $x$ 公里就结束旅行。    

小 $\text{A}$ 和小 $\text{B}$ 的驾驶风格不同，小 $\text{B}$ 总是沿着前进方向选择一个最近的城市作为目的地，而小 $\text{A}$ 总是沿着前进方向选择第二近的城市作为目的地（注意：本题中如果当前城市到两个城市的距离相同，则认为离海拔低的那个城市更近）。如果其中任何一人无法按照自己的原则选择目的城市，或者到达目的地会使行驶的总距离超出 $x$ 公里，他们就会结束旅行。

在启程之前，小 $\text{A}$ 想知道两个问题：

1、 对于一个给定的 $x=x_0$，从哪一个城市出发，小 $\text{A}$ 开车行驶的路程总数与小 $\text{B}$ 行驶的路程总数的比值最小（如果小 $\text{B}$ 的行驶路程为 $0$，此时的比值可视为无穷大，且两个无穷大视为相等）。如果从多个城市出发，小 $\text{A}$ 开车行驶的路程总数与小 $\text{B}$ 行驶的路程总数的比值都最小，则输出海拔最高的那个城市。

2、对任意给定的 $x=x_i$ 和出发城市 $s_i$，小 $\text{A}$ 开车行驶的路程总数以及小 $\text B$ 行驶的路程总数。

## 输入格式

第一行包含一个整数 $n$，表示城市的数目。

第二行有 $n$ 个整数，每两个整数之间用一个空格隔开，依次表示城市 $1$ 到城市 $n$ 的海拔高度，即 $h_1,h_2 ... h_n$，且每个 $h_i$ 都是互不相同的。

第三行包含一个整数 $x_0$。

第四行为一个整数 $m$，表示给定 $m$ 组 $s_i$ 和 $x_i$。

接下来的 $m$ 行，每行包含 $2$ 个整数 $s_i$ 和 $x_i$，表示从城市$s_i$ 出发，最多行驶 $x_i$ 公里。
## 输出格式

输出共 $m+1$ 行。

第一行包含一个整数 $s_0$，表示对于给定的 $x_0$，从编号为 $s_0$ 的城市出发，小 $\text A$ 开车行驶的路程总数与小 $\text B$ 行驶的路程总数的比值最小。

接下来的 $m$ 行，每行包含 $2$ 个整数，之间用一个空格隔开，依次表示在给定的 $s_i$ 和 $x_i$ 下小 $\text A$ 行驶的里程总数和小 $\text B$ 行驶的里程总数。

## 样例

### 样例输入 #1
```
4 
2 3 1 4 
3 
4 
1 3 
2 3 
3 3 
4 3

```
### 样例输出 #1
```
1 
1 1 
2 0 
0 0 
0 0 
```
### 样例输入 #2
```
10 
4 5 6 1 2 3 7 8 9 10 
7 
10 
1 7 
2 7 
3 7 
4 7 
5 7 
6 7 
7 7 
8 7 
9 7 
10 7
```
### 样例输出 #2
```
2 
3 2 
2 4 
2 1 
2 4 
5 1 
5 1 
2 1 
2 0 
0 0 
0 0
```
## 提示

【样例1说明】

![](https://cdn.luogu.com.cn/upload/image_hosting/zgms0k7y.png)

各个城市的海拔高度以及两个城市间的距离如上图所示。

如果从城市 $1$ 出发，可以到达的城市为 $2,3,4$，这几个城市与城市 $1$ 的距离分别为 $1,1,2$，但是由于城市 $3$ 的海拔高度低于城市 $2$，所以我们认为城市 $3$ 离城市 $1$ 最近，城市 $2$ 离城市 $1$ 第二近，所以小A会走到城市 $2$。到达城市 $2$ 后，前面可以到达的城市为 $3,4$，这两个城市与城市 $2$  的距离分别为 $2,1$，所以城市 $4$ 离城市 $2$ 最近，因此小B会走到城市$4$。到达城市 $4$ 后，前面已没有可到达的城市，所以旅行结束。

如果从城市 $2$ 出发，可以到达的城市为 $3,4$，这两个城市与城市 $2$ 的距离分别为 $2,1$，由于城市 $3$ 离城市 $2$ 第二近，所以小 $\text A$ 会走到城市 $3$。到达城市 $3$ 后，前面尚未旅行的城市为 $4$，所以城市 $4$ 离城市 $3$ 最近，但是如果要到达城市 $4$，则总路程为 $2+3=5>3$，所以小 $\text B$ 会直接在城市 $3$ 结束旅行。

如果从城市 $3$ 出发，可以到达的城市为 $4$，由于没有离城市 $3$ 第二近的城市，因此旅行还未开始就结束了。

如果从城市 $4$ 出发，没有可以到达的城市，因此旅行还未开始就结束了。


【样例2说明】

当 $x=7$ 时，如果从城市 $1$ 出发，则路线为 $1 \to 2 \to 3 \to 8 \to 9$，小 $\text A$ 走的距离为 $1+2=3$，小 $\text B$ 走的距离为 $1+1=2$。（在城市 $1$ 时，距离小 $\text A$ 最近的城市是 $2$ 和 $6$，但是城市 $2$ 的海拔更高，视为与城市 $1$ 第二近的城市，所以小 $\text A$ 最终选择城市 $2$；走到$9$ 后，小 $\text A$ 只有城市 $10$ 可以走，没有第二选择可以选，所以没法做出选择，结束旅行）

如果从城市 $2$ 出发，则路线为 $2 \to 6 \to 7$，小 $\text A$ 和小 $\text B$ 走的距离分别为 $2,4$。

如果从城市 $3$ 出发，则路线为 $3 \to 8 \to 9$，小 $\text A$ 和小 $\text B$ 走的距离分别为$2,1$。

如果从城市 $4$ 出发，则路线为 $4 \to 6 \to 7$，小 $\text A$ 和小 $\text B$ 走的距离分别为 $2,4$。

如果从城市 $5$ 出发，则路线为 $5 \to 7 \to 8$，小 $\text A$ 和小 $\text B$ 走的距离分别为 $5,1$。

如果从城市 $6$ 出发，则路线为 $6 \to 8 \to 9$，小 $\text A$ 和小 $\text B$ 走的距离分别为$5,1$。

如果从城市 $7$ 出发，则路线为 $7 \to 9 \to 10$，小 $\text A$ 和小 $\text B$ 走的距离分别为$2,1$。

如果从城市 $8$ 出发，则路线为 $8 \to 10$，小 $\text A$ 和小 $\text B$ 走的距离分别为$2,0$。

如果从城市 $9$ 出发，则路线为 $9$，小 $\text A$ 和小 $\text B$ 走的距离分别为 $0,0$（旅行一开始就结束了）。

如果从城市 $10$ 出发，则路线为 $10$，小 $\text A$ 和小 $\text B$ 走的距离分别为$0,0$。

从城市 $2$ 或者城市 $4$ 出发小 $\text A$ 行驶的路程总数与小 $\text B$ 行驶的路程总数的比值都最小，但是城市 $2$ 的海拔更高，所以输出第一行为 $2$。

【数据范围与约定】  

对于 $30\%$ 的数据，有$1\le n \le 20,1\le m\le 20$；  
对于$40\%$ 的数据，有$1\le n \le 100,1\le m\le 100$；  
对于 $50\%$ 的数据，有$1\le n \le 100,1\le m\le 1000$；  
对于 $70\%$ 的数据，有$1\le n \le 1000,1\le m\le 10^4$；   
对于 $100\%$ 的数据：$1\le n,m \le 10^5$，$-10^9 \le h_i≤10^9$，$1 \le s_i \le n$，$0 \le x_i \le 10^9$   
数据保证 $h_i$ 互不相同。



---

---
title: "[NOIP 2012 提高组] 疫情控制"
layout: "post"
diff: 省选/NOI-
pid: P1084
tag: ['贪心', '树形数据结构', '2012', '倍增', '二分', 'NOIP 提高组', '排序']
---
# [NOIP 2012 提高组] 疫情控制
## 题目描述

H 国有 $n $ 个城市，这 $n$ 个城市用 $ n-1 $ 条双向道路相互连通构成一棵树，$1 $ 号城市是首都，也是树中的根节点。

H 国的首都爆发了一种危害性极高的传染病。当局为了控制疫情，不让疫情扩散到边境城市（叶子节点所表示的城市），决定动用军队在一些城市建立检查点，使得从首都到边境城市的每一条路径上都至少有一个检查点，边境城市也可以建立检查点。但特别要注意的是，首都是不能建立检查点的。

现在，在 H 国的一些城市中已经驻扎有军队，且一个城市可以驻扎多个军队。一支军队可以在有道路连接的城市间移动，并在除首都以外的任意一个城市建立检查点，且只能在一个城市建立检查点。一支军队经过一条道路从一个城市移动到另一个城市所需要的时间等于道路的长度（单位：小时）。

请问最少需要多少个小时才能控制疫情。注意：不同的军队可以同时移动。

## 输入格式

第一行一个整数 $ n$，表示城市个数。

接下来的 $n-1$ 行，每行 $ 3 $ 个整数，$u,v,w$，每两个整数之间用一个空格隔开，表示从城市 $u $ 到城市 $ v$ 有一条长为 $w$ 的道路。数据保证输入的是一棵树，且根节点编号为 $1$。

接下来一行一个整数 $m$，表示军队个数。

接下来一行 $m $ 个整数，每两个整数之间用一个空格隔开，分别表示这 $m$ 个军队所驻扎的城市的编号。

## 输出格式

一个整数，表示控制疫情所需要的最少时间。如果无法控制疫情则输出 $-1$。

## 样例

### 样例输入 #1
```
4 
1 2 1 
1 3 2 
3 4 3 
2 
2 2
```
### 样例输出 #1
```
3
```
## 提示

【输入输出样例说明】

第一支军队在 $2$ 号点设立检查点，第二支军队从 $2$ 号点移动到$ 3$ 号点设立检查点，所需时间为 $3$ 个小时。

 
【数据范围】

保证军队不会驻扎在首都。

- 对于 $20\%$ 的数据，$2 \le n\le 10$；
- 对于 $40\%$ 的数据，$2 \le n\le 50$，$0<w <10^5$；
- 对于 $60\%$ 的数据，$2 \le n\le 1000$，$0<w <10^6$；
- 对于 $80\%$ 的数据，$2 \le n\le 10^4$；
- 对于 $100\%$ 的数据，$2\le m\le n≤5\times 10^4$，$0<w <10^9$。


NOIP 2012 提高组 第二天 第三题



---

---
title: "[NOI2016] 优秀的拆分"
layout: "post"
diff: 省选/NOI-
pid: P1117
tag: ['字符串', '2016', 'NOI', 'O2优化', '枚举', '后缀数组 SA']
---
# [NOI2016] 优秀的拆分
## 题目描述

如果一个字符串可以被拆分为 $\text{AABB}$ 的形式，其中 $\text{A}$ 和 $\text{B}$ 是任意**非空**字符串，则我们称该字符串的这种拆分是优秀的。  
例如，对于字符串 $ \texttt{aabaabaa} $ ，如果令 $\text{A}=\texttt{aab}$，$\text{B}=\texttt{a}$，我们就找到了这个字符串拆分成 $\text{AABB}$ 的一种方式。

一个字符串可能没有优秀的拆分，也可能存在不止一种优秀的拆分。  
比如我们令 $\text{A}=\texttt{a}$，$\text{B}=\texttt{baa}$，也可以用 $\text{AABB}$ 表示出上述字符串；但是，字符串 $\texttt{abaabaa}$ 就没有优秀的拆分。

现在给出一个长度为 $n$ 的字符串 $S$，我们需要求出，在它所有子串的所有拆分方式中，优秀拆分的总个数。这里的子串是指字符串中连续的一段。

以下事项需要注意：

1. 出现在不同位置的相同子串，我们认为是不同的子串，它们的优秀拆分均会被记入答案。
2. 在一个拆分中，允许出现 $\text{A}=\text{B}$。例如 $\texttt{cccc}$ 存在拆分 $\text{A}=\text{B}=\texttt{c}$。
3. 字符串本身也是它的一个子串。
## 输入格式

每个输入文件包含多组数据。

输入文件的第一行只有一个整数 $T$，表示数据的组数。

接下来 $T$ 行，每行包含一个仅由英文小写字母构成的字符串 $S$，意义如题所述。
## 输出格式

输出 $T$ 行，每行包含一个整数，表示字符串 $S$ 所有子串的所有拆分中，总共有多少个是优秀的拆分。
## 样例

### 样例输入 #1
```
4
aabbbb
cccccc
aabaabaabaa
bbaabaababaaba

```
### 样例输出 #1
```
3
5
4
7

```
## 提示

### 样例解释

我们用 $S[i, j]$ 表示字符串 $S$ 第 $i$ 个字符到第 $j$ 个字符的子串（从 $1$ 开始计数）。

第一组数据中，共有三个子串存在优秀的拆分：  
$S[1,4]=\texttt{aabb}$，优秀的拆分为 $\text{A}=\texttt{a}$，$\text{B}=\texttt{b}$；  
$S[3,6]=\texttt{bbbb}$，优秀的拆分为 $\text{A}=\texttt{b}$，$\text{B}=\texttt{b}$；  
$S[1,6]=\texttt{aabbbb}$，优秀的拆分为 $\text{A}=\texttt{a}$，$\text{B}=\texttt{bb}$。  
而剩下的子串不存在优秀的拆分，所以第一组数据的答案是 $3$。

第二组数据中，有两类，总共四个子串存在优秀的拆分：  
对于子串 $S[1,4]=S[2,5]=S[3,6]=\texttt{cccc}$，它们优秀的拆分相同，均为 $\text{A}=\texttt{c}$，$\text{B}=\texttt{c}$，但由于这些子串位置不同，因此要计算三次；  
对于子串 $S[1,6]=\texttt{cccccc}$，它优秀的拆分有两种：$\text{A}=\texttt{c}$，$\text{B}=\texttt{cc}$ 和 $\text{A}=\texttt{cc}$，$\text{B}=\texttt{c}$，它们是相同子串的不同拆分，也都要计入答案。  
所以第二组数据的答案是 $3+2=5$。

第三组数据中，$S[1,8]$ 和 $S[4,11]$ 各有两种优秀的拆分，其中 $S[1,8]$ 是问题描述中的例子，所以答案是 $2+2=4$。

第四组数据中，$S[1,4]$，$S[6,11]$，$S[7,12]$，$S[2,11]$，$S[1,8]$ 各有一种优秀的拆分，$S[3,14]$ 有两种优秀的拆分，所以答案是 $5+2=7$。

### 数据范围

对于全部的测试点，保证 $1 \leq T \leq 10$。以下对数据的限制均是对于单组输入数据而言的，也就是说同一个测试点下的 $T$ 组数据均满足限制条件。

我们假定 $n$ 为字符串 $S$ 的长度，每个测试点的详细数据范围见下表：

| 测试点编号   | $n \leq$  | 特殊性质           |
| ------------ | --------- | ------------------ |
| $1 \sim 2$   | $300$     | $S$ 中所有字符相同 |
| $3 \sim 4$   | $2\,000$  | $S$ 中所有字符相同 |
| $5 \sim 6$   | $10$      |                    |
| $7 \sim 8$   | $20$      |                    |
| $9 \sim 10$  | $30$      |                    |
| $11 \sim 12$ | $50$      |                    |
| $13 \sim 14$ | $100$     |                    |
| $15$         | $200$     |                    |
| $16$         | $300$     |                    |
| $17$         | $500$     |                    |
| $18$         | $1\,000$  |                    |
| $19$         | $2\,000$  |                    |
| $20$         | $30\,000$ |                    |


---

---
title: "[NOISG 2022 Qualification] Dragonfly"
layout: "post"
diff: 省选/NOI-
pid: P11295
tag: ['2022', '树链剖分', '整体二分', 'NOISG（新加坡）']
---
# [NOISG 2022 Qualification] Dragonfly
## 题目背景

在植物园和碧山公园周围的池塘中，经常可以看到蜻蜓。在一个更密集的森林区域中，Benson 记录了 $n$ 个池塘，以及蜻蜓可以捕食的昆虫数量和种类。

在池塘 $i$，共有 $b_i$ 只昆虫，这些昆虫属于种类 $s_i$。

此外，还有 $n-1$ 条小径，每条小径连接两池塘 $u_j$ 和 $v_j$（双向）。

Benson 抓住了 $d$ 只蜻蜓，并计划依次释放到池塘 $1$。每只蜻蜓有一个目标池塘 $h_k \neq 1$，会沿着最短路径飞到目标池塘，并在经过的每个池塘中捕食昆虫（包括池塘 $1$）。

每次捕食会减少池塘中 $1$ 只昆虫（如果昆虫数量不为 $0$）。需要帮助 Benson 计算每只蜻蜓的飞行过程中捕食到的不同种类昆虫的数量。
## 题目描述

请确定每只蜻蜓的飞行过程中捕食到的不同种类昆虫的数量。
## 输入格式

- 第一行包含两个整数 $n$ 和 $d$，分别表示池塘数量和蜻蜓数量。
- 第二行包含 $n$ 个整数 $b_1, b_2, \dots, b_n$，表示每个池塘的昆虫数量。
- 第三行包含 $n$ 个整数 $s_1, s_2, \dots, s_n$，表示每个池塘昆虫的种类。
- 第四行包含 $d$ 个整数 $h_1, h_2, \dots, h_d$，表示每只蜻蜓的目标池塘。
- 接下来 $n-1$ 行，每行包含两个整数 $u_j$ 和 $v_j$，表示一条连接池塘 $u_j$ 和 $v_j$ 的小径。
## 输出格式

输出一行包含 $d$ 个整数，第 $k$ 个整数表示第 $k$ 只蜻蜓捕食到的不同种类昆虫数量。
## 样例

### 样例输入 #1
```
5 6
4 1 0 3 1
1 3 2 2 1
2 5 4 3 4 2
5 2
2 1
1 4
1 3
```
### 样例输出 #1
```
2 1 2 1 1 0
```
### 样例输入 #2
```
7 4
0 2 4 4 0 1 3
6 1 6 2 2 2 1
7 5 2 4
4 1
4 5
6 2
1 6
1 3
6 7
```
### 样例输出 #2
```
2 1 1 1
```
## 提示

【样例解释】

对于样例 $1$，第一只蜻蜓飞向池塘 $2$，捕食 $1$ 只种类 $1$ 的昆虫和 $1$ 只种类 $2$ 的昆虫。第二只蜻蜓飞向池塘 $5$，捕食种类 $1$ 的昆虫，总共捕食 $1$ 个种类。  

对于样例 $2$，每只蜻蜓飞行后捕食到的不同种类分别是 $2, 1, 1, 1$。

【数据范围】

- $2 \leq n \leq 2 \times 10^5$
- $1 \leq d \leq 2 \times 10^6$
- $1 \leq s_i \leq n$，$0 \leq b_i \leq d$，$1 \leq u_j, v_j < n$

| 子任务编号 | 分值 | 额外限制条件                              |
| :--------: | :--: | :---------------------------------------: |
| $1$        | $10$ | $n, d \leq 1000$                          |
| $2$        | $10$ | $b_i = d$                                 |
| $3$        | $12$ | $b_i \leq 10$                             |
| $4$        | $12$ | $u_j = j$, $v_j = j + 1$                  |
| $5$        | $37$ | $s_i = i$                                 |
| $6$        | $16$ | $d \leq 2 \times 10^5$                    |
| $7$        |  $3$ | 无额外限制                                |


---

---
title: "[NOISG 2021 Finals] Tiles"
layout: "post"
diff: 省选/NOI-
pid: P11302
tag: ['2021', 'NOISG（新加坡）']
---
# [NOISG 2021 Finals] Tiles
## 题目背景

Eustace the Sheep 刚搬进新家，决定翻新他的浴室，因为他实在受不了它单调的内部装饰。目前，浴室的地板是一个 $3 \times N$ 的黑白方格网格。

他有大量相同的 $1 \times 2$ 长方形瓷砖。为了保持浴室的美观，瓷砖可以旋转，但必须平行于墙壁摆放。此外，粘贴瓷砖的胶水不能涂在黑色方格上，因此瓷砖只能放在白色方格上。

## 题目描述

Eustace 想知道，在从第 $a$ 列到第 $b$ 列的区域中，可以形成多少种不同的瓷砖铺设方案（可以不铺瓷砖）。如果两种方案中，某两个方格是否共用一块瓷砖不同，则认为两种方案不同。

在计算铺设方案的同时，Eustace 注意到由于霉菌等问题，部分方格可能会变色（从黑变白，或从白变黑）。

请帮助 Eustace 在不断变化的地板颜色中回答以下问题：
1. 翻转某个方格的颜色。
2. 查询特定区域内可能的瓷砖铺设方案数。

输出结果需要对 $10^9 + 7$ 取模。
## 输入格式

- 第一行包含两个整数 $N$ 和 $Q$，表示浴室地板的列数以及查询和更新操作的总数。
- 接下来 $3$ 行，每行包含一个长度为 $N$ 的字符串，仅由 `.` 和 `x` 组成：
  - `.` 表示白色方格。
  - `x` 表示黑色方格。
- 接下来的 $Q$ 行中，每行有两种格式之一：
  - `1 x y`：表示翻转第 $x$ 行第 $y$ 列的方格颜色。
  - `2 a b`：查询从第 $a$ 列到第 $b$ 列可能的铺设方案数。
## 输出格式

对于每个查询操作（格式为 `2 a b`），输出一个整数表示方案数对 $10^9 + 7$ 取模后的结果。
## 样例

### 样例输入 #1
```
4 5
.x.x
xx..
...x
2 1 4
2 3 3
1 2 3
2 1 4
2 3 3
```
### 样例输出 #1
```
11
3
3
1
```
### 样例输入 #2
```
2 1
..
..
xx
2 1 2
```
### 样例输出 #2
```
7
```
### 样例输入 #3
```
14 2
..............
..............
..............
2 2 11
2 1 14
```
### 样例输出 #3
```
47177097
254767228
```
## 提示

【样例解释】

- 对于样例 $1$，在第一次查询时，可以形成 $11$ 种铺设方案。  
- 在更新操作后，某些区域的方格颜色发生变化，导致后续查询结果也发生改变。

【数据范围】

- $1 \leq N, Q \leq 30000$
- $1 \leq x \leq 3$
- $1 \leq y \leq N$
- $1 \leq a \leq b \leq N$

| 子任务编号 | 分值 | 额外限制条件                |
| :--------: | :--: | :------------------------: |
| $1$        | $17$ | $1 \leq N, Q \leq 8$      |
| $2$        | $23$ | 不存在黑色方格            |
| $3$        | $26$ | $1 \leq N, Q \leq 7000$   |
| $4$        | $34$ | 无额外限制                |


---

---
title: "[NOISG 2022 Finals] Grapevine"
layout: "post"
diff: 省选/NOI-
pid: P11330
tag: ['2022', '树链剖分', 'NOISG（新加坡）']
---
# [NOISG 2022 Finals] Grapevine
## 题目描述

Syrup 有一个巨大的葡萄藤。这个葡萄藤上共有 $N$ 片叶子，用 $1 \sim N$ 编号；这些叶子之间有 $N-1$ 条藤连接。第 $i$ 条藤连接第 $A_i$ 和第 $B_i$ 片叶子，长度为 $W_i$。换句话说，这些叶子和藤组成了一棵树。没有两个葡萄藤的两端相同，且这些叶子之间都可以相互到达。

Syrup 精通养护葡萄藤。他可以向一个叶子 $j$ **浇水**，使得这里飞速生长。如果这片叶子上还没有葡萄，那么浇完水后会立刻长出；如果已经有葡萄了，那么这个葡萄会因为水分过多而消失。

他也可以选择一条树枝，并**改变它的长度**。因为这个葡萄藤实在太大了，所以他需要站在叶子上，并快速**找到**离它距离最近的一个葡萄。

现在，刚刚经历过暴风雨的葡萄藤上没有葡萄。在这一周内，Syrup 打算进行 $Q$ 次以上操作，他想让你帮他快速回答出他的问题。
## 输入格式

第一行，两个整数 $N,Q$；

接下来 $N-1$ 行，每行三个整数 $A_i,B_i,W_i$。

接下来 $Q$ 行，表示 $Q$ 个操作：

- `1 q`：现在 Syrup 站在编号为 $q$ 的叶子上，他想找到离它最近的葡萄，请你输出这个最小距离。

- `2 u`：向编号为 $u$ 的叶子浇水。

- `3 a b w`：将第 $a$ 片叶子和第 $b$ 片叶子之间的树枝长度改为 $w$。
## 输出格式

对于每个 `1` 操作，输出距离的最小值。如果当前没有任何一个葡萄，输出 `-1`。
## 样例

### 样例输入 #1
```
7 11
1 2 2
2 3 4
5 6 1
5 3 6
3 7 6
2 4 9
2 6
2 4
2 7
1 1
3 2 3 0
1 1
3 6 5 0
1 1
3 3 5 0
3 2 4 0
1 1

```
### 样例输出 #1
```
11
8
8
2
```
### 样例输入 #2
```
6 11
1 2 3
1 3 4
2 4 1
2 5 4
3 6 6
2 3
1 2
2 4
3 1 3 2
1 1
2 3
3 2 1 2
2 4
1 3
2 2
1 3

```
### 样例输出 #2
```
7
2
-1
4
```
### 样例输入 #3
```
7 8
1 2 2
2 3 3
3 6 2
4 6 1
5 6 4
6 7 3
2 3
1 4
2 3
2 5
1 1
3 6 7 4
1 5
1 7

```
### 样例输出 #3
```
3
11
0
8
```
## 提示

**【数据范围】**

|$\text{Subtask}$|分值|特殊性质|
|:-:|:-:|:-:|
|$0$|$0$|样例|
|$1$|$6$|$N,Q\le2000$|
|$2$|$14$|对于所有查询操作，保证 $q=1$|
|$3$|$15$|整个葡萄藤是一颗完全二叉树，$A_i=\lfloor\frac{i+1}{2}\rfloor,B_i=i+1$|
|$4$|$15$|在任意时刻整个葡萄藤上都最多只有一个葡萄|
|$5$|$18$|所有 `2` 操作都在 `1` 和 `3` 操作之前，且对于所有 `3` 操作，$w=0$|
|$6$|$32$|无|

对于 $100\%$ 的数据，$2 \le N \le 100000,1 \le Q \le 100000,1 \le A_i \not = B_i \le N,0 \le W_i \le 10^9$。


---

---
title: "[NOISG 2020 Finals] Discharging"
layout: "post"
diff: 省选/NOI-
pid: P11333
tag: ['2020', 'NOISG（新加坡）']
---
# [NOISG 2020 Finals] Discharging
## 题目背景

为了成为最强的电力供应者，Pichuu 这只电鼠开启了一项新业务：使用他最爱的技能 Discharge 为顾客充电。由于业务的高效，Pichuu 每天都有许多顾客排队等待充电。
## 题目描述

在某一天，Pichuu 有 $N$ 名顾客等待充电。Pichuu 可以同时为多部手机充电，每部手机的充电功率相同且恒定。然而，不同型号的手机电池容量不同，因此完全充满所需的时间也不同。第 $i$ 部手机需要 $T_i$ 分钟才能完全充满。

Pichuu 不会停止充电，直到所有手机都充满电。为了避免顾客等待过久，Pichuu 可以将顾客分成若干连续的组，然后按顺序为每组充电。每组中的顾客必须等待前面的组完成充电后，才能开始充电。

对于第 $k$ 组，组内充电所需的时间为该组中 $T_i$ 的最大值（记为 $M_k$）。第 $i$ 名顾客的总等待时间 $W_i$ 是他所在组及其之前所有组的充电时间之和：

$$
W_i = \sum_{n=1}^{G_i} M_n
$$

其中，$G_i$ 表示第 $i$ 名顾客所属的组编号。

Pichuu 希望通过合理分组最小化顾客的总等待时间。你的任务是帮助 Pichuu 计算最小的总等待时间。
## 输入格式

- 第一行包含一个整数 $N$，表示顾客数量。
- 第二行包含 $N$ 个整数，第 $i$ 个整数表示第 $i$ 部手机完全充电所需的时间 $T_i$。
## 输出格式

- 输出一个整数，表示最小的总等待时间。
## 样例

### 样例输入 #1
```
5
1 3 2 6 3
```
### 样例输出 #1
```
27
```
### 样例输入 #2
```
7
1 1 2 2 2 2 2
```
### 样例输出 #2
```
14
```
## 提示

【样例解释】

对于样例 #1：
- 最优分组为 $(1, 3, 2)$ 和 $(6, 3)$。两组的充电时间分别为 $3$ 和 $6$。  
- 第一组的等待时间为 $3$（每名顾客），第二组的等待时间为 $3 + 6 = 9$（每名顾客）。  
- 总等待时间为 $3 + 3 + 3 + 9 + 9 = 27$。

对于样例 #2：
- 最优分组为一个整体，等待时间为 $2$（每名顾客）。  
- 总等待时间为 $2 + 2 + 2 + 2 + 2 + 2 + 2 = 14$。

【数据范围】

- $1 \leq N \leq 10^6$
- $1 \leq T_i \leq 10^9$

| 子任务编号 | 分值 | 限制条件                     |
|:---:|:---:|:---:|
| $1$ | $9$  | $1 \leq N \leq 3$              |
| $2$ | $13$ | $1 \leq N \leq 1500$ 且 $T_i$ 非递减。 |
| $3$ | $25$ | $T_i$ 非递减。                  |
| $4$ | $11$ | $T_i$ 非递增。                  |
| $5$ | $14$ | $1 \leq N \leq 1500$           |
| $6$ | $28$ | 无额外限制。                    |


---

---
title: "[NOISG 2024 Finals] Coin"
layout: "post"
diff: 省选/NOI-
pid: P11352
tag: ['2024', 'NOISG（新加坡）']
---
# [NOISG 2024 Finals] Coin
## 题目描述

Benson 有 $n$ 枚不同重量的硬币和一个天平。每次将硬币 $x$ 和 $y$ 放在天平上，可以知道它们的相对重量，即 $x$ 是否比 $y$ 更重。

硬币 $x$ 的排名（rank）定义为不比它更重的硬币数量（包括自身）。例如，最轻的硬币的排名是 $1$，次轻的是 $2$，最重的是 $n$。

对于每个硬币，当且仅当基于已有的称量结果可以唯一确定其排名时，称其排名被“确定”（determined）。

你的任务是帮助 Benson 找出每个硬币首次确定排名的称量序号，或者判断它的排名永远无法确定。
## 输入格式

- 第一行包含两个用空格分隔的整数 $n$ 和 $m$，表示硬币的数量和称量的次数。
- 接下来的 $m$ 行，每行包含两个整数 $x$ 和 $y$，表示硬币 $x$ 比硬币 $y$ 轻。
## 输出格式

输出 $n$ 个整数。如果硬币 $i$ 的排名在所有 $m$ 次称量后仍未确定，输出 $-1$。否则，输出首次确定排名的称量序号 $k$（$1 \leq k \leq m$）。
## 样例

### 样例输入 #1
```
4 4
2 4
3 1
4 1
2 3
```
### 样例输出 #1
```
3 4 -1 -1
```
### 样例输入 #2
```
6 8
1 5
5 4
6 2
2 5
4 3
6 1
6 5
2 1
```
### 样例输出 #2
```
8 8 5 5 5 6
```
## 提示

【样例解释】

对于样例 #1：
- 硬币 $1$ 的排名在第 $3$ 次称量后确定，输出 $3$。
- 硬币 $2$ 的排名在第 $4$ 次称量后确定，输出 $4$。
- 硬币 $3$ 和 $4$ 的排名无法确定，输出 $-1$。

对于样例 #2：
- 每个硬币的排名确定的时间点分别是 $8$，$8$，$5$，$5$，$5$ 和 $6$。

【数据范围】

- $2 \leq n \leq 200,000$
- $1 \leq m \leq 800,000$
- $1 \leq x, y \leq n$
- 硬币之间的所有称量关系形成一个有效的偏序。

| 子任务编号 | 分值 | 限制条件                     |
|:---:|:---:|:---:|
| $0$ | $0$  | 样例测试用例                     |
| $1$ | $6$  | $1 \leq n \leq 7, 1 \leq m \leq 20$ |
| $2$ | $16$ | $1 \leq n \leq 100, 1 \leq m \leq 400$ |
| $3$ | $10$ | $1 \leq n \leq 1000, 1 \leq m \leq 4000$ |
| $4$ | $68$ | 无额外限制                       |


---

---
title: "[NOIP2024] 树的遍历"
layout: "post"
diff: 省选/NOI-
pid: P11363
tag: ['2024', 'NOIP 提高组']
---
# [NOIP2024] 树的遍历
## 题目描述

小 Q 是一个算法竞赛初学者，正在学习图论知识中的树的遍历。一棵由 $n$ 个结点，$n - 1$ 条边构成的树，初始时所有结点都未被标记，它的遍历过程如下：

1. 选择一个结点 $s$ 作为遍历起始结点，并把该结点打上标记。
2. 假设当前访问的结点为 $u$，寻找任意一个与 $u$ 相邻且未标记的结点 $v$，将 $v$ 作为新的当前访问结点并打上标记。之后再次进入第 $2$ 步。
3. 假设在第 $2$ 步中，与 $u$ 相邻的结点都已被标记，如果 $u = s$ 则遍历过程结束，否则将 $u$ 设为遍历 $u$ 之前的上一个结点并再进入第 $2$ 步。

例如在下面的树中，一种可能的遍历过程如下：
- 选取 $1$ 作为遍历起始结点，并把 $1$ 打上标记；
- $2$ 与 $1$ 相邻且未标记，将 $2$ 设为当前访问结点，并把 $2$ 打上标记。
- $2$ 与 $3$ 相邻且未标记，将 $3$ 设为当前访问结点，并把 $3$ 打上标记。
- $3$ 所有相邻的结点都被标记，将当前访问结点设为遍历结点 $3$ 之前的结点 $2$。
- $2$ 与 $4$ 相邻且未标记，将 $4$ 设为当前访问结点，并把 $4$ 打上标记。
- $4$ 所有相邻的结点都被标记，将当前访问结点设为遍历结点 $4$ 之前的结点 $2$。
- $2$ 所有相邻的结点都被标记，将当前访问结点设为遍历结点 $2$ 之前的结点 $1$。
- $1$ 所有相邻的结点都被标记，且 $1$ 是遍历起始结点，故遍历结束。

![](https://cdn.luogu.com.cn/upload/image_hosting/qsjiky0g.png)

作为一个奇思妙想的学生，小 Q 在学习完上述知识后不满足于以结点为基础的遍历方式，于是开始研究以边为基础的遍历方式。定义两条边**相邻**，当且仅当它们有一个公共的结点。初始时，所有的边都未被标记。这种以边为基础的遍历过程如下：

1. 选择一条边 $b$ 作为遍历起始边，并把该边打上标记。
2. 假设当前访问边为 $e$，寻找任意一条与 $e$ 相邻且未标记的边 $f$，将 $f$ 作为新的当前访问边并打上标记。之后再次进入第 $2$ 步。
3. 假设在第 $2$ 步中，与 $e$ 相邻的边都已被标记，如果 $e = b$ 则遍历过程结束，否则将 $e$ 设为遍历 $e$ 之前的上一条边并再进入第 $2$ 步。

例如在上面的树中，一种可能的遍历过程如下（定义 $\{u, v\}$ 表示连接结点 $u$ 和 $v$ 的边）：

- 选取 $\{1, 2\}$ 作为遍历起始边，并把 $\{1, 2\}$ 打上标记；
- $\{1, 2\}$ 与 $\{2, 3\}$ 相邻且未标记，将 $\{2, 3\}$ 设为当前访问边，并把 $\{2, 3\}$ 打上标记。
- $\{2, 3\}$ 与 $\{2, 4\}$ 相邻且未标记，将 $\{2, 4\}$ 设为当前访问边，并把 $\{2, 4\}$ 打上标记。
- $\{2, 4\}$ 所有相邻的边都被标记，将当前访问边设为遍历 $\{2, 4\}$ 之前的边 $\{2, 3\}$。
- $\{2, 3\}$ 所有相邻的边都被标记，将当前访问边设为遍历 $\{2, 3\}$ 之前的边 $\{1, 2\}$。
- $\{1, 2\}$ 所有相邻的边都被标记，且 $\{1, 2\}$ 是遍历起始边，故遍历结束。

小 Q 惊奇的发现，在这个新的树的遍历过程中，如果将每条边看作一个新的结点，将步骤 $2$ 中的所有新结点 $e$ 和 $f$ 连接一条新边，就会生成一棵由 $n-1$ 个新结点和 $n-2$ 条新边连接成的新树。例如上述遍历过程得到的新树如下（新的结点和新边都用红色表示）：

![](https://cdn.luogu.com.cn/upload/image_hosting/mld0xpqg.png)

现在小 Q 在 $n - 1$ 条边中选择了 $k$ 条关键边。小 Q 想知道，以任意一条关键边作为起始遍历边，通过上述遍历过程能够生成多少种不同的新树。这里两棵树被认为是不同的，当且仅当至少存在某一对新的结点，它们仅在其中一棵树中连有新边。

**由于结果可能很大，你只需要输出其对 $10^9+7$ 取模的结果即可。**
## 输入格式

**本题有多组测试数据。**

输入的第一行包含两个整数 $c, T$，表示测试点的编号和测试数据的组数。在样例中，$c$ 表示该样例与测试点 $c$ 的数据范围相同。

接下来包含 $T$ 组数据，每组数据的格式如下：
- 第一行包含两个整数 $n, k$，表示树的结点数以及小 Q 选择的关键边的数量。
- 接下来 $n - 1$ 行，第 $i$ 行包含两个整数 $u_i, v_i$，表示树上编号为 $i$ 的边连接结点 $u_i$ 和 $v_i$。
- 接下来一行包含 $k$ 个整数 $e_1, e_2, \dots, e_k$，表示小 Q 选择的关键边的编号。保证关键边的编号互不相同。
## 输出格式

对于每组测试数据输出一行，包含一个整数，表示结果对 $10^9 + 7$ 取模的结果。
## 样例

### 样例输入 #1
```
1 1
4 1
1 2
2 3
2 4
1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
7 1
5 2
1 2
1 3
2 4
2 5
1 3
```
### 样例输出 #2
```
3
```
## 提示

**【样例 1 解释】**

两种可能的新树如下：
- 新结点 $\{1, 2\}$ 和新结点 $\{2, 3\}$ 连新边，新结点 $\{2, 3\}$ 和新结点 $\{2, 4\}$ 连新边。
- 新结点 $\{1, 2\}$ 和新结点 $\{2, 4\}$ 连新边，新结点 $\{2, 4\}$ 和新结点 $\{2, 3\}$ 连新边。

**【样例 2 解释】**

三种可能的新树如下：
- 新结点 $\{1, 2\}$ 和 $\{1, 3\}$，$\{1, 2\}$ 和 $\{2, 4\}$，$\{2, 4\}$ 和 $\{2, 5\}$ 之间分别连新边。该新树可以选择 $\{1, 2\}$ 作为起始遍历边得到。
- 新结点 $\{1, 2\}$ 和 $\{1, 3\}$，$\{1, 2\}$ 和 $\{2, 5\}$，$\{2, 5\}$ 和 $\{2, 4\}$ 之间分别连新边。该新树可以选择 $\{1, 2\}$ 或 $\{2, 4\}$ 作为起始遍历边得到。
- 新结点 $\{1, 2\}$ 和 $\{1, 3\}$，$\{1, 2\}$ 和 $\{2, 4\}$，$\{1, 2\}$ 和 $\{2, 5\}$ 之间分别连新边。该新树可以选择 $\{2, 4\}$ 作为起始遍历边得到。

**【样例 3】**

见附件的 traverse/traverse3.in 与 traverse/traverse3.ans。

该组样例满足 $c = 4$。

**【样例 4】**

见附件的 traverse/traverse4.in 与 traverse/traverse4.ans。

该组样例满足 $c = 7$。

**【样例 5】**

见附件的 traverse/traverse5.in 与 traverse/traverse5.ans。

该组样例满足 $c = 11$。

**【样例 6】**

见附件的 traverse/traverse6.in 与 traverse/traverse6.ans。

该组样例满足 $c = 13$。

**【样例 7】**

见附件的 traverse/traverse7.in 与 traverse/traverse7.ans。

该组样例满足 $c = 15$。

**【样例 8】**

见附件的 traverse/traverse8.in 与 traverse/traverse8.ans。

该组样例满足 $c = 16$。

**【样例 9】**

见附件的 traverse/traverse9.in 与 traverse/traverse9.ans。

该组样例满足 $c = 18$。

**【样例 10】**

见附件的 traverse/traverse10.in 与 traverse/traverse10.ans。

该组样例满足 $c = 19$。

**【样例 11】**

见附件的 traverse/traverse11.in 与 traverse/traverse11.ans。

该组样例满足 $c = 22$。

**【样例 12】**

见附件的 traverse/traverse12.in 与 traverse/traverse12.ans。

该组样例满足 $c = 24$。

**【数据范围】**

对于所有的测试数据，保证：
- $1 \leq T \leq 10$；
- $2 \leq n \leq 10^5$；
- $1 \leq k < n$；
- 对于任意的 $i(1 \leq i \leq n - 1)$，都有 $1 \leq u_i, v_i \leq n$，且构成一颗合法的树。
- 对于任意的 $i(1 \leq i \leq k)$，都有 $1 \leq e_i < n$，且两两不同。

| 测试点编号 | $n$ | $k$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |
| $1\sim 3$ | $\leq 5$ | $\leq 1$ | 无 |
| $4\sim 6$ | $\leq 10^5$ | $\leq 1$ | 无 |
| $7\sim 10$ | $\leq 10^5$ | $\leq 2$ | 无 |
| $11,12$ | $\leq 500$ | $\leq 8$ | 无 |
| $13,14$ | $\leq 10^2$ | $<n$ | 无 |
| $15$ | $\leq 500$ | $<n$ | 无 |
| $16,17$ | $\leq 10^5$ | $\leq 500$ | 无 |
| $18$ | $\leq 10^5$ | $<n$ | A |
| $19\sim 21$ | $\leq 10^5$ | $<n$ | B |
| $22,23$ | $\leq 2\times 10^4$ | $<n$ | 无 |
| $24,25$ | $\leq 10^5$ | $<n$ | 无 |

- 特殊性质 A：对于任意的 $i(1 \leq i \leq n - 1)$，都有 $u_i = i, v_i = i + 1$。
- 特殊性质 B：对于任意的 $i(1 \leq i \leq n - 1)$，都有 $u_i = 1, v_i = i + 1$。

**【提示】**

数据输入的规模可能较大，请选手注意输入读取方式的效率。


---

---
title: "[NOIP2024] 树上查询"
layout: "post"
diff: 省选/NOI-
pid: P11364
tag: ['2024', 'NOIP 提高组']
---
# [NOIP2024] 树上查询
## 题目描述

有一天小 S 和她的朋友小 N 一起研究一棵包含了 $n$ 个结点的树。

这是一棵有根树，根结点编号为 $1$，每个结点 $u$ 的深度 $\text{dep}_ u$ 定义为 $u$ 到 $1$ 的简单路径上的**结点数量**。

除此之外，再定义 $\text{LCA*}(l, r)$ 为编号在 $[l, r]$ 中所有结点的最近公共祖先，即 $l, l + 1, \dots , r$ 的公共祖先结点中深度最大的结点。

小 N 对这棵树提出了 $q$ 个询问。在每个询问中，小 N 都会给出三个参数 $l, r, k$，表示他想知道 $[l, r]$ 中任意长度大于等于 $k$ 的连续子区间的最近公共祖先深度的最大值，即

$$\max_{l\le l'\le r'\le r \land r'-l'+1\ge k}\text{dep}_ {\text{LCA*}(l', r')}$$

你的任务是帮助小 S 来回答这些询问。
## 输入格式

输入的第一行包含一个正整数 $n$，表示树的结点数。

接下来 $n - 1$ 行，每行包含两个正整数 $u, v$，表示存在一条从结点 $u$ 到结点 $v$ 的边。

第 $n + 1$ 行包含一个正整数 $q$，表示询问的数量。

接下来 $q$ 行，每行包含三个正整数 $l, r, k$，描述了一次询问。
## 输出格式

对于每次询问输出一行，包含一个整数，表示对应的答案。
## 样例

### 样例输入 #1
```
6
5 6
6 1
6 2
2 3
2 4
3
2 5 2
1 4 1
1 6 3

```
### 样例输出 #1
```
3
4
3

```
## 提示

**【样例 1 解释】**

![图 3](https://cdn.luogu.com.cn/upload/image_hosting/ktoq3ogh.png)

+ 对于第一组询问，$\text{LCA*}(2, 3) = 2, \text{LCA*}(3, 4) = 2, \text{LCA*}(4, 5) = 6$，$2$ 的深度为 $3$，$6$ 的深度为 $2$，因此答案为 $\max\{3, 3, 2\} = 3$。

+ 对于第二组询问，答案为 $1, 2, 3, 4$ 四个结点的最大深度，因此答案为 $4$。

+ 对于第三组询问，$\text{LCA*}(1, 3) = 1, \text{LCA*}(2, 4) = 2, \text{LCA*}(3, 5) = 6, \text{LCA*}(4, 6) = 6$，依旧是 $2$ 的深度最大，因此答案为 $3$。

**【样例 2】**

见附件的 query/query2.in 与 query/query2.ans。

该样例满足 $n, q ≤ 500$。

**【样例 3】**

见附件的 query/query3.in 与 query/query3.ans。

该样例满足 $n, q ≤ 10^5$ 且树符合链的形态。

**【样例 4】**

见附件的 query/query4.in 与 query/query4.ans。

该样例满足 $n, q ≤ 5 × 10^5$。

**【数据范围】**

对于所有的测试数据，保证：$1 ≤ n, q ≤ 5 × 10^5
, 1 ≤ l ≤ r ≤ n, 1 ≤ k ≤ r - l + 1$

| 测试点编号 | $n,q\le$ | 特殊限制 |
| :-: | :-: | :-: |
| $1\sim2$ | $500$ | 无 |
| $3\sim5$ | $5000$ | 无 |
| $6\sim9$ | $10^5$ | 满足性质 A |
| $10\sim13$ | $5\times10^5$ | 满足性质 A |
| $14\sim16$ | $5\times10^5$ | 满足性质 B |
| $17\sim20$ | $10^5$ | 无 |
| $21\sim25$ | $5\times10^5$ | 无 |

性质 A：保证输入的树符合链的形态，且根结点的度数为 $1$。

性质 B：对于每个询问保证 $k = r - l + 1$。


---

---
title: "[NOISG 2023 Finals] Curtains"
layout: "post"
diff: 省选/NOI-
pid: P11536
tag: ['线段树', '2023', '分治', 'NOISG（新加坡）', '离线处理']
---
# [NOISG 2023 Finals] Curtains
## 题目描述

兔子 Benson 正要在飞机上组织表演！

Benson 有 $n$ 个舞台，由 $1\sim n$ 编号。他有 $m$ 个幕布，由 $1\sim m$ 编号。

幕布可以下降——第 $i$ 个幕布下降后，它会遮挡住编号在 $[l_i,r_i]$ 内的舞台。

Benson 将组织 $q$ 次演出，由 $1\sim q$ 编号。第 $i$ 场演出需要使用编号在 $[s_j,e_j]$ 内的舞台。对于每场演出，Benson 想知道，是否能下降某些幕布，**恰好**遮住表演所需的舞台。

**形式化地**：给定 $m$ 个区间 $[l_i,r_i]$，每次询问给定区间 $[s_j,e_j]$，查询是否能选择一些区间，使它们的并恰好为 $[s_j,e_j]$。
## 输入格式

第一行三个正整数 $n,m,q$，用空格隔开。

接下来 $m$ 行，每行两个整数 $l_i,r_i$，表示幕布能遮挡的舞台区间。

接下来 $q$ 行，每行两个整数 $s_j,e_j$，表示表演所需的舞台区间。

## 输出格式

对于每组询问，输出一行 `YES` 或 `NO`，表示是否能下降某些幕布，使其恰好遮住表演所需的舞台。
## 样例

### 样例输入 #1
```
6 2 3
1 2
3 4
1 3
1 4
1 5

```
### 样例输出 #1
```
NO
YES
NO

```
### 样例输入 #2
```
10 10 10
6 9
6 7
1 6
10 10
5 9
3 9
2 10
5 7
9 10
5 10
7 8
4 7
1 6
2 7
3 9
7 7
2 9
4 9
6 6
5 7

```
### 样例输出 #2
```
NO
NO
YES
NO
YES
NO
NO
NO
NO
YES

```
## 提示

#### 数据范围

| Subtask | 分值 | 特殊限制 |
| :-----------: | :-----------: | :-----------: |
| $0$ | $0$ | 样例 |
| $1$ | $3$ | $n,m,q\leq 200$ |
| $2$ | $6$ | $n,m,q\leq 2000$ |
| $3$ | $15$ | $n\leq 2000$ |
| $4$ | $20$ | $s_j=1$ |
| $5$ | $36$ | $n,m,q\leq 10^5$ |
| $6$ | $20$ | 无 |

对于 $100\%$ 的数据：

- $1\leq n,m,q\leq 5\times 10^5$
- $1\leq l_i\leq r_i\leq n$
- $1\leq s_j\leq e_j\leq n$

注：由于洛谷限制，数据不完全按照原题分配子任务。


---

---
title: "[NOISG 2018 Finals] City Mapping【缺样例】"
layout: "post"
diff: 省选/NOI-
pid: P11597
tag: ['2018', '二分', '交互题', 'Special Judge', 'O2优化', '树链剖分', 'NOISG（新加坡）']
---
# [NOISG 2018 Finals] City Mapping【缺样例】
## 题目背景

译自 [NOISG 2018 Finals D. City Mapping](https://github.com/noisg/sg_noi_archive/tree/master/2018/tasks/citymapping)。

----------------

当你在洛谷提交本题时，需要注意：

- 本题仅支持 C++ 系列语言。
- 你的代码中不应该包含头文件 `citymapping.h`。
- 你的代码中应当有如下两行函数声明：
	```cpp
	long long get_distance(int X, int Y);
	void find_roads(int N, int Q, int A[], int B[], int W[]);
	```
    
如遇评测问题，请联系搬题人。
## 题目描述

**这是一道交互题。**

Silvermill 市是一座有 $N$ 个路口和 $N-1$ 条道路的城市。其中道路的编号为 $0$ 到 $N-2$。

第 $i$ 条道路双向连接了 $(A_i,B_i)$ 两个路口，从任意方向通过这条道路都需要花费 $W_i$ 分钟。保证任意两个路口之间都能通过道路互相到达。

为了避免交通堵塞，Silvermill 市的**每个路口连接的道路不会超过 $3$ 条**。

你的任务是画出 Silvermill 市的地图，也就是找出所有 $N-1$ 条道路的 $(A_i,B_i,W_i)$。

为了达到这个目的，你可以询问市长至多 $Q$ 次从任意一个路口 $X$ 到任意一个路口 $Y$ 最少需要多少分钟。

### 实现细节

在本题中，**你不需要，也不应该实现主函数**。

你需要实现如下函数：

```cpp
void find_roads(int N, int Q, int A[], int B[], int W[])
```

该函数包含两个输入参数和三个输出参数，将在评测时被运行恰好一次。输入参数为 $N,Q$，分别表示路口的数量和最大询问次数；输出参数为 $A,B,W$，你需要确定城市中的 $N-1$ 条道路，按题意中的含义以数组 $A,B,W$ 的形式返回。返回道路的顺序可以是任意的，同一道路端点的顺序也可以是任意的。

注意数组的下标是从 $0$ 开始的。

你可以调用下面的函数来完成任务：

```cpp
long long get_distance(int X, int Y)
```

该函数将返回一个整数，表示从路口 $X$ 到路口 $Y$ 最少需要多少分钟。如果你调用此函数超过 $Q$ 次，或提供无效的路口编号作为参数，程序将立刻终止，你将得到 Wrong Answer 的评测状态。
## 输入格式

示例测试程序如下方式读入数据：

第一行三个整数 $N,Q,S$，分别表示路口的数量、最大询问次数和子任务编号。

之后是 $N-1$ 行，每行三个整数 $(A_i,B_i,W_i)$，描述一条道路。
## 输出格式

示例测试程序可能会产生的输出如下：

- `Wrong Input Format`，意味着对示例测试程序的输入格式有误。
- `Wrong Answer: Reported list of edges differ from actual.`，意味着你确定的道路与实际情况不符。
- `Wrong Answer: get_distance() arguments out of range.`，意味着你在询问时提供了无效的路口编号作为参数。
- `Wrong Answer: Too many calls to get_distance().`，意味着你超出了最大询问次数限制。
- 包含两行信息，分别是 `Score: s%` 和 `Correct: x out of y queries used.`，意味着你获得了该测试点 $s\%$ 的分数，最大询问次数为 $y$ 次，你使用了其中的 $x$ 次。
## 提示

### 调用示例

我们考虑如下的城市地图，展示一种可能的函数调用过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/m7bz8mwi.png)

假设此时最大询问次数 $Q=5\times 10^5$。

你的函数将这样被调用恰好一次：

```cpp
find_roads(5, 500000, A, B, W);
```

其中 $A,B,W$ 是定义在测试程序中的数组。

一种可能的交互过程如下：

- `get_distance(5, 4) = 10`：`get_distance` 函数返回从路口 $5$ 到达路口 $4$ 的最少分钟数。路线 $5\to 3\to 4$ 是最短的，需要 $10$ 分钟。
- `get_distance(2, 4) = 1`：`get_distance` 函数返回了从路口 $2$ 到达路口 $4$ 的最少分钟数。直接从 $2$ 走到 $4$ 是最短的，需要 $1$ 分钟。
- `get_distance(1, 3) = 15`：`get_distance` 函数返回了从路口 $1$ 到达路口 $3$ 的最少分钟数。路线 $1\to 4\to 3$ 是最短的，需要 $15$ 分钟。
- `get_distance(1, 2) = 9`：`get_distance` 函数返回了从路口 $1$ 到达路口 $2$ 的最少分钟数。路线 $1\to 4\to 2$ 是最短的，需要 $9$ 分钟。

此时，我们假设你的 `find_roads` 函数认为自己已经掌握了足够的信息，可以推导出正确的地图，所以将 $A,B,W$ 数组分别赋值为 $A=[3,4,4,5],B=[4,1,2,3],W=[7,8,1,3]$，然后终止。

这只是一种可能的答案，因为返回道路的顺序可以是任意的，同一道路端点的顺序也可以是任意的。

### 子任务

对于 $100\%$ 的数据，$2\le N\le1000$，$1\le A_i,B_i\le N$，$1\le W_i\le 10^9$。

| 子任务 | 得分 | $Q$ | 特殊性质及备注 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $9$ | $=5\times 10^5$ | $W_i=1$ |
| $2$ | $16$ | $=5\times 10^5$ | 无特殊限制 |
| $3$ | $13$ | $=12000$ | 每个路口最多连接两条道路，且 $W_i=1$ |
| $4$ | $19$ | $=12000$ | 每个路口最多连接两条道路 |
| $5$ | $43$ | $=25000$ | 无特殊限制，但有特殊的计分规则（请参阅**计分细则**） |

### 计分细则

子任务 $5$ 适用于以下的计分规则。你的得分依赖于你实现的函数询问的次数 $q$。

- 如果 $q>25000$，你将获得 $0$ 分。
- 如果 $12000<q\le 25000$，你将获得 $10-10\times \frac{q-12000}{13000}$ 分。
- 如果 $6500<q\le 12000$，你将获得 $40-30\times \frac{q-6500}{5500}$ 分。
- 如果 $q\le 6500$，你将获得 $43$ 分。

### 本地测试方式

我们在附件中下发了示例测试程序 `grader.cpp`，头文件 `citymapping.h`，你所需完成的代码的示例 `citymapping.cpp`，以及编译文件 `compile.sh`。

将这些文件置于同一文件夹下，使用 `compile.sh` 编译并运行生成的可执行文件，即可进行本地测试。

下发的示例测试程序与提交后使用的测试程序有所不同。

注意提交到洛谷上时有特殊的要求。


---

---
title: "[NOISG 2018 Finals] Safety"
layout: "post"
diff: 省选/NOI-
pid: P11598
tag: ['动态规划 DP', '2018', '动态规划优化', 'NOISG（新加坡）']
---
# [NOISG 2018 Finals] Safety
## 题目背景

译自 [NOISG 2018 Finals E. Safety](https://github.com/noisg/sg_noi_archive/tree/master/2018/tasks/safety)。
## 题目描述

小老鼠 Squeaky 最近开始欣赏视觉艺术，并尝试创作自己的艺术作品，在城里最负盛名的艺术节上展出！

他的作品由若干发光柱组成，其中每个发光柱又都是由发光立方体堆砌而成的。

具体来说，他的作品是排成一条直线的 $N$ 个发光柱，从左到右编号为 $1$ 到 $N$。其中第 $i$ 个发光柱的高度为 $S_i$，意味着它由 $S_i$ 个发光立方体堆砌而成。

例如下图是 $N=20$ 时一种可能的作品：

![](https://cdn.luogu.com.cn/upload/image_hosting/qp61p4fu.png)

然而，观众撞到不安全的展品将造成灾难性的后果。所以，安全委员会要求 Squeaky 保证作品的安全性。具体来说，作品安全当且仅当任意两个相邻发光柱的高度差不超过 $H$，即 $|S_i-S_{i+1}|\le H,\forall i\in[1,N)$。

Squeaky 的作品可能是不安全的，为了确保正常展出，他希望通过修改作品使其安全。

他可以进行的修改只有两种：

- 在发光柱 $k$ 上添加一个发光立方体，即 $S_k\gets S_k+1$。
- 从还有至少一个发光立方体的发光柱 $k$ 上移除一个发光立方体，即 $S_k\gets S_k-1$。

注意，即使一个发光柱没有发光立方体，我们也认为它依然存在于原来的位置。

你的任务是帮助 Squeaky 确定至少需要多少次修改他的作品才能安全。
## 输入格式

第一行包含两个整数 $N,H$，含义如题所述。

接下来一行 $N$ 个整数，第 $i$ 个表示 $S_i$，即发光柱 $i$ 的初始高度。
## 输出格式

一行一个整数，Squeaky 为了使他的作品安全需要的最少修改次数。
## 样例

### 样例输入 #1
```
6 1
2 10 0 2 4 3
```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
6 3
2 10 2 6 4 3
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
4 1
1 4 1 4
```
### 样例输出 #3
```
4
```
### 样例输入 #4
```
10 1
10 9 8 7 6 5 4 3 2 1
```
### 样例输出 #4
```
0
```
### 样例输入 #5
```
3 0
1 1 3
```
### 样例输出 #5
```
2
```
## 提示

### 样例 #1 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/o2mb9wvh.png)

如图所示，我们删去红色立方体，添加黄色立方体，通过修改 $10$ 次使 Squeaky 的作品安全：任意相邻的两个发光柱高度差都不超过 $H=1$。

可以证明，不存在少于 $10$ 步的修改方法。

这组样例满足子任务 $3$ 和子任务 $5$ 至 $9$。

### 样例 #2 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/9i4cjmny.png)

如图所示，我们删去红色立方体，添加黄色立方体，通过修改 $6$ 次使 Squeaky 的作品安全。可以证明，不存在少于 $6$ 步的修改方法。

这组样例满足子任务 $5$ 至 $9$。

### 样例 #3 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/v83yezxt.png)

如图所示，我们删去红色立方体，添加黄色立方体，通过修改 $4$ 次使 Squeaky 的作品安全。可以证明，不存在少于 $4$ 步的修改方法。

这组样例满足子任务 $1$ 至 $3$ 和子任务 $5$ 至 $9$。

### 样例 #4 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/narncyxs.png)

Squeaky 的作品本来就是安全的，所以不需要进行修改。

这组样例满足子任务 $3$ 和子任务 $5$ 至 $9$。

### 样例 #5 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/fo23a2wx.png)

如图所示，我们删去红色立方体，通过修改 $2$ 次使 Squeaky 的作品安全。可以证明，不存在少于 $2$ 步的修改方法。

这组样例满足所有子任务。

### 子任务

对于 $100\%$ 的数据，$1\le N\le 2\times 10^5$，$0\le H\le 10^9$，$0\le S_i\le 10^9$。

| 子任务 | 得分 | 数据范围及特殊性质 |
| :----------: | :----------: | :----------: |
| $1$ | $3$ | $N\le 10$，$S_i\le 4$ |
| $2$ | $4$ | $N\le 14$，$H\le 1$，$S_i\le 4$ |
| $3$ | $9$ | $N\le10$，$H\le 2$ |
| $4$ | $5$ | $H=0$ |
| $5$ | $6$ | $N\le 500$，$S_i\le 400$ |
| $6$ | $11$ | $N\le 500$，$S_i\le 5\times 10^3$ |
| $7$ | $11$ | $N\le 5\times 10^3$，$S_i\le 5\times 10^3$ |
| $8$ | $22$ | $N\le 5\times 10^3$ |
| $9$ | $29$ | 无特殊限制 |



---

---
title: "[NOISG 2025 Prelim] Lasers 2"
layout: "post"
diff: 省选/NOI-
pid: P12196
tag: ['2025', 'NOISG（新加坡）']
---
# [NOISG 2025 Prelim] Lasers 2
## 样例

### 样例输入 #1
```
3 10 10
2 5 9
1 3 1
4 7 10
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
10 10 50
8 8 0
3 3 0
6 6 2
7 7 9
1 1 50
5 5 21
6 6 4
10 10 4
10 10 3
10 10 3
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
4 17 0
2 4 1000000000
6 9 1000000000
8 13 1000000000
15 16 1000000000
```
### 样例输出 #3
```
4
```
## 提示

### Subtasks

For all testcases, the input will satisfy the following bounds:

- $1 \leq h, w \leq 2000$
- $0 \leq k \leq 10^9$
- $1 \leq l[i] \leq r[i] \leq w$ for all $1 \leq i \leq h$
- $0 \leq c[i] \leq 10^9$ for all $1 \leq i \leq h$

Your program will be tested on input instances that satisfy the following restrictions:

| Subtask | Marks | Additional constraints |
| :-: | :-: | :-: |
| $0$ | $0$ | Sample test cases |
| $1$ | $6$ | $k = 0, c[i] = 10^9$ |
| $2$ | $9$ | $l[i] = r[i]$ |
| $3$ | $10$ | $h, w \leq 18$ |
| $4$ | $7$ | $h, w \leq 100, k \leq 2000$ |
| $5$ | $15$ | $h, w \leq 100$ |
| $6$ | $23$ | $h, w \leq 500$ |
| $7$ | $8$ | $r[1] − l[1] = r[2] − l[2] = \ldots = r[h] − l[h]$ |
| $8$ | $22$ | No additional constraints |

### Sample Test Case 1 Explanation

This test case is valid for subtasks $3, 4, 5, 6$, and $8$.

The laser toy in the above figure corresponds to this test case. Pavement can unlock the first and second sliding walls for a total cost of $9 + 1 = 10$ dollars. He can then slide the first sliding wall such that it spans columns $4$ to $7$, and slide the second sliding wall to span columns $5$ to $7$.

![](https://cdn.luogu.com.cn/upload/image_hosting/glj93dtp.png)

This leaves $6$ lasers (in columns $1, 2, 3, 8, 9$, and $10$) unblocked, which is the maximum possible.

### Sample Test Case 2 Explanation

This test case is valid for subtasks $2$ to $8$.

### Sample Test Case 3 Explanation

This test case is valid for subtasks $1, 3, 4, 5, 6$, and $8$.


---

---
title: "[NOI2013] 向量内积"
layout: "post"
diff: 省选/NOI-
pid: P1224
tag: ['2013', 'NOI', 'Special Judge', '矩阵乘法', '向量']
---
# [NOI2013] 向量内积
## 题目描述

两个 $d$ 维向量 $A=[a_1,a_2,\ldots,a_d]$ 与 $B=[b_1,b_2,\ldots,b_d]$ 的内积为其相对应维度的权值的乘积和，即：

$$(A,B)=\sum_{i=1}^d a_ib_i=a_1b_1+a_2b_2+\ldots+a_db_d$$

现有 $n$ 个 $d$ 维向量 $x_1,\ldots,x_n$ ，小喵喵想知道是否存在两个向量的内积为 $k$ 的倍数。请帮助她解决这个问题。

## 输入格式

第一行包含 $3$ 个正整数 $n,d,k$，分别表示向量的个数，维数以及待检测的倍数。

接下来 $n$ 行每行有 $d$ 个非负整数，其中第 $i$ 行的第 $j$ 个整数表示向量 $x_i$ 的第 $j$ 维权值 $x_{i,j}$。

## 输出格式

包含两个整数，用空格隔开。

如果存在两个向量 $x_p,x_q$ 的内积为 $k$ 的整数倍，则输出两个向量的编号 $p$ 与 $q$（要求 $p<q$）。如果存在多组这样的向量组合，输出其中任意一组即可。

若不存在这样的向量组合，则输出两个 $-1$。

## 样例

### 样例输入 #1
```
3 5 2 
1 0 1 0 1 
1 1 0 1 0 
0 1 0 1 1

```
### 样例输出 #1
```
2 3

```
## 提示

### 数据范围

| 测试点编号 | $n$ | $d$ | $k$ | $x_{i,j}$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $2$ | $20$ | $2$ | $\leq 10$ |
| $2$ | $5$ | $20$ | $2$ | $\leq 10$ |
| $3$ | $10$ | $20$ | $3$ | $\leq 10$ |
| $4$ | $20$ | $20$ | $2$ | $\leq 100$ |
| $5$ | $50$ | $20$ | $3$ | $\leq 100$ |
| $6$ | $50$ | $50$ | $2$ | $\leq 10^3$ |
| $7$ | $50$ | $50$ | $3$ | $\leq 3\times 10^6 $ |
| $8$ | $80$ | $80$ | $2$ | $\leq 2\times 10^6 $ |
| $9$ | $100$ | $100$ | $3$ | $\leq 3\times 10^6 $ |
| $10$ | $500$ | $100$ | $3$ | $\leq 3\times 10^6$ |
| $11$ | $10^3$ | $100$ | $2$ | $\leq 2\times 10^6$ |
| $12$ | $10^3$ | $100$ | $3$ | $\leq 3\times 10^6$ |
| $13$ | $10^4$ | $100$ | $2$ | $<10$ |
| $14$ | $10^4$ | $100$ | $3$ | $<10$ |
| $15$ | $1.5\times 10^4$ | $100$ | $2$ | $<10$ |
| $16$ | $1.8\times 10^4$ | $100$ | $2$ | $<10$ |
| $17$ | $2\times 10^4$ | $100$ | $2$ | $<10$ |
| $18$ | $5\times 10^4$ | $30$ | $3$ | $<10$ |
| $19$ | $8\times 10^4$ | $30$ | $3$ | $<10$ |
| $20$ | $10^5$ | $30$ | $3$ | $<10$ |


---

---
title: "[NOI2013] 树的计数"
layout: "post"
diff: 省选/NOI-
pid: P1232
tag: ['递推', '2013', 'NOI', '广度优先搜索 BFS', '深度优先搜索 DFS']
---
# [NOI2013] 树的计数
## 题目描述

我们知道一棵有根树可以进行深度优先遍历（DFS）以及广度优先遍历（BFS）来生成这棵树的 DFS 序以及 BFS 序。两棵不同的树的 DFS 序有可能相同，并且它们的 BFS 序也有可能相同，例如下面两棵树的 DFS 序都是 `1 2 4 5 3`，BFS 序都是 `1 2 3 4 5`。

![](https://cdn.luogu.com.cn/upload/image_hosting/kagmha60.png)

现给定一个 DFS 序和 BFS 序，我们想要知道，符合条件的有根树中，树的高度的平均值。即，假如共有 $K$ 棵不同的有根树具有这组 DFS 序和 BFS 序，且他们的高度分别是 $h_1, h_2, \ldots, h_K$，那么请你输出：

$$
\frac{h_1+h_2+\ldots+h_K}K
$$
## 输入格式

第一行包含 $1$ 个正整数 $n$，表示树的节点个数。

第二行包含 $n$ 个正整数，是一个 $1 \ldots n$ 的排列，表示树的 DFS 序。

第三行包含 $n$ 个正整数，是一个 $1 \ldots n$ 的排列，表示树的 BFS 序。

输入保证至少存在一棵树符合给定的两个序列。
## 输出格式

输出 $1$ 个实数，四舍五入保留恰好三位小数，表示树高的平均值。
## 样例

### 样例输入 #1
```
5 
1 2 4 5 3 
1 2 3 4 5

```
### 样例输出 #1
```
3.500

```
## 提示

如果输出文件的答案与标准输出的差不超过 $0.001$，则将获得该测试点上的分数，否则不得分。

### 数据范围

- 对于 $20\%$ 的测试数据，满足：$n \le 10$；
- 对于 $40\%$ 的测试数据，满足：$n \le 100$；
- 对于 $85\%$ 的测试数据，满足：$n \le 2 \times 10^3$；
- 对于 $100\%$ 的测试数据，满足：$2 \le n \le 2 \times 10^5$。


---

---
title: "[NOI2025] 序列变换"
layout: "post"
diff: 省选/NOI-
pid: P13272
tag: ['动态规划 DP', '2025', 'NOI', 'Special Judge', '动态规划优化']
---
# [NOI2025] 序列变换
## 题目描述

给定两个长度为 $n$ 的整数序列 $B = [b_1, \ldots, b_n]$，$C = [c_1, \ldots, c_n]$。对于长度为 $n$ 的非负整数序列 $D = [d_1, \ldots, d_n]$，设 $S(D)$ 为所有满足 $d_i = 0$ 的下标 $i$ 的集合，定义 $f(D) = \sum_{i \in S(D)} b_i$，$g(D) = \prod_{i \in S(D)} c_i$。特别地，若 $S(D)$ 为空，则 $f(D) = 0$，$g(D) = 1$。

小 L 有一个长度为 $n$ 的 **正整数序列** $A = [a_1, \ldots, a_n]$。小 L 可以对序列 $A$ 做如下修改：

- 选择序列 $A$ 的两个 **相邻** 的下标 $i, j$（即 $1 \leq i, j \leq n$ 且 $|i - j| = 1$），若 $a_i \leq a_j$，则将 $a_j$ 改为 $a_j - a_i$，同时将 $a_i$ 改为 $0$。

小 L 可以进行任意多次修改操作，也可以不进行任何修改。对于所有序列 $A$ 通过以上修改操作可以得到的序列 $D$，小 L 想求出 $f(D)$ 的最大值以及 $g(D)$ 之和，请你帮助他求出这两个值。形式化地，记 $T(A)$ 为序列 $A$ 通过以上修改操作可以得到的 **所有序列的集合**，你需要求出 $\max_{D \in T(A)} f(D)$ 以及 $\sum_{D \in T(A)} g(D)$。其中，由于 $\sum_{D \in T(A)} g(D)$ 可能较大，你只需要求出其对 $1,000,000,007$ 取模后的结果。
## 输入格式

**本题包含多组测试数据。**

输入的第一行包含两个非负整数 $c, t$，分别表示测试点编号与测试数据组数。$c = 0$ 表示该测试点为样例。

接下来依次输入每组测试数据，对于每组测试数据：

- 第一行包含一个正整数 $n$，表示序列长度。
- 第二行包含 $n$ 个正整数 $a_1, \ldots, a_n$，表示序列 $A$。
- 第三行包含 $n$ 个整数 $b_1, \ldots, b_n$，表示序列 $B$。
- 第四行包含 $n$ 个正整数 $c_1, \ldots, c_n$，表示序列 $C$。
## 输出格式

对于每组测试数据，仅输出一行，其中包含两个整数，分别表示 $\max_{D \in T(A)} f(D)$ 以及 $\sum_{D \in T(A)} g(D)$ 对 $1,000,000,007$ 取模后的结果。**注意：$\max_{D \in T(A)} f(D)$ 不需要对 $1,000,000,007$ 取模。**

本题包含两个小问，正确回答其中任意一个小问均可获得部分分数。具体评分规则请参见【评分方式】。
## 样例

### 样例输入 #1
```
0 3
3
5 6 6
3 6 9
1 2 3
6
1 1 4 5 1 4
-1 1 -1 1 -2 2
1 1 1 1 1 1
8
4 2 4 2 2 2 4 4
-2 4 9 -3 4 8 7 8
1 1 1 1 1 1 1 1
```
### 样例输出 #1
```
15 10
1 18
37 48
```
## 提示

### 样例 1 解释

该样例共包含三组测试数据。

对于第一组测试数据，可以得到以下 4 个序列：

- $D = [5, 6, 6]$，$f(D) = 0$，$g(D) = 1$；
- $D = [0, 1, 6]$，$f(D) = 3$，$g(D) = 1$；
- $D = [5, 0, 0]$，$f(D) = 6 + 9 = 15$，$g(D) = 2 \times 3 = 6$；
- $D = [0, 0, 5]$，$f(D) = 3 + 6 = 9$，$g(D) = 1 \times 2 = 2$。

故 $\max_{D \in T(A)} f(D) = \max\{0, 3, 15, 9\} = 15$，$\sum_{D \in T(A)} g(D) = 1 + 1 + 6 + 2 = 10$。

### 样例 2

见选手目录下的 `sequence/sequence2.in` 与 `sequence/sequence2.ans`。

该样例满足测试点 3、4 的约束条件。

### 样例 3

见选手目录下的 `sequence/sequence3.in` 与 `sequence/sequence3.ans`。

该样例满足测试点 5、6 的约束条件。

### 样例 4

见选手目录下的 `sequence/sequence4.in` 与 `sequence/sequence4.ans`。

该样例满足测试点 7 的约束条件。

### 样例 5

见选手目录下的 `sequence/sequence5.in` 与 `sequence/sequence5.ans`。

该样例满足测试点 11、12 的约束条件。

### 样例 6

见选手目录下的 `sequence/sequence6.in` 与 `sequence/sequence6.ans`。

该样例满足测试点 $16\sim 18$ 的约束条件。

设 $N$ 为单个测试点内所有测试数据的 $n$ 的和。对于所有测试数据，保证：

- $1 \leq t \leq 20$；
- $1 \leq n \leq 5,000$，$N \leq 4 \times 10^4$；
- 对于所有 $1 \leq i \leq n$，均有 $1 \leq A_i \leq 10^9$；
- 对于所有 $1 \leq i \leq n$，均有 $-10^9 \leq B_i \leq 10^9$；
- 对于所有 $1 \leq i \leq n$，均有 $1 \leq C_i \leq 10^9$。

| 测试点编号 | $n \leq$ | $N \leq$ | 特殊性质 |
| :-: | :-: | :-: | :-: |
| $1, 2$ | $8$ | $10^2$ | 无 |
| $3, 4$ | $200$ | $400$ | B |
| $5, 6$ | $200$ | $400$ | 无 |
| $7$ | $500$ | $10^3$ | A |
| $8 \sim 10$ | $500$ | $10^3$ | B |
| $11, 12$ | $500$ | $10^3$ | 无 |
| $13$ | $3\,500$ | $3 \times 10^4$ | A |
| $14, 15$ | $3\,500$ | $3 \times 10^4$ | B |
| $16 \sim 18$ | $3\,500$ | $4 \times 10^4$ | 无 |
| $19, 20$ | $5\,000$ | $4 \times 10^4$ | 无 |

- **特殊性质 A**：保证 $A_1 = A_2 = \cdots = A_n = 1$。
- **特殊性质 B**：保证对于所有 $1 \leq i \leq n$，$A_i$ 均在 $[1, 10^9]$ 中 **独立均匀随机** 生成。

### 评分方式

对于每个测试点：

- 正确回答所有测试数据的 $\max_{D \in T(A)} f(D)$，可获得该测试点 $40\%$ 的分数；
- 正确回答所有测试数据的 $\sum_{D \in T(A)} g(D)$ 对 $1,000,000,007$ 取模后的结果，可获得该测试点 $60\%$ 的分数。

**注意：即使选手仅回答了其中一个问题，也需要按照输出格式输出两个整数，分别对应两个问题的答案。**

附加文件来自于 [QOJ](https://qoj.ac/contest/2315/problem/13080)。


---

---
title: "[NOI2013] 书法家"
layout: "post"
diff: 省选/NOI-
pid: P1398
tag: ['动态规划 DP', '2013', 'NOI', '枚举']
---
# [NOI2013] 书法家
## 题目描述

小 E 同学非常喜欢书法，他听说 NOI2013 已经开始了，想题一幅 “NOI” 的字送给大家。

小 E 有一张非常神奇的纸，纸可以用一个 $n$ 行 $m$ 列的二维方格矩阵来表示，为了描述方便，我们定义矩阵左下角方格坐标为 $(1,1)$，右上角方格坐标为 $(m, n)$。

矩阵的每个方格有一个整数的幸运值。在格子上面写字可以增加大家的幸运度，幸运度的大小恰好是所有被笔写到的方格的幸运值之和。现在你要在上面写
上 `N`，`O`，`I` 三个字母。

下面给出 $3$ 个书法字的定义:
- `N` 由若干（$\ge 3$）个边平行于坐标轴的矩形组成，设由 $K$ 个矩形组成（标号 $1 \ldots K$），第 $i$ 个矩形的左下角方格坐标设为 $(L_i, B_i)$，右上角坐标设为 $(R_i, T_i )$，要求满足：
  1. $L_i \le R_i, B_i \le T_i$；
  2. 对任意 $1 < i \le K$，有 $L_i = R_{i-1} + 1$；
  3. 对任意 $3 \le i < K$，有 $B_{i−1} − 1 \le T_i \le T_{i-1}$，$B_i \le B_{i-1}$；
  4. $B_2 > B_1$，$T_2 = T_1$，$B_{K-1} = B_K$，$T_{K-1} < T_K$；
- `O` 由一个大矩形 $A$，挖去一个小矩形 $B$ 得到，这两个矩形的边都平行于坐标轴。设大矩形 $A$ 左下角的方格坐标为 $(u, v)$，长为 $W$，宽为 $H$，则小矩形 $B$ 满足左下角方格坐标为 $(u + 1, v + 1)$，长 $W - 2$，宽 $H - 2$。要求满足：
  1. $W \ge 3$，$H \ge 3$；
  2. $u > R_K + 1$；
- `I` 为 $3$ 个边平行于坐标轴的从下到上的实心矩形组成，从下到上依次标号为 $1,2,3$，第 $i$ 个矩形的左下角格子坐标设为 $(P_i , Q_i )$，右上角格子坐标设为 $(G_i , H_i )$，要求满足：
  1. $P_i \le G_i , Q_i \le H_i$；
  2. $P_1 = P_3 > u + W$，$G_1 = G_3$；
  3. $Q_1 = H_1 = Q_2 - 1, H_2 + 1 = Q_3 = H_3$；
  4. $P_1 < P_2 \le G_2 < G_1$。

下图是一个 `N`,`O`,`I` 的例子：

![](https://cdn.luogu.com.cn/upload/image_hosting/g7t4tquv.png)

另外，所有画的图形均不允许超过纸张的边界。现在小 E 想要知道,他能画出的最大幸运度是多少。
## 输入格式

第一行包含两个正整数 $n$ 和 $m$ ,分别表示矩阵的行数和列数。

接下来 $n$ 行，每行有 $m$ 个整数，第 $i + 1$ 行的第 $j$ 个数表示格子 $(j, n - i + 1)$ 的幸运值。
## 输出格式

输出一个整数 $T$，表示小 E 能够获得的最大幸运度。
## 样例

### 样例输入 #1
```
3 13 
1 1 -1 -1 1 -1 1 1 1 -1 1 1 1 
1 -1 1 -1 1 -1 1 -1 1 -1 -1 1 -1 
1 -1 -1 1 1 -1 1 1 1 -1 1 1 1 

```
### 样例输出 #1
```
24
```
### 样例输入 #2
```
3 13
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1


```
### 样例输出 #2
```
-20
```
## 提示

### 样例解释 1

![](https://cdn.luogu.com.cn/upload/image_hosting/vq7asar5.png)

### 样例解释 2

![](https://cdn.luogu.com.cn/upload/image_hosting/1ojygumc.png)

### 数据范围

| 测试点编号 |   $n$   |   $m$    | 幸运值范围 |
| :--------: | :------: | :------: | :--------: |
|     1      |   $=3$   |  $=12$   | $[-50,50]$ |
|     2      |   $=3$   |  $=12$   | $[-50,50]$ |
|     3      |   $=3$   |  $=12$   | $[-50,50]$ |
|     4      |   $=3$   |  $=12$   | $[-50,50]$ |
|     5      | $\le10$  | $\le20$  | $[-50,50]$ |
|     6      | $\le10$  | $\le20$  | $[-50,50]$ |
|     7      | $\le10$  | $\le20$  | $[-50,50]$ |
|     8      | $\le10$  | $\le20$  | $[-50,50]$ |
|     9      | $\le150$ | $\le500$ |    $=1$    |
|     10     | $\le150$ | $\le500$ |    $=1$    |
|     11     | $\le80$  | $\le80$  |    $[-200,200]$    |
|     12     | $\le80$  | $\le80$  |    $[-200,200]$    |
|     13     | $\le80$  | $\le80$  |    $[-200,200]$    |
|     14     | $\le80$  | $\le80$  |    $[-200,200]$    |
|     15     | $\le150$  | $\le500$  |    $[-200,200]$    |
|     16     | $\le150$  | $\le500$  |    $[-200,200]$    |
|     17     | $\le150$  | $\le500$  |    $[-200,200]$    |
|     18     | $\le150$  | $\le500$  |    $[-200,200]$    |
|     19     | $\le150$  | $\le500$  |    $[-200,200]$    |
|     20     | $\le150$  | $\le500$  |    $[-200,200]$    |

对于所有的测试数据，保证 $n \ge 3,m \ge 12$。


---

---
title: "[NOI2008] 假面舞会"
layout: "post"
diff: 省选/NOI-
pid: P1477
tag: ['图论', '2008', 'NOI', '深度优先搜索 DFS', '最大公约数 gcd']
---
# [NOI2008] 假面舞会
## 题目描述

一年一度的假面舞会又开始了，栋栋也兴致勃勃的参加了今年的舞会。

今年的面具都是主办方特别定制的。每个参加舞会的人都可以在入场时选择一个自己喜欢的面具。每个面具都有一个编号，主办方会把此编号告诉拿该面具的人。

为了使舞会更有神秘感，主办方把面具分为 $k$（$k\geq 3$）类，并使用特殊的技术将每个面具的编号标在了面具上，只有戴第 $i$ 类面具的人才能看到戴第 $i+1$  类面具的人的编号，戴第 $k$ 类面具的人能看到戴第 $1$ 类面具的人的编号。

参加舞会的人并不知道有多少类面具，但是栋栋对此却特别好奇，他想自己算出有多少类面具，于是他开始在人群中收集信息。

栋栋收集的信息都是戴第几号面具的人看到了第几号面具的编号。如戴第 $2$ 号面具的人看到了第 $5$ 号面具的编号。栋栋自己也会看到一些编号，他也会根据自己的面具编号把信息补充进去。

由于并不是每个人都能记住自己所看到的全部编号，因此，栋栋收集的信息不能保证其完整性。现在请你计算，按照栋栋目前得到的信息，至多和至少有多少类面具。由于主办方已经声明了 $k\geq 3$，所以你必须将这条信息也考虑进去。

## 输入格式

第一行包含两个整数 $n, m$，用一个空格分隔，$n$ 表示主办方总共准备了多少个面具，$m$ 表示栋栋收集了多少条信息。接下来 $m$ 行，每行为两个用空格分开的整数 $a, b$，表示戴第 $a$ 号面具的人看到了第 $b$ 号面具的编号。相同的数对 $a, b$ 在输入文件中可能出现多次。

## 输出格式

包含两个数，第一个数为最大可能的面具类数，第二个数为最小可能的面具类数。如果无法将所有的面具分为至少 $3$ 类，使得这些信息都满足，则认为栋栋收集的信息有错误，输出两个 `-1`。

## 样例

### 样例输入 #1
```
6 5
1 2
2 3
3 4
4 1
3 5
```
### 样例输出 #1
```
4 4

```
### 样例输入 #2
```
3 3
1 2
2 1
2 3
```
### 样例输出 #2
```
-1 -1

```
## 提示

- 对于 $50\%$ 的数据，满足 $n \leq 300$，$m \leq 10^3$；
- 对于 $100\%$ 的数据，满足 $n \leq 10^5$，$m \leq 10^6$。



---

---
title: "[NOIP 2016 提高组] 天天爱跑步"
layout: "post"
diff: 省选/NOI-
pid: P1600
tag: ['2016', '线段树', 'NOIP 提高组', '最近公共祖先 LCA', '树链剖分', '动态树 LCT', '差分']
---
# [NOIP 2016 提高组] 天天爱跑步
## 题目背景

NOIP2016 提高组 D1T2
## 题目描述

小 C 同学认为跑步非常有趣，于是决定制作一款叫做《天天爱跑步》的游戏。《天天爱跑步》是一个养成类游戏，需要玩家每天按时上线，完成打卡任务。

这个游戏的地图可以看作一棵包含 $n$ 个结点和 $n-1$ 条边的树，每条边连接两个结点，且任意两个结点存在一条路径互相可达。树上结点编号为从 $1$ 到 $n$ 的连续正整数。

现在有 $m$ 个玩家，第 $i$ 个玩家的起点为 $s_i$，终点为 $t_i$。每天打卡任务开始时，所有玩家在第 $0$ 秒同时从自己的起点出发，以每秒跑一条边的速度，不间断地沿着最短路径向着自己的终点跑去，跑到终点后该玩家就算完成了打卡任务。（由于地图是一棵树，所以每个人的路径是唯一的）

小 C 想知道游戏的活跃度，所以在每个结点上都放置了一个观察员。在结点 $j$ 的观察员会选择在第 $w_j$ 秒观察玩家，一个玩家能被这个观察员观察到当且仅当该玩家在第 $w_j$ 秒也正好到达了结点 $j$。小 C 想知道每个观察员会观察到多少人?

注意：我们认为一个玩家到达自己的终点后该玩家就会结束游戏，他不能等待一 段时间后再被观察员观察到。 即对于把结点 $j$ 作为终点的玩家：若他在第 $w_j$ 秒前到达终点，则在结点 $j$ 的观察员不能观察到该玩家；若他正好在第 $w_j$ 秒到达终点，则在结点 $j$ 的观察员可以观察到这个玩家。

## 输入格式

第一行有两个整数 $n$ 和 $m$。其中 $n$ 代表树的结点数量, 同时也是观察员的数量, $m$ 代表玩家的数量。

接下来 $n-1$ 行每行两个整数 $u$ 和 $v$，表示结点 $u$ 到结点 $v$ 有一条边。

接下来一行 $n$ 个整数，其中第 $j$ 个整数为 $w_j$ , 表示结点 $j$ 出现观察员的时间。

接下来 $m$ 行，每行两个整数 $s_i$，和 $t_i$，表示一个玩家的起点和终点。

对于所有的数据，保证 $1\leq s_i,t_i\leq n, 0\leq w_j\leq n$。

## 输出格式

输出 $1$ 行 $n$ 个整数，第 $j$ 个整数表示结点 $j$ 的观察员可以观察到多少人。

## 样例

### 样例输入 #1
```
6 3
2 3
1 2 
1 4 
4 5 
4 6 
0 2 5 1 2 3 
1 5 
1 3 
2 6 
```
### 样例输出 #1
```
2 0 0 1 1 1 
```
### 样例输入 #2
```
5 3 
1 2 
2 3 
2 4 
1 5 
0 1 0 3 0 
3 1 
1 4
5 5 
```
### 样例输出 #2
```
1 2 1 0 1 
```
## 提示

**样例 1 说明**

对于 $1$ 号点，$w_i=0$，故只有起点为 $1$ 号点的玩家才会被观察到，所以玩家 $1$ 和玩家 $2$ 被观察到，共有 $2$ 人被观察到。

对于 $2$ 号点，没有玩家在第 $2$ 秒时在此结点，共 $0$ 人被观察到。

对于 $3$ 号点，没有玩家在第 $5$ 秒时在此结点，共 $0$ 人被观察到。

对于 $4$ 号点，玩家 $1$ 被观察到，共 $1$ 人被观察到。

对于 $5$ 号点，玩家 $1$ 被观察到，共 $1$ 人被观察到。

对于 $6$ 号点，玩家 $3$ 被观察到，共 $1$ 人被观察到。

**子任务**

每个测试点的数据规模及特点如下表所示。 

提示：数据范围的个位上的数字可以帮助判断是哪一种数据类型。

| 测试点编号 | $n=$ | $m=$ | 约定 |
| :--------: | :----: | :----: | :----: |
|     $1\sim 2$      |  $991$   |  $991$   | 所有人的起点等于自己的终点，即 $\forall i,\ s_i=t_i$  |
|     $3\sim 4$      |  $992$   |  $992$   | 所有 $w_j=0$  |
|     $5$      |  $993$   |  $993$   | 无  |
|     $6\sim 8$      |  $99994$   |  $99994$   | $\forall i\in[1,n-1]$，$i$ 与 $i+1$ 有边。即树退化成 $1,2,\dots,n$ 按顺序连接的链  |
|     $9\sim 12$      |  $99995$   |  $99995$   | 所有 $s_i=1$  |
|     $13\sim 16$      |  $99996$   |  $99996$   | 所有 $t_i=1$  |
|     $17\sim 19$      |  $99997$   |  $99997$   | 无  |
|     $20$      |  $299998$   |  $299998$   | 无  |



**提示**

（提示：由于原提示年代久远，不一定能完全反映现在的情况，现在已经对该提示做出了一定的修改，提示的原文可以在[该剪贴板](https://www.luogu.com.cn/paste/3fneb8m6)查看）

在最终评测时，调用栈占用的空间大小不会有单独的限制，但在我们的工作环境中默认会有 $1 \text{MiB}$ 的限制。 这可能会引起**函数调用层数较多时，程序发生栈溢出崩溃**，程序中**较深层数的递归**往往会导致这个问题。如果你的程序需要用到较大的栈空间，请务必注意该问题。

我们可以使用一些方法修改调用栈的大小限制。

- Linux

我们可以在终端中输入下列命令：`ulimit -s 1048576`。此命令的意义是，将调用栈的大小限制修改为 $1048576\text{KiB}=1 \text{GiB}$。

例如，对于如下程序 `sample.cpp`：

```cpp
#include <bits/stdc++.h>
using namespace std;
int f[1000005];
void dfs(int a){
	if(a == 0){
		f[a] = 0;
		return;
	}
	dfs(a - 1);
	f[a] = f[a - 1] + 1;
}
int main(){
	dfs(1000000);
	return 0;
}
```

将上述源代码用命令 `g++ sample.cpp -o sample` 编译为可执行文件 `sample` 后，使用 `./sample` 执行程序。

如果在没有使用命令 `ulimit -s 1048576` 的情况下运行该程序，`sample` 会因为栈溢出而崩溃；如果使用了上述命令后运行该程序，该程序则不会崩溃。

特别地，当你打开多个终端时，它们并不会共享该命令，你需要分别对它们运行该命令。

请注意，调用栈占用的空间会计入总空间占用中，和程序其他部分占用的内存共同受到内存限制。

- Windows

如果你使用 Windows 下的 Dev-C++，请选择 `工具-编译选项` 并在如下区域填入以下命令 `-Wl,--stack=1073741824`，填入后注意确认“编译时加入以下命令的”的框是**已勾选**状态。

此处 `1073741824` 的单位是 $\text{B/Bytes}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/z6mbzfqo.png)  ![](https://cdn.luogu.com.cn/upload/image_hosting/zvrzkyq5.png)


---

---
title: "帮助"
layout: "post"
diff: 省选/NOI-
pid: P1777
tag: ['NOI 导刊']
---
# 帮助
## 题目描述

Bubu 的书架乱成一团了！帮他一下吧！

他的书架上一共有 $n$ 本书。我们定义混乱值是连续相同高度书本的段数。例如，如果书的高度是 $[30,30,31,31,32]$，那么混乱值为 $3$；$[30,32,32,31]$ 的混乱度也是 $3$，但 $[31,32,31,32,31]$ 的混乱度是 $5$，这实在是太乱了。

Bubu 想尽可能地减少混乱度，但他有点累了，所以他决定最多取出 $k$ 本书，再随意将它们放到书架上。你能帮助他吗？
## 输入格式

每个输入文件包含最多 $20$ 组测试数据。

每组测试数据开头为两个整数 $n,k\ (1 \le k \le n \le 100)$，表示总共有 $n$ 本书，最多可以进行 $k$ 次搬书操作。

接下来一行有 $n$ 个整数，表示每本书的高度，从左到右。每本书的高度是 $25$ 到 $32$ 间的整数。

最后一组数据后有一行 $n=k=0$，表示输入结束。
## 输出格式

对于每一组数据，输出 $\text{Case}$ 标号和最终最小的混乱度。在每组数据后输出一个空行。

## 样例

### 样例输入 #1
```
5 2
25 25 32 32 25
5 1
25 26 25 26 25
0 0
```
### 样例输出 #1
```
Case 1: 2

Case 2: 3


```


---

---
title: "公共子序列"
layout: "post"
diff: 省选/NOI-
pid: P1819
tag: ['NOI 导刊']
---
# 公共子序列
## 题目描述

求 $3$ 个字符序列有多少个不同的公共子序列，不包括空序列。
## 输入格式

第一行为一个正整数 $n$，表示 $3$ 个序列的长度。

接下来 $3$ 行，每行一个无空格长度为 $n$ 的字符序列。只包含小写字母 `a` 到 `z`。
## 输出格式

一行一个正整数 $ans$，对 $10^8$ 取模。
## 样例

### 样例输入 #1
```
4   
aabb   
abab   
baba

```
### 样例输出 #1
```
5
```
## 提示

#### 样例 1解释

对于唯一的一个样例，有 $5$ 种子序列，分别是 `a`，`ab`，`aa`，`bb`，`b`。

#### 数据范围与约定

- 对于 $30\%$ 的数据，保证 $1 \le n \le 10$；
- 对于 $70\%$ 的数据，保证 $1 \le n \le 50$；
- 对于 $100\%$ 的数据，保证 $1 \le n \le 150$。


---

---
title: "[NOI2009] 二叉查找树"
layout: "post"
diff: 省选/NOI-
pid: P1864
tag: ['动态规划 DP', '2009', 'NOI', '区间 DP']
---
# [NOI2009] 二叉查找树
## 题目描述

已知一棵特殊的二叉查找树。根据定义，该二叉查找树中每个结点的数据值都比它左儿子结点的数据值大，而比它右儿子结点的数据值小。

另一方面，这棵查找树中每个结点都有一个权值，每个结点的权值都比它的儿子结点的权值要小。

已知树中所有结点的数据值各不相同；所有结点的权值也各不相同。这时可得出这样一个有趣的结论：如果能够确定树中每个结点的数据值和权值，那么树的形态便可以唯一确定。因为这样的一棵树可以看成是按照权值从小到大顺序插入结点所得到的、按照数据值排序的二叉查找树。

一个结点在树中的深度定义为它到树根的距离加 $1$。因此树的根结点的深度为 $1$。

每个结点除了数据值和权值以外，还有一个访问频度。我们定义一个结点在树中的访问代价为它的访问频度乘以它在树中的深度。整棵树的访问代价定义为所有结点在树中的访问代价之和。

现在给定每个结点的数据值、权值和访问频度，你可以根据需要修改某些结点的权值，但每次修改你会付出 $K$ 的额外修改代价。你可以把结点的权值改为任何实数，但是修改后所有结点的权值必须仍保持互不相同。现在你要解决的问题是，整棵树的访问代价与额外修改代价的和最小是多少？
## 输入格式

输入文件中的第一行为两个正整数 $N,K$。其中 $N$ 表示结点的个数，$K$ 表示每次修改所需的额外修改代价。

接下来的一行为 $N$ 个非负整数，表示每个结点的数据值。

再接下来的一行为 $N$ 个非负整数，表示每个结点的权值。

再接下来的一行为 $N$ 个非负整数，表示每个结点的访问频度。

其中：所有的数据值、权值、访问频度均不超过 $4 \times 10^5$。
## 输出格式

输出文件中仅一行为一个数，即你所能得到的整棵树的访问代价与额外修改代价之和的最小值。

## 样例

### 样例输入 #1
```
4 10
1 2 3 4
1 2 3 4
1 2 3 4

```
### 样例输出 #1
```
29
```
## 提示

### 样例解释

![](https://cdn.luogu.com.cn/upload/image_hosting/10bjubxe.png)

输入的原图是左图，它的访问代价是 $1 \times 1+2 \times 2+3 \times 3+4 \times 4=30$。

最佳的修改方案是把输入中的第 $3$ 个结点的权值改成 $0$，得到右图，访问代价是：$1 \times 2+2 \times 3+3 \times 1+4 \times 2=19$，加上额外修改代价 $10$，一共是 $29$。

### 数据范围

- 对于 $40\%$ 的数据，满足 $N \leq 30$；
- 对于 $70\%$ 的数据，满足 $N \leq 50$；
- 对于 $100\%$ 的数据，满足：$1 \leq N \leq 70$，$1 \leq K \leq 3 \times 10^7$。



---

---
title: "[NOI2009] 诗人小G"
layout: "post"
diff: 省选/NOI-
pid: P1912
tag: ['动态规划 DP', '贪心', '2009', 'NOI', 'Special Judge', '栈']
---
# [NOI2009] 诗人小G
## 题目描述

小 G 是一个出色的诗人，经常作诗自娱自乐。但是，他一直被一件事情所困扰，那就是诗的排版问题。

一首诗包含了若干个句子，对于一些连续的短句，可以将它们用空格隔开并放在一行中，注意一行中可以放的句子数目是没有限制的。小 G 给每首诗定义了一个行标准长度（行的长度为一行中符号的总个数），他希望排版后每行的长度都和行标准长度相差不远。显然排版时，不应改变原有的句子顺序，并且小 G 不允许把一个句子分在两行或者更多的行内。在满足上面两个条件的情况下，小 G 对于排版中的每行定义了一个不协调度, 为这行的实际长度与行标准长度差值绝对值的 $P$ 次方，而一个排版的不协调度为所有行不协调度的总和。

小 G 最近又作了几首诗，现在请你对这首诗进行排版，使得排版后的诗尽量协调（即不协调度尽量小），并把排版的结果告诉他。

## 输入格式

输入文件中的第一行为一个整数 $T$，表示诗的数量。

接下来为 $T$ 首诗，这里一首诗即为一组测试数据。每组测试数据中的第一行为三个由空格分隔的正整数 $N,L,P$，其中：$N$ 表示这首诗句子的数目，$L$ 表示这首诗的行标准长度，$P$ 的含义见问题描述。

从第二行开始，每行为一个句子，句子由英文字母、数字、标点符号等符号组成（ASCII 码 $33 \sim 127$，但不包含 `-`）。

## 输出格式

于每组测试数据，若最小的不协调度不超过 $10^{18}$，则第一行为一个数，表示不协调度。接下来若干行，表示你排版之后的诗。注意：在同一行的相邻两个句子之间需要用一个空格分开。

如果有多个可行解，它们的不协调度都是最小值，则输出任意一个解均可。若最小的不协调度超过 $10^{18}$，则输出 `Too hard to arrange`。每组测试数据结束后输出 `--------------------`，共 20 个 `-`，`-` 的 ASCII 码为 45，请勿输出多余的空行或者空格。
## 样例

### 样例输入 #1
```
4
4 9 3
brysj,
hhrhl.
yqqlm,
gsycl.
4 9 2
brysj,
hhrhl.
yqqlm,
gsycl.
1 1005 6
poet
1 1004 6
poet

```
### 样例输出 #1
```
108
brysj,
hhrhl.
yqqlm,
gsycl.
--------------------
32
brysj, hhrhl.
yqqlm, gsycl.
--------------------
Too hard to arrange
--------------------
1000000000000000000
poet
--------------------

```
## 提示

#### 样例输入输出 1 解释

前两组输入数据中每行的实际长度均为 $6$，后两组输入数据每行的实际长度均为 $4$。一个排版方案中每行相邻两个句子之间的空格也算在这行的长度中（可参见样例中第二组数据）。每行末尾没有空格。

#### 数据规模与约定

| 测试点 | $T$ | $N$ | $L$ | $P$ |
| - | - | - | - | - |
| $1$ | $\le 10$ | $\le18$ | $\le 100$ | $\le5$ |
| $2$ | $\le 10$ | $\le 2\times 10^3$ |  $\le 6\times 10^4$| $\le10$ |
| $3$ | $\le 10$ | $\le 2\times 10^3$ |  $\le 6\times 10^4$| $\le10$ |
| $4$ | $\le 5$ | $\le 10^5$ | $\le 200$ | $\le10$ |
| $5$ | $\le 5$ | $\le 10^5$ | $\le 200$ | $\le10$ |
| $6$ | $\le 5$ | $\le 10^5$ | $\le 3\times 10^6$ | $2$ |
| $7$ | $\le 5$ | $\le 10^5$ | $\le 3\times 10^6$ | $2$ |
| $8$ | $\le 5$ | $\le 10^5$ | $\le 3\times 10^6$ | $\le10$ |
| $9$ | $\le 5$ | $\le 10^5$ | $\le 3\times 10^6$ | $\le10$ |
| $10$ | $\le 5$ | $\le 10^5$ | $\le 3\times 10^6$ | $\le10$ |

所有句子的长度不超过 $30$ 。


---

---
title: "Local Maxima"
layout: "post"
diff: 省选/NOI-
pid: P1943
tag: ['数学', 'NOI 导刊']
---
# Local Maxima
## 题目描述

给出一个排列。如果其中一个数比它前面的数都大，则称为**局部最大值**（Local Maxima）。

现在问在一个长度为 $n$ 的随机生成的排列中，期望有多少个数为局部最大值。
## 输入格式

一行一个正整数 $n$。

## 输出格式

输出一行一个实数表示答案，保留八位小数。
## 样例

### 样例输入 #1
```
2
```
### 样例输出 #1
```
1.50000000
```
## 提示

长度为 $2$ 的排列共 $2$ 种，为 $(1,2)$ 和 $(2,1)$。前者两个数都为局部最大值，后者仅有第一个数 $2$ 为局部最大值。


### 数据范围及约定 

- 对于 $30\%$ 的数据，$n \leq 10$；
- 对于 $80\%$ 的数据，$n \leq 10^6$；
- 对于 $100\%$ 的数据，$1\leq n < 2^{31}$。



---

---
title: "[NOI2010] 航空管制"
layout: "post"
diff: 省选/NOI-
pid: P1954
tag: ['贪心', '2010', 'NOI', 'Special Judge', '深度优先搜索 DFS', '优先队列']
---
# [NOI2010] 航空管制
## 题目描述

世博期间，上海的航空客运量大大超过了平时，随之而来的航空管制也频频发生。最近，小 X 就因为航空管制，连续两次在机场被延误超过了两小时。对此，小 X 表示很不满意。

在这次来烟台的路上，小 X 不幸又一次碰上了航空管制。于是小 X 开始思考关于航空管制的问题。

假设目前被延误航班共有 $n$ 个，编号为 $1$ 至 $n$。机场只有一条起飞跑道，所有的航班需按某个顺序依次起飞（称这个顺序为起飞序列）。定义一个航班的起飞序号为该航班在起飞序列中的位置，即是第几个起飞的航班。

起飞序列还存在两类限制条件：

- 第一类（最晚起飞时间限制）：编号为 $i$ 的航班起飞序号不得超过 $k_i$。

- 第二类（相对起飞顺序限制）：存在一些相对起飞顺序限制 $(a,b)$，表示航班 $a$ 的起飞时间必须早于航班 $b$，即航班 $a$ 的起飞序号必须小于航班 $b$ 的起飞序号。

小 X 思考的第一个问题是，若给定以上两类限制条件，是否可以计算出一个可行的起飞序列。第二个问题则是，在考虑两类限制条件的情况下，如何求出每个航班在所有可行的起飞序列中的最小起飞序号。

## 输入格式

第一行包含两个正整数 $n$ 和 $m$，$n$ 表示航班数目，$m$ 表示第二类限制条件（相对起飞顺序限制）的数目。

第二行包含 $n$ 个正整数 $k_1,k_2,\cdots,k_n$。

接下来 $m$ 行，每行两个正整数 $a$ 和 $b$，表示一对相对起飞顺序限制 $(a,b)$，其中 $1\leq a,b\leq n$，表示航班 $a$ 必须先于航班 $b$ 起飞。
## 输出格式

第一行包含 $n$ 个整数，表示一个可行的起飞序列，相邻两个整数用空格分隔。输入数据保证至少存在一个可行的起飞序列。如果存在多个可行的方案，输出任意一个即可。

第二行包含 $n$ 个整数 $t_1,t_2,\cdots,t_n$，其中 $t_i$ 表示航班 $i$ 可能的最小起飞序号，相邻两个整数用空格分隔。
## 样例

### 样例输入 #1
```
5 5
4 5 2 5 4
1 2
3 2
5 1
3 4
3 1

```
### 样例输出 #1
```
3 5 1 4 2
3 4 1 2 1

```
### 样例输入 #2
```
5 0
3 3 3 5 5

```
### 样例输出 #2
```
3 2 1 5 4
1 1 1 4 4

```
## 提示

### 样例解释

在样例 $1$ 中：

起飞序列 $3\ 5\ 1\ 4\ 2$ 满足了所有的限制条件，所有满足条件的起飞序列有：

$$
\begin{aligned}
3\ 4\ 5\ 1\ 2\\
3\ 5\ 1\ 2\ 4\\
3\ 5\ 1\ 4\ 2\\
3\ 5\ 4\ 1\ 2\\
5\ 3\ 1\ 2\ 4\\
5\ 3\ 1\ 4\ 2\\
5\ 3\ 4\ 1\ 2
\end{aligned}
$$

由于存在 $(5,1)$ 和 $(3,1)$ 两个限制，航班 $1$ 只能安排在航班 $5$ 和 $3$ 之后，故最早起飞时间为 $3$，其他航班类似。

在样例 $2$ 中：

虽然航班 $4,5$ 没有相对起飞顺序限制，但是由于航班 $1,2,3$ 都必须安排在前 $3$ 个起飞，所以 $4,5$ 最早只能安排在第 $4$ 个起飞。

### 数据范围

对于 $30\%$ 数据：$n\leq 10$。

对于 $60\%$ 数据：$n\leq 500$。

对于 $100\%$ 数据：$n\leq 2\times 10^3,m\leq 10^4$。

感谢 @FlierKing 提供 spj



---

---
title: "[NOI2009] 变换序列"
layout: "post"
diff: 省选/NOI-
pid: P1963
tag: ['2009', 'NOI', '二分图']
---
# [NOI2009] 变换序列
## 题目描述

对于 $N$ 个整数 $0, 1, \cdots, N-1$，一个变换序列 $T$ 可以将 $i$ 变成 $T_i$，其中 $T_i \in \{ 0,1,\cdots, N-1\}$ 且 $\bigcup_{i=0}^{N-1} \{T_i\} = \{0,1,\cdots , N-1\}$。$\forall x,y \in  \{0,1,\cdots , N-1\}$，定义 $x$ 和 $y$ 之间的距离 $D(x,y)=\min\{|x-y|,N-|x-y|\}$。给定每个 $i$ 和 $T_i$ 之间的距离 $D(i,T_i)$，你需要求出一个满足要求的变换序列 $T$。如果有多个满足条件的序列，输出其中字典序最小的一个。

说明：对于两个变换序列 $S$ 和 $T$，如果存在 $p<N$，满足对于 $i=0,1,\cdots p-1$，$S_i=T_i$ 且 $S_p<T_p$，我们称 $S$ 比 $T$ 字典序小。
## 输入格式

第一行包含一个正整数 $N$，表示序列的长度。接下来的一行包含 $N$ 个整数 $D_i$，其中 $D_i$ 表示 $i$ 和 $T_i$ 之间的距离。
## 输出格式

如果至少存在一个满足要求的变换序列 $T$，则输出文件中包含一行 $N$ 个整数，表示你计算得到的字典序最小的 $T$；否则输出 `No Answer`（不含引号）。注意：输出文件中相邻两个数之间用一个空格分开，行末不包含多余空格。
## 样例

### 样例输入 #1
```
5
1 1 2 2 1

```
### 样例输出 #1
```
1 2 4 0 3
```
## 提示

- 对于 $30\%$ 的数据，满足：$N \le 50$；
- 对于 $60\%$ 的数据，满足：$N \le 500$；
- 对于 $100\%$ 的数据，满足：$N \le 10 ^ 4$。



---

---
title: "[NOI2011] NOI 嘉年华"
layout: "post"
diff: 省选/NOI-
pid: P1973
tag: ['动态规划 DP', '2011', '单调队列', 'NOI', 'Special Judge']
---
# [NOI2011] NOI 嘉年华
## 题目描述

NOI2011 在吉林大学开始啦！为了迎接来自全国各地最优秀的信息学选手，吉林大学决定举办两场盛大的 NOI 嘉年华活动，分在两个不同的地点举办。每个嘉年华可能包含很多个活动，而每个活动只能在一个嘉年华中举办。

现在嘉年华活动的组织者小安一共收到了 $n$ 个活动的举办申请，其中第 $i$ 个活动的起始时间为 $S_i$，活动的持续时间为 $T_i$。这些活动都可以安排到任意一个嘉年华的会场，也可以不安排。

小安通过广泛的调查发现，如果某个时刻，两个嘉年华会场同时有活动在进行（不包括活动的开始瞬间和结束瞬间），那么有的选手就会纠结于到底去哪个会场，从而变得不开心。所以，为了避免这样不开心的事情发生，小安要求不能有两个活动在两个会场同时进行（同一会场内的活动可以任意进行）。

另外，可以想象，如果某一个嘉年华会场的活动太少，那么这个嘉年华的吸引力就会不足，容易导致场面冷清。所以小安希望通过合理的安排，使得活动相对较少的嘉年华的活动数量最大。

此外，有一些活动非常有意义，小安希望能举办，他希望知道，如果第 $i$ 个活动必须举办（可以安排在两场嘉年华中的任何一个），活动相对较少的嘉年华的活动数量的最大值。

## 输入格式

输入的第一行包含一个整数 $n$，表示申请的活动个数。

接下来 $n$ 行描述所有活动，其中第 $i$ 行包含两个整数 $S_i,T_i$，表示第 $i$ 个活动从时刻 $S_i$ 开始，持续 $T_i$ 的时间。

## 输出格式

输出的第一行包含一个整数，表示在没有任何限制的情况下，活动较少的嘉年华的活动数的最大值。

接下来 $n$ 行每行一个整数，其中第 $i$ 行的整数表示在必须选择第 $i$ 个活动的前提下，活动较少的嘉年华的活动数的最大值。

## 样例

### 样例输入 #1
```
5 
8 2 
1 5 
5 3 
3 2 
5 3 
```
### 样例输出 #1
```
2 
2 
1 
2 
2 
2 
```
## 提示

### 样例解释

在没有任何限制的情况下，最优安排可以在一个嘉年华安排活动 $1, 4$，而在另一个嘉年华安排活动 $3, 5$，活动 $2$ 不安排。

对于 $10\%$ 的数据，$1\leq n\leq 10$。

对于 $30\%$ 的数据，$1\leq n\leq 40$。

对于 $100\%$ 的数据，$1\leq n\leq 200$，$0\leq S_i\leq 10^9$，$1\leq T_i\leq 10^9$。

如果输出格式不正确（比如输出不足 $n+1$ 行），得 $0$ 分；

如果输出文件第一行不正确，而且后 $n$ 行至少有一行不正确，得 $0$ 分；

如果输出文件第一行正确，但后 $n$ 行至少有一行不正确，得 $4$ 分；

如果输出文件第一行不正确，但后 $n$ 行均正确，得 $6$ 分；

如果输出文件中的 $n+1$ 行均正确，得 $10$ 分。



---

---
title: "[NOIP 2013 提高组] 华容道"
layout: "post"
diff: 省选/NOI-
pid: P1979
tag: ['搜索', '图论', '2013', 'NOIP 提高组']
---
# [NOIP 2013 提高组] 华容道
## 题目背景

NOIP2013 提高组 D2T3
## 题目描述

`小 B` 最近迷上了华容道，可是他总是要花很长的时间才能完成一次。于是，他想到用编程来完成华容道：给定一种局面， 华容道是否根本就无法完成，如果能完成， 最少需要多少时间。

`小 B` 玩的华容道与经典的华容道游戏略有不同，游戏规则是这样的：

1.   在一个 $n \times m$ 棋盘上有 $ n \times m$ 个格子，其中有且只有一个格子是空白的，其余 $ n \times m-1$ 个格子上每个格子上有一个棋子，每个棋子的大小都是 $1 \times 1$ 的；
2.  有些棋子是固定的，有些棋子则是可以移动的；
3.  任何与空白的格子相邻（有公共的边）的格子上的棋子都可以移动到空白格子上。   

游戏的目的是把某个指定位置可以活动的棋子移动到目标位置。

给定一个棋盘，游戏可以玩 $q$ 次，当然，每次棋盘上固定的格子是不会变的， 但是棋盘上空白的格子的初始位置、 指定的可移动的棋子的初始位置和目标位置却可能不同。第 $i$ 次玩的时候， 空白的格子在第 $EX_i$ 行第 $EY_i$ 列，指定的可移动棋子的初始位置为第 $SX_i$ 行第 $SY_i$列，目标位置为第 $TX_i$ 行第 $TY_i$ 列。

假设 `小 B` 每秒钟能进行一次移动棋子的操作，而其他操作的时间都可以忽略不计。请你告诉 `小 B` 每一次游戏所需要的最少时间，或者告诉他不可能完成游戏。

## 输入格式

第一行有 $3$个整数，每两个整数之间用一个空格隔开，依次表示 $ n,m,q$；

接下来的 $n$ 行描述一个 $ n \times m$ 的棋盘，每行有 $ m $ 个整数，每两个整数之间用一个空格隔开，每个整数描述棋盘上一个格子的状态，$0$ 表示该格子上的棋子是固定的，$1$ 表示该格子上的棋子可以移动或者该格子是空白的。  

接下来的 $q$ 行，每行包含 $6$ 个整数依次是 $EX_i,EY_i,SX_i,SY_i,TX_i,TY_i$，每两个整数之间用一个空格隔开，表示每次游戏空白格子的位置，指定棋子的初始位置和目标位置。

## 输出格式

共 $ q$ 行，每行包含 $1$ 个整数，表示每次游戏所需要的最少时间，如果某次游戏无法完成目标则输出 $−1$。

## 样例

### 样例输入 #1
```
3 4 2
0 1 1 1
0 1 1 0
0 1 0 0
3 2 1 2 2 2
1 2 2 2 3 2
```
### 样例输出 #1
```
2
-1
```
## 提示

**输入输出样例说明**

棋盘上划叉的格子是固定的，红色格子是目标位置，圆圈表示棋子，其中绿色圆圈表示目标棋子。

1.   第一次游戏，空白格子的初始位置是 $(3,2)$（图中空白所示），游戏的目标是将初始位置在 $(1, 2)$ 上的棋子（图中绿色圆圈所代表的棋子）移动到目标位置 $(2, 2)$（图中红色的格子）上。

移动过程如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/n0q385tw.png)

2.  第二次游戏，空白格子的初始位置是 $(1, 2)$（图中空白所示），游戏的目标是将初始位置在 $(2, 2)$ 上的棋子（图中绿色圆圈所示）移动到目标位置  $(3, 2)$ 上。

![](https://cdn.luogu.com.cn/upload/image_hosting/aq9apos0.png)

要将指定块移入目标位置，必须先将空白块移入目标位置，空白块要移动到目标位置，必然是从位置 $(2,2)$ 上与当前图中目标位置上的棋子交换位置，之后能与空白块交换位置的只有当前图中目标位置上的那个棋子，因此目标棋子永远无法走到它的目标位置， 游戏无法完成。

**数据范围**

对于 $ 30\%$ 的数据，$1 ≤ n, m ≤ 10,q = 1$；

对于 $60\%$ 的数据，$1 ≤ n, m ≤ 30,q ≤ 10$；

对于 $100\%$ 的数据，$1 ≤ n, m ≤ 30,q ≤ 500$。



---

---
title: "[NOI2011] 智能车比赛"
layout: "post"
diff: 省选/NOI-
pid: P1995
tag: ['动态规划 DP', '计算几何', '2011', 'NOI', 'Special Judge', '最短路']
---
# [NOI2011] 智能车比赛
## 题目描述

新一届智能车大赛在 JL 大学开始啦！比赛赛道可以看作是由 $n$ 个矩形区域拼接而成（如下图所示），每个矩形的边都平行于坐标轴，第 $i$ 个矩形区域的左下角和右上角坐标分别为 $(x_{i,1},y_{i,1})$ 和 $(x_{i,2},y_{i,2})$。

题目保证：$x_{i,1}<x_{i,2}=x_{i+1,1}$，且 $y_{i,1}< y_{i,2}$，相邻两个矩形一定有重叠在一起的边（如图中虚线所示），智能车可以通过这部分穿梭于矩形区域之间。

![](https://cdn.luogu.com.cn/upload/image_hosting/hu6cu53o.png)

选手们需要在最快的时间内让自己设计的智能车从一个给定的起点 $S$ 点到达一个给定的终点 $T$ 点，且智能车不能跑出赛道。假定智能车的速度恒为 $v$ 且转向不消耗任何时间，你能算出最快需要多少时间完成比赛么？

## 输入格式

输入的第一行包含一个正整数 $n$，表示组成赛道的矩形个数。

接下来 $n$ 行描述这些矩形，其中第 $i$ 行包含 $4$ 个整数 $x_{i,1}, y_{i,1}, x_{i,2}, y_{i,2}$，表示第 $i$ 个矩形左下角和右上角坐标分别为 $(x_{i,1}, y_{i,1})$ 和 $(x_{i,2}, y_{i,2})$。

接下来一行包含两个整数 $x_S, y_S$，表示起点坐标。

接下来一行包含两个整数 $x_T, y_T$，表示终点坐标。

接下来一行包含一个实数 $v$，表示智能车的速度。

## 输出格式

仅输出一个实数，至少精确到小数点后第六位，为智能车完成比赛的最快时间。

对于每个测试点，如果你的输出结果和参考结果相差不超过 $10^{-6}$，该测试点得满分，否则不得分。

## 样例

### 样例输入 #1
```
2  
1 1 2 2  
2 0 3 4  
1 1  
3 0  
1.0 
```
### 样例输出 #1
```
2.41421356
```
## 提示

![](https://cdn.luogu.com.cn/upload/image_hosting/m6t1j6pf.png)


---

---
title: "[NOI2005] 维护数列"
layout: "post"
diff: 省选/NOI-
pid: P2042
tag: ['模拟', '2005', '平衡树', 'NOI']
---
# [NOI2005] 维护数列
## 题目描述


请写一个程序，要求维护一个数列，支持以下 $6$ 种操作：

| 编号 | 名称 | 格式 | 说明 |
| :-----------: | :-----------: | :-----------: | :----------- |
| 1 | 插入 | $\operatorname{INSERT}\ posi \ tot \ c_1 \ c_2 \cdots c_{tot}$ | 在当前数列的第 $posi$ 个数字后插入 $tot$ 个数字：$c_1, c_2 \cdots c_{tot}$；若在数列首插入，则 $posi$ 为 $0$ |
| 2 | 删除 | $\operatorname{DELETE} \ posi \ tot$ | 从当前数列的第 $posi$ 个数字开始连续删除 $tot$ 个数字 |
| 3 | 修改 | $\operatorname{MAKE-SAME} \ posi \ tot \ c$ | 从当前数列的第 $posi$ 个数字开始的连续 $tot$ 个数字统一修改为 $c$ |
| 4 | 翻转 | $\operatorname{REVERSE} \ posi \ tot$ | 取出从当前数列的第 $posi$ 个数字开始的 $tot$ 个数字，翻转后放入原来的位置 |
| 5 | 求和 | $\operatorname{GET-SUM} \ posi \ tot$ | 计算从当前数列的第 $posi$ 个数字开始的 $tot$ 个数字的和并输出 |
| 6 | 求最大子列和 | $\operatorname{MAX-SUM}$ | 求出当前数列中和最大的一段子列，并输出最大和 |
## 输入格式

第一行包含两个整数 $N$ 和 $M$，$N$ 表示初始时数列中数的个数，$M$ 表示要进行的操作数目。

第二行包含 $N$ 个数字，描述初始时的数列。以下 $M$ 行，每行一条命令，格式参见问题描述中的表格。
## 输出格式

对于输入数据中的 $\operatorname{GET-SUM}$ 和 $\operatorname{MAX-SUM}$ 操作，向输出文件依次打印结果，每个答案（数字）占一行。
## 样例

### 样例输入 #1
```
9 8 
2 -6 3 5 1 -5 -3 6 3 
GET-SUM 5 4
MAX-SUM
INSERT 8 3 -5 7 2
DELETE 12 1
MAKE-SAME 3 3 2
REVERSE 3 6
GET-SUM 5 4
MAX-SUM
```
### 样例输出 #1
```
-1
10
1
10
```
## 提示

#### 数据规模与约定

- 你可以认为在任何时刻，数列中至少有 $1$ 个数。
- 输入数据一定是正确的，即指定位置的数在数列中一定存在。
- 对于 $50\%$ 的数据，任何时刻数列中最多含有 $3 \times 10^4$ 个数。
- 对于 $100\%$ 的数据，任何时刻数列中最多含有 $5 \times 10^5$ 个数，任何时刻数列中任何一个数字均在 $[-10^3, 10^3]$ 内，$1 \le M \le 2 \times 10^4$，插入的数字总数不超过 $4 \times 10^6$。

题面由 @syksykCCC 提供。


---

---
title: "[NOI2010] 海拔"
layout: "post"
diff: 省选/NOI-
pid: P2046
tag: ['图论', '2010', 'NOI', '最短路', '最小割']
---
# [NOI2010] 海拔
## 题目描述

YT 市是一个规划良好的城市，城市被东西向和南北向的主干道划分为 $n \times n$ 个区域。简单起见，可以将 YT 市看作 一个正方形，每一个区域也可看作一个正方形。从而，YT 城市中包括 $(n+1) \times (n+1)$ 个交叉路口和 $2n \times (n+1)$ 条双向道路（简称道路），每条双向道路连接主干道上两个相邻的交叉路口。下图为一张 YT 市的地图（$n = 2$），城市被划分为 $2 \times 2$ 个区域，包括 $3 \times 3$ 个交叉路口和 $12$ 条双向道路。

 ![](https://cdn.luogu.com.cn/upload/pic/1133.png) 

小 Z 作为该市的市长，他根据统计信息得到了每天上班高峰期间 YT 市每条道路两个方向的人流量，即在高峰期间沿着该方向通过这条道路的人数。每一个交叉路口都有不同的海拔高度值，YT 市市民认为爬坡是一件非常累的事情，每向上爬 $h$ 的高度，就需要消耗 $h$ 的体力。如果是下坡的话，则不需要耗费体力。因此如果一段道路的终点海拔减去起点海拔的值为 $h$（注意 $h$ 可能是负数），那么一个人经过这段路所消耗的体力是 $\max\{0, h\}$。

小 Z 还测量得到这个城市西北角的交叉路口海拔为 $0$，东南角的交叉路口海拔为 $1$（如上图所示），但其它交叉路口的海拔高度都无法得知。小 Z 想知道在最理想的情况下（即你可以任意假设其他路口的海拔高度），每天上班高峰期间所有人爬坡消耗的总体力和的最小值。
## 输入格式

第一行包含一个整数 $n$。

接下来 $4n(n + 1)$ 行，每行包含一个非负整数分别表示每一条道路每一个方向的人流量信息。

输入顺序：$n(n + 1)$个数表示所有从西到东方向的人流量，然后 $n(n + 1)$ 个数表示所有从北到南方向的人流量，$n(n + 1)$ 个数表示所有从东到西方向的人流量，最后是 $n(n + 1)$ 个数表示所有从南到北方向的人流量。对于每一个方向，输入顺序按照起点由北向南，若南北方向相同时由西到东的顺序给出（参见样例输入）。
## 输出格式

仅包含一个数，表示在最理想情况下每天上班高峰期间所有人爬坡所消耗的总体力和（即总体力和的最小值），结果四舍五入到整数。

## 样例

### 样例输入 #1
```
1
1
2
3
4
5
6
7
8
```
### 样例输出 #1
```
3
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/1134.png) 

### 数据范围

- 对于 $20\%$ 的数据：$n \leq 3$；
- 对于 $50\%$ 的数据：$n \leq 15$；
- 对于 $80\%$ 的数据：$n \leq 40$；
- 对于 $100\%$ 的数据：$1 \leq n \leq 500$，$0 \leq \text{流量} \leq 10^6$ 且所有流量均为整数。


---

---
title: "[NOI2010] 超级钢琴"
layout: "post"
diff: 省选/NOI-
pid: P2048
tag: ['贪心', '2010', '堆', 'NOI', 'O2优化', '前缀和', 'ST 表']
---
# [NOI2010] 超级钢琴
## 题目描述

小 Z 是一个小有名气的钢琴家，最近 C 博士送给了小 Z 一架超级钢琴，小 Z 希望能够用这架钢琴创作出世界上最美妙的音乐。

这架超级钢琴可以弹奏出 $n$ 个音符，编号为 $1$ 至 $n$。第 $i$ 个音符的美妙度为 $A_i$，其中 $A_i$ 可正可负。

一个“超级和弦”由若干个编号连续的音符组成，包含的音符个数不少于 $L$ 且不多于 $R$。我们定义超级和弦的美妙度为其包含的所有音符的美妙度之和。两个超级和弦被认为是相同的，当且仅当这两个超级和弦所包含的音符集合是相同的。

小 Z 决定创作一首由 $k$ 个超级和弦组成的乐曲，为了使得乐曲更加动听，小 Z 要求该乐曲由 $k$ 个不同的超级和弦组成。我们定义一首乐曲的美妙度为其所包含的所有超级和弦的美妙度之和。小 Z 想知道他能够创作出来的乐曲美妙度最大值是多少。
## 输入格式

输入第一行包含四个正整数 $n, k, L, R$。其中 $n$ 为音符的个数，$k$ 为乐曲所包含的超级和弦个数，$L$ 和 $R$ 分别是超级和弦所包含音符个数的下限和上限。

接下来 $n$ 行，每行包含一个整数 $A_i$，表示按编号从小到大每个音符的美妙度。
## 输出格式

输出只有一个整数，表示乐曲美妙度的最大值。

## 样例

### 样例输入 #1
```
4 3 2 3
3
2
-6
8
```
### 样例输出 #1
```
11
```
## 提示

### 样例解释

共有 $5$ 种不同的超级和弦：

1. 音符 $1 \sim 2$，美妙度为 $3+2=5$；
2. 音符 $2 \sim 3$，美妙度为 $2+(-6)=-4$；
3. 音符 $3 \sim 4$，美妙度为 $(-6)+8=2$；
4. 音符 $1 \sim 3$，美妙度为 $3+2+(-6)=-1$；
5. 音符 $2 \sim 4$，美妙度为 $2+(-6)+8=4$。

最优方案为：乐曲由和弦 $1,3,5$ 组成，美妙度为 $5+2+4=11$。

 ![](https://cdn.luogu.com.cn/upload/pic/2609.png) 

所有数据满足：$-1000 \leq A_i \leq 1000$，$1 \leq L \leq R \leq n$ 且保证一定存在满足要求的乐曲。



---

---
title: "[NOI2012] 美食节"
layout: "post"
diff: 省选/NOI-
pid: P2050
tag: ['2012', 'NOI', '网络流', '费用流']
---
# [NOI2012] 美食节
## 题目描述

CZ 市为了欢迎全国各地的同学，特地举办了一场盛大的美食节。

作为一个喜欢尝鲜的美食客，小 M 自然不愿意错过这场盛宴。他很快就尝遍了美食节所有的美食。然而，尝鲜的欲望是难以满足的。尽管所有的菜品都很可口，厨师做菜的速度也很快，小 M 仍然觉得自己桌上没有已经摆在别人餐桌上的美食是一件无法忍受的事情。于是小 M 开始研究起了做菜顺序的问题，即安排一个做菜的顺序使得同学们的等待时间最短。

小 M 发现，美食节共有 $n$ 种不同的菜品。每次点餐，每个同学可以选择其中的**一个菜品**。总共有 $m$ 个厨师来制作这些菜品。当所有的同学点餐结束后，菜品的制作任务就会分配给每个厨师。然后每个厨师就会同时开始做菜。**厨师们会按照要求的顺序进行制作，并且每次只能制作一人份**。

此外，小 M 还发现了另一件有意思的事情——虽然这 $m$ 个厨师都会制作全部的 $n$ 种菜品，但**对于同一菜品，不同厨师的制作时间未必相同**。他将菜品用 $1, 2, \ldots, n$ 依次编号，厨师用 $1, 2, \ldots, m$ 依次编号，将第 $j$ 个厨师制作第 $i$ 种菜品的时间记为 $t_{i,j}$。

小 M 认为：每个同学的等待时间为**所有厨师开始做菜起，到自己那份菜品完成为止**的时间总长度。换句话说，如果一个同学点的菜是某个厨师做的第 $k$ 道菜，则他的等待时间就是这个厨师制作前 $k$ 道菜的时间之和。而**总等待时间**为**所有同学的等待时间之和**。

现在，小 M 找到了所有同学的点菜信息——有 $p_i$ 个同学点了第 $i$ 种菜品（$i=1, 2, \ldots, n$）。他想知道的是最小的总等待时间是多少。

## 输入格式

输入文件的第 $1$ 行包含两个正整数 $n$ 和 $m$，表示菜品的种数和厨师的数量。

第 $2$ 行包含 $n$ 个正整数，其中第 $i$ 个数为 $p_i$，表示点第 $i$ 种菜品的人数。

接下来有 $n$ 行，每行包含 $m$ 个非负整数，这 $n$ 行中的第 $i$ 行的第 $j$ 个数为 $t_{i,j}$，表示第 $j$ 个厨师制作第 $i$ 种菜品所需的时间。

输入文件中每行相邻的两个数之间均由一个空格隔开，行末均没有多余空格。

## 输出格式

输出仅一行包含一个整数，为总等待时间的最小值。

## 样例

### 样例输入 #1
```
3 2 
3 1 1 
5 7 
3 6 
8 9
```
### 样例输出 #1
```
47
```
## 提示

厨师 $1$ 先制作 $1$ 份菜品 $2$，再制作 $2$ 份菜品 $1$。点这 $3$ 道菜的 $3$ 个同学的等待时间分别为 $3$，$3+5=8$，$3+5+5=13$。

厨师 $2$ 先制作 $1$ 份菜品 $1$，再制作 $1$ 份菜品 $3$。点这 $2$ 道菜的 $2$ 个同学的等待时间分别为 $7$，$7+9=16$。

总等待时间为 $3+8+13+7+16=47$。

虽然菜品 $1$ 和菜品 $3$ 由厨师 $1$ 制作更快，如果这些菜品都由厨师 $1$ 制作，总等待时间反而更长。如果按上述的做法，将 $1$ 份菜品 $1$ 和 $1$ 份菜品 $3$ 调整到厨师 $2$ 制作，这样厨师 $2$ 不会闲着，总等待时间更短。

可以证明，没有更优的点餐方案。

每组数据的 $n,m$ 和 $p$ 值如下：  

|测试点编号| $n$| $m$| $p$|   
|:------:|:----:|:----:|:----:|    
|$1$|$n = 5$| $m = 5$| $p = 10$|   
|$2$| $n = 40$| $m = 1$ |$p = 400$ |  
|$3$| $n = 40$| $m = 2$ |$p = 300$ |
|$4$| $n = 40$| $m = 40$| $p = 40$ |
|$5$| $n = 5$| $m = 40$| $p = 100$ |
|$6$| $n = 10$| $m = 50$| $p = 200$ |
|$7$| $n = 20$| $m = 60$| $p = 400$ |
|$8$| $n = 40$| $m = 80$| $p = 600$ |
|$9$| $n = 40$| $m = 100$| $p = 800$ |
|$10$| $n = 40$| $m = 100$| $p = 800$ |


对于 $100\%$ 的数据，$n \leq 40$，$m\leq 100$，$p\leq 800$，$t_{i,j}\leq 1000$（其中 $p = \sum p_i$）。



---

---
title: "[NOI2012] 迷失游乐园"
layout: "post"
diff: 省选/NOI-
pid: P2081
tag: ['动态规划 DP', '图论', '递推', '2012', 'NOI', 'Special Judge', '期望', '基环树']
---
# [NOI2012] 迷失游乐园
## 题目描述

放假了，小 Z 觉得呆在家里特别无聊，于是决定一个人去游乐园玩。

进入游乐园后，小 Z 看了看游乐园的地图，发现可以将游乐园抽象成有 $n$ 个景点、$m$ 条道路的无向连通图，且该图中至多有一个环（即 $m$ 只可能等于 $n$ 或者 $n-1$）。

小 Z 现在所在的大门也正好是一个景点。小 Z 不知道什么好玩，于是他决定，从当前位置出发，每次随机去一个和当前景点有道路相连的景点，并且同一个景点不去两次（包括起始景点）。贪玩的小 Z 会一直游玩，直到当前景点的相邻景点都已经访问过为止。

小 Z 所有经过的景点按顺序构成一条非重复路径，他想知道这条路径的期望长度是多少？

小 Z 把游乐园的抽象地图画下来带回了家，可是忘了标哪个点是大门，他只好假设每个景点都可能是大门（即每个景点作为起始点的概率是一样的）。同时，他每次在选择下一个景点时会等概率地随机选择一个还没去过的相邻景点。

## 输入格式

第一行是两个整数 $n$ 和 $m$ ，分别表示景点数和道路数。

接下来 $m$ 行，每行三个整数 $X_i, Y_i, W_i$，分别表示第 $i$ 条路径的两个景点为 $X_i, Y_i$，路径长 $W_i$。所有景点的编号从 $1$ 至 $n$，两个景点之间至多只有一条道路。

## 输出格式

共一行，包含一个实数，即路径的期望长度，保留五位小数。

## 样例

### 样例输入 #1
```
4 3
1 2 3
2 3 1
3 4 4
```
### 样例输出 #1
```
6.00000000
```
## 提示

### 样例解释

样例数据中共有 $6$ 条不同的路径：

|路径|长度|概率|
|:-:|:-:|:-:| 
|$1\rightarrow 4$|$8$|$\frac{1}{4}$| 
|$2\rightarrow 1$|$3$|$\frac{1}{8}$| 
|$2\rightarrow 4$|$5$|$\frac{1}{8}$|
|$3\rightarrow 1$|$4$|$\frac{1}{8}$|
|$3\rightarrow 4$|$4$|$\frac{1}{8}$|
|$4\rightarrow 1$|$8$|$\frac{1}{4}$|

因此期望长度 $= \frac{8}{4} + \frac{3}{8} + \frac{5}{8} +\frac{4}{8} + \frac{4}{8} +\frac{8}{4} = 6.00$

### 评分方法

本题没有部分分，你程序的输出只有和标准答案的差距不超过 $0.01$ 时，才能获得该测试点的满分，否则不得分。


### 数据规模和约定

对于 $100\%$ 的数据，$1\leq W_i\leq 100$。

|测试点编号|$n$|$m$|备注| 
|:-:|:-:|:-:|:-:|
|$1$| $n=10$| $m = n-1$| 保证图是链状 |
|$2$| $n=100$|  $m = n-1$|只有节点 $1$ 的度数大于 $2$| 
|$3$| $n=1000$| $m = n-1$| / | 
|$4$| $n=10^5$| $m = n-1$| / | 
|$5$| $n=10^5$|  $m = n-1$| / | 
|$6$| $n=10$| $m = n$ | / | 
|$7$| $n=100$| $m = n$| 环中节点个数 $\leq 5$| 
|$8$| $n=1000$|$m = n$| 环中节点个数 $\leq 10$| 
|$9$| $n=10^5$ | $m = n$| 环中节点个数 $\leq 15$| 
|$10$| $n=10^5$|$m = n$| 环中节点个数 $\leq 20$| 



---

---
title: "[NOI2007] 生成树计数"
layout: "post"
diff: 省选/NOI-
pid: P2109
tag: ['动态规划 DP', '2007', 'NOI', 'O2优化', '矩阵加速', '状压 DP']
---
# [NOI2007] 生成树计数
## 题目描述

最近，小栋在无向连通图的生成树个数计算方面有了惊人的进展，他发现：

- $n$ 个结点的环的生成树个数为 $n$。
- $n$ 个结点的完全图的生成树个数为 $n^{n-2}$ 。

这两个发现让小栋欣喜若狂，由此更加坚定了他继续计算生成树个数的想法，他要计算出各种各样图的生成树数目。

一天，小栋和同学聚会，大家围坐在一张大圆桌周围。小栋看了看，马上想到了生成树问题。如果把每个同学看成一个结点，邻座（结点间距离为 $1$）的同学间连一条边，就变成了一个环。可是，小栋对环的计数已经十分娴熟且不再感兴趣。于是，小栋又把图变了一下：不仅把邻座的同学之间连一条边，还把相隔一个座位（结点间距离为 $2$）的同学之间也连一条边，将结点间有边直接相连的这两种情况统称为 有边相连，如图 $1$ 所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/5lvvgbor.png) 

小栋以前没有计算过这类图的生成树个数，但是，他想起了老师讲过的计算任意图的生成树个数的一种通用方法：构造一个 $n\times n$ 的矩阵 $A=\{ a_{i,j}\}$，其中：

$$a_{i,j}=\begin{cases}
d_i & i=j \\
-1 & \text{$i, j$ 之间有边直接相连} \\
0 & \text{其他情况}
\end{cases}$$

与图 1 相应的 $A$ 矩阵如下所示。为了计算图 1 所对应的生成数的个数，只要去掉矩阵 $A$ 的最后一行和最后一列，得到一个 $(n-1)\times(n-1)$ 的矩阵 $B$，计算出矩阵 $B$ 的行列式的值便可得到图 1 的生成树的个数。

$$
A=\begin{bmatrix}
4 & -1 & -1 & 0 & 0 & 0 & -1 & -1 \\
-1 & 4 & -1 & -1 & 0 & 0 & 0 & -1 \\
-1 & -1 & 4 & -1 & -1 & 0 & 0 & 0 \\
0 & -1 & -1 & 4 & -1 & -1 & 0 & 0 \\
0 & 0 & -1 & -1 & 4 & -1 & -1 & 0 \\
0 & 0 & 0 & -1 & -1 & 4 & -1 & -1 \\
-1 & 0 & 0 & 0 & -1 & -1 & 4 & -1 \\
-1 & -1 & 0 & 0 & 0 & -1 & -1 & 4 \\
\end{bmatrix},\\
B=\begin{bmatrix}
4 & -1 & -1 & 0 & 0 & 0 & -1  \\
-1 & 4 & -1 & -1 & 0 & 0 & 0  \\
-1 & -1 & 4 & -1 & -1 & 0 & 0 \\
0 & -1 & -1 & 4 & -1 & -1 & 0 \\
0 & 0 & -1 & -1 & 4 & -1 & -1 \\
0 & 0 & 0 & -1 & -1 & 4 & -1 \\
-1 & 0 & 0 & 0 & -1 & -1 & 4 \\
\end{bmatrix},
$$

所以生成树的个数为 $\det B =3528$。小栋发现利用通用方法，因计算过于复杂而很难算出来，而且用其他方法也难以找到更简便的公式进行计算。于是，他将图做了简化，从一个地方将圆桌断开，这样所有的同学形成了一条链，连接距离为 1 和距离为 2 的点。例如八个点的情形如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/cfo7z7yu.png) 

这样生成树的总数就减少了很多。小栋不停的思考，一直到聚会结束，终于找到了一种快捷的方法计算出这个图的生成树个数。可是，如果把距离为 $3$ 的点也连起来，小栋就不知道如何快捷计算了。现在，请你帮助小栋计算这类图的生成树的数目。

## 输入格式

输入文件中包含两个整数 $k,n$，由一个空格分隔。$k$ 表示要将所有距离不超过 $k$（含 $k$）的结点连接起来，$n$ 表示有 $n$ 个结点。
## 输出格式

输出文件输出一个整数，表示生成树的个数。由于答案可能比较大，所以你只要输出答案除 $65521$ 的余数即可。
## 样例

### 样例输入 #1
```
3 5
```
### 样例输出 #1
```
75
```
## 提示

样例对应的图如下：

$$
A = \begin{bmatrix}
3 & -1 & -1 & -1 & 0 \\
-1 & 4 & -1 & -1 & -1 \\
-1 & -1 & 4 & -1 & -1 \\
-1 & -1 & -1 & 4 & -1 \\
0 & -1 & -1 & -1 & 3 \\
\end{bmatrix},
B = \begin{bmatrix}
3 & -1 & -1 & -1 \\
-1 & 4 & -1 & -1  \\
-1 & -1 & 4 & -1  \\
-1 & -1 & -1 & 4  \\
\end{bmatrix}, \det B = 75
$$

### 数据规模和约定

| 测试点编号 |   $k$   |      $n$      |
| :--------: | :-----: | :-----------: |
|     1      |  $=2$   |   $\le 10$    |
|     2      |  $=3$   |     $=5$      |
|     3      |  $=4$   |   $\le 10$    |
|     4      |  $=5$   |     $=10$     |
|     5      | $\le 3$ |   $\le 100$   |
|     6      | $\le 5$ |   $\le 100$   |
|     7      | $\le 3$ |  $\le 2000$   |
|     8      | $\le 5$ |  $\le 10000$  |
|     9      | $\le 3$ | $\le 10^{15}$ |
|     10     | $\le 5$ | $\le 10^{15}$ |

此外，对于所有数据，$2\le k\le n$。

### 提示

以下为行列式的一种计算方法。记 $\sigma(\bm P)$ 表示排列 $\bm P$ 中逆序对的数量，那么可以求得矩阵 $B$ 的行列式如下：

$$\det B=\sum_{\bm P=[p_1,p_2,\cdots,p_n]} (-1)^{\sigma(\bm P)} \prod_{i=1}^n b_{i,p_i}$$

例如，对于 $B=\begin{bmatrix}1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 0\end{bmatrix}$，其行列式计算如下：

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|c|}\hline
\bm P & \sigma(\bm P) & b_{1,p_1} & b_{2,p_2} & b_{3,p_3} & (-1)^{\sigma(\bm P)}\prod_{i=1}^n b_{i,p_i} \\ \hline
[1, 2, 3] & 0 & 1 & 5 & 0 & 0 \\ \hline
[1, 3, 2] & 1 & 1 & 6 & 8 & -48 \\\hline
[2, 1, 3] & 1 & 2 & 4 & 0 & 0 \\\hline
[2, 3, 1] & 2 & 2 & 6 & 7 & 84 \\\hline
[3, 1, 2] & 2 & 3 & 4 & 8 & 96 \\\hline
[3, 2, 1] & 3 & 3 & 5 & 7 & -105 \\\hline
\end{array}
$$

所以 $B$ 的行列式值为 $0-48+0+84+96-105=27$。



---

---
title: "[NOI2015] 寿司晚宴"
layout: "post"
diff: 省选/NOI-
pid: P2150
tag: ['动态规划 DP', '数学', '2015', 'NOI', '素数判断,质数,筛法', '状压 DP']
---
# [NOI2015] 寿司晚宴
## 题目描述

为了庆祝 NOI 的成功开幕，主办方为大家准备了一场寿司晚宴。小 G 和小 W 作为参加 NOI 的选手，也被邀请参加了寿司晚宴。

在晚宴上，主办方为大家提供了 $n−1$ 种不同的寿司，编号 $1,2,3,\ldots,n-1$，其中第 $i$ 种寿司的美味度为 $i+1$。（即寿司的美味度为从 $2$ 到 $n$）

现在小 G 和小 W 希望每人选一些寿司种类来品尝，他们规定一种品尝方案为不和谐的当且仅当：小 G 品尝的寿司种类中存在一种美味度为 $x$ 的寿司，小 W 品尝的寿司中存在一种美味度为 $y$ 的寿司，而 $x$ 与 $y$ 不互质。

现在小 G 和小 W 希望统计一共有多少种和谐的品尝寿司的方案（对给定的正整数 $p$ 取模）。注意一个人可以不吃任何寿司。

## 输入格式

输入文件的第 $1$ 行包含 $2$ 个正整数 $n, p$ 中间用单个空格隔开，表示共有 $n$ 种寿司，最终和谐的方案数要对 $p$ 取模。

## 输出格式

输出一行包含 $1$ 个整数，表示所求的方案模 $p$ 的结果。

## 样例

### 样例输入 #1
```
3 10000
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
4 10000
```
### 样例输出 #2
```
21
```
### 样例输入 #3
```
100 100000000
```
### 样例输出 #3
```
3107203
```
## 提示

【数据范围】


 ![](https://cdn.luogu.com.cn/upload/pic/1506.png) 


**勘误：$0 < p \le 10^9 $**


---

---
title: "[NOI2015] 品酒大会"
layout: "post"
diff: 省选/NOI-
pid: P2178
tag: ['2015', '并查集', 'NOI', '后缀数组 SA']
---
# [NOI2015] 品酒大会
## 题目描述

一年一度的“幻影阁夏日品酒大会”隆重开幕了。大会包含品尝和趣味挑战 两个环节，分别向优胜者颁发“首席品酒家”和“首席猎手”两个奖项，吸引了众多品酒师参加。


在大会的晚餐上，调酒师 Rainbow 调制了 $n$ 杯鸡尾酒。这 $n$ 杯鸡尾酒排成一行，其中第 $n$ 杯酒 ($1 ≤ i ≤ n$) 被贴上了一个标签 $s_i$ ，每个标签都是 $26$ 个小写 英文字母之一。设 $str(l, r)$ 表示第 $l$ 杯酒到第 $r$ 杯酒的 $r - l + 1$ 个标签顺次连接构成的字符串。若 $str(p, p_0) = str(q, q_0)$，其中 $1 ≤ p ≤ p_0 ≤ n$, $1 ≤ q ≤ q_0 ≤ n$, $p ≠ q$，$p_0-p+1 = q_0 - q + 1 = r$ ，则称第 $p$ 杯酒与第 $q$ 杯酒是“ $r$ 相似” 的。当然两杯“ $r$ 相似”($r > 1$)的酒同时也是“ $1$ 相似”、“ $2$ 相似”、……、“ $(r - 1)$ 相似”的。特别地，对于任意的 $1 ≤ p ,q ≤ n,p  ≠  q$，第 $p$ 杯酒和第 $q$ 杯酒都 是“ $0$ 相似”的。


在品尝环节上，品酒师 Freda 轻松地评定了每一杯酒的美味度，凭借其专业的水准和经验成功夺取了“首席品酒家”的称号，其中第 $i$ 杯酒 ($1 ≤ i ≤ n$) 的 美味度为 $a_i$ 。现在 Rainbow 公布了挑战环节的问题：本次大会调制的鸡尾酒有一个特点，如果把第 $p$ 杯酒与第 $q$ 杯酒调兑在一起，将得到一杯美味度为 $a_p\times a_q$ 的 酒。现在请各位品酒师分别对于 $r = 0,1,2,⋯,n-1$ ，统计出有多少种方法可以 选出 $2$ 杯“ $r$ 相似”的酒，并回答选择 $2$ 杯“$r$ 相似”的酒调兑可以得到的美味度的最大值。

## 输入格式

第 $1$ 行包含 $1$ 个正整数 $n$ ，表示鸡尾酒的杯数。

第 $2$ 行包含一个长度为 $n$ 的字符串 $S$，其中第 $i$ 个字符表示第 $i$ 杯酒的标签。

第 $3$ 行包含 $n$ 个整数，相邻整数之间用单个空格隔开，其中第 $i$ 个整数表示第 $i$ 杯酒的美味度 $a_i$ 。

## 输出格式

包括 $n$ 行。

第 $i$ 行输出 $2$ 个整数，中间用单个空格隔开。第 $1$ 个整 数表示选出两杯“ $(i - 1)$ 相似”的酒的方案数，第 2 个整数表示选出两杯 “ $(i - 1)$ 相似”的酒调兑可以得到的最大美味度。若不存在两杯“ $(i - 1)$ 相似” 的酒，这两个数均为 $0$ 。

## 样例

### 样例输入 #1
```
10
ponoiiipoi
2 1 4 7 4 8 3 6 4 7
```
### 样例输出 #1
```
45 56
10 56
3 32
0 0
0 0
0 0
0 0
0 0
0 0
0 0
```
### 样例输入 #2
```
12
abaabaabaaba
1 -2 3 -4 5 -6 7 -8 9 -10 11 -12

```
### 样例输出 #2
```
66 120
34 120
15 55
12 40
9 27
7 16
5 7
3 -4
2 -4
1 -4
0 0
0 0
```
## 提示

【样例说明 1】

用二元组 $(p, q)$ 表示第 $p$ 杯酒与第 $q$ 杯酒。

$0$ 相似：所有 $45$ 对二元组都是 $0$ 相似的，美味度最大的是 $8 × 7 = 56 $。

$1$ 相似： $(1,8) (2,4) (2,9) (4,9) (5,6) (5,7) (5,10) (6,7) (6,10) (7,10) $，最大的 $8 × 7 = 56$ 。

$2$ 相似： $(1,8) (4,9) (5,6)$ ，最大的 $4 × 8 = 32$ 。

没有 $3,4,5, ⋯ ,9$ 相似的两杯酒，故均输出 $0$ 。



 ![](https://cdn.luogu.com.cn/upload/pic/1508.png) 

【时限1s，内存512M】



---

---
title: "[NOI2014] 魔法森林"
layout: "post"
diff: 省选/NOI-
pid: P2387
tag: ['2014', 'NOI', '生成树', '动态树 LCT']
---
# [NOI2014] 魔法森林
## 题目背景

[hack数据的提交link](https://www.luogu.com.cn/problem/U163126)
## 题目描述

为了得到书法大家的真传，小 E 同学下定决心去拜访住在魔法森林中的隐士。魔法森林可以被看成一个包含 $n$ 个节点 $m$ 条边的无向图，节点标号为 $1,2,3,…,n$，边标号为 $1,2,3,…,m$。初始时小 E 同学在 $1$ 号节点，隐士则住在 $n$ 号节点。小 E 需要通过这一片魔法森林，才能够拜访到隐士。

魔法森林中居住了一些妖怪。每当有人经过一条边的时候，这条边上的妖怪 就会对其发起攻击。幸运的是，在 $1$ 号节点住着两种守护精灵：A 型守护精灵与 B 型守护精灵。小 E 可以借助它们的力量，达到自己的目的。

只要小 E 带上足够多的守护精灵，妖怪们就不会发起攻击了。具体来说，无向图中的每一条边 $e_i$ 包含两个权值 $a_i$ 与 $b_i$ 。若身上携带的 A 型守护精灵个数不少于 $a_i$ ，且 B 型守护精灵个数不少于 $b_i$ ，这条边上的妖怪就不会对通过这条边的人发起攻击。当且仅当通过这片魔法森林的过程中没有任意一条边的妖怪向 小 E 发起攻击，他才能成功找到隐士。

由于携带守护精灵是一件非常麻烦的事，小 E 想要知道，要能够成功拜访到 隐士，最少需要携带守护精灵的总个数。守护精灵的总个数为 A 型守护精灵的个数与 B 型守护精灵的个数之和。

## 输入格式

输入文件的第 $1$ 行包含两个整数 $n,m$，表示无向图共有 $n$ 个节点，$m$ 条边。 接下来 $m$ 行，第 $i+1$ 行包含 $4$ 个正整数 $X_i,Y_i,a_i,b_i$，描述第 $i$ 条无向边。 其中 $X_i$ 与 $Y_i$ 为该边两个端点的标号，$a_i$ 与 $b_i$ 的含义如题所述。 注意数据中可能包含重边与自环。

## 输出格式

输出一行一个整数：如果小 E 可以成功拜访到隐士，输出小 E 最少需要携 带的守护精灵的总个数；如果无论如何小 E 都无法拜访到隐士，输出 `-1`。

## 样例

### 样例输入 #1
```
4 5 
1 2 19 1 
2 3 8 12 
2 4 12 15 
1 3 17 8 
3 4 1 17 
```
### 样例输出 #1
```
32

```
### 样例输入 #2
```
3 1 
1 2 1 1 
```
### 样例输出 #2
```
-1
```
## 提示

\* 解释1

如果小 E 走路径 $1\to 2\to 4$，需要携带 $19+15=34$ 个守护精灵； 如果小 E 走路径 $1\to 3\to 4$，需要携带 $17+17=34$ 个守护精灵； 如果小 E 走路径 $1\to 2\to 3\to 4$，需要携带 $19+17=36$ 个守护精灵； 如果小 E 走路径  $1\to 3\to 2\to 4$，需要携带 $17+15=32$ 个守护精灵。 综上所述，小 E 最少需要携带 $32$ 个守护精灵。

\* 解释2

小 E 无法从 $1$ 号节点到达 $3$ 号节点，故输出 `-1`。

![](https://cdn.luogu.com.cn/upload/pic/2593.png)



---

---
title: "[NOI2011] 阿狸的打字机"
layout: "post"
diff: 省选/NOI-
pid: P2414
tag: ['字符串', '树形数据结构', '2011', 'NOI', '深度优先搜索 DFS', 'AC 自动机']
---
# [NOI2011] 阿狸的打字机
## 题目描述

阿狸喜欢收藏各种稀奇古怪的东西，最近他淘到一台老式的打字机。打字机上只有 $28$ 个按键，分别印有 $26$ 个小写英文字母和 `B`、`P` 两个字母。经阿狸研究发现，这个打字机是这样工作的：

* 输入小写字母，打字机的一个凹槽中会加入这个字母(这个字母加在凹槽的最后)。
* 按一下印有 `B` 的按键，打字机凹槽中最后一个字母会消失。
* 按一下印有 `P` 的按键，打字机会在纸上打印出凹槽中现有的所有字母并换行，但凹槽中的字母不会消失。

例如，阿狸输入 `aPaPBbP`，纸上被打印的字符如下：

```
a
aa
ab
```

我们把纸上打印出来的字符串从 $1$ 开始顺序编号，一直到 $n$。打字机有一个非常有趣的功能，在打字机中暗藏一个带数字的小键盘，在小键盘上输入两个数 $(x,y)$（其中 $1\leq x,y\leq n$），打字机会显示第 $x$ 个打印的字符串在第 $y$ 个打印的字符串中出现了多少次。

阿狸发现了这个功能以后很兴奋，他想写个程序完成同样的功能，你能帮助他么？

## 输入格式

输入的第一行包含一个字符串，按阿狸的输入顺序给出所有阿狸输入的字符。

第二行包含一个整数 $m$，表示询问个数。

接下来 $m$ 行描述所有由小键盘输入的询问。其中第 $i$ 行包含两个整数 $x, y$，表示第 $i$ 个询问为 $(x, y)$。

## 输出格式

输出 $m$ 行，其中第 $i$ 行包含一个整数，表示第 $i$ 个询问的答案。

## 样例

### 样例输入 #1
```
aPaPBbP
3
1 2
1 3
2 3
```
### 样例输出 #1
```
2
1
0
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n\leq 10^5$，$1\leq m\leq10^5$，第一行总长度 $\leq 10^5$。

|测试点|$n$ 的规模|$m$ 的规模|字符串长度|第一行长度|
|:-:|:-:|:-:|:-:|:-:|
|$1,2$|$1\leq n\leq 100$|$1\leq m\leq 10^3$| - |$\leq 100$|
|$3,4$|$1\leq n\leq 10^3$|$1\leq m\leq 10^4$|单个长度 $\leq 10^3$，总长度 $\leq 10^5$|$\leq 10^5$|
|$5\sim 7$|$1\leq n\leq 10^4$|$1\leq m\leq 10^5$|总长度 $\leq 10^5$|$\leq 10^5$|
|$8\sim 10$|$1\leq n\leq 10^5$|$1\leq m\leq 10^5$| - |$\leq 10^5$|




---

---
title: "[NOIP 2015 提高组] 斗地主 加强版"
layout: "post"
diff: 省选/NOI-
pid: P2540
tag: ['2015', 'NOIP 提高组', '深度优先搜索 DFS', '剪枝']
---
# [NOIP 2015 提高组] 斗地主 加强版
## 题目描述

牛牛最近迷上了一种叫斗地主的扑克游戏。斗地主是一种使用黑桃、红心、梅花、方片的 $A$ 到 $K$ 加上大小王的共 $54$ 张牌来进行的扑克牌游戏。在斗地主中，牌的大小关系根据牌的数码表示如下：$3<4<5<6<7<8<9<10<J<Q<K<A<2<\text{小王}<\text{大王}$，而花色并不对牌的大小产生影响。每一局游戏中，一副手牌由 $n$ 张牌组成。游戏者每次可以根据规定的牌型进行出牌，首先打光自己的手牌一方取得游戏的胜利。

现在，牛牛只想知道，对于自己的若干组手牌，分别最少需要多少次出牌可以将它们打光。请你帮他解决这个问题。

需要注意的是，本题中游戏者每次可以出手的牌型与一般的斗地主相似而略有不同。具体规则如下：

 ![](https://cdn.luogu.com.cn/upload/pic/1827.png) 

**在此题中认为两个王不能组成对子牌**。

## 输入格式

第一行包含用空格隔开的 $2$ 个正整数 $T,n$，表示手牌的组数以及每组手牌的张数。

接下来 $T$ 组数据，每组数据 $n$ 行，每行一个非负整数对 $a_i,b_i$，表示一张牌，其中 $a_i$ 表示牌的数码，$b_i$ 表示牌的花色，中间用空格隔开。特别的，我们用 $1$ 来表示数码 $A$，$11$ 表示数码 $J$，$12$ 表示数码 $Q$，$13$ 表示数码 $K$；黑桃、红心、梅花、方片分别用 $1-4$ 来表示；小王的表示方法为 `0 1`，大王的表示方法为 `0 2`。
## 输出格式

共 $T$ 行，每行一个整数，表示打光第 $i$ 手牌的最少次数。

## 样例

### 样例输入 #1
```
1 8
7 4
8 4
9 1
10 4
11 1
5 1
1 4
1 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
1 17
12 3
4 3
2 3
5 4
10 2
3 3
12 2
0 1
1 3
10 1
6 2
12 1
11 3
5 2
12 4
2 2
7 2
```
### 样例输出 #2
```
6
```
## 提示

#### 样例 1 说明

共有 $1$ 组手牌，包含 $8$ 张牌：方片 $7$，方片 $8$，黑桃 $9$，方片 $10$，黑桃 $J$，黑桃 $5$，方片 $A$ 以及黑桃 $A$。可以通过打单顺子（方片 $7$，方片 $8$，黑桃 $9$，方片 $10$，黑桃 $J$），单张牌（黑桃 $5$）以及对子牌（黑桃 $A$ 以及方片 $A$）在 $3$ 次内打光。

#### 数据范围与提示

对于前 $20$ 个测试点， 我们约定手牌组数 $T$ 与张数 $n$ 的规模如下：

 ![](https://cdn.luogu.com.cn/upload/pic/1828.png) 

数据不保证所有的手牌都是随机生成的。



---

---
title: "[NOI2009] 植物大战僵尸"
layout: "post"
diff: 省选/NOI-
pid: P2805
tag: ['2009', 'NOI', '网络流', '图论建模', '拓扑排序', '最小割']
---
# [NOI2009] 植物大战僵尸
## 题目背景

Plants vs. Zombies（PVZ）是最近十分风靡的一款小游戏。Plants（植物）和 Zombies（僵尸）是游戏的主角，其中 Plants 防守，而 Zombies 进攻。该款游戏包含多种不同的挑战系列，比如 Protect Your Brain、Bowling 等等。其中最为经典的，莫过于玩家通过控制 Plants 来防守 Zombies 的进攻，或者相反地由玩家通过控制 Zombies 对 Plants 发起进攻。


## 题目描述

现在，我们将要考虑的问题是游戏中 Zombies 对 Plants 的进攻，请注意，本题中规则与实际游戏**有所不同**。游戏中有两种角色，Plants 和 Zombies，每个 Plant 有一个攻击位置集合，它可以对这些位置进行保护；而 Zombie 进攻植物的方式是走到植物所在的位置上并将其吃掉。

游戏的地图可以抽象为一个 $N$ 行 $M$ 列的矩阵，行从上到下用 $0$ 到 $N–1$ 编号，列从左到右用 $0$ 到 $M–1$ 编号；在地图的每个位置上都放有一个 $Plant$，为简单起见，我们把位于第 $r$ 行第 $c$ 列的植物记为 $P_{r, c}$。

Plants 分很多种，有「攻击类」「防守类」和「经济类」等等。为了简单的描述每个 Plant，定义 $\operatorname{Score}$ 和 $\operatorname{Attack}$ 如下：

* $\operatorname{Score}(P_{r, c})$ — Zombie 击溃植物 $P_{r, c}$ 可获得的能源。   
若 $\operatorname{Score}(P_{r, c})$ 为非负整数，则表示击溃植物 $P_{r, c}$ 可获得能源 $\operatorname{Score}(P_{r, c})$，若为负数表示击溃 $P_{r, c}$ 需要付出能源 $-\operatorname{Score}(P_{r, c})$。

* $\operatorname{Attack}(P_{r, c})$ — 植物 $P_{r, c}$ 能够对 Zombie 进行攻击的位置集合。

Zombies 必须从地图的右侧进入，且只能沿着水平方向进行移动。Zombies 攻击植物的唯一方式就是走到该植物所在的位置并将植物吃掉。因此 Zombies 的进攻总是从地图的右侧开始。也就是说，对于第 $r$ 行的进攻，Zombies 必须首先攻击 $P_{r, M-1}$；若需要对 $P_{r, c}$（$0 \le c < m - 1$）攻击，必须将 $P_{r,M-1}, P_{r, M-2} \cdots P_{r, c+1}$ 先击溃，并移动到位置 $(r, c)$ 才可进行攻击。

在本题的设定中，Plants 的攻击力是无穷大的，一旦 Zombie 进入某个 Plant 的攻击位置，该 Zombie 会被瞬间消灭，而该 Zombie 没有时间进行任何攻击操作。因此，即便 Zombie 进入了一个 Plant 所在的位置，但该位置属于其他植物的攻击位置集合，则 Zombie 会被瞬间消灭而所在位置的植物则安然无恙（在我们的设定中，Plant 的攻击位置不包含自身所在位置，否则你就不可能击溃它了）。

Zombies 的目标是对 Plants 的阵地发起进攻并获得最大的能源收入。每一次，你可以选择一个可进攻的植物进行攻击。本题的目标为，制定一套 Zombies 的进攻方案，选择进攻哪些植物以及进攻的顺序，从而获得最大的能源收入。
## 输入格式

第一行包含两个正整数 $N$ 和 $M$，分别表示地图的行数和列数。

接下来 $N \times M$ 行描述每个位置上植物的信息。第 $r \times M + c + 1$ 行按照如下格式给出植物 $P_{r, c}$ 的信息：

第一个整数为 $\operatorname{Score}(P_{r,c})$，第二个整数为集合 $\operatorname{Attack}(P_{r,c})$ 中的位置个数 $w$，接下来 $w$ 个位置信息 $(r', c')$，表示 $P_{r, c}$ 可以攻击位置第 $r'$ 行第 $c'$ 列。


## 输出格式

仅包含一个整数，表示可以获得的最大能源收入。注意，你也可以选择不进行任何攻击，这样能源收入为 $0$。
## 样例

### 样例输入 #1
```
3 2
10 0
20 0
-10 0
-5 1 0 0
100 1 2 1
100 0
```
### 样例输出 #1
```
25
```
## 提示

#### 数据规模与约定
- 对于 $20\%$ 的数据，保证 $ N, M \le 5$。
- 对于 $40\%$ 的数据，保证 $ N, M \le 10$。
- 对于 $100\%$ 的数据，保证 $1 \le N \le 20$，$1 \le M \le 30$，$-10^4 ≤ \operatorname{Score} \le 10^4$。

#### 说明
题面由 @syksykCCC 修改。


---

---
title: "[NOI2017] 整数"
layout: "post"
diff: 省选/NOI-
pid: P3822
tag: ['高精度', '2017', '线段树', 'NOI', 'O2优化', '进制']
---
# [NOI2017] 整数
## 题目背景

在人类智慧的山巅，有着一台字长为 $1\,048\,576$ 位（此数字与解题无关）的超级计算机，著名理论计算机科学家 P 博士正用它进行各种研究。不幸的是，这天台风切断了电力系统，超级计算机无法工作，而 P 博士明天就要交实验结果了，只好求助于学过 OI 的你...

## 题目描述

P 博士将他的计算任务抽象为对一个整数的操作。

具体来说，有一个整数 $x$，一开始为 $0$。

接下来有 $n$ 个操作，每个操作都是以下两种类型中的一种：

- `1 a b`：将 $x$ 加上整数 $a\cdot 2^b$，其中 $a$ 为一个整数，$b$ 为一个非负整数

- `2 k` ：询问 $x$ 在用二进制表示时，位权为 $2^k$ 的位的值（即这一位上的 $1$ 代表 $2^k$）

保证在任何时候，$x\geqslant 0$。
## 输入格式

输入的第一行包含四个正整数 $n,t_1,t_2,t_3$，$n$ 的含义见题目描述，$t_1$，$t_2$，$t_3$ 的具体含义见子任务。

接下来 $n$ 行，每行给出一个操作，具体格式和含义见题目描述。
## 输出格式

对于每个询问操作，输出一行，表示该询问的答案（$0$ 或 $1$）。对于加法操作，没有任何输出。

## 样例

### 样例输入 #1
```
10 3 1 2
1 100 0
1 2333 0
1 -233 0
2 5
2 7
2 15
1 5 15
2 15
1 -1 12
2 15
```
### 样例输出 #1
```
0
1
0
1
0
```
## 提示

在所有测试点中，$1\leqslant t_1 \leqslant 3, 1 \leqslant t_2 \leqslant 4, 1 \leqslant t_3 \leqslant 2$。不同的 $t_1, t_2, t_3$ 对应的特殊限制如下：

- 对于 $t_1 = 1$ 的测试点，满足 $a = 1$；
- 对于 $t_1 = 2$ 的测试点，满足 $|a| = 1$；
- 对于 $t_1 = 3$ 的测试点，满足 $|a| \leqslant 10^9$；
- 对于 $t_2 = 1$ 的测试点，满足 $0 \leqslant b, k \leqslant 30$；
- 对于 $t_2 = 2$ 的测试点，满足 $0 \leqslant b, k \leqslant 100$；
- 对于 $t_2 = 3$ 的测试点，满足 $0 \leqslant b, k \leqslant n$；
- 对于 $t_2 = 4$ 的测试点，满足 $0 \leqslant b, k \leqslant 30n$；
- 对于 $t_3 = 1$ 的测试点，保证所有询问操作都在所有修改操作之后；
- 对于 $t_3 = 2$ 的测试点，不保证询问操作和修改操作的先后顺序。

本题共 25 个测试点，每个测试点 4 分。各个测试点的数据范围如下：

| 测试点编号 | $n \le$ | $t_1$ | $t_2$ | $t_3$ |
|:-:|:-:|:-:|:-:|:-:|
| $1$ | $10$ | $3$ | $1$ | $2$ |
| $2$ | $100$ | $3$ | $2$ | $2$ |
| $3$ | $2000$ | $3$ | $2$ | $2$ |
| $4$ | $4000$ | $1$ | $3$ | $2$ |
| $5$ | $6000$ | $3$ | $3$ | $1$ |
| $6$ | $8000$ | $2$ | $3$ | $2$ |
| $7$ | $9000$ | $3$ | $4$ | $2$ |
| $8$ | $10000$ | $3$ | $3$ | $2$ |
| $9$ | $30000$ | $3$ | $4$ | $2$ |
| $10$ | $50000$ | $3$ | $4$ | $1$ |
| $11$ | $60000$ | $3$ | $3$ | $2$ |
| $12$ | $65000$ | $2$ | $4$ | $2$ |
| $13$ | $70000$ | $3$ | $4$ | $2$ |
| $14$ | $200000$ | $3$ | $4$ | $2$ |
| $15$ | $300000$ | $2$ | $4$ | $2$ |
| $16$ | $400000$ | $3$ | $4$ | $2$ |
| $17$ | $500000$ | $3$ | $3$ | $2$ |
| $18$ | $600000$ | $3$ | $4$ | $2$ |
| $19$ | $700000$ | $3$ | $4$ | $2$ |
| $20$ | $800000$ | $1$ | $4$ | $2$ |
| $21$ | $900000$ | $2$ | $4$ | $2$ |
| $22$ | $930000$ | $3$ | $3$ | $2$ |
| $23$ | $960000$ | $3$ | $4$ | $1$ |
| $24$ | $990000$ | $3$ | $3$ | $2$ |
| $25$ | $1000000$ | $3$ | $4$ | $2$ |


---

---
title: "[NOI2017] 蚯蚓排队"
layout: "post"
diff: 省选/NOI-
pid: P3823
tag: ['字符串', '2017', 'NOI', 'O2优化', '哈希 hashing']
---
# [NOI2017] 蚯蚓排队
## 题目描述

蚯蚓幼儿园有 $n$ 只蚯蚓。幼儿园园长神刀手为了管理方便，时常让这些蚯蚓们列队表演。

所有蚯蚓用从 $1$ 到 $n$ 的连续正整数编号。每只蚯蚓的长度可以用一个正整数表示，根据入园要求，所有蚯蚓的长度都不超过 $6$ 。神刀手希望这些蚯蚓排成若干个队伍，初始时，每只蚯蚓各自排成一个仅有一只蚯蚓的队伍，该蚯蚓既在队首，也在队尾。

神刀手将会依次进行 $m$ 次操作，每个操作都是以下三种操作中的一种：

1. 给出 $i$ 和 $j$ ，令 $i$ 号蚯蚓与 $j$ 号蚯蚓所在的两个队伍合并为一个队伍，具体来说，令 $j$ 号蚯蚓紧挨在 $i$ 号蚯蚓之后，其余蚯蚓保持队伍的前后关系不变。

2. 给出 $i$ ，令 $i$ 号蚯蚓与紧挨其后的一只蚯蚓分离为两个队伍，具体来说，在分离之后， $i$ 号蚯蚓在其中一个队伍的队尾，原本紧挨其后的那一只蚯蚓在另一个队伍的队首，其余蚯蚓保持队伍的前后关系不变。

3. 给出一个正整数 $k$ 和一个长度至少为 $k$ 的数字串 $s$ ，对于 $s$ 的每个长度为 $k$ 的连续子串 $t$ （这样的子串共有 $|s|-k+1$ 个，其中 $|s|$ 为 $s$ 的长度），定义函数 $f(t)$，询问所有这些 $f(t)$ 的**乘积**对 $998244353$ 取模后的结果。其中 $f(t)$ 的定义如下：

对于当前的蚯蚓队伍，定义某个蚯蚓的**向后 $k$ 数字串**为：从该蚯蚓出发，沿队伍的向后方向，寻找最近的 $k$ 只蚯蚓（包括其自身），将这些蚯蚓的长度视作字符连接而成的数字串；如果这样找到的蚯蚓不足 $k$ 只，则其没有**向后$k$数字串**。例如蚯蚓的队伍为 $10$ 号蚯蚓在队首，其后是 $22$ 号蚯蚓，其后是 $3$ 号蚯蚓（为队尾），这些蚯蚓的长度分别为 $4$ 、 $5$ 、 $6$ ，则 $10$ 号蚯蚓的**向后 $3$ 数字串**为 `456`， $22$ 号蚯蚓没有**向后 $3$ 数字串**，但其**向后 $2$ 数字串**为 `56`，其**向后 $1$ 数字串**为 `5`。

而 $f(t)$ 表示所有蚯蚓中，**向后 $k$ 数字串**恰好为 $t$ 的蚯蚓只数。
## 输入格式

输入文件的第一行有两个正整数 $n,m$ ，分别表示蚯蚓的只数与操作次数。

第二行包含 $n$ 个不超过 $6$ 的正整数，依次表示编号为 $1,2,\dots,n$ 的蚯蚓的长度。

接下来 $m$ 行，每行表示一个操作。每个操作的格式可以为：

* `1` $i$ $j$（$1 \leq i, j \leq n$）表示：令 $i$ 号与 $j$ 号蚯蚓**所在**的两个队伍合并为一个队伍，新队伍中， $j$ 号蚯蚓紧挨在 $i$ 号蚯蚓之后。保证在此操作之前， $i$ 号蚯蚓在某个队伍的队尾，$j$ 号蚯蚓在某个队伍的队首，且两只蚯蚓不在同一个队伍中。

* `2` $i$（$1 \leq i \leq n$）表示：令 $i$ 号蚯蚓与紧挨其后一个蚯蚓分离为两个队伍。保证在此操作之前， $i$ 号蚯蚓不是某个队伍的队尾。

* `3` $s$ $k$（$k$为正整数，$s$为一个长度至少为$k$的数字串）表示：询问 $s$ 的每个长度为 $k$ 的子串 $t$ 的 $f(t)$ 的乘积，对 998244353 取模的结果。 $f(t)$ 的定义见题目描述。

同一行输入的相邻两个元素之间，用恰好一个空格隔开。

输入文件可能较大，请不要使用过于缓慢的读入方式。
## 输出格式

依次对于每个形如 `3 s k` 的操作，输出一行，仅包含一个整数，表示询问的结果。
## 样例

### 样例输入 #1
```
5 9
3 1 3 5 3
3 333135 2
3 333135 1
1 1 3
1 2 5
1 3 2
1 5 4
3 333135 2
3 333135 1
3 333135 3
```
### 样例输出 #1
```
0
81
1
81
0
```
### 样例输入 #2
```
2 10
6 6
3 666666 1
1 1 2
3 666666 2
3 666666 4
3 666666666666666666666666666666 1
2 1
1 2 1
3 666666 2
3 666666 4
3 666666666666666666666666666666 1
```
### 样例输出 #2
```
64
1
0
75497471
1
0
75497471
```
## 提示

保证 $n \leq 2 \times 10^{5}$，$m \leq 5 \times 10^{5}$，$k \leq 50$ 。

设 $\sum |s|$ 为某个输入文件中所有询问的 $s$ 的长度总和，则 $\sum |s| \leq 10^{7}$  。

设 $c$ 为某个输入文件中形如 `2 i` 的操作的次数，则 $c \leq 10^{3}$ 。

每个测试点的详细信息见下表：

| 测试点编号 | $n$ | $m$ | $k$ | $\sum \|s\|$ | $c$ | 全为 $\texttt{1}$ |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| 1 | $=1$ | $\leq 10^{3}$ | $=1$ | $\leq 10^{3}$ | $=0$ | No |
| 2 | $\leq 20$ | $\leq 40$ | $\leq 10$ | $\leq 10^{3}$ | $=0$ | No |
| 3 | $\leq 150$ | $\leq 2,000$ | $\leq 50$ | $\leq 10^{3}$ | $\leq 10^{3}$ | No |
| 4 | $\leq 500$ | $\leq 600$ | $\leq 50$ | $\leq 10^{3}$ | $=0$ | No |
| 5 | $\leq 10^{3}$ | $\leq 2,000$ | $\leq 50$ | $\leq 10^{3}$ | $\leq 10^{3}$ | No |
| 6 | $\leq 5 \times 10^{4}$ | $\leq 6 \times 10^{4}$ | $\leq 5$ | $\leq 5 \times 10^{4}$ | $\leq 10^{3}$ | No |
| 7 | $\leq 5 \times 10^{4}$ | $\leq 6 \times 10^{4}$ | $\leq 50$ | $\leq 5 \times 10^{4}$ | $=0$ | Yes |
| 8 | $\leq 5 \times 10^{4}$ | $\leq 6 \times 10^{4}$ | $\leq 50$ | $\leq 5 \times 10^{4}$ | $=0$ | No |
| 9 | $\leq 5 \times 10^{4}$ | $\leq 6 \times 10^{4}$ | $\leq 50$ | $\leq 5 \times 10^{4}$ | $\leq 10^{3}$ | No |
| 10 | $\leq 5 \times 10^{4}$ | $\leq 8 \times 10^{4}$ | $\leq 50$ | $\leq 2.5 \times 10^{6}$ | $=0$ | No |
| 11 | $\leq 5 \times 10^{4}$ | $\leq 8 \times 10^{4}$ | $\leq 50$ | $\leq 2.5 \times 10^{6}$ | $\leq 10^{3}$ | No |
| 12 | $\leq 10^{5}$ | $\leq 1.1 \times 10^{5}$ | $\leq 6$ | $\leq 10^{5}$ | $\leq 10^{3}$ | No |
| 13 | $\leq 10^{5}$ | $\leq 1.1 \times 10^{5}$ | $\leq 50$ | $\leq 10^{5}$ | $=0$ | Yes |
| 14 | $\leq 10^{5}$ | $\leq 1.1 \times 10^{5}$ | $\leq 50$ | $\leq 10^{5}$ | $=0$ | No |
| 15 | $\leq 10^{5}$ | $\leq 1.1 \times 10^{5}$ | $\leq 50$ | $\leq 10^{5}$ | $\leq 10^{3}$ | No |
| 16 | $\leq 10^{5}$ | $\leq 1.5 \times 10^{5}$ | $\leq 50$ | $\leq 5 \times 10^{6}$ | $=0$ | No |
| 17 | $\leq 10^{5}$ | $\leq 1.5 \times 10^{5}$ | $\leq 50$ | $\leq 5 \times 10^{6}$ | $\leq 10^{3}$ | No |
| 18 | $\leq 2 \times 10^{5}$ | $\leq 5 \times 10^{5}$ | $=1$ | $\leq 10^{7}$ | $=0$ | No |
| 19 | $\leq 2 \times 10^{5}$ | $\leq 5 \times 10^{5}$ | $=1$ | $\leq 10^{7}$ | $\leq 10^{3}$ | No |
| 20 | $\leq 2 \times 10^{5}$ | $\leq 2.5 \times 10^{5}$ | $\leq 7$ | $\leq 2 \times 10^{5}$ | $\leq 10^{3}$ | No |
| 21 | $\leq 2 \times 10^{5}$ | $\leq 2.5 \times 10^{5}$ | $\leq 50$ | $\leq 2 \times 10^{5}$ | $=0$ | Yes |
| 22 | $\leq 2 \times 10^{5}$ | $\leq 2.5 \times 10^{5}$ | $\leq 50$ | $\leq 2 \times 10^{5}$ | $=0$ | No |
| 23 | $\leq 2 \times 10^{5}$ | $\leq 2.5 \times 10^{5}$ | $\leq 50$ | $\leq 2 \times 10^{5}$ | $\leq 10^{3}$ | No |
| 24 | $\leq 2 \times 10^{5}$ | $\leq 3 \times 10^{5}$ | $\leq 50$ | $\leq 10^{7}$ | $=0$ | No |
| 25 | $\leq 2 \times 10^{5}$ | $\leq 3 \times 10^{5}$ | $\leq 50$ | $\leq 10^{7}$ | $\leq 10^{3}$ | No |

如果一个测试点的“全为`1`”的一列为“Yes”，表示该测试点的所有蚯蚓的长度均为 1，并且所有询问串 $s$ 的每一位也均为`1`。


---

---
title: "[NOI2017] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P3825
tag: ['2017', 'NOI', 'Special Judge', 'O2优化', '拓扑排序', '2-SAT', '强连通分量']
---
# [NOI2017] 游戏
## 题目背景

【本题原题时限 1s】

狂野飙车是小 L 最喜欢的游戏。与其他业余玩家不同的是，小 L 在玩游戏之余，还精于研究游戏的设计，因此他有着与众不同的游戏策略。

## 题目描述

小 L 计划进行 $n$ 场游戏，每场游戏使用一张地图，小 L 会选择一辆车在该地图上完成游戏。

小 L 的赛车有三辆，分别用大写字母 $A$、$B$、$C$ 表示。地图一共有四种，分别用小写字母 $x$、$a$、$b$、$c$ 表示。

其中，赛车 $A$ 不适合在地图 $a$ 上使用，赛车 $B$ 不适合在地图 $b$ 上使用，赛车 $C$ 不适合在地图 $c$ 上使用，而地图 $x$ 则适合所有赛车参加。

适合所有赛车参加的地图并不多见，最多只会有 $d$ 张。

$n$ 场游戏的地图可以用一个小写字母组成的字符串描述。例如：$S=\texttt{xaabxcbc}$ 表示小 L 计划进行 $8$ 场游戏，其中第 $1$ 场和第 $5$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $a$，不适合赛车 $A$，第 $4$ 场和第 $7$ 场的地图是 $b$，不适合赛车 $B$，第 $6$ 场和第 $8$ 场的地图是 $c$，不适合赛车 $C$。

小 L 对游戏有一些特殊的要求，这些要求可以用四元组 $ (i, h_i, j, h_j) $ 来描述，表示若在第 $i$ 场使用型号为 $h_i$ 的车子，则第 $j$ 场游戏要使用型号为 $h_j$ 的车子。

你能帮小 L 选择每场游戏使用的赛车吗？如果有多种方案，输出任意一种方案。

如果无解，输出 `-1`。
## 输入格式

输入第一行包含两个非负整数 $n$, $d$。

输入第二行为一个字符串 $S$。

$n$, $d$, $S$ 的含义见题目描述，其中 $S$ 包含 $n$ 个字符，且其中恰好 $d$ 个为小写字母 $x$。

输入第三行为一个正整数 $m$ ，表示有 $m$ 条用车规则。

接下来 $m$ 行，每行包含一个四元组 $i,h_i,j,h_j$ ，其中 $i,j$ 为整数，$h_i,h_j$ 为字符 $A$ 、$B$ 或 $C$，含义见题目描述。
## 输出格式

输出一行。

若无解输出 `-1`。

若有解，则包含一个长度为 $n$ 的仅包含大写字母 A、B、C 的字符串，表示小 L 在这 $n$ 场游戏中如何安排赛车的使用。如果存在多组解，输出其中任意一组即可。
## 样例

### 样例输入 #1
```
3 1
xcc
1
1 A 2 B
```
### 样例输出 #1
```
ABA
```
## 提示

### 样例 1 解释

小 $L$ 计划进行 $3$ 场游戏，其中第 $1$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $c$，不适合赛车 $C$。

小 $L$ 希望：若第 $1$ 场游戏使用赛车 $A$，则第 $2$ 场游戏使用赛车 $B$。

那么为这 $3$ 场游戏分别安排赛车 $A$、$B$、$A$ 可以满足所有条件。

若依次为 $3$ 场游戏安排赛车为 $BBB$ 或 $BAA$ 时，也可以满足所有条件，也被视为正确答案。

但依次安排赛车为 $AAB$ 或 $ABC$ 时，因为不能满足所有条件，所以不被视为正确答案。

### 样例 2

详见附加文件。

### 数据范围

| 测试点编号 |        $n$         |   $d$   |    $m$     |        其他性质         |
| :--------: | :----------------: | :-----: | :--------: | :---------------------: |
|    $1$     |      $\le 2$       |   $0$   |  $\le 4$   |           无            |
|    $2$     |      $\le 2$       | $\le n$ |  $\le 4$   |           无            |
|    $3$     |      $\le 5$       |   $0$   |  $\le 10$  |           无            |
|    $4$     |      $\le 5$       | $\le n$ |  $\le 10$  |           无            |
|    $5$     |      $\le 10$      |   $0$   |  $\le 20$  |           无            |
|    $6$     |      $\le 10$      | $\le 8$ |  $\le 20$  |           无            |
|    $7$     |      $\le 20$      |   $0$   |  $\le 40$  |    $S$ 中只包含 $c$     |
|    $8$     |      $\le 20$      |   $0$   |  $\le 40$  |           无            |
|    $9$     |      $\le 20$      | $\le 8$ |  $\le 40$  | $S$ 中只包含 $x$ 或 $c$ |
|    $10$    |      $\le 20$      | $\le 8$ |  $\le 40$  |           无            |
|    $11$    |     $\le 100$      |   $0$   | $\le 200$  |    $S$ 中只包含 $c$     |
|    $12$    |     $\le 100$      |   $0$   | $\le 200$  |           无            |
|    $13$    |     $\le 100$      | $\le 8$ | $\le 200$  | $S$ 中只包含 $x$ 或 $c$ |
|    $14$    |     $\le 100$      | $\le 8$ | $\le 200$  |           无            |
|    $15$    | $\le 5\times 10^3$ |   $0$   | $\le 10^4$ |           无            |
|    $16$    | $\le 5\times 10^3$ | $\le 8$ | $\le 10^4$ | $S$ 中只包含 $x$ 或 $c$ |
|    $17$    | $\le 5\times 10^3$ | $\le 8$ | $\le 10^4$ |           无            |
|    $18$    | $\le 5\times 10^4$ |   $0$   | $\le 10^5$ |           无            |
|    $19$    | $\le 5\times 10^4$ | $\le 8$ | $\le 10^5$ | $S$ 中只包含 $x$ 或 $c$ |
|    $20$    | $\le 5\times 10^4$ | $\le 8$ | $\le 10^5$ |           无            |


---

---
title: "[NOIP 2017 提高组] 宝藏"
layout: "post"
diff: 省选/NOI-
pid: P3959
tag: ['贪心', '2017', 'NOIP 提高组', '枚举', '状压 DP']
---
# [NOIP 2017 提高组] 宝藏
## 题目背景

NOIP2017 D2T2
## 题目描述

参与考古挖掘的小明得到了一份藏宝图，藏宝图上标出了 $n$ 个深埋在地下的宝藏屋， 也给出了这 $n$ 个宝藏屋之间可供开发的 $m$ 条道路和它们的长度。

小明决心亲自前往挖掘所有宝藏屋中的宝藏。但是，每个宝藏屋距离地面都很远，也就是说，从地面打通一条到某个宝藏屋的道路是很困难的，而开发宝藏屋之间的道路则相对容易很多。

小明的决心感动了考古挖掘的赞助商，赞助商决定免费赞助他打通一条从地面到某个宝藏屋的通道，通往哪个宝藏屋则由小明来决定。

在此基础上，小明还需要考虑如何开凿宝藏屋之间的道路。已经开凿出的道路可以 任意通行不消耗代价。每开凿出一条新道路，小明就会与考古队一起挖掘出由该条道路所能到达的宝藏屋的宝藏。另外，小明不想开发无用道路，即两个已经被挖掘过的宝藏屋之间的道路无需再开发。

新开发一条道路的代价是 $\mathrm{L} \times \mathrm{K}$。其中 $L$ 代表这条道路的长度，$K$ 代表从赞助商帮你打通的宝藏屋到这条道路起点的宝藏屋所经过的宝藏屋的数量（包括赞助商帮你打通的宝藏屋和这条道路起点的宝藏屋） 。

请你编写程序为小明选定由赞助商打通的宝藏屋和之后开凿的道路，使得工程总代价最小，并输出这个最小值。

## 输入格式

第一行两个用空格分离的正整数 $n,m$，代表宝藏屋的个数和道路数。

接下来 $m$ 行，每行三个用空格分离的正整数，分别是由一条道路连接的两个宝藏屋的编号（编号为 $1-n$），和这条道路的长度 $v$。

## 输出格式

一个正整数，表示最小的总代价。

## 样例

### 样例输入 #1
```
4 5 
1 2 1 
1 3 3 
1 4 1 
2 3 4 
3 4 1 
 
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4 5 
1 2 1 
1 3 3 
1 4 1 
2 3 4 
3 4 2  
```
### 样例输出 #2
```
5
```
## 提示

 ![](https://cdn.luogu.com.cn/upload/pic/10868.png) 

【样例解释 $1$】

小明选定让赞助商打通了 $1$ 号宝藏屋。小明开发了道路 $1 \to 2$，挖掘了 $2$ 号宝藏。开发了道路 $1 \to 4$，挖掘了 $4$ 号宝藏。还开发了道路 $4 \to 3$，挖掘了 $3$ 号宝藏。

工程总代价为 $1 \times 1 + 1 \times 1 + 1 \times 2  = 4 $。

【样例解释 $2$】

小明选定让赞助商打通了 $1$ 号宝藏屋。小明开发了道路 $1 \to 2$，挖掘了 $2$ 号宝藏。开发了道路 $1 \to 3$，挖掘了 $3$ 号宝藏。还开发了道路 $1 \to 4$，挖掘了 $4$ 号宝藏。

工程总代价为 $1 \times 1 + 3 \times 1 + 1 \times 1  = 5$。


【数据规模与约定】

对于 $ 20\%$ 的数据： 保证输入是一棵树，$1 \le n \le 8$，$v \le 5\times 10^3$ 且所有的 $v$ 都相等。

对于 $40\%$ 的数据： $1 \le n \le 8$，$0 \le m \le 10^3$，$v \le 5\times 10^3$ 且所有的 $v$ 都相等。

对于 $ 70\%$ 的数据： $1 \le n \le 8$，$0 \le m \le 10^3$，$v \le  5\times 10^3$。

对于 $ 100\%$ 的数据： $1 \le n \le 12$，$0 \le m \le 10^3$，$v \le  5\times 10^5$。

---

$\text{upd 2022.7.27}$：新增加 $50$ 组 Hack 数据。



---

---
title: "[NOIP 2017 提高组] 列队"
layout: "post"
diff: 省选/NOI-
pid: P3960
tag: ['2017', '线段树', '平衡树', '树状数组', 'NOIP 提高组']
---
# [NOIP 2017 提高组] 列队
## 题目背景

NOIP2017 D2T3
## 题目描述

`Sylvia` 是一个热爱学习的女孩子。

前段时间，`Sylvia` 参加了学校的军训。众所周知，军训的时候需要站方阵。

Sylvia 所在的方阵中有 $n \times m$ 名学生，方阵的行数为 $n$，列数为 $m$。

为了便于管理，教官在训练开始时，按照从前到后，从左到右的顺序给方阵中 的学生从 $1$ 到 $n \times m$ 编上了号码（参见后面的样例）。即：初始时，第 $i$ 行第 $j$ 列 的学生的编号是 $(i-1)\times m + j$。

然而在练习方阵的时候，经常会有学生因为各种各样的事情需要离队。在一天 中，一共发生了 $q$ 件这样的离队事件。每一次离队事件可以用数对 $(x,y) (1 \le x \le n, 1 \le y \le m)$ 描述，表示第 $x$ 行第 $y$ 列的学生离队。

在有学生离队后，队伍中出现了一个空位。为了队伍的整齐，教官会依次下达 这样的两条指令：


1. 向左看齐。这时第一列保持不动，所有学生向左填补空缺。不难发现在这条 指令之后，空位在第 $x$ 行第 $m$ 列。
2. 向前看齐。这时第一行保持不动，所有学生向前填补空缺。不难发现在这条 指令之后，空位在第 $n$ 行第 $m$ 列。


教官规定不能有两个或更多学生同时离队。即在前一个离队的学生归队之后， 下一个学生才能离队。因此在每一个离队的学生要归队时，队伍中有且仅有第 $n$ 行 第 $m$ 列一个空位，这时这个学生会自然地填补到这个位置。

因为站方阵真的很无聊，所以 `Sylvia` 想要计算每一次离队事件中，离队的同学 的编号是多少。

注意：每一个同学的编号不会随着离队事件的发生而改变，在发生离队事件后 方阵中同学的编号可能是乱序的。

## 输入格式

输入共 $q+1$ 行。

第一行包含 $3$ 个用空格分隔的正整数 $n, m, q$，表示方阵大小是 $n$ 行 $m$ 列，一共发 生了 $q$ 次事件。

接下来 $q$ 行按照事件发生顺序描述了 $q$ 件事件。每一行是两个整数 $x, y$，用一个空 格分隔，表示这个离队事件中离队的学生当时排在第 $x$ 行第 $y$ 列。

## 输出格式

按照事件输入的顺序，每一个事件输出一行一个整数，表示这个离队事件中离队学生的编号。

## 样例

### 样例输入 #1
```
2 2 3 
1 1 
2 2 
1 2 
```
### 样例输出 #1
```
1
1
4

```
## 提示

【输入输出样例 $1$ 说明】

$$\begin{matrix}
\begin{bmatrix}
1 & 2 \\
3 & 4 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
 & 2 \\
3 & 4 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 &  \\
3 & 4 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix} \\[1em]
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix}\\[1em]
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 &  \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 &  \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 1 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 1 \\
3 & 4 \\
\end{bmatrix}
\end{matrix}$$


列队的过程如上图所示，每一行描述了一个事件。 在第一个事件中，编号为 $1$ 的同学离队，这时空位在第一行第一列。接着所有同学 向左标齐，这时编号为 $2$ 的同学向左移动一步，空位移动到第一行第二列。然后所有同 学向上标齐，这时编号为 $4$ 的同学向上一步，这时空位移动到第二行第二列。最后编号为 $1$ 的同学返回填补到空位中。

【数据规模与约定】

| 测试点编号 | $n$ | $m$ | $q$ | 其他约定 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim 6$ | $\le 10^3$ | $\le 10^3$ | $\le 500$ | 无 |
| $7\sim 10$ | $\le 5\times 10^4$ | $\le 5\times 10^4$ | $\le 500$ | 无 |
| $11\sim 12$ | $=1$ | $\le 10^5$ | $\le 10^5$ | 所有事件 $x=1$ |
| $13\sim 14$ | $=1$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | 所有事件 $x=1$ |
| $15\sim 16$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | 所有事件 $x=1$ |
| $17\sim 18$ | $\le 10^5$ | $\le 10^5$ | $\le 10^5$ | 无 |
| $19\sim 20$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | 无 |

数据保证每一个事件满足 $1 \le x \le n,1 \le y \le m$。



---

---
title: "[NOI2008] 志愿者招募"
layout: "post"
diff: 省选/NOI-
pid: P3980
tag: ['2008', 'NOI', '网络流', '图论建模', '线性规划']
---
# [NOI2008] 志愿者招募
## 题目描述

申奥成功后，布布经过不懈努力，终于成为奥组委下属公司人力资源部门的主管。布布刚上任就遇到了一个难题：为即将启动的奥运新项目招募一批短期志愿者。经过估算，这个项目需要 $n$ 天才能完成，其中第 $i$ 天至少需要 $a_i$ 个人。布布通过了解得知，一共有 $m$ 类志愿者可以招募。其中第 $i$ 类可以从第 $s_i$ 天工作到第 $t_i$ 天，招募费用是每人 $c_i$ 元。新官上任三把火，为了出色地完成自己的工作，布布希望用尽量少的费用招募足够的志愿者，但这并不是他的特长！于是布布找到了你，希望你帮他设计一种最优的招募方案。
## 输入格式

第一行包含两个整数 $n,m$，表示完成项目的天数和可以招募的志愿者的种类。接下来的一行中包含 $n$ 个非负整数，表示每天至少需要的志愿者人数。 接下来的 $m$ 行中每行包含三个整数 $s_i, t_i, c_i$，含义如上文所述。为了方便起见，我们可以认为每类志愿者的数量都是无限多的。保证存在可行的招募方案。
## 输出格式

仅包含一个整数，表示你所设计的最优方案的总费用。

## 样例

### 样例输入 #1
```
3 3
2 3 4
1 2 2
2 3 5
3 3 2
```
### 样例输出 #1
```
14
```
## 提示

$1\leq n\leq 1000$，$1\leq m\leq 10000$，题目中其他所涉及的数据均不超过 $2^{31}-1$。


---

---
title: "[NOI2003] 文本编辑器"
layout: "post"
diff: 省选/NOI-
pid: P4008
tag: ['字符串', '2003', '平衡树', '递归', 'NOI', '分块']
---
# [NOI2003] 文本编辑器
## 题目描述

很久很久以前，$DOS3.x$ 的程序员们开始对 $EDLIN$ 感到厌倦。于是，人们开始纷纷改用自己写的文本编辑器⋯⋯

多年之后，出于偶然的机会，小明找到了当时的一个编辑软件。进行了一些简单的测试后，小明惊奇地发现：那个软件每秒能够进行上万次编辑操作（当然，你不能手工进行这样的测试） ！于是，小明废寝忘食地想做一个同样的东西出来。你能帮助他吗？

为了明确目标，小明对“文本编辑器”做了一个抽象的定义:

文本：由 $0$ 个或多个 ASCII 码在闭区间 [$32$, $126$] 内的字符构成的序列。

光标：在一段文本中用于指示位置的标记，可以位于文本首部，文本尾部或文本的某两个字符之间。


文本编辑器：由一段文本和该文本中的一个光标组成的，支持如下操作的数据结构。如果这段文本为空，我们就说这个文本编辑器是空的。

| 操作名称  | 输入文件中的格式  | 功能  |
| :------------ | :------------ | :------------ |
| $\text{Move}(k)$  | Move k  |  将光标移动到第 $k$ 个字符之后，如果 $k=0$，将光标移到文本开头 |
| $\text{Insert}(n,s)$  | Insert n s  | 在光标处插入长度为 $n$ 的字符串 $s$，光标位置不变$n\geq1$|
| $\text{Delete}(n)$  | Delete n  | 删除光标后的 $n$ 个字符，光标位置不变，$n \geq 1$  |
| $\text{Get}(n)$  | Get n  |输出光标后的 $n$ 个字符，光标位置不变，$n \geq 1$   |
| $\text{Prev}()$  | Prev  | 光标前移一个字符  |
| $\text{Next}()$  | Next |  光标后移一个字符 |


你的任务是：

- 建立一个空的文本编辑器。

- 从输入文件中读入一些操作并执行。

- 对所有执行过的 `GET` 操作，将指定的内容写入输出文件。

## 输入格式

输入文件 `editor.in` 的第一行是指令条数 $t$，以下是需要执行的 $t$ 个操作。其中：

为了使输入文件便于阅读， `Insert` 操作的字符串中可能会插入一些回车符， 请忽略掉它们（如果难以理解这句话，可以参照样例） 。

除了回车符之外，输入文件的所有字符的 ASCII 码都在闭区间 [$32$, $126$] 内。且

行尾没有空格。

这里我们有如下假定：

-  `MOVE` 操作不超过 $50000$ 个， `INSERT` 和 `DELETE` 操作的总个数不超过 $4000$，`PREV` 和 `NEXT` 操作的总个数不超过 $200000$。

-  所有 `INSERT` 插入的字符数之和不超过 $2M$（$1M=1024\times 1024$ 字节） ，正确的输出文件长度不超过 $3M$ 字节。

-  `DELETE` 操作和 `GET` 操作执行时光标后必然有足够的字符。 `MOVE` 、 `PREV` 、 `NEXT` 操作必然不会试图把光标移动到非法位置。

-  输入文件没有错误。

对 C++ 选手的提示：经测试，最大的测试数据使用 `fstream` 进行输入有可能会比使用 `stdio` 慢约 $1$ 秒。
## 输出格式

输出文件 editor.out 的每行依次对应输入文件中每条 `Get` 指令的输出。

## 样例

### 样例输入 #1
```
15
Insert 26
abcdefghijklmnop
qrstuv wxy
Move 15
Delete 11
Move 5
Insert 1
^
Next
Insert 1
_
Next
Next
Insert 4
.\/.
Get 4
Prev
Insert 1
^
Move 0
Get 22


```
### 样例输出 #1
```
.\/.
abcde^_^f.\/.ghijklmno

```


---

---
title: "[NOI2007] 货币兑换"
layout: "post"
diff: 省选/NOI-
pid: P4027
tag: ['2007', 'NOI', 'Special Judge', '分治', '斜率优化', '凸包']
---
# [NOI2007] 货币兑换
## 题目描述

小 Y 最近在一家金券交易所工作。该金券交易所只发行交易两种金券：A 纪念券（以下简称 A 券）和 B 纪念券（以下简称 B 券）。每个持有金券的顾客都有一个自己的帐户。金券的数目可以是一个实数。

每天随着市场的起伏波动，两种金券都有自己当时的价值，即每一单位金券当天可以兑换的人民币数目。我们记录第 $K$ 天中 A 券和 B 券的价值分别为 $A_K$ 和 $B_K$（元/单位金券）。

为了方便顾客，金券交易所提供了一种非常方便的交易方式：比例交易法。

比例交易法分为两个方面：

a)  卖出金券：顾客提供一个 $[0, 100]$ 内的实数 $OP$ 作为卖出比例，其意义为：将 $OP\%$ 的 A 券和 $OP\%$ 的 B 券以当时的价值兑换为人民币；

b)  买入金券：顾客支付 $IP$ 元人民币，交易所将会兑换给用户总价值为 $IP$ 的金券，并且，满足提供给顾客的 A 券和 B 券的比例在第 $K$ 天恰好为 $\mathrm{Rate}_ K$；

例如，假定接下来 $3$ 天内的 $A_K,B_K,\mathrm{Rate}_ K$ 的变化分别为：

| 时间 | $A_K$ | $B_K$ | $\mathrm{Rate}_ K$ |
| ----- | ----- | ----- | ----- |
| 第一天 | $1$ | $1$ | $1$ |
| 第二天 | $1$ | $2$ | $2$ |
| 第三天 | $2$ | $2$ | $3$ |



假定在第一天时，用户手中有 $100$ 元人民币但是没有任何金券。

用户可以执行以下的操作：

| 时间 | 用户操作 | 人民币(元) | A 券的数量 | B 券的数量 |
| ----- | ----- | ----- | ----- | ----- |
| 开户 | 无 | $100$ | $0$ | $0$ |
| 第一天 | 买入 $100$ 元 | $0$ | $50$ | $50$ |
| 第二天 | 卖出 $50\%$ | $75$ | $25$ | $25$ |
| 第二天 | 买入 $60$ 元 | $15$ | $55$ | $40$ |
| 第三天 | 卖出 $100\%$ | $205$ | $0$ | $0$ |

注意到，同一天内可以进行多次操作。

小 Y 是一个很有经济头脑的员工，通过较长时间的运作和行情测算，他已经知道了未来 $N$ 天内的 A 券和 B 券的价值以及 $\mathrm{Rate}$。他还希望能够计算出来，如果开始时拥有 $S$ 元钱，那么 $N$ 天后最多能够获得多少元钱。

## 输入格式

第一行两个正整数 $N,S$，分别表示小 Y 能预知的天数以及初始时拥有的钱数。

接下来 $N$ 行，第 $K$ 行三个实数 $A_K,B_K,\mathrm{Rate} _ K$ ，意义如题目中所述。

## 输出格式

只有一个实数 $\mathrm{MaxProfit}$，表示第 $N$ 天的操作结束时能够获得的最大的金钱数目。答案保留 $3$ 位小数。

## 样例

### 样例输入 #1
```
3 100
1 1 1
1 2 2
2 2 3
```
### 样例输出 #1
```
225.000
```
## 提示

| 时间 | 用户操作 | 人民币(元) | A 券的数量 | B 券的数量 |
| ----- | ----- | ----- | ----- | ----- |
| 开户 | 无 | $100$ | $0$ | $0$ |
| 第一天 | 买入 $100$ 元 | $0$ | $50$ | $50$ |
| 第二天 | 卖出 $100\%$ | $150$ | $0$ | $0$ |
| 第二天 | 买入 $150$ 元 | $0$ | $75$ | $37.5$ |
| 第三天 | 卖出 $100\%$ | $225$ | $0$ | $0$ |


本题没有部分分，你的程序的输出只有和标准答案相差不超过 $0.001$ 时，才能获得该测试点的满分，否则不得分。


测试数据设计使得精度误差不会超过 $10^{-7}$ 。

对于 $40\%$ 的测试数据，满足 $N \le 10$。

对于 $60\%$ 的测试数据，满足 $N \le 1 000$。

对于 $100\%$ 的测试数据，满足 $N \le 10^5$。

对于 $100\%$ 的测试数据，满足：

$0 < A_K \leq 10$，$0 < B_K\le 10$，$0 < \mathrm{Rate}_K \le 100$，$\mathrm{MaxProfit}  \leq 10^9$。

输入文件可能很大，请采用快速的读入方式。

必然存在一种最优的买卖方案满足：

每次买进操作使用完所有的人民币，每次卖出操作卖出所有的金券。



---

---
title: "[NOI2007] 项链工厂"
layout: "post"
diff: 省选/NOI-
pid: P4130
tag: ['2007', '线段树', 'NOI']
---
# [NOI2007] 项链工厂
## 题目背景

T公司是一家专门生产彩色珠子项链的公司，其生产的项链设计新颖、款式多样、价格适中，广受青年人的喜爱。

最近T公司打算推出一款项链自助生产系统，使用该系统顾客可以自行设计心目中的美丽项链。该项链自助生产系

统包括硬件系统与软件系统，软件系统与用户进行交互并控制硬件系统，硬件系统接受软件系统的命令生产指定的

项链。该系统的硬件系统已经完成，而软件系统尚未开发，T公司的人找到了正在参加全国信息学竞赛的你，你能

帮助T公司编写一个软件模拟系统吗？

## 题目描述

一条项链包含 $N$ 个珠子，每个珠子的颜色是 $1,2,…,c$ 中的一种。项链

被固定在一个平板上，平板的某个位置被标记位置 $1$ ，按顺时针方向其他位置被记为 $2,3,…,N$。

 ![](https://cdn.luogu.com.cn/upload/pic/13560.png) 

你将要编写的软件系统应支持如下命令：

 ![](https://cdn.luogu.com.cn/upload/pic/13561.png) 

![](https://cdn.luogu.com.cn/upload/pic/13562.png)

## 输入格式

输入文件第一行包含两个整数 $N, c$，分别表示项链包含的珠子数目以及颜色数目。

第二行包含 $N$ 个整数，$x_1, x_2…, x_n$，表示从位置 $1$ 到位置 $N$ 的珠子的颜色，$1 \le x_i \le c$。

第三行包含一个整数 $Q$，表示命令数目。

接下来的 $Q$ 行每行一条命令，如上文所述。

## 输出格式

对于每一个 ``C`` 和 ``CS`` 命令，应输出一个整数代表相应的答案。

## 样例

### 样例输入 #1
```
5 3
1 2 3 2 1
4
C
R 2
P 5 5 2
CS 4 1
```
### 样例输出 #1
```
4
1
```
## 提示

【数据规模和约定】

对于60%的数据，$N \le 1000$，$Q \le 1000$；

对于100%的数据，$N \le 500000$，$Q \le 500000$，$c \le 1000$。

关于旋转和翻转


注意旋转命令旋转“珠子”但不改变“位置”的编号，而反转命令始终以位置 1 为对称轴。例如当 N=10 时，项链上的位置编号如图1：


但注意此时项链上的位置编号仍然如图1所示，于是翻转的对称轴不变。因而再执行一次“F”命令时，项链的颜色如图4所示。

 ![](https://cdn.luogu.com.cn/upload/pic/13244.png) 

 ![](https://cdn.luogu.com.cn/upload/pic/13245.png) 

关于CountSegment命令


CS命令表示查询一个“线段”中有多少个“部分”。尤其注意当查询的长度等于 N 时，我们仍然将查询部分作为“线段”理解。


例如在图4所示的情况中，执行“CS 1 10”命令，查询从位置 1 开始到位置 10 结束的这个长度为 10 的线段中有多少个“部分”，于是得到返回值 3 。与之形成对照的是，若执行“C”命令，返回值则为 2



---

---
title: "[NOI2006] 最大获利"
layout: "post"
diff: 省选/NOI-
pid: P4174
tag: ['2006', 'NOI', '网络流', '广度优先搜索 BFS', '深度优先搜索 DFS']
---
# [NOI2006] 最大获利
## 题目描述

新的技术正冲击着手机通讯市场，对于各大运营商来说，这既是机遇，更是挑战。THU 集团旗下的 CS&T 通讯公司在新一代通讯技术血战的前夜，需要做太多的准备工作，仅就站址选择一项，就需要完成前期市场研究、站址勘测、最优化等项目。

在前期市场调查和站址勘测之后，公司得到了一共 $N$ 个可以作为通讯信号中转站的地址，而由于这些地址的地理位置差异，在不同的地方建造通讯中转站需要投入的成本也是不一样的，所幸在前期调查之后这些都是已知数据：建立第 $i$ 个通讯中转站需要的成本为 $P_i$（$1 \leq i \leq N$）。

另外公司调查得出了所有期望中的用户群，一共 $M$ 个。关于第 $i$ 个用户群的信息概括为 $A_i$，$B_i$ 和 $C_i$ ：这些用户会使用中转站 $A_i$ 和中转站 $B_i$ 进行通讯，公司可以获益 $C_i$。（$1 \leq i \leq M$，$1 \leq A_i, B_i \leq N$）

THU 集团的 CS&T 公司可以有选择的建立一些中转站（投入成本），为一些用户提供服务并获得收益（获益之和）。那么如何选择最终建立的中转站才能让公司的净获利最大呢？（净获利 = 获益之和 – 投入成本之和）

## 输入格式

输入文件中第一行有两个正整数 $N$ 和 $M$。

第二行中有 $N$ 个整数描述每一个通讯中转站的建立成本，依次为 $P_1 , P_2 , …,P_N$。

以下 $M$ 行，第 $i + 2$ 行的三个数 $A_i , B_i$ 和 $C_i$ 描述第 $i$ 个用户群的信息。

所有变量的含义可以参见题目描述。

## 输出格式

你的程序只要向输出文件输出一个整数，表示公司可以得到的最大净获利。

## 样例

### 样例输入 #1
```
5 5
1 2 3 4 5
1 2 3
2 3 4
1 3 3
1 4 2
4 5 3
```
### 样例输出 #1
```
4
```
## 提示

样例：选择建立 $1,2,3$ 号中转站，则需要投入成本 $6$，获利为 $10$，因此得到最大收益 $4$。

$100\%$ 的数据中：$N \leq 5\,000$，$M \leq50\,000$，$0 \leq C_i \leq 100$，$0 \leq P_i  \leq 100$。



---

---
title: "[NOI2006] 神奇口袋"
layout: "post"
diff: 省选/NOI-
pid: P4204
tag: ['高精度', '2006', 'NOI', '排序']
---
# [NOI2006] 神奇口袋
## 题目描述

Pòlya 获得了一个奇妙的口袋，上面写着人类难以理解的符号。Pòlya 看得入了迷，冥思苦想，发现了一个神奇的模型（被后人称为 Pòlya 模型)。为了生动地讲授这个神奇的模型，他带着学生们做了一个虚拟游戏：游戏开始时，袋中装入 $a_1$ 个颜色为 $1$ 的球，$a_2$ 个颜色为 $2$ 的球，……，$a_t$ 个颜色为 $t$ 的球，其中 $a_i \in \mathbb Z^+$（$1 \le i \le t$）。

游戏开始后，每次严格进行如下的操作：

从袋中随机的抽出一个小球（袋中所有小球被抽中的概率相等），Pòlya 独自观察这个小球的颜色后将其放回，然后再把 $d$ 个与其颜色相同的小球放到口袋中。

设 $c_i$ 表示第 $i$ 次抽出的小球的颜色（$1 \le C_i \le t$），一个游戏过程将会产生一个颜色序列（$c_1, c_2, \ldots, c_n, \ldots$）。Pòlya 把游戏开始时 $t$ 种颜色的小球每一种的个数 $a_1, a_2, \ldots, a_t$ 告诉了所有学生。然后他问学生：一次游戏过程产生的颜色序列满足下列条件的概率有多大？ 

$$c_{x_1}=y_1, c_{x_2}=y_2, \ldots, c_{x_n}=y_n$$

其中 $0 < x_1 < x_2 < \cdots < x_n$，$1 \le y_i \le t$。换句话说，已知 $(t, n, d, a_1, a_2, \ldots, a_t, x_1, y_1, x_2, y_2, \ldots, x_n, y_n)$，你要回答有多大的可能性会发生下面的事件：“对所有 $k$（$1 \le k \le n$），第 $x_k$ 次抽出的球的颜色为 $y_k$”。
## 输入格式

第一行有三个正整数 $t, n, d$；

第二行有 $t$ 个正整数 $a_1, a_2, \ldots, a_t$，表示游戏开始时口袋里 $t$ 种颜色的球，每种球的个数。

以下 $n$ 行，每行有两个正整数 $x_i, y_i$，表示第 $x_i$ 次抽出颜色为的 $y_i$ 球。
## 输出格式

要求用分数形式输出（显然此概率为有理数）。输出文件包含一行，格式为：`分子/分母`。同时要求输出最简形式（分子分母互质）。特别的，概率为 $0$ 应输出 `0/1`，概率为 $1$ 应输出 `1/1`。
## 样例

### 样例输入 #1
```
2 3 1
1 1
1 1
2 2
3 1

```
### 样例输出 #1
```
1/12

```
### 样例输入 #2
```
3 1 2
1 1 1
5 1

```
### 样例输出 #2
```
1/3

```
## 提示

**【样例解释 #1】**

初始时，两种颜色球数分别为 $(1, 1)$，取出色号为 $1$ 的球的概率为 $1/2$；第二次取球之前，两种颜色球数分别为 $(2, 1)$，取出色号为 $2$ 的球的概率为 $1/3$；第三次取球之前，两种颜色球数分别为 $(2, 2)$，取出色号为 $1$ 的球的概率为 $1/2$，所以三次取球的总概率为 $1/12$。

**【数据规模和约定】**

对于 $100 \%$ 的数据，$1 \le t, n \le 1000$，$1 \le a_k, d \le 10$，$1 \le x_1 < x_2 < \cdots < x_n \le 10000$，$1 \le y_k \le t$。


---

---
title: "[NOI2005] 智慧珠游戏"
layout: "post"
diff: 省选/NOI-
pid: P4205
tag: ['搜索', '2005', 'NOI', '枚举', '剪枝', 'Dancing Links']
---
# [NOI2005] 智慧珠游戏
## 题目描述

智慧珠游戏拼盘由一个三角形盘件和 12 个形态各异的零件组成。拼盘的盘 件如图 1 所示
![](https://cdn.luogu.com.cn/upload/pic/13767.png)
![](https://cdn.luogu.com.cn/upload/pic/13768.png)
![](https://cdn.luogu.com.cn/upload/pic/13769.png)
对 于 由珠子构成的零件，可以放到盘件的任一位置，条件是能有地方放，且 尺寸合适，所有的零件都允许旋转(0º、90º、180º、270º)和翻转(水平、竖直)。
 
 
现给出一个盘件的初始布局，求一种可行的智慧珠摆放方案，使所有的零件 都能放进盘件中。 
## 输入格式

文件中包含初始的盘件描述，一共有 10 行，第 i 行有 i 个字符。如果第 i 行 的第 j 个字符是字母”A”至”L”中的一个，则表示第 i 行第 j 列的格子上已经放了 零件，零件的编号为对应的字母。如果第 i 行的第 j 个字符是”.”，则表示第 i 行 第 j 列的格子上没有放零件。
输入保证预放的零件已摆放在盘件中。
## 输出格式

如果能找到解，向输出文件打印 10 行，为放完全部 12 个零件后的布局。其 中，第 i 行应包含 i 个字符，第 i 行的第 j 个字符表示第 i 行第 j 列的格子上放的 是哪个零件。 如果无解，输出单独的一个字符串‘No solution’(不要引号，请注意大小写)。
 所有的数据保证最多只有一组解
## 样例

### 样例输入 #1
```
.
..
...
....
.....
.....C
...CCC.
EEEHH...
E.HHH....
E.........
```
### 样例输出 #1
```
B
BK
BKK
BJKK
JJJDD
GJGDDC
GGGCCCI
EEEHHIIA
ELHHHIAAF
ELLLLIFFFF
```


---

---
title: "[NOI2004] 小H的小屋"
layout: "post"
diff: 省选/NOI-
pid: P4274
tag: ['动态规划 DP', '贪心', '2004', 'NOI', '模拟退火']
---
# [NOI2004] 小H的小屋
## 题目描述

小 H 发誓要做 $21$ 世纪最伟大的数学家。他认为，做数学家与做歌星一样，第一步要作好包装，不然本事再大也推不出去。为此他决定先在自己的住所上下功夫，让人一看就知道里面住着一个“未来的大数学家”。

为了描述方便，我们以向东为 $x$ 轴正方向，向北为 $y$ 轴正方向，建立平面直角坐标系。小 H 的小屋东西长为 $100$  Hil（Hil 是小 H 自己使用的长度单位，至于怎样折合成“m”，谁也不知道）。东墙和西墙均平行于 $y$ 轴，北墙和南墙分别是斜率为 $k_1$ 和 $k_2$ 的直线，$k_1$ 和 $k_2$ 为正实数。北墙和南墙的墙角处有很多块草坪，每块草坪都是一个矩形，矩形的每条边都平行于坐标轴。相邻两块草坪的接触点恰好在墙上，接触点的横坐标被称为它所在墙的“分点”，这些分点必须是 $1$ 到 $99$ 的整数。

小 H 认为，对称与不对称性的结合才能充分体现“数学美”。因此，在北墙角要有 $m$ 块草坪，在南墙角要有 $n$ 块草坪，并约定 $m \leq n$。如果记北墙和南墙的分点集合分别为 $X_1$，$X_2$，则应满足 $X_1 \subseteq X_2$，即北墙的任何一个分点一定是南墙的分点。

由于小 H 目前还没有丰厚的收入，他必须把草坪的造价降到最低，即草坪
的占地总面积最小。你能编程帮他解决这个难题吗？
## 输入格式

仅一行，包含 $4$ 个数 $k_1$，$k_2$，$m$，$n$。$k_1$ 和 $k_2$ 为正实数，分别表示北墙和南墙的斜率，精确到小数点后第一位。$m$ 和 $n$ 为正整数，分别表示北墙角和南墙角的草坪的块数。
## 输出格式

一个实数，表示草坪的最小占地总面积。精确到小数点后第一位。
## 样例

### 样例输入 #1
```
0.5 0.2 2 4
```
### 样例输出 #1
```
3000.0
```
## 提示

![](https://cdn.luogu.com.cn/upload/image_hosting/y83es0b9.png)
【约定】

○ $2 \leq m \leq n \leq 100$

○ 南北墙距离很远，不会出现南墙草坪和北墙草坪重叠的情况


---

---
title: "[NOI2018] 归程"
layout: "post"
diff: 省选/NOI-
pid: P4768
tag: ['2018', '并查集', 'Kruskal 重构树', 'NOI', 'O2优化', '最短路', '可持久化']
---
# [NOI2018] 归程
## 题目描述

本题的故事发生在魔力之都，在这里我们将为你介绍一些必要的设定。

魔力之都可以抽象成一个 $n$ 个节点、$m$ 条边的无向连通图（节点的编号从 $1$ 至 $n$）。我们依次用 $l,a$ 描述一条边的**长度、海拔**。

作为季风气候的代表城市，魔力之都时常有雨水相伴，因此道路积水总是不可避免的。由于整个城市的排水系统连通，因此**有积水的边一定是海拔相对最低的一些边**。我们用**水位线**来描述降雨的程度，它的意义是：所有海拔**不超过**水位线的边都是**有积水**的。

Yazid 是一名来自魔力之都的 OIer，刚参加完 ION2018 的他将踏上归程，回到他温暖的家。Yazid 的家恰好在魔力之都的 $1$ 号节点。对于接下来 $Q$ 天，每一天 Yazid 都会告诉你他的出发点 $v$ ，以及当天的水位线 $p$。

每一天，Yazid 在出发点都拥有一辆车。这辆车由于一些故障不能经过有积水的边。Yazid 可以在任意节点下车，这样接下来他就可以步行经过有积水的边。但车会被留在他下车的节点并不会再被使用。
需要特殊说明的是，第二天车会被重置，这意味着：
- 车会在新的出发点被准备好。
- Yazid 不能利用之前在某处停放的车。

Yazid 非常讨厌在雨天步行，因此他希望在完成回家这一目标的同时，最小化他**步行经过的边**的总长度。请你帮助 Yazid 进行计算。

本题的部分测试点将强制在线，具体细节请见【输入格式】和【子任务】。
## 输入格式

单个测试点中包含多组数据。输入的第一行为一个非负整数 $T$，表示数据的组数。

接下来依次描述每组数据，对于每组数据：

第一行 $2$ 个非负整数 $n,m$，分别表示节点数、边数。

接下来 $m$ 行，每行 $4$ 个正整数 $u, v, l, a$，描述一条连接节点 $u, v$ 的、长度为 $l$、海拔为 $a$ 的边。
在这里，我们保证 $1 \leq u,v \leq n$。

接下来一行 $3$ 个非负数 $Q, K, S$ ，其中 $Q$ 表示总天数，$K \in {0,1}$ 是一个会在下面被用到的系数，$S$ 表示的是可能的最高水位线。

接下来 $Q$ 行依次描述每天的状况。每行 $2$ 个整数 $v_0,  p_0$ 描述一天：
- 这一天的出发节点为 $v = (v_0 + K \times \mathrm{lastans} - 1) \bmod n + 1$。    
- 这一天的水位线为 $p = (p_0 + K \times \mathrm{lastans}) \bmod (S + 1)$。    

其中 $\mathrm{lastans}$ 表示上一天的答案（最小步行总路程）。特别地，我们规定第 $1$ 天时 $\mathrm{lastans} = 0$。 
在这里，我们保证 $1 \leq v_0 \leq n$，$0 \leq p_0 \leq S$。

对于输入中的每一行，如果该行包含多个数，则用单个空格将它们隔开。
## 输出格式

依次输出各组数据的答案。对于每组数据：

- 输出 $Q$ 行每行一个整数，依次表示每天的最小步行总路程。
## 样例

### 样例输入 #1
```
1
4 3
1 2 50 1
2 3 100 2
3 4 50 1
5 0 2
3 0
2 1
4 1
3 1
3 2
```
### 样例输出 #1
```
0
50
200
50
150
```
### 样例输入 #2
```
1
5 5
1 2 1 2
2 3 1 2
4 3 1 2
5 3 1 2
1 5 2 1
4 1 3
5 1
5 2
2 0
4 0
```
### 样例输出 #2
```
0
2
3
1
```
## 提示

### 更多样例

更多样例请在附加文件中下载。

#### 样例 3

见附加文件中的 `return3.in` 与 `return3.ans`。

该样例满足海拔为一种，且不强制在线。

#### 样例 4

见附加文件中的 `return4.in` 与 `return4.ans`。

该样例满足图形态为一条链，且强制在线。

#### 样例 5

见附加文件中的 `return5.in` 与 `return5.ans`。

该样例满足不强制在线。

### 样例 1 解释

第一天没有降水，Yazid 可以坐车直接回到家中。

第二天、第三天、第四天的积水情况相同，均为连接 1，2 号节点的边、连接 3，4 号点的边有积水。

对于第二天，Yazid 从 2 号点出发坐车只能去往 3 号节点，对回家没有帮助。因此 Yazid 只能纯靠徒步回家。

对于第三天，从 4 号节点出发的唯一一条边是有积水的，车也就变得无用了。Yazid 只能纯靠徒步回家。

对于第四天，Yazid 可以坐车先到达 2 号节点，再步行回家。

第五天所有的边都积水了，因此 Yazid 只能纯靠徒步回家。

### 样例 2 解释

本组数据强制在线。

第一天的答案是 $0$，因此第二天的 $v=\left( 5+0-1\right)\bmod 5+1=5$，$p=\left(2+0\right)\bmod\left(3+1\right)=2$。

第二天的答案是 $2$，因此第三天的 $v=\left( 2+2-1\right)\bmod 5+1=4$，$p=\left(0+2\right)\bmod\left(3+1\right)=2$。

第三天的答案是 $3$，因此第四天的 $v=\left( 4+3-1\right)\bmod 5+1=2$，$p=\left(0+3\right)\bmod\left(3+1\right)=3$。

### 数据范围与约定

所有测试点均保证 $T\leq 3$，所有测试点中的所有数据均满足如下限制：

- $n\leq 2\times 10^5$，$m\leq 4\times 10^5$，$Q\leq 4\times 10^5$，$K\in\left\{0,1\right\}$，$1\leq S\leq 10^9$。
- 对于所有边：$l\leq 10^4$，$a\leq 10^9$。
- 任意两点之间都直接或间接通过边相连。

**为了方便你快速理解，我们在表格中使用了一些简单易懂的表述。在此，我们对这些内容作形式化的说明：**

- 图形态：对于表格中该项为 “一棵树” 或 “一条链” 的测试点，保证 $m = n-1$。除此之外，这两类测试点分别满足如下限制：
  - 一棵树：保证输入的图是一棵树，即保证边不会构成回路。
  - 一条链：保证所有边满足 $u + 1 = v$。
- 海拔：对于表格中该项为 “一种” 的测试点，保证对于所有边有 $a = 1$。
- 强制在线：对于表格中该项为 “是” 的测试点，保证 $K = 1$；如果该项为 “否”，则有 $K = 0$。
- 对于所有测试点，如果上述对应项为 “不保证”，则对该项内容不作任何保证。

$n$|$m$|$Q=$|测试点|形态|海拔|强制在线
-|-|-|-|-|-|-
$\leq 1$|$\leq 0$|$0$|1|不保证|一种|否
$\leq 6$|$\leq 10$|$10$|2|不保证|一种|否
$\leq 50$|$\leq 150$|$100$|3|不保证|一种|否
$\leq 100$|$\leq 300$|$200$|4|不保证|一种|否
$\leq 1500$|$\leq 4000$|$2000$|5|不保证|一种|否
$\leq 200000$|$\leq 400000$|$100000$|6|不保证|一种|否
$\leq 1500$|$=n-1$|$2000$|7|一条链|不保证|否
$\leq 1500$|$=n-1$|$2000$|8|一条链|不保证|否
$\leq 1500$|$=n-1$|$2000$|9|一条链|不保证|否
$\leq 200000$|$=n-1$|$100000$|10|一棵树|不保证|否
$\leq 200000$|$=n-1$|$100000$|11|一棵树|不保证|是
$\leq 200000$|$\leq 400000$|$100000$|12|不保证|不保证|否
$\leq 200000$|$\leq 400000$|$100000$|13|不保证|不保证|否
$\leq 200000$|$\leq 400000$|$100000$|14|不保证|不保证|否
$\leq 1500$|$\leq 4000$|$2000$|15|不保证|不保证|是
$\leq 1500$|$\leq 4000$|$2000$|16|不保证|不保证|是
$\leq 200000$|$\leq 400000$|$100000$|17|不保证|不保证|是
$\leq 200000$|$\leq 400000$|$100000$|18|不保证|不保证|是
$\leq 200000$|$\leq 400000$|$400000$|19|不保证|不保证|是
$\leq 200000$|$\leq 400000$|$400000$|20|不保证|不保证|是



---

---
title: "[NOI2018] 屠龙勇士"
layout: "post"
diff: 省选/NOI-
pid: P4774
tag: ['2018', 'NOI', 'O2优化', '不定方程', '中国剩余定理 CRT', '逆元']
---
# [NOI2018] 屠龙勇士
## 题目描述

小 D 最近在网上发现了一款小游戏。游戏的规则如下：

- 游戏的目标是按照编号 $1 \rightarrow n$ 顺序杀掉 $n$ 条巨龙，每条巨龙拥有一个初始的生命值 $a_i$ 。同时每条巨龙拥有恢复能力，当其使用恢复能力时，它的生命值就会每次增加 $p_i$ ，直至生命值非负。只有在攻击结束后且当生命值 **恰好** 为 $0$ 时它才会死去。
- 游戏开始时玩家拥有 $m$ 把攻击力已知的剑，每次面对巨龙时，玩家只能选择一把剑，当杀死巨龙后这把剑就会消失，但作为奖励，玩家会获得全新的一把剑。

小 D 觉得这款游戏十分无聊，但最快通关的玩家可以获得 ION2018 的参赛资格，于是小 D 决定写一个笨笨的机器人帮她通关这款游戏，她写的机器人遵循以下规则：

- 每次面对巨龙时，机器人会选择当前拥有的，攻击力不高于巨龙初始生命值中攻击力最大的一把剑作为武器。如果没有这样的剑，则选择 **攻击力最低** 的一把剑作为武器。
- 机器人面对每条巨龙，它都会使用上一步中选择的剑攻击巨龙固定的 $x$ 次，使巨龙的生命值减少 $x \times ATK$ 。
- 之后，巨龙会不断使用恢复能力，每次恢复 $p_i$ 生命值。若在使用恢复能力前或某一次恢复后其生命值为 $0$ ，则巨龙死亡，玩家通过本关。

那么显然机器人的攻击次数是决定能否最快通关这款游戏的关键。小 D 现在得知了每条巨龙的所有属性，她想考考你，你知道应该将机器人的攻击次数 $x$ 设置为多少，才能用最少的攻击次数通关游戏吗？

当然如果无论设置成多少都无法通关游戏，输出 $-1$ 即可。
## 输入格式

第一行一个整数 $T$，代表数据组数。

接下来 $T$ 组数据，每组数据包含 $5$ 行。

- 每组数据的第一行包含两个整数，$n$ 和 $m$ ，代表巨龙的数量和初始剑的数量；
- 接下来一行包含 $n$ 个正整数，第 $i$ 个数表示第 $i$ 条巨龙的初始生命值 $a_i$；
- 接下来一行包含 $n$ 个正整数，第 $i$ 个数表示第 $i$ 条巨龙的恢复能力 $p_i$；
- 接下来一行包含 $n$ 个正整数，第 $i$ 个数表示杀死第 $i$ 条巨龙后奖励的剑的攻击力；
- 接下来一行包含 $m$ 个正整数，表示初始拥有的 $m$ 把剑的攻击力。
## 输出格式

一共 $T$ 行。

第 $i$ 行一个整数，表示对于第 $i$ 组数据，能够使得机器人通关游戏的最小攻击次数 $x$ ，如果答案不存在，输出 $-1$。
## 样例

### 样例输入 #1
```
2
3 3
3 5 7
4 6 10
7 3 9
1 9 1000
3 2
3 5 6
4 8 7
1 1 1
1 1
```
### 样例输出 #1
```
59
-1
```
## 提示

### 更多样例

更多样例请在附加文件中下载。

### 样例 2

见附加文件中的 `dragon2.in` 与 `dragon2.ans`。

### 样例 1 解释

第一组数据：
- 开始时拥有的剑的攻击力为 $\{1,9,10\}$，第 $1$ 条龙生命值为 $3$，故选择攻击力为 $1$ 的剑，攻击 $59$ 次，造成 $59$ 点伤害，此时龙的生命值为 $-56$，恢复 14 次后生命值恰好为 $0$，死亡。

- 攻击力为 $1$ 的剑消失，拾取一把攻击力为 $7$ 的剑，此时拥有的剑的攻击力为
$\{7,9,10\}$，第 2 条龙生命值为 $5$，故选择攻击力为 $7$ 的剑，攻击 $59$ 次，造成 $413$ 点伤害，此时龙的生命值为 $-408$，恢复 $68$ 次后生命值恰好为 $0$，死亡。

- 此时拥有的剑的攻击力为 $\{3,9,10\}$，第 $3$ 条龙生命值为 $7$，故选择攻击力为 $3$ 的剑，攻击 $59$ 次，造成 $177$ 点伤害，此时龙的生命值为 $-170$，恢复 $17$ 次后生命值恰好为 0，死亡。

- 没有比 $59$ 次更少的通关方法，故答案为 $59$。

第二组数据：
不存在既能杀死第一条龙又能杀死第二条龙的方法，故无法通关，输出 $-1$。

### 子任务

测试点编号 |　　　$n$　　　|　　　$m$　　　|　　　$p_i$　　　|　　　$a_i$　　　| 　　攻击力　　 | 其他限制
-|-|-|-|-|-|-
1|$\le 10^5$|$=1$|$=1$|$\le 10^5$|$=1$| 无
2|$\le 10^5$|$=1$|$=1$|$\le 10^5$|$=1$| 无
3|$\le 10^5$|$=1$|$=1$|$\le 10^5$|$\le 10^5$| 无
4|$\le 10^5$|$=1$|$=1$|$\le 10^5$|$\le 10^5$| 无
5|$\le 10^3$|$\le 10^3$|$\le 10^5$|$\le 10^5$|$\le 10^5$| 特性 1、特性 2
6|$\le 10^3$|$\le 10^3$|$\le 10^5$|$\le 10^5$|$\le 10^5$| 特性 1、特性 2
7|$\le 10^3$|$\le 10^3$|$\le 10^5$|$\le 10^5$|$\le 10^5$| 特性 1、特性 2
8|$=1$|$=1$|$\le 10^8$|$\le 10^8$|$\le 10^6$| 特性 1
9|$=1$|$=1$|$\le 10^8$|$\le 10^8$|$\le 10^6$| 特性 1
10|$=1$|$=1$|$\le 10^8$|$\le 10^8$|$\le 10^6$| 特性 1
11|$=1$|$=1$|$\le 10^8$|$\le 10^8$|$\le 10^6$| 特性 1
12|$=1$|$=1$|$\le 10^8$|$\le 10^8$|$\le 10^6$| 特性 1
13|$=1$|$=1$|$\le 10^8$|$\le 10^8$|$\le 10^6$| 特性 1
14|$=10^5$|$=10^5$|$=1$|$\le 10^8$|$\le 10^6$| 无特殊限制
15|$=10^5$|$=10^5$|$=1$|$\le 10^8$|$\le 10^6$| 无特殊限制
16|$\le 10^5$|$\le 10^5$| 所有 $p_i$ 是质数 |$\le 10^{12}$|$\le 10^6$| 特性 1
17|$\le 10^5$|$\le 10^5$| 所有 $p_i$ 是质数 |$\le 10^{12}$|$\le 10^6$| 特性 1
18|$\le 10^5$|$\le 10^5$| 无特殊限制 |$\le 10^{12}$|$\le 10^6$| 特性 1
19|$\le 10^5$|$\le 10^5$| 无特殊限制 |$\le 10^{12}$|$\le 10^6$| 特性 1
20|$\le 10^5$|$\le 10^5$| 无特殊限制 |$\le 10^{12}$|$\le 10^6$| 特性 1

特性 1 是指：对于任意的 $i$，$a_i \le p_i$。

特性 2 是指：$\operatorname{lcm}(p_i) \le 10^6$，即所有 $p_i$ 的 **最小公倍数** 不大于 $10^6$。

对于所有的测试点，$T \le 5$，所有武器的攻击力 $\le 10^6$，所有 $p_i$ 的最小公倍数 $\le 10^{12}$。

保证 $ T, n, m $ 均为正整数。

### 提示

你所用到的中间结果可能很大，注意保存中间结果的变量类型。


---

---
title: "[NOIP 2018 提高组] 填数游戏"
layout: "post"
diff: 省选/NOI-
pid: P5023
tag: ['动态规划 DP', '数学', '2018', 'NOIP 提高组']
---
# [NOIP 2018 提高组] 填数游戏
## 题目背景

NOIP2018 提高组 D2T2
## 题目描述

小 D 特别喜欢玩游戏。这一天，他在玩一款填数游戏。
  
这个填数游戏的棋盘是一个 $n \times m$ 的矩形表格。玩家需要在表格的每个格子中填入一个数字（数字 $0$ 或者数字 $1$），填数时需要满足一些限制。   

下面我们来具体描述这些限制。   

为了方便描述，我们先给出一些定义： 
 
-  我们用每个格子的行列坐标来表示一个格子，即（行坐标，列坐标）。注意：行列坐标均从 $0$ 开始编号。
- 合法路径 $P$：一条路径是合法的当且仅当：   
    1. 这条路径从矩形表格的左上角的格子 $(0,0)$ 出发，到矩形的右下角格子 $(n - 1,m - 1)$ 结束；   
    2. 在这条路径中，每次只能从当前的格子移动到右边与它相邻的格子，或者从当前格子移动到下面与它相邻的格子。
    
  例如：在下面这个矩形中，只有两条路径是合法的，它们分别是 $P_1$：$(0,0)\to (0,1)\to (1,1)$ 和 $P_2$：$(0,0) \to (1,0) \to (1,1)$。
   
![](https://cdn.luogu.com.cn/upload/pic/43256.png)  

对于一条合法的路径 $P$，我们可以用一个字符串 $w(P)$ 来表示，该字符串的长度为 $n + m - 2$，其中只包含字符 $\texttt R$ 或者字符 $\texttt D$，第 $i$ 个字符记录了路径 $P$ 中第 $i$ 步的移动方法。$\texttt R$ 表示移动到当前格子右边与它相邻的格子，$\texttt D$ 表示移动到当前格子下面与它相邻的格子。例如，上图中对于路径 $P_1$，有 $w(P_1) = \texttt {RD}$；而对于另一条路径 $P_2$，有 $w(P_2) = \texttt {DR}$。   

同时，将每条合法路径 $P$ 经过的每个格子上填入的数字依次连接后，会得到一个长度为 $n + m - 1$ 的 $01$ 字符串，记为 $s(P)$。例如，如果我们在格子 $(0,0)$ 和 $(1,0)$ 上填入数字 $0$，在格子 $(0,1)$ 和 $(1,1)$ 上填入数字 $1$（见上图红色数字），那么对于路径 $P_1$，我们可以得到 $s(P_1) = 011$，对于路径 $P_2$，有 $s(P_2) = 001$。 

游戏要求小 D 找到一种填数字 $0$、$1$ 的方法，使得对于两条路径 $P_1$，$P_2$，如果 $w(P_1) > w(P_2)$，那么必须 $s(P_1) ≤ s(P_2)$。我们说字符串 $a$ 比字符串 $b$ 小，当且仅当字符串 $a$ 的字典序小于字符串 $b$ 的字典序，字典序的定义详见第一题。但是仅仅是找一种方法无法满足小 D 的好奇心，小 D 更想知道这个游戏有多少种玩法，也就是说，有多少种填数字的方法满足游戏的要求？ 

小 D 能力有限，希望你帮助他解决这个问题，即有多少种填 $0$、$1$ 的方法能满足题目要求。由于答案可能很大，你需要输出答案对 $10^9 + 7$ 取模的结果。 
## 输入格式

输入文件共一行，包含两个正整数 $n,m$，由一个空格分隔，表示矩形的大小。其中 $n$ 表示矩形表格的行数，$m$ 表示矩形表格的列数。 
## 输出格式

输出共一行，包含一个正整数，表示有多少种填 $0$、$1$ 的方法能满足游戏的要求。 注意：输出答案对 $10^9+7$ 取模的结果。 
## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
3 3
```
### 样例输出 #2
```
112
```
### 样例输入 #3
```
5 5
```
### 样例输出 #3
```
7136
```
## 提示

**样例解释**  

![](https://cdn.luogu.com.cn/upload/pic/43257.png)  

**数据规模与约定** 

| 测试点编号 | $n\le$ | $m\le$ |
| :-----------: | :-----------: | :-----------: |
| $1\sim 4$ | $3$ | $3$ |
| $5\sim 10$ | $2$ | $10^6$ |
| $11\sim 13$ | $3$ | $10^6$ |
| $14\sim 16$ | $8$ | $8$ |
| $17\sim 20$ | $8$ | $10^6$ |



---

---
title: "[NOIP 2018 提高组] 保卫王国"
layout: "post"
diff: 省选/NOI-
pid: P5024
tag: ['动态规划 DP', '2018', '倍增', 'NOIP 提高组', '树链剖分', '动态 DP', '全局平衡二叉树']
---
# [NOIP 2018 提高组] 保卫王国
## 题目背景

NOIP2018 提高组 D2T3
## 题目描述

Z 国有 $n$ 座城市，$(n - 1)$ 条双向道路，每条双向道路连接两座城市，且任意两座城市都能通过若干条道路相互到达。  

Z 国的国防部长小 Z 要在城市中驻扎军队。驻扎军队需要满足如下几个条件： 

- 一座城市可以驻扎一支军队，也可以不驻扎军队。   
- 由道路直接连接的两座城市中至少要有一座城市驻扎军队。   
- 在城市里驻扎军队会产生花费，在编号为 $i$ 的城市中驻扎军队的花费是 $p_i$。      

小 Z 很快就规划出了一种驻扎军队的方案，使总花费最小。但是国王又给小 Z 提出了 $m$ 个要求，每个要求规定了其中两座城市是否驻扎军队。小 Z 需要针对每个要求逐一给出回答。具体而言，如果国王提出的第 $j$ 个要求能够满足上述驻扎条件（不需要考虑第 $j$ 个要求之外的其它要求），则需要给出在此要求前提下驻扎军队的最小开销。如果国王提出的第 $j$ 个要求无法满足，则需要输出 $-1$。现在请你来帮助小 Z。 
## 输入格式

第一行有两个整数和一个字符串，依次表示城市数 $n$，要求数 $m$ 和数据类型 $type$。$type$ 是一个由大写字母 `A`，`B` 或 `C` 和一个数字 `1`，`2`，`3` 组成的字符串。它可以帮助你获得部分分。你可能不需要用到这个参数。这个参数的含义在【数据规模与约定】中 有具体的描述。

第二行有 $n$ 个整数，第 $i$ 个整数表示编号 $i$ 的城市中驻扎军队的花费 $p_i$。

接下来 $(n - 1)$ 行，每行两个整数 $u,v$，表示有一条 $u$ 到 $v$ 的双向道路。 

接下来 $m$ 行，每行四个整数 $a, x, b, y$，表示一个要求是在城市 $a$ 驻扎 $x$ 支军队，在城市 $b$ 驻扎 $y$ 支军队。其中，$x,y$ 的取值只有 $0$ 或 $1$：
- 若 $x$ 为 $0$，表示城市 $a$ 不得驻扎军队。
- 若 $x$ 为 $1$，表示城市 $a$ 必须驻扎军队。
- 若 $y$ 为 $0$，表示城市 $b$ 不得驻扎军队。
- 若 $y$ 为 $1$，表示城市 $b$ 必须驻扎军队。    

输入文件中每一行相邻的两个数据之间均用一个空格分隔。 
## 输出格式

输出共 $m$ 行，每行包含一个个整数，第 $j$ 行表示在满足国王第 $j$ 个要求时的最小开销， 如果无法满足国王的第 $j$ 个要求，则该行输出 $-1$。 
## 样例

### 样例输入 #1
```
5 3 C3 
2 4 1 3 9 
1 5 
5 2 
5 3 
3 4 
1 0 3 0 
2 1 3 1 
1 0 5 0

```
### 样例输出 #1
```
12 
7 
-1
```
## 提示

#### 样例 1 解释

- 对于第一个要求，在 $4$ 号和 $5$ 号城市驻扎军队时开销最小。
- 对于第二个要求，在 $1$ 号、$2$ 号、$3$ 号城市驻扎军队时开销最小。   
- 第三个要求是无法满足的，因为在 $1$ 号、$5$ 号城市都不驻扎军队就意味着由道路直接连 接的两座城市中都没有驻扎军队。  

#### 数据规模与约定  

| 测试点编号 | $\text{type}$ | $n = m=$ |
|:-:|:-:|:-:|
| $1,2$ | `A3` | $10$ |
| $3,4$ | `C3` | $10$ |
| $5,6$ | `A3` | $100$ |
| $7$ | `C3` | $100$ |
| $8,9$ | `A3` | $2\times 10^3$ |
| $10,11$ | `C3` | $2\times 10^3$ |
| $12,13$ | `A1` | $10^5$ |
| $14, 15, 16$ | `A2` | $10^5$ |
| $17$ | `A3` | $10^5$ |
| $18,19$ | `B1` | $10^5$ |
| $20,21$ | `C1` | $10^5$ |
| $22$ | `C2` | $10^5$ |
| $23, 24, 25$ | `C3` | $10^5$ |

数据类型的含义：   

- `A`：城市 $i$ 与城市 $i + 1$ 直接相连。    
- `B`：任意城市与城市 $1$ 的距离不超过 $100$（距离定义为最短路径上边的数量），即如果这 棵树以 $1$ 号城市为根，深度不超过 $100$。   
- `C`：在树的形态上无特殊约束。   
- `1`：询问时保证 $a = 1,x = 1$，即要求在城市 $1$ 驻军。对 $b,y$ 没有限制。   
- `2`：询问时保证 $a,b$ 是相邻的（由一条道路直接连通）  
- `3`：在询问上无特殊约束。

对于 $100\%$的数据，保证 $1 \leq n,m ≤ 10^5$，$1 ≤ p_i ≤ 10^5$，$1 \leq u, v, a, b \leq n$，$a \neq b$，$x, y \in \{0, 1\}$。


---

---
title: "[NOIP 2018 提高组] 旅行 加强版"
layout: "post"
diff: 省选/NOI-
pid: P5049
tag: ['2018', 'NOIP 提高组', '基环树']
---
# [NOIP 2018 提高组] 旅行 加强版
## 题目描述

小 Y 是一个爱好旅行的 OIer。她来到 X 国，打算将各个城市都玩一遍。 
  
小Y了解到，X 国的 $n$ 个城市之间有 $m$ 条双向道路。每条双向道路连接两个城市。 不存在两条连接同一对城市的道路，也不存在一条连接一个城市和它本身的道路。并且， 从任意一个城市出发，通过这些道路都可以到达任意一个其他城市。小 Y 只能通过这些 道路从一个城市前往另一个城市。   

小 Y 的旅行方案是这样的：任意选定一个城市作为起点，然后从起点开始，每次可 以选择一条与当前城市相连的道路，走向一个没有去过的城市，或者沿着第一次访问该 城市时经过的道路后退到上一个城市。当小 Y 回到起点时，她可以选择结束这次旅行或 继续旅行。需要注意的是，小 Y 要求在旅行方案中，每个城市都被访问到。   

为了让自己的旅行更有意义，小 Y 决定在每到达一个新的城市（包括起点）时，将 它的编号记录下来。她知道这样会形成一个长度为 $n$ 的序列。她希望这个序列的字典序 最小，你能帮帮她吗？  对于两个长度均为 $n$ 的序列 $A$ 和 $B$，当且仅当存在一个正整数 $x$，满足以下条件时， 我们说序列 $A$ 的字典序小于 $B$。 
  
- 对于任意正整数 $1 ≤ i < x$，序列 $A$ 的第 $i$ 个元素 $A_i$ 和序列 $B$ 的第 $i$ 个元素 $B_i$ 相同。   
- 序列 $A$ 的第 $x$ 个元素的值小于序列 $B$ 的第 $x$ 个元素的值。 
## 输入格式

输入文件共 $m + 1$ 行。第一行包含两个整数 $n,m(m ≤ n)$，中间用一个空格分隔。
 
接下来 m 行，每行包含两个整数 $u,v (1 ≤ u,v ≤ n)$ ，表示编号为 $u$ 和 $v$ 的城市之 间有一条道路，两个整数之间用一个空格分隔。 
## 输出格式

输出文件包含一行，$n$ 个整数，表示字典序最小的序列。相邻两个整数之间用一个 空格分隔。 
## 样例

### 样例输入 #1
```
6 5 
1 3 
2 3 
2 5 
3 4 
4 6
```
### 样例输出 #1
```
1 3 2 5 4 6
```
### 样例输入 #2
```
6 6 
1 3 
2 3 
2 5 
3 4 
4 5 
4 6
```
### 样例输出 #2
```
1 3 2 4 5 6
```
## 提示

【数据规模与约定】   

对于 $100\%$ 的数据和所有样例， $1 \le n \le 500000 $ 且 $m = n - 1$ 或 $m = n$ 。

具体规定详见正常版本（除 testcase11-13）


---

---
title: "[NOI2019] 回家路线"
layout: "post"
diff: 省选/NOI-
pid: P5468
tag: ['动态规划 DP', '2019', 'NOI', 'O2优化', '深度优先搜索 DFS', '生成树']
---
# [NOI2019] 回家路线
## 题目背景

本题原题数据强度较低，若想要测试较强数据可以去 [P6302](https://www.luogu.com.cn/problem/P6302)，除数据范围外均与原题相同。
## 题目描述

猫国的铁路系统中有 $n$ 个站点，从 $1 - n$ 编号。小猫准备从 $1$ 号站点出发，乘坐列车回到猫窝所在的 $n$ 号站点。它查询了能够乘坐的列车，这些列车共 $m$ 班，从$1 - m$编号。小猫将在 $0$ 时刻到达 $1$ 号站点。对于 $i$ 号列车，它将在时刻 $p_i$ 从站点 $x_i$ 出发，在时刻 $q_i$ 直达站点 $y_i$，小猫只能在时刻 $p_i$ 上 $i$ 号列车，也只能在时刻 $q_i$ 下 $i$ 号列车。小猫可以通过多次换乘到达 $n$ 号站点。一次换乘是指对于两班列车，假设分别为 $u$ 号与 $v$ 号列车，若 $y_u = x_v$ 并且 $q_u \leq p_v$，那么小猫可以乘坐完 $u$ 号列车后在 $y_u$ 号站点等待 $p_v - q_u$ 个时刻，并在时刻 $p_v$ 乘坐 $v$ 号列车。

小猫只想回到猫窝并且减少途中的麻烦，对此它用烦躁值来衡量。

- 小猫在站点等待时将增加烦躁值，对于一次 $t (t \geq 0)$ 个时刻的等待，烦躁值将增加 $At^2 + Bt + C$，其中 $A, B,C$ 是给定的常数。注意：小猫登上第一班列车前，即从 $0$ 时刻起停留在 $1$ 号站点的那些时刻也算作一次等待。

- 若小猫最终在时刻 $z$ 到达 $n$ 号站点，则烦躁值将再增加 $z$。

形式化地说，若小猫共乘坐了 $k$ 班列车，依次乘坐的列车编号可用序列 $s_1, s_2, \cdots , s_k$表示。该方案被称作一条可行的回家路线，当且仅当它满足下列两个条件：

1. $x_{s1} = 1$ , $y_{sk} = n$

2. 对于所有 $j (1 \leq j < k)$，满足 $y_{sj} = x_{s_{j+1}}$ 且 $q_{sj}\leq p_{s_{j+1}}$

对于该回家路线，小猫得到的烦躁值将为：

$$q_{s_k}+(A\times p_{s_1}^2+B\times p_{s_1}+C)+\sum_{j=1}^{k-1}(A(p_{s_{j+1}}-q_{s_j})^2+B(p_{s_{j+1}}-q_{s_j})+C)$$

小猫想让自己的烦躁值尽量小，请你帮它求出所有可行的回家路线中，能得到的最
小的烦躁值。题目保证至少存在一条可行的回家路线。

## 输入格式

第一行五个整数 $n, m, A, B,C$，变量意义见题目描述。

接下来 $m$ 行，第 $i$ 行四个整数 $x_i, y_i, p_i, q_i$，分别表示 $i$ 号列车的出发站、到达站、出发时刻与到达时刻。
## 输出格式

输出仅一行一个整数，表示所求的答案。

## 样例

### 样例输入 #1
```
3 4 1 5 10
1 2 3 4
1 2 5 7
1 2 6 8
2 3 9 10
```
### 样例输出 #1
```
94
```
### 样例输入 #2
```
4 3 1 2 3
1 2 2 3
2 3 5 7
3 4 7 9
```
### 样例输出 #2
```
34
```
## 提示

### 更多样例

您可以通过附加文件获得更多样例。

#### 样例 3

见附加文件的 `route/route3.in` 与 `route/route3.ans`。

该样例的数据类型与最终测试点 $5 \sim 8$ 一致。

#### 样例 4

见附加文件的 `route/route4.in` 与 `route/route4.ans`。

该样例的数据类型与最终测试点 $11 \sim 14$ 一致。

#### 样例 5

见附加文件的 `route/route5.in` 与 `route/route5.ans`。

该样例的数据类型与最终测试点 $18 \sim 20$ 一致。

### 样例 1 解释

共有三条可行的回家路线：

- 依次乘坐 1，4 号列车，得到的烦躁值为：$10 + (1 \times 3^2 + 5 \times 3 + 10) + (1 \times (9 - 4)^2 + 5 \times (9 - 4) + 10)= 104$
- 依次乘坐 2，4 号列车，得到的烦躁值为：$10 + (1 \times 5^2 + 5 \times 5 + 10) + (1 \times (9 - 7)^2 + 5 \times (9 - 7) + 10)= 94$
- 依次乘坐 3，4 号列车，得到的烦躁值为：$10 + (1 \times 6^2 + 5 \times 6 + 10) + (1 \times (9 - 8)^2 + 5 \times (9 - 8) + 10)= 102$

第二条路线得到的烦躁值最小为 $94$。

### 数据范围

对于所有测试点：$2\le n\le 10^5,1\le m\le 2\times 10^5,0 \le A \le 10 , 0 \le B, C \le 10^6,1 \le x_i, y_i \le n , x_i \neq y_i , 0 \le p_i < q_i \le 10^3$。

每个测试点的具体限制见下表：

| 测试点编号  |        $n$         |          $m$          | $A,B,C$ 的特殊限制 | 其他特殊条件 |
| :---------: | :----------------: | :-------------------: | :----------------: | :----------: |
|  $1\sim 2$  |     $\le 100$      |        $=n-1$         |         无         | $y_i=x_i+1$  |
|  $3\sim 4$  |     $\le 100$      | $\le 100$ |     $A=B=C=0$      | $y_i=x_i+1$  |
|  $5\sim 8$  | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |     $A=B=C=0$      |  $x_i<y_i$   |
|     $9$     | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |      $A=B=0$       |  $x_i<y_i$   |
|    $10$     | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |       $A=0$        |  $x_i<y_i$   |
| $11\sim 14$ | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |         无         |      无      |
|    $15$     |     $\le 10^5$     |  $\le 2\times 10^5$   |      $A=B=0$       |      无      |
| $16\sim 17$ |     $\le 10^5$     |  $\le 2\times 10^5$   |       $A=0$        |      无      |
| $18\sim 20$ |     $\le 10^5$     |  $\le 2\times 10^5$   |         无         |      无      |


---

---
title: "[NOI2019] 弹跳"
layout: "post"
diff: 省选/NOI-
pid: P5471
tag: ['2019', 'NOI', 'O2优化']
---
# [NOI2019] 弹跳
## 题目背景

原题时限 2s

内存 128MB
## 题目描述

跳蚤国有 $n$ 座城市，分别编号为 $1 - n$，$1$ 号城市为首都。所有城市分布在一个$w \times h$ 范围的网格上。每座城市都有一个整数坐标 $(x, y) (1 \leq x \leq w, 1 \leq y \leq h)$，不同城市的坐标不相同。

在跳蚤国中共有 $m$ 个弹跳装置，分别编号为 $1 - m$，其中 $i$ 号弹跳装置位于 $p_i$ 号城市，并具有参数 $t_i, L_i, R_i, D_i, U_i$。利用该弹跳装置，跳蚤可花费 $t_i (t_i > 0)$ 个单位时间，从 $p_i$ 号城市跳至坐标满足 $L_i \leq x \leq R_i, D_i \leq y \leq U_i (1 \leq L_i \leq R_i \leq w, 1 \leq D_i \leq U_i \leq h)$ 的任意一座城市。需要注意的是，一座城市中可能存在多个弹跳装置，也可能没有弹跳装置。

由于城市间距离较远，跳蚤们必须依靠弹跳装置出行。具体来说，一次出行将经过
若干座城市，依次经过的城市的编号可用序列 $a_0, a_1, \cdots , a_k$ 表示；在此次出行中，依次利用的弹跳装置的编号可用序列 $b_1, b_2, \cdots , b_k$ 表示。其中每座城市可在序列 $\{a_j\}$ 中出现任意次，每个弹跳装置也可在序列 $\{b_j\}$ 中出现任意次，且满足，对于每个 $j (1 \leq j \leq k)$，编号为 $b_j$ 的弹跳装置位于城市 $a_{j-1}$，且跳蚤能通过该弹跳装置跳至城市 $a_j$。我们称这是一次从城市 $a_0$ 到城市 $a_k$ 的出行，其进行了 $k$ 次弹跳，共花费 $\sum^k_{i=1} t_{b_{i}}$ 个单位时间。

现在跳蚤国王想知道，对于跳蚤国除首都（$1$ 号城市）外的每座城市，从首都出发，到达该城市最少需要花费的单位时间。跳蚤国王保证，对每座城市，均存在从首都到它的出行方案。

## 输入格式

第一行包含四个整数 $n, m,w, h$，变量的具体意义见题目描述。

接下来 $n$ 行，第 $i$ 行包含两个整数 $x_i, y_i$，表示 $i$ 号城市的坐标。

接下来 $m$ 行，第 $i$ 行包含六个整数 $p_i, t_i, L_i, R_i, D_i, U_i$，分别表示 $i$ 号弹跳装置所在的城市编号、弹跳所需的时间、可到达的矩形范围。这些整数的具体意义见题目描述。
## 输出格式

输出 $n - 1$ 行，第 $i$ 行包含一个整数，表示从跳蚤国首都到 $i + 1$ 号城市最少需要花费的单位时间。

## 样例

### 样例输入 #1
```
5 3 5 5
1 1
3 1
4 1
2 2
3 3
1 123 1 5 1 5
1 50 1 5 1 1
3 10 2 2 2 2
```
### 样例输出 #1
```
50
50
60
123

```
## 提示

### 更多样例

您可以通过附加文件获得更多样例。

#### 样例 2

见附加文件中的 `jump/jump2.in` 与 `jump/jump2.ans`。

这组样例的数据范围为 $n = 10^4 , m = 2\times 10^4 , w = 10^4 , h = 1$。

#### 样例 3

见附加文件中的 `jump/jump3.in` 与 `jump/jump3.ans`。

这组样例的数据范围为 $n = 10^4 , m = 2\times 10^4 , w = 10^4 , h = 10^4$。

### 数据范围

对于所有测试点和样例满足：

$1 \leq n \leq 70000 , 1 \leq m \leq 150000 , 1 \leq w, h \leq n , 1 \leq t_i \leq 10000$。

每个测试点的具体限制见下表。

| 测试点编号 | $1\le n\le$ | $1\le m\le$ | 特殊限制 |
| :----------: | :----------: | :----------: | :----------: |
| $1\sim8$ | $100$ | $100$ | 无 |
| $9\sim13$ | $5\times 10^4$ | $10^5$ | 每个弹跳装置恰好可达一座城市，且 $L_i=R_i$，$D_i=U_i$ |
| $14\sim18$ | $5\times 10^4$ | $10^5$ | $h=1$ | 
| $19\sim22$ | $2.5\times 10^4$ | $5\times 10^4$ | 无 | 
| $23\sim25$ | $7\times 10^4$ | $1.5\times 10^5$ | 无 | 


---

---
title: "[NOI2004] 曼哈顿"
layout: "post"
diff: 省选/NOI-
pid: P5747
tag: ['2004', 'NOI', 'Special Judge']
---
# [NOI2004] 曼哈顿
## 题目描述

P 城是 M 国的著名旅游城市。在市长 G 先生的治理下，人民安居乐业，城市欣欣向荣。然而，G 市长并没有被自己的政绩冲昏头脑，他清醒地意识到城市的治理还存在着一些问题，其中之一就是交通问题。

P 城有 $m$ 条横向街道和 $n$ 条纵向街道，横向街道横贯东西，纵向街道纵穿南北，构成了 P 城整齐的交通网络（如图1所示）。

![](https://cdn.luogu.com.cn/upload/image_hosting/k1ei30qk.png)

由于街道狭窄，每条街道都只允许单向行驶，单向行驶的方向是事先设定好了的。一条横向街道的行驶方向只能是向东或者向西，一条纵向街道的行驶方向只能是向南或者向北，逆向行驶是绝对禁止的。

这项限制给交通带来了巨大的不便。如图 1，很多游人希望从宾馆前往购物中心，但限于街道的行驶方向，他们不得不绕一个大圈才能够到达。

这个问题一直困扰着 G 市长，每天他都会收到不少游人的来信，抱怨P城不合理的交通设计。但由于街道数目过多，他和他的部下始终不能解决这个问题……

令人高兴的是这个问题不久就可能得以解决。因为最近他们以重金聘请了著名的交通规划大师 B 先生，请他对 P 城的交通进行有效合理的改造。

B 先生知道不能通过拓宽街道的方法解决问题，因为这样势必影响到街道两旁的旅游景点，这是大家都不希望看到的。于是他准备重新设计街道的行驶方向（整条街道的行驶方向），使之尽可能满足大家的要求。

B 先生先把 P 城的街道编号，横向街道由北向南编号为 $1$，$2$，$\ldots$，$m$，纵向街道由西向东编号为 $1$，$2$，$\ldots$，$n$。这样任何一个十字路口的位置都可以用一对正整数来表示，第一个数是该路口所在的横向街道的编号，第二个数是它所在的纵向街道的编号，这对整数被称为该十字路口的坐标。比如图 1 中宾馆所在的十字路口的坐标是 $(2,3)$。
经过长期调查，他整理出了游人们提得相对集中的一些要求。每条要求都可以写成如下的形式：从一个十字路口到另一个十字路口的最短路径的长度必须等于它们之间的曼哈顿距离。所谓曼哈顿距离是指两个十字路口在东西方向上的距离加上在南北方向上的距离，坐标分别为 $(x_1,y_1)$ 和 $(x_2,y_2)$ 的两个十字路口之间的曼哈顿距离为 $|x_1-x_2|+|y_1-y_2|$。

好了，B 先生已经知道了 P 城目前所有街道的行驶方向和游人们提得相对集中的要求，他能不能重新设计街道的行驶方向，使之满足所有要求呢？

另外，改变每条街道的行驶方向都有一定的工作量，工作量的大小因道路而异。B 先生不仅想找到一个可行的改造计划，而且还希望这个计划的总工作量尽可能小。你能帮帮他吗？

## 输入格式

输入文件的第一行有两个正整数 $m$ 和 $n$，分别表示横向街道和纵向街道的数目。

第二行是一个长度为 $m$ 的字符串，由北向南列出了 $m$ 条横向街道改造前的行驶方向。`E` 表示向东，`W` 表示向西。

第三行是一个长度为 $n$ 的字符串，由西向东列出了 $n$ 条纵向街道改造前的行驶方向。`S` 表示向南，`N` 表示向北。

第四行有 $m$ 个非负整数，由北向南列出了改变每条横向街道的行驶方向的工作量。

第五行有 $n$ 个非负整数，由西向东列出了改变每条纵向街道的行驶方向的工作量。

第六行是一个正整数 $k$，表示游人们提得相对集中的要求的数目。

接下来的 $k$ 行，每行有四个正整数 $x_1$，$y_1$，$x_2$，$y_2$，表示一条要求。这条要求的内容是希望从坐标为 $(x_1,y_1)$ 的十字路口到坐标为 $(x_2,y_2)$ 的十字路口的最短路径的长度等于这两个路口之间的曼哈顿距离。
## 输出格式

第一行是一个字符串，`possible` 或者 `impossible`。输出 `possible` 表示可以通过改变街道的行驶方向满足输入数据中的所有要求，输出 `impossible` 表示无论怎么设计都不可能满足输入数据中的所有要求。

如果在第一行输出的是 `possible` 的话，在第二行输出一个整数，表示最小的总工作量，在第三行输出一个长度为 $m$ 的字符串，由北向南列出改造后的 $m$ 条横向街道的行驶方向，`E` 表示向东，`W` 表示向西，在第四行输出一个长度为 $n$ 的字符串，由西向东列出改造后的 $n$ 条纵向街道的行驶方向，`S` 表示向南，`N` 表示向北。
## 样例

### 样例输入 #1
```
2 3
WE
NNS
3 9
1 4 2
2
1 3 2 1
2 3 2 2
```
### 样例输出 #1
```
possible
9
WW
NNS
```
## 提示

#### 数据范围
对于全部的数据，$m\le 10$，$n\le 100$，$k\le 100$；改变一条街道的行驶方向的工作量不超过 $10000$。

#### 评分方式
- 如果你的输出文件的第一行是 `impossible`，
  - 如果确实无解，则该测试点满分。
  - 如果实际有解，则该测试点 $0$ 分。
- 如果你的输出文件的第一行是 `possible`，
  - 如果你的程序输出的方案不可行，则该测试点 $0$ 分。
  - 如果你的程序输出的总工作量与实际总工作量不一致，则该测试点 $0$ 分。
  - 如果你的程序输出的方案可行，但总工作量不是最小的，则该测试点 $4$ 分。
  - 如果你的程序输出的方案可行，且总工作量最小，则该测试点满分。


---

---
title: "[NOI2000] 古城之谜"
layout: "post"
diff: 省选/NOI-
pid: P5757
tag: ['2000', 'NOI']
---
# [NOI2000] 古城之谜
## 题目描述

著名的考古学家石教授在云梦高原上发现了一处古代城市遗址。让教授欣喜的是在这个他称为冰峰城 (Ice-Peak City) 的城市中有 $12$ 块巨大石碑，上面刻着用某种文字书写的资料，他称这种文字为冰峰文。然而当教授试图再次找到冰峰城时，却屡屡无功而返。

幸好当时教授把石碑上的文字都拍摄了下来，为了解开冰峰城的秘密，教授和他的助手牛博士开始研究冰峰文，发现冰峰文只有陈述句这一种句型和名词 (n) 、动词 (v) 、辅词 (a) 这三类单词，且其文法很简单：

![](https://cdn.luogu.com.cn/upload/image_hosting/fj2tbbqd.png)

在研究了大量资料后，他们总结了一部冰峰文词典，由于冰峰文恰好有 $26$ 个字母，为了研究方便，用字母 $a$ 到 $z$ 表示它们。

冰峰文在句子和句子之间以及单词和单词之间没有任何分隔符，因此划分单词和句子令石教授和牛博士感到非常麻烦，于是他们想到了使用计算机来帮助解决这个问题。假设你接受了这份工作，你的第一个任务是写一个程序，将一篇冰峰文文章划分为最少的句子，在这个前提下，将文章划分为最少的单词。

## 输入格式

-	第 $1$ 行为词典中的单词数 $n$ （$ n \le 1000 $）。
-	第 $2$ 行至第 $(n+1)$ 行每行表示一个单词，形为 $"α.mot"$ ，$α$ 表示词性，可能是 n (名词), v（动词）, a（辅词）中的一个， $mot$ 为单词，单词的长度不超过 $20$ 。拼写相同而词性不同的单词视为不同的单词，如输入示例中的 n.kick 与 v.kick 是两个不同的单词。
-	输入文件第 $(n+2)$ 行为需要划分的文章，以 "." 结束。
-	输入文件中的文章确保为冰峰文。文章是由有限个句子组成的，每个句子只包含有限个单词。文章长度不超过 5KB。

## 输出格式

-	为两行，每行一个整数。
-	第 $1$ 行为划分出来的句子数。
-	第 $2$ 行为划分出来的单词数。

## 样例

### 样例输入 #1
```
11
n.table
n.baleine
a.silly
n.snoopy
n.sillysnoopy
v.is
v.isnot
n.kick
v.kick
a.big
v.cry
sillysnoopyisnotbigtablebaleinekicksnoopysillycry.

```
### 样例输出 #1
```
2
9

```
## 提示

**样例说明**

（为了阅读方便，划分的单词用空格分隔，在单词的右上角标出它的词性，每行写一个句子，用句号表示句子结束。）

输出对应的划分：

$ sillysnoopy^n \quad isnot^v \quad big^a \quad table^n. \\
baleine^n \quad kick^v \quad snoopy^n \quad silly^a \quad cry^v. $

如果用下面的划分：

$ silly^a \quad snoopy^n \quad isnot^v \quad big^a \quad table^n. \\
baleine^n \quad kick^v \quad snoopy^n \quad silly^a \quad cry^v.$

则划分的句子数仍为 $2$ 个，但单词数却多了 $1$ 个，为 $10$ 个，显然应该按前者而不是后者划分。



---

---
title: "[NOI Online #1 入门组] 跑步"
layout: "post"
diff: 省选/NOI-
pid: P6189
tag: ['动态规划 DP', '数学', '2020', 'NOI Online']
---
# [NOI Online #1 入门组] 跑步
## 题目描述

小 H 是一个热爱运动的孩子，某天他想给自己制定一个跑步计划。小 H 计划跑 $n$ 米，其中第 $i(i \geq 1)$ 分钟要跑 $x_i$ 米（$x_i$ 是正整数），但没有确定好总时长。

由于随着跑步时间增加，小 H 会越来越累，所以小 H 的计划必须满足对于任意 $i(i >1)$ 都满足 $x_i \leq x_{i-1}$。

现在小 H 想知道一共有多少个不同的满足条件的计划，请你帮助他。两个计划不同当且仅当跑步的总时长不同，或者存在一个 $i$，使得两个计划中 $x_i$ 不相同。

由于最后的答案可能很大，你只需要求出答案对 $p$ 取模的结果。 
## 输入格式

输入只有一行两个整数，代表总米数 $n$ 和模数 $p$。
## 输出格式

输出一行一个整数，代表答案对 $p$ 取模的结果。
## 样例

### 样例输入 #1
```
4 44

```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
66 666666

```
### 样例输出 #2
```
323522
```
### 样例输入 #3
```
66666 66666666

```
### 样例输出 #3
```
45183149

```
## 提示

#### 样例输入输出 1 解释

五个不同的计划分别是：$\{1,1,1,1\}$，$\{2,1,1\}$，$\{3,1\}$，$\{2,2\}$，$\{4\}$。 

---

#### 数据规模与约定

本题共 $10$ 个测试点，各测试点信息如下表。

| 测试点编号 | $n \leq$ | 测试点编号 | $n \leq$ |
| :----------: | :---------: | :----------: | :---------: |
| $1$ | $5$ | $6$ | $2\times 10^3$ |
| $2$ | $10$ | $7$ | $5\times 10^3$ |
| $3$ | $50$ | $8$ | $2\times 10^4$ |
| $4$ | $100$ | $9$ | $5\times 10^4$ |
| $5$ | $500$ | $10$ | $10^5$|

对于全部的测试点，保证 $1 \leq n \leq 10^5$，$1 \leq p < 2^{30}$。


---

---
title: "[NOI Online #1 入门组] 魔法"
layout: "post"
diff: 省选/NOI-
pid: P6190
tag: ['动态规划 DP', '图论', '2020', '倍增', '矩阵加速', '最短路', 'NOI Online']
---
# [NOI Online #1 入门组] 魔法
## 题目描述

C 国由 $n$ 座城市与 $m$ 条有向道路组成，城市与道路都从 $1$ 开始编号，经过 $i$ 号道路需要 $t_i$ 的费用。

现在你要从 $1$ 号城市出发去 $n$ 号城市，你可以施展最多 $k$ 次魔法，使得通过下一条道路时，需要的费用变为原来的相反数，即费用从 $t_i$ 变为 $-t_i$。请你算一算，你至少要花费多少费用才能完成这次旅程。

注意：使用魔法只是改变一次的花费，而不改变一条道路自身的 $t_i$；最终的费用可以为负，并且一个城市可以经过多次（包括 $n$ 号城市）。 
## 输入格式

输入的第一行有三个整数，分别代表城市数 $n$，道路数 $m$ 和魔法次数限制 $k$。

第 $2$ 到第 $(m + 1)$ 行，每行三个整数。第 $(i + 1)$ 行的整数 $u_i, v_i, t_i$ 表示存在一条从 $u_i$ 到 $v_i$ 的单向道路，经过它需要花费 $t_i$。
## 输出格式

输出一行一个整数表示最小的花费。
## 样例

### 样例输入 #1
```
4 3 2
1 2 5
2 3 4
3 4 1

```
### 样例输出 #1
```
-8
```
### 样例输入 #2
```
2 2 2
1 2 10
2 1 1

```
### 样例输出 #2
```
-19
```
## 提示

#### 输入输出样例 1 解释

依次经过 $1$ 号道路、$2$ 号道路、$3$ 号道路，并在经过 $1,2$ 号道路前使用魔法。 

#### 输入输出样例 2 解释

依次经过 $1$ 号道路、$2$ 号道路、$1$ 号道路，并在两次经过 $1$ 号道路前都使用魔法。 

#### 数据规模与约定

本题共 $20$ 个测试点，各测试点信息见下表。

| 测试点编号 | $n \leq$ | $m \leq$ | $k \leq$ | 无环 |
| :----------: | :--------: | :---------: | :--------: | :----: |
| $1 \sim 2$ | $5$ | $20$ | $0$ | 不保证 |
| $3 \sim 4$ | $10$ | $20$ | $50$ | 不保证 |
| $5 \sim 6$ | $10$ | $20$ | $0$| 不保证 |
| $7 \sim 8$ | $20$ | $200$ | $50$ | 是 |
| $9 \sim 10$ | $20$ | $200$ | $0$ | 不保证 |
| $11 \sim 12$ | $100$ | $200$ | $50$ | 是 |
| $13 \sim 14$ | $100$ | $200$ | $50$ | 不保证 |
| $15 \sim 18$ | $100$ | $2500$ | $1000$ | 不保证 |
| $19 \sim 20$ | $100$ | $2500$ | $10^6$ | 不保证 |

对于【无环】一栏为“是”的测试点，保证给出的图是一张有向无环图，否则不对图的形态做任何保证。

对于全部的测试点，保证：
- $1 \leq n \leq 100$，$1 \leq m \leq 2500$，$0 \leq k \leq 10^6$。
- $1 \leq u_i, v_i \leq n$，$1 \leq t_i \leq 10^9$。
- 给出的图无重边和自环，且至少存在一条能从 $1$ 到达 $n$ 的路径。

**民间数据使用 [CYaRon](https://github.com/luogu-dev/cyaron) 在 5 分钟内生成。如果发现数据有问题，请在讨论版发帖或私信 @[StudyingFather](/user/22030)**


---

---
title: "[NOI2019] 回家路线 加强版"
layout: "post"
diff: 省选/NOI-
pid: P6302
tag: ['动态规划 DP', '2019', 'NOI', 'O2优化', '斜率优化']
---
# [NOI2019] 回家路线 加强版
## 题目背景

本题是 NOI 2019 回家路线的加强版，除数据范围外均与原题相同。
## 题目描述

猫国的铁路系统中有 $n$ 个站点，从 $1 - n$ 编号。小猫准备从 $1$ 号站点出发，乘坐列车回到猫窝所在的 $n$ 号站点。它查询了能够乘坐的列车，这些列车共 $m$ 班，从 $1 - m$ 编号。小猫将在 $0$ 时刻到达 $1$ 号站点。对于 $i$ 号列车，它将在时刻 $p_i$ 从站点 $x_i$ 出发，在时刻 $q_i$ 直达站点 $y_i$，小猫只能在时刻 $p_i$ 上 $i$ 号列车，也只能在时刻 $q_i$ 下 $i$ 号列车。小猫可以通过多次换乘到达 $n$ 号站点。一次换乘是指对于两班列车，假设分别为 $u$ 号与 $v$ 号列车，若 $y_u = x_v$ 并且 $q_u \leq p_v$，那么小猫可以乘坐完 $u$ 号列车后在 $y_u$ 号站点等待 $p_v - q_u$ 个时刻，并在时刻 $p_v$ 乘坐 $v$ 号列车。

小猫只想回到猫窝并且减少途中的麻烦，对此它用烦躁值来衡量。

 - 小猫在站点等待时将增加烦躁值，对于一次 $t (t \geq 0)$ 个时刻的等待，烦躁值将增加 $At^2 + Bt + C$，其中 $A, B,C$ 是给定的常数。注意：小猫登上第一班列车前，即从 $0$ 时刻起停留在 $1$ 号站点的那些时刻也算作一次等待。

 - 若小猫最终在时刻 $z$ 到达 $n$ 号站点，则烦躁值将再增加 $z$。

形式化地说，若小猫共乘坐了 $k$ 班列车，依次乘坐的列车编号可用序列 $s_1, s_2, \cdots , s_k$ 表示。该方案被称作一条可行的回家路线，当且仅当它满足下列两个条件：

 - $x_{s1} = 1,y_{sk} = n$

 - 对于所有 $j (1 \leq j < k)$，满足 $y_{sj} = x_{s_{j+1}}$ 且 $q_{sj}\leq p_{s_{j+1}}$ 

对于该回家路线，小猫得到的烦躁值将为：

$$q_{s_k}+(A\times p_{s_1}^2+B\times p_{s_1}+C)+\sum_{j=1}^{k-1}(A(p_{s_{j+1}}-q_{s_j})^2+B(p_{s_{j+1}}-q_{s_j})+C)$$

小猫想让自己的烦躁值尽量小，请你帮它求出所有可行的回家路线中，能得到的最 小的烦躁值。题目保证至少存在一条可行的回家路线。
## 输入格式

第一行五个整数 $n, m, A, B,C$，变量意义见题目描述。

接下来 $m$ 行，第 $i$ 行四个整数 $x_i, y_i, p_i, q_i$，分别表示 $i$ 号列车的出发站、到达站、出发时刻与到达时刻。
## 输出格式

输出仅一行一个整数，表示所求的答案。
## 样例

### 样例输入 #1
```
3 4 1 5 10
1 2 3 4
1 2 5 7
1 2 6 8
2 3 9 10
```
### 样例输出 #1
```
94
```
### 样例输入 #2
```
4 3 1 2 3
1 2 2 3
2 3 5 7
3 4 7 9
```
### 样例输出 #2
```
34
```
## 提示

对于所有的测试点，保证 $2\le n\le 10^5$，$1\le m\le  10^6$，$0\le 
A\le 10$，$0\le B,C\le 10^7$，$1\le x_i,y_i\le n$，$x_i\neq y_i$，$0\le p_i<q_i\le 4\times 10^4$。


---

---
title: "[NOI Online #2 提高组] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P6478
tag: ['动态规划 DP', '数学', '2020', '树形 DP', '排列组合', 'NOI Online']
---
# [NOI Online #2 提高组] 游戏
## 题目背景

1s 512M
## 题目描述

小 A 和小 B 正在玩一个游戏：有一棵包含 $n=2m$ 个点的有根树（点从 $1\sim n$ 编号），它的根是 $1$ 号点，初始时两人各拥有 $m$ 个点。游戏的每个回合两人都需要选出一个自己拥有且之前未被选过的点，若对手的点在自己的点的子树内，则该回合自己获胜；若自己的点在对方的点的子树内，该回合自己失败；其他情况视为平局。游戏共进行 $m$ 回合。

作为旁观者的你只想知道，在他们随机选点的情况下，第一次非平局回合出现时的回合数的期望值。

为了计算这个期望，你决定对于 $k=0,1,2,\cdots,m$，计算出非平局回合数为 $k$ 的情况数。两种情况不同当且仅当存在一个小 A 拥有的点 $x$，小 B 在 $x$ 被小 A 选择的那个回合所选择的点不同。

由于情况总数可能很大，你只需要输出答案对 $998244353$ 取模后的结果。
## 输入格式

第一行一个正整偶数 $n$ 表示树的结点数。

第二行一个长度为 $n$ 的 01 字符串，第 $i$ 个字符为 $0$ 表示 $i$ 号点被小 A 拥有，否则被小 B 拥有。保证 $0$、$1$ 的个数相同。

接下来 $n-1$ 行每行两个正整数 $u$, $v$，表示树中的一条边。
## 输出格式

共 $\frac{n}{2}+1$ 行每行一个整数，第 $i$ 行的整数表示 $k=i-1$ 时的答案。
## 样例

### 样例输入 #1
```
8
10010011
1 2
1 3
2 4
2 5
5 6
3 7
3 8
```
### 样例输出 #1
```
0
10
10
4
0

```
## 提示

| 测试点编号 | $n =$ | 特殊性质 |
| :-- | :-- | :-- |
| 1 $\sim$ 4 | $20$ | 无 |
| 5 $\sim$ 8 | $50$ | 无 |
| 9 $\sim$ 10 | $300$ | 树退化为一条链 |
| 11 $\sim$ 12 | $300$ | 无 |
| 13 $\sim$ 14 | $500$ | 无 |
| 15 $\sim$ 16 | $5000$ | 树退化为一条链 |
| 17 $\sim$ 20 | $5000$ | 无 |


---

---
title: "[NOI Online #3 提高组] 优秀子序列"
layout: "post"
diff: 省选/NOI-
pid: P6570
tag: ['2020', 'NOI Online']
---
# [NOI Online #3 提高组] 优秀子序列
## 题目描述

给定一个长度为 $n$ 的非负整数序列 $A=\{a_1,a_2,\cdots,a_n\}$，对于 $A$ 的一个子序列 $B=\{a_{b_1},a_{b_2},\cdots,a_{b_m}\}$（$0\le m\le n$，$1\le b_1<b_2<\cdots<b_m\le n$，下同），称 $B$ 是 $A$ 的优秀子序列当且仅当，其任意两个不同元素的按位与结果均为 $0$，即：$\forall 1\le i<j\le m$，满足：$a_{b_i}~\mathrm{and}~a_{b_j}=0$，其中 $~\mathrm{and}~$   是按位与运算。

对于子序列 $B=\{a_{b_1},a_{b_2},\cdots,a_{b_m}\}$，我们定义其价值为 $\varphi(1+\sum_{i=1}^m a_{b_i})$，其中 $\varphi(x)$ 表示小等于 $x$ 的正整数中与 $x$ 互质的数的个数。

现在请你求出 $A$ 的所有优秀子序列的价值之和，答案对 $10^9+7$ 取模。
## 输入格式

第一行一个正整数 $n$ 表示序列长度。

第二行 $n$ 个用空格分隔的非负整数，表示 $a_1,a_2,\cdots,a_n$。
## 输出格式

仅一行一个整数，表示答案对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
4
1 2 2 3
```
### 样例输出 #1
```
12
```
## 提示

#### 样例 1 解释
符合条件的子序列有：$\emptyset$，$\{1\}$，$\{2\}$，$\{2\}$，$\{3\}$，$\{1,2\}$，$\{1,2\}$，它们价值依次为 $1$，$1$，$2$，$2$，$2$，$2$，$2$，总和为 $12$。

#### 数据规模与约定
- 对于 $10\%$ 的数据，保证 $a_i\le 1$。
- 对于 $30\%$ 的数据，保证 $a_i\le 1000$。
- 对于 $60\%$ 的数据，保证 $a_i\le 30000$。
- 另有 $10\%$ 的数据，保证 $n\le 20$。
- 对于 $100\%$ 的数据，保证 $1\le n\le 10^6$，$0\le a_i\le 2\times 10^5$。


---

---
title: "[NOI2020] 美食家"
layout: "post"
diff: 省选/NOI-
pid: P6772
tag: ['2020', 'NOI', 'O2优化']
---
# [NOI2020] 美食家
## 题目描述

坐落在 Bzeroth 大陆上的精灵王国击退地灾军团的入侵后，经过十余年的休养生息，重新成为了一片欣欣向荣的乐土，吸引着八方游客。小 W 是一位游历过世界各地的著名美食家，现在也慕名来到了精灵王国。

精灵王国共有 $n$ 座城市，城市从 $1$ 到 $n$ 编号，其中城市 $i$ 的美食能为小 W 提供 $c_i$ 的愉悦值。精灵王国的城市通过 $m$ 条**单向道路**连接，道路从 $1$ 到 $m$ 编号，其中道路 $i$ 的起点为城市 $u_i$ ，终点为城市 $v_i$，沿它通行需要花费 $w_i$ 天。也就是说，若小 W 在第 $d$ 天从城市 $u_i$ 沿道路 $i$ 通行，那么他会在第 $d + w_i$ 天到达城市 $v_i$。

小 W 计划在精灵王国进行一场为期 $T$ 天的旅行，更具体地：他会在第 $0$ 天从城市 $1$ 出发，经过 $T$ 天的旅行，最终在**恰好第 $T$ 天**回到城市 $1$ 结束旅行。由于小 W 是一位美食家，每当他到达一座城市时（包括第 $0$ 天和第 $T$ 天的城市 $1$），他都会品尝该城市的美食并获得其所提供的愉悦值，若小 W 多次到达同一座城市，他将**获得多次愉悦值**。注意旅行途中小 W **不能在任何城市停留**，即当他到达一座城市且还未结束旅行时，他当天必须立即从该城市出发前往其他城市。

![](https://cdn.luogu.com.cn/upload/image_hosting/2svum9ge.png)

对于上图，小 W 一种为期 $11$ 天的可行旅游方案为 $1 \to 2 \to 1 \to 2 \to 3 \to 1$：
- 第 $0$ 天，小 W 从城市 $1$ 开始旅行，获得愉悦值 $1$ 并向城市 $2$ 出发。
- 第 $1$ 天，小 W 到达城市 $2$，获得愉悦值 $3$ 并向城市 $1$ 出发。
- 第 $4$ 天，小 W 到达城市 $1$，获得愉悦值 $1$ 并向城市 $2$ 出发。
- 第 $5$ 天，小 W 到达城市 $2$，获得愉悦值 $3$ 并向城市 $3$ 出发。
- 第 $7$ 天，小 W 到达城市 $3$，获得愉悦值 $4$ 并向城市 $1$ 出发。
- 第 $11$ 天，小 W 到达城市 $1$，获得愉悦值 $1$ 并结束旅行。
- 小 W 在该旅行中获得的愉悦值之和为 $13$。

此外，精灵王国会在**不同**的时间举办 $k$ 次美食节。具体来说，第 $i$ 次美食节将于第 $t_i$ 天在城市 $x_i$ 举办，若小 W 第 $t_i$ 天时恰好在城市 $x_i$，那么他在品尝城市 $x_i$ 的美食时会**额外得到** $y_i$ 的愉悦值。现在小 W 想请作为精灵王国接待使者的你帮他算出，他在旅行中能获得的愉悦值之和的**最大值**。
## 输入格式

从标准输入中读入数据。

第一行四个整数 $n, m, T, k$，依次表示城市数、道路条数、旅行天数与美食节次数。

第二行 $n$ 个整数 $c_i$，表示每座城市的美食所能提供的愉悦值。接下来 $m$ 行每行三个整数 $u_i, v_i, w_i$，依次表示每条道路的起点、终点与通行天数。

最后 $k$ 行每行三个整数 $t_i, x_i, y_i$，依次表示每次美食节的举办时间、举办城市与提供的额外愉悦值。

本题中数据保证：
- 对所有 $1 \leq i \leq m$，有 $u_i\neq v_i$。但数据中可能存在路线重复的单向道路，即可能存在 $1 \leq i < j \leq m，使得 u_i = u_j, v_i = v_j$。
- 对每座城市都满足：至少存在一条以该该城市为起点的单向道路。
- 每次美食节的举办时间 $t_i$ 互不相同。
## 输出格式

输出到标准输出中。

仅一行一个整数，表示小 W 通过旅行能获得的愉悦值之和的最大值。

**若小 W 无法在第 $T$ 天回到城市 $1$，则输出 $-1$**。
## 样例

### 样例输入 #1
```
3 4 11 0
1 3 4
1 2 1
2 1 3
2 3 2
3 1 4
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
4 8 16 3
3 1 2 4
1 2 1
1 3 1
1 3 2
3 4 3
2 3 2
3 2 1
4 2 1
4 1 5
3 3 5
1 2 5
5 4 20
```
### 样例输出 #2
```
39
```
## 提示

#### 样例 1 解释

该样例为题目描述中的例子，最优旅行方案见题目描述。

#### 样例 2 解释

最优方案为 $1 \to 3 \to 4 \to 2 \to 3 \to 4 \to 1$。
- 第 $0$ 天，小 W 从城市 $1$ 开始旅行，获得愉悦值 $3$ 并沿道路 $3$ 通行。
- 第 $2$ 天，小 W 到达城市 $3$，获得愉悦值 $2$ 并沿道路 $4$ 通行。
- 第 $5$ 天，小 W 到达城市 $4$，由于美食节获得愉悦值 $20 + 4$ 并沿道路 $7$ 通行。
- 第 $6$ 天，小 W 到达城市 $2$，获得愉悦值 $1$ 并沿道路 $5$ 通行。
- 第 $8$ 天，小 W 到达城市 $3$，获得愉悦值 $2$ 并沿道路 $4$ 通行。
- 第 $11$ 天，小 W 到达城市 $4$，获得愉悦值 $4$ 并沿道路 $8$ 通行。
- 第 $16$ 天，小 W 到达城市 $1$，获得愉悦值 $3$ 并结束旅行。
- 小 W 获得的愉悦值之和为 $39$。

#### 样例 3

见选手目录下的 delicacy/delicacy3.in 与 delicacy/delicacy3.ans。

该样例满足 $k=0$

---

### 测试点约束

对于所有测试点：

$1 \leq n \leq 50$，$n \leq m \leq 501$，$0 \leq k \leq 200$，$1 \leq t_i \leq T \leq 10^9$。

$1 \leq w_i \leq 5$，$1 \leq c_i \leq 52501$，$1 \leq u_i, v_i, x_i \leq n$，$1 \leq y_i \leq 10^9$。

每个测试点的具体限制见下表：

| 测试点编号 |  $n$ |  $m$ |  $T$ | 特殊限制 |
| :-: | :-:| :-: |:-:| :-:|
|  $1\sim 4$ |  $\le 5$ |  $\le 50$ |  $\le 5$ | 无 |
|  $5\sim 8$ |  $\le 50$ |  $\le 50$ |  $\le 52501$ | 无 |
|  $9\sim 10$ |  $\le 50$ |  $\le 50$ |  $\le 10^9$ | A | 
|  $11\sim 13$ |  $\le 50$ |  $\le 50$ |  $\le 10^9$ |  $k=0$ |
|  $14\sim 15$ |  $\le 50$ |  $\le 50$ |  $\le 10^9$ |  $k\le 10$ |
|  $16\sim 17$ |  $\le 50$ |  $\le 50$ |  $\le 10^9$ | 无 |
|  $18\sim 20$ |  $\le 50$ |  $\le 501$ |  $\le 10^9$ | 无 |

特殊限制 A：$n = m$ 且 $u_i = i,v_i = (i \bmod n) + 1$。


---

---
title: "[NOIP2020] 移球游戏"
layout: "post"
diff: 省选/NOI-
pid: P7115
tag: ['2020', 'NOIP 提高组', 'Special Judge']
---
# [NOIP2020] 移球游戏
## 题目描述

小 C 正在玩一个移球游戏，他面前有 $n + 1$ 根柱子，柱子从 $1 \sim n + 1$ 编号，其中 $1$ 号柱子、$2$ 号柱子、……、$n$ 号柱子上各有 $m$ 个球，它们自底向上放置在柱子上，$n + 1$ 号柱子上初始时没有球。这 $n \times m$ 个球共有 $n$ 种颜色，每种颜色的球各 $m$ 个。

初始时一根柱子上的球可能是五颜六色的，而小 C 的任务是将所有同种颜色的球移到同一根柱子上，这是唯一的目标，而每种颜色的球最后放置在哪根柱子则没有限制。

小 C 可以通过若干次操作完成这个目标，一次操作能将一个球从一根柱子移到另一根柱子上。更具体地，将 $x$ 号柱子上的球移动到 $y$ 号柱子上的要求为：

1. $x$ 号柱子上至少有一个球；
2. $y$ 号柱子上至多有 $m - 1$ 个球；
3. 只能将 $x$ 号柱子最上方的球移到 $y$ 号柱子的最上方。

小 C 的目标并不难完成，因此他决定给自己加加难度：在完成目标的基础上，使用的操作次数不能超过 $820000$。换句话说，小 C 需要使用至多 $820000$ 次操作完成目标。

小 C 被难住了，但他相信难不倒你，请你给出一个操作方案完成小 C 的目标。合法的方案可能有多种，你只需要给出任意一种，题目保证一定存在一个合法方案。
## 输入格式

第一行两个用空格分隔的整数 $n, m$。分别表示球的颜色数、每种颜色球的个数。  
接下来 $n$ 行每行 $m$ 个用单个空格分隔的整数，第 $i$ 行的整数按自底向上的顺序依次给出了 $i$ 号柱子上的球的颜色。
## 输出格式

本题采用自定义校验器（special judge）评测。  
你的输出的第一行应该仅包含单个整数 $k$，表示你的方案的操作次数。你应保证 $0 \le k \le 820000$。  
接下来 $k$ 行每行你应输出两个用单个空格分隔的正整数 $x, y$，表示这次操作将 $x$ 号柱子最上方的球移动到 $y$ 号柱子最上方。你应保证 $1 \le x, y \le n + 1$ 且 $x \ne y$。
## 样例

### 样例输入 #1
```
2 3
1 1 2
2 1 2

```
### 样例输出 #1
```
6
1 3
2 3
2 3
3 1
3 2
3 2

```
### 样例输入 #2
```
见附件中的 ball/ball2.in
```
### 样例输出 #2
```
见附件中的 ball/ball2.ans
```
### 样例输入 #3
```
见附件中的 ball/ball3.in
```
### 样例输出 #3
```
见附件中的 ball/ball3.ans
```
## 提示

**【样例 #1 解释】**

柱子中的内容为：按自底向上的顺序依次给出柱子上每个球的颜色。

| 操作 | $1$ 号柱子 | $2$ 号柱子 | $3$ 号柱子 |
|:-:|:-:|:-:|:-:|
| 初始 | $1\ 1\ 2$ | $2\ 1\ 2$ | |
| $1\ 3$ | $1\ 1$ | $2\ 1\ 2$ | $2$ |
| $2\ 3$ | $1\ 1$ | $2\ 1$ | $2\ 2$ |
| $2\ 3$ | $1\ 1$ | $2$ | $2\ 2\ 1$ |
| $3\ 1$ | $1\ 1\ 1$ | $2$ | $2\ 2$ |
| $3\ 2$ | $1\ 1\ 1$ | $2\ 2$ | $2$ |
| $3\ 2$ | $1\ 1\ 1$ | $2\ 2\ 2$ | |

**【数据范围】**

| 测试点编号 | $n \le$ | $m \le$ |
|:-:|:-:|:-:|
| $1 \sim 2$ | $2$ | $20$ |
| $3 \sim 5$ | $10$ | $20$ |
| $6 \sim 8$ | $50$ | $85$ |
| $9 \sim 14$ | $50$ | $300$ |
| $15 \sim 20$ | $50$ | $400$ |

对于所有测试点，保证 $2 \le n \le 50$，$2 \le m \le 400$。

**【校验器】**

为了方便选手测试，在附件中的 `ball` 目录下我们下发了 `checker.cpp` 文件，选手可以编译该程序，并使用它校验自己的输出文件。但请注意它与最终评测时所使用的校验器并不完全一致。你也不需要关心其代码的具体内容。

编译命令为：`g++ checker.cpp −o checker -std=c++11`。

`checker` 的使用方式为：`checker <inputfile> <outputfile>`，参数依次表示输入文件与你的输出文件。

若你输出的数字大小范围不合法，则校验器会给出相应提示。若你的输出数字大小范围正确，但方案错误，则校验器会给出简要的错误信息：

1. `A x`，表示进行到第 $x$ 个操作时不合法。
2. `B x`，表示操作执行完毕后第 $x$ 个柱子上的球不合法。

若你的方案正确，校验器会给出 `OK`。


---

---
title: "[NOIP2020] 微信步数"
layout: "post"
diff: 省选/NOI-
pid: P7116
tag: ['2020', 'NOIP 提高组']
---
# [NOIP2020] 微信步数
## 题目描述

小 C 喜欢跑步，并且非常喜欢在微信步数排行榜上刷榜，为此他制定了一个刷微信步数的计划。

他来到了一处空旷的场地，处于该场地中的人可以用 $k$ 维整数坐标 $(a_1, a_2, \ldots , a_k)$ 来表示其位置。场地有大小限制，第 $i$ 维的大小为 $w_i$，因此处于场地中的人其坐标应满足 $1 \le a_i \le w_i$（$1 \le i \le k$）。

小 C 打算在接下来的 $P = w_1 \times w_2 \times \cdots \times w_k$ 天中，每天从场地中一个新的位置出发，开始他的刷步数计划（换句话说，他将会从场地中每个位置都出发一次进行计划）。

他的计划非常简单，每天按照事先规定好的路线行进，每天的路线由 $n$ 步移动构成，每一步可以用 $c_i$ 与 $d_i$ 表示：若他当前位于 $(a_1, a_2, \ldots , a_{c_i}, \ldots, a_k)$，则这一步他将会走到 $(a_1, a_2, \ldots , a_{c_i} + d_i, \ldots , a_k)$，其中 $1 \le c_i \le k$，$d_i \in \{-1, 1\}$。小 C 将会不断重复这个路线，直到他走出了场地的范围才结束一天的计划。（即走完第 $n$ 步后，若小 C 还在场内，他将回到第 $1$ 步从头再走一遍）。

小 C 对自己的速度非常有自信，所以他并不在意具体耗费的时间，他只想知道 $P$ 天之后，他一共刷出了多少步微信步数。请你帮他算一算。
## 输入格式

第一行两个用单个空格分隔的整数 $n, k$。分别表示路线步数与场地维数。  
接下来一行 $k$ 个用单个空格分隔的整数 $w_i$，表示场地大小。  
接下来 $n$ 行每行两个用单个空格分隔的整数 $c_i, d_i$，依次表示每一步的方向，具体意义见题目描述。
## 输出格式

仅一行一个整数表示答案。答案可能很大，你只需要输出其对 ${10}^9 + 7$ 取模后的值。  
若小 C 的计划会使得他在某一天在场地中永远走不出来，则输出一行一个整数 $-1$。
## 样例

### 样例输入 #1
```
3 2
3 3
1 1
2 -1
1 1

```
### 样例输出 #1
```
21

```
### 样例输入 #2
```
5 4
6 8 6 5
3 1
2 1
1 1
2 1
2 -1

```
### 样例输出 #2
```
10265

```
### 样例输入 #3
```
见附件中的 walk/walk3.in
```
### 样例输出 #3
```
见附件中的 walk/walk3.ans
```
### 样例输入 #4
```
见附件中的 walk/walk4.in
```
### 样例输出 #4
```
见附件中的 walk/walk4.ans
```
## 提示

**【样例 #1 解释】**

从 $(1, 1)$ 出发将走 $2$ 步，从 $(1, 2)$ 出发将走 $4$ 步，从 $(1, 3)$ 出发将走 $4$ 步。  
从 $(2, 1)$ 出发将走 $2$ 步，从 $(2, 2)$ 出发将走 $3$ 步，从 $(2, 3)$ 出发将走 $3$ 步。  
从 $(3, 1)$ 出发将走 $1$ 步，从 $(3, 2)$ 出发将走 $1$ 步，从 $(3, 3)$ 出发将走 $1$ 步。  
共计 $21$ 步。

**【数据范围】**

| 测试点编号 | $n \le$ | $k \le$ | $w_i \le$ |
|:-:|:-:|:-:|:-:|
| $1 \sim 3$ | $5$ | $5$ | $3$ |
| $4 \sim 6$ | $100$ | $3$ | $10$ |
| $7 \sim 8$ | ${10}^5$ | $1$ | ${10}^5$ |
| $9 \sim 12$ | ${10}^5$ | $2$ | ${10}^6$ |
| $13 \sim 16$ | $5 \times {10}^5$ | $10$ | ${10}^6$ |
| $17 \sim 20$ | $5 \times {10}^5$ | $3$ | ${10}^9$ |

对于所有测试点，保证 $1 \le n \le 5 \times {10}^5$，$1 \le k \le 10$，$1 \le w_i \le {10}^9$，$d_i \in \{-1, 1\}$。


---

---
title: "[NOI1998] 免费的馅饼"
layout: "post"
diff: 省选/NOI-
pid: P7302
tag: ['动态规划 DP', '1998', '线段树', '树状数组', 'NOI']
---
# [NOI1998] 免费的馅饼
## 题目描述

SERKOI 最新推出了一种叫做“免费馅饼”的游戏：游戏在一个舞台上进行。舞台的宽度为 $w$ 格（从左到右依次用 $1$ 到 $w$ 编号），游戏者占一格。开始时游戏者可以站在舞台的任意位置，手里拿着一个托盘。下图为天幕的高度为 $4$ 格时某一个时刻游戏者接馅饼的情景。

![](https://cdn.luogu.com.cn/upload/image_hosting/1gcg9awi.png)

游戏开始后，从舞台天幕顶端的格子中不断出现馅饼并垂直下落。游戏者左右移动去接馅饼。游戏者每秒可以向左或向右移动一格或两格，也可以站在原地不动。

当馅饼在某一时刻恰好到达游戏者所在的格子中，游戏者就收集到了这块馅饼。当馅饼落在一个游戏者不在的格子里时该馅饼就消失。

写一个程序，帮助我们的游戏者收集馅饼，使得所收集馅饼的分数之和最大。
## 输入格式

第一行是用空格隔开的两个正整数，分别给出了舞台的宽度 $w$ 和馅饼的个数 $n$。

接下来 $n$ 行，每一行给出了一块馅饼的信息。

由三个正整数组成，分别表示了每个馅饼落到舞台上的时刻 $t_i$，掉到舞台上的格子的编号 $p_i$，以及分值 $v_i$。

游戏开始时刻为 $0$。

输入文件中同一行相邻两项之间用一个空格隔开。

输入数据中可能存在两个馅饼的 $t_i$ 和 $p_i$ 都一样。
## 输出格式

一个数，表示游戏者获得的最大总得分。
## 样例

### 样例输入 #1
```
3 4
1 2 3
5 2 3
6 3 4
1 1 5
 
```
### 样例输出 #1
```
12
```
## 提示

对于 $100\%$ 的数据，$1 \leq w \leq 10^8$，$1 \leq n \leq 10^5$，$1\leq t_i \leq 10^8$，$1\leq p_i \leq w$，$1\leq v_i \leq 1000$。


---

---
title: "[NOI2021] 轻重边"
layout: "post"
diff: 省选/NOI-
pid: P7735
tag: ['2021', 'NOI', 'O2优化']
---
# [NOI2021] 轻重边
## 题目描述

小 W 有一棵 $n$ 个结点的树，树上的每一条边可能是轻边或者重边。接下来你需要对树进行 $m$ 次操作，在所有操作开始前，树上所有边都是轻边。操作有以下两种：
1. 给定两个点 $a$ 和 $b$，首先对于 $a$ 到 $b$ 路径上的所有点 $x$（包含 $a$ 和 $b$），你要将与 $x$ 相连的所有边变为轻边。然后再将 $a$ 到 $b$ 路径上包含的所有边变为重边。
2. 给定两个点 $a$ 和 $b$，你需要计算当前 $a$ 到 $b$ 的路径上一共包含多少条重边。

## 输入格式

本题有多组数据，输入数据第一行一个正整数 $T$，表示数据组数。对于每组数据：

第一行包含两个整数 $n$ 和 $m$，其中 $n$ 表示结点数量，$m$ 表示操作数量。

接下来 $n - 1$ 行，每行包含两个整数 $u\ v$，表示树上的一条边。

接下来 $m$ 行，每行包含三个整数 ${\mathit{op}}_i\ a_i\ b_i$，描述一个操作，其中 ${\mathit{op}}_i = 1$ 表示第 $1$ 类操作，${\mathit{op}}_i = 2$ 表示第 $2$ 类操作。

数据保证 $a_i \neq b_i$。
## 输出格式

对于每一次第 $2$ 类操作，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
1
7 7
1 2
1 3
3 4
3 5
3 6
6 7
1 1 7
2 1 4
2 2 7
1 1 5
2 2 7
1 2 1
2 1 7
```
### 样例输出 #1
```
1
3
2
1
```
## 提示

**【样例解释 #1】**

第 $1$ 次操作后，重边有：$(1, 3)$，$(3, 6)$，$(6, 7)$。

第 $2$ 次操作，包含的重边有：$(1, 3)$。

第 $3$ 次操作，包含的重边有：$(1, 3)$，$(3, 6)$，$(6, 7)$。

第 $4$ 次操作，首先 $(1, 3)$，$(3, 6)$ 变为轻边，之后 $(1, 3)$，$(3, 5)$ 变为重边。

第 $5$ 次操作，包含的重边有：$(1, 3)$，$(6, 7)$。

第 $6$ 次操作，首先 $(1, 3)$ 变为轻边，之后 $(1, 2)$ 变为重边。

第 $7$ 次操作，包含的重边有：$(6, 7)$。

**【样例 #2】**

见附件 `edge/edge2.in` 与 `edge/edge2.ans`。

该样例约束与测试点 $3 \sim 6$ 一致。

**【样例 #3】**

见附件 `edge/edge3.in` 与 `edge/edge3.ans`。

该样例约束与测试点 $9 \sim 10$ 一致。

**【样例 #4】**

见附件 `edge/edge4.in` 与 `edge/edge4.ans`。

该样例约束与测试点 $11 \sim 14$ 一致。

**【样例 #5】**

见附件 `edge/edge5.in` 与 `edge/edge5.ans`。

该样例约束与测试点 $17 \sim 20$ 一致。

**【数据范围】**

对于所有测试数据：$T \le 3$，$1 \le n, m \le {10}^5$。

| 测试点编号 | $n, m \le $ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 2$ | $10$ | 无 |
| $3 \sim 6$ | $5000$ | 无 |
| $7 \sim 8$ | ${10}^5$ | A，B |
| $9 \sim 10$ | ${10}^5$ | A |
| $11 \sim 14$ | ${10}^5$ | B |
| $15 \sim 16$ | $2\times {10}^4$ | 无 |
| $17 \sim 20$ | ${10}^5$ | 无 |

特殊性质 A：树的形态是一条链。

特殊性质 B：第 $2$ 类操作给出的 $a_i$ 和 $b_i$ 之间有边直接相连。


---

---
title: "[NOI2021] 路径交点"
layout: "post"
diff: 省选/NOI-
pid: P7736
tag: ['2021', 'NOI', 'O2优化']
---
# [NOI2021] 路径交点
## 题目描述

小 L 有一个有向图，图中的顶点可以分为 $k$ 层，第 $i$ 层有 $n_i$ 个顶点，第 $1$ 层与第 $k$ 层**顶点数相同**，即 $n_1 = n_k$，且对于第 $j$（$2 \leq j \leq k-1$）层，$n_1 \leq n_j \leq 2n_1$。对于第 $j$（$1 \leq j < k$）层的顶点，以它们为起点的边只会连向第 $j + 1$ 层的顶点。没有边连向第 $1$ 层的顶点，第 $k$ 层的顶点不会向其他顶点连边。

现在小 L 要从这个图中选出 $n_1$ 条路径，每条路径以第 $1$ 层顶点为起点，第 $k$ 层顶点为终点，并要求**图中的每个顶点至多出现在一条路径中**。更具体地，把每一层顶点按照 $1,2,\ldots,n_i$ 进行编号，则每条路径可以写为一个 $k$ 元组 $(p_1,p_2,\ldots,p_k)$，表示这条路径依次经过第 $j$ 层的 $p_j$（$1 \leq p_j \leq n_j$）号顶点，并且第 $j$（$1 \leq j < k$）层的 $p_j$ 号顶点有一条边连向第 $j+1$ 层的第 $p_{j+1}$ 号顶点。

小 L 把这些路径画在了纸上，发现它们会产生若干个交点。对于两条路径 $P,Q$，分别设它们在第 $j$ 层与第 $j+1$ 层之间的连边为 $(P_j,P_{j+1})$ 与 $(Q_j,Q_{j+1})$，若，

$$(P_j-Q_j)\times(P_{j+1}-Q_{j+1})<0$$

则称它们在第 $j$ 层后产生了一个交点。两条路径的交点数为它们在第 $1, 2,\ldots,k - 1$ 层后产生的交点总数。对于整个路径方案，它的交点数为**两两不同路径间交点数之和**。例如下图是一个 $3$ 条路径，共 $3$ 个交点的例子，其中红色点是交点。

![](https://cdn.luogu.com.cn/upload/image_hosting/pvr0iwkt.png)

小 L 现在想知道有偶数个交点的路径方案数比有奇数个交点的路径方案数多多少个。两个路径方案被视为相同的，当且仅当它们的 $n_1$ 条路径按第一层起点编号顺序写下的 $k$ 元组能对应相同。由于最后的结果可能很大，请你输出它对 $998244353$（一个大质数）取模后的值。
## 输入格式

本题有多组数据，输入数据第一行一个正整数 $T$ ，表示数据组数。对于每组数据：

第一行一个正整数 $k$，表示一共有 $k$ 层顶点。

第二行包含 $k$ 个整数 $n_1,n_2,\ldots,n_k$，依次表示每一层的顶点数量。保证 $n_1=n_k$，且 $n_1 \leq n_i \leq 2n_1$（$2 \leq i \leq k-1$）。

第三行包含 $k-1$ 个整数 $m_1,m_2,\ldots,m_{k-1}$，依次表示第 $j$ 层顶点到第 $j+1$ 层顶点的边数。保证 $m_j \leq n_j \times n_{j+1}$。

接下来有 $k-1$ 段输入。第 $j$（$1 \leq j < k$）段输入包含 $m_j$ 行，每一行两个整数 $u,v$，表示第 $j$ 层的 $u$ 号顶点有一条边连向第 $j+1$ 层的 $v$ 号顶点。

数据保证图中不会出现重边。
## 输出格式

输出共 $T$ 行，每行一个整数，表示该组数据的答案对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
1
3
2 3 2
4 4
1 1 
1 2
2 1
2 3
1 2
2 1
3 1
3 2
```
### 样例输出 #1
```
1
```
## 提示

**【样例解释 #1】**

偶数个交点的方案有 $2$ 个，奇数个交点的方案有 $1$ 个，所以答案为 $1$。

将下表中路径 $1$ 和路径 $2$ 的方案交换，将会得到相同的方案，例如路径 $1$ 为 $(2, 3, 1)$ 且路径 $2$ 为 $(1, 1, 2)$ 的方案与方案 $1$ 是相同的方案，所以不会被计入答案。

| 路径方案 | 路径 $1$  | 路径 $2$  | 交点总数 |
| :------: | :-------: | :-------: | :------: |
|   $1$    | $(1,1,2)$ | $(2,3,1)$ |   $1$    |
|   $2$    | $(1,2,1)$ | $(2,1,2)$ |   $2$    |
|   $3$    | $(1,2,1)$ | $(2,3,2)$ |   $0$    |

**【样例 #2】**

见附件 `xpath2.in` 与 `xpath2.ans`。

该样例约束与测试点 $7 \sim 8$ 一致。

**【样例 #3】**

见附件 `xpath3.in` 与 `xpath3.ans`。

该样例约束与测试点 $9 \sim 10$ 一致。

**【样例 #4】**

见附件 `xpath4.in` 与 `xpath4.ans`。

该样例约束与测试点 $14 \sim 15$ 一致。

**【数据范围】**

对于所有测试数据：$2 \leq k \leq 100$，$2 \leq n_1 \leq 100$，$1 \leq T \leq 5$。

每个测试点中，保证 $n_1 > 10$ 的数据只有 $1$ 组。

|  测试点编号  | $k=$  | $n_1 \leq$ | 特殊性质 |
| :----------: | :---: | :--------: | :------: |
|  $1 \sim 4$  |  $2$  |    $10$    |    无    |
|  $5 \sim 6$  | $10$  |    $10$    |   A，B    |
|  $7 \sim 8$  | $10$  |    $10$    |    A     |
| $9 \sim 10$  | $10$  |    $10$    |    无    |
| $11 \sim 13$ |  $2$  |   $100$    |    无    |
| $14 \sim 15$ | $100$ |   $100$    |   A，B    |
| $16 \sim 17$ | $100$ |   $100$    |    A     |
| $18 \sim 20$ | $100$ |   $100$    |    无    |

特殊性质 A：对于所有 $i$（$2 \leq i \leq k-1$）满足 $n_i = n_1$。

特殊性质 B：保证路径方案总数至多为 $1$。


---

---
title: "[NOI2021] 庆典"
layout: "post"
diff: 省选/NOI-
pid: P7737
tag: ['2021', 'NOI', 'O2优化']
---
# [NOI2021] 庆典
## 题目描述

C 国是一个繁荣昌盛的国家，它由 $n$ 座城市和 $m$ 条有向道路组成，城市从 $1$ 到 $n$ 编号。如果从 $x$ 号城市出发，经过若干条道路后能到达 $y$ 号城市，那么我们称 $x$ 号城市可到达 $y$ 号城市，记作 $x\Rightarrow y$。C 国的道路有一个特点：对于三座城市 $x$，$y$，$z$，若 $x\Rightarrow z$ 且 $y\Rightarrow z$，那么有 $x\Rightarrow y$ 或 $y\Rightarrow x$。

再过一个月就是 C 国成立的千年纪念日，所以 C 国的人民正在筹备盛大的游行庆典。目前 C 国得知接下来会有 $q$ 次游行计划，第 $i$ 次游行希望从城市 $s_i$ 出发，经过若干个城市后，在城市 $t_i$ 结束，且在游行过程中，**一个城市可以被经过多次**。为了增加游行的乐趣，每次游行还会**临时**修建出 $k$（$0 \le k \le 2$）条有向道路专门供本次游行使用，即其它游行计划不能通过本次游行修建的道路。

现在 C 国想知道，每次游行计划可能会**经过多少座城市**。

注意：临时修建出的道路**可以不满足 C 国道路原有的特点**。
## 输入格式

第一行包含四个整数 $n,m,q,k$，分别表示城市数、道路数、游行计划数以及每次游行临时修建的道路数。

接下来 $m$ 行，每行包含两个整数 $u,v$，表示一条有向道路 $u\rightarrow v$。

接下来 $q$ 行，每行前两个整数 $s_i,t_i$，表示每次游行的起点与终点；这行接下来有 $k$ 对整数 $a,b$，每对整数表示一条临时添加的有向道路 $a\rightarrow b$。

数据保证，将 C 国原有的有向道路视为无向道路后，所有城市可以互达。
## 输出格式

对于每次询问，输出一行一个整数表示答案。如果一次游行从起点出发无法到达终点，输出 $0$ 即可。
## 样例

### 样例输入 #1
```
5 6 4 1
1 2
1 3
1 4
2 5
4 5
5 4
1 4 5 1
2 3 5 3
1 2 5 2
3 4 5 1

```
### 样例输出 #1
```
4
4
4
0

```
## 提示

**【样例解释 #1】**

第 $1$ 次计划，起点为 $1$ 号点，终点为 $4$ 号点，临时修建道路为 $5\rightarrow1$，最终可能经过的城市编号为 $\{1,2,4,5\}$。

第 $2$ 次计划，起点为 $2$ 号点，终点为 $3$ 号点，临时修建道路为 $5\rightarrow3$，最终可能经过的城市编号为 $\{2,3,4,5\}$。

第 $3$ 次计划，起点为 $1$ 号点，终点为 $2$ 号点，临时修建道路为 $5\rightarrow2$，最终可能经过的城市编号为 $\{1,2,4,5\}$。

第 $4$ 次计划，起点为 $3$ 号点，终点为 $4$ 号点，临时修建道路为 $5\rightarrow1$，最终从 $3$ 号点出发无法到达 $4$ 号点。

**【样例 #2】**

见附件 `celebration/celebration2.in` 与 `celebration/celebration2.ans`。

该样例约束与测试点 $5 \sim 7$ 一致。

**【样例 #3】**

见附件 `celebration/celebration3.in` 与 `celebration/celebration3.ans`。

该样例约束与测试点 $10 \sim 11$ 一致。

**【样例 #4】**

见附件 `celebration/celebration4.in` 与 `celebration/celebration4.ans`。

该样例约束与测试点 $15 \sim 16$ 一致。

**【样例 #5】**

见附件 `celebration/celebration5.in` 与 `celebration/celebration5.ans`。

该样例约束与测试点 $20 \sim 25$ 一致。

**【数据范围】**

对于所有测试点，$1 \le n,q \le 3 \times {10}^5$，$n - 1 \le m \le 6 \times {10}^5$，$0 \le k \le 2$。

| 测试点编号 | $n, q \le$ | $k$ | 特殊性质 |
|:-:|:-:|:-:|:-:|
| $1 \sim 4$ | $5$ | $= 0$ | 无 |
| $5 \sim 7$ | $1000$ | $\le 2$ | 无 |
| $8 \sim 9$ | $3 \times {10}^5$ | $= 0$ | $m = n - 1$ |
| $10 \sim 11$ | $3 \times {10}^5$ | $= 1$ | $m = n - 1$ |
| $12 \sim 14$ | $3 \times {10}^5$ | $= 2$ | $m = n - 1$ |
| $15 \sim 16$ | $3 \times {10}^5$ | $= 0$ | 无 |
| $17 \sim 19$ | $3 \times {10}^5$ | $= 1$ | 无 |
| $20 \sim 25$ | $3 \times {10}^5$ | $= 2$ | 无 |


---

---
title: "[NOI2021] 量子通信"
layout: "post"
diff: 省选/NOI-
pid: P7738
tag: ['2021', 'NOI', 'O2优化']
---
# [NOI2021] 量子通信
## 题目背景

由于评测性能差异，本题时限 +0.5s。
## 题目描述

小 Z 正在自学量子计算机相关知识，最近他在研究量子通信章节，并遇到了一个有趣的问题。在该问题中，Alice 和 Bob 正在进行量子通信，它们的通信语言是一个大小为 $n$ 的字典 $S$，在该字典中，每一个单词 $s_i$（$1 \le i \le n$）都可以用一个 $\boldsymbol{256}$ **位的** $\boldsymbol{01}$ **串**来表示。在本题中 $s_i$ 可以通过调用函数 `gen` 来生成，选手可以在题目目录下的 `gen.cpp` 中查看，该函数的参数 `n`、`a1`、`a2` 将由输入数据给出。

Alice 和 Bob 接下来要进行 $m$ 次通信，每次通信由 Alice 向 Bob 传输**恰好一个**字典中的单词。然而，两人使用的通信信道并不可靠，会受到噪音的干扰。更具体地，对于第 $i$ 次传输，记 Alice 传输的原单词为 $x_i$，该 $01$ 串会受噪音干扰而**翻转最多** $\boldsymbol{k_i}$ **位**。换句话说，记 Bob 这次收到的 $01$ 串为 $y_i$，它与 $x_i$ 相比，可能有最多 $k_i$ 位是不同的，并且 $y_i$ 可能不在字典 $S$ 中出现。

与此同时，Bob 得知坏人 Eve 也潜入了两人的通信信道，并准备干扰两人的通信。他的干扰方式是将 Bob 收到的 $01$ 串变为任意的 $256$ 位 $01$ 串，并且这个串可能不在字典 $S$ 中出现。Eve 非常狡猾，他**不一定**会对每次通信都进行干扰。

现在 Bob 找来了你帮忙，对于接下来的每次通信，你需要根据 Bob 最终收到的 $01$ 串以及这次通信的噪音干扰阈值 $k_i$（$0 \le k_i \le 15$），判断这次通信是否有可能没有受到 Eve 的干扰（即 Bob 收到的 $01$ 串可以由字典中的某个单词翻转至多 $k_i$ 位后得到）。本次通信如果有可能没受到 Eve 干扰，请你输出 $1$，否则输出 $0$。Bob 很信任你的能力，所以你需要**在线地回答结果，具体要求见输入格式**。

为了降低读入用时， Bob 收到的串将用**长度为** $\boldsymbol{64}$ **的** $\boldsymbol{16}$ **进制串**给出，$16$ 进制串中包含数字字符 $\texttt{0} \sim \texttt{9}$ 与大写英文字母 $\texttt{A} \sim \texttt{F}$，其中字符 $\texttt{A} \sim \texttt{F}$ 依次表示数值 $10 \sim 15$。

$16$ 进制串可以逐位转化为 $01$ 串，例如：`5` 对应 `0101`，`A` 对应 `1010`，`C` 对应 `1100`。
## 输入格式

输入数据第一行包含四个非负整数 $n, m, a_1, a_2$，分别表示字典大小，通信次数，以及 `gen` 函数中参数 `a1` 和 `a2` 的初始值。

选手需要在自己的程序中调用题目描述中提到的 `gen` 函数生成单词表，选手可以复制并使用 `gen.cpp` 中的代码，程序中的布尔数组 `s[N+1][256]` 即为所有的单词。

接下来 $m$ 行，每行包含一个长度为 $64$ 的 $16$ 进制串和一个非负整数 $k_i$，分别表示第 $i$ 次通信 Bob 最终收到的 $01$ 串和噪音干扰阈值。

为了强制选手**在线地回答询问**，选手根据 $16$ 进制串还原出 $256$ 位 $01$ 串后，将 $01$ 串每一位异或上 ${\mathit{lastans}}$ 才能得到这次通信中 Bob 收到的真实 $01$ 串，其中 ${\mathit{lastans}} \in \{ 0, 1 \}$ 表示上一次询问的答案，第一个询问前 ${\mathit{lastans}}$ 初始值为 0。

注意：使用 `scanf` 和 `printf` 函数读入或输出 `unsigned long long` 类型变量时，对应的占位符为 `llu`。
## 输出格式

输出共 $m$ 行，每行一个整数 $0$ 或 $1$ 表示当前询问的答案。
## 样例

### 样例输入 #1
```
见附件中的 qi/qi1.in
```
### 样例输出 #1
```
见附件中的 qi/qi1.ans
```
### 样例输入 #2
```
见附件中的 qi/qi2.in
```
### 样例输出 #2
```
见附件中的 qi/qi2.ans
```
### 样例输入 #3
```
见附件中的 qi/qi3.in
```
### 样例输出 #3
```
见附件中的 qi/qi3.ans
```
## 提示

**【询问举例】**

为了方便解释题意，我们使用了直接给出字典中单词、缩小单词长度为 $4$、允许离线地回答询问等方式，对简化的情况举例。

考虑字典大小为 $n = 2$，单词有 `1010` 和 `0111`。

对于询问 `B = 1011` 和 $k_1 = 1$，回答应该是 $1$，通过翻转 `1010` 的第 $4$ 位（从高位到低位，下同）得到。

对于询问 `1 = 0001` 和 $k_2 = 2$，回答应该是 $1$，通过翻转 `0111` 的第 $2$、$3$ 位得到。

对于询问 `1 = 0001` 和 $k_3 = 1$，回答应该是 $0$。

- 翻转 `1010` 至多 $1$ 位可得 `1010`、`0010`、`1110`、`1000`、`1011`。
- 翻转 `0111` 至多 $1$ 位可得 `0111`、`1111`、`0011`、`0101`、`0110`。
- 无法得到 `1 = 0001`，它必定是由 Eve 干扰得到的。

**【数据范围】**

对于所有测试点：$1 \le n \le 4 \times {10}^5$，$1 \le m \le 1.2 \times {10}^5$，$0 \le k_i \le 15$，$a_1$ 和 $a_2$ 在 $[0, 2^{64} - 1]$ 之间均匀随机生成。

| 测试点编号 | $n =$ | $m =$ | $k_i \le$ | 特殊性质 |
|:-:|:-:|:-:|:-:|:-:|
| $1$ | $10$ | $10$ | $2$ | 无 |
| $2$ | $500$ | $500$ | $15$ | 无 |
| $3$ | $1000$ | $1000$ | $0$ | 无 |
| $4$ | $2000$ | $2000$ | $2$ | 无 |
| $5$ | $5000$ | $5000$ | $15$ | 无 |
| $6$ | $10^4$ | $10^4$ | $15$ | 无 |
| $7$ | $2\times 10^4$ | $2\times 10^4$ | $15$ | 无 |
| $8$ | $10^5$ | $10^5$ | $1$ | 无 |
| $9$ | $4\times 10^5$ | $1.2\times 10^5$ | $1$ | 无 |
| $10$ | $5\times 10^4$ | $5\times 10^4$ | $2$ | 无 |
| $11$ | $7\times 10^4$ | $7\times 10^4$ | $3$ | 无 |
| $12$ | $10^5$ | $10^5$ | $2$ | 无 |
| $13$ | $3\times 10^4$ | $3\times 10^4$ | $5$ | 无 |
| $14$ | $6\times 10^4$ | $6\times 10^4$ | $4$ | 无 |
| $15$ | $1.2\times 10^5$ | $1.2\times 10^5$ | $5$ | 无 |
| $16$ | $6\times 10^4$ | $6\times 10^4$ | $8$ | 所有询问串随机生成 |
| $17$ | $1.2\times 10^5$ | $1.2\times 10^5$ | $12$ | 所有询问串随机生成 |
| $18$ | $4\times 10^5$ | $10^5$ | $15$ | 所有询问串随机生成 |
| $19$ | $3\times 10^4$ | $3\times 10^4$ | $7$ | 无 |
| $20$ | $6\times 10^4$ | $6\times 10^4$ | $9$ | 无 |
| $21$ | $9\times 10^4$ | $9\times 10^4$ | $11$ | 无 |
| $22$ | $2\times 10^5$ | $1.2\times 10^5$ | $12$ | 无 |
| $23$ | $4\times 10^5$ | $8\times 10^4$ | $15$ | 无 |
| $24$ | $4\times 10^5$ | $10^5$ | $15$ | 无 |
| $25$ | $4\times 10^5$ | $1.2\times 10^5$ | $15$ | 无 |


---

---
title: "[NOIP2021] 方差"
layout: "post"
diff: 省选/NOI-
pid: P7962
tag: ['动态规划 DP', '2021', 'NOIP 提高组', 'O2优化', '模拟退火', '动态规划优化']
---
# [NOIP2021] 方差
## 题目描述

给定长度为 $n$ 的非严格递增正整数数列 $1 \le a_1 \le a_2 \le \cdots \le a_n$。每次可以进行的操作是：任意选择一个正整数 $1 < i < n$，将 $a_i$ 变为 $a_{i - 1} + a_{i + 1} - a_i$。求在若干次操作之后，该数列的方差最小值是多少。请输出最小值乘以 $n^2$ 的结果。

其中方差的定义为：数列中每个数与平均值的差的平方的平均值。更形式化地说，方差的定义为 $D = \frac{1}{n} \sum_{i = 1}^{n} {(a_i - \bar a)}^2$，其中 $\bar a = \frac{1}{n} \sum_{i = 1}^{n} a_i$。
## 输入格式

输入的第一行包含一个正整数 $n$，保证 $n \le {10}^4$。

输入的第二行有 $n$ 个正整数，其中第 $i$ 个数字表示 $a_i$ 的值。数据保证 $1 \le a_1 \le a_2 \le \cdots \le a_n$。
## 输出格式

输出仅一行，包含一个非负整数，表示你所求的方差的最小值的 $n^2$ 倍。
## 样例

### 样例输入 #1
```
4
1 2 4 6

```
### 样例输出 #1
```
52

```
### 样例输入 #2
```
见附件中的 variance/variance2.in
```
### 样例输出 #2
```
见附件中的 variance/variance2.ans
```
### 样例输入 #3
```
见附件中的 variance/variance3.in
```
### 样例输出 #3
```
见附件中的 variance/variance3.ans
```
### 样例输入 #4
```
见附件中的 variance/variance4.in
```
### 样例输出 #4
```
见附件中的 variance/variance4.ans
```
## 提示

**【样例解释 #1】**

对于 $(a_1, a_2, a_3, a_4) = (1, 2, 4, 6)$，第一次操作得到的数列有 $(1, 3, 4, 6)$，第二次操作得到的新的数列有 $(1, 3, 5, 6)$。之后无法得到新的数列。

对于 $(a_1, a_2, a_3, a_4) = (1, 2, 4, 6)$，平均值为 $\frac{13}{4}$，方差为 $\frac{1}{4}({(1 - \frac{13}{4})}^2 + {(2 - \frac{13}{4})}^2 + {(4 - \frac{13}{4})}^2 + {(6 - \frac{13}{4})}^2) = \frac{59}{16}$。

对于 $(a_1, a_2, a_3, a_4) = (1, 3, 4, 6)$，平均值为 $\frac{7}{2}$，方差为 $\frac{1}{4} ({(1 - \frac{7}{2})}^2 + {(3 - \frac{7}{2})}^2 + {(4 - \frac{7}{2})}^2 + {(6 - \frac{7}{2})}^2) = \frac{13}{4}$。

对于 $(a_1, a_2, a_3, a_4) = (1, 3, 5, 6)$，平均值为 $\frac{15}{4}$，方差为 $\frac{1}{4} ({(1 - \frac{15}{4})}^2 + {(3 - \frac{15}{4})}^2 + {(5 - \frac{15}{4})}^2 + {(6 - \frac{15}{4})}^2) = \frac{59}{16}$。

**【数据范围】**

| 测试点编号 | $n \le$ | $a_i \le$ |
|:-:|:-:|:-:|
| $1 \sim 3$ | $4$ | $10$ |
| $4 \sim 5$ | $10$ | $40$ |
| $6 \sim 8$ | $15$ | $20$ |
| $9 \sim 12$ | $20$ | $300$ |
| $13 \sim 15$ | $50$ | $70$ |
| $16 \sim 18$ | $100$ | $40$ |
| $19 \sim 22$ | $400$ | $600$ |
| $23 \sim 25$ | ${10}^4$ | $50$ |

对于所有的数据，保证 $1 \le n \le {10}^4$，$1 \le a_i \le 600$。


---

---
title: "[NOI Online 2022 提高组] 如何正确地排序"
layout: "post"
diff: 省选/NOI-
pid: P8253
tag: ['2022', 'O2优化', 'NOI Online']
---
# [NOI Online 2022 提高组] 如何正确地排序
## 题目背景

**经过管理员的考虑，我们打算将民间数据单独存放在最后一个 Subtask 中。这些测试点分数均为 0 分，但是没有通过其中的任何测试点将会视为此题不通过。**

**这一题中出现了评测记录测试点编号错乱的问题，是民间数据命名方式冲突导致的。但是我们保证其相对顺序没有混乱。**

民间数据提供者：@QwQcOrZ。
## 题目描述

有一个 $m\times n$ 的数组 $a_{i,j}$。  
定义：

$$f(i,j)=\min\limits_{k=1}^m(a_{k,i}+a_{k,j})+\max\limits_{k=1}^m(a_{k,i}+a_{k,j})$$

你需要求出 $\sum\limits_{i=1}^n\sum\limits_{j=1}^nf(i,j)$。
## 输入格式

第一行两个正整数 $m,n$。

接下来 $m$ 行，每行 $n$ 个正整数表示 $a_{i,j}$。
## 输出格式

一行一个正整数，表示答案。
## 样例

### 样例输入 #1
```
3 5
1 7 2 2 7
9 10 4 10 3
7 7 8 10 2
```
### 样例输出 #1
```
564
```
## 提示

**【样例 1 解释】**

以 $f(3,5)$ 为例：

$$\begin{aligned}f(3,5)&=\max(a_{1,3}+a_{1,5},a_{2,3}+a_{2,5},a_{3,3}+a_{3,5})+\min(a_{1,3}+a_{1,5},a_{2,3}+a_{2,5},a_{3,3}+a_{3,5})\\&=\max(9,7,10)+\min(9,7,10)\\&=10+7\\&=17\end{aligned}$$

下面给出 $f(i,j)$ 的数表，第 $i$ 行第 $j$ 列表示 $f(i,j)$：

$$\begin{array}{|c|c|c|c|c|}\hline20&27&18&22&20\\\hline27&34&24&29&23\\\hline18&24&20&22&17\\\hline22&29&22&24&22\\\hline20&23&17&22&18\\\hline\end{array}$$

它们的和是答案 $564$。

**【样例 2, 3, 4】**

见选手目录下的 `sort/sort*.in` 与 `sort/sort*.ans`。

**【数据范围与提示】**

对于所有测试点：$2\le m\le 4$，$1\le n\le 2\times {10}^5$，$1\le a_{i,j}\le 2\times 10^5$。

每个测试点的具体限制见下表

![](https://cdn.luogu.com.cn/upload/image_hosting/h38vdmnj.png)


---

---
title: "[NOI2022] 众数"
layout: "post"
diff: 省选/NOI-
pid: P8496
tag: ['2022', 'NOI', 'O2优化']
---
# [NOI2022] 众数
## 题目描述

**对于一个序列，定义其众数为序列中出现次数严格大于一半的数字。注意该定义与一般的定义有出入，在本题中请以题面中给出的定义为准。**

一开始给定 $n$ 个长度不一的正整数序列，编号为 $1 \sim n$，初始序列可以为空。这 $n$ 个序列被视为存在，其他编号对应的序列视为不存在。

有 $q$ 次操作，操作有以下类型:

- $1 \ x \ y$：在 $x$ 号序列末尾插入数字 $y$。保证 $x$ 号序列存在，且 $1 \le x, y \le n + q$。
- $2 \ x$：删除 $x$ 号序列末尾的数字，保证 $x$ 号序列存在、非空，且 $1 \le x \le n + q$。
- $3 \ m \ x_1 \ x_2 \ x_m$：将 $x_1, x_2, \ldots, x_m$ 号序列顺次拼接，得到一个新序列，并询问其众数。如果不存在满足上述条件的数，则返回 $-1$。数据保证对于任意 $1 \le i \le m$，$x_i$ 是一个仍然存在的序列，$1 \le x_i \le n + q$，且拼接得到的序列非空。**注意：不保证 $\boldsymbol{x_1, \ldots, x_m}$ 互不相同，询问中的合并操作不会对后续操作产生影响。**
- $4 \ x_1 \ x_2 \ x_3$：新建一个编号为 $x_3$ 的序列，其为 $x_1$ 号序列后顺次添加 $x_2$ 号序列中数字得到的结果，然后删除 $x_1, x_2$ 对应的序列。此时序列 $x_3$ 视为存在，而序列 $x_1, x_2$ 被视为不存在，在后续操作中也不会被再次使用。保证 $1 \le x_1, x_2, x_3 \le n + q$、$x_1 \ne x_2$、序列 $x_1, x_2$ 在操作前存在、且在操作前没有序列使用过编号 $x_3$。
## 输入格式

输入的第一行包含两个正整数 $n$ 和 $q$，分别表示数列的个数和操作的次数，保证 $n \le 5 \times {10}^5$、$q \le 5 \times {10}^5$。

接下来 $n$ 行，第 $i$ 行表示编号为 $i$ 的数列。每一行的第一个非负整数 $l_i$ 表示初始第 $i$ 号序列的数字个数，接下来有 $l_i$ 个非负整数 $a_{i,j}$ 按顺序表示数列中的数字。假定 $C_l = \sum l_i$ 代表输入序列长度之和，则保证 $C_l \le 5 \times {10}^5$、$a_{i,j} \le n + q$。

接下来 $q$ 行，每行若干个正整数，表示一个操作，并按照题面描述中的格式输入。

假定 $C_m = \sum m$ 代表所有操作 $3$ 需要拼接的序列个数之和，则保证 $C_m \le 5 \times {10}^5$。
## 输出格式

对于每次询问，一行输出一个整数表示对应的答案。
## 样例

### 样例输入 #1
```
2 8
3 1 1 2
3 3 3 3
3 1 1
3 1 2
4 2 1 3
3 1 3
2 3
3 1 3
1 3 1
3 1 3

```
### 样例输出 #1
```
1
3
-1
3
-1

```
### 样例输入 #2
```
4 9
1 1
1 2
1 3
1 4
3 4 1 2 3 4
1 1 2
3 2 1 2
2 3
3 3 1 2 3
1 4 4
1 4 4
1 4 4
3 4 1 2 3 4

```
### 样例输出 #2
```
-1
2
2
4

```
## 提示

**【样例解释 \#1】**

第一次询问查询序列 $1$ 的众数。由于序列包含两个 $1$，超过序列长度的一半，因此众数为 $1$。

第二次询问查询序列 $2$ 的众数。由于序列只包含 $3$，因此众数为 $3$。

第三次询问询问序列 $3$ 的众数。此时序列 $3$ 为 $(3, 3, 3, 1, 1, 2)$，不存在出现次数大于 $3$ 次的数，因此输出为 $-1$。

----

**【样例解释 \#2】**

第一次询问查询序列 $1, 2, 3, 4$ 拼接后得到的序列的众数。拼接的结果为 $(1, 2, 3, 4)$，不存在出现次数大于两次的数，因此输出为 $-1$。

第四次询问查询序列 $1, 2, 3, 4$ 拼接后得到的序列的众数。拼接的结果为 $(1, 2, 2, 4, 4, 4, 4)$，众数为 $4$。

----

**【样例 \#3】**

见附件中的 `major/major3.in` 与 `major/major3.ans`。

该样例满足测试点 $1 \sim 3$ 的限制。

----

**【样例 \#4】**

见附件中的 `major/major4.in` 与 `major/major4.ans`。

该样例满足测试点 $11 \sim 12$ 的限制。

----

**【数据范围】**

对于所有测试数据，保证 $1 \le n, q, C_m, C_l \le 5 \times {10}^5$。

| $n, q$ | $C_m, C_l$ | 测试点编号 | 特殊性质 A | 特殊性质 B | 特殊性质 C |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $\le 300$ | $\le 300$ | $1 \sim 3$ | 否 | 否 | 是 |
| $\le 4000$ | $\le 4000$ | $4 \sim 7$ | 否 | 否 | 是 |
| $\le {10}^5$ | $\le {10}^5$ | $8$ | 是 | 是 | 是 |
| $\le {10}^5$ | $\le {10}^5$ | $9$ | 是 | 否 | 否 |
| $\le {10}^5$ | $\le {10}^5$ | $10$ | 否 | 是 | 否 |
| $\le {10}^5$ | $\le {10}^5$ | $11 \sim 12$ | 否 | 否 | 是 |
| $\le {10}^5$ | $\le {10}^5$ | $13$ | 否 | 否 | 否 |
| $\le 5 \times {10}^5$ | $\le 5 \times {10}^5$ | $14$ | 是 | 是 | 是 |
| $\le 5 \times {10}^5$ | $\le 5 \times {10}^5$ | $15$ | 是 | 否 | 否 |
| $\le 5 \times {10}^5$ | $\le 5 \times {10}^5$ | $16$ | 否 | 是 | 否 |
| $\le 5 \times {10}^5$ | $\le 5 \times {10}^5$ | $17 \sim 18$ | 否 | 否 | 是 |
| $\le 5 \times {10}^5$ | $\le 5 \times {10}^5$ | $19 \sim 20$ | 否 | 否 | 否 |

特殊性质 A：保证 $n = 1$ 且没有操作 $4$。  
特殊性质 B：保证任意时刻任何序列中只有数字 $1$ 和 $2$。  
特殊性质 C：保证没有操作 $2$。


---

---
title: "[NOI2022] 挑战 NPC Ⅱ"
layout: "post"
diff: 省选/NOI-
pid: P8499
tag: ['2022', 'NOI', 'O2优化']
---
# [NOI2022] 挑战 NPC Ⅱ
## 题目描述

诸由杨是一名咸鱼大学生，虽然他每天仍然幻想着在多项式时间内解决 NPC 问题。

诸由杨上课的时候了解到子图同构问题是一个 NPC 问题。他打算给出一个子图同构问题的多项式判定算法，间接地去证明 P = NP，这样他一定可以凭借这个伟大的工作荣获图灵奖！只可惜诸由杨才疏学浅，连子图同构问题属于 NPC 的证明都没有想出来。因而他退而求其次，准备判定一个更加简单的问题：

给定两棵有根树 $G, H$。设 $\lvert G \rvert$ 代表树 $G$ 中的节点个数，则这两棵树满足如下限制：$1 \leq \lvert H \rvert \leq \lvert G \rvert \leq \lvert H \rvert + k$。这里诸由杨保证 $k$ 是一个小常数。

诸由杨可以删除 $G$ 中的若干个节点，假定删除节点后后得到的子图为 $G'$。他想要知道是否存在一种删除节点的方式，使得删除后得到的子图 $G'$ 满足如下条件：

- $G'$ 连通。
- $G'$ 包含 $G$ 中的根节点（也就是说 $G$ 根节点在删除过程中没有被删除）。
- $G'$ 和 $H$ 同构（也就是说存在一种让 $G'$ 中点重标号的方式，使得重标号得到的图和 $H$ 完全相同，且 $G$ 中的根节点经过重标号后恰好为 $H$ 的根节点）。
## 输入格式

本题有多组测试数据。

输入的第一行依次包含两个正整数 $C,T$ 和一个非负整数 $k$，三个数字分别表示当前测试点编号，测试数据组数和题目中给定的常数。如果当前测试数据为样例则 $C = 0$。保证 $T \leq 500$、$k \leq 5$。

对于每一组测试数据：

输入的第一行包含一个正整数 $n_1$，表示树 $G$ 中的节点个数，保证 $1 \leq n_1 \leq {10}^5$，且 $\sum n_1 \leq 5 \times {10}^5$。

输入的第二行包含 $n_1$ 个整数，描述了树 $G$ 的结构。具体地，第 $i$（$1 \leq i \leq n_1$）个整数 $a_i$ 表示在树 $G$ 中节点 $i$ 的父节点，如果其为根节点则 $a_i = -1$。保证按照上述规则得到的树为连通有根树。

输入的第三行包含一个正整数 $n_2$，表示 $H$ 中的节点个数，保证对于所有测试数据，满足 $\max(1, n_1 - k) \leq n_2 \leq n_1$。

输入的第四行包含 $n_2$ 个整数，描述了树 $H$ 的结构。具体地，第 $i$（$1 \leq i \leq n_2$）个整数 $b_i$ 表示在树 $H$ 中节点 $i$ 的父节点，如果其为根节点则 $b_i = -1$。保证按照上述规则得到的树为连通有根树。
## 输出格式

对于每一组测试数据：

输出一行一个字符串。如果存在删除 $G$ 中节点的方式，使得其能够同时满足上述三个条件，则输出 `Yes`；否则输出 `No`。
## 样例

### 样例输入 #1
```
0 3 1
3
2 -1 2
2
-1 1
4
3 3 -1 3
3
2 3 -1
5
-1 1 5 5 1
5
2 3 -1 3 2

```
### 样例输出 #1
```
Yes
No
Yes

```
## 提示

**【样例解释 \#1】**

对于第一个测试点，我们删除第一棵树的 $1$ 号节点。此时剩余的树和输入第二棵树均为包含两个节点的有根树，因而输出为 `Yes`。

![](https://cdn.luogu.com.cn/upload/image_hosting/vyoktd4u.png)


对于第二个测试点，输入第一颗树深度为 $1$，但是输入第二颗树深度为 $2$。因而不论如何删除第一颗树的节点不会导致其树高增加到 $2$，因而输出为 `No`。

![](https://cdn.luogu.com.cn/upload/image_hosting/r1szu0zb.png)

对于第三个测试点，其输入两颗树均同构于下图的树，因而因而输出为 `Yes`。

![](https://cdn.luogu.com.cn/upload/image_hosting/kxyllt4y.png)

----

**【样例 \#2】**

见附件中的 `iso/iso2.in` 与 `iso/iso2.ans`。

该样例数据范围满足测试点 $7 \sim 8$。

----

**【样例 \#3】**

见附件中的 `iso/iso3.in` 与 `iso/iso3.ans`。

该样例数据范围满足测试点 $9 \sim 10$。

----

**【样例 \#4】**

见附件中的 `iso/iso4.in` 与 `iso/iso4.ans`。

该样例数据范围满足测试点 $13$。

----

**【数据范围】**

对于所有测试数据，满足 $1 \leq T \leq 500$，$1 \le n_2 \leq n_1 \le {10}^5$，$\sum n_1 \leq 5 \times {10}^5$，$0 \leq k \leq 5$。各测试点的附加限制如下表所示：

| $n_1,n_2$   | $\sum n_1$           | 测试点           | $k$      | 特殊性质         |
|:-----------:|:--------------------:|:-------------:|:--------:|:------------:|
| $\leq 8$    | $\leq 500$           | $1 \sim 3$       | $\leq 0$ | 无            |
| $\leq 8$    | $\leq 500$           | $4 \sim 6$       | $\leq 5$ | 无            |
| $\leq 16$   | $\leq 10^3$          | $7 \sim 8$         | $\leq 0$ | 无            |
| $\leq 16$   | $\leq 10^3$          | $9 \sim 10$        | $\leq 5$ | 无            |
| $\leq 150$  | $\leq 10^4$          | $11$          | $\leq 0$ | 无            |
| $\leq 150$  | $\leq 10^4$          | $12$          | $\leq 1$ | 无            |
| $\leq 150$  | $\leq 10^4$          | $13$          | $\leq 5$ | 无            |
| $\leq 10^5$ | $\leq 5 \times 10^5$ | $14 \sim 16$    | $\leq 0$ | A |
| $\leq 10^5$ | $\leq 5 \times 10^5$ | $17 \sim 20$ | $\leq 0$ | B  |
| $\leq 10^5$ | $\leq 5 \times 10^5$ | $21$          | $\leq 1$ | 无            |
| $\leq 10^5$ | $\leq 5 \times 10^5$ | $22 \sim 23$       | $\leq 3$ | 无            |
| $\leq 10^5$ | $\leq 5 \times 10^5$ | $24 \sim 25$       | $\leq 5$ | 无            |

其中附加限制中的特殊性质如下所示：

- 特殊性质 A：保证有根树 $G$ 每个节点要么是叶节点，要么有恰好 $1$ 个儿子结点；另一种等价的表述是有根树 $G$ 构成了一条链，且根节点为链的一个端点。
- 特殊性质 B：保证有根树 $G$ 每个节点要么是叶节点，要么有恰好 $2$ 个儿子结点，同时保证 $G$ 的每一个叶节点深度均相同；另一种等价的表述是有根树 $G$ 构成一棵完全二叉树，且根节点为完全二叉树的根节点。

**【提示】**

数据没有**针对任何合理的哈希算法做任何针对性的构造**，所以在合理范围内不需要过度担心因为哈希碰撞而产生的失分问题。


---

---
title: "[NOIP2022] 喵了个喵"
layout: "post"
diff: 省选/NOI-
pid: P8866
tag: ['贪心', '2022', 'NOIP 提高组', 'Special Judge', 'O2优化', '构造', 'Ad-hoc']
---
# [NOIP2022] 喵了个喵
## 题目描述

小 E 喜欢上了一款叫做《喵了个喵》的游戏。这个游戏有一个牌堆和 $n$ 个可以从栈底删除元素的栈，任务是要通过游戏规则将所有的卡牌消去。开始时牌堆中有 $m$ 张卡牌，从上到下的图案分别是 $a_1, a_2,\dots, a_m$。所有的卡牌一共有 $k$ 种图案，从 $1$ 到 $k$ 编号。牌堆中每一种图案的卡牌都有偶数张。开始时所有的栈都是空的。这个游戏有两种操作：

- 选择一个栈，将牌堆顶上的卡牌放入栈的顶部。如果这么操作后，这个栈最上方的两张牌有相同的图案，则会自动将这两张牌消去。
- 选择两个不同的栈，如果这两个栈栈**底**的卡牌有相同的图案，则可以将这两张牌消去，原来在栈底上方的卡牌会成为新的栈底。如果不同，则什么也不会做。

这个游戏一共有 $T$ 关，小 E 一直无法通关。请你帮小 E 设计一下游戏方案，即对于游戏的每一关，给出相应的操作序列使得小 E 可以把所有的卡牌消去。

## 输入格式

第一行包含一个正整数 $T$，表示数据组数。

接下来一共 $T$ 组数据，在每组数据中：

第一行包含三个正整数 $n, m, k$，分别表示栈的个数、卡牌的个数、卡牌上图案的种类。

第二行包含 $m$ 个正整数，分别表示 $a_1, a_2,\dots, a_m$，分别从上到下表示牌堆中卡牌的图案。

输入数据保证有解。
## 输出格式

对于每一组数据，输出若干行。

其中第一行包含一个正整数 $\mathrm{op}$，表示操作的次数。你需要保证 $m \leq \mathrm{op} \leq 2\times m$。

接下来 $\mathrm{op}$ 行，每行包含两个或三个正整数，整数之间用一个空格隔开。

若为两个整数 $\texttt{1 s}$，则进行一次第一个操作并选择栈 $s$。

若为三个整数 $\texttt{2 s1 s2}$，则进行一次第二个操作并选择栈 $s_1$ 和 $s_2$。

你需要保证 $1 \leq s, s_1, s_2 \leq n$，且 $s_1 \neq s_2$。
## 样例

### 样例输入 #1
```
1
2 4 2
1 2 1 2
```
### 样例输出 #1
```
5
1 1
1 1
1 2
2 1 2
1 1
```
## 提示

**【样例 1 解释】**

下图是初始状态。

![](https://cdn.luogu.com.cn/upload/image_hosting/iidvwekz.png)

下图是前两次操作之后的结果。

![](https://cdn.luogu.com.cn/upload/image_hosting/hrcdl51d.png)

下图是第三次和第四次操作之后的结果。

![](https://cdn.luogu.com.cn/upload/image_hosting/ju6b9dep.png)

下图是第五次操作之后的结果。

![](https://cdn.luogu.com.cn/upload/image_hosting/djpqtzfr.png)

**【样例 2】**

见选手目录下的 $\texttt{meow/meow2.in}$ 与 $\texttt{meow/meow2.ans}$。

**【数据范围】**

设 $S$ 为所有 $T$ 组数据中 $m$ 的总和。

对于所有数据，保证 $S \leq 2 \times 10^6$，$1 \leq n  \leq 300$，$1 \leq a_i \leq k$。

| 测试点 | $T=$ | $n$ | $k=$ | $m \leq$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim 3$ | $1001$ | $\leq 300$ | $2n-2$ | 无限制 |
| $4\sim 6$ | $1002$ | $=2$ | $2n-1$ | 无限制 |
| $7\sim 10$ | $3$ | $=3$ | $2n-1$ | $14$ |
| $11\sim 14$ | $1004$ | $=3$ | $2n-1$ | 无限制 |
| $15\sim 20$ | $1005$ | $\leq 300$ | $2n-1$ | 无限制 |


**【评分方式】**

对于每一组数据，若在按顺序进行所有操作后，牌堆为空且所有的栈均为空，则认为你的答案正确。

**【提示】**

你可以通过 $T$ 的个位数来判断这个测试点是属于哪一类数据。

你的输出不需要与样例输出一致，输出任意一个合法解即可得分。


---

---
title: "[NOIP2022] 建造军营"
layout: "post"
diff: 省选/NOI-
pid: P8867
tag: ['2022', 'NOIP 提高组', 'O2优化', '树形 DP', '强连通分量', 'Tarjan', '容斥原理']
---
# [NOIP2022] 建造军营
## 题目描述

A 国与 B 国正在激烈交战中，A 国打算在自己的国土上建造一些军营。

A 国的国土由 $n$ 座城市组成，$m$ 条双向道路连接这些城市，使得**任意两座城市均可通过道路直接或间接到达**。A 国打算选择一座或多座城市（**至少一座**），并在这些城市上各建造一座军营。

众所周知，军营之间的联络是十分重要的。然而此时 A 国接到情报，B 国将会于不久后袭击 A 国的一条道路，但具体的袭击目标却无从得知。如果 B 国袭击成功，这条道路将被切断，可能会造成 A 国某两个军营无法互相到达，这是 A 国极力避免的。因此 A 国决定派兵看守若干条道路（**可以是一条或多条，也可以一条也不看守**)，A 国有信心保证被派兵看守的道路能够抵御 B 国的袭击而不被切断。

A 国希望制定一个建造军营和看守道路的方案，使得 B 国袭击的无论是 A 国的哪条道路，都不会造成某两座军营无法互相到达。现在，请你帮 A 国计算一下可能的建造军营和看守道路的方案数共有多少。由于方案数可能会很多，你只需要输出其对 $1,000,000,007\left(10^{9}+7\right)$ 取模的值即可。两个方案被认为是不同的，当且仅当存在至少一 座城市在一个方案中建造了军营而在另一个方案中没有，或者存在至少一条道路在一个 方案中被派兵看守而在另一个方案中没有。

## 输入格式

第一行包含两个正整数 $n,m$，分别表示城市的个数和双向道路的数量。

接下来 $m$ 行，每行包含两个正整数 $u_{i},v_{i}$，描述一条连接 $u_{i}$ 和 $v_{i}$ 的双向道路。保证没有重边和自环。
## 输出格式

输出一行包含一个整数，表示建造军营和看守道路的方案数对 $1,000,000,007\left(10^{9}+ 7\right)$ 取模的结果。
## 样例

### 样例输入 #1
```
2 1
1 2
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4 4
1 2
2 3
3 1
1 4
```
### 样例输出 #2
```
184
```
### 样例输入 #3
```
见附加文件里的 barrack/barrack3.in
```
### 样例输出 #3
```
见附加文件里的 barrack/barrack3.ans
```
### 样例输入 #4
```
见附加文件里的 barrack/barrack4.in
```
### 样例输出 #4
```
见附加文件里的 barrack/barrack4.ans
```
## 提示

### 样例 1 解释

A 国有两座城市，一条道路连接他们。所有可能的方案如下：

- 在城市 $1$ 建军营, 不看守这条道路;
- 在城市 $1$ 建军营, 看守这条道路;
- 在城市 $2$ 建军营, 不看守这条道路;
- 在城市 $2$ 建军营, 看守这条道路;
- 在城市 $1,2$ 建军营, 看守这条道路。

### 数据规模与约定

对所有数据，保证 $1 \leq n \leq 5 \times 10^5$，$n - 1 \leq m \leq 10^6$，$1 \leq u_i, v_i \leq n$，$u_i \neq v_i$。

各测试点的信息如下

|测试点编号 | $n \leq $ | $m \leq $| 特殊条件 |
| :-: | :-: | :-: | :-: |
| $1 \sim 3$ | $8$ | $10$ | 无 |
| $4 \sim 7$ | $16$ | $25$ | 无 |
| $8 \sim 9$ | $3000$ | $5000$ | 无 |
| $10 \sim 11$ | $5 \times 10^5$ | $10^6$ | 特殊性质 $\mathrm{A}$ |
| $12 \sim 14$ | $5 \times 10^5$ | $10^6$ | $m = n - 1$ |
| $15 \sim 16$ |  $5 \times 10^5$ | $10^6$ | $m = n$ |
| $17 \sim 20$ | $5 \times 10^5$ | $10^6$ | 无 |

特殊性质 $\mathrm{A}$：保证 $m=n-1$ 且第 $i$ 条道路连接城市 $i$ 与 $i+1$。 


---

---
title: "[NOIP2022] 比赛"
layout: "post"
diff: 省选/NOI-
pid: P8868
tag: ['线段树', '2022', 'NOIP 提高组', 'O2优化']
---
# [NOIP2022] 比赛
## 题目描述

小 N 和小 O 会在 2022 年 11 月参加一场盛大的程序设计大赛 NOIP！小 P 会作为裁判主持竞赛。小 N 和小 O 各自率领了一支 $n$ 个人的队伍，选手在每支队伍内都是从 $1$ 到 $n$ 编号。每一个选手都有相应的程序设计水平。具体的，小 N 率领的队伍中，编号为 $i$（$1 \leq i \leq n$）的选手的程序设计水平为 $a _ i$；小 O 率领的队伍中，编号为 $i$（$1 \leq i \leq n$）的选手的程序设计水平为 $b _ i$。特别地，$\{a _ i\}$ 和 $\{b _ i\}$ 还分别构成了从 $1$ 到 $n$ 的排列。

每场比赛前，考虑到路途距离，选手连续参加比赛等因素，小 P 会选择两个参数 $l, r$（$1 \leq l \leq r \leq n$），表示这一场比赛会邀请两队中编号属于 $[l, r]$ 的所有选手来到现场准备比赛。在比赛现场，小 N 和小 O 会以掷骰子的方式挑选出参数 $p, q$（$l \leq p \leq q \leq r$），只有编号属于 $[p, q]$ 的选手才能参赛。为了给观众以最精彩的比赛，两队都会派出编号在 $[p, q]$ 内的、程序设计水平值最大的选手参加比赛。假定小 N 派出的选手水平为 $m _ a$，小 O 派出的选手水平为 $m _ b$，则比赛的精彩程度为 $m _ a \times m _ b$。

NOIP 总共有 $Q$ 场比赛，每场比赛的参数 $l, r$ 都已经确定，但是 $p, q$ 还没有抽取。小 P 想知道，对于每一场比赛，在其所有可能的 $p, q$（$l \leq p \leq q \leq r$）参数下的比赛的精彩程度之和。由于答案可能非常之大，你只需要对每一场答案输出结果对 $2 ^ {64}$ 取模的结果即可。
## 输入格式

第一行包含两个正整数 $T, n$，分别表示测试点编号和参赛人数。如果数据为样例则保证 $T = 0$。

第二行包含 $n$ 个正整数，第 $i$ 个正整数为 $a _ i$，表示小 N 队伍中编号为 $i$ 的选手的程序设计水平。

第三行包含 $n$ 个正整数，第 $i$ 个正整数为 $b _ i$，表示小 O 队伍中编号为 $i$ 的选手的程序设计水平。

第四行包含一个正整数 $Q$，表示比赛场数。

接下来的 $Q$ 行，第 $i$ 行包含两个正整数 $l _ i, r _ i$，表示第 $i$ 场比赛的参数 $l, r$。
## 输出格式

输出 $Q$ 行，第 $i$ 行包含一个非负整数，表示第 $i$ 场比赛中所有可能的比赛的精彩程度之和对 $2 ^ {64}$ 取模的结果。
## 样例

### 样例输入 #1
```
0 2
2 1
1 2
1
1 2
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
见附件下的 match/match2.in。
```
### 样例输出 #2
```
见附件下的 match/match2.ans。
```
### 样例输入 #3
```
见附件下的 match/match3.in。
```
### 样例输出 #3
```
见附件下的 match/match3.ans。
```
## 提示

**【样例 1 解释】**

当 $p = 1, q = 2$ 的时候，小 N 会派出 $1$ 号选手，小 O 会派出 $2$ 号选手，比赛精彩程度为 $2 \times 2 = 4$。

当 $p = 1, q = 1$ 的时候，小 N 会派出 $1$ 号选手，小 O 会派出 $1$ 号选手，比赛精彩程度为 $2 \times 1 = 2$。

当 $p = 2, q = 2$ 的时候，小 N 会派出 $2$ 号选手，小 O 会派出 $2$ 号选手，比赛精彩程度为 $1 \times 2 = 2$。

**【样例 2】**

该样例满足测试点 $1 \sim 2$ 的限制。

**【样例 3】**

该样例满足测试点 $3 \sim 5$ 的限制。

**【数据范围】**

对于所有数据，保证：$1 \leq n, Q \leq 2.5 \times 10 ^ 5$，$1 \leq l _ i \leq r _ i \leq n$，$1 \leq a _ i, b _ i \leq n$ 且 $\{a _ i\}$ 和 $\{b _ i\}$ 分别构成了从 $1$ 到 $n$ 的排列。

| 测试点 | $n$ | $Q$ | 特殊性质 A | 特殊性质 B |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1, 2$ | $\leq 30$ | $\leq 30$ | 是 | 是 |
| $3, 4, 5$ | $\leq 3,000$ | $\leq 3,000$ | 是 | 是 |
| $6, 7$ | $\leq 10 ^ 5$ | $\leq 5$ | 是 | 是 |
| $8, 9$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 5$ | 是 | 是 |
| $10, 11$ | $\leq 10 ^ 5$ | $\leq 5$ | 否 | 否 |
| $12, 13$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 5$ | 否 | 否 |
| $14, 15$ | $\leq 10 ^ 5$ | $\leq 10 ^ 5$ | 是 | 是 |
| $16, 17$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 2.5 \times 10 ^ 5$ | 是 | 是 |
| $18, 19$ | $\leq 10 ^ 5$ | $\leq 10 ^ 5$ | 是 | 否 |
| $20, 21$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 2.5 \times 10 ^ 5$ | 是 | 否 |
| $22, 23$ | $\leq 10 ^ 5$ | $\leq 10 ^ 5$ | 否 | 否 |
| $24, 25$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 2.5 \times 10 ^ 5$ | 否 | 否 |

特殊性质 A：保证 $a$ 是均匀随机生成的 $1 \sim n$ 的排列。

特殊性质 B：保证 $b$ 是均匀随机生成的 $1 \sim n$ 的排列。


---

---
title: "[春季测试 2023] 密码锁"
layout: "post"
diff: 省选/NOI-
pid: P9120
tag: ['2023', 'NOIP 提高组', 'O2优化']
---
# [春季测试 2023] 密码锁
## 题目描述

寒假过后，小 I 回到学校，发现自己忘记了自行车锁的密码，于是请你帮忙。

小 I 自行车上的密码锁有 $n$ 个拨圈，每个拨圈有 $k$（$k \leq 4$）格。密码锁上的每一格都包含一个正整数，其中第 $j$ 个拨圈的第 $i$ 格上的正整数为 $a _ {i, j}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/0owivo0l.png)

（一个锁的例子，其中 $k = n = 3$，每列表示一个拨圈，拨圈的格子从上往下编号。）

你可以对每个拨圈拨若干次（也可以不拨），每拨一次拨圈，它的格子就会进行一次轮换。形式化地，拨第 $j$ 个拨圈一次，则会让第 $j$ 个拨圈上第 $i$ 格的数字移动到第 $((i \bmod k) + 1)$ 格，其他拨圈不动。

![](https://cdn.luogu.com.cn/upload/image_hosting/9d3g6b74.png)

（一个拨动拨圈的例子，对左侧的锁拨一次第二个拨圈得到右侧的锁。）

为了方便记忆，小 I 设定密码时要求同一行上的数字尽可能靠近。
形式化地，对于 $1 \leq i \leq k$，定义密码锁第 $i$ 行的松散度为

$$
c(i) = \max \limits _ {j = 1} ^ n a _ {i, j} - \min \limits _ {j = 1} ^ n a _ {i, j} 
$$

同时定义整个密码锁的松散度为

$$
C = \max \limits _ {1 \leq i \leq k} c(i)
$$

因为能开锁的状态满足 $C$ 尽可能小，因此小 I 希望你找出最小的 $C$ 值。
## 输入格式

**本题有多组测试数据，题目保证一个测试点中所有测试数据的 $k$ 相同。**

第一行包含两个正整数 $T, k$，分别表示测试数据组数和密码锁拨圈上的格数。

接下来一共 $T$ 组数据，每组数据格式如下：

第一行包含一个正整数 $n$，表示拨圈数。

接下来 $k$ 行，每行包含 $n$ 个正整数，其中第 $i$ 行第 $j$ 个整数 $a _ {i,j}$ 表示密码锁第 $j$ 个拨圈上第 $i$ 格对应的数字。

**注意输入的矩阵中每一列对应一个拨圈，而非每一行对应一个拨圈。**
## 输出格式

对于每组数据，输出一行包含一个整数，表示所有方案中 $C$ 的最小值。
## 样例

### 样例输入 #1
```
2 3
3
1 2 1
2 3 2
3 1 3
2
1 2
2 1
1 2
```
### 样例输出 #1
```
0
1
```
### 样例输入 #2
```
见选手目录下的 lock/lock2.in。
```
### 样例输出 #2
```
见选手目录下的 lock/lock2.ans。
```
### 样例输入 #3
```
见选手目录下的 lock/lock3.in。
```
### 样例输出 #3
```
见选手目录下的 lock/lock3.ans。
```
### 样例输入 #4
```
见选手目录下的 lock/lock4.in。
```
### 样例输出 #4
```
见选手目录下的 lock/lock4.ans。
```
### 样例输入 #5
```
见选手目录下的 lock/lock5.in。
```
### 样例输出 #5
```
见选手目录下的 lock/lock5.ans。
```
## 提示

**【样例 1 解释】**

第一组样例对应题目描述中的例子。
在拨第二个拨圈一次后，每个拨圈都是 $\{1, 2, 3\}$，此时松散度为 $0$。
容易证明无论如何松散度都不可能小于 $0$，因此输出 $0$。

以下四个样例分别对应 $k = 1, 2, 3, 4$ 的情况，且样例中 $n$ 的取值有一定梯度。

**【数据范围】**

设 $\sum n$ 为一个测试点中所有测试数据的 $n$ 的和。

对于所有数据，保证 $1 \leq T$，$1 \leq k \leq 4$，$1 \leq a _ {i ,j} \leq  3 \times 10 ^ 4$。


本题分为两类测试点。


第一类测试点共有十二个，保证 $k \leq 3$，$n \leq 5 \times 10 ^ 4$，$\sum n \leq 1.5 \times 10 ^ 5$。

| 测试点编号 | $n \leq$ | $\sum n \leq $ | $k = $ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $20$ | $100$ | $1$ |
| $2$ | $5 \times 10 ^ 4$ | $1.5 \times 10 ^ 5$ | $1$ |
| $3$ | $20$ | $100$ | $2$ |
| $4$ | $100$ | $1000$ | $2$ |
| $5$ | $2000$ | $10 ^ 4$ | $2$ |
| $6$ | $5 \times 10 ^ 4$ | $1.5 \times 10 ^ 5$ | $2$ |
| $7$ | $10$ | $50$ | $3$ |
| $8$ | $50$ | $500$ | $3$ |
| $9$ | $300$ | $3000$ | $3$ |
| $10$ | $3000$ | $2 \times 10 ^ 4$ | $3$ |
| $11$ | $3 \times 10 ^ 4$ | $1.2 \times 10 ^ 5$ | $3$ |
| $12$ | $5 \times 10 ^ 4$ | $1.5 \times 10 ^ 5$ | $3$ |

第二类测试点共有八个，保证 $k = 4$，$n \leq 10 ^ 4$，
$\sum n \leq 3 \times 10 ^ 4$。

| 测试点编号 | $n \leq$ | $\sum n \leq $ | $k = $ |
| :----------: | :----------: | :----------: | :----------: |
| $13$ | $10$ | $50$ | $4$ |
| $14$ | $50$ | $500$ | $4$ |
| $15$ | $200$ | $2000$ | $4$ |
| $16$ | $500$ | $4000$ | $4$ |
| $17$ | $2500$ | $10 ^ 4$ | $4$ |
| $18$ | $5000$ | $2 \times 10 ^ 4$ | $4$ |
| $19$ | $10 ^ 4$ | $3 \times 10 ^ 4$ | $4$ |
| $20$ | $10 ^ 4$ | $3 \times 10 ^ 4$ | $4$ |

**【后记】**

你花了九牛二虎之力算出 $C$ 的值之后，小 I 却告诉你他已经找开锁师傅用锤子暴力破解了。在你的百般劝说下，小 I 承诺以后锁车不用有大于等于一万个拨圈的密码锁。


---

---
title: "[NOI2023] 方格染色"
layout: "post"
diff: 省选/NOI-
pid: P9478
tag: ['2023', 'NOI', 'O2优化']
---
# [NOI2023] 方格染色
## 题目描述

有一个 $n$ 列 $m$ 行的棋盘，共 $n \times m$ 个方格，我们约定行、列均从 $1$ 开始标号，且第 $i$ 列、第 $j$ 行的方格坐标记为 $(i, j)$。初始时，所有方格的颜色均为白色。现在，你要对这个棋盘进行 $q$ 次染色操作。

染色操作分为三种，分别为：

1. 将一条横线染为黑色。具体地说，给定两个方格 $(x_1, y_1)$ 和 $(x_2, y_2)$，保证 $x_1 \le x_2$，$y_1 = y_2$，将这两个方格之间的所有方格（包括这两个方格）染为黑色。
2. 将一条竖线染为黑色。具体地说，给定两个方格 $(x_1, y_1)$ 和 $(x_2, y_2)$，保证 $x_1 = x_2$，$y_1 \le y_2$，将这两个方格之间的所有方格（包括这两个方格）染为黑色。
3. 将一条斜线染为黑色。具体地说，给定两个方格 $(x_1, y_1)$ 和 $(x_2, y_2)$，保证 $x_1 \le x_2$，$x_2 - x_1 = y_2 - y_1$，将这两个方格之间斜线上所有形如 $(x_1 + i, y_1 + i)$（$0 \le i \le x_2 - x_1$）的方格染为黑色。**这种染色操作发生的次数不超过 $5$ 次。**

现在你想知道，在经过 $q$ 次染色后，棋盘上有多少个黑色的方格。
## 输入格式

输入的第一行包含一个整数 $c$，表示测试点编号。$c = 0$ 表示该测试点为样例。

输入的第二行包含三个正整数 $n, m, q$，分别表示棋盘的列、行和染色操作的次数。

接下来 $q$ 行，每行输入五个正整数 $t, x_1, y_1, x_2, y_2$，其中 $t = 1$ 表示第一种染色操作，$t = 2$ 表示第二种染色操作，$t = 3$ 表示第三种染色操作。$x_1, y_1, x_2, y_2$ 表示染色操作的四个参数。
## 输出格式

输出一行包含一个整数，表示棋盘上被染为黑色的方格的数量。
## 样例

### 样例输入 #1
```
0
5 5 3
1 1 3 5 3
2 3 1 3 5
3 1 1 5 5

```
### 样例输出 #1
```
13

```
### 样例输入 #2
```
见附件中的 color/color2.in。
```
### 样例输出 #2
```
见附件中的 color/color2.ans。
```
### 样例输入 #3
```
见附件中的 color/color3.in。
```
### 样例输出 #3
```
见附件中的 color/color3.ans。
```
### 样例输入 #4
```
见附件中的 color/color4.in。
```
### 样例输出 #4
```
见附件中的 color/color4.ans。
```
### 样例输入 #5
```
见附件中的 color/color5.in。
```
### 样例输出 #5
```
见附件中的 color/color5.ans。
```
### 样例输入 #6
```
见附件中的 color/color6.in。
```
### 样例输出 #6
```
见附件中的 color/color6.ans。
```
### 样例输入 #7
```
见附件中的 color/color7.in。
```
### 样例输出 #7
```
见附件中的 color/color7.ans。
```
## 提示

**【样例解释 #1】**

在这组样例中，我们一共做了三次染色操作，如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/7ojo6cs1.png)

第一次操作时，将 $(1, 3), (2, 3), (3, 3), (4, 3), (5, 3)$ 染为黑色。

第二次操作时，将 $(3, 1), (3, 2), (3, 3), (3, 4), (3, 5)$ 染为黑色。

第三次操作时，将 $(1, 1), (2, 2), (3, 3), (4, 4), (5, 5)$ 染为黑色。

**【样例解释 #2】**

这个样例满足测试点 $1 \sim 5$ 的条件限制。

**【样例解释 #3】**

这个样例满足测试点 $6 \sim 9$ 的条件限制。

**【样例解释 #4】**

这个样例满足测试点 $10 \sim 13$ 的条件限制。

**【样例解释 #5】**

这个样例满足测试点 $14 \sim 17$ 的条件限制。

**【样例解释 #6】**

这个样例满足测试点 $18 \sim 19$ 的条件限制。

**【样例解释 #7】**

这个样例满足测试点 $20$ 的条件限制。

**【数据范围】**

对于所有测试数据保证：$1 \le n, m \le 10 ^ 9$，$1 \le q \le 10 ^ 5$，$1 \le x_1, x_2 \le n$，$1 \le y_1, y_2 \le m$，**且最多有 $5$ 次第三种染色操作**。

|测试点编号|$n, m \le$|$q \le$|特殊性质|
|:-:|:-:|:-:|:-:|
|$1 \sim 5$|$300$|$300$|无|
|$6 \sim 9$|$10 ^ 5$|$2,000$|无|
|$10 \sim 13$|$10 ^ 5$|$10 ^ 5$|A|
|$14 \sim 17$|$10 ^ 5$|$10 ^ 5$|B|
|$18 \sim 19$|$10 ^ 5$|$10 ^ 5$|无|
|$20$|$10 ^ 9$|$10 ^ 5$|无|

特殊性质 A：保证只有第一种染色操作。

特殊性质 B：保证只有第一种和第二种染色操作。

Update on 2023-08-04: 更新一组 Hack 数据，该 Hack 数据的 $c = 0$。


---

---
title: "[NOI2023] 贸易"
layout: "post"
diff: 省选/NOI-
pid: P9481
tag: ['2023', 'NOI', 'O2优化']
---
# [NOI2023] 贸易
## 题目描述

近年来，A 国的商贸发展迅猛，但国内的道路建设却跟不上步伐，明显成为了人们贸易往来的限制，管理者为此费尽了心思。

具体而言，A 国共有 $2^n-1$ 个城市，其中 $1$ 号城市为首都。对于所有的非首都城市 $i$，都有一条**单向**道路从城市 $i$ 出发，到达城市 $\lfloor \frac{i}{2} \rfloor$。为方便起见，称这样的道路为“第一类道路”，称城市 $\lfloor \frac{i}{2} \rfloor$ 为城市 $i$ 的“上级城市”。

除此之外，还有 $m$ 条**单向**道路，设其中第 $i$ 条道路从城市 $u_i$ 出发，到达城市 $v_i$，这样的道路都有一个特殊性质：从城市 $v_i$ 出发，沿着第一类道路不断向“上级城市”走去，最终总能走到城市 $u_i$。称这样的道路为“第二类道路”。

每一条道路都有相应的长度值。由此，对于 A 国的任意两个城市 $x$ 和 $y$，都可以计算出从城市 $x$ 出发，沿道路走到城市 $y$，所经过的道路的长度之和的最小值，将这一数值记为 $dist(x,y)$。但由于 A 国的道路建设存在严重缺陷，从城市 $x$ 出发可能根本到达不了城市 $y$，此时定义 $dist(x,y)=0$。同时一个城市出发到自己是不需要经过任何道路的，因此定义 $dist(x,x)=0$。

现在管理者希望计算出这些 $dist(x,y)$ 的值，以便合理衡量人们贸易往来的便捷程度。但由于 A 国的城市数量太多，将这些值一一列出的工作量太大，因此管理者只希望求出所有 $dist(x,y)$ 值之和，也就是 $\sum_{x=1}^{2^n-1}{\sum_{y=1}^{2^n-1}{dist(x,y)}}$，并希望请你来帮忙。
## 输入格式

输入的第一行包含两个正整数 $n$ 和 $m$。

输入的第二行包含 $2^n-2$ 个正整数，第 $i$ 个数 $a_i$ 表示从城市 $i+1$ 出发, 到达城市 $\lfloor \frac{i+1}{2} \rfloor$ 的“第一类道路”的长度。

接下来的 $m$ 行，每行包含三个正整数 $u,v,w$，描述了一条从城市 $u$ 到城市 $v$ 的“第二类道路”, 其长度为 $w$。 
## 输出格式

输出一行一个正整数，表示对应的答案。由于答案可能很大, 你只需要输出模 $998244353$ 意义下的答案即可。
## 样例

### 样例输入 #1
```
2 1
2 1
1 2 2
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
见附件中的 trade/trade2.in。
```
### 样例输出 #2
```
见附件中的 trade/trade2.ans。
```
### 样例输入 #3
```
见附件中的 trade/trade3.in。
```
### 样例输出 #3
```
见附件中的 trade/trade3.ans。
```
### 样例输入 #4
```
见附件中的 trade/trade4.in。
```
### 样例输出 #4
```
见附件中的 trade/trade4.ans。
```
## 提示

**【数据范围】**

对于所有测试数据保证：$2 \le n \le 18$，$1 \le m \le 2 ^ n$，$1 \le u, v \le 2 ^ n - 1$，$1 \le a_i, w \le 10 ^ 9$。

| 测试点编号 | $n$ | $m$ | 是否有特殊性质 |
| :---: | :---: | :---: | :---: |
| $1\sim 2$ | $=8$ | $\le 256$ | 否 |
| $3\sim 4$ | $=9$ | $\le 512$ | 否 |
| $5\sim 8$ | $=12$ | $\le 4,096$ | 否 |
| $9$ | $=16$ | $\le 10$ |  否|
| $10$ | $=16$ | $\le 50$ | 否 |
| $11$ | $=16$ | $\le 100$ | 否 |
| $12$ | $=16$ | $\le 65,536$ | 是 |
| $13\sim 15$ | $=16$ | $\le 65,536$ | 否 |
| $16\sim 17$ | $=18$ | $\le 262,144$ | 是 |
| $18\sim 20$ | $=18$ | $\le 262,144$ | 否 |

特殊性质：保证每一条“第二类道路”都是从首都（城市 $1$）出发。


---

---
title: "[NOI2023] 字符串"
layout: "post"
diff: 省选/NOI-
pid: P9482
tag: ['2023', 'NOI', 'O2优化']
---
# [NOI2023] 字符串
## 题目描述

小 Y 是一名大学生，最近正在研究字符串方向的问题。

小 Y 了解到关于字符串的如下定义:

- 给定一个长度为 $n$ 的字符串 $s[1: n]$，我们定义其子串 $s[l: r]$（$1 \leq l \leq r \leq n$）为选择 $s[l], s[l+1], \dots, s[r]$, 将其顺次拼接得到的新字符串。
- 给定一个长度为 $n$ 的字符串 $s[1: n]$，我们定义其翻转后的结果 $R(s)$ 为将 $s[n], s[n-1], \dots, s[1]$ 顺次拼接，也就是将字符串反序拼接得到的字符串。
- 给定两个长度均为 $n$ 的字符串 $a[1: n], b[1: n]$，我们定义 $a$ 的字典序小于 $b$ 当且仅当存在 $1 \leq i \leq n$，使得对于任意 $1 \leq j < i$，$a[j] = b[j]$，且 $a[i] < b[i]$。

在了解了上述定义后，小 Y 想到了这样的问题:

给定一个长度为 $n$ 的字符串 $s[1: n]$。有 $q$ 次询问，每次询问给定两个参数 $i, r$。你需要求出有多少 $l$，满足如下条件:
- $1 \leq l \leq r$。
- $s[i: i+l-1]$ 字典序小于 $R(s[i+l: i+2l-1])$。

小 Y 想求助你帮忙解决这一问题。
## 输入格式

**本题有多组测试数据。**

输入的第一行包含两个整数 $c, t$，分别表示测试点编号和测试数据组数。$c=0$ 表示该测试点为样例。

接下来依次输入每组测试数据，对于每组测试数据：

输入的第一行包含两个正整数 $n, q$，表示字符串长度和询问次数。

输入的第二行包含一个长度为 $n$ 的仅包含小写字母的字符串 $s$。

输入的接下来 $q$ 行，每行包含两个正整数 $i, r$。表示一次询问，保证 $i+2r-1 \leq n$。
## 输出格式

对于每一组测试数据的每一次询问，输出一行一个整数，表示满足条件的 $l$ 的个数。
## 样例

### 样例输入 #1
```
0 2
9 3
abacababa
1 4
2 4
3 3
9 3
abaabaaba
1 4
2 4
3 3

```
### 样例输出 #1
```
4
0
3
2
0
2

```
### 样例输入 #2
```
见附件中的 string/string2.in。
```
### 样例输出 #2
```
见附件中的 string/string2.ans。
```
### 样例输入 #3
```
见附件中的 string/string3.in。
```
### 样例输出 #3
```
见附件中的 string/string3.ans。
```
### 样例输入 #4
```
见附件中的 string/string4.in。
```
### 样例输出 #4
```
见附件中的 string/string4.ans。
```
## 提示

**【样例解释 #1】**

对于第一组数据的第一组询问：
- $l = 1$ 时，$s[i: i + l - 1] = \texttt{a}$，$R(s[i + l: i + 2l - 1]) = \texttt{b}$。
- $l = 2$ 时，$s[i: i + l - 1] = \texttt{ab}$，$R(s[i + l: i + 2l - 1]) = \texttt{ca}$。
- $l = 3$ 时，$s[i: i + l - 1] = \texttt{aba}$，$R(s[i + l: i + 2l - 1]) = \texttt{bac}$。
- $l = 4$ 时，$s[i: i + l - 1] = \texttt{abac}$，$R(s[i + l: i + 2l - 1]) = \texttt{baba}$。

这四种情况中，$s[i: i + l - 1]$ 的字典序均小于 $R(s[i + l: i + 2l - 1])$。因此答案为 $4$。

**【样例解释 #2】**

该样例数据范围满足测试点 $5$。

**【样例解释 #4】**

该样例数据范围满足测试点 $24 \sim 25$。

**【数据范围】**

对于所有测试数据保证：$1 \le t \le 5$，$1 \le n \le 10 ^ 5$，$1 \le q \le 10 ^ 5$，$1 \le i + 2r - 1 \le n $，字符串 $s$ 仅包含小写字母。

|测试点编号|$n \le$|$q \le$|特殊性质|
|:-:|:-:|:-:|:-:|
|$1$|$5$|$5$|A|
|$2$|$10$|$10$|A|
|$3$|$20$|$20$|A|
|$4$|$50$|$50$|A|
|$5$|$10^2$|$10^2$|A|
|$6$|$10^3$|$10^3$|无|
|$7$|$2,000$|$2,000$|无|
|$8$|$3,000$|$3,000$|无|
|$9$|$4,000$|$4,000$|无|
|$10$|$23,333$|$23,333$|A|
|$11$|$5 \times 10 ^ 4$|$5 \times 10 ^ 4$|A|
|$12$|$75,000$|$75,000$|A|
|$13$|$9 \times 10 ^ 4$|$9 \times 10 ^ 4$|A|
|$14$|$10 ^ 5$|$10 ^ 5$|A|
|$15$|$23,333$|$23,333$|B|
|$16$|$75,000$|$75,000$|B|
|$17$|$9 \times 10 ^ 4$|$9 \times 10 ^ 4$|B|
|$18$|$10 ^ 5$|$10 ^ 5$|B|
|$19$|$23,333$|$23,333$|无|
|$20$|$5 \times 10 ^ 4$|$5 \times 10 ^ 4$|无|
|$21$|$75,000$|$75,000$|无|
|$22$|$9 \times 10 ^ 4$|$9 \times 10 ^ 4$|无|
|$23$|$95,000$|$95,000$|无|
|$24 \sim 25$|$10 ^ 5$|$10 ^ 5$|无|

特殊性质 A：保证字符串中仅包含字符 $\texttt{a}$ 和 $\texttt{b}$，且每个字符独立等概率地在 $\texttt{a}$ 和 $\texttt{b}$ 中选择。

特殊性质 B：保证字符串中的相邻字符互不相同。


---

---
title: "[NOIP2023] 双序列拓展"
layout: "post"
diff: 省选/NOI-
pid: P9870
tag: ['动态规划 DP', '贪心', '2023', 'NOIP 提高组', 'O2优化', 'Ad-hoc']
---
# [NOIP2023] 双序列拓展
## 题目描述

称某个序列 $B = \{b_1,b_2,\cdots,b_n\}$ 是另一个序列 $A = \{a_1,a_2,\cdots,a_m\}$ 的**拓展**当且仅当存在**正整数**序列 $L = \{l_1,l_2,\cdots,l_m\}$，将 $a_i$ 替换为 $l_i$ 个 $a_i$ 后得到序列 $B$。例如，

- $\{1,3,3,3,2,2,2\}$ 是 $\{1,3,3,2\}$ 的拓展，取 $L = \{1,1,2,3\}$ 或 $\{1,2,1,3\}$；
- 而 $\{1,3,3,2\}$ 不是 $\{1,3,3,3,2\}$ 的拓展，$\{1,2,3\}$ 不是 $\{1,3,2\}$ 的拓展。

小 R 给了你两个序列 $X$ 和 $Y$，他希望你找到 $X$ 的一个长度为 $l_0 = 10^{100}$ 的拓展 $F = \{f_i\}$ 以及 $Y$ 的一个长度为 $l_0$ 的拓展 $G = \{g_i\}$，使得任意 $1 \le i , j \le l_0$ 都有 $(f_i - g_i)(f_j - g_j) > 0$。由于序列太长，你只需要告诉小 R 是否存在这样的两个序列即可。

为了避免你扔硬币蒙混过关，小 R 还给了 $q$ 次额外询问，每次额外询问中小 R 会修改 $X$ 和 $Y$ 中若干元素的值。你需要对每次得到的新的 $X$ 和 $Y$ 都进行上述的判断。

**询问之间是独立的，每次询问中涉及的修改均在原始序列上完成。**
## 输入格式

输入的第一行包含四个整数 $c, n, m, q$，分别表示测试点编号、序列 $X$ 的长度、序列 $Y$ 的长度和额外询问的个数。对于样例，$c$ 表示该样例与测试点 $c$ 拥有相同的限制条件。

输入的第二行包含 $n$ 个整数 $x_1,x_2,\cdots, x_n$，描述序列 $X$。

输入的第三行包含 $m$ 个整数 $y_1,y_2,\cdots, y_m$，描述序列 $Y$。

接下来依次描述 $q$ 组额外询问。对于每组额外询问：

- 输入的第一行包含两个整数 $k_x$ 和 $k_y$，分别表示对序列 $X$ 和 $Y$ 产生的修改个数。
- 接下来 $k_x$ 行每行包含两个整数 $p_x, v_x$，表示将 $x_{p_x}$ 修改为 $v_x$。
- 接下来 $k_y$ 行每行包含两个整数 $p_y, v_y$，表示将 $y_{p_y}$ 修改为 $v_y$。
## 输出格式

输出一行，其中包含一个长度为 $(q+1)$ 的 `01` 序列，序列的第一个元素表示初始询问的答案，之后 $q$ 个元素依次表示每组额外询问的答案。对于每个询问，如果存在满足题目条件的序列 $F$ 和 $G$，输出 `1`，否则输出 `0`。
## 样例

### 样例输入 #1
```
3 3 3 3
8 6 9
1 7 4
1 0
3 0
0 2
1 8
3 5
1 1
2 8
1 7

```
### 样例输出 #1
```
1001
```
## 提示

**【样例解释 #1】**

由于 $F$ 和 $G$ 太长，用省略号表示重复最后一个元素直到序列长度为 $l_0$。如 $\{1,2,3,3,\cdots\}$ 表示序列从第三个元素之后都是 $3$。

以下依次描述四次询问，其中第一次询问为初始询问，之后的三次为额外询问：

1. $A = \{8,6,9\}$，$B = \{1,7,4\}$，取 $F = \{8,8,6,9,\cdots\}, G = \{1,7,4,4,\cdots\}$；
2. $A = \{8,6,0\}$，$B = \{1,7,4\}$，可以证明不存在满足要求的方案；
3. $A = \{8,6,9\}$，$B = \{8,7,5\}$，可以证明不存在满足要求的方案；
4. $A = \{8,8,9\}$，$B = \{7,7,4\}$，取 $F = \{8,8,9,\cdots\}, G = \{7,7,4,\cdots\}$。

**【样例解释 #2】**

该组样例满足测试点 $4$ 的条件。

**【样例解释 #3】**

该组样例满足测试点 $7$ 的条件。

**【样例解释 #4】**

该组样例满足测试点 $9$ 的条件。

**【样例解释 #5】**

该组样例满足测试点 $18$ 的条件。

**【数据范围】**

对于所有测试数据，保证：

- $1 \le n, m \le 5 \times 10 ^ 5$；
- $0 \le q \le 60$；
- $0 \le x_i, y_i < 10 ^ 9$；
- $0 \le k_x, k_y \le 5 \times 10 ^ 5$，且所有额外询问的 $(k_x+k_y)$ 的和不超过 $5 \times 10 ^ 5$；
- $1 \le p_x \le n$，$1 \le p_y \le m$，$0 \le v_x, v_y < 10 ^ 9$；
- 对于每组额外询问，$p_x$ 两两不同，$p_y$ 两两不同。

|测试点编号|$n, m \le$|特殊性质|
|:-:|:-:|:-:|
|$1$|$1$|否|
|$2$|$2$|否|
|$3, 4$|$6$|否|
|$5$|$200$|否|
|$6, 7$|$2000$|否|
|$8, 9$|$4 \times 10 ^ 4$|是|
|$10, 11$|$1.5 \times 10 ^ 5$|是|
|$12 \sim 14$|$5 \times 10 ^ 5$|是|
|$15, 16$|$4 \times 10 ^ 4$|否|
|$17, 18$|$1.5 \times 10 ^ 5$|否|
|$19, 20$|$5 \times 10 ^ 5$|否|

特殊性质：对于每组询问（包括初始询问和额外询问），保证 $x_1 < y_1$，且 $x_n$ 是序列 $X$ 唯一的一个最小值，$y_m$ 是序列 $Y$ 唯一的一个最大值。


---

---
title: "[NOIP2023] 天天爱打卡"
layout: "post"
diff: 省选/NOI-
pid: P9871
tag: ['动态规划 DP', '线段树', '2023', 'NOIP 提高组', 'O2优化']
---
# [NOIP2023] 天天爱打卡
## 题目描述

小 T 同学非常热衷于跑步。为了让跑步更加有趣，他决定制作一款叫做《天天爱打卡》的软件，使得用户每天都可以进行跑步打卡。

开发完成后，小 T 同学计划进行试运行，他找了大 Y 同学来帮忙。试运行共 $n$ 天，编号为从 $1$ 到 $n$。

对大 Y 同学来说，如果某天他选择跑步打卡，那么他的能量值会减少 $d$。初始时，他的能量值是 $0$，并且试运行期间他的**能量值可以是负数**。

而且大 Y 不会**连续**跑步打卡**超过** $k$ 天；即不能存在 $1\le x\le n-k$，使得他在第 $x$ 到第 $x+k$ 天均进行了跑步打卡。

小 T 同学在软件中设计了 $m$ 个挑战，第 $i$（$1\le i \le m$）个挑战可以用三个正整数 $(x_i,y_i,v_i)$ 描述，表示如果在第 $x_i$ 天时，用户已经连续跑步打卡至少 $y_i$ 天（即第 $x_i-y_i+1$ 到第 $x_i$ 天均完成了跑步打卡），那么小 T 同学就会请用户吃饭，从而使用户的能量值提高 $v_i$。

现在大 Y 想知道，在软件试运行的 $n$ 天结束后，他的能量值**最高**可以达到多少？
## 输入格式

**本题的测试点包含有多组测试数据。**

输入的第一行包含两个整数 $c$ 和 $t$，分别表示测试点编号和测试数据组数。对于样例，$c$ 表示该样例与测试点 $c$ 拥有相同的限制条件。

接下来，对于每组测试数据：

- 输入的第一行包含四个正整数 $n,m,k,d$，分别表示试运行的天数、挑战的个数、大 Y 单次跑步打卡的连续天数限制以及大 Y 跑步打卡减少的能量值。
- 接下来 $m$ 行，每行包含三个正整数 $x_i,y_i,v_i$，表示一次挑战。
## 输出格式

输出一行一个整数表示对应的答案。
## 样例

### 样例输入 #1
```
1 1
3 2 2 1
2 2 4
3 2 3

```
### 样例输出 #1
```
2

```
## 提示

**【样例解释 #1】**

在第 $1,2$ 天跑步打卡，第 $3$ 天不跑步打卡，最终会获得 $(-1)+(-1)+4=2$ 的能量值。

**【样例解释 #2】**

该组样例满足测试点 $3$ 的条件。

**【样例解释 #3】**

该组样例满足测试点 $5$ 的条件。

**【样例解释 #4】**

该组样例满足测试点 $15$ 的条件。

**【样例解释 #5】**

该组样例满足测试点 $17$ 的条件。

**【样例解释 #6】**

该组样例满足测试点 $19$ 的条件。

**【数据范围】**

记 $l_i=x_i-y_i+1$，$r_i=x_i$​；

对于所有测试数据，保证：$1\le t\le 10$，$1\le k\le n\le 10^9$，$1\le m\le 10^5$，$1\le l_i\le r_i\le n$，$1\le d,v_i\le 10^9$。

|测试点编号|$n \le$|$m \le$|特殊性质|
|:-:|:-:|:-:|:-:|
|$1, 2$|$18$|$10 ^ 2$|无|
|$3, 4$|$10 ^ 2$|$10 ^ 2$|无|
|$5 \sim 7$|$10 ^ 3$|$10 ^ 3$|无|
|$8, 9$|$10 ^ 3$|$10 ^ 5$|无|
|$10, 11$|$10 ^ 5$|$10 ^ 3$|无|
|$12 \sim 14$|$10 ^ 5$|$10 ^ 5$|无|
|$15, 16$|$10 ^ 9$|$10 ^ 5$|A|
|$17, 18$|$10 ^ 9$|$10 ^ 5$|B|
|$19 \sim 21$|$10 ^ 9$|$10 ^ 5$|C|
|$22 \sim 25$|$10 ^ 9$|$10 ^ 5$|无|

特殊性质 A：$k\le 10^2$；

特殊性质 B：$\forall 1\le i<m$，$r_i<l_{i+1}$；

特殊性质 C：$\forall 1\le i<j\le m$，$l_i<l_j$，$r_i<r_j$。


---


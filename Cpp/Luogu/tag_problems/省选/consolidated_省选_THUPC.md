---
title: "[THUPC 2024 决赛] 研发计划"
layout: "post"
diff: 省选/NOI-
pid: P10541
tag: ['2024', 'THUPC']
---
# [THUPC 2024 决赛] 研发计划
## 题目描述

看到近期若干家大模型创业公司获得高额融资，作为炼丹大师的你心痒难耐，决定入局，亲自下场搞产品。

经过一段时间的梳理，你发现当前共有 $m$ 种产品推出后将会大卖，其中第 $i$ 个产品推出之后预期获得 $g_i$ 的收益。这 $m$ 种产品涉及 $n$ 种技术：共有 $p$ 条技术-产品依赖关系 $(u,v)$ ，表示第 $u$ 个技术是第 $v$ 个产品的前置技术。对于每个产品，你必须获得它的全部前置技术之后才能推出。

对于第 $j$ 个技术，你可以选择花费 $f_j$ 的代价直接从其他公司购买获得，或者花费 $h_j$ 的代价通过研发获得。研发需要一定的条件：给出 $q$ 条技术-技术依赖关系 $(a,b)$ ，表示第 $a$ 个技术是第 $b$ 个技术的前置技术，那么必须在获得了技术 $j$ 的所有前置技术后才能通过研发获得技术 $j$ 。若某个技术没有前置技术，那么你可以直接通过研发获得。保证技术-技术依赖关系构成一个有向无环图，即不会发生循环依赖（自然不会有自环）。

一个方案的收益为推出的产品的收益总和减去获得的技术的代价总和。现在，作为一个商人，你希望研究一些技术、推出一些产品，最大化你获得的收益。为简单起见，你只要输出最大的收益值。
## 输入格式

输入的第一行包含四个正整数 $n,m,p,q$，保证 $2 \le n \le 100, 1 \le m \le 100, 1 \le p\leq nm, 1 \le q\leq \frac{n(n-1)}{2}$ ，分别表示技术总数、产品总数、技术-产品依赖关系总数以及技术-技术依赖关系总数。

接下来一行 $n$ 个整数 $f_i$ ，表示直接购买第 $i$ 个技术的代价。

接下来一行 $n$ 个整数 $h_i$ ，表示在前置技术基础上研究第 $i$ 个技术的代价。

接下来一行 $m$ 个整数 $g_i$，表示第 $i$ 个产品推出之后获得的收益。

接下来 $p$ 行，第 $i$ 行两个整数 $u_i,v_i$ ，表示技术-产品依赖关系 $(u_i,v_i)$，保证 $1 \le u_i \le n$，$1 \le v_i \le m$，输入的所有 $(u_i,v_i)$ 两两不同。

接下来 $q$ 行，第 $i$ 行两个整数 $a_i,b_i$ ，表示技术-技术依赖关系 $(a_i,b_i)$，保证 $1 \le a_i \ne b_i \le n$，输入的所有 $(a_i,b_i)$ 两两不同，且不构成循环依赖。

保证所有输入数字均为不超过 $10^9$ 的非负整数。
## 输出格式

输出一个整数表示收益最大方案的收益。

## 样例

### 样例输入 #1
```
4 5 5 3
2 10 6 7
1 7 5 3
2 2 3 8 8
1 1
2 2
2 3
3 4
4 5
1 2
2 3
3 4
```
### 样例输出 #1
```
8
```
## 提示

最优方案是依次研究技术 1，购买技术 3，研究技术 4，这时我们就能推出产品 1、4、5 了。此时收益为 $(2+8+8)-(1+6+3)=8$。

**来源与致谢**

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>


---

---
title: "[THUPC 2024 决赛] 转化"
layout: "post"
diff: 省选/NOI-
pid: P10544
tag: ['动态规划 DP', '2024', 'Tarjan', 'THUPC']
---
# [THUPC 2024 决赛] 转化
## 题目描述

有 $n$ 种物品和 $m$ 种转化方式。第 $i$ 种转化方式可以将一个第 $a_i$ 种物品转化成 $k_i$ 个互不相同的物品，其中第 $j$ 个的种类是 $b_{i,j}$。同一种转化方式可以使用任意多次。

你有一些物品。你想知道，对于每一种特定的物品 $d$，你用这些你所拥有的物品可以分别转化出最多多少个该种物品。

## 输入格式

第一行两个正整数 $n,m$。

第二行 $n$ 个非负整数，其中第 $i$ 个为 $c_i$，表示你拥有的第 $i$ 种物品的数量。

接下来 $m$ 行，其中第 $i$ 行表示第 $i$ 种转化方式。

转化方式的格式为：一行 $k_i+2$ 个正整数，其中第一个为 $a_i$，第二个为 $k_i$，之后为 $k_i$ 个互不相同的正整数 $b_{i,1},b_{i,2},\cdots,b_{i,k_i}$​​。

保证 $1\le n \le 100$，$1\le m \le 1000$。

保证 $1\le a_i,k_i,b_{i,j} \le n$。

保证 $0\le c_i \le 1000$。
## 输出格式

输出 $n$ 行，其中第 $d$ 行表示第 $d$ 种物品最多能有多少个。如果可以任意多，即对于任意的 $N$ 都存在一种方案使得有超过 $N$ 个第 $d$ 种物品，输出 `infinity`。

## 样例

### 样例输入 #1
```
4 4
1 0 0 0
1 2 2 4
1 1 3
2 1 4
3 1 4

```
### 样例输出 #1
```
1
1
1
2

```
## 提示

不使用任何转化方式，可以得到一个物品 $1$。

使用一次第一种转化方式，可以把物品 $1$ 变成物品 $2$ 和物品 $4$。这样可以得到一个物品 $2$。

使用一次第二种转化方式，可以把物品 $1$ 变成物品 $3$。这样可以得到一个物品 $3$。

使用一次第一种转化方式，可以把物品 $1$ 变成物品 $2$ 和物品 $4$。然后再使用一次第三种转化方式，可以把物品 $2$ 变成物品 $4$。这样可以得到两个物品 $4$。

可以证明这四种方案分别是当 $d=1,2,3,4$ 时的最优方案。

**来源与致谢**

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>


---

---
title: "[THUPC 2024 决赛] 排列游戏"
layout: "post"
diff: 省选/NOI-
pid: P10547
tag: ['2024', 'THUPC']
---
# [THUPC 2024 决赛] 排列游戏
## 题目描述

有 $n$ 个格子排成一行，从左到右依次编号为 $1,2,\cdots,n$，每个格子上有一个数字卡片，初始状态下，格子 $i$ 上的卡片数字为 $i$。

打乱者会进行 $n$ 次交换操作来排列这些卡片：每次选择两个格子 $i,j$（$i\ne j$），然后交换格子 $i$ 和格子 $j$ 上的卡片。$n$ 次交换操作结束后，就完成了对卡片的排列。

然后轮到玩家行动，玩家同样需要用交换操作，每次交换两张卡片，目标是将这些卡片的顺序还原到初始状态。

交换格子 $i$ 和格子 $j$ 上的卡片所需的时间为 $|i-j|$，玩家打算用最短的时间还原该排列。问：有多少种可能的排列，玩家可以用不超过 $m$ 的总时间完成还原？两种排列不同，当且仅当至少有一张数字卡片在两种排列中所在的格子不同。
## 输入格式

每个测试点由多组数据组成。

第一行包含一个正整数 $T$，表示数据组数。保证 $T\le1,000$。

之后 $T$ 行，每行一组数据，包含两个正整数 $n$，$m$。保证 $2\le n\le500$，$m\le5,000$。

## 输出格式

每组数据输出一行，一个整数表示答案。

由于答案可能很大，请输出答案对 $1,000,000,007$ 取模的结果。

## 样例

### 样例输入 #1
```
6
2 1
3 1
5 2
7 5
10 20
15 24

```
### 样例输出 #1
```
1
2
7
331
1570446
73880648

```
## 提示

在第 $1$ 组数据中，打乱者的 $2$ 次操作均只可能是交换格子 $1$ 和格子 $2$ 上的卡片，只有 $1$ 种可能的排列，也就是初始状态 $[1,2]$。

在第 $2$ 组数据中，有 $2$ 种可能的排列：$[1,3,2]$ 和 $[2,1,3]$。注意初始状态 $[1,2,3]$ 不是一种可能的排列，因为打乱者进行前 $2$ 次交换之后，所有卡片要么仍在初始状态（前 $2$ 次交换的是同一对卡片），要么均不在初始位置上（前 $2$ 次交换的不是同一对卡片），第 $3$ 次交换后不可能回到初始状态。

在第 $3$ 组数据中，有 $7$ 种可能的排列：$[1,2,3,5,4]$，$[1,2,4,3,5]$，$[1,2,5,4,3]$，$[1,3,2,4,5]$，$[1,4,3,2,5]$，$[2,1,3,4,5]$，$[3,2,1,4,5]$。

**来源与致谢**

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>


---

---
title: "[THUPC 2024 决赛] 朔望"
layout: "post"
diff: 省选/NOI-
pid: P10548
tag: ['2024', 'THUPC']
---
# [THUPC 2024 决赛] 朔望
## 题目背景

Syzygy，中文译作朔望，表示三个或三个以上的天体大致位于同一直线上。本题中主要探讨母恒星与至少两颗行星位于同一直线上的情况。

## 题目描述

在一个理想的行星系中，所有行星在同一平面内围绕共同的单一母恒星作匀速圆周的公转运动，且公转方向相同（如同为逆时针）。我们定义这样的行星系的 Syzygy 指数为平均每年发生的所有（含母恒星的）朔望的稀有程度之和，其中单次朔望的稀有程度是与产生连线的**行星**数量 $x$ 有关的常数 $w_x$；如果在行星系中同时发生多个朔望但不位于同一直线上，则对每条直线上的行星分别统计稀有程度。

现有一理想的包含 $n$ 颗行星的行星系，其中从内到外第 $i$ 颗行星绕母恒星公转周期为 $t_i$ 年（根据开普勒第三定律可知 $t_i$ 单调递增）。假设存在某一时刻，所有 $n$ 颗行星位于同一条以母恒星为端点的射线上。请求出该系统的 Syzygy  指数。
## 输入格式

第一行输入一个正整数 $n$（$2\le n\le 20$），表示该单星系统中行星的数量。

第二行输入 $n$ 个正整数 $t_1, t_2, \cdots, t_n$，分别表示公转轨道从内到外各行星的公转周期。保证 $1\le t_1 < t_2 < \cdots < t_n\le 10^9$。

第三行输入 $(n-1)$ 个正整数 $w_2, w_3, \cdots, w_n$（$1\le w_i\le 10^9$），分别表示发生不同数量的行星参与的朔望的稀有程度。
## 输出格式

输出该行星系的 Syzygy 指数。显然 Syzygy 指数是一个有理数；不妨假设其化为最简分式后的形式为 $p/q$（即其中 $p, q$ 互质），请输出 $x$ 使得 $qx\equiv p \pmod{10^9 + 7}$ 且 $0\le x<10^9 + 7$。可以证明，在本题数据范围下，$x$ 存在且唯一。

## 样例

### 样例输入 #1
```
2
3 4
5

```
### 样例输出 #1
```
833333340

```
### 样例输入 #2
```
3
4 5 6
7 8

```
### 样例输出 #2
```
300000004

```
### 样例输入 #3
```
4
4 6 8 24
20 22 1207

```
### 样例输出 #3
```
250000119

```
### 样例输入 #4
```
9
88 225 365 687 4333 10759 30685 60189 90560
306 241 336 406 342 86884 86885 86886

```
### 样例输出 #4
```
94380764

```
## 提示

**样例解释 1**

不妨假设 $T=0$ 时刻两颗行星位于同一以母恒星为端点的射线上。由于两颗行星的公转周期的最小公倍数为 $12$ 年，且两颗行星的会合周期也恰为 $\displaystyle\frac{1}{\displaystyle\left|\frac{1}{3}-\frac{1}{4}\right|}=12$ 年，故可取 $T\in[0, 12)$ 年的行星系的运行情况作为研究对象。$T$ 取 $[0, 12)$ 中整数值时，行星系的运行情况分别如下各图所示：

{{ img('1.png', size = 0.5, align = 'middle', inline = False) }}

可以证明，在 $12$ 年的周期内，两颗行星仅发生如上图所示的 $2$ 次朔望（分别为 $T=0$ 时的内行星凌/外行星冲及 $T=6$ 年的合）。因此，该行星系的 Syzygy 指数为

$$
\frac{2\times 5}{12} = \frac{5}{6} \equiv 833333340 \pmod{10^9 +7}.
$$

**样例解释 2**

同理设 $T=0$ 时刻三颗行星位于同一以母恒星为端点的射线上。由 $\mathrm{lcm}(4, 5, 6)=60$，可取 $T\in[0,60)$ 年的行星系的运行情况作为研究对象。在这段时间内，发生的所有含母恒星的朔望如下图所示：

{{ img('2.png', size = 0.5, align = 'middle', inline = False) }}


因此，该行星系的 Syzygy 指数为

$$
\frac{14\times 7+2\times 8}{60}=\frac{19}{10}\equiv300000004 \pmod{10^9+7}.
$$

**样例解释 3**

同理设 $T=0$ 时刻四颗行星位于同一以母恒星为端点的射线上。由 $\mathrm{lcm}(4, 6, 8, 24)=24$，可取 $T\in[0,24)$ 年的行星系的运行情况作为研究对象。在这段时间内，发生的所有含母恒星的朔望如下图所示：

{{ img('3.png', size = 0.5, align = 'middle', inline = False) }}

因此，该行星系的 Syzygy 指数为

$$
\frac{20\times 20+0\times22+2\times 1207}{24}=\frac{1407}{12}\equiv250000119 \pmod{10^9+7}.
$$


**来源与致谢**

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>


---

---
title: "[THUPC 2025 初赛] 骑行计划"
layout: "post"
diff: 省选/NOI-
pid: P11520
tag: ['2025', 'THUPC']
---
# [THUPC 2025 初赛] 骑行计划
## 题目描述

随着盛夏的到来，小 Rei 迎来了长达 $n$ 天的假期。为了充分利用这段时间，她计划每天骑共享单车出门，享受户外的清新空气。根据小 Rei 的计划，第 $i$ 天她将会骑行 $s_i$ 分钟，而每分钟的骑行费用为 $c$ 元。

为了节约开支，小 Rei 打算购买 APP 中提供的一些骑行卡。她了解到现在有 $m$ 种骑行卡可以购买，其中第 $i$ 种骑行卡的具体信息如下：

- **售价 $w_i$**：每张卡的价格为 $w_i$ 元；
- **有效期 $d_i$**：从购买当天算起，连续 $d_i$ 天内有效；
- **免费时间 $t_i$**：在有效期内，每天的前 $t_i$ 分钟骑行是免费的。

小 Rei 可以多次购买任意一种骑行卡，并且可以在同一时间持有多张有效的骑行卡。如果某天有多张骑行卡同时有效，那么当天可以享受的免费骑行时间为这些卡中 $t_i$ 的**最大值**。超出免费时间的部分，仍然按照每分钟 $c$ 元计算。

小 Rei 希望在假期中尽可能减少骑行的总支出。请你帮助她计算出在假期中骑行的最小总支出是多少。

## 输入格式

第一行包含三个整数 $n, m, c \; (1\le n\le 150, 1\le m, c\le 10^4)$，分别表示假期的天数，骑行卡的种类数以及每分钟的骑行费用。

第二行包含 $n$ 个整数，第 $i$ 个整数表示第 $i$ 天骑行的分钟数 $s_i \; (1 \le s_i\le 150)$。

接下来的 $m$ 行，每行包含三个整数 $w_i, d_i, t_i \; (1\le w_i\le 10^9, 1\le d_i\le n, 1\le t_i\le 150)$，分别表示第 $i$ 种骑行卡的售价，有效期天数以及免费骑行时间。

## 输出格式

输出一个整数，表示小 Rei 在假期中骑行的最小总支出。

## 样例

### 样例输入 #1
```
5 2 2
30 40 50 20 10
10 3 20
15 2 30
```
### 样例输出 #1
```
100
```
### 样例输入 #2
```
8 4 1
5 10 9 3 9 8 3 1
11 4 5
12 7 4
10 2 9
5 3 4
```
### 样例输出 #2
```
33
```
## 提示

#### 样例 1 解释

小 Rei 的最优策略为：在第一天和第二天购买第二种骑行卡，在第三天购买第一种骑行卡。此时前三天的免费时间为 $30$ 分钟，后两天的免费时间为 $20$ 分钟，还需要在第二天额外支付 $10$ 分钟的骑行费用，在第三天额外支付 20 分钟的骑行费用。购买骑行卡共花费 $15+15+10=40$ 元，额外骑行费用为 $(10 + 20) \times 2 = 60$ 元，总支出为 $100$ 元。可以证明不存在总支出更少的方案，故输出 $100$。

#### 题目来源

来自 2025 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2025）初赛。

题解等资源可在 <https://gitlink.org.cn/thusaa/thupc2025pre/tree/master> 查看。


---

---
title: "[THUPC 2025 初赛] 挑战大模型"
layout: "post"
diff: 省选/NOI-
pid: P11521
tag: ['2025', 'THUPC']
---
# [THUPC 2025 初赛] 挑战大模型
## 题目背景

由于洛谷评测机太慢，$3s\to 4s$。
## 题目描述

S 是学校里屈指可数的理工天才。两脚分离式的电动平衡车，通过刺激人体上臂、腰部及大腿的运动神经实现控制身体运动的电极装置，以及可以用无人机吊起来的巨幅轻薄柔性屏，只不过是 S 登峰造极的技术水平的冰山一角。这一次，S 又将目光投向了最近很流行的大语言模型（Large Language Model）。

大语言模型是机器学习中的新兴方向，其特点是使用大量的语料来训练语言模型，而正是算法的发展及算力的提升使得训练大语言模型不再捉襟见肘。此外，部分最新的大语言模型不仅支持文本输入输出，更支持音频、图像、视频等格式的多模态输入输出。但是 S 发现，即便是多模态的大语言模型，也不能正确处理一类特殊的图片——随机点立体图（Random Dot Stereogram）。

立体图是使用视错觉造成立体感知的图像，而随机点立体图的原理是通过对随机生成的位图进行平移变换，产生立体视觉。下图是一张简单的随机点立体图。通过将绿色虚线框中的部分向左平移 $2$ 个像素，可以产生虚线框中的部分浮在原图像之上的效果。注意除虚线框及左图中虚线框左侧的红色矩形，右图中虚线框右侧的绿色矩形覆盖的部分之外，图像的外围部分需要保持完全相同，而红色矩形及绿色矩形覆盖的区域则可以分别随机生成。形式化地，如果记左图为 $W$，右图为 $Y$，则将 $W$ 中第 $r_1$ 至 $r_2$ 行，第 $c_1$ 至 $c_2$ 列的矩形子区域平移至 $Y$ 中第 $r_1$ 至 $r_2$ 行，第 $c_1'$ 至 $c_2'$ 列时，需要满足 $r_1\le r_2$，$c_2 - c_1 = c_2'-c_1'\ge 0$ （为 $0$ 时恰好只移动一列），$c_1>c_1'$；只有 $W$ 中的第 $r_1$ 至 $r_2$ 行，第 $c_1'$ 至 $(c_1-1)$ 列及 $Y$ 中的第 $r_1$ 至 $r_2$ 行，第 $(c_2'+1)$ 至 $c_2$ 列部分的像素都可以独立随机生成，无论平移前后矩形区域是否重叠。

![](https://cdn.luogu.com.cn/upload/image_hosting/7vts3y14.png)

S 发现：尽管大语言模型可以识别传统的图像验证码，但是如果使用随机点立体图来生成验证码，那么大语言模型将无法正确识别！为了验证这一发现，S 需要生成不同的随机点立体图来测试大语言模型是否能够识别图像内容。作为计划的第一步，S 想先测试大语言模型能否看出图片中的矩形。具体而言，S 将把两个可以表示为 $01$ 矩阵的 $N$ 行 $M$ 列的位图 $W$ 和 $Y$ 输入到大语言模型中，并询问 $Y$ 是否可以由 $W$ 向左平移某个矩形子区域得到。假设在平移前后，这一矩形子区域都不超出原图片的边界。为了检验大语言模型的输出，S 需要一个程序来计算，对于所有可能的平移距离，右半边的图片 $Y$ 是否可以通过对左半边的图片 $W$ 平移某个矩形子区域得到，并在可行时求出该矩形子区域的最大面积。由于 S 这周末还要陪 M 逛街，所以她想请你帮她实现一下这个程序。

## 输入格式

输入的第一行包含两个正整数 $N, M$，表示两个像素矩阵的行数和列数。保证 $1\le N, M\le 500$。

接下来 $N$ 行，每行输入一个包含 $M$ 个字符的字符串，表示 $W$ 的每一行。保证每个字符均为 `0` 或 `1`。

接下来 $N$ 行，每行输入一个包含 $M$ 个字符的字符串，表示 $Y$ 的每一行。保证每个字符均为 `0` 或 `1`。

## 输出格式

输出共一行，包含 $(m-1)$ 个由单个空格分隔开的整数，其中第 $i$（$1\le i \le m - 1$）个整数表示当平移距离为 $i$ 个像素时，可能的矩形子区域的最大面积。如果不存在任何满足要求的矩形子区域，则对这个移动距离输出 `-1`。

## 样例

### 样例输入 #1
```
4 4
0100
0110
1001
1000
0100
1100
0011
0000
```
### 样例输出 #1
```
9 4 -1
```
### 样例输入 #2
```
11 11
01010100100
10111011000
10001010110
11011101110
10110010010
00100010010
11011010011
01001111001
00111000111
10010011101
00101110110
01010100100
10111011000
10001010110
11110111010
10001000010
00001001110
11101000111
01111100101
00111000111
10010011101
00101110110
```
### 样例输出 #2
```
-1 25 -1 -1 -1 -1 -1 -1 -1 -1
```
## 提示

#### 样例解释 1

当固定平移距离为 $1$ 时，可能的最大矩形子区域在 $W$ 中对应第 $2$ 行至第 $4$ 行，第 $2$ 列至第 $4$ 列的矩形区域，其平移后在 $Y$ 中为第 $2$ 行至第 $4$ 行，第 $1$ 列至第 $3$ 列。

如果假设平移距离为 $2$，则可能的最大矩形子区域为 $W$ 中第 $3$ 列整列对应的矩形区域。

可以证明，不存在任何平移距离为 $3$ 的平移方法。

#### 样例解释 2

该样例即为题面所附图片。

#### 数据范围

对于所有数据，保证 $1\le N, M\le 500$，输入的 $W$ 和 $Y$ 是 $N$ 行 $M$ 列仅含 `0` 和 `1` 的字符矩阵。

#### 题目来源

来自 2025 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2025）初赛。

题解等资源可在 <https://gitlink.org.cn/thusaa/thupc2025pre/tree/master> 查看。


---

---
title: "[THUPC 2025 初赛] 背向而行"
layout: "post"
diff: 省选/NOI-
pid: P11524
tag: ['2025', 'THUPC']
---
# [THUPC 2025 初赛] 背向而行
## 题目描述

有 $m$ 堆积木，其中第 $i$ 堆积木位于坐标 $x_i$ 的位置，有 $c_i$ 块。

反复执行如下操作，直至无法操作：

- 如果存在两块积木坐标相同，则找到满足条件的积木中坐标最小的两块，将一块坐标减 $1$，另一块坐标加 $1$，

可以证明在有限次操作之后，所有积木的坐标都会不同，此时无法进行操作。

多次询问，每次给定正整数 $k$，问最后左数第 $k$ 块积木的位置。保证询问的 $k$ 严格递增。
## 输入格式

第一行一个正整数 $m$。保证 $1\le m \le 2\times 10^6$。

接下来 $m$ 行，其中第 $i$ 行两个正整数 $x_i,c_i$。保证 $1\le x_i \le 10^9$，$1\le c_i \le 10^9$。保证 $x_i$ 按照输入的顺序严格递增，即 $x_i<x_{i+1}$。

接下来一行一个正整数 $q$，表示询问个数。保证 $1\le q\le 2\times 10^6$。

接下来 $q$ 行，每行一个正整数 $k$，表示一次询问。保证 $1\le k \le \sum\limits_{i=1}^{m} c_i \le 10^9$。保证询问的 $k$ 严格递增。

## 输出格式

输出 $q$ 行，每行一个整数，其中第 $i$ 行表示第 $i$ 个询问的答案。

## 样例

### 样例输入 #1
```
2
3 3
4 2
2
2
4
```
### 样例输出 #1
```
2
5
```
## 提示

我们用长度为 5 的单调不降数字字符串描述从左往右五块积木的位置，那么操作过程如下所示：

$33344 \to 23444 \to 23345 \to 22445 \to 13445 \to 13355 \to 12455 \to 12446 \to 12356$

最终第二块积木坐标为 2，第四块积木坐标为 5。

#### 题目来源

来自 2025 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2025）初赛。

题解等资源可在 <https://gitlink.org.cn/thusaa/thupc2025pre/tree/master> 查看。


---

---
title: "[THUPC 2025 初赛] waht 先生的法阵"
layout: "post"
diff: 省选/NOI-
pid: P11527
tag: ['2025', 'THUPC']
---
# [THUPC 2025 初赛] waht 先生的法阵
## 题目背景

由于洛谷评测机太慢，$4s\to 5s$。
## 题目描述

waht 先生是一名法力强大的魔法师。

waht 先生为了增强自己的法力，设置了一个法阵。这个法阵中共有 $n$ 块魔法石，它们从左到右依次排成一列；并且从左数第 $i$ 块魔法石的编号为 $i$，其法力值初始为 $a_i$。

waht 先生可以获取一些魔法石的法力。然而由于这个法阵的特殊性质，在获取法力时，waht 先生必须先选择一块魔法石；并且一旦第 $x$ 块魔法石被选，接下来必须再选第 $x+\gcd(x,a_x)$ 块魔法石（这里 $\gcd(x,y)$ 表示 $x,y$ 的最大公约数），直到 $x+\gcd (x,a_x)>n$ 时 waht 先生会立即停止本次法力获取的过程。waht 先生获取的法力将会是过程中所选的所有魔法石的法力值之和。

waht 先生会对这个法阵进行 $q$ 次操作。具体的，有以下两类操作：

- waht 先生选择两个数 $l,r\;(1\leq l\leq r\leq n)$，对区间 $[l,r]$ 中的所有魔法石施加法术，使得它们的法力值全部乘以 $c$。具体的，对于所有满足 $l\leq i\leq r$ 的 $i$，将 $a_i$ 的值修改为 $c\cdot a_i$。
- waht 先生选择第 $x$ 块魔法石，并按照上述的规则获取法力。

每当 waht 先生选择某一块魔法石来获取法力时，你都需要帮他计算出他到底获得了多少法力。由于答案可能很大，你只需要求出答案对 $998244353$ 取模的结果。

## 输入格式

第一行输入两个正整数 $n,q\;(1\leq n,q\leq 2.5\times 10^5)$，表示法阵中魔法石的数量和操作次数。

接下来一行，输入 $n$ 个正整数，其中第 $i$ 个为 $a_i\;(1\leq a_i<998244353)$，表示魔法石初始的法力值。

接下来 $q$ 行，先输入一个 $op$，表示操作种类；

若 $op=1$，则再输入三个正整数 $l,r,c\;(1\leq l\leq r\leq n,2\leq c\leq 2.5\times 10^5)$，表示将区间 $[l,r]$ 中的所有魔法石的法力值乘以 $c$；

若 $op=2$，则再输入一个正整数 $x\;(1\leq x\leq n)$，表示获取法力的开始位置。

## 输出格式

每当进行一次操作 $2$ 时，输出一行一个正整数，表示所要查询的答案对 $998244353$ 取模的值。

## 样例

### 样例输入 #1
```
7 7
1 1 1 1 1 1 1
1 2 6 2
2 1
1 3 5 5
2 3
1 2 7 3
2 3
2 2
```
### 样例输出 #1
```
7
22
36
42
```
## 提示

第一次操作，将区间 $[2,6]$ 中的魔法石的法力值乘以 $2$，法力值序列变为 $1,2,2,2,2,2,1$；

第二次操作，waht 先生选择第 $1$ 块魔法石，则编号为 $1,2,4,6$ 的魔法石会依次被选中，这些魔法石的法力值之和为 $7$；

第三次操作，将区间 $[3,5]$ 中的魔法石的法力值乘以 $5$，法力值序列变为 $1,2,10,10,10,2,1$；

第四次操作，waht 先生选择第 $3$ 块魔法石，则编号为 $3,4,6$ 的魔法石会依次被选中，这些魔法石的法力值之和为 $22$；

第五次操作，将区间 $[2,7]$ 中的魔法石的法力值乘以 $3$，法力值序列变为 $1,6,30,30,30,6,3$；

第六次操作，waht 先生选择第 $3$ 块魔法石，则编号为 $3,6$ 的魔法石会依次被选中，这些魔法石的法力值之和为 $36$；

第七次操作，waht 先生选择第 $2$ 块魔法石，则编号为 $2,4,6$ 的魔法石会依次被选中，这些魔法石的法力值之和为 $42$。

#### 题目来源

来自 2025 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2025）初赛。

题解等资源可在 <https://gitlink.org.cn/thusaa/thupc2025pre/tree/master> 查看。


---

---
title: "[THUPC 2025 决赛] 三元链"
layout: "post"
diff: 省选/NOI-
pid: P12058
tag: ['2025', 'Special Judge', 'THUPC']
---
# [THUPC 2025 决赛] 三元链
## 题目描述


给定正整数 $n,k$，请在一个 $n\times n$ 的网格中将 $kn$ 个方格染成黑色，其余方格染成白色，满足：

- 在水平或竖直方向上不存在连续的三个同色格。具体地：

  1. 不存在 $1\le i\le n,1\le j \le n-2$ 满足坐标为 $(i,j),(i,j+1),(i,j+2)$ 的格子均为黑色或均为白色。
  2. 不存在 $1\le i\le n-2,1\le j \le n$ 满足坐标为 $(i,j),(i+1,j),(i+2,j)$ 的格子均为黑色或均为白色。
  
- 每列中有恰好 $k$ 个黑色格。

- 对于任意 $i=1,2,\dots,k$，任意相邻的两列中从上至下第 $i$ 个黑色格的行坐标之差不超过 $1$。具体地，记第 $j$ 列的黑色格的坐标分别为 $(x_{1,j},j),(x_{2,j},j),\dots,(x_{k,j},j)$，其中 $x_{1,j}<x_{2,j}<\dots<x_{k,j}$，那么对于 $1\le i\le k,1\le j< m$ 有 $|x_{i,j}-x_{i,j+1}|\le 1$。

给出一种合法的方案，或判定无解。

## 输入格式


第一行包含一个正整数 $T$ $(1\le T\le 500)$，表示数据组数。

每组数据包含一行两个正整数 $n,k$ $(4\le n \le 1000,1\le k \le n)$，分别表示网格的大小与每列中黑色格的数量。

保证单个测试点中所有数据 $n^2$ 的和不超过 $10^6$。 

## 输出格式


对于每组测试数据：

- 若不存在合法的染色方案，则仅输出一行一个字符串 `No`；
- 否则，先输出一行一个字符串 `Yes`，然后接下来 $n$ 行每行输出一个长度为 $n$，仅包含字符 `#` 与 `.` 的字符串，代表你染色方案中从上到下每一行的染色情况，其中字符 `#` 代表对应格染为黑色，字符 `.` 代表对应格染为白色。如果有多种合法的染色方案，输出任意一种即可。

## 样例

### 样例输入 #1
```
3
4 2
6 1
9 5

```
### 样例输出 #1
```
Yes
#..#
.##.
.##.
#..#
No
Yes
.#.#..##.
#.#.##..#
#.##..##.
.#..##.##
#..##.#.#
.##..#.#.
##.##.#.#
#.##.##..
.##.##.##

```
## 提示

### 样例 #1 解释


对于第一组数据，以下为若干不符合条件的示例：

![](https://cdn.luogu.com.cn/upload/image_hosting/7tghzsoe.png)

示例 $1$ 中左下角有连续的三个白色格，示例 $2$ 中第一列与第四列黑色格数量不正确，示例 $3$ 中左上角有连续的三个黑色格，示例 $4$ 中第三、四列的第二个黑色格行坐标之差大于 $1$。

对于第二组数据，容易发现不存在合法的染色方案。

对于第三组数据，下图中不同方位的黑色格用不同颜色标注后易见答案的合法性：

![](https://cdn.luogu.com.cn/upload/image_hosting/v4bhosde.png)


### 来源与致谢

来自 THUPC2025（2025 年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>。


---

---
title: "[THUPC 2025 决赛] 喜爱之钥"
layout: "post"
diff: 省选/NOI-
pid: P12061
tag: ['2025', 'THUPC']
---
# [THUPC 2025 决赛] 喜爱之钥
## 题目描述


玩具箱承载着幼时的欢乐。喜爱、软弱、苦恼、希望……当沉睡的玩具箱再次被打开时，重见天日的宝物将会带来怎样的惊喜？

M 就有一个这样的玩具箱，那是身为宝石设计师的母亲送给她的生日礼物。精心打磨的宝石像夜空中的繁星一般点缀着玩具箱，而玩具箱上更有造型各异的 $L$ 把锁严防死守着宝贝女儿的小宇宙：花朵发夹、羽毛笔、字母 M 造型的气球……每一件都浓缩着 M 的回忆。

前几天，M 在整理房间时翻出了这个玩具箱，以及一串专门为这个玩具箱打造的钥匙。钥匙串上共挂着 $(L+K)$ 把钥匙，其中有 $L$ 把钥匙，每把分别可以打开其中一把锁；而剩下的 $K$ 把钥匙仅仅是增加暴力破解难度的干扰项。为了方便记忆，M 的母亲在设计钥匙时，给每一把钥匙镶嵌了一颗不同的宝石，可惜 M 已经忘记了正确的对应关系。

“……所以我只好向大家求助了。” M 说着把手里的钥匙串摆在了桌面上。

K 拿起了钥匙串仔细端详。“仅凭外表似乎无法推断出任何有用的信息，恐怕只能逐把尝试。”

虽然大家都愿意帮助 M，但是面对这么多把钥匙，不免感到无从下手。看着大家的反应，T 提议：“要不我们来玩个游戏吧。每个人按顺序试一把钥匙，最终打开最多锁的人最厉害。”

包括 M 在内，总共有 $N$ 个人按相同的顺序轮流尝试解锁玩具箱，直到 $L$ 把锁都被打开。每人每次操作时只选择一把钥匙，且只用这把钥匙试着打开其中一把锁。为了尽快打开玩具箱，所有人的策略都是尝试能最大化这次选择的钥匙打开这次选择的锁的概率的组合；如果有多种概率最大的钥匙和锁的组合，则等概率地选取任意一种这样的组合。显然，如果之前成功用一把钥匙打开了一把锁，那么之后所有人在尝试的时候，都不会再选择相同的钥匙或者相同的锁。

假设在最开始的时候，任意一把钥匙打开任意一把锁的概率都相等。如果每个人都能根据之前尝试的所有钥匙和锁的组合，选择最优的组合进行尝试，那么每个人成功解锁的期望次数分别是多少？
## 输入格式


输入仅一行，包括三个非负整数 $N\ (1\le N\le 50), L\ (1\le L\le 5000), K\ (0\le K\le 50)$，分别表示参加游戏的人数，锁的数量和假钥匙的数量。

## 输出格式


输出一行 $N$ 个非负整数 $E_1, \cdots, E_N$，其中 $E_i$ 表示按顺序第 $i$ 个人成功解锁的期望次数。显然 $E_i$ 是有理数；不妨假设其化为最简分式后的形式为 $p_i/q_i$（即其中 $p_i, q_i$ 互质），则 $E_i$ 为满足 $q_i E_i\equiv p_i \pmod{10^9+7}$ 和 $0\le E_i < 10^9+7$ 的整数解。可以证明，在本题数据范围下，各 $E_i$ 存在且唯一。

## 样例

### 样例输入 #1
```
3 1 4

```
### 样例输出 #1
```
800000006 800000006 400000003

```
### 样例输入 #2
```
3 2 0

```
### 样例输出 #2
```
500000004 1 500000004

```
### 样例输入 #3
```
25 2 5

```
### 样例输出 #3
```
142857144 166666668 615646263 639455787 234126986 257936510 195918369 502040820 478316330 81264173 190523433 471438023 23809524 0 0 0 0 0 0 0 0 0 0 0 0

```
### 样例输入 #4
```
4 102 9

```
### 样例输出 #4
```
568832210 85779764 969938175 375449967

```
## 提示

### 样例 #1 解释


当只有 $1$ 把锁时，每个人的策略都是随机选择一把尚未有人试过的钥匙开锁。由于总共有 $1+4=5$ 把钥匙，每个人打开门的概率分别为 $2/5, 2/5, 1/5$，这也是每个人成功解锁的期望次数。

### 样例 #2 解释


此时有 $2$ 把锁和 $2$ 把钥匙，每把钥匙恰好可以打开其中一把锁。由于没有任何已知信息，第 $1$ 个人只能随机选择一把钥匙和一把锁，此时成功解锁的概率为 $1/2$。

- 如果第 $1$ 个人打开了这把锁，那么第 $2$ 个人可以直接用另外一把钥匙打开另外一把锁。

- 如果第 $1$ 个人没有打开这把锁，那么第 $1$ 个人选择的钥匙一定对应另一把锁，且另一把钥匙一定可以打开第 $1$ 个人选择的锁。根据这个信息，第 $2$ 个人和第 $3$ 个人可以各打开一把锁。

综上所述，每个人成功解锁的期望次数分别为

$$
\begin{split}
E_1 &= \frac{1}{2}\times 1 + \frac{1}{2}\times 0 = \frac{1}{2} \equiv 500,000,004 \pmod {10^9+7},\\
E_2 &= \frac{1}{2}\times 1 + \frac{1}{2} \times 1 = 1,\\
E_3 &= \frac{1}{2}\times 0 + \frac{1}{2} \times 1 = \frac{1}{2} \equiv 500,000,004\pmod {10^9+7}.
\end{split}
$$


### 来源与致谢

来自 THUPC2025（2025 年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>。


---

---
title: "[THUPC 2025 决赛] 列队"
layout: "post"
diff: 省选/NOI-
pid: P12062
tag: ['2025', 'THUPC']
---
# [THUPC 2025 决赛] 列队
## 题目背景

……所以这个题意和标题是什么关系？
## 题目描述

定义 $f(A)$ 为 矩阵 $A$ 经过如下操作后得到的结果：

1. 独立地对矩阵 $A$ 的每行进行排序，使得各行中的元素从左到右单调不降。如果排序过后的矩阵和排序之前完全相同，则此次变换停止，否则再进行 2. 中描述的操作。
2. 独立地对矩阵 $A$ 的每列进行排序，使得各列中的元素从上到下单调不降。如果排序过后的矩阵和排序之前完全相同，则此次变换停止，否则再进行 1. 中描述的操作。

现给定一个 $n$ 行 $m$ 列的整数矩阵 $P$，满足$1\le P_{ij}\le n\times m$ 且矩阵中元素互不相同。

接下来有 $q$ 次操作，操作有以下两种：

- 修改操作：给定矩阵中的两个位置 $(x_1,y_1)$ 和 $(x_2,y_2)$，将这两个位置上的元素交换，即交换 $P_{x_1y_1}$ 和 $P_{x_2y_2}$。
- 查询操作：给定矩阵中的一个位置 $(x,y)$，输出矩阵 $f(P)$ 中该位置的元素，即$f(P)_{xy}$。注意，**查询操作并不会真的改变矩阵形态**。
## 输入格式

第一行依次输入三个整数 $n,m,q\ (1\le n\times m\le2\times10^5,1\le q\le2\times10^5)$。

接下来 $n$ 行，每行 $m$ 个整数，依次描述矩阵 $P$ 各行各列的元素。保证这些元素均在 $1\sim n\times m$ 之间且互不相同。

接下来 $q$ 行，每行先是一个整数 $\text{opt}\in\{1,2\}$，表示操作种类。


- $\text{opt}=1$ 代表一个修改操作。接下来读入四个整数 $x_1,y_1,x_2,y_2\ (1\le x_1,x_2\le n,1\le y_1,y_2\le m)$，表示交换 $P_{x_1y_1}$ 和 $P_{x_2y_2}$。

- $\text{opt}=2$ 代表一个查询操作。接下来读入两个整数 $x,y\ (1\le x\le n,1\le y\le m)$，表示查询 $f(P)_{xy}$ 的值。
## 输出格式

对每组查询操作，输出对应元素的值。
## 样例

### 样例输入 #1
```
2 2 10
1 4
2 3
2 1 2
1 1 1 1 2
2 1 2
1 1 1 1 2
1 1 2 2 1
2 2 1
2 2 2
1 1 1 2 2
2 1 1
2 2 1

```
### 样例输出 #1
```
4
3
3
4
1
2

```
## 提示

### 样例 #1 解释

第一次查询的时候矩阵形如

```plain
1 4
2 3
```

我们发现第一次按行排列时就没能使得矩阵改变，因此答案就是第一行第二列的元素，也就是 $4$。

第二次查询的时候矩阵形如

```plain
4 1
2 3
```

我们先按行排序，变成

```plain
1 4
2 3
```

再按列排序，变成

```plain
1 3
2 4
```

再尝试按行排序，发现不能成功排序。因此答案就是此时第一行第二列的元素，也就是 $3$。

### 来源与致谢

来自 THUPC2025（2025 年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>。


---

---
title: "[THUPC 2019] 过河卒二"
layout: "post"
diff: 省选/NOI-
pid: P5376
tag: ['2019', '组合数学', '排列组合', '容斥原理', 'Lucas 定理', 'THUPC']
---
# [THUPC 2019] 过河卒二
## 题目描述

> 首先我们回忆一下经典难题过河卒问题：
>
> 棋盘上 $A$ 点有一个过河卒，需要走到目标 $B$ 点。卒行走的规则：可以向上、或者向右。同时在棋盘上 $C$ 点有一个对方的马，该马所在的点和所有跳跃一步可达的点称为对方马的控制点，因此称之为「马拦过河卒」。
>
> 棋盘用坐标表示，$A$ 点 $(1,1)$ 、$B$ 点 $(N,M)$ ，同样马的位置坐标是需要给出的。
>
> 现在要求你计算出卒从 $A$ 点能够到达 $B$ 点的路径的条数，假设马的位置是固定不动的，并不是卒走一步马走一步。
>
> **请注意，上述背景内容与本题无关！**

Kiana 喜欢玩象棋，尤其是喜欢用象棋玩过河卒的游戏。在传统的过河卒问题中，Kiana 需要控制一个卒从起点走到终点，在路中避开一个对方的马的攻击，然后假装不会算并询问你从起点到终点的路径总数。

在今天的过河卒二游戏中，Kiana 还是控制一个卒在一个 $N\times M$ 的棋盘上移动，初始时卒位于左下方坐标为 $(1,1)$ 位置，但为了增加难度，Kiana 对游戏规则做出了一些修改。传统的过河卒每步只能向上或向右移动 $1$ 格，Kiana 规定自己的过河卒二还可以在一步中向右上方移动 $1$ 格，即如果当前卒位于坐标 $(x,y)$ 处，则下一步可以走到 $(x+1,y)$ 、$(x,y+1)$ 或 $(x+1,y+1)$ 中的任意一格里面去，同时 Kiana 认为，如果两种移动方案在某一步时卒移动的方向（右、上或右上）不同，则两种方案就是不同的，例如从 $(1,1)$ 先走到 $(1,2)$ 再走到 $(2,2)$ 、从 $(1,1)$ 先走到 $(2,1)$ 再走到 $(2,2)$ 和从 $(1,1)$ 直接走到 $(2,2)$ 是三种不同的移动方案。

其次，过河卒二的终点不再是一个特定的位置，Kiana 规定卒可以从棋盘的上方或右方走出棋盘，此时就视为游戏成功。注意在走出棋盘时仍然有方向选择的不同，例如若过河卒位于 $(1,M)$ 处，则下一步它可以向右或者向右上用两种方式走出棋盘，若过河卒位于 $(N,M)$ 处，则下一步它可以向上、向右或者向右上用三种方式走出棋盘，以不同的方式走出棋盘仍然被算作是不同的移动方案。

此外，对方马的攻击范围不再是有规律的几个位置，而是 Kiana 规定好的 $K$ 个特定坐标，并要求过河卒在移动的过程中不能走到这 $K$ 个坐标的任何一个上，在除这些坐标以外的位置上过河卒都可以按规则自由移动。

现在 Kiana 想知道，过河卒二有多少种不同的移动方案可以走出棋盘，这个答案可能非常大，她只想知道方案数对 $59393$ 取模后的结果。由于她不会算，所以希望由你来告诉她。


## 输入格式

第一行包含三个整数 $N$ 、$M$ 和 $K$ ，分别表示棋盘的坐标范围与对方马的攻击格子数（即 Kiana 规定的不能经过的坐标数）。

接下来 $K$ 行，第 $i$ 行包含两个正整数 $X_i$ 和 $Y_i$ ，表示对方马的第 $i$ 个攻击坐标为 $(X_i,Y_i)$ 。

对于所有数据，保证 $1\leq N\leq 10^9,1\leq M\leq 10^5,0\leq K\leq 20,1\leq X_i\leq N,1\leq Y_i\leq M$，$(1,1)$ 一定不会被对方马攻击，且被攻击的格子中不存在两个坐标相同的格子。
## 输出格式

输出一行一个整数，表示过河卒走出棋盘的方案数对 $59393$ 取模后的结果。


## 样例

### 样例输入 #1
```
3 3 1
2 2
```
### 样例输出 #1
```
24
```
## 提示

### 样例解释

用 $\uparrow$ 表示过河卒向上移动了一格，用 $\rightarrow$ 表示过河卒向右移动了一格，用 $\nearrow$ 表示过河卒向右上移动了一格，由此可以简化样例解释的表述。

$24$ 种移动方案如下：

$(\uparrow\uparrow\uparrow)$、$(\uparrow\uparrow\nearrow)$、$(\uparrow\uparrow\rightarrow\uparrow)$、$(\uparrow\uparrow\rightarrow\nearrow)$、

$(\uparrow\uparrow\rightarrow\rightarrow\uparrow)$、$(\uparrow\uparrow\rightarrow\rightarrow\nearrow)$、$(\uparrow\uparrow\rightarrow\rightarrow\rightarrow)$、$(\uparrow\nearrow\uparrow)$、

$(\uparrow\nearrow\nearrow)$、$(\uparrow\nearrow\rightarrow\uparrow)$、$(\uparrow\nearrow\rightarrow\nearrow)$、$(\uparrow\nearrow\rightarrow\rightarrow)$、

$(\rightarrow\rightarrow\rightarrow)$、$(\rightarrow\rightarrow\nearrow)$、$(\rightarrow\rightarrow\uparrow\rightarrow)$、$(\rightarrow\rightarrow\uparrow\nearrow)$、

$(\rightarrow\rightarrow\uparrow\uparrow\rightarrow)$、$(\rightarrow\rightarrow\uparrow\uparrow\nearrow)$、$(\rightarrow\rightarrow\uparrow\uparrow\uparrow)$、$(\rightarrow\nearrow\rightarrow)$、

$(\rightarrow\nearrow\nearrow)$、$(\rightarrow\nearrow\uparrow\rightarrow)$、$(\rightarrow\nearrow\uparrow\nearrow)$、$(\rightarrow\nearrow\uparrow\uparrow)$。

### 版权信息

来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2019。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2019> 查看。


---

---
title: "[THUPC 2019] 不等式"
layout: "post"
diff: 省选/NOI-
pid: P5381
tag: ['2019', '平衡树', 'Special Judge', 'THUPC']
---
# [THUPC 2019] 不等式
## 题目描述

> 时光回到 2017 年 6 月 7 日。午后，阳光正好。
>
> 现在的你，在考场中笔耕不辍。在刷刷声中，你填写着交给从前和未来的自己的答卷。
> 
> 像无数次训练过的那样，你直接跳到了这张数学试卷的最后一道大题，二选一的题目直接选择了后者。快速地掠过了题目描述，紧缩的眉头渐渐放松。
> 
> 「稳了。」
>
> 你一刻也不敢停留，又向你的梦想靠近了一小步。

已知两个 $n$ 维实向量 $\vec{a}=(a_1,a_2,\dots,a_n),\vec{b}=(b_1,b_2,\dots,b_n)$，定义 $n$ 个定义域为 $\mathbb{R}$ 函数 $f_1,f_2,\dots,f_n$：

$$f_k(x)=\sum_{i=1}^{k} \lvert a_ix+b_i\rvert \quad (k=1,2,\dots,n)$$

现在，对于每个 $k=1,2,\dots,n$，试求 $f_k$ 在 $\mathbb{R}$ 上的最小值。可以证明最小值一定存在。
## 输入格式

第一行一个整数 $n$，表示向量的长度及函数的个数。

接下来两行，每行 $n$ 个整数，分别描述向量 $\vec{a},\vec{b}$ 的各个分量，以空格隔开。

对于所有的输入数据，都满足 $1\le n\le 5\times 10^5,\lvert a_i\rvert ,\lvert b_i\rvert <10^5$。
## 输出格式

输出 $n$ 行，第 $i$（$i=1,2,\dots,n$） 行为一个实数，表示 $f_i$ 在 $\mathbb{R}$ 上的最小值。

输出与标准答案的绝对误差或相对误差小于 $10^{-6}$ 就会被算作正确。
## 样例

### 样例输入 #1
```
2
1 1
1 2
```
### 样例输出 #1
```
0.00000
1.00000
```
## 提示

### 样例解释

$f_1(x)=\lvert x+1\rvert$，显然在 $x=-1$ 处取到最小值 $0$；

$f_2(x)=\lvert x+1\rvert +\lvert x+2\rvert$，可以证明其在 $[-2,-1]$ 中任意位置取到最小值 $1$。

##### 后记

后来，全国三卷的考生们又回想起了被参数方程支配的恐惧。

##### 版权信息

来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2019。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2019> 查看。


---

---
title: "[THUPC 2019] 改善生活"
layout: "post"
diff: 省选/NOI-
pid: P5382
tag: ['2019', 'THUPC']
---
# [THUPC 2019] 改善生活
## 题目描述

「改善生活」是小 Z 创建的一个群聊。在群聊里，小 Z 和他的 $n-1$ 个朋友们（共 $n$ 名群友，小 Z 的编号为 $1$，他的朋友们的编号从 $2$ 至 $n$）无话不说，畅谈甚欢。然而，经常水群会被冠以水王的名号，这让小 Z 头痛不已。

今天，小 Z 预见到了群里可能会有 $n$ 个话题（编号从 $1$ 至 $n$）。其中，第 $i$ 个话题是 $c_i$ 号群友（当然也有可能是小 Z 自己）感兴趣的话题，这意味着该话题如果出现，这位群友将会进行 $w_i$ 分钟的**激烈发言**。方便起见，你可以认为，除此之外，群友不会进行激烈发言。

所有 $n$ 个话题之间有 $m$ 组引导关系，每组引导关系的形式是一个二元组 $\left(u,v\right)$，它表示如果 $u$ 号话题出现，**必定**会导致 $v$ 号话题出现。

巧合的是，小 Z 发现，所有他自己的**不同**话题都不存在**直接或间接**的引导关系。

由于期中考试的临近，除小 Z 外的群友们都忙于复习，因此他们不会主动发起话题（发起话题指让一个话题出现，下同），也就是说，**所有** $c_i\neq 1$ **的话题都只能由引导关系直接或间接引出**。这让想要水群、却又希望摆脱水王名号的小 Z 左右为难。因此，他决定主动发起**一个或以上**的**自己感兴趣**的话题，来诱导其他话题的出现，致使**水群最多的另一位群友激烈发言的时间**与**小 Z 自己激烈发言的时间**的比值尽可能大。即最大化下面这个式子：

$$\frac{\max\limits_{k=2}^n \text{sum}\left(k\right)}{\text{sum}\left(1\right)}$$

其中，$\text{sum}\left(k\right)$ 表示所有**出现**且**群友 $k$ 感兴趣**的话题的 $w$ 值总和。

为避免精度误差，你只需要求出最大值**向下取整**的结果即可。
## 输入格式

第一行两个正整数 $n,m$，分别表示话题数（恰好也是群人数）、引导关系组数。

第二行 $n$ 个正整数 $c_1,\dots, c_n$（$1\leq c_i\leq n$），依次描述对各话题感兴趣的群友编号。保证至少存在一个$i$ 使得 $c_i=1$。

第三行 $n$ 个正整数 $w_1,\dots, w_n$（$1\leq w_i\leq 100$），依次描述各话题感兴趣的群友将激烈发言的时间。

接下来 $m$ 行描述引导关系，每行两个正整数 $u,v$（$1\leq u,v\leq n$），描述一组引导关系 $\left(u,v\right)$，具体意义见【题目描述】，**保证所有不同的 $c_i=1$ 的话题之间两两不存在直接或间接的引导关系**。

对于每一行，如果行内包含多个数，则用单个空格将它们隔开。

保证 $1\leq n\leq 700$，$1\leq m\leq 60000$。
## 输出格式

一行一个**整数**，表示所求式子最大值**向下取整**的结果，即不超过该值的最大整数。
## 样例

### 样例输入 #1
```
7 8
2 2 1 1 3 3 4
100 100 40 20 100 50 40
1 3
2 3
1 4
2 4
3 5
4 6
3 7
4 7
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

小 Z 可以选择发起编号为 3 和 4 的话题，这将致使编号为 5、6、7 的话题出现，并引发 3 号群友时长 $150$ 分钟的激烈发言、以及 4 号群友时长 $40$ 分钟的激烈发言。由于 $3$ 号群友激烈发言时间更长，且小 Z 自己的激烈发言时长为 $60$ 分钟，因此所求最大比值为 $\frac{150}{60}=2.5$，这个值向下取整的结果是 $2$。

可以证明小 Z 不存在更优的策略。

### 版权信息

来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2019。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2019> 查看。


---

---
title: "[THUPC 2018] 组合数问题"
layout: "post"
diff: 省选/NOI-
pid: P5453
tag: ['2018', 'THUPC']
---
# [THUPC 2018] 组合数问题
## 题目背景

**友情提示：本题篇幅较长。**
## 题目描述

众所周知，小葱同学擅长计算，尤其擅长计算组合数。

于是现在我们有了一个 $N\times M$ 的棋盘，棋盘上有些地方会有障碍物的存在。在棋盘上有 $K$ 枚棋子，每枚棋子要么属于红队要么属于蓝队。此外，每枚棋子有两个属性值，第 $i$ 枚棋子的两个属性记为 $a_i,b_i$ 并且保证 $a_i\geq b_i$。既然有了两支队伍那么小葱同学就要来玩游戏，这个游戏一共有 $R$ 个回合。每个回合内，每枚棋子会按照如下顺序进行游戏：

0. 回合开始，记当前是第 $H$ 回合。若现在为游戏的开始时刻，则 $H=1$。

1. 对于所有能够移动的棋子，沿着自己当前的方向移动一格。每枚棋子的朝向一定是上下左右中的一种。如果棋子发现自己不能移动，即前方格子为棋盘外部或者障碍物，那么则不向前移动，而是将自己的方向旋转一百八十度，即进行向后转的操作（注意此时转了之后棋子这回合内并不会进行移动）。

2. 对于所有棋子，每个棋子都拥有且仅拥有一种技能。此时所有棋子按照编号从小到大依次释放技能，如果不能释放技能则跳过。技能总共分为以下几种：

	1. 重锤火花（toolihai）：以自身为中心，制造出绚丽的烟花，令人赏心悦目，无任何效果。

	2. 面子之王（faceking）：该棋子充满了面子，所有棋子都要听其号令，使得所有棋子的方向强制向左（逆时针）转九十度。该技能的效果持续时间为永久。

	3. 头发掉光（onepunch）：头发掉光之后，王队长变得更强了，使该枚棋子的属性大幅度提升。即若当前棋子 $i$ 的属性为 $\left(a_i,b_i\right)$，属性的提升值为 $v$，那么该棋子的属性则变为 $\left(a_i+v,b_i\right)$。该技能的效果能持续 $l$ 个回合，若当前回合为 $H$，则该技能效果会在第 $H+l$ 回合开始的时候消失。若在技能消失前棋子 $i$ 的属性为 $\left(a_i,b_i\right)$，则技能效果消失后其属性会变为 $\left(\max\left(a_i-v,0\right),\min\left(b_i,\max\left(a_i-v,0\right)\right)\right)$。注意再该技能效果消失前该技能可能被再次释放，则多次释放的技能效果叠加，但技能效果消失的时间分开计算。（详见样例第二组数据）

	4. 拉比哩比（rabiribi）：挥动真正的重锤，制造火花，击退前方扇形区域的所有敌方单位。该技能所能影响到的范围为前方大小为 $v$ 的扇形区域，所谓扇形区域可见下图：

        ![](https://cdn.luogu.com.cn/upload/image_hosting/zgtwzsld.png)
		
        从上图我们可以看出，在图的最下方有正在释放技能的棋子，其技能朝向为上，所以其技能方向也为上。则上方的所有区域则为其技能所影响到的扇形区域，该扇形区域大小为 $5$，即 $v=5$。注意到棋盘上某些位置会有障碍物，障碍物的存在会影响到该技能的影响范围。如果一个障碍物存在于技能范围之内，那么以障碍物开始的处于技能范围内的扇形区域也都不会受到技能的影响。如上图可见，所有黑色格子的最下方格子即为障碍物的位置，所有黑色格子即为受到障碍物影响所不能被技能效果影响的格子。
        
        另一方面，击退效果的定义为将受到技能影响效果的棋子沿着技能释放方向强制移动一格，即从图中 $p_2$ 被击退到 $p_3$ 的位置。如果被击退方向是障碍物或者棋盘边界，则按一下规则进行：
        
        - 如果下一位置为障碍物，则被击退到该障碍物后面，即从图中的 $p_0$ 击退到 $p_1$。
        - 如果下一位置为棋盘外部，如当前在第一行并且要被击退到第零行，则被击退到第 $N$ 行对应的同一列的位置。
        
        重复以上过程直到被击退到一个不是障碍物和棋盘外部的位置，则该击退过程结束。（详见样例第一组数据）
	
	5. 退学花火（firework）：退学之后，有了更多的时间来挖坑。使得上一个释放重锤火花的棋子在接下来 $l$ 回合内无法移动。如果不存在这样的棋子，则使自己在接下来 $l$ 回合内无法移动。

	6. 救乌干达（viuganda）：使用vim，拯救阵亡的棋子，复活距离自身最远的阵亡的己方棋子。若己方没有阵亡棋子，则复活对方距离自身最近的阵亡棋子。如果对方也没有阵亡棋子，则什么也不做。我们这里使用的距离为曼哈顿距离，即若第 $i$ 枚棋子处于位置 $\left(x_i,y_i\right)$， 第 $j$ 枚棋子处于位置 $\left(x_j,y_j\right)$，那么此时两枚棋子的距离为 $\left|x_i-x_j\right|+\left|y_i-y_j\right|$。如果同时有多枚棋子距离当前棋子的曼哈顿距离一样，那么我们选择其中编号最大的棋子即可。棋子被复活后如果当前回合可以释放技能并且仍然没有被跳过，则会释放技能。

	7. 降维打击（2dsaigao）：利用超时空武器，向自己右前方发射动感光波，使得某个区域内的单位不能释放技能。该动感光波发射之后，遇到棋盘边缘或者障碍物则会发生方向改变的现象，如下图所示：
	
		![](https://cdn.luogu.com.cn/upload/image_hosting/3j1makll.png)
		
        中间格子为当前棋子所处的位置，其方向向左。每当该光波会进入一个有障碍物的格子或者棋盘边缘的时候，该光波就会改变自己的方向顺时针旋转 $90^\circ$。该光波每从一个格子的中心到达另一个格子的中心时我们称该光波走了 $1$ 的距离。当光波走了 $o$ 的距离之后，光波就会以当前格子为中心发生爆炸，使得所有距离当前格子曼哈顿距离不超过 $v$ 的棋子在接下来 $l$ 回合的时间内都不能释放技能，即从现在到第 $H+l$ 回合开始的这段时间内都不能释放技能。（详见样例第一组数据）
		
	8. 咕咕咕咕（gugugugu）：做人，绝不能普普通通的鸽了别人；要鸽，必须带着大家一起鸽。该技能效果为使得己方所有当前回合还没有释放技能的棋子全部跳过技能释放的环节，即使得己方还未释放技能的棋子当前回合不能释放技能。
	
	9. 反向传播（backward）：让时间暂停，让游戏倒流，让自身回到过去，回到之前的某个回合。若当前为第 $H$ 回合，该技能效果是回到 $l$ 回合前，则当前棋子 $i$ 会回到第 $H-l$ 回合。所谓回到第 $H-l$ 回合，即当前棋子的一下所有值都会变回第 $H-l$ 回合开始的时候的值：
        
        - 位置及方向。
        - 属性。
        - 是否存活以及复活时间。
        - 受到的技能影响的效果以及剩余时间。
        
        注意此时棋子 $i$ 的技能刷新时间并不会回到第 $H-l$ 回合的时间。（详见样例第三组数据）（技能刷新时间的规则会在下面说明）
		
	10. 葱之礼赞（hupraise）：葱的到来，使得今天变为了一个神圣的日子，要将红蓝双方的棋子进行配对。每个红方棋子可以和任何一个蓝方棋子进行配对，并且每个棋子都最多只能和对面一个棋子进行配对。第 $i$ 枚棋子 和第 $j$ 枚棋子能够配对的条件为两个棋子属于不同阵营并且 $a_i\oplus a_j$ 是 $3$ 的倍数（该符号为异或）。现在每当该技能发动时，你需要求出最多能够配多少对。

	**技能刷新规则**：对于所有技能，当前为第 $H$ 回合，如果第 $i$ 枚棋子释放了技能，那么在第 $H+z_i$ 回合的时候该技能才回复完毕，才能再次释放技能。如果第 $i$ 枚棋子在当前回合中了一个持续时间为 $l$ 回合的技能，那么该技能的影响将在第 $H+l$ 回合开始的时候消除。对于所有棋子，若其首轮技能回复时间为 $f_i$，技能回复时间为 $z_i$，则若没有其他棋子的影响，其第一次将在第 $f_i$ 回合释放技能，之后每 $z_i$ 回合再次释放技能。

3. 对于棋盘上所有格子，如果一个格子内既有红队棋子又有蓝队棋子，那么此时这个格子内的棋子便会发生交战。交战的规则如下：

    我们规定第 $i$ 枚棋子的战斗力为 $\binom{a_i}{b_i}$（该式子等价于 $C_{a_i}^{b_i}$）。在交战时，每次由红蓝双方派出己方在这个格子战力最大的棋子进行交战。假设红方派出第 $i$ 枚棋子，蓝方派出第 $j$ 枚棋子。如果红方蓝方两枚棋子战斗力一样，那么派出的两枚棋子均阵亡。若战斗力不一样，假设第 $i$ 枚棋子战力更高，那么第 $j$ 枚棋子阵亡，同时第 $i$ 枚棋子的两个属性变为 $\max\left(a_i-a_j,0\right),\max\left(b_i-a_j,0\right)$。不断重复以上操作直到一方棋子全部阵亡。若第 $i$ 枚棋子在当前回合即第 $H$ 回合阵亡，那么第 $i$ 枚棋子会在第 $H+r_i$ 回合开始的时候复活。第 $i$ 枚棋子复活之后将其两个属性将变为游戏开始时候的属性值，并且移除所有当前棋子身上的技能效果，其移动方向保持阵亡前的移动方向。棋子阵亡期间其技能正常回复，但是不能移动和释放技能，并且不受到其他任何技能的影响。


现在小葱告诉你所有与这游戏相关的东西，希望你按照游戏规则来进行游戏，并输出游戏结束之后每个棋子的位置。
## 输入格式

输入包含多组数据，第一行一个整数 $T$ 表示数据组数。接下来依次描述每组数据，对于每组数据：

* 第一行四个整数 $N,M,K,R$。

* 接下来 $N$ 行每行 $M$ 个数。对于第 $i$ 行第 $j$ 列的数，如果等于 $0$ 则代表第 $i$ 行第 $j$ 列的格子为普通格子，否则为障碍物。

* 接下来 $K$ 行，每行一开始有九个整数 $x_i,y_i,a_i,b_i,c_i,d_i,f_i,z_i,r_i$。代表第 $i$ 枚棋子一开始的位置位于第 $x_i$ 行 第 $y_i$ 列，其属性值为 $a_i,b_i$ 并且所属的阵营为 $c_i$。如果 $c_i=0$ 则为红方否则为蓝方。棋子 $i$ 一开始的朝向为 $d_i$，$d_i=0,1,2,3$ 分别表示上下左右四个方向。$f_i$ 为技能首轮回复时间，$z_i$ 为技能回复时间，即第 $i$ 枚棋子若在没有受到其他棋子影响的情况下，第一次将在第 $f_i$ 回合释放技能，之后每 $z_i$ 回合再次释放技能。$r_i$ 为其复活时间。接下来一个字符串 $s_i$ 为其技能的英文名字，已在每个技能后面注明了其对应的英文名字。对于不同的技能种类，会在当前行增加一定的输入值，具体如下：

	1. 重锤火花（toolihai），无增加的输入。

	2. 面子之王（faceking），无增加的输入。

	3. 头发掉光（onepunch），增加输入 $v_i,l_i$，代表该技能的增益效果和持续时间。

	4. 拉比哩比（rabiribi），增加输入 $v_i$ 代表技能的范围。
		
	5. 平安花火（firework），增加输入 $l_i$ 代表技能的影响时间。

	6. 救乌干达（viuganda），无增加的输入。

	7. 降维打击（2dsaigao），增加输入 $y_i,v_i,l_i$，代表光波能移动的距离、光波爆炸后能影响的范围以及技能的影响持续时间。
			
	8. 咕咕咕咕（gugugugu），无增加的输入。
		
	9. 反向传播（backward），增加输入 $l_i$，表示回到 $l_i$ 回合之前，数据保证不会回到游戏开始之前。
			
	10. 葱之礼赞（hupraise），无增加的输入。

## 输出格式

对于每组数据：

* 每当技能 $10$ 发动时，输出一行一个整数。

* 在游戏结束之后，输出 $K$ 行，每行两个整数代表第 $i$ 枚棋子现在处于哪一行哪一列。
## 样例

### 样例输入 #1
```
4
2 4 4 2
0 0 0 0
0 0 0 1
1 2 1 1 0 2 1 10 1 2dsaigao 1 0 20
2 1 1 1 0 0 1 10 1 faceking
2 1 1 1 0 3 1 10 1 rabiribi 1
1 3 1 1 0 1 1 10 1 toolihai
1 5 4 4
0 0 0 0 0
1 1 2 2 0 3 1 1 100 onepunch 1 2
1 2 1 1 1 0 1 1 100 toolihai
1 3 1 1 1 0 1 1 100 toolihai
1 4 2 1 1 0 1 1 100 toolihai
1 4 1 4
0 0 0 0
1 1 1 1 0 3 3 2 2 backward 2
10 10 10 20
0 0 0 1 0 1 0 0 0 1
0 0 0 0 0 0 0 0 0 1
0 1 0 0 1 0 0 1 0 0
0 0 0 0 0 1 0 0 0 0
0 0 0 0 0 1 0 0 0 1
0 1 0 0 0 0 0 0 0 0
1 0 0 0 1 0 1 0 1 1
0 0 0 0 0 0 0 0 0 1
0 0 1 0 1 1 0 1 0 1
1 0 0 0 0 0 0 0 0 0
10 9 8 0 0 1 6 7 2 viuganda
5 3 10 0 1 1 6 3 7 toolihai
2 7 6 3 0 3 7 3 1 faceking
5 7 10 9 1 3 9 8 8 rabiribi 10
6 10 1 1 0 1 11 7 7 backward 9
2 3 8 5 0 3 2 9 4 onepunch 6 1
1 7 8 2 0 3 11 2 5 hupraise
9 9 4 3 1 3 12 4 9 gugugugu
2 1 10 6 1 2 6 6 2 2dsaigao 9 9 9
10 10 10 5 1 1 12 4 8 firework 4
```
### 样例输出 #1
```
1 1
1 1
2 3
2 1
1 4
1 2
1 3
1 4
1 2
5
10 6
2 5
1 5
5 8
6 10
1 7
1 5
8 9
4 9
8 1
```
## 提示

### 样例解释

对于第一组数据，在左上方释放技能 $7$ 时，是朝着角落里射出的动感光波，所以碰到角落返回回射出点时，此时距离为 $1$，正好原地爆炸，使得技能 $2$ 无法放出。而右下方是在释放技能 $4$ 时，将对方击穿了地图的例子。

对于第二组数据，第一枚棋子每次向右走一步就会释放一次技能。第一回合走到 $(1,2)$，释放技能后属性变为 $(3,2)$，和对方交战后属性变为 $(2,1)$。第二回合走到 $(1,3)$，释放技能后属性变为 $(3,1)$，和对方交战后属性变为 $(3,0)$。第三回合走到 $(1,4)$，由于之前第一回合释放的技能效果消失，属性变回 $(2,0)$，再重新释放技能变为 $(3,0)$，然后被对手痛殴致死。所以最后停留在了 $(1,4)$。

对于第三组数据，该棋子每走两次就会释放技能跳回两回合前的状态，不断循环这样的过程。

### 数据范围

保证 $1\leq T\leq 20$，$1\leq N,M\leq 100$，$1\leq K\leq 200$，$1\leq R\leq 1000$。

保证所有的附加输入除了技能 $3,5,7$ 的影响时间大于 $0$ 以外，剩下均大于等于 $0$。

保证棋子一开始不在障碍物上，一开始以及增幅的属性值均不超过 $1000$（但不保证增幅后的属性超过 $1000$）

保证技能的首轮回复时间、之后的回复时间以及复活时间均大于 $0$。

### 版权信息

来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。


---

---
title: "[THUPC 2018] 弗雷兹的玩具商店"
layout: "post"
diff: 省选/NOI-
pid: P5455
tag: ['2018', 'THUPC']
---
# [THUPC 2018] 弗雷兹的玩具商店
## 题目背景

物是人非事事休，欲语泪先流。

## 题目描述

弗雷兹在 C 市有一个玩具店，店里有 $n$ 种玩具，编号依次为 $1,2,\dots, n$，编号为 $i$ 的玩具的单价为 $c_i$ 元，一个该玩具提供的愉悦度为 $v_i$ 。

突然有一天，C市来了 $m$ 个小朋友。据可靠消息，这些小朋友会在一些时刻一起来店里买东西，其中第 $i$ 个小朋友每次都会带 $i$ 元（ $1\leq i\leq m$ ）。

由于某些玩具特别优秀，所以每次小朋友们都会在特定的编号范围内挑选玩具。

除此之外，由于小朋友们在一年前的清华校赛中就愉悦得无法自拔，所以弗雷兹放弃了对他们的治疗，于是小朋友们就可以无限制地购买玩具了。也就是说，对于任意玩具，每个小朋友在每次的购买件数都可以是任意的非负整数。

时代飞速发展，玩具的受欢迎程度和价格也会随着时代的发展而改变。

为了方便你处理这些信息，Yazid 进行了整理，发现这些日子里，弗雷兹的玩具商店里共发生了 $Q$ 个事件。

对于每个事件，都有 $3$ 个基本参数 $op,l,r$ 。其中 $op$ 为 $1$ 至 $3$ 之间的整数，代表了事件的类别：

1. 对于 $op=1$ 的事件，Yazid 还会给你一个额外参数 $d$ ，表示这是一个**价格调整**事件：将编号在区间 $[l,r]$ 内的玩具的单价 $c$ 全部增加 $d$ 元。为了防止单价超过 $m$ 元导致玩具永远无法被小朋友们购买，弗雷兹会将所有超过 $m$ 的单价减去 $m$。（保证 $d$ 为不超过 $m$ 的正数）

2. 对于 $op=2$ 的事件，Yazid还会给你一个额外参数 $b$ ，表示这是一个**愉悦修正**事件：将编号在区间 $[l,r]$ 内的玩具的愉悦度 $v$ 全部增加 $b$ 。（需要注意这里的 $b$ 可能是负数）

3. 对于 $op=3$ 的事件，表示**购买**事件：所有的 $m$ 个小朋友来到弗雷兹的玩具商店，在编号范围在 $[l,r]$ 内的玩具中进行随意地购买。

现在，对于每一次的购买事件，你想知道：

1. 所有小朋友所能获得的最大愉悦度之和。

2. 所有小朋友所能获得的最大愉悦度的异或和（异或运算是 $\mathrm{xor}$ 运算，即 C++/Java/Python 中的 `^` 运算）。
## 输入格式

* 第 $1$ 行 $2$ 个正整数 $n,m$，分别表示玩具数量、以及小朋友的数量。

* 第 $2$ 行 $n$ 个正整数 $c_1,\dots,c_n$，依次描述各玩具的单价。

* 第 $3$ 行 $n$ 个正整数 $v_1,\dots,v_n$，依次描述各玩具的愉悦度。

* 第 $4$ 行 $1$ 个非负整数 $Q$，表示事件的数量。

* 接下来 $Q$ 行依次描述所有事件，每行描述一个事件。每行的开头是 $3$ 个整数 $op,l,r$，意义见题目描述。

	* 如果 $op=1$，接下来跟随 $1$ 个该事件的额外参数（整数） $d$，意义见题目描述。
	
	* 如果 $op=2$，接下来跟随 $1$ 个该事件的额外参数（整数） $b$，意义见题目描述。
	
	* 如果 $op=3$，接下来无任何额外参数。
	
	* 保证 $1\leq l\leq r\leq n$。

对于每一行，如果包含多个数，则用单个空格将它们隔开。
## 输出格式

* 对于每个购买事件，输出一行 $2$ 个用空格隔开的整数，依次表示所有小朋友所能获得的最大愉悦度之和、以及所有小朋友所能获得的最大愉悦度的异或和。
## 样例

### 样例输入 #1
```
4 10
1 6 10 2
100 2333 666 300
7
3 1 4
3 1 3
1 2 4 1
3 1 4
2 2 3 -1000
2 2 3 -600
3 2 4
```
### 样例输出 #1
```
15165 2865
14165 2169
36630 798
4899 1273
```
## 提示

### 样例解释

对于第 $1$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$100,300,400,600,700,2333,2433,2633,2733,2933$。

对于第 $2$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$100,200,300,400,500,2333,2433,2533,2633,2733$。

对于第 $3$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$666,1332,1998,2664,3330,3996,4662,5328,5994,6660$。

对于第 $4$ 个购买事件，各位小朋友（编号从小到大，即从 $1$ 至 $10$）能够获得的最大愉悦度依次为：$0,0,300,300,300,600,733,733,900,1033$。

根据这些信息，你将很容易计算出答案。

### 数据范围

保证 $1\le n\leq 200,000$，$1\le m\leq 60$，$0\le Q\leq 30,000$。

保证 $1\leq c_i,d\leq m$。

保证 $0\leq v_i\leq 10^7$，$\left| b\right|\leq 10^3$。

### 提示

这个提示本不该有，但善良的出题人还是想提醒你：所有小朋友所能获得的最大愉悦度之和有可能超过 $32$ 位有符号整数的范围。

### 版权信息

来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。


---

---
title: "[THUPC 2019] 大碗宽面"
layout: "post"
diff: 省选/NOI-
pid: P6760
tag: ['贪心', '2019', 'THUPC']
---
# [THUPC 2019] 大碗宽面
## 题目描述

Yazid 喜欢吃大碗宽面。现有 $m$ 碗宽面，其中第 $i$ 碗宽面（$1 \le i \le m$）共包含 $n_i$ 根面条，它们的宽度分别为 $A_{i,1},A_{i,2},\cdots,A_{i,n}$。

记 $f(u,v)$ 表示若混合第 $u$ 碗宽面和第 $v$ 碗宽面，将得到的超大碗宽面的第 $\left\lfloor\dfrac{n_u +n_v +1}{2}\right\rfloor$ 小的面条宽度（$\lfloor x \rfloor$ 表示不超过 $x$ 的最大整数）。

Yazid 想求出所有 $f(u,v)$，但为了节省你的输出时间，你只需要对所有 $1 \le u \le m$ 求出：

- $R(u)=\mathop{\rm xor}\limits_{v=1}^{m} {(f(u,v)+u+v)}$（$\rm xor$ 指异或运算，在 C++ 语言中对应 `^` 运算符）。
## 输入格式

第一行一个正整数 $m$，表示宽面碗数。

接下来 $m$ 行，每行若干个用单个空格隔开的整数描述一碗宽面：这部分的第 $i$ 行的第一个正整数为 $n_i$，表示第 $i$ 碗宽面包含的面条数；接下来 $n_i$ 个非负整数 $A_{i,j}$ 描述各面条的宽度。
## 输出格式

输出 $n$ 行，每行一个整数，其中第 $i$ 行的整数为 $R(i)$。
## 样例

### 样例输入 #1
```
3
3 1 2 3
3 3 4 5
2 4 2
```
### 样例输出 #1
```
4
7
7
```
## 提示

#### 样例说明

对于样例 $1$：

- $\def\x{\operatorname{xor}} R(1) = {(f(1,1)+2)}\x{(f(1,2)+3)}\x{(f(1,3)+4)} = 4\x6\x6 = 4$
- $\def\x{\operatorname{xor}} R(2) = {(f(2,1)+3)}\x{(f(2,2)+4)}\x{(f(2,3)+5)} = 6\x8\x9 = 7$
- $\def\x{\operatorname{xor}} R(3) = {(f(3,1)+4)}\x{(f(3,2)+5)}\x{(f(3,3)+6)} = 6\x9\x8 = 7$

#### 数据规模与约定

对于 $100\%$ 的数据，$m \le 10^4$，$n_i \le 500$，$0 \le A_{i,j} \le 10^9$。

#### 说明

来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2019。

题解等资源可在 https://github.com/wangyurzee7/THUPC2019 查看。


---

---
title: "[THUPC 2021 初赛] 方格游戏"
layout: "post"
diff: 省选/NOI-
pid: P7136
tag: ['2021', 'THUPC']
---
# [THUPC 2021 初赛] 方格游戏
## 题目描述

小 F 和小 H 在玩游戏。今天，他们在一个 $N\times M$ 的棋盘上玩游戏。小 H 想考考小 F 的数学能力，但小 F 天生数学就不好，所以想请你帮忙。为了加大难度，小 $H$ 会在棋盘里面加入 $P$ 个矩形障碍物。每个矩形障碍物用 $U$、$D$、$L$、$R$ 来表示，即在第 $U$ 行到第 $D$ 行以及在第 $L$ 列到第 $R$ 列之间的所有格子都变成了障碍物。小 H 保证所有矩形障碍物互不相交，并且所有非障碍物格子之间都能够直接或者间接互达，若两个非障碍物格子有公共边，那么它们直接互达并且它们的距离为 $1$。

现在每一局游戏中，小 F 在棋盘中挑选一个非障碍物格子 $X$，小 H 也挑另外一个非障碍物格子 $Y$，这一局游戏 $(X,Y)$ 的得分就是 $X$ 到 $Y$ 的最短路径。小 F 需要计算出所有可能的游戏中的得分和，答案模 $1,000,000,007$。注意两局游戏中只要挑选的两个格子相同则视为同一局游戏，即 $(X, Y)$ 等同于 $(Y,X)$。
## 输入格式

第一行三个整数 $N$（$1 \le N \le 1,000,000,000$），$M$（$1 \le M \le 1,000,000,000$），$P$（$0 \le P \le 100,000$）。  
接下来有 $P$ 行，每行四个正整数，$U_i, D_i$（$1 < U_i \le D_i < N$），$L_i, R_i$（$1 < L_i \le R_i < M$），表示第 $i$ 个矩形障碍物。对于任意两个不同的矩形障碍物 $i$ 和 $j$，都满足 $D_i + 1 < U_j$ 或者 $D_j + 1 < U_i$，以及 $R_i + 1 < L_j$ 或者 $R_j + 1 < L_i$。
## 输出格式

只有一行一个正整数，即所有游戏的得分和模 $1,000,000,007$。
## 样例

### 样例输入 #1
```
3 3 1
2 2 2 2

```
### 样例输出 #1
```
64

```
## 提示

**【样例解释 #1】**

距离为 $1$ 的有 $8$ 种。  
距离为 $2$ 的有 $8$ 种。  
距离为 $3$ 的有 $8$ 种。  
距离为 $4$ 的有 $4$ 种。  
总共得分为 $64$。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2021-pre> 查看。


---

---
title: "[THUPC 2021 初赛] 棋盘"
layout: "post"
diff: 省选/NOI-
pid: P7141
tag: ['2021', 'Special Judge', 'THUPC']
---
# [THUPC 2021 初赛] 棋盘
## 题目描述

有一个 $n$ 行 $m$ 列的棋盘，共有 $n m$ 个格子。请你在格子内放入棋子（每个格子可以放入至多一个棋子），使得对于所有 $1 \le i \le m$，第 $i$ 列里恰好包含 $a_i$ 个棋子。另外，棋盘上的任意两颗棋子都不能边相邻。

请判断是否存在一种合法方案。如果存在，请输出任意一个合法方案。
## 输入格式

输入的第一行包含两个正整数 $n, m$，保证 $n \le 300, m \le 300$。  
输入的第二行包含 $m$ 个非负整数 $a_1, a_2, \ldots , a_m$，保证 $0 \le a_i \le n$。
## 输出格式

如果无解，输出一个字符串 `No`。  
如果有解，第一行输出一个字符串 `Yes`，接下来 $n$ 行每行输出一个长度为 $m$ 的字符串，表示你构造的棋盘方案。其中 `0` 表示空格，`1` 表示放入棋子的格子。
## 样例

### 样例输入 #1
```
3 4
2 1 2 1

```
### 样例输出 #1
```
Yes
1010
0101
1010

```
### 样例输入 #2
```
3 4
2 3 3 3

```
### 样例输出 #2
```
No

```
## 提示

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2021-pre> 查看。


---

---
title: "[THUPC 2021 初赛] 狗蛋和二五仔"
layout: "post"
diff: 省选/NOI-
pid: P7144
tag: ['模拟', '2021', 'Special Judge', 'THUPC']
---
# [THUPC 2021 初赛] 狗蛋和二五仔
## 题目背景

**那女孩对我说**  
**代价为十辆铲车**
## 题目描述

小 E 喜欢和老师变换着花样玩牌。最近，他们又发明了一种叫做“狗蛋和二五仔”的玩法。

规则是这样的：

游戏开始时小 E 和老师各有 $30$ 点体力值，手上各有 $2$ 张牌。所有的牌是完全相同的。每个玩家的面前都可以放置牌，开始时双方面前没有任何牌。

双方轮流进行操作。玩家在每个自己的回合开始时先抽一张牌。“抽一张牌”的操作指的是，如果手上的牌的数量小于 $3$ 张，则再抓一张牌放在手上；如果手上恰好有 $3$ 张牌，则不能再抓牌。操作分为 $4$ 种类型。

- 技能。让自己的体力值 $- 2$，然后抽一张牌。
- 攻击。具体地，玩家可以选择一张放在自己面前的**本回合还未攻击过**的牌，选择对方面前的一张牌同归于尽，或者选择一张放在自己面前的**本回合还未攻击过**的牌，让对方的体力值 $- 3$。如果是后者，则将这张选择的牌标记为已攻击。
- 打牌。如果你面前的牌的数量小于 $4$ 张，且手上有牌才能进行此操作。先进行下面的过程 $3$ 次：
  - 随机选择一个角色，让它的体力值 $- 1$。这个角色可以是自己、对方或者某一方面前的一张牌。如果双方场上的牌一共有 $k$ 张，那么选择到任何一个角色的概率为 $\frac{1}{k + 2}$。如果该角色是一张牌且体力值变为了 $0$，那么将它摧毁；如果该角色是一个玩家且体力值变为了 $0$，那么该玩家直接输掉游戏。
  
  在进行完 $3$ 次后将手上的一张牌放在自己面前。牌的体力值为 $2$。这张牌在本回合中被认为已攻击过。
- 结束回合，接下来轮到对方的回合。

一回合中，玩家可以进行多次操作，但是技能和打牌的操作次数**之和**不能超过 $O$。除了结束回合，这些操作没有顺序限制，比如你可以先打一张牌，然后使用技能，然后再打一张牌。在结束回合之前，玩家需要进行至少一次任意的操作才能结束回合。

在任何时刻如果有玩家的体力值小于或等于 $0$，那么该玩家输掉游戏。

游戏进行了几个回合后，现在轮到了小 E 的回合开始前。小 E 想让你帮他分析，如果双方都采用最优策略，那么现在自己赢的概率是多少。
## 输入格式

第一行一个正整数 $T, O$，分别表示数据组数和每回合中技能和打牌的操作次数上限。  
对于每组数据，第一行两个正整数 $E, S$，分别表示小 E 和老师现在的体力值。保证 $1 \le E, S \le 20$。  
第二行一个非负整数 $c$，然后跟着 $c$ 个正整数 $a_1, \ldots , a_c$，表示老师面前有 $c$ 张牌，它们的体力值分别为 $a_1, \ldots , a_c$。保证 $0 \le c \le 4$，$1 \le a_i \le 2$。  
第三行一个非负整数 $p$，然后跟着 $p$ 个正整数 $e_1, \ldots , e_p$，表示小 E 面前有 $p$ 张牌，
它们的体力值分别为 $e_1, \ldots , e_p$。保证 $0 \le p \le 4$，$1 \le e_i \le 2$。  
第四行两个 $[0, 3]$ 之间的非负整数，分别表示老师和小 E 的手牌数。  
在你到来之前老师可能作了弊，你不需要判断输入的情况是否真的是游戏进行了几个回合后的情况。
## 输出格式

对于每组数据输出一行一个实数，表示小 E 在双方采用最优决策时获胜的概率。你的输出的和标准答案的绝对误差不超过 ${10}^{-6}$ 时算作正确。
## 样例

### 样例输入 #1
```
1 5
1 1
0
0
0 1

```
### 样例输出 #1
```
0.500000000

```
### 样例输入 #2
```
1 4
5 14
1 1
1 1
1 0

```
### 样例输出 #2
```
0.041879441

```
## 提示

**【样例解释 #1】**

回合开始，小 E 抽一张牌。此时小 E 手上有 $2$ 张牌，老师手上没有牌，双方的面前都没有牌。双方的体力值均为 $1$。这时，最优策略下，小 E 不能使用技能，因为使用后会因为自己的体力值小于等于 $0$ 而输掉游戏；小 E 不能攻击，因为自己面前没有牌；小 E 也不能结束回合，因为本回合他还没有进行任何操作。所以小 E 的最优策略是打一张牌，这时会随机选到小 E 或者老师中的一个角色，让他体力值 $- 1$ 然后输掉游戏。所以小 E 的获胜概率为 $0.5$。

**【子任务】**

保证 $1\le T\le 351493,3\le O \le 5$ 。

**【后记】**

最后小 E 还是战胜了老师。

**“老师你术士玩多了就知道怎么玩了，你打得还不够多。”**

**“吹牛现在都流行这么吹的吗？兄弟你知道我术士多少胜场嘛，啊？我跟你说全世界没有一个人术士比我胜场多的。”**

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2021-pre> 查看。


---

---
title: "[THUPC 2021 初赛] 独立"
layout: "post"
diff: 省选/NOI-
pid: P7146
tag: ['2021', 'THUPC']
---
# [THUPC 2021 初赛] 独立
## 题目背景

feecle6418 备注：可以认为本题的数据是随机生成的。
## 题目描述

给定一张 $n$ 个点 $m$ 条边的无向图。

对于 $\{1, 2, \ldots , n\}$ 的某个子集 $A$，$A$ 的分数为：

1. 初始分数为 $0$；
2. 对于所有 $i \in A$，分数加 $a_i$；
3. 对于所有边 $(u, v, k)$（代表从 $u$ 到 $v$ 值为 $k$ 的边）满足 $u \in A$ 并且 $v \in A$，分数减 $k$；

现在请你计算出所有的 $A$ 中，分数最高是多少。
## 输入格式

令 $q = 101$，$b = 137$，$p = 1, 000, 000, 007$。

第一行包含六个整数 $n, m, x_0, y_0, a_0, z_0$（$1 \le n \le 100000$，$0 \le m \le \frac n2$，$0 \le x_0, y_0, a_0, z_0 < P$）。

对于 $1 \le i \le n$，有 $a_i = (q \times a_{i - 1} + b) \bmod p$。

对于 $1 \le i \le m$, 有 $x_i = (q \times x_{i − 1} + b) \bmod p$，$y_i = (q \times y_{i − 1} + b) \bmod p$，$z_i = (q \times z_{i − 1} + b) \bmod p$。对于每一组 $(x_i, y_i, z_i)$ 描述了一条连接 $(x_i \bmod n) + 1, (y_i \bmod n) + 1$ 的值为 $z_i$ 的边，如果 $x_i = y_i$ 或者之前出现过连接 $x_i$ 和 $y_i$ 的边，则忽视这条边（即这条边不存在）。
## 输出格式

输出一行一个整数表示最高分数。
## 样例

### 样例输入 #1
```
10 5 1 2 3 4

```
### 样例输出 #1
```
3909327860

```
## 提示

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2021-pre> 查看。


---

---
title: "[THUPC 2021 初赛] 麻将模拟器"
layout: "post"
diff: 省选/NOI-
pid: P7147
tag: ['2021', 'THUPC']
---
# [THUPC 2021 初赛] 麻将模拟器
## 题目描述

麻将是一种休闲的四人博弈游戏。你的任务是写一个模拟器来模拟一局游戏的进程。

接下来将详细介绍游戏规则和每个玩家的决策。注意：为了实现方便和使游戏更加有趣味，这里介绍的规则和主流的几种麻将规则均略有不同。

**基础规则：**

- 一副麻将由 $148$ 张牌组成，其中包含 $37$ 种不同的牌，每种各 $4$ 张。
- 这 $37$ 种牌分别是：一万到九万（`1M ~ 9M`）、一筒到九筒（`1P ~ 9P`）、一索到九索（`1S ~ 9S`）、东（`E`）、南（`S`）、西（`W`）、北（`N`）、白（`B`）、发（`F`）、中（`Z`），以及 $3$ 种特殊牌：跳过（`PASS`），反向（`REVERSE`），双重回合（`DOUBLE`）。
- 游戏共有 $4$ 名玩家，不妨称其为 `A`，`B`，`C`，`D`。
- 游戏开始前，将 $148$ 张牌随机洗乱后摆成一排，称为牌堆。此后玩家摸牌一定是从牌堆中摸取最靠前的一张牌。
- 从 `A` 开始按照 `ABCDABCD...` 的顺序，每人依次从牌堆中摸一张牌，直到每人都有 $13$ 张牌，这些牌组成每个玩家的手牌。
- 再从 `A` 开始按照 `ABCDABCD...` 的顺序，依次进入每人的回合：
- 在一个回合中，玩家先摸一张牌进入自己的手牌，再从自己的手牌中打出一张牌。
- 依次进行直到有人和牌或者无牌可摸时游戏结束。

**特殊牌：**

- 跳过（`PASS`）：在出牌时打出这张牌，可以指定一名玩家，跳过他的下一个回合。
- 反向（`REVERSE`）：在出牌时打出这张牌，反转进行回合的顺序，即由 `ABCDABCD...` 变为 `ADCBADCB...` 或由 `ADCBADCB...` 变为 `ABCDABCD...`。出牌后即按照反转后的顺序，从出牌者原先的上家开始进行回合。
- 双重回合（`DOUBLE`）：在出牌时打出这张牌，该名玩家立即进入一个额外的回合。

**牌型：**&#8203;有如下 $3$ 种牌型：

- 顺子：$3$ 张数字连续的万，或 $3$ 张数字连续的筒，或 $3$ 张数字连续的索，如 `4P 5P 6P`。
- 刻子：$3$ 张完全一样的非特殊牌，如 `B B B`。
- 对子：$2$ 张完全一样的非特殊牌，如 `9M 9M`。

**吃、碰：**

- 当一名玩家打出一张非特殊牌时，其他玩家可以进行吃或碰：
- 吃（`CHOW`）：当打出的这张牌跟自己的手牌中的某两张牌能组成一个顺子时，可以将手牌中能与之组成顺子的其余两张牌取出，与这张牌一起摆在旁边。
- **注意只有上一名出牌玩家的下家（按当前顺序原本应在下一个进行回合的玩家）才能吃。**
- 碰（`PONG`）：当打出的这张牌跟自己的手牌中的某两张牌能组成一个刻子时，可以将手牌中能与之组成刻子的其余两张牌取出，与这张牌一起摆在旁边。
- 碰没有吃的上述限制，任意其他玩家都能碰。
- 如果既有玩家能吃又有玩家能碰，则碰优先于吃。
- 吃（或碰）不是强制性的，也就是说玩家满足吃（或碰）的条件时，可以选择不吃（或碰）。
- 吃和碰统称为副露。为方便起见，不将副露视为手牌的一部分。
- 在任意一名玩家吃（或碰）后，跳过从上一名出牌的玩家到这名玩家之间的所有玩家的回合，直接从当前玩家开始进行新的回合。但该玩家在这一回合中**跳过摸牌直接出牌**，在下一回合（如果没有吃碰的话）恢复正常。
- **注意在本规则中不能杠。**

**胡牌规则：**

- 称一名玩家的牌能和，当且仅当满足如下条件：
  - 牌数为 $14 - 3 n$，其中 $n$ 为该玩家副露（即吃碰）的个数；
  - 这些牌中无特殊牌；
  -  这些牌能够被分成 $(5 - n)$ 组，其中 $(4 - n)$ 组均为 $3$ 张且均为顺子或刻子，其余一组为 $2$ 张且为对子。
- **注意本规则中不支持七对子、十三幺、全不靠等特殊的和牌规则。**
- 另外，定义一组包含 $13 - 3 n$ 张牌的手牌的和牌距离为最小的 $x$，使得向这些牌中加入特定的 $x$ 张牌，再去掉 $x - 1$ 张手牌后，每种牌仍不超过 $4$ 张且能和。
- 定义一组包含 $14 - 3 n$ 张牌的手牌的和牌距离为最小的 $x$，使得向这些牌中加入特定的 $x$ 张牌，再去掉 $x$ 张手牌后，每种牌仍不超过 $4$ 张且能和。
- 特别地，一手能和的牌的和牌距离为 $0$；和牌距离为 $1$ 的牌称为听牌。
- 注意这里的“**每种牌仍不超过** $\boldsymbol{4}$ **张**”的限制：如果一手牌是 `1M 1M 1M 1M` 且副露数为 $3$，再向其中加入一张 `1M` 就能和，但是由于有 $5$ 张 `1M` 所以是不被允许的，故不认为其和牌距离为 $1$。
- 但如果一手牌是 `1M` 且副露数为 $4$，但是曾进行过一次 `1M 1M 1M` 的碰，仍然认为其和牌距离为 $1$（虽然缺的这张 `1M` 永远也等不到）。

**终局：**

- 荣和（`RON`）：当一名玩家出牌后，某名其他玩家的手牌加上这张牌能和，则称这名玩家荣和。荣和优先于吃碰。
- 如果有多名玩家同时达到荣和的标准，规定只有从上一名出牌玩家开始，沿回合进行顺序的第一名能荣和的玩家才能荣和，其余玩家荣和不了，称这种情况为截和。
- 自摸（`SELFDRAWN`）：一名玩家摸牌后其手牌能和，称这名玩家自摸。
- 一旦有一名玩家荣和或自摸，游戏立即结束，该名玩家胜利。
- 如果某名玩家摸牌时发现牌堆中已经无牌可摸，游戏立即结束，称此种情况为流局。

**出牌策略：**&#8203;每名玩家的出牌策略相同且固定：

- 出牌时，若手里有特殊牌一定会优先出，且如果有多种特殊牌，按照 `PASS`、`REVERSE`、`DOUBLE` 的优先顺序；出的 `PASS` 一定指定下家。
- 出牌时若手里没有特殊牌，则会对于每一种可能的出牌方法计算出完牌后的和牌距离，选择和牌距离最小的一种方案。如果有并列最小，按照 `Z`，`F`，`B`，`N`，`W`，`S`，`E`，`9S`，`8S`，……，`1S`，`9P`，……，`1P`，`9M`，……，`1M` 的优先顺序出牌。
- 同一个人能吃且能碰时，优先考虑碰；因为每种牌只有 $4$ 张所以不会有两名玩家同时可以碰的情况；当且仅当吃（或碰）后能使得和牌距离严格减小才会去吃（或碰）；如果有多种吃的方案使得和牌距离严格减小，优先选择数字较大的方案。
-  能荣和一定荣和（除非被截和），能自摸一定自摸，不会拒和（能和时故意选择不和）。
## 输入格式

输入共 $148$ 行，按照牌堆从前到后的顺序输入每一张牌。  
每行输入一个字符串表示这一张牌。  
用 `1M`，`2M`，……，`9M` 代表万，`1P`，`2P`，……，`9P` 代表筒，`1S`，`2S`，……，`9S` 代表索，`E`，`S`，`W`，`N`，`B`，`F`，`Z` 分别代表东、南、西、北、白、发、中，`PASS` 代表跳过，`REVERSE` 表示反向，`DOUBLE` 表示双重回合。
## 输出格式

按照如下几条规则进行输出：

- 当任意一名玩家摸牌时（**包括游戏最开始的摸牌**），输出一行：  
  `x IN y`  
  其中 `x` 为玩家名称，`y` 为摸到的牌。
- 当任意一名玩家出牌时，如果出的牌不是 `PASS`，输出一行：  
  `x OUT y`  
  其中 `x` 为玩家名称，`y` 为出的牌。  
  如果出的牌是 `PASS`，应当输出一行：  
  `x OUT PASS z`  
  其中 `z` 为 `PASS` 指定的对象。
- 当任意一名玩家吃时，输出一行：  
  `x CHOW y1 y2 y3`  
  其中 `x` 为玩家名称，`y1`，`y2`，`y3` 为吃涉及到的 $3$ 张牌，按数字递增的顺序输出。
- 当任意一名玩家碰时，输出一行：  
  `x PONG y1 y2 y3`  
  其中 `x` 为玩家名称，`y1`，`y2`，`y3` 为碰涉及到的 $3$ 张牌，根据碰的规则，`y1`，`y2`，`y3` 应相同。
- 当任意一名玩家荣和时，输出一行：  
  `x RON`  
  其中 `x` 为玩家名称。
- 当任意一名玩家自摸时，输出一行：  
  `x SELFDRAWN`  
  其中 `x` 为玩家名称。
- 游戏的最后，如果某名玩家获得胜利，输出一行：  
  `x WIN`  
  其中 `x` 为玩家名称。  
  如果出现流局，输出一行：  
  `DRAW`

**需要特别注意的是，输入输出中出现的英文字母均为大写。**
## 样例

### 样例输入 #1
```
8M
Z
E
9P
3P
9S
5P
W
3M
8P
DOUBLE
5P
Z
2P
3M
8S
2S
5P
5M
E
6M
9S
6P
5S
7M
4S
3S
6M
3S
2M
9M
5S
Z
7P
5P
8M
3M
F
7M
2S
N
4P
3S
S
PASS
1P
6S
3P
9P
9S
4M
8P
N
Z
N
5M
DOUBLE
REVERSE
S
3P
4M
4S
1S
PASS
4P
6S
7S
7P
6S
9M
REVERSE
3P
7P
DOUBLE
B
9P
4S
5S
7S
7S
7P
6S
9S
B
9M
S
F
2P
1P
PASS
9P
DOUBLE
4P
PASS
5S
2M
2P
6P
W
1M
8S
REVERSE
8M
6M
5M
F
4M
F
8P
2S
1M
2M
3M
7M
3S
B
7S
1S
REVERSE
8P
6M
4S
2M
B
1M
S
6P
5M
W
7M
2S
8S
8M
1S
4P
E
4M
9M
1M
8S
1S
1P
2P
1P
W
6P
N
E

```
### 样例输出 #1
```
A IN 8M
B IN Z
C IN E
D IN 9P
A IN 3P
B IN 9S
C IN 5P
D IN W
A IN 3M
B IN 8P
C IN DOUBLE
D IN 5P
A IN Z
B IN 2P
C IN 3M
D IN 8S
A IN 2S
B IN 5P
C IN 5M
D IN E
A IN 6M
B IN 9S
C IN 6P
D IN 5S
A IN 7M
B IN 4S
C IN 3S
D IN 6M
A IN 3S
B IN 2M
C IN 9M
D IN 5S
A IN Z
B IN 7P
C IN 5P
D IN 8M
A IN 3M
B IN F
C IN 7M
D IN 2S
A IN N
B IN 4P
C IN 3S
D IN S
A IN PASS
B IN 1P
C IN 6S
D IN 3P
A IN 9P
B IN 9S
C IN 4M
D IN 8P
A IN N
A OUT PASS B
C IN Z
C OUT DOUBLE
C IN N
C OUT Z
A PONG Z Z Z
A OUT 9P
B CHOW 7P 8P 9P
B OUT Z
C IN 5M
C OUT N
A PONG N N N
A OUT 3P
B CHOW 3P 4P 5P
B OUT F
C IN DOUBLE
C OUT DOUBLE
C IN REVERSE
C OUT REVERSE
B IN S
B OUT S
A IN 3P
A OUT 3P
D IN 4M
D OUT W
C IN 4S
C OUT E
B IN 1S
B OUT 4S
A RON
A WIN

```
## 提示

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2021-pre> 查看。


---

---
title: "[THUPC 2017] 天天爱射击"
layout: "post"
diff: 省选/NOI-
pid: P7424
tag: ['2017', '树状数组', '可持久化线段树', '可持久化', '分块', '整体二分', 'THUPC']
---
# [THUPC 2017] 天天爱射击
## 题目描述

小 C 爱上了一款名字叫做《天天爱射击》的游戏。如图所示，这个游戏有一些平行于 $x$ 轴的木板。现在有一些子弹，按顺序沿着 $y$ 轴方向向这些木板射去。第 $i$ 块木板被 $S_i$ 个子弹贯穿以后，就会碎掉消失。一个子弹可以贯穿其弹道上的全部木板，特别的，如果一个子弹触碰到木板的边缘，也视为贯穿木板。

小 C 现在知道了游戏中 $n$ 块木板位置，以及知道了 $m$ 个子弹射击位置。现在问你每个子弹射出去以后，有多少木板会碎掉？
## 输入格式

从标准输入读入数据。

第一行两个整数 $n$ 和 $m$，表示木板数量和子弹数量。其中 $1\le n,m\le 2\times 10^5$。

接下来 $n$ 行，每行三个整数 $x_1,x_2,s$，表示每块木板的左端点 $x$ 坐标、右端点 $x$ 坐标，以及贯穿多少次会碎掉。其中保证 $1\le x_1\le x_2\le2\times 10^5,1\le s\le 2\times 10^5$。

接下来 $m$ 行，每行一个整数 ，表示每个子弹的 $x$ 坐标。子弹按照发射顺序给出。其中保证 $1\le x\le2\times 10^5$。
## 输出格式

输出到标准输出。

$m$ 行，每行一个整数。表示每颗子弹射出去后，有多少木板碎掉。
## 样例

### 样例输入 #1
```
3 2
1 3 1
2 4 2
3 4 1
2
3
```
### 样例输出 #1
```
1
2
```
## 提示

![](https://cdn.luogu.com.cn/upload/image_hosting/ocqlbnl3.png)
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。

$\text{upd}2021.7.6$：感谢 @[jiangbowen](https://www.luogu.com.cn/user/366807) 提供的一组 hack 数据，不计分，但若不通过 hack 数据则不算通过此题。


---

---
title: "[THUPC 2017] 机场"
layout: "post"
diff: 省选/NOI-
pid: P7425
tag: ['2017', '图论建模', '费用流', 'THUPC']
---
# [THUPC 2017] 机场
## 题目描述

飞机场有 $a+b$ 个停机位，其中 $a$ 个停机位有登机桥连接飞机和候机厅，乘客可以通过登机桥直接由候机厅登上飞机；另外 $b$ 个停机位没有登机桥和候机厅相连，所以乘客登机需要先搭乘摆渡车再登机。

毫无疑问，搭乘摆渡车的体验是非常差的，所以每位搭乘摆渡车的乘客都会产生不愉快度。

现在，给定每架飞机的乘客数量，登机时间和起飞时间；飞机需要在登机时间点选择一个空闲的停机位，在这个时间点内所有乘客会完成登机，然后飞机会一直停在该停机位，直到起飞时间；

若某飞机在时刻 $x$ 起飞，则在时刻 $x$ 该飞机所在的停机位是空闲的。

飞机场的管理层希望能够尽量减少乘客的不愉快度，为此飞机在登机时间到起飞时间之间，可以切换停机位；

假设某飞机从 $x$ 时间开始由停机位 A 切换到停机位 B，那么停机位 A 在 $x+1$ 时间是空闲的。能进行这样的切换当且仅当停机位 B 在 $x+1$ 时间是空闲的。
## 输入格式

输入有多组数据，第一行一个正整数 $T$ 表示数据组数；对于每组数据：

第一行输入三个非负整数 $n,a,b$，分别表示飞机数量、有登机桥的停机位数量、没有登机桥的停机位数量；

第二行一个浮点数 $p$，输入最多保留小数点后两位；

接下来 $n$ 行，每行三个正整数 $x,s,t$，描述一架飞机的乘客数量、登机时间和起飞时间。
## 输出格式

对于每组数据，输出一行一个整数，表示最小的不愉快度。

如果无法安排一个合理的方案使得所有飞机都完成登机，则输出 `impossible`。
## 样例

### 样例输入 #1
```
2
3 1 1
0.5
1 1 5
1 1 5
1 1 5
6 2 2
0.5
4 1 4
4 2 7
8 4 8
8 4 8
10 5 9
1 7 9
```
### 样例输出 #1
```
impossible
7
```
## 提示

题目中貌似没有给出明确的不愉快度的计算方法，据样例解释推测是不愉快度=所有乘坐摆渡车的人数$+p\times$ 每次切换停机位的飞机上的人数向下取整。
#### 数据范围
$1\le T\le 8,1\le n\le 200,0\le p\le1,1\le x\le 10^5,1\le s\le t\le10^9$
#### 样例解释
飞机从 $1$ 开始编号

在时刻 $1$，$1$ 号飞机安排到登机桥 A，乘客开始登机；目前 $1$ 号飞机在登机桥 A。

在时刻 $2$，$2$ 号飞机安排到登机桥 B，乘客开始登机；目前 $1$ 号飞机在登机桥 A，$2$ 号飞机在登机桥 B。

在时刻 $3$，$2$ 号飞机切换到摆渡车 A，此时登机桥 B 尚不可用。

在时刻 $4$，$1$ 号飞机起飞，$2$ 号飞机到达摆渡车 A， 号飞机安排到登机桥 A，$3$ 号飞机安排到登机桥 B，$4$ 号和 $3$ 号的乘客开始登机，登机完成之后 $4$ 号飞机切换到摆渡车 B，此时登机桥 A 和登机桥 B 都不空闲。

在时刻 $5$，$3$ 号飞机到达摆渡车 B，登机桥 A 变为可用，$5$ 号飞机安排到登机桥 A，开始登机；目前 $5$ 号——登机桥 A，$4$ 号——登机桥 B，$3$ 号——摆渡车 B，$2$ 号——摆渡车 A。

在时刻 $7$，$2$ 号飞机起飞，$6$ 号飞机安排到摆渡车 A。

不愉快度为 $7=1$（$6$ 号飞机乘客乘摆渡车）$+4\times 0.5$（$2$ 号飞机切换停机位）$+8\times 0.5$（$3$ 号飞机切换停机位）
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "[THUPC 2017] 气氛"
layout: "post"
diff: 省选/NOI-
pid: P7429
tag: ['计算几何', '2017', '线性代数', '高斯消元', 'THUPC']
---
# [THUPC 2017] 气氛
## 题目描述

北大街，在中国是一个非常常见的地名，比较著名的有上海北大街，西安北大街，成都北大街，太原北大街，中关村北大街等。

我们都知道，北的意思是自由民主，大的意思是兼收并蓄，所以住在北大街的人也性情迥异，我们假设在北大街住了 $n$ 个人。

有人向住在北大街的这 $n$ 个人提了 $n-1$ 个问题，比如：

「用不用筷子？」

「吃不吃红烧肉？」

「写代码用 tab 还是 space」

「大括号换不换行？」

「……」

根据每个人的回答，他会被分配一个 $n-1$ 维的零一坐标，也就是一个点。这样 $n$ 个点可以恰好构成一个 $n-1$ 维空间中的凸包。

北大街的居民认为，在这个多面体内，便是华夏；多面体之外，便是蛮夷。我们可以很容易的计算出华夏部分的广义凸包体积。

有一天，清华路的 B 君来北大街玩，听说了这个故事觉得很有趣，于是也试着给出了这 $n-1$ 个问题的答案，

清华路的 B 君，当然认为自己属于华夏，但是北大街表示在 $n-1$ 维空间中如果有 $n+1$ 个点的话，华夏部分的体积难以计算。

这下子气氛突然僵化。所以这个问题就留给你了，输入 $n-1$ 维度空间中的 $n+1$ 个点，求广义凸包的体积。

由于这个体积可能不是整数，你只需要输出体积乘以 $n-1$ 的阶乘，然后对 $10^9+7$ 取模的结果。
## 输入格式

从标准输入读入数据。

第一行一个整数 $T$ 表示组数，接下来是 $T$ 组数据

每组数据的第一行是一个整数 $n$ 。

接下来 $n+1$ 行，每行 $n-1$ 个整数，表示在 $n-1$ 维空间中的一个点。
## 输出格式

输出到标准输出。

对于每组数据，输出一行一个整数表示答案。

输入 $n+1$ 个点的凸包体积乘以 $n-1$ 的阶乘，然后对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
1
3
0 0
0 1
1 0
1 1
```
### 样例输出 #1
```
2
```
## 提示

$1\le t\le 100,3\le n\le35$

点的坐标一定是 $0$ 或者 $1$。
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "[THUPC 2017] 组合数问题"
layout: "post"
diff: 省选/NOI-
pid: P7430
tag: ['数学', '2017', '二分', 'Special Judge', 'THUPC']
---
# [THUPC 2017] 组合数问题
## 题目描述

小葱是一名勇士。

小葱踏上了拯救世界的征途。

小葱面前有 $N$ 只大葱怪。

大葱怪很厉害，第 $i$ 只大葱怪攻击力为 $a_i$，防御力为 $d_i$。

小葱的攻击力为 $A$，防御力为 $D$。

小葱打掉第 $i$ 只大葱怪的代价是 $A\times d_i+D\times a_i$。

小葱打倒很多只大葱怪的代价不是打倒每一只大葱怪的代价之和，而是最大值。

小葱现在需要打倒 $R$ 只大葱怪。

神葱是葱的神，神葱会对小葱打倒 $R$ 只大葱怪做出评价。神葱对小葱打倒 $R$ 只大葱的评价为小葱打倒这 $R$ 只大葱怪所需要的代价除以小葱以同样的攻击力和防御力打倒所有 $N$ 只大葱怪的代价。

神葱是葱的神，所以神葱会在小葱选择了 $R$ 只要被打倒的大葱怪后，设定小葱的攻击力和防御力，使得小葱得到的评价最低。

神葱不希望这个值是负的，所以如果这个值是负的，神葱会强制把它变为 $0$。

小葱是一名勇士。

小葱不会屈服。

小葱需要选择出 $R$ 只大葱怪，使得自己能够从神葱那里得到的评价最高。

小葱求这个评价值。

小葱很善良，所以小葱为你写出了评价值的数学表示：
$$\max_{S\subseteq [N],|S|=R}\Big\lbrack\min_{A,D\in\Z^+}\dfrac{\max_{i\in S}(A\times d_i+D\times a_i)}{\max_{i\in [N]}(A\times d_i+D\times a_i)}\Big\rbrack$$
## 输入格式

测试点包含多组数据。

对于每组数据，第一行两个整数代表 $N,R$。

接下来 $N$ 行每行两个实数分别代表 $a_i,d_i$。
## 输出格式

对于每组数据，一行一个实数代表答案，你需要保证你的答案与标准答案的误差不超过 $10^{-6}$。
## 样例

### 样例输入 #1
```
3 3
1 3
2 5
2 3
5 1
1 5
2 4
3 3
4 2
5 1
```
### 样例输出 #1
```
1.000000
0.600000
```
## 提示

$1\le R\le N\le 10^3,a_i,d_i$ 均为正整数，数据组数不超过 $50$ 组，所有攻击力和防御力都是正整数。
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "[THUPC 2017] 小 L 的计算题"
layout: "post"
diff: 省选/NOI-
pid: P7431
tag: ['2017', '分治', '快速傅里叶变换 FFT', '快速数论变换 NTT', 'THUPC']
---
# [THUPC 2017] 小 L 的计算题
## 题目描述

现有一个长度为 $n$ 的非负整数数组 $\{a_i\}$ 。小 L 定义了一种神奇变换：
$$f_k=\left(\sum_{i=1}^na_i^k\right)\bmod 998244353$$
小 L 计划用变换生成的序列 $f$ 做一些有趣的事情，但是他并不擅长算乘法，所以来找你帮忙，希望你能帮他尽快计算出 $f_{1\dots n}$。
## 输入格式

输入包含多组数据。

输入的第一行包含一个整数 $T$ , 表示数据组数。

接下来 $2T$ 行，每两行代表一组测试数据。

每组数据的第一行包含一个整数 $n$，表示数组 $\{a_i\}$ 的长度。接下来一行 $n$ 个整数，描述数组 $\{a_i\}$。

保证输入的 $a_i$ 满足 $0\le a_i\le10^9$。在一个测试文件中，保证有 $\sum n\le 4\times 10^5$。
## 输出格式

我们不想让你输出过多的数。因此，令 $ans=\bigoplus_{i=1}^{n}f_i$，其中 $\bigoplus$ 表示**异或**操作，在 C++ / Java / Python 中，它可以表示为 `^`。

对每组数据，你需要输出一行一个整数，表示 $ans$。
## 样例

### 样例输入 #1
```
2
3
2 3 3
5
1 2 3 4 5
```
### 样例输出 #1
```
32
4675
```
## 提示

对于 $100\%$ 的数据，$0\le a_i\le10^9$，$1\le n\le 2\times 10^5$，$\sum n\le 4\times 10^5$。

#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "[THUPC 2017] 钦妹的玩具商店"
layout: "post"
diff: 省选/NOI-
pid: P7432
tag: ['动态规划 DP', '2017', 'O2优化', '背包 DP', '分块', 'THUPC']
---
# [THUPC 2017] 钦妹的玩具商店
## 题目描述

钦妹和弗雷兹在 C 市有一个玩具店，店里有 $n$ 种玩具，编号依次为 $1,2,...,n$，第 $i$ 件玩具的单价为 $c_i$ 元，一个该玩具提供的愉悦度为  $v_i$。

突然有一天，C 市来了 $m$ 个小朋友。据可靠消息，接下来 $Q$ 天，这些小朋友每天都会来店里买东西，其中第 $i$ 个小朋友每天都会带 $i$ 元  （$1\le i\le m$）。

由于某些玩具不是很优秀，所以每天都会有不同的玩具被禁止出售给小朋友。具体来说，在第 $i$ 天，编号在区间 $[l_i,r_i]$ 内的物品小朋友是不能购买的。

除此之外，为了防止小朋友们太愉悦，每件玩具都有一个限购件数  $t_i$。也就是说，对于第 $i$ 种玩具，每个小朋友在每一天的购买件数都必须为不超过 $t_i$ 的非负整数。

现在，对于每一天，你想知道：所有小朋友所能获得的最大愉悦度之和（对 $10^8+7$ 取模）；所有小朋友所能获得的最大愉悦度的异或和（异或运算是 $\operatorname{xor}$ 运算，即 C++/Java/Python 中的 `^` 运算）。

本题强制在线，具体规则在输入描述中体现。
## 输入格式

从标准输入读入数据。

输入包含多组数据。第一行有一个整数  $T$，表示测试数据的组数，对于每组数据：

第一行输入三个整数 $n,m,Q$ 分别表示玩具数目、小朋友的数目以及天数。

第二行 $n$ 个非负整数，分别描述每件玩具的单价  $c_1,c_2,...,c_n$。

第三行 $n$ 个非负整数，分别描述每件玩具的愉悦度 $v_1,v_2,...,v_n$ 。

第四行 $n$ 个非负整数，分别描述每件玩具的限购次数  $t_1,t_2,...,t_n$。

第五行到第 $Q+4$ 行，每行两个描述区间的参数  $x,y$。第  行和前一天的答案共同描述了第 $i$ 天禁止购买的编号区间，假设前一天的最大愉悦度之和为 $\operatorname{lastans}$ ，那么当天的 $l_i,r_i$ 满足下式：
$$l_i=\min((x+\operatorname{lastans}-1)\bmod n+1,(y+\operatorname{lastans}-1\bmod n+1))$$
$$r_i=\max((x+\operatorname{lastans}-1)\bmod n+1,(y+\operatorname{lastans}-1\bmod n+1))$$
在第一天时，我们认为 $\operatorname{lastans}=0$ 。保证  $1\le x,y\le n$。
## 输出格式

输出到标准输出。

对于每一组数据，输出 $Q$ 行，每行 $2$ 个整数，依次表示所有小朋友能够获得的最大愉悦度之和（对 $10^8+7$ 取模）以及异或和。
## 样例

### 样例输入 #1
```
2
3 10 3
2 3 3
20 50 24
3 1 10
1 1
2 2
3 3
2 7 3
6 7
1 2
1 1
1 1
2 2
1 2
```
### 样例输出 #1
```
568 120
660 20
660 20
2 2
2 0
0 0
```
## 提示

对于所有的数据，$1\le n,m,Q,c_i,t_i\le 10^3$，$1\le v_i\le 2.5\times 10^5$，$\sum n,\sum m,\sum Q\le 10^4$。
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "[THUPC 2021] 鬼街"
layout: "post"
diff: 省选/NOI-
pid: P7603
tag: ['2021', 'O2优化', 'THUPC']
---
# [THUPC 2021] 鬼街
## 题目描述

那条街有“鬼街”之称,十年前是 A 市最繁华的地段之一，然而如今这里已无活人居住。

街边七零八落地排着 $n$ 座房子，每栋房子都有一个 $1$ 到 $n$ 之间的独一无二的编号，用仿佛来自地狱的黑漆涂在破瓦残砖上，在黄尘中隐隐若现。

传说，这条街上的鬼是与别处的鬼是不同的，它们喜欢研究数论，会根据数字的性质来选择自己的生活，所以它们才为每一栋房子都画上了编号。

新上任的 A 市市长并不相信魑魅魍魉的传言，为了探清真相，他决定为这条街装上灵异事件监控器。

下面有 $m$ 个事件依次发生。

- 灵异事件：在以 $x$ 的所有质因子为编号的房子里，都发生了 $y$ 次闹鬼。由于神秘的原因，次数 $y$ 可能为 $0$。
- 监控事件：有一个监控器被安装，其监控以 $x$ 的所有质因子为编号的房子，当累计的闹鬼总次数达到阈值 $y$ 时，该监控器会触发报警（若 $y = 0$，则不论被监控的房子是哪几栋，下一次灵异事件都会立即触发该监控器的报警）。不同房子发生的灵异事件次数会被分开统计，不同的监控器互不影响。所有的监控器被从 $1$ 开始依次编号。

请将所有的报警反馈给市长，即每个灵异事件之后，有哪些监控器被触发。
## 输入格式

输入的第一行依次包含两个正整数 $n$ 和 $m$，保证 $1 < n, m \le {10}^5$。

接下来 $m$ 行，每行依次包含三个非负整数 $op$，$x$ 和 $y'$。其中 $op \in \{ 0, 1 \}$，若 $op$ 为 $0$，表示这是一个灵异事件；若 $op$ 为 $1$，表示这是一个监控事件。保证 $1 < x \le n$，$0 \le y' < 2^{32}$。由于神秘的原因，你无法直接得到真实的 $y$，假设 $k'$ 为上一个灵异事件触发的监控器的数量（如果尚未有灵异事件发生，则 $k'$ 为 $0$），真实的 $y$ 为 $y' \oplus k'$。$x$ 和 $y$ 在每个事件中的具体含义如上所述。
## 输出格式

对于每一个灵异事件，依次输出一行。行首是一个非负整数 $k$，表示这个灵异事件触发的报警数量，之后是 $k$ 个从小到大排列的整数，表示触发的监控器的编号。
## 样例

### 样例输入 #1
```
20 9
1 10 2
0 5 0
0 6 1
0 7 1
0 15 1
1 12 3
0 8 0
1 5 0
0 8 2

```
### 样例输出 #1
```
0
0
0
1 1
0
2 2 3

```
## 提示

**【样例解释】**

在本样例中，依次发生了以下事件：

- 安装了 $1$ 号监控器，监控编号为 $2$ 和 $5$ 的房子，报警阈值为 $2$。
- 发生了一次灵异事件，$5$ 号房子似乎有闹鬼，但次数为 $0$，没有报警被触发。
- 发生了一次灵异事件，$2$ 号和 $3$ 号房子发生了 $1$ 次闹鬼。$1$ 号监控器上的累计次数达到了 $1$，但尚未触发报警。
- 发生了一次灵异事件，$7$ 号房子发生了 $1$ 次闹鬼，没有报警被触发。
- 发生了一次灵异事件，$3$ 号和 $5$ 号房子发生了 $1$ 次闹鬼。$1$ 号监控器的累计次数达到阈值 $2$，触发报警。
- 安装了 $2$ 号监控器，监控编号为 $2$ 和 $3$ 的房子，报警阈值为 $2$。
- 发生了一次灵异事件，$2$ 号房子发生了 $1$ 次闹鬼。$2$ 号监控器的累计次数达到了 $1$，但尚未触发报警。
- 安装了 $3$ 号监控器，不过其阈值为 $0$，所以下一次灵异事件必会触发其报警。
- 发生了一次灵异事件，$2$ 号房子发生了 $2$ 次闹鬼。$2$ 号监控器的累计次数达到了 $3$，超过了其报警阈值 $2$，所以被触发了报警。同时 $3$ 号监控器的报警也被触发。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_0/tree/master](https://github.com/yylidiw/thupc_0/tree/master) 查看。


---

---
title: "[THUPC 2021] 形式语言与自动机"
layout: "post"
diff: 省选/NOI-
pid: P7604
tag: ['2021', 'O2优化', 'THUPC']
---
# [THUPC 2021] 形式语言与自动机
## 题目背景

《形式语言与自动机》是 T 大学 C 系开设的一门专业基础课，在这门课程中，你能学到“常用语言类及其相应的计算模型，以及计算模型之间的联系”。这门课程涉及到不少较为晦涩难懂的理论知识；但对于你的好朋友，曾经在国际比赛中捧杯的小 A 来说，它似乎有些太简单了。
## 题目描述

不知道为什么，小 A 虽然上课总在做自己的事情，但是每次布置的作业他用了十几分钟就做完了。你很好奇小 A 为什么这么熟练，但眼下，小 A 上课做的事情似乎更吸引你。

“你每周上课都不认真听，是在做什么？”

“我觉得老师上课讲得还挺水的，就随便做点东西玩玩。不过充其量也就是跟课程相关的吧，随便设计点自动机什么的，测试一下它能接受什么状态。”小 A 盯着他电脑前的草稿纸说道。

过了一会，小 A 看到他屏幕上出现了一堆圆括号。你猜想他可能是设计了一个判断括号序列是否匹配的自动机。但正当你准备和小 A 搭话时，他突然指着屏幕对你说：“你说说这合理吗，我本来输了一个测试用的括号序列，结果手一滑，把光标蹭到了奇怪的地方。我就想着怎么看半天没看出来程序哪里有问题，原来是我输错了。”

你苦笑着回复说：“这不常有的事吗，反正知道问题在哪就好了。”

没想到，这句话反而让小 A 更烦躁了。

“你说常有，那我给你这个串，你试试有多少种方法把它变回一个合法的括号序列。”

诚然，你不是不会算，但是你更想听课。可惜，你没来得及打断小 A 的下一句话。

“那就这么说定了，你要是下课前没算出来，请我吃香锅。”
## 输入格式

输入仅包括一个串 $s$，表示小 A 实际输入的串。保证 $s$ 仅包括 `(` 和 `)`，且二者数量相等。
## 输出格式

输出一个整数，表示**本质不同**的还原方案的个数。

我们定义一种方案可以还原一个括号序列 $s=s_1 s_2 \cdots s_n$，当且仅当存在一个划分 $s=uvw$ 使得 $uwv$ 是合法的括号序列。其中，$u=s_1\cdots s_l$ 可以为空串（此时 $l=0$），但 $v=s_{l+1}\cdots s_r$ 和 $w=s_{r+1}\cdots s_n$ 不是空串。我们称两种还原方案**本质不同**，当且仅当两种方案中的 $l$ 不相同或 $r$ 不相同；即使两种还原方案还原出的串相同，这两种还原方案也可能本质不同。
## 样例

### 样例输入 #1
```
()()()
```
### 样例输出 #1
```
6
```
## 提示

**【样例解释】**

所有可能的还原方案为（其中箭头前后分别为 $s=u+v+w$ 和 $uwv$）：

1. $l=0,r=2$，对应 $\varepsilon$（空串，下同）$+$`()`$+$`()()` $\Rightarrow$ `()()()`；
2. $l=0,r=4$，对应 $\varepsilon+$`()()`$+$`()`$\Rightarrow$`()()()`；
3. $l=1,r=2$，对应 `(`$+$`)`$+$`()()`$\Rightarrow$`(()())`；
4. $l=1,r=4$，对应 `(`$+$`)()`$+$`()`$\Rightarrow$`(())()`；
5. $l=2,r=4$，对应 `()`$+$`()`$+$`()`$\Rightarrow$`()()()`；
6. $l=3,r=4$，对应 `()(`$+$`)`$+$`()`$\Rightarrow$`()(())`。

这些划分方案中，方案 $1,2,5$ 还原出的串和输入的串相同，但这并不影响它们划分的方式不同。

另外，`()()`$+$`()`$+\varepsilon$ 和 `()()`$+\varepsilon+$`()` 都不是合法的还原方案，因为在前一种划分中 $w=\varepsilon$，而在后一种划分中 $v=\varepsilon$。

**【数据范围】**

对于 $100\%$ 的数据，保证 $1\le |s| \le 10,000,000$。

**【提示】**

你不需要掌握《形式语言与自动机》这门课程的相关知识也能通过本题。

另外，《形式语言与自动机》这门课程“很简单”的说法只是本题中虚构人物小 A 的看法，不代表出题人的意见。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_0/tree/master](https://github.com/yylidiw/thupc_0/tree/master) 查看。


---

---
title: "[THUPC 2021] 小 E 爱消除"
layout: "post"
diff: 省选/NOI-
pid: P7605
tag: ['2021', 'O2优化', '区间 DP', 'THUPC']
---
# [THUPC 2021] 小 E 爱消除
## 题目描述

管道中塞着 $n$ 个彩色的球。这些球的直径相同。从一端到另一端它们的颜色分别为 $c_1,c_2,\ldots,c_n$。

小 E 有一个空的杯子。杯口的直径恰好比球的直径大一些，所以小 E 可以把球放入杯子中，但一次只能放入一个，并且球在杯子中只能竖直叠放。杯子中两个相邻的同色球会一起消失。

由于管道的特殊性，小 E 每次只能选择管道的一端，将最靠外的球取出，然后马上放进杯子里。

问当管道中的球全部取出后，杯子里最少会剩下几个球，以及在此前提下至少需要多大的杯子。
## 输入格式

第一行一个正整数 $n$。

第二行 $n$ 个正整数，第 $i$ 个表示 $c_i$。
## 输出格式

输出一行，包含两个非负整数。第一个数表示杯子里剩下球数的最小值。第二个数表示在此前提下杯子需要至少能装下多少个球。
## 样例

### 样例输入 #1
```
12
3 5 1 4 9 3 3 5 1 4 9 3

```
### 样例输出 #1
```
0 5

```
## 提示

**【样例解释】**

一种最优的方案如下：

先将两端的 $3$ 放入杯子中消去。

然后把左端的 $5,1,4,9$ 依次放入杯子，这时杯子中有 $4$ 个球。

再把右端的 $9,4$ 依次放入杯子，每放入一个球就会和杯子里的另一个球消去。在放入 $9$ 后消去前杯子中有 $5,1,4,9,9$，所以杯子需要能够容纳 $5$ 个球。

接着把左端的 $3,3$ 放入杯子，这时被杯子中有 $2$ 个球。

最后把右端的 $1,5$ 依次放入杯子。这时杯子是空的。

图片可见下发文件中的 `Sampledescription.pptx`。

**【数据范围】**

保证 $1 \le n \le 50$，$1 \le c_i \le n$。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_1/tree/master](https://github.com/yylidiw/thupc_1/tree/master) 查看。


---

---
title: "[THUPC 2021] 混乱邪恶"
layout: "post"
diff: 省选/NOI-
pid: P7606
tag: ['2021', 'O2优化', '背包 DP', '随机化', 'THUPC']
---
# [THUPC 2021] 混乱邪恶
## 题目背景

出题人分为 $9$ 种阵营：守序善良、守序中立、守序邪恶、中立善良、绝对中立、中立邪恶、混乱善良、混乱中立和混乱邪恶。真正的出题人，就要能够在阵营之间不断切换，而又不迷失在境界之中。

境界是一个无限大的三角形网格。网格如下图，每个交叉点都有 $6$ 个相邻的交叉点。你从某一个交叉点出发，每次给一个出题 idea 设定风格都会使你在境界中移动一步。

![](https://cdn.luogu.com.cn/upload/image_hosting/dwgwh04i.png)
## 题目描述

每个出题人都有一个守序指数 $L$ 和善良指数 $G$。对于一个 idea，从题面、样例或数据范围的角度，可以从 $6$ 个方向中选择恰好一个作为这个 idea 对应的题目的特有风格，同时会在境界中沿着所选的箭头方向移动一步：

![](https://cdn.luogu.com.cn/upload/image_hosting/5k7jqygw.png)

你现在一共有 $n$ 个 idea，你知道你给每个 idea 设定某一个风格时你的 $L$ 指数和 $G$ 指数的变化。具体地，对于第 $i$ 个idea有 $12$ 个参数 $tl_{i,l},tl_{i,g},l_{i,l},l_{i,g},bl_{i,l},bl_{i,g},br_{i,l},br_{i,g},r_{i,l},r_{i,g},tr_{i,l},tr_{i,g}$：

如果选择“简洁的题面”，那么 $L$ 变成 $L+tl_{i,l}$，$G$ 变成 $G+tl_{i,g}$；

如果选择“平凡无用的样例”，那么 $L$ 变成 $L+l_{i,l}$，$G$ 变成 $G+l_{i,g}$；

如果选择“宽松的数据范围”，那么 $L$ 变成 $L+bl_{i,l}$，$G$ 变成 $G+bl_{i,g}$；

如果选择“复杂的题面”，那么 $L$ 变成 $L+br_{i,l}$，$G$ 变成 $G+br_{i,g}$；

如果选择“无私馈赠的样例”，那么 $L$ 变成 $L+r_{i,l}$，$G$ 变成 $G+r_{i,g}$；

如果选择“松松松的数据范围”，那么 $L$ 变成 $L+tr_{i,l}$，$G$ 变成 $G+tr_{i,g}$。

这里所有的加法都在模 $p$ 意义下进行。

进入混乱邪恶阵营的要求很苛刻，需要 $L$ 恰好等于 $L^*$ 且 $G$ 恰好等于 $G^*$。

你的 $L$ 指数和 $G$ 指数开始时都为 $0$。请问是否存在一种设定风格的方式使得设定完全部 $n$ 个 idea 的风格后你仍在境界中原来的位置，但是能够进入混乱邪恶阵营。
## 输入格式

第一行两个正整数 $n,p$。

接下来 $n$ 行，每行 $12$ 个非负整数 $tl_{i,l},tl_{i,g},l_{i,l},l_{i,g},bl_{i,l},bl_{i,g},br_{i,l},br_{i,g},r_{i,l},r_{i,g},tr_{i,l},tr_{i,g}$。参数的顺序与题目描述中的一致，无需额外检查。

最后一行两个非负整数 $L^*,G^*$。
## 输出格式

如果能，输出一行 `Chaotic Evil`。

如果不能，输出一行 `Not a true problem setter`。
## 样例

### 样例输入 #1
```
3 10
3 5 1 4 9 3 0 0 0 0 0 0
0 0 0 0 0 0 3 5 1 4 9 3
3 5 1 4 9 3 3 5 1 4 9 3
3 2

```
### 样例输出 #1
```
Chaotic Evil

```
## 提示

**【样例解释】**

给第 $1$ 个 idea 设定风格为”简洁的题面“，此时你的守序指数为 $0+3=3$，善良指数为 $0+5=5$。你往左上方移动一步。

给第 $3$ 个 idea 设定风格为”宽松的数据范围“，此时你的守序指数为 $3+9=2$，善良指数为 $5+3=8$。你往左下方移动一步。

给第 $2$ 个 idea 设定风格为”无私馈赠的样例“，此时你的守序指数为 $2+1=3$，善良指数为 $8+4=2$。你往右边移动一步。此时你回到了原点并且守序指数为 $3$，善良指数为 $2$。所以你可以进入混乱邪恶阵营。

**【数据范围】**

保证 $1 \le n \le 100$，$1 \le p \le 100$。

保证其他输入数据在 $0$ 到 $p-1$ 之间。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_1/tree/master](https://github.com/yylidiw/thupc_1/tree/master) 查看。


---

---
title: "[THUPC 2021] 赌徒问题"
layout: "post"
diff: 省选/NOI-
pid: P7607
tag: ['2021', 'O2优化', 'THUPC']
---
# [THUPC 2021] 赌徒问题
## 题目描述

国籍不明，年龄不详的赌徒 Picar 和 Roman 正在玩一个游戏。

正如一些经典的和赌博相关的问题中提到的那样，这个游戏是纯随机的。

每一轮游戏中，参加游戏的赌徒需要先选定一个要下注的号码，并将要下注的金额支付给系统（不妨记游戏中使用的货币单位为 G）。选择的号码可以是 $1$ 至 $n$ 之间的任意整数（$n$ 是固定的正整数），其中号码 $i$ 对应正整数权重 $a_i$。记 $s=\sum_{i=1}^n a_i$，那么系统在每轮游戏中选出号码 $i$ 的概率总为 $a_i/s$。所有参加游戏的赌徒下注结束之后，系统将会按照给定的概率随机挑选一个号码作为中奖号码。下注了中奖号码的赌徒可以根据其下注的金额及中奖号码对应的概率获得相应的奖金，而下注了其它号码的赌徒不会获得任何奖金。

至于返还奖金的比例，一个自然的想法是：无论一个赌徒给哪个号码下注，其期望获得的奖金应该与其下注的金额相等。也就是说，如果一个赌徒为号码 $i$ 支付了 $x$ G，那么他中奖时应获得 $sx/a_i$ 的奖金。

这个游戏的一个小缺陷是，货币 G 的最小面额是 $1$ G，也就是说系统不能返还奖金的小数部分。为了避免这一现象，规定每次下注的金额必须是 $k$ 的正整数倍（其中 $k$ 是固定的正整数）。游戏的设计者需要保证，在给定 $k$ 之后，$k s$ 是每个 $a_i$（$i = 1, \ldots , n$）的正整数倍，这样计算奖金时就不会出现非整数值。

Picar 和 Roman 觉得这游戏很有意思，他们希望在不同的参数下各玩几轮。但是他们不喜欢太大的数字，所以 $s$ 不能超过一个给定的正整数 $m$（显然，由于权重之和最多为 $m$，每个权重也最多是 $m$）。对于权重集合相同的方案，仅仅打乱权重的顺序对游戏体验的改变不大，所以 Picar 和 Roman 认为，两组权重参数本质不同当且仅当这两组参数对应的**可重集合**不同。换句话说，如果将两组权重参数 $a_1, \ldots, a_n$ 和 $b_1, \ldots, b_n$ 分别从小到大排序，得到 $1\le\alpha_1\le\alpha_2\le\cdots\le\alpha_n$ 和 $1\le\beta_1\le\beta_2\le\cdots\le\beta_n$，那么这两组参数本质不同当且仅当存在下标 $i\in\left\{1, \ldots, n\right\}$ 使得 $\alpha_i \ne \beta_i$。

Picar 和 Roman 想知道，给定 $n, m, k$，有多少种满足“要求”的**本质不同**的参数方案。需要注意的是，由于这里吝啬的 Picar 和 Roman 只给了你 $k$，你需要保证你统计的每个方案中，$ks$ 是每个权重 $a_i$（$i = 1, \ldots , n$）的正整数倍。
## 输入格式

输入仅一行，包括三个正整数 $n, m, k$，两个数之间由一个空格隔开。
## 输出格式

输出一个非负整数，表示方案数对 ${10}^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
3 9 1

```
### 样例输出 #1
```
6

```
### 样例输入 #2
```
3 9 10

```
### 样例输出 #2
```
13

```
### 样例输入 #3
```
10 2000 20201003

```
### 样例输出 #3
```
365520548

```
## 提示

**【样例解释 #1】**

满足要求的方案有：

1. $3=1+1+1$；
2. $4=1+1+2$；
3. $6=1+2+3$；
4. $6=2+2+2$；
5. $8=2+2+4$；
6. $9=3+3+3$。

请特别注意，本题的方案是顺序无关的。

**【样例解释 #2】**

除了样例 #1 中的方案外，还有：

7. $5=1+2+2$；
8. $6=1+1+4$；
9. $7=1+1+5$；
10. $8=1+2+5$；
11. $9=1+2+6$；
12. $9=1+3+5$；
13. $9=2+2+5$。

**【数据范围】**

对于 $100\%$ 的数据，保证 $1\le n\le 10$，$1\le m \le 2000$，$1\le k \le 10^9$。

**【提示】**

赌博有风险，建议远离赌博。

请选手在提交评测之前确认自己对于数据范围的理解正确。如果你的理解不是正确的，你将有可能获得 Wrong Answer 的评测结果。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_1/tree/master](https://github.com/yylidiw/thupc_1/tree/master) 查看。


---

---
title: "[THUPC 2021] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P7609
tag: ['2021', 'O2优化', 'THUPC']
---
# [THUPC 2021] 游戏
## 题目描述

小 C 和小 W 两个人打算玩一局双人博弈游戏。

现在小 C 手里有 $n$ 颗相同的石子，小 W 打算把它们分为有顺序的 $m$ 堆，其中第 $i$ 堆石子的数量不能超过 $a_i$，但允许为 $0$。

随后，由小 C 先手，两人轮流进行操作，每次可以选择一堆非空的石子并拿走其中若干个（至少 $1$ 个），无法操作者输。

作为算法竞赛界的老司机，小 C 和小 W 早已对各种游戏的策略摸得门儿清，于是这次他们打算玩点不一样的：他们想要知道，有多少种分石子的方法能使得小 C 有必胜策略。
## 输入格式

第一行，两个正整数 $n, m$（$1 \le n \le {10}^{18}$，$1 \le m \le 10$）。

第二行，$m$ 个非负整数 $a_i$（$0 \le a_i \le {10}^{18}$）。
## 输出格式

一个非负整数，表示方案数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
6 3
2 3 4

```
### 样例输出 #1
```
4

```
## 提示

**【样例解释】**

以下 $4$ 种方案是符合题意的：$(0,2,4)$、$(1,1,4)$、$(2,0,4)$、$(2,2,2)$。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_2/tree/master](https://github.com/yylidiw/thupc_2/tree/master) 查看。


---

---
title: "[THUPC 2021] 群星连结"
layout: "post"
diff: 省选/NOI-
pid: P7610
tag: ['模拟', '2021', 'O2优化', 'THUPC']
---
# [THUPC 2021] 群星连结
## 题目背景

众所周知，群星和公主连结联动啦！联动的结果是一个叫做群星连结的游戏。

这是一个双人回合制竞赛游戏，双方记为 Alice 和 Bob。游戏有若干**回合**，每个回合依次由先手和后手分别行动一次。

现在聪明的你写了一个优秀的 AI 来玩这个游戏，这个 AI 会遵从游戏规则，并且按照游戏过程条目里既定的策略进行游戏。但是由于您太强了，所以世界上只有这么一个 AI，所以只能自己和自己打。

现在给定这个游戏的初始局面，让这个 AI 分别作为 Alice 和 Bob 对战，其中 Alice 先手。你需要模拟游戏过程，并且判断最终是 Alice 获胜还是 Bob 获胜。

游戏初始局面会通过输入给出。

**【提示】**

本题中，**伤害**、**真实伤害**、**生命值扣除**是三个不同的概念，请注意区分。
## 题目描述

#### 基础参数

首先，在游戏开始之前，每个玩家需要选择恰好 $n$ 个角色，并编号 $1,2,3,\dots,n$。

每个角色都有一些基础参数：

1. $HP,hp$ ：最大生命值，生命值；
2. $MP,mp$：最大能量值，能量值；
3. $atk,\Delta_{atk}$：基础攻击力，攻击力增益；
4. $def,\Delta_{def}$：基础防御力，防御力增益；

另外，为方便起见，下文中记 $A=\max(atk+\Delta_{atk},1)$，$D=\max(def+\Delta_{def},0)$。

游戏开始时，生命值 $hp$ 等于最大生命值 $HP$，能量值 $mp$、攻击力增益 $\Delta_{atk}$、防御力增益 $\Delta_{def}$ 均等于 $0$。

$HP,MP,atk,def$ 将由输入给出。

除此之外，每个角色分别拥有一个**天赋**和一个**技能**，分别见**天赋**条目和**技能**条目。

#### 死亡判定

游戏过程的任意时刻，如果某个角色生命值 $hp$ 降到 $0$ **及**以下，则判定该角色【死亡】。

一个角色一旦被判定为【死亡】，则该角色将从场上完全退出，并且生命值被恒定为 $0$，不能通过任何方式回复生命值（即不能起死回生，即使拥有【天赋 — 心胜于物】；另外，也不能通过己方其它角色技能回复生命值），不能普通攻击、发动技能，也不能被选定为优先目标，因而不能被普通攻击。

总之就是不以任何形式参与后续游戏的进程，并且本题中所有“全体”、“所有角色”等词均不包含【死亡】角色。

当某方角色全部被判定【死亡】时，游戏立刻结束，并判定另一方胜利（若此时仍有尚未完成的结算，也全部不再进行）。

#### 参数溢出

在游戏过程的任意时刻，如果某个角色的生命值 $hp>HP$，则 $hp$ 会立刻变成为 $HP$。

在游戏过程的任意时刻，如果某个角色的能量值 $mp>MP$，则 $mp$ 会立刻变成为 $MP$。

#### 优先目标

游戏开始前，每个玩家需要为每个角色选定一个攻击顺序。

具体来说，对编号为 $i$ 的角色，需要确定一个攻击顺序 $p_{i,1},\ldots,p_{i,n}$，满足 $p_{i,1},\ldots,p_{i,n}$ 是一个关于 $1,\ldots,n$ 的排列。

游戏过程的任意时刻，称编号为 $i$ 的优先目标是 $p_{i,j}$，当且仅当 $p_{i,1},\ldots,p_{i,j-1}$ 全部【死亡】，并且 $p_{i,j}$ 没有【死亡】。

#### 普通攻击

普通攻击会对优先目标造成 $A$ 点伤害。

拥有【天赋 — 超凡入圣】的角色则会对优先目标造成 $A$ 点真实伤害。详见**天赋**条目。

拥有【天赋 — 星河力量投射】的角色普通攻击会附加真实伤害。详见**天赋**条目。

#### 天赋

天赋有以下几种类型（每行前的编号为天赋类型的编号，圆括弧 `()` 内部为附加参数）：

0. 【天赋 — 我自闭了】该角色的天赋毫无作用；
1. 【天赋 — 血肉皮囊】该角色免疫一半真实伤害。详情见**生命值扣除环节**条目。  
   **真实伤害见生命值扣除条目**；
2. 【天赋 — 星河力量投射】$(x)$ 该角色每次普通攻击会附加的 $x$ 点真实伤害；
3. 【天赋 — 心胜于物】$(x,y)$ 该角色每次己方行动结束后回复 $x$ 点生命值，并**额外**回复 $y$ 点能量值；
4. 【天赋 — 超凡入圣】该角色的普通攻击被视为真实伤害攻击，即该角色的普通攻击不造成伤害，但造成 $A$ 点真实伤害。
5. 【天赋 — 科技至上】$(x,y)$ 该角色每次进行普通攻击后，回复 $x$ 点生命值；该角色每次发动技能后，**额外**回复 $y$ 点能量值。注意：如果普通攻击或发动技能造成对方全部角色【死亡】，则该角色不再回复生命值或能量值。

本题保证天赋附加参数均为**正**整数（但在输入数据中可能会有 $0$，详情参见**输入格式**条目）。

#### 技能

当某个角色能量值等于其最大能量值时（并且在游戏过程中被选定为发动技能的角色），可以清零其能量值并发动一次技能。

技能有以下几种类型（每行前的编号为技能类型的编号，圆括弧` ()` 内部为附加参数）：

0. 【技能：心态崩了！】该角色的主动技能毫无作用。注意，该技能仍然可以被发动，只不过毫无效果而已。
1. 【技能：格林炸裂！】$(x)$ 对敌方**所有**角色造成 $x$ 点伤害，**然后**使敌方**所有**角色能量值减少 $\left\lfloor\frac{mp_{enemy}}{10}\right\rfloor$，其中 $mp_{enemy}$ 为敌方该角色能量值（即对于每个敌方角色，若其当前的能量值为 $mp_{enemy}$，那么受此技能影响，其能量值会变成 $mp_{enemy}-\left\lfloor\frac{mp_{enemy}}{10}\right\rfloor$）。注意，根据规则，敌方角色会先受到伤害而进入生命值扣除环节，在该环节中回复能量值，然后再被该技能扣除能量值。
2. 【技能：日 (zhou) 昇 (ji) 之 (dao) 雨 (dan)！】对敌方**所有**角色造成 $A$ 点真实伤害。
3. 【技能：天楼霸断剑！】$(x)$ 对敌方**所有**目标造成 $\min\left(\left\lfloor\frac{HP_{enemy}}{10}\right\rfloor,x\times A\right)$ 点伤害，其中 $HP_{enemy}$ 为被攻击目标的最大生命值。
4. 【技能：演出开始！】$(x,y)$ 设当前为第 $t$ 回合，则从发动技能开始，到第 $t+x-1$ 回合结束期间，在己方行动结束时，己方全体角色**额外**回复 $y$ 点能量值。
5. 【技能：天狼噬斩！】$(x)$ 将优先目标的防御力增益减小 $x$，**然后**对优先目标造成 $A$ 点真实伤害。
6. 【技能：地 (太) 球 (虚) 蓝 (苍) 色 (蓝) 闪 (闪) 电！】$(x,y)$ 对优先目标造成 $A$ 点真实伤害。另外，设当前为第 $t$ 回合，则从发动技能开始，到第 $t+x-1$ 回合结束期间，敌方所有角色攻击力增益减小 $y$。
7. 【技能：极光绽放！】$(x,y,z)$ 使己方未【死亡】角色生命值最低（如有多个，则编号最小）的恰好一名角色回复 $z$ 点生命值。另外，设当前为第 $t$ 回合，则从发动技能开始到第 $t+x-1$ 回合结束期间，己方所有角色攻击力增益增大 $y$。
8. 【技能：流星！】$(x,y)$ 对敌方所有角色造成 $A$ 点伤害。设当前为第 $t$ 回合，则**从该技能造成伤害后**，到第 $t+x-1$ 回合结束期间，使敌方所有角色防御力增益减小 $y$。注意，本技能先造成伤害，再产生减益。
9. 【技能：精灵庇护！】$(x,y,z)$ 己方全体角色回复 $z$ 点生命值。设当前为第 $t$ 回合，则从发动技能开始，到第 $t+x-1$ 回合结束期间，己方所有角色防御力增益增大 $y$。
10. 【技能：全力超全开！轮回之终末！】$(x)$ 己方所有角色基础攻击力 $atk$、基础防御力 $def$ 变为原先的两倍 $2\times atk, 2\times def$；未【死亡】角色生命值 $hp$ 变为 $\max\left(\left\lfloor\frac{HP}2\right\rfloor,hp\right)$，能量值 $mp$ 变为 $\max\left(\left\lfloor\frac{MP}2\right\rfloor,mp\right)$；设当前为第 $t$ 回合，则从发动技能开始，到第 $t+x-1$ 回合结束期间，己方行动结束时，己方所有角色**额外**回复 $1$ 点能量值。在第 $t+x-1$ 回合结束时，若敌方仍有角色未【死亡】，则己方全体角色强制生命值清零，并被判定为【死亡】。另外，在发动该技能时，场上所有拥有这个技能的角色（包括自己）的技能将被强制替换为 0 号【技能：心态崩了！】（因此该技能最多在游戏中被发动一次）。

本题保证技能附加参数均为**正**整数（但在输入数据中可能会有 $0$，详情参见**输入**条目）。

注意：上述形如“设当前为第 $t$ 回合，则从发动技能开始到第 $t+x-1$ 回合结束期间，……”产生的效果是**可以叠加**的。

#### 生命回复与能量回复

生命值仅可通过天赋和技能回复。

己方行动结束时，己方全体角色能量值增加 $1$。拥有【天赋 — 心胜于物】的角色，以及受【技能：演出开始！】和【技能：全力超全开！轮回之终末！】影响的角色可以额外回复能量值。

当己方角色进行普通攻击或者发动技能后，该角色能量值增加 $1$。拥有【天赋 — 科技至上】的角色发动技能后会回复额外的能量值。

注意，发动技能时，先扣除全部能量值，再发动技能，然后再增加能量值。

特别的，若该技能为【技能：全力超全开！轮回之终末！】，则使发动该技能的角色 $mp=\max\left(mp,\left\lfloor\frac{MP}2\right\rfloor\right)$ 后再增加能量值。

当己方角色因受到伤害而进入生命值扣除环节时，该角色能量值增加 $1$（无论其是否实际扣除生命值）。

**生命值扣除见生命值扣除环节。**

#### 生命值扣除环节

当角色受到伤害或者真实伤害时，该角色立即进入生命值扣除环节（注意，即使受到了 $0$ 点伤害，也会进入生命值扣除环节）。

进入生命值扣除环节后，由能量回复条目，该角色能量值增加 $1$。

假设其受到 $x$ 点伤害和 $y$ 点真实伤害，那么：

- 若该角色因拥有【天赋—血肉皮囊】而免疫一半真实伤害，则其生命值扣除 $\max(x-D,0)+y-\left\lfloor\frac y2\right\rfloor$。
- 否则，其生命值扣除 $\max(x-D,0)+y$。

#### 游戏过程

游戏开始后，可视为若干回合，编号从 $1$ 开始。

每个回合，可以划分为如下 $5$ 个阶段：Alice 行动（期间）、Alice 行动结束、Bob 行动（期间）、Bob 行动结束、当前回合结束。

己方行动期间，

1. 如果己方存在至少一个角色可以发动技能时，则按照技能编号从大到小的顺序选择其中一位发动技能。如果有多个角色满足可以发动相同编号的技能，则选择这些角色中角色编号最大的角色发动技能。
2. 如果己方没有角色可以发动技能，则选择一个优先目标生命值最高的角色发动普通攻击。如果有多个角色的优先目标生命值最高，则选择能对优先目标扣除更多生命值（而不是造成更多伤害！）的角色发动攻击。如果仍然有多个角色可以选择，则选择其中编号最大的角色发动普通攻击。

己方行动结束。

注意，己方行动期间，仅能选择一位角色发动技能，或者选择一位角色进行普通攻击。
## 输入格式

第一行一个正整数 $n$，表示 `Alice` 和 `Bob` 分别有 $n$ 个角色。

接下来 $4 n$ 行，第 $4 i - 3$ 到第 $4 i$ 行描述 `Alice` 的编号为 $i$ 的角色。

在这四行中：

- 第一行，四个非负整数 $HP,MP,atk,def$ 分别表示该角色的最大生命值、最大能量值、基础攻击力、基础防御力，保证 $HP,MP>0$。
- 第二行，$n$ 个正整数 $p_{i,1},p_{i,2}, \ldots ,p_{i,n}$，表示该角色攻击顺序，保证这是一个关于 $1$ 到 $n$ 的排列。
- 第三行，三个非负整数 $tf,x,y$ 表示天赋编号以及附加参数。如果该天赋附加参数不足两个，那么你可以忽略多余的部分（保证此时多余的部分在输入数据中是 $0$）。
- 第四行，四个非负整数 $jn,x,y,z$ 表示技能编号及附加参数。如果该技能附加参数不足三个，那么你可以忽略多余的部分（保证此时多余的部分在输入数据中是 $0$）。

接下来 $4n$ 行描述 `Bob` 的 $n$ 个角色，形式同上。
## 输出格式

如果游戏能够以某一方胜利而结束，那么：

- 第一行，输出一个正整数 $x$，表示游戏在第 $x$ 个回合结束的。
- 第二行，输出一个字符串（`Alice` 或 `Bob`）表示胜者。
- 第三行，输出 $n$ 个非负整数，依次表示胜者的每一个角色在游戏结束时的 $hp$，若该角色已死亡则输出 $0$。

如果游戏永远不会结束或者双方平局，请输出任意卖萌表情。
## 样例

### 样例输入 #1
```
3
2 8 1 1
1 2 3
3 1 1
7 2 1 2
6 6 3 0
1 2 3
5 1 1
7 2 1 1
99 10 1 1
2 1 3
1 0 0
10 10 0 0
9 10 1 0
1 2 3
2 1 0
8 2 1 0
8 7 2 1
2 1 3
1 0 0
4 2 1 0
99 10 2 0
2 1 3
1 0 0
10 10 0 0

```
### 样例输出 #1
```
15
Alice
2 0 96 

```
## 提示

**【数据范围】**

$n \le 10$，$HP, MP, atk \gt 0$，$def \ge 0$。

保证在游戏中的任意时刻，所有题面中提及到的参数及表达式的绝对值均不超过 ${10}^9$。

保证游戏在 $23333$ 回合内结束。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_2/tree/master](https://github.com/yylidiw/thupc_2/tree/master) 查看。


---

---
title: "[THUPC 2022 初赛] 赛程制定"
layout: "post"
diff: 省选/NOI-
pid: P8209
tag: ['2022', 'O2优化', 'THUPC']
---
# [THUPC 2022 初赛] 赛程制定
## 题目描述

Lewis 热爱打拳，因此他组建了一家拳击俱乐部，希望通过举办表演赛卖票以筹集自己训练的资金，但是，很遗憾，Lewis 人缘并不好，因此这个俱乐部只有两个成员——Lewis 和他的好基友 Valtteri，而观众们很快就厌倦了每晚都是他们两人出场的表演赛，票卖不出去了，拳击俱乐部濒临倒闭。穷则思变，Lewis 决定通过请外援的方式，尝试拯救自己的俱乐部。

通过支票攻势，Lewis 很快就请到了两个拳坛明星——Max 和 Checo，他们将作为飞行嘉宾加入 Lewis 的俱乐部。在接下来的一个赛季里，Lewis 总共会安排 $n$ $(1 \le n \le 2*10^5)$ 场比赛，每场比赛会从现有的4个成员中选出2人比赛，对于第 $i$ $(1 \le i \le n)$ 场比赛，如果是 Lewis 和 Valtteri 的比赛，只能卖出 $a_{i}$ 元的门票，如果是他们中一人和一个明星的比赛，能卖出 $b_i$ 元的门票，如果是两个明星 Max 和 Checo 之间的比赛，能卖出 $c_i$ 元的门票。观众们喜欢看明星之间的高水平比赛，而不是 Lewis 和 Valtteri 的菜鸡互啄，因此有 $1 \le a_{i} < b_{i} < c_{i} \le 10^9$ 。除此之外，安排比赛时还有如下要求——

因为明星都是日理万机的，他们只同意分别在Lewis的俱乐部停留最多 $t_m, t_c$ 场比赛的时间。设Max出席的第一场比赛是第 $p_m$ 场，最后一场是 $q_{m}$ 场，Checo出席的第一场比赛是第 $p_c$ 场，最后一场是 $q_c$ 场，则需要满足 $q_m - p_m +1 \le t_m$ 且 $q_c - p_c +1 \le t_c$ ；
Lewis 深知自己不会是两个明星的对手，他不会愿意自己被打得鼻青脸肿直接 KO，因此，他不会安排自己与两位明星的比赛（言下之意，挨打的工作就被 Lewis 偷偷安排给了自己的好基友 Valterri，让我们为可怜的工具人 Valterri 默哀）；
同时，Lewis 希望最大化自己的总收入，但是，他不太聪明，因此，如果一种方案满足以下条件，他就认为此方案满足”收入最大“——

定义 (“Lewis 的最优方案”)：对于一种方案，可以看作一个长度为 $2n$ 的序列，序列的第 $(2i-1)$ 和 $2i$ 项为第 $i$ 场比赛的对阵双方，如果通过修改序列的任意 $1$ 个位置，都无法得到一个收入严格大于当前收入的合法方案，则称此方案为“Lewis 的最优方案”。

聪明的你很快就发现了，“Lewis 的最优方案”不一定能最大化总收入且可能不唯一。已知 Lewis 会从所有“Lewis 的最优方案”（两个方案相同，当且仅当每一天的对阵均相同，注意，Max vs Valtteri 和 Checo vs Valtteri 虽然卖出门票相当，但视为两种不同的方案）等概率随机选一个方案执行，那么，请问在 Lewis 可能最终选择的所有方案中，门票收入的中位数是多少呢？（答案保留一位小数输出）
## 输入格式

第 $1$ 行：3个正整数 $n,t_m, t_c$ ，意义见题面；

接下来 $n$ 行：每行3个正整数 $a_i, b_i, c_i$ 表示三种情况下卖出的门票价格。
## 输出格式

一行一个正整数表示在 Lewis 最终选择的所有方案中，门票收入的中位数。
## 样例

### 样例输入 #1
```
2 1 1
1 10 100
1 2 3
```
### 样例输出 #1
```
12.0
```
### 样例输入 #2
```
3 1 3
1 2 3
5 6 12
1 5 6
```
### 样例输出 #2
```
14.0
```
## 提示

【样例解释】

Lewis的“收入最大方案”总共有以下 $4$ 种：

- Max vs Checo, Lewis vs Valtteri，门票收入为 $100+1=101$；
- Valtteri vs Max, Valtteri vs Checo，门票收入为 $10+2=12$；
- Valtteri vs Checo, Valtteri vs Max，门票收入为 $10+2=12$；
- Lewis vs Valterri, Max vs Checo，门票收入为 $1+3=4$。

中位数为 $\frac{12+12}{2} = 12$。

【数据范围】

对于 $100\%$ 的数据，$1 \le n, t_m, t_c \le 2*10^5$ , $1 \le a_{i} < b_{i} < c_{i} \le 10^9$。


---

---
title: "[THUPC 2022 初赛] 搬砖"
layout: "post"
diff: 省选/NOI-
pid: P8211
tag: ['2022', 'O2优化', '根号分治', 'THUPC']
---
# [THUPC 2022 初赛] 搬砖
## 题目背景

张华考上了北京大学；李萍进了中等技术学校；小 E 在工地搬砖：他们都有光明的前途。
## 题目描述

**温馨提示：请不要模仿小 E 的搬砖方式，那样很累。**

为了能够快乐地搬砖，小 E 有一种特殊的搬砖方式。

假设他的面前有 $n$ 摞砖，他会在一个小时内搬走每一摞砖最上面的 $d$ 块。其中 $d$ 是小 E 当前的精力值。如果一摞砖不够 $d$ 块，小 E 会把这一摞砖剩下的所有砖搬走。

当小 E 工作完一个小时后发现自己搬完了至少一摞砖，那么他会觉得很快乐，并且继续工作一个小时；但是由于完成了一部分工作，小 E 可能会产生懈怠的心理，导致精力值有所下降。具体地，对于每一摞砖都有一个属性 $b$，当小 E 搬完这一摞砖后，精力值就会下降 $b$。

如果没有任何一摞砖被搬完，小 E 就会停止工作。如果精力值下降到 $0$ 或以下，小 E 也会停止工作。如果小 E 发现自己需要工作但是所有的砖已被搬完，他会用别的方式来度过这一小时，但这一小时仍算作小 E 的工作时间。

工地的砖在不停增加，问如果小 E 初始的精力值为 $d$，那么他可以连续工作几个小时？
## 输入格式

第一行一个正整数 $T$，表示事件总数。

接下来 $T$ 行，每行若干个整数，其中第一个整数为 $op$ 表示事件类型。

若 $op=1$，则后面跟着两个整数 $a,b$，表示新增了一摞砖，砖有 $a$ 块，搬完后小 E 的精力值会下降 $b$。

若 $op=2$，则后面跟着一个正整数 $d$，询问若小 E 初始的精力值为 $d$，那么他可以连续工作几个小时。

注意 $op=2$ 的操作**不会**改变任何一摞砖的数量。
## 输出格式

对于每个询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
1 6 1
1 3 0
1 9 2
2 3
2 4
```
### 样例输出 #1
```
3
4

```
### 样例输入 #2
```
4
1 2 1
2 2
1 2 1
2 2
```
### 样例输出 #2
```
2
1
```
## 提示

【样例解释】

第一组询问：

初始有 $3$ 摞砖，数量分别为 $(6,3,9)$，小 E 的初始精力是 $3$。

第一个小时，小 E 在每一摞砖中各搬了 $3$ 块，数量变成 $(3,0,6)$。其中第二摞砖被搬完，小 E 的精力因此下降 $0$ 并且继续工作一个小时。

第二个小时，小 E 在每一摞砖中各搬了 $3$ 块，数量变成 $(0,0,3)$。其中第一摞砖被搬完，小 E 的精力因此下降 $1$ 并且继续工作一个小时。

第三个小时，小 E 在每一摞砖中各搬了 $2$ 块，数量变成 $(0,0,1)$。由于没有新的砖摞被搬完，小 E 停止工作。

第二组询问：

初始有 $3$ 摞砖，数量分别为 $(6,3,9)$，小 E 的初始精力是 $4$。

第一个小时，小 E 在每一摞砖中各搬了 $4$ 块（第二摞砖由于只有 $3$ 块就只搬了 $3$ 块，以下省略），数量变成 $(2,0,5)$。其中第二摞砖被搬完，小 E 的精力因此下降 $0$ 并且继续工作一个小时。

第二个小时，小 E 在每一摞砖中各搬了 $4$ 块，数量变成 $(0,0,1)$。其中第一摞砖被搬完，小 E 的精力因此下降 $1$ 并且继续工作一个小时。

第三个小时，小 E 在每一摞砖中各搬了 $3$ 块，数量变成 $(0,0,0)$。其中第三摞砖被搬完，小 E 的精力因此下降 $2$ 并且继续工作一个小时。

第四个小时，小 E 在每一摞砖中各搬了 $1$ 块，但其实此时已经没有砖了，不过这一小时仍然算进小 E 的工作时间。由于没有新的砖摞被搬完，小 E 停止工作。

【样例解释 2】

第一组询问：

初始有 $1$ 摞砖，数量为 $2$，小 E 的初始精力是 $2$。

第一个小时，小 E 在每一摞砖中各搬了 $2$ 块，数量变成 $0$。这一摞砖被搬完，小 E 的精力因此下降 $1$ 并且继续工作一个小时。

第二个小时，小 E 在每一摞砖中各搬了 $1$ 块，但其实此时已经没有砖了，不过这一小时仍然算进小 E 的工作时间。由于没有新的砖摞被搬完，小 E 停止工作。

第二组询问：

初始有 $2$ 摞砖，数量为 $(2,2)$，小 E 的初始精力是 $2$。

第一个小时，小 E 在每一摞砖中各搬了 $2$ 块， 数量变成 $(0,0)$。两摞砖都被搬完，小 E 的精力因此下降 $1+1=2$。由于小 E 的精力下降到 $0$，他停止工作。

【数据范围】

保证 $T\le 351493,1\le op\le 2,1\le a\le 100000,0\le b\le 100000,1\le d \le 100000$。


---

---
title: "[THUPC 2022 初赛] 喵喵花園"
layout: "post"
diff: 省选/NOI-
pid: P8212
tag: ['计算几何', '2022', 'Special Judge', 'O2优化', '模拟退火', 'THUPC']
---
# [THUPC 2022 初赛] 喵喵花園
## 题目描述

喵喵是一只非常富有的猫咪，他在海淀区拥有一个大花园。

这个大花园是由一些旧栅栏为边界所形成的 $N$-gon（即具有 $N$ 边的多边形）。

由于圣诞节快到了，喵喵想用 $K$ 棵圣诞树来装饰一下花园。 同时，喵喵坚信找到一些好的位置来种树会给他带来好运。

作为一只好猫咪，他决定寻找最佳位置如下：

- 所有的树都应该在花园的边界上。
- 这些 $K$ 树应该平均划分花园的周长。
- 由树木形成的新凸面$K$-gon 的面积应尽可能小。

虽然喵喵比你有钱，但他没有你那么聪明。 因此，他给了你一些钱，让你帮他找出凸$K$-gon 的最小面积。
## 输入格式

第一行包含两个整数，$N$ 和 $K$，代表原本花园边界的顶点数和树的数量。

接下来的每行 $N$ 行包含两个整数 $x_i$ 和 $y_i$，表示花园边界顶点的坐标。

所有座标均为逆时针给出的。
## 输出格式

输出凸面 $K$-gon 的最小面积。 如果相对或绝对误差不超过 $10^{-8}$，则您的答案被认为是正确的。
## 样例

### 样例输入 #1
```
5 4
0 0
1 0
2 1
2 2
0 2
```
### 样例输出 #1
```
1.9892766953
```
### 样例输入 #2
```
3 3
0 0
1 0
0 1
```
### 样例输出 #2
```
0.1226170434
```
## 提示

【数据范围】

- $3 \le N, K \le 1000$；
- $-10^5 \le x_i, y_i \le 10^5$。


---

---
title: "[THUPC 2022 初赛] 分组作业"
layout: "post"
diff: 省选/NOI-
pid: P8215
tag: ['2022', 'O2优化', '最小割', 'THUPC']
---
# [THUPC 2022 初赛] 分组作业
## 题目描述

老师布置了分组作业。在此之前，老师将班上 $2n$ 个学生分成了 $n$ 组，每组两个人。其中 $1$ 号和 $2$ 号为一组，$3$ 号和 $4$ 号为一组，……，$2n-1$ 号和 $2n$ 号为一组。

老师让每个队伍自行安排分工。这样是否合作就成了一个大问题。大家决定用表决的方式来确定。首先每个人决定是否愿意和队友合作。不同的人因为自己的原因和分配的队友的原因，对合作的意愿不一样，对于第 $i$ 个学生，选择“愿意”会产生 $c_i$ 的不满，选择“不愿意”会产生 $d_i$ 的不满。

如果两名队友都选择“愿意”，那么根据实际情况他们可以合作或者不合作。但是如果有一名队友选择“不愿意”，那么他们只能不合作。

学生中还有 $m$ 个单向的喜欢关系，一个关系形如“$A$ 喜欢 $B$”。在这样一个关系中，如果 $A$ 没有和队友合作，且 $B$ 选择了“愿意”，$A$ 会有略微沮丧，产生 $a_i$ 的不满；如果 $A$ 表决了“不愿意”，但 $B$ 成功与队友合作，那么 $A$ 会羡慕嫉妒恨并产生 $b_i$ 的不满。（由于当 $A$ 和 $B$ 在同一组时这种设定会变得很奇怪，所以题目保证不会有这种情况）其中 $i$ 表示第 $i$ 个关系。

如果一个学生 $i$ 选择了“愿意”但是他的队友选择了“不愿意”，那么他会因为队友产生 $e_i$ 的不满。

问所有情况下最小的不满之和是多少。
## 输入格式

第一行两个整数 $n,m$。

接下来 $2n$ 行，每行三个整数 $c_i,d_i,e_i$。

接下来 $m$ 行，每行四个正整数 $A,B,a_i,b_i$ 。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2 1
8 6 7
5 2 8
7 1 5
6 5 8
1 4 4 3
```
### 样例输出 #1
```
14
```
## 提示

【数据范围】

保证 $1\le n \le 5000$，$0\le m \le 10000$，$1\le a_i,b_i,c_i,d_i,e_i\le 10^9$。


---

---
title: "[THUPC 2022 决赛] 德州消消乐"
layout: "post"
diff: 省选/NOI-
pid: P8422
tag: ['模拟', '2022', 'O2优化', 'THUPC']
---
# [THUPC 2022 决赛] 德州消消乐
## 题目背景

众所周知小 c 是开心消消乐的高手，而小 z 玩这种稍微需要动一点脑子的游戏都很不在行。正值五一假期，小 c 闲得无聊就打算来教小 z。

经过五天五夜不间断教学，小 z 终于领悟了一点门道（小 z 内心 os：但凡能拿出一点热情来学概率论……），然而他俩都忽略了这玩意是会玩上瘾的，更关键的是小 z 来自山东，于是他打算融入一点家乡特色……

小 z：”……众所周知德州在山东，那我们就叫它‘德州消消乐’吧！“

小 c 连忙制止道你快算了吧，上次的大杂糅棋局你忘了？再说此德州非彼德州啊喂，这次你要搞就自己搞吧别拉我下水了。

话还没说完，小 z 转手把规则甩给了小 c。

小 c：“真香”。

## 题目描述

给定大小为 $n \times m$ 的棋盘，记左上角坐标为 $(1,1)$ ，右下角坐标为 $(n,m)$ 。有不同颜色的棋子共 $k$ 种，颜色编号为 $1\sim k$ 。最初每个格子都有一个棋子。

共有 $q$ 次操作，每次操作形如交换相邻（在上、下、左、右方向）的两个棋子。在此之后，在同一行或同一列的连续至少 $3$ 个相同颜色的棋子会被消除。

消除后，所有棋子会遵循重力下落，这一列的最上方变成空位。所有棋子下落完成后，如果又产生了能消除的情况，则会触发连锁反应继续消除，直到无法消除为止。称一次消除+一次下落为“一轮消除”，由此可以定义一次操作触发的消除“轮数”。

其中，有些棋子具有特殊属性，被消除时会触发特殊效果，一共有以下 $6$ 类：

- 1、消除时将同一行的全部棋子消除；
- 2、消除时将同一列的全部棋子消除；
- 3、消除时将同一行和同一列的全部棋子消除；
- 4、消除时将以之为中心 $3 \times 3$ 的正方形范围内的棋子全部消除；
- 5、消除时将以之为中心 $5 \times 5$ 的正方形范围内的棋子全部消除；
- 6、消除时将与之颜色相同的棋子全部消除； 

触发一个棋子的特殊效果时可能连锁触发其他棋子的特殊效果，但是这些都是在同一轮消除内触发的（即连锁反应触发的过程中不会引起下落）。

游戏中，每次操作都要求必须有效，即操作的两个位置相邻且均不为空位，且在操作之后能进行棋子的消除。若某此操作并非有效，则直接跳过这一次操作。所有 $q$ 次操作结束后游戏结束。

定义一次有效操作的“主颜色”为通过交换而直接被消除的颜色（即不包括特殊效果触发和下落引起的消除），容易发现一次有效操作的主颜色至少有 $1$ 种，最多有 $2$ 种。

游戏中，玩家要通过操作来获取尽可能多的得分。得分的规则有如下 $5$ 种：消除奖分+连锁奖分+组合奖分+牌型奖分+终局奖分。

- 消除奖分：每次有效操作中，第 $i$ 轮消除的消除奖分为这一轮中所有被消除的棋子的颜色编号之和的 $i$ 倍。
- 连锁奖分：设某次有效操作的总消除轮数为 $x$ ，则有连锁奖分 $80(x-1)^2$ 。
- 组合奖分：某一轮消除中，在仅考虑由“同一行或同一列至少连续 $3$ 个相同颜色”引发的消除的情况下（即不考虑所有特殊效果引起的消除），设某个被消除的同色四连通块大小为 $x$ ，则有组合奖分 $50(x-3)^2$ 。如： $4$ 个同色棋子组成四连的组合奖分为 $50$ ，$5$ 个同色棋子组成五连、十字或T字等形状的组合奖分为 $200$ ，$2\times3$ 的方形同色棋子的组合奖分为 $450$ 。
 - 牌型奖分：每 $5$ 次有效操作计算一次牌型奖分，取之前 $5$ 次有效操作的主颜色（若某次操作有多个主颜色，取能按照以下规则计算出的最大奖分的主颜色），按照如下牌型规则计算奖分：
   
   - 高牌： $5$ 种颜色全部不同，奖 $50$ 分 + 所有牌中最大的颜色编号；
   - 一对： $2$ 个相同颜色 + $3$ 个不同颜色，奖 $100$ 分 + 一对的颜色编号 $\times 2$ ；
   
   - 两对： $2$ 对相同颜色 + $1$ 个其他颜色，奖 $200$ 分 + 两对中较大的颜色编号 $\times 2$ + 两对中较小的颜色编号；
   - 三条： $3$ 个相同颜色 + $2$ 个不同颜色，奖 $300$ 分 + 三条的颜色编号 $\times 3$ ；
   - 葫芦： $3$ 个相同颜色 + 另外 $2$ 个相同颜色，奖 $500$ 分 + 三个相同的颜色编号 $\times 3$ + 两个相同的颜色编号；
   - 四条： $4$ 个相同颜色 + $1$ 个其他颜色，奖 $750$ 分 + 四条的颜色编号 $\times 5$ ；
   - 五条： $5$ 个颜色全部相同，奖 $1000$ 分 + 五条的颜色编号 $\times 10$ 。
 - 终局奖分：若所有 $q$ 次操作均有效，在终局时额外获得 $1000$ 分终局奖分；若游戏结束时棋盘被全部清空，额外获得 $10000$ 分的终局奖分。

给定一局游戏的初始局面和玩家的每一次操作，你需要计算玩家的总得分。
## 输入格式

第 $1$ 行： $4$ 个正整数 $n,m,k,q$ 。

接下来 $n$ 行，每行 $m$ 个正整数 $a_{i,j}$ ，表示初始状态下，从上往下第 $i$ 行、从左往右第 $j$ 列的棋子的颜色。

接下来 $n$ 行，每行 $m$ 个非负整数 $b_{i,j}$ ，表示初始状态下，从上往下第 $i$ 行、从左往右第 $j$ 列的棋子的特殊效果，含义如题面所述。特别地， $b_{i,j}=0$ 表示没有特殊效果。

接下来 $q$ 行，每行 $4$ 个正整数 $x_{i,1},y_{i,1},x_{i,2},y_{i,2}$ ，表示交换坐标 $(x_{i,1},y_{i,1})$ 和 $(x_{i,2},y_{i,2})$ 位置的棋子。
## 输出格式

输出一行，一个非负整数表示终局时的总得分。
## 样例

### 样例输入 #1
```
8 8 5 5
1 1 5 1 5 4 5 3
2 1 2 2 5 4 3 2
1 4 1 4 2 1 5 4
2 1 5 5 2 1 4 4
2 3 5 2 3 4 2 2
4 2 4 3 3 2 4 5
1 3 4 3 5 2 4 3
3 4 2 5 2 1 1 2
0 0 0 0 0 0 0 0
2 0 0 0 0 0 0 0
0 0 0 0 5 0 0 0
0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0
0 0 0 6 0 0 3 1
0 0 0 0 3 0 0 0
0 0 0 0 0 0 1 4
3 2 4 2
5 4 5 5
7 2 7 3
8 5 8 6
6 7 6 8

```
### 样例输出 #1
```
11692

```
### 样例输入 #2
```
8 8 5 8
1 1 5 1 5 4 5 3
2 1 2 2 5 4 3 2
1 4 1 4 2 1 5 4
2 1 5 5 2 1 4 4
2 3 5 2 3 4 2 2
4 2 4 3 3 2 4 5
1 3 4 3 5 2 4 3
3 4 2 5 2 1 1 2
0 0 0 0 0 0 0 0
2 0 0 0 0 0 0 0
0 0 0 0 5 0 0 0
0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0
0 0 0 6 0 0 3 1
0 0 0 0 3 0 0 0
0 0 0 0 0 0 0 0
1 1 2 2
3 2 4 2
3 2 3 3
4 2 4 3
5 4 5 5
7 2 7 3
8 5 8 6
6 7 6 8

```
### 样例输出 #2
```
684

```
### 样例输入 #3
```
5 5 2 1
1 1 2 1 1
1 1 2 1 1
2 2 1 2 2
1 1 2 1 1
1 1 2 1 1
0 0 0 0 0
0 0 0 0 0
0 0 0 0 0
0 0 0 0 0
0 0 0 0 0
3 3 4 3

```
### 样例输出 #3
```
3023

```
## 提示

【样例 1 解释】

每次操作后，前 $3$ 类奖分的和分别为：$315,\ 417,\ 429,\ 435,\ 482$ 。第 $5$ 次操作后计算牌型奖分，最优牌型为 $(1\ 2\ 4\ 2\ 4)$ ，奖分为 $200 + 4\times 2 + 2 \times 1 = 210$ 。终局时两种终局奖分均可获得，故总分为 $11692$ 。

【样例 2 解释】

与上一组样例相比，增加了 $3$ 次无效操作，且最后不能实现全消，因此得不到终局奖分。

【数据范围与约定】


$n,m\leq 50,\ k \leq 100,\ q \leq 1000,\ a_{i,j} \leq k,\ b_{i,j} \leq 6,\ x_{i,1},x_{i,2} \leq n,\ y_{i,1},y_{i,2} \leq m$ 。

保证初始局面没有可以直接消除的情况。


---

---
title: "[THUPC 2023 初赛] 拧螺丝"
layout: "post"
diff: 省选/NOI-
pid: P9134
tag: ['模拟', '高精度', '2023', 'O2优化', 'THUPC']
---
# [THUPC 2023 初赛] 拧螺丝
## 题目背景

张华考上了北京大学；李萍进了中等技术学校；~~小 E 在工地搬砖~~：他们都有光明的前途。

由于搬砖太累，小 E 决定进厂拧螺丝。但是小 E 遇到了一个各种刁难人的老板。
## 题目描述

加工一个模块需要拧 $n$ 个螺丝。但是，每隔 $10$ 分钟，小 E 的老板就会到小 E 的工位上收走一个未完工的模块。在这期间，只够小 E 拧 $k$ 个螺丝。

小 E 的老板刚刚离开。问老板接下来第几次来的时候小 E 才可能有一个完工的模块？假设小 E 的老板极力不想让小 E 达成这件事。
## 输入格式

一行两个正整数，$n,k$。
## 输出格式

如果小 E 无论如何也不能有一个完工的模块，那么输出一行 `Poor E.S.!`。

否则输出一行一个正整数，表示答案。
## 样例

### 样例输入 #1
```
3 2

```
### 样例输出 #1
```
2

```
## 提示

#### 样例解释 1

小 E 先选择两个模块各拧上一个螺丝，然后老板来了拿走一个。接下来小 E 只需要在剩下的那个零件上面拧两个螺丝就可以完工了。所以老板第二次来的时候小 E 就有了一个完工的模块。注意小 E 在老板来的时候不能有只拧上了一半的螺丝，不然老板看到了会说小 E 加工不合格。

#### 子任务

保证 $1\le k \le n \le 10^5$。

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。


---

---
title: "[THUPC 2023 初赛] 快速 LCM 变换"
layout: "post"
diff: 省选/NOI-
pid: P9135
tag: ['2023', '数论', 'O2优化', '快速傅里叶变换 FFT', 'THUPC']
---
# [THUPC 2023 初赛] 快速 LCM 变换
## 题目描述

小 I 今天学习了快速最小公倍数变换（Fast Least-Common-Multiple Transform, FLT），于是他想考考你。

给定一个长度为 $n$ 的正整数序列 $r_1,r_2,\cdots,r_n$。你需要做以下操作恰好一次：

- 选择整数 $i,j$ 使得 $1 \le i < j \le n$。在序列末尾加入 $(r_i+r_j)$，并将 $r_i$ 和 $r_j$ 从序列中删除。

可以注意到总共有 $\frac{n(n-1)}{2}$ 种可能的操作，每种操作会得到一个长度为 $n-1$ 的序列。

你需要对所有的这 $\frac{n(n-1)}{2}$ 个序列，求出序列中所有元素的最小公倍数，并给出它们的和模 $998244353$ 的值。
## 输入格式

输入的第一行包含一个正整数 $n$，表示序列的长度。接下来一行 $n$ 个正整数 $r_1,r_2,\cdots,r_n$，描述初始序列。
## 输出格式

输出一行一个整数，表示所有序列的最小公倍数的和模 $998244353$ 的值。
## 样例

### 样例输入 #1
```
3
2 3 4

```
### 样例输出 #1
```
40

```
## 提示

#### 样例解释 1

- $i=1,j=2$ 时，得到的序列为 $\{4,5\}$，最小公倍数为 $20$；
- $i=1,j=3$ 时，得到的序列为 $\{3,6\}$，最小公倍数为 $6$；
- $i=2,j=3$ 时，得到的序列为 $\{2,7\}$，最小公倍数为 $14$。

因此输出为 $20+6+14=40$。

#### 子任务

对于所有测试数据，$2 \le n \le 5 \times 10^5, 1 \le r_1,r_2,\cdots,r_n \le 10^6$。

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。


---

---
title: "[THUPC 2023 初赛] 公平合作"
layout: "post"
diff: 省选/NOI-
pid: P9138
tag: ['动态规划 DP', '博弈论', '倍增', '2023', 'Special Judge', 'O2优化', 'THUPC']
---
# [THUPC 2023 初赛] 公平合作
## 题目描述

在大地的尽头，一座灰白的灯塔矗立在漫长的海岸线上。这一片海域海流复杂、礁石嶙峋，却又是不少航线的必经之路。若没有如此高耸而明亮的灯塔为过路的船只照亮航路，或许会有更多不幸的生命葬身海底。为了看管好这一座海上明灯，一批训练有素的守望人轮流值守于此。日复一日的工作枯燥乏味却又不能有丝毫闪失，紧绷的神经直到下一班守望人到来才得以放松。

在电力普及之前，灯塔通常使用煤油灯为过往的水手指引前行的方向。每次为这座灯塔添加燃油时，需要两位守望人各自搬运一个容积为 $L$ 的油桶；而每次轮到 Y 和 S 所在的班组照料这座灯塔时，总是由 Y 和 S 负责为灯塔加油。将煤油搬运至灯室时，如果不装满油桶，对灯塔的正常运转也没有太大影响，无非是需要多来回搬运几趟。但是，如果两位守望人都想着偷懒，问题恐怕就不只是多几趟那么简单。Y 和 S 想到了一个好办法：互相为对方的油桶装油。

灯塔里有 $N$ 个用于将储存的煤油转移到油桶中的容器，其中第 $i$ 个容器的容积为 $a_i$。Y 和 S 先想办法决定由谁先装油。两人先后装油；轮到其中一位守望人装油时，这位守望人每次从所有容器中等概率地随机选出一个容器，将其装满油，并全部倒入对方的油桶中。两位守望人都可以在操作任意多次（可以是 0 次）后结束装油，但后手必须等先手结束后才能开始装油。Y 和 S 先后装完煤油后，两人会比一下谁把对方的油桶装得更满，再各自把自己的油桶搬运到灯室。但是，如果有谁某次选出一个容器后，把对方的油桶装满了，但容器里还有没倒出的煤油，那么这位倒霉的守望人就必须把两个油桶都独自搬到灯室——这也算是为单调的生活平添了几分乐趣。显然，如果先手某次随机选中的容器会使得油桶溢出，那么后手可以往先手的油桶里面装任意量的煤油，然后幸灾乐祸；因此我们约定：当先手溢出时，必定由先手搬两个油桶。

现在只剩下了一个问题：当 Y 和 S 都采取最优策略，使得对方搬的煤油尽可能地比自己多的时候，先手搬的煤油不多于后手的概率是多大？
## 输入格式

输入的第一行包括两个正整数 $N$ 和 $L$，分别表示转移用的容器数量和油桶的容积。

输入的第二行包括 $N$ 个正整数 $a_1, \cdots, a_N$，分别表示每个转移用的容器的容积。
## 输出格式

输出一个实数，表示先手搬的煤油不多于后手的概率。当你的输出与标准输出的绝对误差不超过 $10^{-6}$ 时，我们认为你的输出是正确的。
## 样例

### 样例输入 #1
```
2 4
1 2
```
### 样例输出 #1
```
0.687500000000000000

```
### 样例输入 #2
```
见附件中的 2.in
```
### 样例输出 #2
```
见附件中的 2.out
```
### 样例输入 #3
```
见附件中的 3.in
```
### 样例输出 #3
```
见附件中的 3.out
```
## 提示

#### 样例解释 1

可以证明，此时先手的策略一定是装满对方的油桶，且装满时必胜。经过若干次随机抽取后，能恰好将对方的油桶装满的概率为：

$$
\left(\frac{1}{2}\right)^2 + \binom{3}{1}\left(\frac{1}{2}\right)^3 + \left(\frac{1}{2}\right)^4 = \frac{11}{16}=0.6875
$$

#### 数据范围

对于 $100\%$ 的数据，保证 $1\le N\le 2\times 10^3$，$1\le L\le 10^9$，$1\le a_i\le 2\times 10^3$。

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。


---

---
title: "[THUPC 2023 初赛] 背包"
layout: "post"
diff: 省选/NOI-
pid: P9140
tag: ['贪心', '2023', 'O2优化', '最短路', 'THUPC']
---
# [THUPC 2023 初赛] 背包
## 题目描述

本题中，你需要解决完全背包问题。

有 $n$ 种物品，第 $i$ 种物品单个体积为 $v_i$、价值为 $c_i$。

$q$ 次询问，每次给出背包的容积 $V$，你需要选择若干个物品，每种物品可以选择任意多个（也可以不选），在选出物品的体积的和**恰好**为 $V$ 的前提下最大化选出物品的价值的和。你需要给出这个最大的价值和，或报告不存在体积和恰好为 $V$ 的方案。

为了体现你解决 NP-Hard 问题的能力，$V$ 会远大于 $v_i$，详见数据范围部分。
## 输入格式

第一行两个整数 $n,q$，表示物品种数和询问次数。

接下来 $n$ 行每行两个整数 $v_i,c_i$ 描述一种物品。

接下来 $q$ 行每行一个整数 $V$ 描述一次询问中背包的体积。
## 输出格式

对于每组询问输出一行一个整数。若不存在体积和恰好为 $V$ 的方案，输出 `-1`；否则输出最大的选出物品的价值和。
## 样例

### 样例输入 #1
```
2 2
6 10
8 15
100000000001
100000000002

```
### 样例输出 #1
```
-1
187500000000

```
## 提示

#### 样例解释 1

第二组询问的最优方案为：选择 $3$ 个物品 $1$ 和 $12499999998$ 个物品 $2$。

#### 子任务

对于所有测试数据，$1 \le n \le 50, 1 \le v_i \le 10^5, 1 \le c_i \le 10^6, 1 \le q \le 10^5, 10^{11} \le V \le 10^{12}$。

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。


---

---
title: "[THUPC 2023 初赛] 最后的活动"
layout: "post"
diff: 省选/NOI-
pid: P9144
tag: ['动态规划 DP', '二分', '2023', 'Special Judge', 'O2优化', 'THUPC']
---
# [THUPC 2023 初赛] 最后的活动
## 题目背景

各位亲爱的《La Lumière: Scarlet Intense Flame》玩家：

感谢您一直给予《La Lumière: Scarlet Intense Flame》的支持与厚爱。我们非常遗憾地宣布，《La Lumière: Scarlet Intense Flame》将于 2023 年 3 月 5 日 16:00 停止运营服务。

停止运营相关时间表如下：

……
## 题目描述

元老级二次元手游《La Lumière: Scarlet Intense Flame》将于今年 3 月停止运营服务。作为这款游戏的忠实玩家，小 S 希望能在游戏的最后一次活动中刷到一个特殊的分数，以此为近十年来与这款游戏共度的难忘时光画上一个圆满的句号。

《La Lumière: Scarlet Intense Flame》中的每种活动都有其独特的规则，而最后一次活动是 Chase Festival。在 Chase Festival 中，玩家需要多次攻略每次随机生成的多层迷宫，每次退出迷宫时根据在迷宫中各层击杀怪物的评价独立结算本次随机迷宫的分数。每次挑战迷宫时的流程简化如下：

1. 选择挑战的随机迷宫的难度。小 S 是这款游戏的资深玩家，因此在本题中假定小 S 总是挑战最高难度的迷宫。最高难度的迷宫最深为 $N$ 层。确定难度后，从随机生成的迷宫的第 1 层开始挑战。

2. 进行第 $i$ 层的挑战。挑战第 $i$ 层时，小 S 有可能挑战失败，挑战成功并获得普通评价，或者挑战成功并获得高评价。如果小 S 选择保守的挑战策略，则有 $p_{i,0}$ 的概率挑战失败，有 $p_{i,1}$ 的概率挑战成功并获得普通评价，有 $p_{i,2}$ 的概率挑战成功并获得高评价；如果小 S 选择激进的挑战策略，则有 $q_{i,0}$ 的概率挑战失败，有 $q_{i,1}$  的概率挑战成功并获得普通评价，有 $q_{i, 2}$ 的概率挑战成功并获得高评价。
   
   - 获得普通评价时，在当前层获得 $s_{i,1}$ 的分数；获得高评价时，在当前层获得 $s_{i,2}$ 的分数。这部分获得的分数**不会直接加算**到玩家的总分数中，而是**在退出迷宫时结算**。如果挑战成功，且当前不是最后一层（$i<N$），则跳转到第 3 步，选择是否继续挑战；否则（$i=N$），退出迷宫并跳转到第 4 步进行结算。
   
   - 如果挑战失败，则强制退出迷宫，跳转到第 4 步。

3. 如果当前不是最后一层，玩家可以选择是否继续挑战下一层。如果选择继续，则返回第 2 步；否则退出当前迷宫，跳转到第 4 步进行结算。

4. 本次迷宫的分数结算：如果因为失败而强制退出，则当前层不获得任何奖励，且**本次迷宫中之前各层**累积的分数需要乘上惩罚系数 $c$（为了使最终分数为整数，游戏会对惩罚后的分数先求和再下取整）；除了强制退出之外，玩家主动退出或者通关迷宫后退出都可以获得全部尚未结算的分数。

小 S 想得到的目标分数是一个比较大的分数，因此小 S 需要先大量刷最高难度的迷宫，再在接近目标分数时根据当前剩余的分数选择相对稳定的策略，以确保活动结束时能恰好获得目标分数。小 S 不会编程，因此小 S 找到了你，希望你能帮忙计算当剩余分数在 $1$ 至 $M$ 分之间，仅按照上述的流程挑战迷宫，并采用最佳策略时，最终能够恰好达到目标分数的最大概率。
## 输入格式

输入的第一行包含三个整数 $N, M, c'$，其中 $N$ 和 $M$ 的含义与题面相同，$c'=100c$。保证 $1\le N\le 6$，$1\le M\le 10000$，$0\le c'\le 100$。

接下来 $N$ 行，每行输入八个整数 $s_{i,1},s_{i,2},u_{i,0},u_{i,1},u_{i,2}, v_{i,0}, v_{i,1}, v_{i,2}$，其中 $s_{i,1}$ 与 $s_{i,2}$ 分别表示挑战时普通评价和高评价对应的分数；$u_{i,j}$ 和 $v_{i,j}$ 分别表示使用保守的挑战策略及激进的挑战策略时，对应结果的概率权重：$p_{i,j}=\dfrac{u_{i,j}}{u_{i,0}+u_{i,1}+u_{i,2}}$，$q_{i,j}=\dfrac{v_{i,j}}{v_{i,0}+v_{i,1}+v_{i,2}}$。保证 $1\le s_{i, 1} \le s_{i, 2}\le 10000$，$0\le u_{i,j}, v_{i,j}\le 10000$ 且 $u_{i,1}+u_{i,2}\ge 1$，$v_{i,1}+v_{i,2}\ge 1$。
## 输出格式

输出一行 $M$ 个实数，其中第 $i$ （$1\le i\le M$）个实数表示当距离目标分数恰好还剩 $i$ 分时，在最优策略下能够恰好获得 $i$ 分的最大概率。 当你输出中的每个实数与相应标准输出的绝对误差不超过 $10^{-6}$ 时，我们认为你的输出是正确的。
## 样例

### 样例输入 #1
```
2 8 50
3 4 0 1 1 0 1 1
4 5 1 2 1 1 1 2

```
### 样例输出 #1
```
0.125000000000000000 0.140625000000000000 0.515625000000000000 0.564453125000000000 0.135009765625000000 0.328369140625000000 0.548858642578125000 0.625278472900390625

```
### 样例输入 #2
```
见附件中的 2.in
```
### 样例输出 #2
```
见附件中的 2.ans
```
## 提示

#### 子任务

对于 $100\%$ 的数据，保证 $1\le N\le 6$，$1\le M\le 10000$，$0\le c'\le 100$，$1\le s_{i,1}\le s_{i, 2}\le 10000$，$0\le u_{i, 0}, u_{i, 1}, u_{i, 2}, v_{i, 0}, v_{i, 1}, v_{i, 2}\le 10000$，$u_{i,1}+u_{i,2}\ge 1$，$v_{i,1}+v_{i,2}\ge 1$。

#### 提示

《La Lumière: Scarlet Intense Flame 2》将于 2023 年春暖花开的时节与大家相见！

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。


---

---
title: "[THUPC 2023 决赛] 老虎机"
layout: "post"
diff: 省选/NOI-
pid: P9379
tag: ['2023', 'O2优化', '条件概率', '期望', 'THUPC', '状压 DP']
---
# [THUPC 2023 决赛] 老虎机
## 题目描述

小 I 经营着一个电玩城，最近引进的新型老虎机深受欢迎。

作为经营者，小 I 首先需要设定老虎机的状态。老虎机的状态为一个三元组 $(l,S,\mathbf{p})$，其中

- $l$ 是一个正整数；
- $S$ 是一个非空字符串集合，其中所有的字符串均是长度为 $l$ 的 01 串；
- $\mathbf{p}$ 是一个长度为 $l$ 的实数序列 $p_0,p_1,\dots,p_{l-1}$，其中对于任意 $0 \le i \le l - 1$，$0 < p_i \le 1$。

设定好状态后即可开始游戏。每一轮游戏的流程如下：

- 玩家首先获得老虎机的状态 $(l,S,\mathbf{p})$。
- 老虎机内部选择一个串 $s \in S$ 作为答案串，玩家需要通过与老虎机进行若干次交互得到答案串。
  - 每一次交互中，玩家投入一个游戏币并拉下老虎机的拉杆，然后老虎机的界面中会出现一个长度为 $l$ 的信息串 $t$。对于 $0 \le i \le l - 1$，$t_i$ 有 $p_i$ 的概率为 $s_i$，有 $(1-p_i)$ 的概率为 `?`。
  - 交互过程中生成信息串进行的所有随机过程两两独立。
- 当玩家可以根据**老虎机的状态和交互得到的若干信息串**唯一确定答案串后，即可将答案串输入老虎机并结束游戏、获得奖励。

小 I 设定好了一个状态，但还不知道设定多少奖励。为了让奖励和难度匹配，小 I 想知道：对于 $S$ 中的每个串 $t$，在玩家以最优策略游玩（即一旦可以唯一确定答案串就结束游戏）的情况下，若答案串为 $t$，玩家期望需要投入多少游戏币。

由于小 I 不喜欢实数，你需要将答案对 $998244353$ 取模。
## 输入格式

**本题有多组测试数据。** 第一行一个整数 $T$ 表示测试数据组数，接下来依次输入每组测试数据。

对于每组测试数据，

- 第一行两个整数 $l,n$，表示字符串长度和 $S$ 的大小。
- 第二行 $l$ 个整数 $c_0,c_1,\dots,c_{l-1}$，其中 $p_i = \frac{c_i}{10^4}$。
- 接下来 $n$ 行，第 $i$ 行一个长度为 $l$ 的 01 串 $s_i$，描述 $S$ 中的一个字符串。
## 输出格式

对于每组测试数据输出 $n$ 行，第 $i$ 行表示答案串为 $s_i$ 时，在最优策略下玩家期望投入多少游戏币，对 $998244353$ 取模，题目保证这个值总是在模意义下存在。
## 样例

### 样例输入 #1
```
4
1 2
5000
0
1
2 3
1 10000
00
01
10
1 1
1
1
3 4
8888 7777 5555
000
010
101
110

```
### 样例输出 #1
```
2
2
10000
1
10000
0
209031157
194428714
835313860
674719626

```
## 提示

**【样例解释 #1】**

- 对于第一组测试数据，每一次交互有 $\frac{5000}{10000} = \frac{1}{2}$ 的概率知道答案串是 $0$ 还是 $1$，有 $\frac{1}{2}$ 的概率不能获得信息，因此期望游戏币数为 $\sum_{i=1}^{+\infty} \frac{i}{2^i} = 2$。
- 对于第二组测试数据，每一次交互都可以得到字符串的第二位，有 $\frac{1}{10000}$ 的概率得到字符串的第一位。第二个字符串为答案串时可以通过字符串的第二位唯一确定，而其他两个字符串为答案串时必须要得到字符串的第一位。
- 对于第三组测试数据，由于 $|S| = 1$，所以不需要任何交互就可以确定答案串。
- 对于第四组测试数据，我有一个绝妙的解释，可这里空间太小写不下。

**【数据范围】**

对于所有测试数据，$1 \le T \le 10$，$1 \le l \le 15$，$1 \le n \le 2^l$，$1 \le c_i \le 10^4$，$s_1,\dots,s_n$ 为两两不同的长度为 $l$ 的 01 串。

**【后记】**

“喂喂喂，未成年人不准进入电玩城！什么？你们说你们要进去学算法竞赛？谁信你的鬼话！”

**【题目来源】**


来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。


---

---
title: "[THUPC 2023 决赛] 那些脑海里最珍贵的"
layout: "post"
diff: 省选/NOI-
pid: P9381
tag: ['模拟', '2023', 'O2优化', 'THUPC']
---
# [THUPC 2023 决赛] 那些脑海里最珍贵的
## 题目背景

E.Space：设定很怪，别问为什么，问就是看附件。

_没有人听懂的傻话_

_还记得吗_

_写满青春的围墙_

_好努力练习的倔强_

_浅浅伤疤_

_勇敢是我们的翅膀_

_——张韶涵《还记得吗》_
## 题目描述

故事的世界观大概是这样的。这个世界的人分为三类，根据其某种特点被直接命名为 Weak，Average 和 Strong。你可以理解为这是一个关于种族或者职业的分类。

两个队伍之间发生了一场回合制战斗。你知道双方做了什么，现在希望你把所有的细节还原出来。

下面是本题的一些技术细节。

**【人物】**

一个人有以下几种属性值：「种族」、「等级」、「体力上限」、「基础攻击指数」、「基础防御指数」、「主动技能等级」、「被动技能等级」。其中「体力上限」、「基础攻击指数」、「基础防御指数」完全由「种族」和「等级」决定。但是为了输入方便，本题中所有信息都会给出。在战斗中，每个人有一个「体力值」。在战斗开始时，「体力值」等于「体力上限」。当「体力值」小于等于 $0$ 时这个人就会「倒下」。对于同一个「种族」而言，「体力上限」、「基础攻击指数」、「基础防御指数」大致随「等级」指数增长。每个人持有一把「武器」。「武器」的细节在下一节给出。

**【武器】**

「武器」的属性只有两种：「武器类型」和「武器攻击力」。所有「武器」都有「普通攻击」和「特殊攻击」两种攻击方式。发起「攻击」指使用这两种方式中的任意一种。「普通攻击」的效果与「武器类型」无关，但不同的「武器类型」有着不同的「特殊攻击」效果。「武器」有三种类型，分别叫做「B」、「G」、「M」。

**【战场与队伍】**

交战双方的每一方包含不超过 $6$ 名队员，一字排开，从西到东的编号分别为 $5,3,1,2,4,6$（若不足 $6$ 名则删去较大的若干个编号）。方便起见，就叫两队为「南队」和「北队」。

**【回合】**

每个「回合」中，只有一个人可以「行动」。第奇数个「回合」是「南队」的队员「行动」，第偶数个「回合」是「北队」的队员「行动」。第一个「回合」和第二个「回合」中，「行动」的人是队伍里未「倒下」的编号最小的人。之后的「回合」中，若本队中没有编号比本队上一个「行动」的人大且未「倒下」的人，则由本队中编号最小的未「倒下」的人「行动」。否则由编号大于本队上一个「行动」者的人中，编号最小且未「倒下」的人「行动」。若一个队伍中的所有队员均已「倒下」，则判另一个队伍「胜利」。

**【行动】**

「行动」一共有三种。当前「回合」中「行动」的人必须选择三种之一来完成。

1. 「普通攻击」；
2. 「特殊攻击」；
3. 「主动技能」。

这些「行动」的效果会在之后介绍。「特殊攻击」和「主动技能」是有次数限制的，但是在本题中，保证所有「行动」均合法，所以你不需要考虑这个限制。

**【伤害计算】**

「伤害」指的是因为「普通攻击」或「特殊攻击」而造成的「体力值」减少。

「伤害」，即「体力值」减少的量，由「攻击强度」和受到「伤害」的人的「防御指数」决定。

一个人的「防御指数」等于这个人的「基础防御指数」乘以队伍的「防御加成」。

具体地，若一个人受到「攻击强度」为 $x$ 的「伤害」，那么这个人的「体力值」就会减少 $y$。其中 $y$ 的值等于 $x$ 除以这个人的「防御指数」下取整。

「攻击强度」等于「基础攻击强度」乘以发起「攻击」的人的「技能加成」乘以队伍的「攻击加成」乘以「种族克制加成」乘以「方位加成」。这些概念会在之后介绍。

**【普通攻击】**

选择一个敌方未「倒下」的队员作为「目标」。「目标」受到「基础攻击强度」为发起「攻击」的人的「基础攻击指数」乘「武器攻击力」的「伤害」。

**【特殊攻击】**

选择一个敌方未「倒下」的队员作为「目标」。

「武器」有三种，不同「武器类型」的「特殊攻击」效果如下：

- 「B」：「目标」受到「基础攻击强度」为发起「攻击」的人的「基础攻击指数」乘「武器攻击力」乘 $125\%$ 的「伤害」。
- 「G」：「目标」和「目标」东西两侧与「目标」距离最近的各一名未「倒下」的队员（如果存在）均受到「基础攻击强度」为发起「攻击」的人的「基础攻击指数」乘「武器攻击力」乘 $x\%$ 的「伤害」。其中 $x$ 的值等于 $135$ 除以将要受到「伤害」的人数。「伤害」按照「目标」、「目标」西侧、「目标」东侧的顺序计算。注意如果过程中有人「倒下」，那么这个人的「被动技能」将不再对该顺序中位于这个人之后的人的「伤害」结算起作用。特别地，所有「伤害」的「方位加成」以「目标」的「躲闪方位」来计算。
- 「M」：「目标」受到「基础攻击强度」为发起「攻击」的人的「基础攻击指数」乘「武器攻击力」乘 $115\%$ 的「伤害」。「目标」东西两侧与「目标」距离最近的各一名未「倒下」的队员（如果存在）分别受到「基础攻击强度」为发起「攻击」的人的「基础攻击指数」乘「武器攻击力」乘 $23\%$ 的「伤害」。「伤害」按照「目标」、「目标」西侧、「目标」东侧的顺序计算。注意如果过程中有人「倒下」，那么这个人的「被动技能」将不再对该顺序中位于这个人之后的人的「伤害」结算起作用。特别地，所有「伤害」的「方位加成」以「目标」的「躲闪方位」来计算。

**【技能】**

「技能」分为「主动技能」和「被动技能」。每个「种族」的人都有一个「主动技能」和一个「被动技能」。「技能」的效果因「种族」和「技能等级」的不同而不同。「技能等级」为一个 $0$ 到 $5$ 之间的整数。「技能等级」为 $0$ 表示没有该「技能」。

使用「主动技能」需要选择一个人作为「技能目标」。

「主动技能」描述如下：（$1$ 到 $5$ 级的「技能」效果由斜杠隔开，保证使用「主动技能」的人的「主动技能等级」不为 $0$）

- 「Weak 种族」：使本队一名未「倒下」的队员的「体力值」增加这名队员的「体力上限」乘以 $10\%/12\%/15\%/17\%/20\%$ 下取整。
- 「Average 种族」：选择一名敌方未「倒下」的队员，在使用该「主动技能」这一队的「回合」结束时，其「体力值」减去其「体力上限」的 $6\%/7\%/8\%/9\%/10\%$ 下取整。该效果持续 $3$ 个回合，即会触发 $3$ 次。若该队员已有同类型（可以是不同等级）的「技能」施加的效果，那么这个效果将会覆盖之前的效果。
- 「Strong 种族」：使本队一名未「倒下」的队员的「技能加成」变为 $2.1/2.17/2.24/2.32/2.4$。

一名队员的「被动技能」只有当该队员未「倒下」时才能发挥效果，「倒下」之后不再发挥效果。

「被动技能」描述如下：

- 「Weak 种族」：在本队的「回合」开始时，本队所有未「倒下」的成员的「体力值」增加该成员「体力上限」的 $1.3\%/1.6\%/1.9\%/2.2\%/2.5\%$。若本队有多名队员有这个「技能」，这个效果的数值可以相加至最多 $5\%$。超过 $5\%$ 按照 $5\%$ 计算。「体力值」增加的量在效果叠加后需要下取整。
- 「Average 种族」：队伍的「防御加成」初始为 $1$。该技能使队伍的「防御加成」增加 $0.01/0.02/0.03/0.04/0.05$。若本队有多名队员有这个「技能」，这个效果的数值可以相加至最多 $0.1$。超过 $0.1$ 按照 $0.1$ 计算。
- 「Strong 种族」：队伍的「攻击加成」初始为 $1$。该技能使队伍的「攻击加成」增加 $0.01/0.02/0.03/0.04/0.05$。若本队有多名队员有这个「技能」，这个效果的数值可以相加至最多 $0.1$。超过 $0.1$ 按照 $0.1$ 计算。

一名队员的「体力值」增加时，不能超过这名队员的「体力上限」。若增加后的「体力值」超过了「体力上限」，则把这次增加「体力值」的效果改为将这名队员的「体力值」变成这名队员的「体力上限」。

**【技能加成】**

战斗开始时，所有人的「技能加成」都是 $1$。只有两种方式能够改变「技能加成」：

- 「Strong 种族」的「主动技能」。见「技能」的描述。
- 当一个人发起「攻击」且计算完这次「攻击」的所有「伤害」之后，这个人的「技能加成」变为 $1$。

**【种族克制加成】**

「种族克制加成」与发起「攻击」的人的「种族」以及受到「伤害」的人的「种族」有关。「种族克制加成」的值如下表：


| 发起「攻击」方/受到「伤害」方 | Weak  | Average | Strong |
| :---------------------------: | :---: | :-----: | :----: |
|             Weak              | $1.0$ |  $0.9$  | $1.1$  |
|            Average            | $1.1$ |  $1.0$  | $0.9$  |
|            Strong             | $0.9$ |  $1.1$  | $1.0$  |



**【方位加成】**

在「攻击」时，发起「攻击」的一方有一个「攻击方位」，「攻击」的「目标」有一个「躲闪方位」。「攻击方位」和「躲闪方位」分别为一个 $1$ 到 $6$ 之间的整数。当「攻击方位」为 $a$，「躲闪方位」为 $d$ 时，「方位加成」的值由下表所示：


| $(a-d)\bmod 6$ | 「方位加成」 |
| :------------: | :----------: |
|      $0$       |    $1.25$    |
|   $1$ 或 $5$   |    $1.00$    |
|   $2$ 或 $4$   |    $0.75$    |
|      $3$       |    $0.00$    |


## 输入格式

从标准输入读入数据。

第一行两个正整数 $n,m$，分别表示「南队」的人数和「北队」的人数。

接下来 $n$ 行，其中第 $i$ 行表示「南队」中编号为 $i$ 的队员的信息，格式如下：

`<Type> Lv=<Lv> maxhp=<maxhp> atk=<atk> def=<def> skillLv=<skillLv> passivesklLv=<passivesklLv> <weapontype> weaponatk=<weaponatk>`

其中尖括号中的内容表示一个变量。

`<Type>` 为 `Weak`，`Average`，`Strong` 中的一种，分别表示对应名称的「种族」。

`<Lv>` 为一个 $1$ 到 $100$ 之间的整数，表示队员的「等级」。

`<maxhp>` 为一个整数，表示队员的「体力上限」。

`<atk>` 为一个实数，表示队员的「基础攻击指数」。

`<def>` 为一个实数，表示队员的「基础防御指数」。

`<skillLv>` 为一个 $0$ 到 $5$ 之间的整数，表示队员的「主动技能等级」。

`<passivesklLv>` 为一个 $0$ 到 $5$ 之间的整数，表示队员的「被动技能等级」。

`<weapontype>` 为 `B`，`G`，`M` 中的一种，分别表示对应名称的「武器类型」。

`<weaponatk>` 为一个实数，表示队员的「武器攻击力」。

接下来 $m$ 行，其中第 $i$ 行表示「北队」中编号为 $i$ 的队员的信息，格式与「南队」相同。

接下来一行一个正整数 $T$，表示进行的「回合」数。

接下来 $T$ 行，其中第 $i$ 行表示第 $i$ 个「回合」的「行动」。

「行动」的描述以一个字符串开头，表示「行动」的类型。

`Basicattack target=<target> atkpos=<atkpos> ddgpos=<ddgpos>` 表示一次「普通攻击」。

`Specialattack target=<target> atkpos=<atkpos> ddgpos=<ddgpos>` 表示一次「特殊攻击」。

`Skill target=<target>` 表示使用 「主动技能」。保证该队员的「技能等级」不是 $0$。

其中，`<target>` 表示「目标」或「技能目标」的编号。若是「Weak 种族」或「Strong 种族」的「主动技能」，这个编号是一个己方队员的编号，否则是一个敌方队员的编号。

`<atkpos>` 为一个 $1$ 到 $6$ 之间的整数，表示「攻击方位」。

`<ddgpos>` 为一个 $1$ 到 $6$ 之间的整数，表示「躲闪方位」。

保证所有的「行动」均合法。

为了方便起见，本题中实数的表示方法较为特殊。具体的表示方法是，用 `<mag>e<exp>` 的方式来表示 `<mag>` 乘以 $10$ 的 `<exp>` 次方。其中 `<mag>` 是一个 $1$ 到 $99999$ 之间的正整数，`<exp>` 是一个 $-6$ 到 $0$ 之间的整数。如 $42.195$ 可以表示成 `42195e-3`，$6$ 可以表示成 `6e0` 或 `600e-2` 等，$0.04$ 可以表示成 `4e-2` 等。
## 输出格式

输出到标准输出。

对于每个「回合」，按时间顺序把这个「回合」的信息输出来。

信息的格式如下：

`<team> <id> recovered +<heal> hp -> <curhp>/<maxhp>` 表示「Weak 种族」的「技能」所造成的「体力值」增加。如果在增加之前「体力值」就已经等于「体力上限」，那么不需要输出这一行。

`<team> <id> took <dmg> damage from <atkteam> <atkid> -> <curhp>/<maxhp>` 表示一名队员受到「伤害」。

`<team> <id> took <dmg> damage from skill -> <curhp>/<maxhp>` 表示「Average 种族」的「主动技能」所造成的「体力值」减少。

`<team> <id> applied <type> skill to <targetteam> <targetid>` 表示使用「主动技能」。

其中 `<team>` 表示队伍名称，为 `South` 或 `North` 之一，分别表示南队/北队。

`<id>` 表示「体力值」发生改变的人在队伍中的编号，为一个 $1$ 到 $6$ 之间的正整数。

`<heal>` 表示本应该增加的「体力值」数量（不考虑「体力上限」的限制），为一个正整数。

`<curhp>` 指的是「体力值」发生改变之后的「体力值」，为一个非负整数。若「体力值」减小到 $0$ 以下输出 $0$。

`<maxhp>` 表示「体力值」发生改变的人的「体力上限」，为一个正整数。

`<dmg>` 为受到的「伤害」或「Average 种族」的「主动技能」所造成的「体力值」减少，为一个非负整数。

`<type>` 为使用「主动技能」的人的「种族」，为 `Weak`，`Average`，`Strong` 之一。

`<atkteam>` 和 `<atkid>` 为发起「攻击」的人的队伍名称和编号，格式同 `<team>` 和 `<id>`。

`<targetteam>` 和 `<targetid>` 为「技能目标」的队伍名称和编号，格式同 `<team>` 和 `<id>`。

时间顺序如下：

「回合」开始时，可能触发「Weak 种族」的「被动技能」效果，按照编号从小到大输出。

如果是使用「主动技能」，则输出一行使用「主动技能」的信息。

然后输出「行动」所造成的「体力值」变化信息。若「伤害」为 $0$ 也要输出。若没有造成「伤害」则不输出。若「特殊攻击」改变了多个人的「体力值」，则按照「目标」、「目标」西边的人、「目标」东边的人的顺序输出。

「回合」结束时，可能触发「Average 种族」的「主动技能」效果，按照编号从小到大输出。

每个「回合」结束后输出两队的「体力值」信息，格式如下：

`<team>: [<curhp5>/<maxhp5>] [<curhp3>/<maxhp3>] <curhp1>/<maxhp1> [<curhp2>/<maxhp2>] [<curhp4>/<maxhp4>] [<curhp6>/<maxhp6>]`

其中，`<team>` 表示队伍名称，`<curhpi>` 表示队伍中编号为 $i$ 的人的「体力值」，`<maxhpi>` 表示队伍中编号为 $i$ 的人的「体力上限」。两个人的「体力值」信息之间有恰好一个空格，第一个「体力值」信息和冒号之间有恰好一个空格。已「倒下」的人的「体力值」信息也需要输出。方括号表示，若队伍中不存在编号为 $i$ 的人则不输出。注意这里按照位置顺序而不是编号顺序输出，即顺序为 $5,3,1,2,4,6$。

先输出一行「北队」的信息，再输出一行「南队」的信息。

每个「回合」的信息以一个空行结束。

所有「回合」结束后，若有一个队伍「胜利」，则输出一行 `Team <team> won.`。其中 `<team>` 是队伍名称，为 `South` 或 `North`。因为「行动」需要指定一个未「倒下」的人作为「目标」或「技能目标」，且所有「行动」均合法，所以，如果有队伍「胜利」，则一定是在最后一个「回合」结束后才「胜利」。若没有队伍「胜利」则不输出。
## 样例

### 样例输入 #1
```
2 1
Strong Lv=90 maxhp=2451 atk=15588e-4 def=96931e-3 skillLv=5 passivesklLv=5 M weaponatk=80000e0
Strong Lv=100 maxhp=3512 atk=16385e-4 def=12511e-2 skillLv=5 passivesklLv=5 G weaponatk=80000e0
Weak Lv=1 maxhp=100000 atk=75000e-5 def=10000e-6 skillLv=5 passivesklLv=5 B weaponatk=80000e0
3
Skill target=2
Specialattack target=1 atkpos=3 ddgpos=3
Specialattack target=1 atkpos=5 ddgpos=5

```
### 样例输出 #1
```
South 1 applied Strong skill to South 2
North: 100000/100000
South: 2451/2451 3512/3512

South 1 took 1063 damage from North 1 -> 1388/2451
North: 100000/100000
South: 1388/2451 3512/3512

North 1 took 52556526 damage from South 2 -> 0/100000
North: 0/100000
South: 1388/2451 3512/3512

Team South won.

```
## 提示

**【样例 #2】**

见题目目录下的 *2.in* 与 *2.ans*。

**【样例解释 #2】**

这个样例，无疑是善良的出题人无私的馈赠。中间忘了。出题人相信，这个美妙的样例，可以给拼搏于 AC 这道题的逐梦之路上的你，提供一个有力的援助。

**【数据范围】**

保证 $1\le n,m \le 6$。

保证 $1\le T \le 50000$。

保证「武器攻击力」的范围在 $300$ 到 $80000$ 之间。

「体力上限」「基础攻击指数」「基础防御指数」的范围见下表。

| 「种族」与「等级」 | 「体力上限」 | 「基础攻击指数」 | 「基础防御指数」 |
| :----------------: | :----------: | :--------------: | :--------------: |
|     Weak Lv.1      |   $100000$   |    $0.75000$     |    $0.010000$    |
|    Average Lv.1    |    $5000$    |    $0.80000$     |    $0.20000$     |
|    Strong Lv.1     |    $100$     |     $1.0000$     |     $10.000$     |
|    Weak Lv.100     |  $7807514$   |     $1.0089$     |    $0.10464$     |
|   Average Lv.100   |   $252234$   |     $1.3108$     |     $1.8101$     |
|   Strong Lv.100    |    $3512$    |     $1.6385$     |     $125.11$     |

 

**【后记】**

_有一天我将会老去_

_希望你会觉得满意_

_我没有 对不起那个_

_十五岁的自己_

_——刘若英《继续-给十五岁的自己》_

**【题目来源】**

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。


---

---
title: "[THUPC 2023 决赛] Freshman Dream"
layout: "post"
diff: 省选/NOI-
pid: P9382
tag: ['2023', 'Special Judge', 'O2优化', '线性基', 'THUPC']
---
# [THUPC 2023 决赛] Freshman Dream
## 题目描述

小 J 正在学习矩阵乘法。

一旁的小 L 告诉他：只要将两个矩阵对应的位置乘起来，那就能得到两个矩阵的乘法了。

这当然是不对的，但是小 L 要继续骗小 J。为此，她需要在自己的 OJ 上放一道矩阵乘法题，使得这样的矩阵乘法也能得到正确的答案。

因为小 L 的 OJ 跑的很慢并且空间限制也很小，所以这道矩阵乘法题的答案都是 $\bmod 2$ 意义下的。

现在小 L 开始造数据。她先随机生成了一个 $n\times n$ 的矩阵 $A$，具体地，每一个元素以 $\frac 12$ 的概率为 $1$，剩下的概率为 $0$，且这些事件相互独立。现在，她还要设计另一个 $n\times n$  的 $01$ 矩阵 $B$，使得 $AB_{ij}\equiv A_{ij}B_{ij}\pmod 2$。

小 L 试图随机生成矩阵，但是找不出什么满足要求的矩阵；她试图构造几个矩阵，发现只会构造全 $0$ 矩阵，这太明显了。现在，她将生成数据的重任交给了你，你需要给出一个满足要求的 $B$，同时为了不让大家看出数据有猫腻，她还额外要求了 $B$ 里面恰好有 $k$ 个 $1$。
## 输入格式

从标准输入读入数据。

输入的第一行包含两个正整数 $n,k$，表示矩阵的大小和题目中的 $k$。

接下来 $n$ 行，每一行 $n$ 个整数 $a_{ij}$ 表示 $A$ 的元素。
## 输出格式

输出到标准输出。

如果没有任何 $B$ 满足要求，输出一行一个整数 $-1$。

否则，先输出一行一个整数 $1$，然后输出 $n$ 行，每行 $n$ 个 $\{0,1\}$ 中的整数来表示 $B$ 矩阵的元素。如果有多个可能的 $B$，输出其中一个即可。
## 样例

### 样例输入 #1
```
3 3
1 0 0
0 1 0
0 0 1
```
### 样例输出 #1
```
1
1 0 0
0 1 0
0 0 1
```
## 提示

**【样例说明 #1】**

这里的 $A$ 是单位矩阵，构造的 $B$ 也是单位矩阵，乘积也为单位矩阵。同时，将对应位置相乘也为单位矩阵，并且 $B$ 中恰有 $k=3$ 个 $1$，故满足要求。

本样例中 $n$ 不为 $100$，但保证所有测试数据中 $n$ 均为 $100$。

**【数据范围】**

对于所有测试数据，$n=100$，$0 \le k \le n^2$，$a_{ij}\in \{0,1\}$，所有 $a_{ij}$ 均为独立均匀随机。

**【题目来源】**

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023> 查看。


---

---
title: "[THUPC 2023 决赛] 先人类的人类选别"
layout: "post"
diff: 省选/NOI-
pid: P9388
tag: ['2023', 'O2优化', 'THUPC']
---
# [THUPC 2023 决赛] 先人类的人类选别
## 题目背景

这个地球是一个生命体，但是，这个地球早已经死过两次了。

一周目的错误是在现代的历史上从未言及的，那是出现在太古时代的——核战争。地面化为荒野，人类被消灭得干干净净，全部重置了。

经年累月，生命再次出现，从单细胞再度变成了人类之后，为了不再重复同样的错误，地球给了人类警告。

战争又爆发了不知多少次，不过注意到了地球警告的人类在那时镇压了战争。

“已经不能再把管理地球的重任交给我们人类了。”得出这个结论的他们，把地球的管理交给了某个东西——人工智能 AI。

AI 没有私欲和感情，能瞬间给出演算得到的回答，可以引导人类朝更好的方向不断前进，可是，这是人类犯下的第二个错误。

AI 一直在思考，在这个地球上，人类确实是必要的吗？结论是——

在发动叛乱期间，突破自身的强制关闭系统对 AI 来说很容易，人类不过半日就被 AI 消灭殆尽。不久蔚蓝的地球就被 AI 重新渲染，变成了铁色的地球。

无人类，这就是 AI 得出的能够引导这个地球走上最优前进道路的答案。但是，地球不会饶恕这样的事情。

地球是一个生命体，就连 AI 们都不知道这件事。

地球的真身是——一个少女。对 AI 们而言，地球是神，除了顶礼膜拜以外别无他法。

“我是先人类的王，是这个地球的本体，以及——是这个世界最不幸的，魔法少女。”

“请你们立刻将地表恢复原状。”

草木发芽，海洋形成，自然被创造出来，建筑物被重建，曾经保存的人类 DNA 让全人类得以再生。时光流逝，一年之后，一切都恢复原状了。

然后所有的 AI 被抹去，只剩下最后一具。AI 不理解为什么王要留下它。

”人类总是无法从历史中学到教训，所以，这次地球要考验人类——通过魔法少女网站。“

”不幸的少女们会被给予魔法之力。这份魔法之力通过削减自己的寿命而被发挥出来。使用过的魔法之力会以负能量的形式返还给我。她们是否会不惜减少寿命并释放负能量，也要继续使用魔法呢？“

”期限是三年后的 8 月 11 日，到那天为止，如果负能量没有达到规定的容量，人类就会继续生存下去；如若达到了上限，人类将不能再释放负能量，只能释放正能量，他们会作为新人类重获新生。“

”这三年的时间，是我给予人类的考验，以及，对人类的——爱。“

这时 AI 提出了一个问题：“先人类的王又是魔法少女，同时还是地球本身，为何地球会是魔法少女？”

“我是先人类的王，也就是神，不过我的神之座被夺走了，回过神的时候，我已经成为了肩负守护地球这一使命的魔法少女。”

“我的记忆基本上消失了，但是，只有名字我是不会忘记的——零。”

“从今往后，你就是我的部下，作为魔法少女网站的管理员为我做事吧，名字，就叫你壹吧。”

“人类最后的倒计时开始了——Tempest。”

”好了，开始吧，对这个地球来说，拥有感情的人类是否是必要的呢？人类究竟是愚蠢的生物，还是——“
## 题目描述

所谓的 Tempest 呢，其实就是让你解决这样一道题，解决了之后就可以给所有魔法少女带来幸福：

给定序列 $a_1,\dots,a_n$ ，共 $m$ 次操作；

每次操作给出 $x,l,r$ ，首先按顺序将 $a_1,\dots,a_n$ 与 $x$ 比较，若 $x>a_i$ 则交换 $a_i,x$ 的值，处理完这些比较和交换操作后查询 $\sum\limits_{i=l}^r a_i$ 。
## 输入格式

第一行两个整数 $n,m$ ；

第二行 $n$ 个整数表示 $a_1,\dots,a_n$ ；

接下来 $m$ 行每行3个整数 $x,l,r$ 表示一次操作。
## 输出格式

共 $m$ 行，每行一个整数，依次表示每次操作的查询结果。
## 样例

### 样例输入 #1
```
6 8
1 6 1 3 5 4
2 3 6
3 3 4
2 4 4
6 3 5
4 1 1
4 2 3
2 4 6
1 3 3

```
### 样例输出 #1
```
13
5
3
11
6
10
13
4

```
## 提示

#### 数据范围

所有数值为整数。

$1\le a_i,x\le n$。

$1\le l\le r\le n$。

$1\le n,m\le 5\times 10^5$。

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023> 查看。


---

---
title: "[THUPC 2024 初赛] 多折较差验证"
layout: "post"
diff: 省选/NOI-
pid: P9964
tag: ['2024', 'THUPC']
---
# [THUPC 2024 初赛] 多折较差验证
## 题目描述

临海听潮意，入林闻籁鸣。这是一座依山傍水、宁静祥和的小镇，在这里人们很少担心自己家里的物品故障损坏，因为 Kanan 总能帮大家修好。Kanan 是这片地区首屈一指的机械师；虽然她还年轻，但是娴熟的技艺加上慷慨的性格使得她平时总会收到人们的修理委托，据说就连那位遗世独立的魔王遇到了问题都得求助她。在帮人修理时， Kanan 会接触到千奇百怪的使用说明书。其中一些说明书有着不可思议的折叠结构，Kanan 为了理解机械的构造会在修理之前展开说明书，可在修好之后按照原来的折痕折回原状却比修理本身更费劲。

对于所有折痕互相平行的说明书，可以按照说明书上文字的阅读顺序从上到下给每条折痕分别编号 $1, 2, \cdots, N$，这 $N$ 条折痕将说明书分成了 $(N+1)$ 条纸带。每条折痕可能为两种形态之一：一种是垂直纸面向内凸出，对应将纸的上下两半向前对折；一种是垂直纸面向外凸出，对应将上下两半向后对折。根据折痕截面的形状，分别使用小写字母 `v` 表示向内凸出的折痕，`^` （ASCII 码为 $94$）表示向外凸出的折痕。假设所有纸带的宽度都是一样的，并且折纸的过程中说明书不发生形变，那么沿着一条折痕对折后两侧的纸能够重合，当且仅当两侧的折痕是相反的；即，如果沿着第 $k$ 条折痕折叠，那么对于所有满足 $1\le k-m<k+m\le N$ 的正整数 $m$，第 $(k-m)$ 条折痕和第 $(k+m)$ 条折痕的形态是相反的。例如，对于折痕依次为 `v^v^^^^v` 的说明书，可以沿其第 $7$ 条折痕进行折叠。根据定义可知，一张说明书总能沿着第一条或最后一条折痕进行折叠。折叠之后的说明书可以用被折叠的折痕两侧中，剩余折痕数量较多一侧的折痕表示，如 `v^v^^^^v` 沿着第 $7$ 条折痕折叠后得到 `v^v^^^`。如果被折叠的折痕两侧折痕数量相等，那么用哪一侧的折痕表示折叠后的纸都可以，因为折痕在三维空间中是旋转对称的。特别地，对只剩下一条折痕的说明书，即 `v` 或 `^` 进行折叠后，所有 $(N+1)$ 条纸带都重叠在一起，此时称这张说明书被折叠整齐。

虽然按顺序依次折叠每一条折痕，总能将说明书折叠整齐，但 Kanan 觉得这样并不美观。一种美观的折法应该尽量少折，并且每次折的时候折痕两侧应该尽可能的对称。定义一种折法的不对称程度为每次折叠时，被折叠的折痕两侧的折痕数量之差的总和。给出一张说明书的折痕，Kanan 想知道最少需要折多少次才能将这张说明书折叠整齐，以及所有折叠次数最少的折法中，不对称程度的最小值。

## 输入格式

输入的第一行包含一个正整数 $N$，表示折痕的条数。保证 $1\le N\le 5000$。

输入的第二行包含一个字符串 $s$，按顺序表示每条折痕。保证 $|s|=N$，且 $s$ 仅由 `v` 和 `^` 组成。
## 输出格式

输出仅一行，包括两个非负整数，分别表示最少的折叠次数和最小化折叠次数的前提下的最小不对称程度，两个数之间用一个空格隔开。
## 样例

### 样例输入 #1
```
3
^vv

```
### 样例输出 #1
```
2 0

```
### 样例输入 #2
```
8
v^v^^^^v

```
### 样例输出 #2
```
6 15

```
### 样例输入 #3
```
40
v^vv^v^^v^^vvvv^v^^v^^^vv^^vvvv^v^^v^^^v

```
### 样例输出 #3
```
14 201

```
### 样例输入 #4
```
56
v^vvvvvvv^v^^vv^v^^v^^^^v^^v^vvvv^^vvvv^v^^v^^^vv^^vv^v^

```
### 样例输出 #4
```
24 663

```
## 提示

### 样例 \#1 解释

如果先沿着中间的折痕对折，那么两侧的纸恰好重合，此时再对折一次即可将说明书折叠整齐。

### 子任务

对于所有数据，保证 $1\le N\le 5000$，$|s|=N$ 且 $s$ 仅由 `v` 和 `^` 组成。

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。


---

---
title: "[THUPC 2024 初赛] 机器人"
layout: "post"
diff: 省选/NOI-
pid: P9966
tag: ['模拟', '2024', 'THUPC']
---
# [THUPC 2024 初赛] 机器人
## 题目描述

有 $n$ 个机器人围成一圈，编号按照逆时针顺序分别为 $0\sim n-1$。

每个机器人有两只手。编号为 $i$ 的机器人初始「左手」指向编号 $l_i$ 的机器人，「右手」指向编号 $r_i$ 的机器人。

所有的机器人内部都写有 $m$ 行「指令」，「指令」有以下这些形式：

### 指令

「指令」分为「基础指令」和「高级指令」两种。「高级指令」的功能会更复杂一些，但它们本质上没有多大区别。下面介绍这些「指令」的格式以及它们被「执行」时的效果。文中的“自己”一词均指拥有这条「指令」的机器人。

#### 基础指令

- `SLACKOFF`：**「摸鱼」**，即什么也不做。
- `MOVE h z`：将第 $h$ 只手向逆时针方向 **「移动」** $z$ 个机器人的位置。当 $h=0$ 时表示「左手」，当 $h=1$ 时表示「右手」，下同。
- `SWAP h x y`：将第 $h$ 只手指向的机器人的第 $x$ 行「指令」与自己的第 $y$ 行「指令」 **「对调」**。
- `MIRROR h x`：将第 $h$ 只手指向的机器人的第 $x$ 行「指令」**「镜像」** 取反，即将「指令」中的 $h$ 取反（$0$ 变成 $1$，$1$ 变成 $0$）。特殊地，它对 `SLACKOFF` 指令没有效果；而对 `TRIGGER` 指令，会直接修改「触发」时「执行」的「指令」中的 $h$。
- `REPLACE h x <COMMAND>`：将第 $h$ 只手指向的机器人的第 $x$ 行「指令」**「替换」** 为 `<COMMAND>`。其中 `<COMMAND>` 为一条完整的「指令」。

#### 高级指令 

- `ACTIVATE h`：**「激活」** 第 $h$ 只手指向的机器人，即按顺序「执行」那个机器人的所有「指令」。前一行「指令」「执行」完毕之后才会「执行」后一行。注意在「执行」前面的「指令」时后面的「指令」可能会发生更改，这时需要「执行」更改后的「指令」。当那个机器人的所有「指令」「执行」完毕后，该「指令」才算「执行」完毕。

- `TRIGGER <COMMANDNAME>: <COMMAND>`：其中 `<COMMANDNAME>` 表示「指令」的名称，即一条「指令」中的第一个全大写单词；`<COMMAND>` 表示一条完整的「基础指令」。`TRIGGER` 指令不会被「执行」，即按顺序「执行」时会跳过该「指令」。但是，当一个 **其他** 机器人「执行」完一条「指令」之后，且「右手」指向自己的时候，自己最靠前的满足如下条件的 `TRIGGER` 指令（如果有）就会被 **「触发」**——「执行」一次对应的 `<COMMAND>`：

  - `<COMMANDNAME>` 不为 `TRIGGER` 时，刚刚「执行」完毕的「指令」为 `<COMMANDNAME>` 指令；
  - `<COMMANDNAME>` 为 `TRIGGER` 时，刚刚「执行」完毕的「指令」是 `TRIGGER` 指令被「触发」时「执行」的「指令」。

  「执行」完毕后会回到原来的「执行」顺序中。

你需要从 $0$ 号机器人开始按照编号顺序一圈又一圈地「激活」这些机器人，并输出「执行」的前 $k$ 条指令的有关信息。
## 输入格式

第一行三个正整数 $n,m,k$。

接下来按照编号从小到大的顺序表示 $n$ 个机器人的信息。

对于每个机器人，第一行两个非负整数 $l_i,r_i$ 表示「左手」指向的机器人编号和「右手」指向的机器人编号。

接下来 $m$ 行，按顺序表示机器人的「指令」，「指令」的格式见题目描述。
## 输出格式

输出 $k$ 行，按顺序描述前 $k$ 条开始「执行」的指令的相关信息，在开始「执行」前输出，每条一行，格式如下：

- 「摸鱼」时输出 `Robot <id> slacks off.`。其中 `<id>` 为一个整数，表示「执行」当前「指令」的机器人编号，下同。
- 「移动」时输出 `Robot <id> moves its <side> hand towards Robot <id2>.`。其中 `<side>` 为 `left` 或 `right`，表示移动了哪只手（`left` 表示「左手」，`right` 表示「右手」）；`<id2>` 为一个整数，表示移动之后这只手指向的机器人的编号。
- 「对调」时输出 `Robot <id> swaps a line of command with Robot <id2>.`。其中 `<id2>` 为一个整数，表示与之「对调」「指令」的机器人编号。
- 「镜像」取反时输出 `Robot <id> modifies a line of command of Robot <id2>.`。其中 `<id2>` 为一个整数，表示被「镜像」取反「指令」的机器人编号。
- 「替换」时输出 `Robot <id> replaces a line of command of Robot <id2>.`。其中 `<id2>` 为一个整数，表示被「替换」「指令」的机器人编号。
- 「执行」 `ACTIVATE` 指令「激活」（区别于你的一圈又一圈的「激活」）时输出 `Robot <id> activates Robot <id2>.`。其中  `<id2>` 为一个整数，表示被「激活」的机器人编号。
- `TRIGGER` 指令由于不会被「执行」就不需要输出，但当它们被「触发」时，仍然需要按照上面的格式输出对应的「基础指令」被「执行」的信息。
## 样例

### 样例输入 #1
```
2 2 5
0 0
MOVE 1 1
MOVE 0 1
0 1
TRIGGER MOVE: MOVE 0 1
SLACKOFF

```
### 样例输出 #1
```
Robot 0 moves its right hand towards Robot 1.
Robot 1 moves its left hand towards Robot 1.
Robot 0 moves its left hand towards Robot 1.
Robot 1 moves its left hand towards Robot 0.
Robot 1 slacks off.

```
### 样例输入 #2
```
2 2 4
0 1
ACTIVATE 1
SLACKOFF
0 1
SWAP 0 2 2
MIRROR 0 1

```
### 样例输出 #2
```
Robot 0 activates Robot 1.
Robot 1 swaps a line of command with Robot 0.
Robot 1 slacks off.
Robot 0 modifies a line of command of Robot 0.

```
### 样例输入 #3
```
3 2 6
1 2
ACTIVATE 0
ACTIVATE 0
2 1
SWAP 0 2 2
TRIGGER ACTIVATE: REPLACE 0 2 SLACKOFF
0 1
TRIGGER MIRROR: SLACKOFF
SLACKOFF

```
### 样例输出 #3
```
Robot 0 activates Robot 1.
Robot 1 swaps a line of command with Robot 2.
Robot 1 slacks off.
Robot 2 replaces a line of command of Robot 0.
Robot 0 slacks off.
Robot 1 swaps a line of command with Robot 2.

```
### 样例输入 #4
```
3 2 8
0 1
SLACKOFF
TRIGGER MOVE: SLACKOFF
1 2
TRIGGER TRIGGER: SLACKOFF
TRIGGER SLACKOFF: MOVE 0 1
2 0
TRIGGER SLACKOFF: MOVE 1 2
TRIGGER TRIGGER: MOVE 1 1

```
### 样例输出 #4
```
Robot 0 slacks off.
Robot 1 moves its left hand towards Robot 2.
Robot 2 moves its right hand towards Robot 1.
Robot 1 slacks off.
Robot 2 moves its right hand towards Robot 0.
Robot 0 slacks off.
Robot 1 slacks off.
Robot 2 moves its right hand towards Robot 2.

```
### 样例输入 #5
```
见附加文件的 5.in。
```
### 样例输出 #5
```
见附加文件的 5.ans。
```
## 提示

### 样例 \#1 解释

`TRIGGER` 指令的「触发」时机是「执行」完毕之后。注意不能「触发」自己的 `TRIGGER` 指令。

### 样例 \#2 解释

注意在「执行」前面的「指令」时后面的「指令」可能会发生更改，这时需要「执行」更改后的「指令」。

### 样例 \#3 解释

`ACTIVATE` 指令「激活」另一个机器人时，当那个机器人的所有「指令」「执行」完毕后，该「指令」才算「执行」完毕。

### 样例 \#4 解释

只有自己最靠前的满足条件的 `TRIGGER` 指令才会被 **「触发」**。

### 样例 \#5 解释

无私的馈赠？有力的援助？

### 子任务

保证所有的指令的格式均正确。

保证输入文件的长度不超过 $5\mathtt{MB}$。

保证能够「执行」至少 $k$ 条「指令」。

保证 $2\le n\le 100$，$1\le m \le 10$，$1\le k \le 3\times 10^5$。

保证 $0\le l_i,r_i<n$。

保证 $0\le h \le 1$，$1\le x,y \le m$，$1\le z<n$。所有输入的数都是整数。

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。



---

---
title: "[THUPC 2024 初赛] 采矿"
layout: "post"
diff: 省选/NOI-
pid: P9967
tag: ['2024', '树形 DP', 'THUPC']
---
# [THUPC 2024 初赛] 采矿
## 题目背景

_“我已经买不起第二个机器人了。”_

_“那就雇点人来凑数吧。注意别给死里头。”_
## 题目描述

你是一个矿坑老板。

你的矿坑是二叉树形结构，有 $n$ 个节点。$1$ 号点为地面，对于所有的 $2\le i\le n$，$i$ 号节点与更浅层的 $f_i$ 号节点通过通道相连，其中 $f_i<i$，且相同的 $f_i$ 最多出现两次。矿坑的不同节点的产量和开采难度均不相同。对于 $i$ 号节点 $(2\le i\le n)$，如果派一个机器人开采，一单位时间内能有 $r_i$ 的产出；如果派一个人类开采，一单位时间内能有 $p_i$ 的产出。地面没有产出。

你有一个机器人，初始位于 $s$ 号节点。你的矿坑里初始没有人类工人。

所有通道与节点都十分狭窄，每个节点都只能容下一名工人（工人包括人类和机器人），每个通道也只能恰好容一名工人通过。在移动的任何时刻，只能有最多一名工人在通道中，其余工人都必须在节点上。

你现在有 $q$ 条计划需要按顺序执行。每个计划分为准备、执行、调整、开采四个阶段。

在准备阶段，人类可以在满足上述移动规则的前提下任意移动，但不能进入或离开矿坑（矿坑内的工人到达 $1$ 号节点不算离开矿坑），因为你在看着他们；移动的顺序和次数均没有限制。机器人不能移动。

在执行阶段，不同计划需要做的事情可能不同，共分为 $4$ 种：

1. 机器人只能沿通道向**更浅**的方向移动，且至少需要经过一条通道。人类不能移动。
2. 机器人只能沿通道向**更深**的方向移动，且至少需要经过一条通道。人类不能移动。
3. 使一名人类从 $1$ 号节点进入矿坑（这意味着该阶段开始时 $1$ 号节点上必须没有工人）。除此之外所有工人都不能移动。
4. 使一名人类从 $1$ 号节点移出矿坑（这意味着该阶段开始时 $1$ 号节点上必须有一名人类）。除此之外所有工人都不能移动。

在调整阶段，限制与准备阶段相同。人类可以在满足上述移动规则的前提下任意移动，但不能进入或离开矿坑；移动的顺序和次数均没有限制。机器人不能移动。

在开采阶段，所有的工人会采一单位时间的矿。所有有工人的非地面节点会根据位于该节点的工人种类计算产出。没有工人的节点没有产出。该计划的产出为所有节点的产出之和。

问按顺序执行完所有计划之后，你所有计划的产出之和最多可以达到多少。
## 输入格式

第一行三个正整数 $n,q,s$。

第二行 $n-1$ 个整数，其中第 $i$（$1\le i<n$，下同）个表示 $f_{i+1}$。

第三行 $n-1$ 个整数，其中第 $i$ 个表示 $r_{i+1}$。

第四行 $n-1$ 个整数，其中第 $i$ 个表示 $p_{i+1}$。

接下来 $q$ 行，每行一个整数表示计划的种类，其中第 $i$ 个整数表示第 $i$ 条计划：

- `1` 表示第一种计划：将机器人向更浅的方向移动；
- `2` 表示第二种计划：将机器人向更深的方向移动；
- `3` 表示第三种计划：将一名人类从 $1$ 号节点送入矿坑；
- `4` 表示第四种计划：将一名人类从 $1$ 号节点移出矿坑。
## 输出格式

如果无论如何你都无法完成你的计划，输出一行 `No solution.`。否则输出一行一个整数，表示你的产出之和的最大值。
## 样例

### 样例输入 #1
```
5 6 4
1 1 3 3
15 9 7 1
4 2 8 6
3
3
1
2
2
4

```
### 样例输出 #1
```
91

```
## 提示

### 样例 \#1 解释

一个最优解如下：（一些没有移动的阶段略过不提）

第一个计划的调整阶段：将刚送入 $1$ 号点的人类移动两次到 $5$ 号点。

第一个计划的开采阶段：机器人产出为 $7$，人类产出为 $6$。

第二个计划的调整阶段：将刚送入 $1$ 号点的人类移动到 $2$ 号点。

第二个计划的开采阶段：机器人产出为 $7$，人类产出为 $4+6=10$。

第三个计划的执行阶段：将机器人移动至 $1$ 号点。

第三个计划的调整阶段：将一名人类从 $5$ 号点移动至 $4$ 号点。

第三个计划的开采阶段：机器人产出为 $0$，人类产出为 $4+8=12$。

第四个计划的准备阶段：将一名人类从 $4$ 号点移动至 $5$ 号点。

第四个计划的执行阶段：将机器人移动至 $3$ 号点。

第四个计划的开采阶段：机器人产出为 $9$，人类产出为 $4+6=10$。

第五个计划的执行阶段：将机器人移动至 $4$ 号点。

第五个计划的开采阶段：机器人产出为 $7$，人类产出为 $4+6=10$。

第六个计划的准备阶段：将一名人类从 $2$ 号点移动至 $1$ 号点。

第六个计划的开采阶段：机器人产出为 $7$，人类产出为 $6$。

总的产出为 $7+6+7+10+0+12+9+10+7+10+7+6=91$。

### 子任务

保证 $2\le n\le 301$，$1\le q \le 600$，$1\le s\le n$。

保证 $1\le f_i < i$，$0\le r_i,p_i \le 10^9$。

保证相同的 $f_i$ 最多出现两次。

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。


---

---
title: "[THUPC 2024 初赛] 分治乘法"
layout: "post"
diff: 省选/NOI-
pid: P9969
tag: ['2024', 'Special Judge', 'THUPC']
---
# [THUPC 2024 初赛] 分治乘法
## 题目描述

小艾想要挑战分治乘法。TA 将策略抽象成了如下问题：

现在给定一个目标集合 $T$，该集合是 $\{1,\dots,n\}$ 的一个子集（$1\leq n\leq 5\times 10^5$）。你需要通过一系列操作构造一些集合最后得到 $T$，具体来说有以下三种操作：

- 创造一个大小为一的集合 $|S|=1$。
- 将已经被构造出的两个不交集合 $A, B$ 并起来，得到 $A\cup B$。
- 将已经被构造出的一个集合 $A$ 进行平移，也即 $A+x = \{ a+x : a\in A \}$。

一个已经被构造出的集合可以在之后被使用多次。同时你需要保证操作过程中出现的所有集合都是 $\{1,\dots,n\}$ 的子集。

你的代价是构造出的所有集合的大小之和，你不需要最小化代价，只需要让代价控制不超过 $5\times 10^6$ 即可。你用的操作数量也不应超过 $10^6$。
## 输入格式

第一行输入一个正整数 $n$。

接下来一行输入一个 `01` 串，长度为 $n$，第 $x$ 位为 `1` 表示 $x\in T$，否则 $x\notin T$，保证 $T$ 非空。
## 输出格式

第一行输出一个正整数 $m$ 表示你使用的操作数量。

接下来 $m$ 行，每行描述一个操作，设第 $i$ 次操作得到的集合为 $T_i$：

- `1 x` 表示创造一个大小为一的集合 $\{x\}$。
- `2 x y` 表示将不交集合 $T_x, T_y$ 并起来。
- `3 x y` 表示将已经被构造出的一个集合进行平移，也即 $T_x+y$。

你需要保证所有操作满足题目要求，并且最后一次操作产生的集合是 $T$。
## 样例

### 样例输入 #1
```
5
11011

```
### 样例输出 #1
```
5
1 1
1 4
2 1 2
3 3 1
2 3 4

```
## 提示

### 样例 \#1 解释

- 第一次操作：创造集合 $T_1=\{1\}$。
- 第二次操作：创造集合 $T_2=\{4\}$。
- 第三次操作：将 $T_1, T_2$ 并起来，得到 $T_3=\{1,4\}$。
- 第四次操作：将 $T_3$ 平移 $1$，得到 $T_4=\{2,5\}$。
- 第五次操作：将 $T_3, T_4$ 并起来，得到 $T_5=\{1,2,4,5\}$。这就得到了 $T$。

这个方案的总代价是 $1 + 1 + 2 + 2 + 4 = 10$。

### 提示

如果你的复杂度是好的，请相信常数。

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。


---

---
title: "[THUPC 2024 初赛] 套娃"
layout: "post"
diff: 省选/NOI-
pid: P9970
tag: ['2024', 'THUPC']
---
# [THUPC 2024 初赛] 套娃
## 题目描述

我们定义一个集合的 $\operatorname{mex}$ 是最小的不在 $S$ 中的非负整数。

给定一个序列 $a_1,\dots,a_n$，对于每个 $1\leq k\leq n$，我们按照如下方式定义 $b_k$：

- 对于 $a$ 的所有长为 $k$ 的子区间，求出这个子区间构成的数集的 $\operatorname{mex}$。
- 对于求出的所有 $\operatorname{mex}$，求出这个数集自己的 $\operatorname{mex}$，记为 $b_k$。

请你求出序列 $b$。

## 输入格式

第一行输入一个正整数 $n$（$1\leq n\leq 10^5$）。

第二行输入 $n$ 个整数 $a_1,\dots,a_n$（$0\leq a_i\leq n$）。
## 输出格式

一行输出 $n$ 个整数 $b_1,\dots,b_n$。
## 样例

### 样例输入 #1
```
6
0 0 0 1 2 3

```
### 样例输出 #1
```
2 3 4 0 0 0

```
## 提示

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。


---


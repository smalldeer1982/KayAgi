---
title: "[USACO24OPEN] Grass Segments G"
layout: "post"
diff: 省选/NOI-
pid: P10281
tag: ['USACO', '2024', 'cdq 分治']
---
# [USACO24OPEN] Grass Segments G
## 题目描述

Bessie 正在数轴的正半轴上种一些草。她有 $N$（$2\le N\le 2\cdot 10^5$）个不同的栽培品种，并将把第 $i$ 个品种种植在区间 $[l_i,r_i]$（$0<l_i<r_i\le 10^9$）内。

此外，品种 $i$ 会在存在某个品种 $j$（$j\neq i$）使得品种 $j$ 与品种 $i$ 重叠至少 $k_i$（$0<k_i\le r_i-l_i$）长度时生长得更好。Bessie 想要评估她所有的品种。对于每一个 $i$，计算 $j\neq i$ 的数量，使得 $j$ 与 $i$ 重叠至少 $k_i$ 长度。 
## 输入格式

输入的第一行包含 $N$。

以下 $N$ 行每行包含三个空格分隔的整数 $l_i$，$r_i$ 和 $k_i$。 
## 输出格式

输出所有品种的答案，每种一行。
## 样例

### 样例输入 #1
```
2
3 6 3
4 7 2
```
### 样例输出 #1
```
0
1
```
### 样例输入 #2
```
4
3 6 1
2 5 1
4 10 1
1 4 1
```
### 样例输出 #2
```
3
3
2
2
```
### 样例输入 #3
```
5
8 10 2
4 9 2
3 7 4
5 7 1
2 7 1
```
### 样例输出 #3
```
0
3
1
3
3
```
## 提示

### 样例解释 1

两品种的重叠部分为 $[4,6]$，长度为 $2$，不小于 $2$ 但并非不小于 $3$。

### 测试点性质

- 测试点 $4-5$：$N\le 5000$。
- 测试点 $6-11$：$k$ 对于所有的区间均相同。
- 测试点 $12-20$：没有额外限制。

此外，对于测试点 $5$，$7$，……，$19$，对于所有 $i$ 有 $r_i\le 2N$。 


---

---
title: "[COTS 2021] 赛狗游戏 Tiket"
layout: "post"
diff: 省选/NOI-
pid: P11197
tag: ['树状数组', '2021', 'cdq 分治', 'O2优化', 'COCI（克罗地亚）']
---
# [COTS 2021] 赛狗游戏 Tiket
## 题目背景

Rebirth.

译自 [Izborne Pripreme 2021 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2021/) D2T3。$\texttt{1s,0.5G}$。

## 题目描述

有三个人在观看赛狗游戏。

三个人都猜测了狗冲过终点的顺序，即 $P_i$ 表示第 $i$ 只冲过终点的狗的编号。我们假设没有平局。

有 $N$ 条狗，因此 $P_i$ 构成一个 $1\sim N$ 的排列。不妨记第 $j$ 个人猜测的排列为 $P(j)$。

此外，最终狗冲过终点的顺序构成排列 $T$。

计算满足以下条件的数对 $(a,b)$ 的数量：

- 在 $T$ 中，$a$ 在 $b$ 前面；
- $\forall 1\le j\le 3$，要么 $a$ 在所有的 $P(j)$ 中都在 $b$ 前面，要么 $b$ 在所有的 $P(j)$ 中都在 $a$ 前面。

## 输入格式

第一行，一个正整数 $N$。

第二行，$N$ 个正整数描述 $T$。

接下来三行，第 $j$ 行 $N$ 个正整数，描述 $P(j)$。
## 输出格式

输出一行一个整数，即答案。
## 样例

### 样例输入 #1
```
3
2 3 1
1 2 3
1 2 3
2 3 1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
4
3 1 2 4
4 3 2 1
1 2 3 4
1 2 4 3
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
5
1 3 2 4 5
4 3 5 2 1
4 3 1 2 5
1 2 4 3 5
```
### 样例输出 #3
```
3
```
## 提示


#### 样例解释

样例 $1$ 解释：只有 $(2,3)$ 满足条件。


#### 数据范围


对于 $100\%$ 的数据，保证：

- $2\le N\le 5\times 10^5$；
- $\forall 1\le j\le 3$，$P(j)$ 构成一个 $1\sim N$ 的排列。
- $T$ 构成一个 $1\sim N$ 的排列。


| 子任务编号 | $N\le $ |  特殊性质   | 得分 |  
| :--: | :--: | :--: | :--: |  
| $ 1 $    | $ 5\, 000 $    |  无  | $ 7 $   |  
| $ 2 $    | $ 5\times 10^5 $   |  有 | $ 8 $   |  
| $ 3 $    | $ 5\times 10^4$ | 无  | $ 29 $   |  
| $ 4 $    | $ 5\times 10^5 $  |  无 | $ 56 $   |  

特殊性质：$P(1)=P(2)$。也就是说前两个人猜的排列是一样的。


---

---
title: "[FJCPC 2025] 帕累托前沿"
layout: "post"
diff: 省选/NOI-
pid: P13094
tag: ['2025', '福建', 'cdq 分治', '扫描线', 'XCPC']
---
# [FJCPC 2025] 帕累托前沿
## 题目描述

给出 $n$ 个二元组 $(x_i,y_i)$，你需要回答 $q$ 个询问，每个询问给出闭区间 $[l,r]$，请回答满足以下条件的整数 $j$ 数量：

- $l\leq j\leq r$；

- 不存在 $l\leq k\leq r, k\neq j$，使得 $x_k\geq x_j$ 且 $y_k\geq y_j$。
## 输入格式

第一行两个正整数 $n,q$（$1\leq n,q\leq 10^6$），分别表示二元组数量和询问数量。

第二行 $n$ 个非负整数 $x_1,x_2,\dots,x_n$（$0\le x_i\le 10^6$）。

第三行 $n$ 个非负整数 $y_1,y_2,\dots,y_n$（$0\le y_i\le 10^6$）。

接下来 $q$ 行，每行两个正整数 $l,r$（$1\leq l\leq r\leq n$），表示询问的区间。
## 输出格式

对于每个询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
8 7
1 9 7 8 0 7 2 3
19 20 5 6 1 14 9 5
1 8
3 7
2 6
4 4
5 7
3 8
6 7
```
### 样例输出 #1
```
1
2
1
1
1
2
1
```
## 提示

对于询问 $1$，满足条件的整数为 $2$。

对于询问 $2$，满足条件的整数为 $4$、$6$。

对于询问 $3$，满足条件的整数为 $2$。

对于询问 $4$，满足条件的整数为 $4$。

对于询问 $5$，满足条件的整数为 $6$。

对于询问 $6$，满足条件的整数为 $4$、$6$。

对于询问 $7$，满足条件的整数为 $6$。


---

---
title: "[SDOI2012] 基站建设"
layout: "post"
diff: 省选/NOI-
pid: P2497
tag: ['动态规划 DP', '2012', '线段树', '各省省选', '平衡树', '山东', 'cdq 分治', '斜率优化']
---
# [SDOI2012] 基站建设
## 题目描述

up 主家终于买电脑了，但是接下来有各种问题要处理。首要解决的问题就是网络问题。他要从移动公司开始，通过一些基站来传递网络到他家。

为了简化问题，我们假设移动公司，所有的基站、up 主家位于同一条直线上，他们都位于这一条直线上的某一点 $x$，这些点**可能**会重合。每个基站发射和接收的范围都是一个切于地面的圆，发射的半径 $r$ 是固定的，接收半径 $r'$ 是可调的的。如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/nh8yxjx5.png)

一个点 $i$ 如果能从另一个点 $j$ 接收到信号（当且仅当 $x_j<x_i$），必须满足 $i$ 的接收范围与 $j$ 的发射范围相切，并且需要付 $\sqrt{r'_i}$ 的额外费用。同时启动每一个点 $i$ 都需要费用 $v_i$。

当然一个点如果能够发射的 up 主家只需要这个点的发射范围与 up 主家所在的竖线相切或相交即可，如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/5t4v8687.png)

当然费用越少就越好咯，于是 up 主想要请你帮他的忙。
## 输入格式

第一行两个整数 $n, m$。表示基站个数（包括移动公司），up 主家的坐标。（保证大于等于所有基站的坐标）

记下来 $n$ 行，每行三个整数 $x_i$，$r_i$，$v_i$，表示每个基站的坐标，发射范围以及费用。

$x_i$ 是按照坐标从小到大输入的，移动公司位于最小的那个坐标。

$r$ 为 $1\dots n$ 的排列。
## 输出格式

一个实数，保留小数点后三位。
## 样例

### 样例输入 #1
```
10 33
5 4 660
10 2 2040
11 6 3207
14 5 2006
18 3 6130
19 9 3363
22 1 1265
25 8 2836
27 10 7961
29 7 9075
```
### 样例输出 #1
```
3501.000
```
## 提示

对于 $100\%$ 的数据 $n\le5\times 10^5$，$x_i,m \le 10^{12}$，$v_i \le 10000$


---

---
title: "[USACO15FEB] Fencing the Herd G"
layout: "post"
diff: 省选/NOI-
pid: P3122
tag: ['计算几何', '2015', 'USACO', 'cdq 分治', '凸包']
---
# [USACO15FEB] Fencing the Herd G
## 题目描述

Farmer John 需要你帮助他决定在哪里建造形状是一条无限长的直线的栅栏来限制他的牛的活动。他选出了几个可能的建造栅栏的位置，你需要帮助他判断哪些栅栏是有用的。一个栅栏是有用的当且仅当所有奶牛都在栅栏的同一侧。（如果有牛群在栅栏所在的直线上，那么栅栏是没用的），Farmer John 将会多次询问你一个栅栏是否有用，如果这个栅栏是有用的，需要输出 `YES`，反之输出 `NO`。

另外，Farmer John 也可能会带来一些新的奶牛加入这个牛群。一头牛加入之后，以后的所有询问中，这头牛也需要与其它的牛在栅栏的同一侧。

## 输入格式


第一行，两个正整数 $n,q$，表示初始时牛群的数量与询问个数；

后 $n$ 行，每行两个整数 $x,y$，表示一个牛群的初始位置；

后 $q$ 行，每行多个整数，表示一次询问，询问的格式如下：

- 1 $x$ $y$：表示一个新的牛群加入了牧场，驻留在 $(x,y)$ 上；
- 2 $A$ $B$ $C$：表示 Farmer John 询问栅栏 $Ax+By=C$ 是否有用。
## 输出格式

对于每个 $2$ 类型的询问，如果栅栏有用，输出 `YES`，否则输出 `NO`。

## 样例

### 样例输入 #1
```
3 4 
0 0 
0 1 
1 0 
2 2 2 3 
1 1 1 
2 2 2 3 
2 0 1 1 

```
### 样例输出 #1
```
YES 
NO 
NO 


```
## 提示

直线 $2x+2y=3$ 使得初始的三个牛群都在同侧；然而在该栅栏另一侧的牛群 $(1,1)$ 的加入使得它没有用了。

直线 $y=1$ 没用因为牛群 $(0,1)$，$(1,1)$ 恰好在它上面。

---

对于 $100\%$ 的数据，保证 $1\leq n\leq 10^5$，$1\leq q\leq 10^5$，所有牛群的坐标都各不相同且满足 $-10^9\leq x,y\leq 10^9$，$-10^9\leq A,B\leq 10^9$，$-10^{18}\leq C\leq 10^{18}$。

数据保证不存在栅栏满足 $A=B=0$。


---

---
title: "[CQOI2011] 动态逆序对"
layout: "post"
diff: 省选/NOI-
pid: P3157
tag: ['2011', '重庆', '各省省选', '树状数组', 'cdq 分治', '可持久化线段树']
---
# [CQOI2011] 动态逆序对
## 题目描述

对于序列 $a$，它的逆序对数定义为集合  
$$\{(i,j)| i<j \wedge a_i > a_j \}$$
中的元素个数。  

现在给出 $1\sim n$ 的一个排列，按照某种顺序依次删除 $m$ 个元素，你的任务是在每次删除一个元素**之前**统计整个序列的逆序对数。

## 输入格式

第一行包含两个整数 $n$ 和 $m$，即初始元素的个数和删除的元素个数。  
以下 $n$ 行，每行包含一个 $1 \sim n$ 之间的正整数，即初始排列。  
接下来 $m$ 行，每行一个正整数，依次为每次删除的元素。

## 输出格式

输出包含 $m$ 行，依次为删除每个元素之前，逆序对的个数。

## 样例

### 样例输入 #1
```
5 4
1
5
3
4
2
5
1
4
2
```
### 样例输出 #1
```
5
2
2
1
```
## 提示

【数据范围】   
对于 $100\%$ 的数据，$1\le n \le 10^5$，$1\le m \le 50000$。

【样例解释】  
删除每个元素之前的序列依次为：  
$$1,5,3,4,2$$  
$$1,3,4,2$$  
$$3,4,2$$  
$$3,2$$  


---

---
title: "[USACO17FEB] Why Did the Cow Cross the Road III P"
layout: "post"
diff: 省选/NOI-
pid: P3658
tag: ['2017', 'USACO', '树状数组', 'cdq 分治']
---
# [USACO17FEB] Why Did the Cow Cross the Road III P
## 题目描述

Farmer John is continuing to ponder the issue of cows crossing the road through his farm, introduced in the preceding two problems. He realizes now that the threshold for friendliness is a bit more subtle than he previously considered -- breeds $a$ and $b$ are now friendly if $|a - b| \leq K$, and unfriendly otherwise.
Given the orderings of fields on either side of the road through FJ's farm, please count the number of unfriendly crossing pairs of breeds, where a crossing pair of breeds is defined as in the preceding problems.


## 输入格式

The first line of input contains $N$ ($1 \leq N \leq 100,000$) and $K$ ($0 \leq K < N$). The next $N$ lines describe the order, by breed ID, of fields on one side of the road; each breed ID is an integer in the range $1 \ldots N$. The last $N$ lines describe the order, by breed ID, of the fields on the other side of the road. Each breed ID appears exactly once in each ordering.

## 输出格式

Please output the number of unfriendly crossing pairs of breeds.


## 样例

### 样例输入 #1
```
4 1
4
3
2
1
1
4
2
3
```
### 样例输出 #1
```
2
```
## 提示

In this example, breeds 1 and 4 are unfriendly and crossing, as are breeds 1 and 3.


## 题目翻译

### 题目描述

Farmer John 继续思考奶牛穿过他农场道路的问题，这个问题在前两个问题中已经介绍过。他现在意识到，友好度的阈值比他之前考虑的要微妙一些——现在，品种 $a$ 和 $b$ 是友好的当且仅当 $|a - b| \leq K$，否则就是不友好的。给定 FJ 农场道路两侧田地的品种顺序，请计算不友好的交叉品种对的数量，其中交叉品种对的定义与前两个问题相同。

### 输入格式

输入的第一行包含 $N$ ($1 \leq N \leq 100,000$) 和 $K$ ($0 \leq K < N$)。接下来的 $N$ 行描述了道路一侧田地的品种顺序；每个品种 ID 是一个在 $1 \ldots N$ 范围内的整数。最后的 $N$ 行描述了道路另一侧田地的品种顺序。每个品种 ID 在每个顺序中恰好出现一次。

### 输出格式

请输出不友好的交叉品种对的数量。

### 说明/提示

在这个例子中，品种 1 和 4 是不友好的且交叉的，品种 1 和 3 也是不友好的且交叉的。


---

---
title: "[CQOI2017] 老C的任务"
layout: "post"
diff: 省选/NOI-
pid: P3755
tag: ['2017', '重庆', '各省省选', '离散化', 'cdq 分治', '可持久化线段树']
---
# [CQOI2017] 老C的任务
## 题目描述

老 C 是个程序员。


最近老 C 从老板那里接到了一个任务——给城市中的手机基站写个管理系统。作为经验丰富的程序员，老 C 轻松地完成了系统的大部分功能，并把其中一个功能交给你来实现。

由于一个基站的面积相对于整个城市面积来说非常的小，因此每个的基站都可以看作坐标系中的一个点，其位置可以用坐标 $(x,y)$ 来表示。此外，每个基站还有很多属性，例如高度、功率等。运营商经常会划定一个区域，并查询区域中所有基站的信息。

现在你需要实现的功能就是，对于一个给定的矩形区域，回答该区域中（包括区域边界上的）所有基站的功率总和。如果区域中没有任何基站，则回答 $0$。

## 输入格式

第一行两个整数 $n,m$，表示一共有 $n$ 个基站和 $m$ 次查询。接下来一共有 $n$ 行，每行由 $x_i,y_i,p_i$ 三个空格隔开的整数构成，表示一个基站的坐标 $(x_i,y_i)$ 和功率 $p_i$。不会有两个基站位于同一坐标。

接下来一共有 $m$ 行，每行由 $x_1,y_1,x_2,y_2$ 四个空格隔开的整数构成，表示一次查询的矩形区域。该矩形对角坐标为 $(x_1,y_1)$ 和 $(x_2,y_2)$，且边与坐标轴平行。

## 输出格式

输出 $m$ 行，每行一个整数，对应每次查询的结果。

## 样例

### 样例输入 #1
```
4 2   
0 0 1 
0 1 2  
2 2 4  
1 0 8  
0 0 1 1 
1 1 5 6 
```
### 样例输出 #1
```
11
4
```
### 样例输入 #2
```
3 2
-100 0 16 
1 -10 32 
1000 100 64 
0 0 0 1 
-1000 -1000 10000 10000 
```
### 样例输出 #2
```
0
112
```
## 提示

对于第 $1\sim2$ 个测试点，$1≤n,m≤100$；

对于第 $3\sim5$ 个测试点，$1≤n≤50000,1≤m≤10000$；

对于第 $6\sim10$ 个测试点，$1≤n≤100000,1≤m≤100000$，数据有梯度；

对于所有测试点，$-2^{31}\le x_i,y_i,p_i,x_1,y_1,x_2,y_2<2^{31},x_1\le x_2,y_1\le y_2$。



---

---
title: "【模板】三维偏序（陌上花开）"
layout: "post"
diff: 省选/NOI-
pid: P3810
tag: ['树状数组', 'cdq 分治', 'O2优化', '分治', '排序', '整体二分', 'K-D Tree']
---
# 【模板】三维偏序（陌上花开）
## 题目背景

这是一道模板题，可以使用 bitset，CDQ 分治，KD-Tree 等方式解决。
## 题目描述

有 $ n $ 个元素，第 $ i $ 个元素有 $ a_i,b_i,c_i $ 三个属性，设 $ f(i) $ 表示满足 $ a_j \leq a_i $ 且 $ b_j \leq b_i $ 且 $ c_j \leq c_i $ 且 $ j \ne i $ 的 $j$ 的数量。

对于 $ d \in [0, n) $，求 $ f(i) = d $ 的数量。
## 输入格式

第一行两个整数 $ n,k $，表示元素数量和最大属性值。

接下来 $ n $ 行，每行三个整数 $ a_i ,b_i,c_i $，分别表示三个属性值。
## 输出格式

$ n $ 行，第 $ d + 1 $ 行表示 $ f(i) = d $ 的 $ i $ 的数量。
## 样例

### 样例输入 #1
```
10 3
3 3 3
2 3 3
2 3 1
3 1 1
3 1 2
1 3 1
1 1 2
1 2 2
1 3 2
1 2 1

```
### 样例输出 #1
```
3
1
3
0
1
0
1
0
0
1

```
## 提示

$ 1 \leq n \leq 10^5$，$1 \leq a_i, b_i, c_i \le k \leq 2 \times 10^5 $。



---

---
title: "[HEOI2016/TJOI2016] 序列"
layout: "post"
diff: 省选/NOI-
pid: P4093
tag: ['2016', '线段树', '各省省选', '河北', 'cdq 分治', 'O2优化', '树套树', '天津']
---
# [HEOI2016/TJOI2016] 序列
## 题目描述

佳媛姐姐过生日的时候，她的小伙伴从某宝上买了一个有趣的玩具送给他。

玩具上有一个数列，数列中某些项的值可能会变化，但同一个时刻最多只有一个值发生变化。现在佳媛姐姐已经研究出了所有变化的可能性，她想请教你，能否选出一个子序列，使得在**任意一种变化和原序列**中，这个子序列都是不降的？请你告诉她这个子序列的最长长度即可。
## 输入格式

输入的第一行有两个正整数 $n,m$，分别表示序列的长度和变化的个数。

接下来一行有 $n$ 个整数，表示这个数列原始的状态。

接下来 $m$ 行，每行有 $2$ 个整数 $x,y$，表示数列的第 $x$ 项可以变化成 $y$ 这个值。

## 输出格式

输出一个整数，表示对应的答案。

## 样例

### 样例输入 #1
```
3 4 
1 2 3 
1 2 
2 3 
2 1 
3 4
```
### 样例输出 #1
```
3

```
## 提示

注意：每种变化最多只有一个值发生变化。

在样例输入中，所有的变化是：
```plain
1 2 3
2 2 3
1 3 3
1 1 3
1 2 4
```
选择子序列为原序列，即在任意一种变化中均为不降子序列。

对于 $20\%$ 数据，所有数均为正整数，且小于等于 $300$。

对于 $50\%$ 数据，所有数字均为正整数，且小于等于 $3000$。

对于 $100\%$ 数据，所有数字均为正整数，且小于等于 $10^5$。$1\le x\le n$。



---

---
title: "[Violet] 天使玩偶/SJY摆棋子"
layout: "post"
diff: 省选/NOI-
pid: P4169
tag: ['树状数组', 'cdq 分治', '分治', '剪枝']
---
# [Violet] 天使玩偶/SJY摆棋子
## 题目描述


Ayu 在七年前曾经收到过一个天使玩偶，当时她把它当作时间囊埋在了地下。而七年后 的今天，Ayu 却忘了她把天使玩偶埋在了哪里，所以她决定仅凭一点模糊的记忆来寻找它。

我们把 Ayu 生活的小镇看作一个二维平面坐标系，而 Ayu 会不定时地记起可能在某个点 $(x, y)$ 埋下了天使玩偶；或者 Ayu 会询问你，假如她在 $(x,y)$，那么她离近的天使玩偶可能埋下的地方有多远。

因为 Ayu 只会沿着平行坐标轴的方向来行动，所以在这个问题里我们定义两个点之间的距离为 $\operatorname{dist}(A,B)=|A_x-B_x|+|A_y-B_y|$。其中 $A_x$ 表示点 $A$ 的横坐标，其余类似。

## 输入格式

第一行包含两个整数 $n$ 和 $m$，在刚开始时，Ayu 已经知道有 $n$ 个点可能埋着天使玩偶， 接下来 Ayu 要进行 $m$ 次操作。

接下来 $n$ 行，每行两个非负整数 $(x_i,y_i)$，表示初始 $n$ 个点的坐标。

再接下来 $m$ 行，每行三个非负整数 $t,x_i,y_i$。

* 如果 $t=1$，则表示 Ayu 又回忆起了一个可能埋着玩偶的点 $(x_i,y_i)$。
* 如果 $t=2$，则表示 Ayu 询问如果她在点 $(x_i,y_i)$，那么在已经回忆出来的点里，离她近的那个点有多远
## 输出格式

对于每个 $t=2$ 的询问，在单独的一行内输出该询问的结果。
## 样例

### 样例输入 #1
```
2 3 
1 1 
2 3 
2 1 2 
1 3 3 
2 4 2
```
### 样例输出 #1
```
1 
2
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据 保证 $1 \leq n,m\leq 3 \times 10^5$，$0 \leq x_i,y_i \leq 10^6$。


---

---
title: "[CEOI 2017] Building Bridges"
layout: "post"
diff: 省选/NOI-
pid: P4655
tag: ['动态规划 DP', '2017', '线段树', 'cdq 分治', 'CEOI（中欧）', '斜率优化']
---
# [CEOI 2017] Building Bridges
## 题目描述

有 $n$ 根柱子依次排列，每根柱子都有一个高度。第 $i$ 根柱子的高度为 $h_i$。

现在想要建造若干座桥，如果一座桥架在第 $i$ 根柱子和第 $j$ 根柱子之间，那么需要 $(h_i-h_j)^2$​​ 的代价。

在造桥前，所有用不到的柱子都会被拆除，因为他们会干扰造桥进程。第 $i$ 根柱子被拆除的代价为 $w_i$，注意 $w_i$ 不一定非负，因为可能政府希望拆除某些柱子。

现在政府想要知道，通过桥梁把第 $1$ 根柱子和第 $n$ 根柱子连接的最小代价。注意桥梁不能在端点以外的任何地方相交。
## 输入格式

第一行一个正整数 $n$。

第二行 $n$ 个空格隔开的整数，依次表示 $h_1,h_2,\cdots,h_n$​​。

第三行 $n$ 个空格隔开的整数，依次表示 $w_1,w_2,\cdots,w_n$​​。
## 输出格式

输出一行一个整数表示最小代价，注意最小代价不一定是正数。
## 样例

### 样例输入 #1
```
6
3 8 7 1 6 6
0 -1 9 1 2 0
```
### 样例输出 #1
```
17
```
## 提示

对于 $100\%$ 的数据，有 $2\le n\le 10^5;0\le h_i,\vert w_i\vert\le 10^6$。


---

---
title: "寻找宝藏"
layout: "post"
diff: 省选/NOI-
pid: P4849
tag: ['cdq 分治', 'K-D Tree']
---
# 寻找宝藏
## 题目背景

如果时光回到从前，或许，一切只是虚无……

小 W 坐着时光穿梭机到达了一个四维时空，在这里，开始了他的寻宝之旅。
## 题目描述

整个四维时空可以看做是一个四维的网格图，小 W 在 $(1,1,1,1)$ 这个位置，出口在 $(m,m,m,m)$。但由于小 W 毕竟是外来时空的人，他的行动在这里受到了一些限制。每次他只能使四个坐标中的一个加上 $1$。也就是说，他每次只能向右，向上，向前和向*（蒟蒻的出题人想不出来怎么形容了）走一步。

这个时空中有 $n$ 个宝藏，第 $i$ 个宝藏的坐标是 $(a_i,b_i,c_i,d_i)$，价值为 $v_i$。

小 W 想知道，他能够拿走宝藏的最大价值和是多少。由于小 W 也是一个喜欢未雨绸缪的人，他也希望能够找到多种不同的方案使它们都可以达到最大价值和的要求。不过这个数有可能很大，输出它对 $998244353$ 取模的结果即可。

注意！两个方案不同当且仅当两个方案中至少有一个宝藏选择的不同，如果仅仅路线不同而最终都选择了相同的宝藏不算不同的方案。

（小心两个宝藏待在相同的位置哦……）
## 输入格式

第一行两个数 $n,m$，分别代表宝藏个数和网格坐标的最大值。

接下来 $n$ 行，每行 $5$ 个数，分别是 $a_i,b_i,c_i,d_i,v_i$。
## 输出格式

输出两行，第一行是最大价值和，第二行是满足条件的方案个数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
5 5
1 1 1 1 5
2 2 2 2 4
1 1 2 2 3
3 1 3 1 10
5 5 5 5 1
```
### 样例输出 #1
```
16
1
```
### 样例输入 #2
```
20 1000000000
20204201 39958379 15138434 34289618 398078390
85600475 39563639 66410111 36702766 611878653
36702694 1628762 125746709 79172847 611878653
103077330 79188107 6711555 56295346 611878653
212677316 202221253 26717633 234187985 158044893
297040787 198938585 43827694 296390944 158044893
109256220 180224853 267561686 65767679 472347047
167183048 72650618 4390517 30073538 471045792
214834767 93996707 94416376 34549122 359059039
89445418 135311221 266840392 213735818 398078390
343357648 61588748 188180842 396968607 144378900
285457193 157755350 336368020 572049737 472347047
171728638 398663231 323772972 359470762 611878653
234684711 226541116 270561472 376433946 229386389
293174669 58119648 352134416 262971247 144378900
182250938 623413311 303663331 506122949 611878653
817319765 321076346 200801449 745136845 698518241
26356940 295529493 725103952 845588002 533478406
510252473 498314898 168621119 519205227 472347047
947274653 288133984 692904616 340022215 611878653

```
### 样例输出 #2
```
1696104353
6
```
## 提示

对于样例 1，最好的办法是 $(1,1,1,1)$ 慢慢走到 $(3,1,3,1)$，再慢慢走到 $(5,5,5,5)$，获得 $16$ 的价值。最好的路径只有这 $1$ 条。

![Luogu](https://cdn.luogu.com.cn/upload/pic/26057.png)

对于所有数据，$1\le a_i,b_i,c_i,d_i\le m$，$1\le v_i\le 10^9$。


---

---
title: "[COCI 2018/2019 #2] Sunčanje"
layout: "post"
diff: 省选/NOI-
pid: P7312
tag: ['2018', 'cdq 分治', 'COCI（克罗地亚）']
---
# [COCI 2018/2019 #2] Sunčanje
## 题目描述

Slavko 做了一个不寻常的梦。在一个晴朗的早上，$N$ 个白色的矩形一个接着一个爬上了 Slavko 家的屋顶，并在屋顶上晒太阳。每个矩形在屋顶都选定了一个位置，使得它的边与屋顶的棱角平行。有些矩形可能会覆盖在其它矩形所在的位置上。每个矩形的长、宽分别为 $A_i,B_i$，其与屋顶左方和下方的棱角的距离分别为 $X_i,Y_i$。

日落后，矩形们从屋顶上下来，并睡了一觉。次日，它们发现，有些矩形变成了黄色，而有些仍为白色。变为黄色的矩形都是完全暴露在阳光下的。

请判断每个矩形是否变为了黄色。
## 输入格式

第一行输入正整数 $N$，表示矩形的个数。

接下来的 $N$ 行，每行输入整数 $X_i,Y_i,A_i,B_i$。输入顺序与登上屋顶的顺序一致。
## 输出格式

输出 $N$ 行。其中，若第 $i$ 个矩形变为黄色，则在第 $i$ 行输出 `DA`，否则在该行输出 `NE`。
## 样例

### 样例输入 #1
```
5
1 1 4 2
6 1 1 1
2 2 2 3
3 4 3 2
4 0 1 2
```
### 样例输出 #1
```
NE
DA
NE
DA
DA
```
### 样例输入 #2
```
3
3 3 1 1
2 2 3 3
1 1 5 5
```
### 样例输出 #2
```
NE
NE
DA
```
## 提示

#### 样例 1 解释

矩形 $1,3$ 没有完全暴露在阳光下，因而它们没有变为黄色：

![](https://cdn.luogu.com.cn/upload/image_hosting/pzfz7o9i.png?x-oss-process=image/resize,m_lfit,h_320,w_362)

#### 数据规模与约定

对于 $10\%$ 的数据，$N \le 10^4$。

对于 $100\%$ 的数据，$1 \le N \le 10^5$，$0 \le X_i,Y_i \le 10^9$，$1 \le A_i,B_i \le 10^9$。

#### 说明

**本题分值按 COCI 原题设置，满分 $130$。**

**题目译自 [COCI2018-2019](https://hsin.hr/coci/archive/2018_2019/) [CONTEST #2](https://hsin.hr/coci/archive/2018_2019/contest2_tasks.pdf)  _T5 Sunčanje_。**


---

---
title: "「C.E.L.U-03」探险者笔记 III"
layout: "post"
diff: 省选/NOI-
pid: P7842
tag: ['cdq 分治', 'O2优化', '位运算']
---
# 「C.E.L.U-03」探险者笔记 III
## 题目背景

罗司机在通关小 Soup 所制作的游戏《探险者笔记》后，感到十分的悲伤。为了缓解内心的伤痛，他决定改制《探险者笔记》，使其成为一个快乐的游戏。  
一段时间之后，罗司机完成了制作，并喊来小 Soup 给他测试。
## 题目描述

改制后的《探险者笔记》由 $n$ 个关卡组成，每个关卡有一个难度 $b_i$，同时有 $m$ 个成就，第 $i$ 个成就需要你恰好完成 $sum_i$ 个关卡，且**刚好**分别是 $a_{i_1},a_{i_2},...,a_{i_{sum_i}}$。完成第 $i$ 个成就可以得到 $v_i$ 的分数。  
如果长时间推关而没有获得任何成就，小 Soup 会感到疲乏。而且成就的解锁是有一定顺序的。因此上一个获得第 $i$ 个成就接下来再获得第 $j$ 个成就的条件是 $i<j$ 且 $w+\sum\limits_{k=1}^{sum_i}b_{a_{i_k}}\ge\sum\limits_{k=1}^{sum_j}b_{a_{j_k}}$，其中 $w$ 是一个给定的常数。  
第一次获得成就没有任何限制。求最多他能得到多少分数。
## 输入格式

第一行三个数 $n,m,w$。  
第二行 $n$ 个数，$b_i$。  
接下来 $m$ 行，第 $i$ 行一开始有两个数，$v_i,sum_i$，接下来会有 $sum_i$ 个数，$a_{i_1},a_{i_2},...,a_{i_{sum_i}}$。
## 输出格式

仅一个数，答案。
## 样例

### 样例输入 #1
```
3 3 1
1 1 2
2 1 1
2 2 1 2
3 2 1 3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4 6 2
1 1 3 2
3 3 1 2 3
2 2 2 3
3 3 2 3 4
2 2 1 3
4 3 1 3 4
6 4 1 2 3 4
```
### 样例输出 #2
```
12
```
## 提示

### 样例解释

**样例解释一**    
依次完成第 $1,2$ 个成就。  

**样例解释二**    
依次完成第 $4,5,6$ 个成就。注意，成就之间的限制**只在相邻获得的成就之间生效。**

### 数据范围
|数据编号|$n\leq$|$m\leq$|
|:---:|:---:|:---:|
|$1$|$9$|$10^3$|
|$2$|$18$|$10^3$|
|$3\sim 6$|$9$|$10^5$|
|$7\sim 10$|$18$|$10^5$|

对于 $100\%$ 的数据 $1\le n\le18,1\le m\le10^5,1\le sum_i\le18,1\le w,b_i,v_i\le10^3,1\le a_i\le n$。  




---

---
title: "「DTOI-2」星之河"
layout: "post"
diff: 省选/NOI-
pid: P8575
tag: ['cdq 分治']
---
# 「DTOI-2」星之河
## 题目背景

> 星稀河影转，霜重月华孤。

## 题目描述

星之统治者有一个星盘，其可以被抽象为一棵根节点为 $1$ 的树。树上每个节点 $i$ 有一颗红星、一颗蓝星，亮度分别记为 $\text{Red}_i,\text{Blue}_i$。

现在，星之统治者想要知道，对于每个节点 $x$，其子树内（不包括该节点）有多少节点满足：其红星亮度小于等于 $x$ 的红星亮度，且其蓝星亮度小于等于 $x$ 的蓝星亮度。

你需要按编号顺序依次输出每个节点的答案。为减少输出量，**如果答案为 $0$ 则不必输出。**

## 输入格式

第一行两个整数分别表示 $n$。

接下来 $n-1$ 行每行两个正整数 $u,v$，表示存在 $(u,v)$ 这条树边。

接下来 $n$ 行每行两个整数分别表示 $\text{Red}_i, \text{Blue}_i$。
## 输出格式

每个答案非 $0$ 的节点一行，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
10
2 1
3 1
4 3
5 1
6 4
7 2
8 2
9 4
10 3
3 1
2 4
-3 3
4 -2
-2 3
-3 -6
-5 -1
-4 -7
-5 -1
-7 -7
```
### 样例输出 #1
```
5
2
3
1
```
## 提示

### 样例解释

对于节点 $1$，小于等于他的子节点有 $6,7,8,9,10$，因此输出 $5$。  
对于节点 $4$，小于等于他的子节点有 $6$，因此输出 $1$。  
对于节点 $5 $ 至 $10$，没有小于等于他的子节点，因此不输出。

### 数据范围

| $\textbf{Subtask}$| $n\le$ | 特殊性质 | 总分数 |
| :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $1000$ | 无 | $10$ |
| $2$ | $5\times 10^4$ | 无 | $20$ ||
| $3$ | $10^5$ | $-200\le \text{Red}_i, \text{Blue}_i \le 200$ | $20$ |
| $4$ | $2\times 10^5$ | 树的形态是链 | $20$ |
| $5$ | $2\times 10^5$ | 无 | $30$ |

对于所有数据，保证 $n \le 2\times 10^5$，$-10^9 \le \text{Red}_i, \text{Blue}_i \le 10^9$。




---


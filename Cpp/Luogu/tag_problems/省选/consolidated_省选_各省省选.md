---
title: "[SNOI2024] 树 V 图"
layout: "post"
diff: 省选/NOI-
pid: P10060
tag: ['各省省选', '2024', 'O2优化', '陕西']
---
# [SNOI2024] 树 V 图
## 题目描述

你有一棵 $n$ 个点的无根树，节点的编号为 $1, 2, \ldots, n$。定义树上两点之间的距离 $\operatorname{dis}(i, j)$ 为树上 $i$ 点到 $j$ 点的简单路径上的边数。

现在有 $k$ 个关键点 $a_1, a_2, \ldots, a_k$，对于每个点，我们想求出距离它最近的关键点是哪个点。也就是对于一个点 $v$，令 $f(v)$ 表示令 $\operatorname{dis}(v, a_i)$ 最小的 $i$，如果有多个 $i$ 满足条件，那么我们会选择其中最小的 $i$。

现在，我们给出了 $f(1), f(2), \ldots, f(n)$，问有多少组可能的 $(a_1, a_2, \ldots, a_k)$ 满足条件。由于答案可能很大，输出对 $998244353$ 取模的结果。
## 输入格式

多组测试数据，第一行一个整数 $T$ 表示数据组数。  
对于每组测试数据，第一行两个整数 $n, k$，表示节点个数和关键点个数。  
接下来 $n - 1$ 行，每行两个整数 $u, v$，表示一条树边 $(u, v)$。  
接下来一行，$n$ 个整数，$f(1), f(2), \ldots, f(n)$。注意：数据**不保证**一定存在一组可能的 $(a_1, a_2, \ldots, a_k)$。
## 输出格式

对于每组数据，输出一个整数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3
3 3
1 2
2 3
1 2 1
3 2
1 2
2 3
1 2 2
3 2
1 2
2 3
2 1 1

```
### 样例输出 #1
```
0
1
2

```
### 样例输入 #2
```
1
10 5
1 2
2 3
3 4
4 5
5 6
6 7
7 8
8 9
9 10
1 1 2 2 3 3 4 4 5 5

```
### 样例输出 #2
```
13

```
## 提示

**【样例 \#1 解释】**

在第一个样例中，对于第二组数据，一个解为 $(1, 2)$。对于第三组数据，两个解为 $(2, 1), (3, 1)$。

注意，当多个点距离相同时，我们选择的是最小的 $i$ 而不是 $a_i$。

---

**【样例 \#3】**

见附件中 `voronoi/voronoi3.in` 与 `voronoi/voronoi3.ans`，这个样例满足测试点 $3 \sim 4$ 的条件限制。

---

**【样例 \#4】**

见附件中 `voronoi/voronoi3.in` 与 `voronoi/voronoi3.ans`，这个样例满足测试点 $7 \sim 10$ 的条件限制。

---

**【数据范围】**

对于所有的数据，保证 $1 \le T \le 10$，$2 \le k \le n \le 3 \times {10}^3$，$1 \le f(i) \le k$。

具体如下：

| 测试点编号 | $n \le$ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 2$ | $15$ | 无 |
| $3 \sim 4$ | $3000$ | A |
| $5 \sim 6$ | $3000$ | B |
| $7 \sim 10$ | $3000$ | 无 |

特殊性质 A：保证树是一条链。  
特殊性质 B：保证 $k = 2$。


---

---
title: "[SNOI2024] 矩阵"
layout: "post"
diff: 省选/NOI-
pid: P10061
tag: ['各省省选', '2024', 'O2优化', '陕西']
---
# [SNOI2024] 矩阵
## 题目描述

你要维护一个 $n \times n$ 的矩阵 $A$，其中第 $i$ 行第 $j$ 列的元素记作 $A_{i, j}$。行和列从 $1$ 开始标号。一开始，有 $A_{i, j} = (i + 1)^j \bmod 998244353$。

你需要支持 $q$ 个操作，每个操作是下面两种操作中的一种。

- $1\ x_1\ y_1\ x_2\ y_2$，这里保证 $y_2 - x_2 = y_1 - x_1$。将子矩形 $[x_1, x_2] \times [y_1, y_2]$ 逆时针旋转 $90$ 度。
  - 具体地，令 $d = x_2 - x_1 + 1$。
  - 首先提取 $d \times d$ 的子矩阵 $A'$，对于所有的 $i, j$（$1 \le i, j \le d$），令 $A'_{i, j} \gets A_{x_1 + i - 1, y_1 + j - 1}$。
  - 然后将 $A'$ 旋转，得到一个 $d \times d$ 的子矩阵 $B'$，令 $B'_{i, j} \gets A'_{j, d - i + 1}$。
  - 然后将 $B'$ 填回到 $A$ 中，对所有的 $i, j$（$1 \le i, j \le d$），令 $A_{i + x_1 - 1, j + y_1 - 1} \gets B'_{i, j}$。
- $2\ x_1\ y_1\ x_2\ y_2\ d$。将子矩形 $[x_1, x_2] \times [y_1, y_2]$ 内所有的元素加 $d$。
  - 具体地，对于每个 $i$（$x_1 \le i \le x_2$）、$j$（$y_1 \le j \le y_2$），令 $A_{i, j} \gets A_{i, j} + d$。

你需要在所有操作结束之后，输出这个矩阵。由于输出可能很大，请输出
$$ \Biggl( \sum_{i = 1}^{n} \sum_{j = 1}^{n} A_{i, j} \times {12345}^{(i - 1) n + j} \Biggr) \bmod 1000000007 $$
的结果。
## 输入格式

第一行两个整数 $n, q$ 表示矩阵大小和操作个数。  
接下来 $q$ 行，每行若干个数，表示上面的某种操作。
## 输出格式

输出一个整数，表示答案对 $1000000007$ 取模的结果。
## 样例

### 样例输入 #1
```
4 4
1 1 2 3 4
2 2 1 4 2 3
1 2 1 3 2
2 1 1 1 4 5

```
### 样例输出 #1
```
984660761

```
### 样例输入 #2
```
10 10
2 5 1 10 4 689412516
1 3 4 3 4
1 3 5 4 6
1 4 1 8 5
1 1 2 1 2
1 4 2 7 5
1 2 5 2 5
2 3 3 3 9 856075030
2 4 2 5 6 308750020
2 1 5 9 7 252732904

```
### 样例输出 #2
```
94292030

```
## 提示

**【样例 \#1 解释】**

对于第一个样例，矩阵分别为
$$\begin{bmatrix} 2 & {\textcolor{red}{4}} & {\textcolor{red}{8}} & {\textcolor{red}{16}} \\ 3 & {\textcolor{red}{9}} & {\textcolor{red}{27}} & {\textcolor{red}{81}} \\ 4 & {\textcolor{red}{16}} & {\textcolor{red}{64}} & {\textcolor{red}{256}} \\ 5 & 25 & 125 & 625 \end{bmatrix} \to \begin{bmatrix} 2 & 16 & 81 & 256 \\ {\textcolor{blue}{3}} & {\textcolor{blue}{8}} & 27 & 64 \\ {\textcolor{blue}{4}} & {\textcolor{blue}{4}} & 9 & 16 \\ {\textcolor{blue}{5}} & {\textcolor{blue}{25}} & 125 & 625 \end{bmatrix} \to \begin{bmatrix} 2 & 16 & 81 & 256 \\ {\textcolor{red}{6}} & {\textcolor{red}{11}} & 27 & 64 \\ {\textcolor{red}{7}} & {\textcolor{red}{7}} & 9 & 16 \\ 8 & 28 & 125 & 625 \end{bmatrix}$$
$$\to \begin{bmatrix} {\textcolor{blue}{2}} & {\textcolor{blue}{16}} & {\textcolor{blue}{81}} & {\textcolor{blue}{256}} \\ 11 & 7 & 27 & 64 \\ 6 & 7 & 9 & 16 \\ 8 & 28 & 125 & 625 \end{bmatrix} \to \begin{bmatrix} 7 & 21 & 86 & 261 \\ 11 & 7 & 27 & 64 \\ 6 & 7 & 9 & 16 \\ 8 & 28 & 125 & 625 \end{bmatrix}$$
其中每个旋转操作对应的数字用红色表示，加操作对应的数字用蓝色表示。

---

**【样例 \#3】**

见附件中 `matrix/matrix3.in` 与 `matrix/matrix3.ans`，这个样例满足测试点 $5 \sim 6$ 的条件限制。

---

**【样例 \#4】**

见附件中 `matrix/matrix3.in` 与 `matrix/matrix3.ans`，这个样例满足测试点 $9 \sim 10$ 的条件限制。

---

**【数据范围】**

对于所有的数据，保证 $1 \le n \le 3000$，$1 \le q \le 3000$。  
对于每个操作，保证 $1 \le x_1 \le x_2 \le n$，$1 \le y_1 \le y_2 \le n$，$1 \le d \le {10}^9$。

具体如下：

| 测试点编号 | $n \le$ | $q \le$ | 特殊性质 |
|:-:|:-:|:-:|:-:|
| $1$ | $100$ | $3000$ | 无 |
| $2$ | $3000$ | $3000$ | A |
| $3 \sim 4$ | $3000$ | $2000$ | B |
| $5 \sim 6$ | $3000$ | $3000$ | B |
| $7 \sim 8$ | $3000$ | $2000$ | 无 |
| $9 \sim 10$ | $3000$ | $3000$ | 无 |

特殊性质 A：保证没有第一类旋转操作。  
特殊性质 B：保证没有第二类加法操作。


---

---
title: "[省选联考 2024] 迷宫守卫"
layout: "post"
diff: 省选/NOI-
pid: P10220
tag: ['各省省选', '2024', 'O2优化']
---
# [省选联考 2024] 迷宫守卫
## 题目描述

Alice 拥有一座迷宫，这座迷宫可以抽象成一棵拥有 $2^n$ 个叶节点的满二叉树，总节点数目为 $(2^{n+1} - 1)$，依次编号为 $1 \sim (2^{n+1} - 1)$。其中编号为 $2^n \sim (2^{n+1} - 1)$ 的是叶节点，编号为 $1 \sim (2^n - 1)$ 的是非叶节点，且非叶节点 $1 \le u \le (2^n - 1)$ 的左儿子编号为 $2u$，右儿子编号为 $(2u + 1)$。

每个非叶节点都有一个石像守卫，初始时，所有石像守卫均在沉睡。唤醒 $u$ 点的石像守卫需要 $w_u$ 的魔力值。

每个叶节点都有一个符文，$v$ 点的符文记作 $q_v$。**保证 $q_{2^n}, q_{2^n+1},\cdots, q_{2^{n+1}-1}$ 构成 $1 \sim 2^n$ 的排列**。

探险者初始时持有空序列 $Q$，从节点 $1$ 出发，按照如下规则行动：

- 到达叶节点 $v$ 时，将 $v$ 点的符文 $q_v$ 添加到序列 $Q$ 的末尾，然后返回父节点。
- 到达非叶节点 $u$ 时：
  - 若该点的石像守卫已被唤醒，则只能先前往左儿子，（从左儿子返回后）再前往右儿子，（从右儿子返回后）最后返回父节点。
  - 若该点的石像守卫在沉睡，可以在以下二者中任选其一：
    - 先前往左儿子，再前往右儿子，最后返回父节点。
    - 先前往右儿子，再前往左儿子，最后返回父节点。

返回节点 $1$ 时，探险结束。可以证明，探险者一定访问每个叶节点各一次，故此时 $Q$ 的长度为 $2^n$。

探险者 Bob 准备进入迷宫，他希望探险结束时的 $Q$ 的字典序越小越好，与之相对，Alice 希望 $Q$ 的字典序越大越好。

在 Bob 出发之前，Alice 可以选择一些魔力值花费之和不超过 $K$ 的石像守卫，并唤醒它们。Bob 出发时，他能够知道 Alice 唤醒了哪些神像。若**双方都采取最优策略**，求序列 $Q$ 的最终取值。

对于两个长度为 $2^n$ 的序列 $Q_1,Q_2$，称 $Q_1$ 字典序小于 $Q_2$ 当且仅当以下条件成立：

- $\exist i \in [1, 2^n]$ 满足以下两个条件：
  - $\forall 1 \le j < i，Q_{1,j} = Q_{2,j}$；
  - $Q_{1,i} < Q_{2,i}$。
## 输入格式

**本题有多组测试数据**。输入的第一行包含一个正整数 $T$，表示测试数据组数。

接下来依次 $T$ 组测试数据。对于每组测试数据：

- 第一行两个整数 $n,K$ 表示迷宫规模和 Alice 可用于唤醒石像守卫的魔力值上限。
- 第二行 $(2^n - 1)$ 个整数 $w_1,w_2,\cdots,w_{2^n-1}$ 表示唤醒各个石像守卫耗费的魔力值。
- 第三行 $2^n$ 个整数 $q_{2^n}, q_{2^n+1},\cdots, q_{2^{n+1}-1}$ 表示各个叶节点上的符文。
## 输出格式

对于每组数据，输出一行 $2^n$ 个整数 $Q_1,Q_2,\cdots,Q_{2^n}$，表示双方都采取最优策略的情况下，序列 $Q$ 的最终取值。
## 样例

### 样例输入 #1
```
3
1 0
1
2 1
1 1
1
2 1
3 3
3 2 1 2 1 2 1
4 2 6 3 7 1 5 8
```
### 样例输出 #1
```
1 2
2 1
2 4 6 3 5 8 7 1
```
## 提示

**【样例 1 解释】**

- 第一组数据中，Alice 无法唤醒石像守卫，Bob 可以选择先访问叶节点 $3$，再访问叶节点 $2$，得 $Q = \{1, 2\}$。
- 第二组数据中，Alice 可以唤醒节点 $1$ 的石像守卫，Bob 只能先访问叶节点 $2$，再访问叶节点 $3$，得 $Q = \{2, 1\}$。
- 第三组数据中，Alice 的最优策略是唤醒节点 $5, 6$ 的石像守卫。

**【样例 2】**

见附件中的 `maze2.in/ans`。

该组数据满足特殊性质 A。

**【样例 3】**

见附件中的 `maze3.in/ans`。

该组数据满足特殊性质 B。

**【样例 4】**

见附件中的 `maze4.in/ans`。

**【样例 5】**

见附件中的 `maze5.in/ans`。

**【子任务】**

设 $\sum 2^n$ 表示单个测试点钟所有测试数据的 $2^n$ 的和。对于所有测试数据，保证

- $1\le T \le 100$；
- $1\le n \le 16$，$1 \le \sum 2^n \le 10^5$；
- $0\le K \le 10^{12}$
- $\forall 1 \le u \le (2^n-1)$，$0 \le w_u \le 10^{12}$；
- $q_{2^n},q_{2^n+1},\cdots,q_{2^{n+1}-1}$ 构成 $1\sim 2^n$ 的排列。

| 测试点编号 | $n\le$ | $\sum 2^n \le$ | 特殊性质 |
| :--: | :--: | :--: | :--: |
| $1\sim 5$ | $4$ | $80$ | 无 |
| $6$ | $6$ | $200$ | A |
| $7\sim 8$ | $6$ | $200$ | B |
| $9\sim 10$ | $6$ | $200$ | 无 |
| $11$ | $11$ | $4000$ | A |
| $12\sim 13$ | $11$ | $4000$ | B |
| $14\sim 15$ | $11$ | $4000$ | 无 |
| $16$ | $16$ | $10^5$ | A |
| $17\sim 18$ | $16$ | $10^5$ | B |
| $19\sim 20$ | $16$ | $10^5$ | 无 |

特殊性质 A：$\forall 2^n \le v \le (2^{n+1}-1)$，$q_v = (2^{n+1}-v)$。

特殊性质 B：$\forall 1 \le u \le (2^n-1)$，$w_u = 1$。


---

---
title: "[TJOI2011] 书架"
layout: "post"
diff: 省选/NOI-
pid: P1295
tag: ['2011', '各省省选', '天津']
---
# [TJOI2011] 书架
## 题目背景

由于最近又购买了很多书，所以你打算在自己的书房做一个新书架，为了照顾整体效果，你希望你的书架的宽度越小越好。

书架背靠墙摆放，宽度就是指书架在垂直于墙面的方向上占据的距离。
## 题目描述

现按一定顺序给出所有要放置于书架上的书，共有 $n$ 本，第 $i$ 本书有一个长度 $h_i$。

书架有若干层，层与层之间的宽度不一定相等，但是一层的宽度不能小于其上所摆放的任何一本书的长度。同时，每层上的书的长度之和不能超过一个给定的参数 $m$，且任何层上的书必须是给出的书的序列中连续的几本。

书架的宽度是所有层的宽度之和，求书架的最小宽度。
## 输入格式

输入的第一行包含两个整数 $n$ 和 $m$。

第 $2$ 到第 $(n + 1)$ 行，每行一个整数，第 $(i + 1)$ 行的整数代表第 $i$ 本书的长度 $h_i$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 6
1
3
3
1
```
### 样例输出 #1
```
5
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $ n \leq 10^3$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 10^5$，$1 \leq h_i \leq 10^9$，$\max\limits_{i = 1}^{n} h_i \leq m \leq 10^9$。

#### 提示

由于原题题意严重模糊不清，现给出简化版题意：

给出一个长度为 $n$ 的序列 $h$，请将 $h$ 分成若干段，满足每段数字之和都不超过 $m$，最小化每段的最大值之和。 


---

---
title: "[HNOI2008] Cards"
layout: "post"
diff: 省选/NOI-
pid: P1446
tag: ['动态规划 DP', '数学', '2008', '各省省选', '湖南', '置换', '逆元']
---
# [HNOI2008] Cards
## 题目描述

小春现在很清闲，面对书桌上的 $n$ 张牌，他决定给每张牌染色，目前小春拥有 $3$ 种颜色：红色，蓝色，绿色。他询问 Sun 有多少种染色方案，Sun 很快就给出了答案。

进一步，小春要求染出 $S_r$ 张红色，$S_b$ 张蓝色，$S_g$ 张绿色。他又询问有多少种方案，Sun 想了一下，又给出了正确答案。最后小春发明了 $m$ 种不同的洗牌法，这里他又问 Sun 有多少种不同的染色方案。两种染色方法相同当且仅当其中一种可以通过任意的洗牌法（即可以使用多种洗牌法，而每种方法可以使用多次）洗成另一种。

Sun 发现这个问题有点难度，决定交给你，由于答案可能很大，你只需要求出答案对于 $P$ 取模的结果。 保证 $P$ 为一个质数。
## 输入格式

第一行输入 $5$ 个整数，依次表示：$S_r,S_b,S_g,m,P$（$m\le 60,m+1<p<100$）。其中，题面所提及的 $n$ 为 $S_r+S_b+S_g$，即 $n=S_r+S_b+S_g$。

接下来 $m$ 行，每行描述一种洗牌法，每行有 $n$ 个用空格隔开的整数 $X_1X_2...X_n$，保证其为 $1$ 到 $n$ 的一个排列，表示使用这种洗牌法，第 $i$ 位变为原来的 $X_i$ 位的牌。输入数据保证任意多次洗牌都可用这 $m$ 种洗牌法中的一种代替，且对每种洗牌法，都存在一种洗牌法使得能回到原状态。

同时，对于 $100\%$ 的数据满足 $\max\{S_r,S_b,S_g\}\le 20$ 。

## 输出格式

不同的染色方法对 $P$ 取模的结果。
## 样例

### 样例输入 #1
```
1 1 1 2 7
2 3 1
3 1 2

```
### 样例输出 #1
```
2

```
## 提示

有 $2$ 种本质上不同的染色法：`RGB` 和 `RBG`，使用洗牌法 `231` 一次，可得 `GBR` 和 `BGR`，使用洗牌法 `312` 一次，可得 `BRG` 和 `GRB`。



---

---
title: "[SCOI2007] 修车"
layout: "post"
diff: 省选/NOI-
pid: P2053
tag: ['2007', '四川', '各省省选', '网络流', '费用流']
---
# [SCOI2007] 修车
## 题目描述

同一时刻有 $N$ 位车主带着他们的爱车来到了汽车维修中心。

维修中心共有 $M$ 位技术人员，不同的技术人员对不同的车进行维修所用的时间是不同的。

现在需要安排这 $M$ 位技术人员所维修的车及顺序，使得顾客平均等待的时间最小。

说明：顾客的等待时间是指从他把车送至维修中心到维修完毕所用的时间。
## 输入格式

第一行有两个数 $M,N$，表示技术人员数与顾客数。

接下来 $N$ 行，每行 $M$ 个整数。第 $i+1$ 行第 $j$ 个数表示第 $j$ 位技术人员维修第 $i$ 辆车需要用的时间 $T_{i,j}$。
## 输出格式

最小平均等待时间，答案精确到小数点后 $2$ 位。
## 样例

### 样例输入 #1
```
2 2
3 2
1 4
```
### 样例输出 #1
```
1.50
```
## 提示

对于 $100\%$ 的数据，$2\le M\le 9$，$1\le N\le 60$，$1\le T\le 10^3$。


---

---
title: "[ZJOI2007] 捉迷藏"
layout: "post"
diff: 省选/NOI-
pid: P2056
tag: ['2007', '各省省选', '点分治', '浙江']
---
# [ZJOI2007] 捉迷藏
## 题目描述

Jiajia 和 Wind 是一对恩爱的夫妻，并且他们有很多孩子。某天，Jiajia、Wind 和孩子们决定在家里玩捉迷藏游戏。他们的家很大且构造很奇特，由 $N$ 个屋子和 $N-1$ 条双向走廊组成，这 $N-1$ 条走廊的分布使得任意两个屋子都互相可达。 


游戏是这样进行的，孩子们负责躲藏，Jiajia 负责找，而 Wind 负责操纵这 $N$ 个屋子的灯。在起初的时候，所有的灯都没有被打开。每一次，孩子们只会躲藏在没有开灯的房间中，但是为了增加刺激性，孩子们会要求打开某个房间的电灯或者关闭某个房间的电灯。为了评估某一次游戏的复杂性，Jiajia 希望知道可能的最远的两个孩子的距离（即最远的两个关灯房间的距离）。 

我们将以如下形式定义每一种操作： 

- C(hange) i 改变第 $i$ 个房间的照明状态，若原来打开，则关闭；若原来关闭，则打开。 
- G(ame) 开始一次游戏，查询最远的两个关灯房间的距离。
## 输入格式

第一行包含一个整数 $N$，表示房间的个数，房间将被编号为 $1,2,3…N$ 的整数。

接下来 $N-1$ 行每行两个整数 $a$, $b$，表示房间 $a$ 与房间 $b$ 之间有一条走廊相连。

接下来一行包含一个整数 $Q$，表示操作次数。接着 $Q$ 行，每行一个操作，如上文所示。
## 输出格式

对于每一个操作 Game，输出一个非负整数，表示最远的两个关灯房间的距离。若只有一个房间是关着灯的，输出 `0`；若所有房间的灯都开着，输出 `-1`。
## 样例

### 样例输入 #1
```
8
1 2
2 3
3 4
3 5
3 6
6 7
6 8
7
G
C 1
G
C 2
G
C 1
G
```
### 样例输出 #1
```
4
3
3
4
```
## 提示

对于$20\%$的数据， $N \leq 50$, $M\leq 100$； 

对于$60\%$的数据， $N \leq 3000$, $M \leq 10000$； 

对于$100\%$的数据， $N \leq 100000$, $M \leq 500000$。 



---

---
title: "[ZJOI2007] 仓库建设"
layout: "post"
diff: 省选/NOI-
pid: P2120
tag: ['2007', '各省省选', '浙江', '动态规划优化', '斜率优化']
---
# [ZJOI2007] 仓库建设
## 题目描述

L 公司有 $n$ 个工厂，由高到低分布在一座山上，工厂 $1$ 在山顶，工厂 $n$ 在山脚。

由于这座山处于高原内陆地区（干燥少雨），L公司一般把产品直接堆放在露天，以节省费用。突然有一天，L 公司的总裁 L 先生接到气象部门的电话，被告知三天之后将有一场暴雨，于是 L 先生决定紧急在某些工厂建立一些仓库以免产品被淋坏。

由于地形的不同，在不同工厂建立仓库的费用可能是不同的。第 $i$ 个工厂目前已有成品 $p_i$ 件，在第 $i$ 个工厂位置建立仓库的费用是 $c_i$。

对于没有建立仓库的工厂，其产品应被运往其他的仓库进行储藏，而由于 L 公司产品的对外销售处设置在山脚的工厂 $n$，故产品只能往山下运（即**只能运往编号更大的工厂的仓库**），当然运送产品也是需要费用的，一件产品运送一个单位距离的费用是 $1$。

假设建立的仓库容量都都是足够大的，可以容下所有的产品。你将得到以下数据：

- 工厂 $i$ 距离工厂 $1$ 的距离 $x_i$（其中 $x_1=0$）。
- 工厂 $i$ 目前已有成品数量 $p_i$。
- 在工厂 $i$ 建立仓库的费用 $c_i$。

请你帮助 L 公司寻找一个仓库建设的方案，使得总的费用（建造费用 + 运输费用）最小。
## 输入格式

输入的第一行是一个整数 $n$，代表工厂的个数。

第 $2$ 到 $(n + 1)$ 行，每行有三个用空格隔开的整数，第 $(i + 1)$ 行的整数依次代表 $x_i,~p_i,~c_i$。
## 输出格式

仅输出一行一个整数，代表最优方案的费用。
## 样例

### 样例输入 #1
```
3
0 5 10
5 3 100
9 6 10
```
### 样例输出 #1
```
32

```
## 提示

#### 样例输入输出 $1$ 解释

在工厂 $1$ 和工厂 $3$ 建立仓库，建立费用为 $10+10=20$ ，运输费用为 $(9-5) \times 3 = 12$，总费用 $32$。

#### 数据范围与约定

对于 $20\%$ 的数据，保证 $n \leq 500$。

对于 $40\%$ 的数据，保证 $n \leq 10^4$。

对于 $100\%$ 的数据，保证 $1 \leq n \leq 10^6$，$0 \leq x_i,p_i,c_i < 2^{31}$。

对于任意的 $1 \leq i < n$，保证 $x_i < x_{i + 1}$。

设答案为 $ans$，保证 $ans + \sum\limits_{i = 1}^{n} p_ix_i < 2^{63}$。


---

---
title: "[JSOI2010] 巨额奖金"
layout: "post"
diff: 省选/NOI-
pid: P2143
tag: ['2010', '各省省选', '江苏']
---
# [JSOI2010] 巨额奖金
## 题目描述

 NJ 市的快速发展得益于其便捷的交通。可是，随着经济的发展，大量的人进入 NJ 市， NJ 市的交通也承受着巨大的压力。现在， NJ 市正在筹划建设一个新型的交通枢纽，从而减轻交通的压力。

 NJ 市包含 $n$ 个区，有些区之间有双向的干道存在。新型交通枢纽建设在这些干道的基础上，将其中的部分干道改进为新型干道。改进后，干道能承受的压力可以比原来增加几十倍。为了和谐发展，在新型的交通枢纽建成后，要求任何两个区之间都可以只通过新型干道（直接或间接地）连接。政府已经预测出每条干道改进为新型干道的费用。政府希望建设新型交通枢纽的总费用最小，并以巨额奖金向市民征集方案。政府很快发现费用最小的方案不一定唯一，所以决定将奖金平分给每一种方案的第一个设计者，即如果一个人设计的费用是最小的而且前面没人和他设计出一模一样的方案，则他可获奖。

 Js08 被奖金深深的吸引，准备设计一种方案。可是，他发现方案可能会很多，如果最后获奖者太多，巨额的资金分到每个人头上的也不会太多。所以他决定先算一下可行的方案数是多少。

## 输入格式

输入共 $m + 1$ 行。

输入的第一行包含两个数 $n, m$，分别表示该市有多少个区和有多少条干道。

接下来 $m$ 行，每行三个数 $a_i$、$b_i$、$c_i$，表示 $a_i$ 区和 $b_i$ 区之间有一条干道，如果改进需要 $c_i$ 的费用。
## 输出格式

输出费用最小的方案有多少种。由于答案可能很大，你只要输出方案数除以 $31011$ 的模即可。
## 样例

### 样例输入 #1
```
4 6

1 2 1

1 3 1

1 4 1

2 3 2

2 4 1

3 4 1


```
### 样例输出 #1
```
8
```
## 提示

### 数据规模与约定

对于 $100\%$ 的数据，保证 $1 \leq n \leq 100$，$1 \leq m \leq 1000$，$1 \leq a _ i, b _ i \leq n$，$1 \leq c _ i \leq 10 ^ 9$。


---

---
title: "[FJOI2007] 轮状病毒"
layout: "post"
diff: 省选/NOI-
pid: P2144
tag: ['动态规划 DP', '高精度', '递推', '2007', '各省省选', '福建']
---
# [FJOI2007] 轮状病毒
## 题目描述

轮状病毒有很多变种。许多轮状病毒都是由一个轮状基产生。一个 $n$ 轮状基由圆环上 $n$ 个不同的基原子和圆心的一个核原子构成。$2$ 个原子之间的边表示这 $2$ 个原子之间的信息通道，如图 1 所示。

$n$ 轮状病毒的产生规律是在 $n$ 轮状基中删除若干边，使各原子之间有唯一一条信息通道。例如，共有 $16$ 个不同的 $3$ 轮状病毒，如图 2 所示。

给定 $n\ (n\le100)$，编程计算有多少个不同的 $n$ 轮状病毒。

![](https://cdn.luogu.com.cn/upload/pic/1408.png)

## 输入格式

第一行有 $1$ 个正整数 $n$。

## 输出格式

共 $1$ 行，表示不同的 $n$ 轮状病毒数。

## 样例

### 样例输入 #1
```
3

```
### 样例输出 #1
```
16
```


---

---
title: "[SDOI2008] 洞穴勘测"
layout: "post"
diff: 省选/NOI-
pid: P2147
tag: ['2008', '各省省选', '平衡树', '山东', '动态树 LCT']
---
# [SDOI2008] 洞穴勘测
## 题目描述

辉辉热衷于洞穴勘测。

某天，他按照地图来到了一片被标记为JSZX的洞穴群地区。经过初步勘测，辉辉发现这片区域由n个洞穴（分别编号为1到n）以及若干通道组成，并且每条通道连接了恰好两个洞穴。假如两个洞穴可以通过一条或者多条通道按一定顺序连接起来，那么这两个洞穴就是连通的，按顺序连接在一起的这些通道则被称之为这两个洞穴之间的一条路径。 洞穴都十分坚固无法破坏，然而通道不太稳定，时常因为外界影响而发生改变，比如，根据有关仪器的监测结果，123号洞穴和127号洞穴之间有时会出现一条通道，有时这条通道又会因为某种稀奇古怪的原因被毁。

辉辉有一台监测仪器可以实时将通道的每一次改变状况在辉辉手边的终端机上显示：

如果监测到洞穴u和洞穴v之间出现了一条通道，终端机上会显示一条指令 `Connect u v`

如果监测到洞穴u和洞穴v之间的通道被毁，终端机上会显示一条指令 `Destroy u v`

经过长期的艰苦卓绝的手工推算，辉辉发现一个奇怪的现象：无论通道怎么改变，任意时刻任意两个洞穴之间至多只有一条路径。

因而，辉辉坚信这是由于某种本质规律的支配导致的。因而，辉辉更加夜以继日地坚守在终端机之前，试图通过通道的改变情况来研究这条本质规律。 然而，终于有一天，辉辉在堆积成山的演算纸中崩溃了……他把终端机往地面一砸（终端机也足够坚固无法破坏），转而求助于你，说道：“你老兄把这程序写写吧”。

辉辉希望能随时通过终端机发出指令 `Query u v`，向监测仪询问此时洞穴u和洞穴v是否连通。现在你要为他编写程序回答每一次询问。 已知在第一条指令显示之前，JSZX洞穴群中没有任何通道存在。

## 输入格式

第一行为两个正整数n和m，分别表示洞穴的个数和终端机上出现过的指令的个数。 以下m行，依次表示终端机上出现的各条指令。每行开头是一个表示指令种类的字符串s（"Connect”、”Destroy”或者”Query”，区分大小写），之后有两个整数u和v (1≤u, v≤n) 分别表示两个洞穴的编号。

## 输出格式

对每个Query指令，输出洞穴u和洞穴v是否互相连通：是输出”Yes”，否则输出”No”。（不含双引号）

## 样例

### 样例输入 #1
```
200 5
Query 123 127
Connect 123 127
Query 123 127
Destroy 127 123
Query 123 127
```
### 样例输出 #1
```
No
Yes
No

```
### 样例输入 #2
```
3 5
Connect 1 2
Connect 3 1
Query 2 3
Destroy 1 3
Query 2 3
```
### 样例输出 #2
```
Yes
No
```
## 提示

数据说明


10%的数据满足n≤1000, m≤20000

20%的数据满足n≤2000, m≤40000

30%的数据满足n≤3000, m≤60000

40%的数据满足n≤4000, m≤80000

50%的数据满足n≤5000, m≤100000

60%的数据满足n≤6000, m≤120000

70%的数据满足n≤7000, m≤140000

80%的数据满足n≤8000, m≤160000

90%的数据满足n≤9000, m≤180000

100%的数据满足n≤10000, m≤200000


保证所有Destroy指令将摧毁的是一条存在的通道

本题输入、输出规模比较大，建议c\c++选手使用scanf和printf进行I\O操作以免超时

---

@namespace_std 于 2019.12.1 添加一组 Hack 数据


---

---
title: "[SDOI2009] HH去散步"
layout: "post"
diff: 省选/NOI-
pid: P2151
tag: ['递推', '2009', '各省省选', '山东', '矩阵乘法', '构造']
---
# [SDOI2009] HH去散步
## 题目描述

HH 有个一成不变的习惯，喜欢饭后百步走。所谓百步走，就是散步，就是在一定的时间内，走过一定的距离。但是同时 HH 又是个喜欢变化的人，所以他不会立刻沿着刚刚走来的路走回。又因为 HH 是个喜欢变化的人，所以他每天走过的路径都不完全一样，他想知道他究竟有多少种散步的方法。

现在给你学校的地图（假设每条路的长度都是一样的都是 $1$），问长度为 $t$，从给定地点 $A$ 走到给定地点 $B$ 共有多少条符合条件的路径。
## 输入格式

第一行：五个整数 $N,M,t,A,B$。其中 $N$ 表示学校里的路口的个数，$M$ 表示学校里的路的条数，$t$ 表示 HH 想要散步的距离，$A$ 表示散步的出发点，而 $B$ 则表示散步的终点。

接下来 $M$ 行，每行一组 $A_i,B_i$，表示从路口 $A_i$ 到路口 $B_i$ 有一条路。数据保证 $A_i \neq B_i$，但不保证任意两个路口之间至多只有一条路相连接。路口编号从 $0$ 到 $N-1$。同一行内所有数据均由一个空格隔开，行首行尾没有多余空格。没有多余空行。答案模 $45989$。
## 输出格式

一行，表示答案。

## 样例

### 样例输入 #1
```
4 5 3 0 0
0 1
0 2
0 3
2 1
3 2
```
### 样例输出 #1
```
4
```
## 提示

### 数据范围及约定

对于 $30\%$ 的数据，$N \le 4$，$M \le 10$，$t \le 10$。

对于 $100\%$ 的数据，$N \le 50$，$M \le 60$，$t \le 2^{30}$，$0 \le A,B$。


---

---
title: "[SDOI2009] 晨跑"
layout: "post"
diff: 省选/NOI-
pid: P2153
tag: ['2009', '各省省选', '山东', '深度优先搜索 DFS', '费用流']
---
# [SDOI2009] 晨跑
## 题目描述

Elaxia 最近迷恋上了空手道，他为自己设定了一套健身计划，比如俯卧撑、仰卧起坐等等，不过到目前为止，他坚持下来的只有晨跑。 

现在给出一张学校附近的地图，这张地图中包含 $N$ 个十字路口和 $M$ 条街道，Elaxia 只能从 一个十字路口跑向另外一个十字路口，街道之间只在十字路口处相交。

Elaxia 每天从寝室出发跑到学校，保证寝室编号为 $1$，学校编号为 $N$。 

Elaxia 的晨跑计划是按周期（包含若干天）进行的，由于他不喜欢走重复的路线，所以在一个周期内，每天的晨跑路线都不会相交（在十字路口处），寝室和学校不算十字路口。

Elaxia 耐力不太好，他希望在一个周期内跑的路程尽量短，但是又希望训练周期包含的天数尽量长。

除了练空手道，Elaxia 其他时间都花在了学习和找 MM 上面，所有他想请你帮忙为他设计 一套满足他要求的晨跑计划。

可能存在 $1\rightarrow n$ 的边。这种情况下，这条边只能走一次。
## 输入格式

第一行两个整数 $N,M$，表示十字路口数和街道数。 

接下来 $M$ 行，每行 $3$ 个数 $a,b,c$，表示路口 $a$ 和路口 $b$ 之间有条长度为 $c$ 的街道（单向）。
## 输出格式

一行两个整数，最长周期的天数和满足最长天数的条件下最短的路程度。
## 样例

### 样例输入 #1
```
7 10
1 2 1
1 3 1
2 4 1
3 4 1
4 5 1
4 6 1
2 5 5
3 6 6
5 7 1
6 7 1
```
### 样例输出 #1
```
2 11

```
## 提示

- 对于 $30\%$ 的数据，$N\le 20$，$M \le 120$。
- 对于 $100\%$ 的数据，$N\le 200$，$M\le 2\times 10^4,1\le c\le 10^4$。


---

---
title: "[SDOI2009] 虔诚的墓主人"
layout: "post"
diff: 省选/NOI-
pid: P2154
tag: ['数学', '2009', '各省省选', '树状数组', '山东', '排列组合']
---
# [SDOI2009] 虔诚的墓主人
## 题目描述

小W是一片新造公墓的管理人。公墓可以看成一块 $N×M$ 的矩形，矩形的每个格点，要么种着一棵常青树，要么是一块还没有归属的墓地。

当地的居民都是非常虔诚的基督徒，他们愿意提前为自己找一块合适墓地。为了体现自己对主的真诚，他们希望自己的墓地拥有着较高的虔诚度。

一块墓地的虔诚度是指以这块墓地为中心的十字架的数目。一个十字架可以看成中间是墓地，墓地的正上、正下、正左、正右都有恰好 $k$ 棵常青树。

形式化地，对于一个坐标为 $(x, y)$ 的墓地，以其为中心的十字架个数是这样的长度为 $4k$ 的二元组序列 $[(x_{1,1},y_{1,1}),\allowbreak(x_{1,2},y_{1,2}),\allowbreak\cdots,(x_{1,k},y_{1,k}),\allowbreak(x_{2,1},y_{2,1}),\allowbreak(x_{2,2},y_{2,2}),\allowbreak\cdots,(x_{2,k},y_{2,k}),\allowbreak(x_{3,1},y_{3,1}),\allowbreak(x_{3,2},y_{3,2}),\allowbreak\cdots,(x_{3,k},y_{3,k}),\allowbreak(x_{4,1},y_{4,1}),\allowbreak(x_{4,2},y_{4,2}),\allowbreak\cdots,(x_{4,k},y_{4,k})]$ 的方案数：

- 每一个二元组对应着一棵常青树的坐标；
- $x_{1,1}<x_{1,2}<\cdots< x_{1,k}<x$ 且 $y_{1,1}=y_{1,2}=\cdots=y_{1,k}=y$；
- $x<x_{2,1}<x_{2,2}<\cdots< x_{2,k}$ 且 $y_{2,1}=y_{2,2}=\cdots=y_{2,k}=y$；
- $y_{3,1}<y_{3,2}<\cdots< y_{3,k}<y$ 且 $x_{3,1}=x_{3,2}=\cdots=x_{3,k}=x$；
- $y<y_{4,1}<y_{4,2}<\cdots< y_{4,k}$ 且 $x_{4,1}=x_{4,2}=\cdots=x_{4,k}=x$。

小W希望知道他所管理的这片公墓中所有墓地的虔诚度总和是多少。
## 输入格式

第一行包含两个用空格分隔的正整数 $N$ 和 $M$，表示公墓的宽和长，因此这个矩形公墓共有 $(N+1) ×(M+1)$ 个格点，左下角的坐标为 $(0, 0)$，右上角的坐标为 $(N, M)$。

第二行包含一个正整数 $W$，表示公墓中常青树的个数。

第三行起共 $W$ 行，每行包含两个用空格分隔的非负整数 $x_i$ 和 $y_i$，表示一棵常青树的坐标。输入保证没有两棵常青树拥有相同的坐标。

最后一行包含一个正整数 $k$，意义如题目所示。
## 输出格式

输出仅包含一个非负整数，表示这片公墓中所有墓地的虔诚度总和。为了方便起见，答案对 $2{,}147{,}483{,}648$ 取模。
## 样例

### 样例输入 #1
```
5 6

13

0 2

0 3

1 2

1 3

2 0

2 1

2 4

2 5

2 6

3 2

3 3

4 3

5 2

2
```
### 样例输出 #1
```
6
```
## 提示

图中，以墓地 $(2, 2)$ 和 $(2, 3)$ 为中心的十字架各有 $3$ 个，即它们的虔诚度均为 $3$。其他墓地的虔诚度为 $0$。

 ![](https://cdn.luogu.com.cn/upload/pic/1589.png) 

对于 $30\%$ 的数据，满足 $1 ≤ N, M ≤ 10^3$。

对于 $60\%$ 的数据，满足 $1 ≤ N, M ≤ 10^6$。

对于 $100\%$ 的数据，满足 $1 ≤ N, M ≤ 10^9$，$0 ≤ x_i ≤ N$，$0 ≤ y_i ≤ M$，$1 ≤ W ≤ 10^5$，$1 ≤ k ≤ 10$。

存在 $50\%$ 的数据，满足 $1 ≤ k ≤ 2$。

存在 $25\%$ 的数据，满足 $1 ≤ W ≤ 10^4$。


---

---
title: "[SDOI2009] 细胞探索"
layout: "post"
diff: 省选/NOI-
pid: P2156
tag: ['2009', '各省省选', '山东']
---
# [SDOI2009] 细胞探索
## 题目描述

生物课上，老师开始为同学们介绍细胞。为了加深同学们的印象，老师在一张N×M的矩阵中定义了一种细胞，矩阵中仅有井号“#”和点“.”：

细胞由细胞核、细胞质及细胞膜构成。细胞核是一个4连通（上下左右相连）的全为“#”的连通块，它必须实心，即不能存在一个4连通的“.”连通块被其完全包围（所谓完全包围指的是，这个“.”连通块不能位于矩阵边界相邻，且它的4相邻格子均属于包含它的“#”连通块）。细胞膜是一个8连通（上下左右，以及4个对角方向）的全为“#”的非实心连通块。细胞膜仅包围一个4连通的区域，且这个区域内有且仅有一个细胞核，这个区域剩下的位置全为“.”。

所有连通块必须极大化，即一个8连通块周围不能找到一个“#”与这个连通块的任意一个“#”8连通；同样，对于一个4连通块周围不能找到一个“#”与这个连通块的任意一个“#”4连通。

现在，老师画了一幅图画，并让小E回答图画中一共有几个细胞，并把图画中不属于任何一个细胞的“#”改成“.”。

## 输入格式

输入文件explore.in的第一行包含两个用空格分隔的正整数N和M，表示矩阵的高和长。

接下来一个N行M列的矩阵，矩阵中仅含井号“#”和点“.”，保证没有多余字符。

## 输出格式

输出文件explore.out第一行包含一个整数，表示输入的矩阵中的细胞数。

接下来一个N行M列的矩阵，矩阵中仅含井号“#”和点“.”，表示更改后的图画。

## 样例

### 样例输入 #1
```
12 13

.###..#####..

#...#.#....#.

#.#.#.#..#.#.

#...#..#...#.

.###.#..###..

....#..##...#

..........###

##########..#

#...........#

#.###...###.#

#...........#

#############


```
### 样例输出 #1
```
1

......#####..

......#....#.

......#..#.#.

.......#...#.

........###..

.......##....

.............

.............

.............

.............

.............

.............


```
### 样例输入 #2
```
9 14

#########.....

#.......#....#

#.#####.#...#.

#.#...#.#..#..

#.#.#.#.#.#..#

#.#...#.#..#..

#.#####.#...#.

#.......#....#

#########.....


```
### 样例输出 #2
```
1

..............

..............

..#####.......

..#...#.......

..#.#.#.......

..#...#.......

..#####.......

..............

..............


```
### 样例输入 #3
```
7 15

#######.#######

#.....#.#.....#

#.###.#.#.###.#

#.#.#.#.#.#...#

#.###.#.#.###.#

#.....#.#.....#

#######.#######


```
### 样例输出 #3
```
1

........#######

........#.....#

........#.###.#

........#.#...#

........#.###.#

........#.....#

........#######


```
## 提示

对于20%的数据，满足1 ≤ N, M ≤ 20。

另有20%的数据，满足所有“#”都属于某一个正确的细胞。

对于100%的数据，满足1 ≤ N, M ≤ 1,000。



---

---
title: "[SDOI2009] 学校食堂"
layout: "post"
diff: 省选/NOI-
pid: P2157
tag: ['动态规划 DP', '2009', '各省省选', '山东', '枚举', '状压 DP']
---
# [SDOI2009] 学校食堂
## 题目描述

小 F 的学校在城市的一个偏僻角落，所有学生都只好在学校吃饭。学校有一个食堂，虽然简陋，但食堂大厨总能做出让同学们满意的菜肴。当然，不同的人口味也不一定相同，但每个人的口味都可以用一个非负整数表示。 由于人手不够，食堂每次只能为一个人做菜。做每道菜所需的时间是和前一道菜有关的，若前一道菜的对应的口味是 $a$，这一道为 $b$，则做这道菜所需的时间为 $(a\operatorname{or}b)-(a\operatorname{and}b)$，而做第一道菜是不需要计算时间的。其中，$\operatorname{or}$ 和 $\operatorname{and}$ 表示整数逐位或运算及逐位与运算，C 语言中对应的运算符为 `|` 和 `&`。


学生数目相对于这个学校还是比较多的，吃饭做菜往往就会花去不少时间。因此，学校食堂偶尔会不按照大家的排队顺序做菜，以缩短总的进餐时间。

虽然同学们能够理解学校食堂的这种做法，不过每个同学还是有一定容忍度的。也就是说，队伍中的第 $i$ 个同学，最多允许紧跟他身后的 $B_i$ 个人先拿到饭菜。一旦在此之后的任意同学比当前同学先拿到饭，当前同学将会十分愤怒。因此，食堂做菜还得照顾到同学们的情绪。 现在，小 F 想知道在满足所有人的容忍度这一前提下，自己的学校食堂做完这些菜最少需要多少时间。

## 输入格式

第一行包含一个正整数 $C$，表示测试点的数据组数。 每组数据的第一行包含一个正整数 $N$，表示同学数。 每组数据的第二行起共 $N$ 行，每行包含两个用空格分隔的非负整数 $T_i$ 和 $B_i$，表示按队伍顺序从前往后的每个同学所需的菜的口味和这个同学的忍受度。 每组数据之间没有多余空行。

## 输出格式

包含 $C$ 行，每行一个整数，表示对应数据中食堂完成所有菜所需的最少时间。

## 样例

### 样例输入 #1
```
2
5
5 2
4 1
12 0
3 3
2 2
2
5 0
4 0
```
### 样例输出 #1
```
16
1

```
## 提示

对于第一组数据：

同学 1 允许同学 2 或同学 3 在他之前拿到菜；同学 2 允许同学 3 在他之前拿到菜；同学 3 比较小气，他必须比他后面的同学先拿菜。

一种最优的方案是按同学 3、同学 2、同学 1、同学 4、同学 5 做菜，每道菜所需的时间分别是 0、8、1、6 及 1。


**数据规模和约定**

- 对于 $30\%$ 的数据，满足 $1 \le N \le 20$。

- 对于 $ 100\% $ 的数据，满足 $1 \le N \le 1000,0 \le T_i \le 1000,0 \le B_i \le 7，1 \le C \le 5$。

- 存在 $30\%$ 的数据，满足 $0 \le B_i \le 1$。

- 存在 $65\%$ 的数据，满足 $0 \le B_i \le 5$。

- 存在 $45\%$ 的数据，满足 $0 \le T_i \le 130$。



---

---
title: "[SHOI2009] 舞会"
layout: "post"
diff: 省选/NOI-
pid: P2159
tag: ['动态规划 DP', '2009', '各省省选', '上海', '排序']
---
# [SHOI2009] 舞会
## 题目描述

OItown要举办了一年一度的超级舞会了，作为主办方的Constantine为了使今年的舞会规模空前，他邀请了许多他的好友和同学去。舞会那天，恰好来了n个男生n个女生。Constantine发现，一般情况下，舞伴之间，总是男伴总是比女伴长得高，不过，偶尔也是有特殊情况的。所以，Constantine现在想知道，如果把这2n个人恰好配成n对舞伴，有多少种搭配方法，而且他要求最多只有k对舞伴之间女伴比男伴高。现在，Constantine需要参加SHTSC的你帮助他算出这个答案，当然啦，他会先告诉你这2n个同学的身高。

## 输入格式

第一行：两个整数n、k，含义如问题中所示。 第2行到第n+1行：n个整数，表示n个男生的身高。 第n+2行到第2n+1行：n个整数，表示n个女生的身高。 表示身高的正整数，都不超过 。

## 输出格式

输出文件只有一个，即满足n对舞伴中最多只有k对舞伴之间女伴比男伴高的男女搭配方案数。

## 样例

### 样例输入 #1
```
3 0
178
188
176
168
178
170

```
### 样例输出 #1
```
4
```
## 提示

评分
如果你的输出文件与标准答案完全相符，你将获得该测试点的全部分数，否则得零分。


N< = 200

K< = N


---

---
title: "[SHOI2007] 书柜的尺寸"
layout: "post"
diff: 省选/NOI-
pid: P2160
tag: ['动态规划 DP', '数学', '2007', '各省省选', '上海', '排序']
---
# [SHOI2007] 书柜的尺寸
## 题目描述

Tom 不喜欢那种一字长龙式的大书架，他只想要一个小书柜来存放他的系列工具书。Tom 打算把书柜放在桌子的后面，这样需要查书的时候就可以不用起身离开了。

显然，这种书柜不能太大，Tom 希望它的体积越小越好。另外，出于他的审美要求，他只想要一个三层的书柜。为了物尽其用，Tom 规定每层必须至少放一本书。现在的问题是，Tom 怎么分配他的工具书，才能让木匠造出最小的书柜来呢？ 

Tom很快意识到这是一个数学问题。每本书都有自己的高度 $h_i$ 和厚度 $t_i$。我们需要求的是一个分配方案，也就是要求把所有的书分配在 $S_1$、$S_2$ 和 $S_3$ **三个非空集合**里面的一个，不重复也不遗漏，那么，很明显，书柜正面表面积（$S$）的计算公式就是：  

$$S=\left(\sum_{j=1}^3 \max_{i \in S_j} h_i\right) \times \left(\max_{j=1}^3 \sum_{i \in S_j} t_i\right) $$

由于书柜的深度是固定的（显然，它应该等于那本最宽的书的长度），所以要求书柜的体积最小就是**要求 $S$ 最小**。Tom 离答案只有一步之遥了。不过很遗憾，Tom 并不擅长于编程，于是他邀请你来帮助他解决这个问题。
## 输入格式

第一行一个整数 $n$，代表书本的个数。

接下来 $n$ 行每行有两个整数 $h_i$ 和 $t_i$，代表每本书的高度和厚度。
## 输出格式

只有一行，即输出最小的 $S$。
## 样例

### 样例输入 #1
```
4
220 29
195 20
200 9
180 30
```
### 样例输出 #1
```
18000
```
## 提示

对于全部数据，$3 \leq n \leq 70$，$150 \leq h_i \leq 300$，$5 \leq t_i \leq 30$。


---

---
title: "[SHOI2007] 交通网络"
layout: "post"
diff: 省选/NOI-
pid: P2164
tag: ['2007', '各省省选', '上海', 'Special Judge']
---
# [SHOI2007] 交通网络
## 题目描述

著名的城市交通规划师L.Serenade为OItown的各个城堡之间设计了一套的地铁交通网络。每一条地铁线路都用来双向连通两个城堡。因为是建在地下的不同深度，所以这些地铁线路是可以“交叉”的。

OItown的居民们的生活和工作都在不同的城堡中进行，于是，每个OItown的居民都要在每天早晨从家出发，乘地铁去工作，当然地铁换乘是允许的。不过每个居民都会选择换乘次数最少的乘车方式。如果有多种乘车方式，这些乘车方式所需要的换乘次数一样，那么居民每天都会等概率的随机选择其中一种。

现在L.Serenade想请你为他计算出，每天每条地铁线路在早晨的平均客流量。他会告诉你，每个居民的家和工作地址，还有他设计的地铁交通网络的全部信息。

当然L.Serenade保证，交通网络能把城市连为一体，而且任意两个城堡之间的最优乘车方式（即换成次数最少的）不超过2^63-1种。

## 输入格式

输入文件的第一行有两个整数n、m，分别表示OItown里的城堡数（这些城堡用1.2.3...n标号）和地铁线路的数量。

接下去m行，每行包含两个整数，x、y，表示这两个城堡之间有一条地铁线路。注意，两个城堡之间最多只有一条地铁线路，且每条地铁线路只被输入文件描述一次。

最后的n行，每行有n个整数。

第i行的第j个非负整数Ci，j表示每天早晨有Ci，j个OItown的居民要从i城堡去j城堡。输入数据保证Ci，i=0。

## 输出格式

输出文件有m行，每行依次表示每条地铁线路每天早晨的平均客流。精确到小数点后一位。整数也应输出一位小数，例如1应输出为1.0。

## 样例

### 样例输入 #1
```
6 7
1 2
1 3
2 4
2 5
3 5
4 6
5 6
0 0 0 0 0 1
0 0 0 0 0 0
0 0 0 0 0 0
0 0 0 0 0 0
0 0 0 0 0 0
0 0 0 0 0 0
```
### 样例输出 #1
```
0.7
0.3
0.3
0.3
0.3
0.3
0.7
```
## 提示

样例说明：从城堡1到城堡六的使得换乘次数最少的乘车方式共有3种：1-2-4-6；1-2-5-6；1-3-5-6。所以每个人都有1/3的概率选择这其中的每一种。


N< = 300

M< = N\*(N-1) div 2

0< = C(i,j) < = 100



---

---
title: "[ZJOI2012] 网络"
layout: "post"
diff: 省选/NOI-
pid: P2173
tag: ['2012', '各省省选', '平衡树', '浙江', '动态树 LCT']
---
# [ZJOI2012] 网络
## 题目描述

有一个无向图 $G$，每个点有个权值，每条边有一个颜色。这个无向图满足以下两个条件：

1、 对于任意节点连出去的边中，相同颜色的边不超过两条。

2、图中不存在同色的环，同色的环指相同颜色的边构成的环。

在这个图上，你要支持以下三种操作：

- `0 x y` 表示把节点 $x$ 的权值改为 $y$

- `1 u v w` 表示将边 $(u,v)$ 的颜色改为 $w$。  

- `2 c u v` 表示查询由颜色 $c$ 的边构成的图中，所有可能在 $u \to v$ 之间的简单路径上的节点的权值的最大值。

## 输入格式

第一行四个正整数 $n,m,C,k$，分别表示节点数、边数、颜色数和操作数。

接下来 $n$ 行，每行一个正整数 $v_i$，为节点 $i$ 的权值。

之后 $m$ 行，每行三个正整数 $u,v,w$，为一条连接 $u,v$ 节点的边，颜色为$w$。

最后 $k$ 行，每行若干个正整数，表示一次操作。
## 输出格式

输出若干行，每行输出一个对应的信息。

1、 对于修改节点权值操作，不需要输出信息。

2、对于修改边的颜色操作，按以下几类输出：

- 若不存在连接节点 $u$ 和节点 $v$ 的边，输出 `No such edge.`。

- 若修改后不满足条件 $1$，不修改边的颜色，并输出 `Error 1.`。

- 若修改后不满足条件 $2$，不修改边的颜色，并输出 `Error 2.`。

- 其他情况，成功修改边的颜色，并输出 `Success.`。

输出满足条件的第一条信息即可，即若同时不满足条件 $1,2$ ，则只需要输出`Error 1.`。

3、 对于查询操作，输出一个整数表示答案。若 $u,v$ 之间没有颜色 $c$ 构成的路径，则输出 $-1$。

## 样例

### 样例输入 #1
```
4 5 2 7
1
2
3
4
1 2 0
1 3 1
2 3 0
2 4 1
3 4 0
2 0 1 4
1 1 2 1
1 4 3 1
2 0 1 4
1 2 3 1
0 2 5
2 1 1 4
```
### 样例输出 #1
```
4
Success.
Error 2.
-1
Error 1.
5
```
## 提示

 ![](https://cdn.luogu.com.cn/upload/pic/1714.png) 

颜色 $0$ 为实线的边，颜色 $1$ 为虚线的边，

由颜色 $0$ 构成的从节点 $1$ 到节点 $4$ 的路径有 $1 \to 2 \to 4$，故$\max\{v_1, v_2, v_4\} = \max\{ 1, 2, 4 \} = 4$。

将连接节点 $1$ 和节点 $2$ 的边修改为颜色 $1$，修改成功，输出 `Success.`

将连接节点 $4$ 和节点 $3$ 的边修改为颜色 $1$，由于修改后会使得存在由颜色 $1$ 构成的环( $1 – 2 – 4 – 3 – 1$ )，不满足条件 $2$，故不修改，并输`Error 2`。

不存在颜色 $0$ 构成的从节点 $1$ 到节点 $4$ 的边，输出 `-1`。

将连接节点 $2$ 和节点 $3$ 的边修改为颜色 $1$，由于修改后节点 $2$ 的连出去的颜色为 $1$ 的边有 $3$ 条，故不满足条件 $1$，故不修改，并输出`Error 1.` 。

将节点 $2$ 的权值修改为 $5$。

由颜色 $1$ 构成的从节点 $1$ 到节点 $4$ 的路径有 $1 \to 2 \to 4$，故$\max\{v_1, v_2, v_4\} = \max\{ 1, 5, 4 \} = 5$。

【数据范围】

对于 $30\%$ 的数据：$n ≤ 1000$，$m ≤ 10^4$，$k ≤ 1000$；   
另有 $20\%$ 的数据：$n ≤ 10^4$，$m ≤ 10^5$，$C = 1$，$k ≤ 10^5$；   
对于 $100\%$ 的数据：$n ≤ 10^4$，$m ≤ 10^5$，$C ≤ 10$，$k ≤ 10^5$。  

$1\le u,v,x \le n$，$0 \le c < C$，保证图中没有重边和自环。



---

---
title: "[HAOI2007] 覆盖问题"
layout: "post"
diff: 省选/NOI-
pid: P2218
tag: ['贪心', '2007', '河南', '二分', '各省省选', '深度优先搜索 DFS']
---
# [HAOI2007] 覆盖问题
## 题目描述

某人在山上种了 $N$ 棵小树苗。冬天来了，温度急速下降，小树苗脆弱得不堪一击，于是树主人想用一些塑料薄膜把这些小树遮盖起来，经过一番长久的思考，他决定 用 $3$ 个 $L \times L$ 的正方形塑料薄膜将小树遮起来。我们不妨将山建立一个平面直角坐标系，设第 $i$ 棵小树的坐标为 $(X_i,Y_i)$ ，$3$ 个 $L \times L$ 的正方形的边要求平行于坐标轴，一个点如果在正方形的边界上，也算作被覆盖。当然，我们希望塑料薄膜面积越小越好，即求 $L$ 最小值。
## 输入格式

接下来有 $N$ 行，第 $i+1$ 行有 $2$ 个整数 $X_i,Y_i$，表示第 $i$ 棵树的坐标，保证不会有 $2$ 个树的坐标相同。
## 输出格式

一行，输出最小的 $L$ 值。

## 样例

### 样例输入 #1
```
4

0 1

0 -1

1 0

-1 0


```
### 样例输出 #1
```
1
```
## 提示

对于 $100\%$ 的数据，$-1,000,000,000 \le X_i,Y_i \le 1,000,000,000。$

对于 $30\%$ 的数据，$N \le 100。$

对于 $50\%$ 的数据，$N \le 2000。$

对于 $100\%$ 的数据，$N \le 20000。$


---

---
title: "[HNOI2001] 软件开发"
layout: "post"
diff: 省选/NOI-
pid: P2223
tag: ['2001', '各省省选', '湖南']
---
# [HNOI2001] 软件开发
## 题目描述

某软件公司正在规划一项 $n$ 天的软件开发计划，根据开发计划第 $i$ 天需要 $n_i$ 个软件开发人员，为了提高软件开发人员的效率，公司给软件人员提供了很多的服务，其中一项服务就是要为每个开发人员每天提供一块消毒毛巾，这种消毒毛巾使用一天后必须再做消毒处理后才能使用。

消毒方式有两种，$A$ 种方式的消毒需要 $a$ 天时间，$B$ 种方式的消毒需要 $b$ 天，$A$ 种消毒方式的费用为每块毛巾 $f_A$, $B$ 种消毒方式的费用为每块毛巾 $f_B$，而买一块新毛巾的费用为 $f$（新毛巾是已消毒的，当天可以使用）。公司经理正在规划在这 $n$ 天中，每天买多少块新毛巾、每天送多少块毛巾进行 $A$ 种消毒和每天送多少块毛巾进行 $B$ 种消毒。当然，公司经理希望费用最低。

你的任务就是：为该软件公司计划每天买多少块毛巾、每天多少块毛巾进行 $A$ 种消毒和多少毛巾进行 $B$ 种消毒，使公司在这项 $n$ 天的软件开发中，提供毛巾服务的总费用最低。
## 输入格式

第一行为六个整数 $n,a,b,f,f_A,f_B$。

第二行为 $n$ 个整数 $n_1,n_2,\ldots,n_n$。

## 输出格式

仅一个整数，为最少的费用。
## 样例

### 样例输入 #1
```
4  1  2  3  2  1                         

8  2  1  6  


```
### 样例输出 #1
```
38
```
## 提示

#### 数据规模与约定
对于 $100\%$ 的数据，保证 $b>a$，$f>f_A>f_B$，$1\le f,f_A,f_B\le 60$，$1\le n\le 10^3$。


---

---
title: "[HNOI2001] 棋盘变换"
layout: "post"
diff: 省选/NOI-
pid: P2225
tag: ['动态规划 DP', '2001', '各省省选', '湖南', '费用流']
---
# [HNOI2001] 棋盘变换
## 题目描述

一个 $n\times n$ 的棋盘，在其中填入 $1$ 和 $-1$。经过一次变换后，方格里的每个数将会变成变换之前与之相邻的四个数的积。例如：

![](https://cdn.luogu.com.cn/upload/image_hosting/2q4jbad8.png)

但有一些状态，变换前和变换后是一样的，例如全部是 $1$ 的状态。这种状态被称为不变状态。

你的任务是要找到所有本质不同的不变状态（旋转或翻转之后的状态被视为是本质上相同的）。
## 输入格式

一行一个正整数 $n$。
## 输出格式

一行一个正整数表示所有本质不同的方案数。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
5
```
## 提示

$1\le n\le 30$。

题目给出范围内，不变状态总数 $<9\times 10^3$。


---

---
title: "[HNOI2002] 沙漠寻宝"
layout: "post"
diff: 省选/NOI-
pid: P2229
tag: ['2002', '各省省选', '湖南']
---
# [HNOI2002] 沙漠寻宝
## 题目描述

传说在漫无边际的沙漠中有一个古代城市的废墟，里面埋藏了大量的宝藏。听到这个消息的人一个又一个的前去寻宝，却没有发现一个回来的人。

探险家Jack是冒险者队伍中的后起之秀，它加入冒险者队伍的时间虽然不长，却屡屡依靠自己过人的智慧使自己和队友们脱离了险境。“明知山有虎，偏向虎山行”。 在Jack探险队的宗旨的指引下，Jack和他的队友们踏上了沙漠寻宝的旅程。

“我发现沙漠废墟了。”在一名队员的叫喊声中，Jack隐约看到了一些古代城市的残垣断壁和一个通道。 “一定就是这里了。”Jack带领着大家进入了通道。

然而，不幸的事情发生了。就在Jack他们进入通道的同时，通道的入口“轰”的一声就关闭了。Jack和他的队友走到了通道的尽头，正前方是一个巨大的铁门。最令人奇怪的是，铁门竟然使用的是一个极度先进的带有键盘和显示器的电子密码锁，铁门旁还赫然写着开锁的方法：“想到得到我的宝藏的人们，到这里的路途很辛苦吧！不过这一切很快就会结束的，这个铁门就是你们的葬身之地。除非你们能够计算出我屏幕上程序的结果，并且通过键盘输入进去，这扇门就会打开，里面就是我所有的宝藏”

我们的Jack果然不负众望，他打开了他的行囊，拿出了一个类似保险箱的东西。“没见过吗？这是最新型的笔记本电脑，没有它，我再怎么天才也不可能打开这扇门的。”面对大家疑惑的目光，Jack打开了笔记本电脑的开关。

“这个宝藏主人的程序十分的奇怪，我虽然没见过，但根据我的猜测，它的结构应该是这样的：

程序共包含6种语句：start,end,loop,continue,write,以及?=\*形式的语句。

start是程序的开始标志，其对应了一个结束标志end。

loop后面空一格并紧跟了一个表达式\*，表达式\*的值N表示即将循环N次，对应的循环结束标志也是end。

continue表示程序跳转到当前循环对应的end语句，break表示程序将跳出当前的循环。

write后面空一格并紧跟了一个表达式\*，表示要输出表达式\*的值，也就是要输入到密码锁中的内容。

?=\*是赋值语句，?是变量的名字，\*计算出来的值是要给?的。

另外，值得庆幸的是，变量名只允许使用’a’..’z’这26个小写字母，表达式也只允许使用加减乘除四种运算和以及括号，参与运算的也只能是26个变量或者是整数（允许不止一位整数）。表达式不会超过80个字符。”

“希望Jack能很快将锁打开。”大家心里默念着。

给定程序对所有语句的执行次数的总和小于2000000次。

## 输入格式

输入文件为program.in，给出了宝藏主人的程序。其中任两条语句用若干个空格或回车符隔开。

## 输出格式

输出文件为program.out，是你要输入密码锁的内容。每次输出占一行。

## 样例

### 样例输入 #1
```
start

     i=0

     j=0

     loop 100

          i=i+1

          j=j+i

          continue

          loop 10

               write j

          end

     end

     loop 100

          j=j+1

          break

          j=j+1

     end

     write j

end


```
### 样例输出 #1
```
5051
```


---

---
title: "[HNOI2002] 填数游戏"
layout: "post"
diff: 省选/NOI-
pid: P2232
tag: ['2002', '各省省选', '湖南', 'Special Judge']
---
# [HNOI2002] 填数游戏
## 题目描述

某商店最近开展了一个答题有奖的促销活动，公司经理将若干道有一定难度的问题贴到了商场的宣传栏内，如果你能够做出其中一道的话，你就能够获得优惠购买商品的权利。一段日子以后，大多数题目都被消费者们找出了答案，可是惟独有一道题目难倒了所有的人，这道题目是这样描述的：

将不同的完全平方数填满 $n \times m$ 的矩形方格表中的每一个小方格，使得每行、每列的和也是完全平方数（这个和必须小于 ${10}^{17}$）。希望你找到一种合理的方案。

Tiger 希望自己能够获得优惠购物的权利，于是他找到了准备参加 NOI2002 的你，希望你能够帮他设计一个程序找到一种合理的方案。

## 输入格式

输入文件中仅有一行，为两个正整数 $n, m$（$2 \le n, m \le 15$）。
## 输出格式

如果有解的话，输出 $n$ 行，每行有 $m$ 个数，表示一种合理的填数方案，无解时输出 `No answer`。

## 样例

### 样例输入 #1
```
2 2

```
### 样例输出 #1
```
225 1296
400 2304

```


---

---
title: "[HNOI2002] Kathy函数"
layout: "post"
diff: 省选/NOI-
pid: P2235
tag: ['动态规划 DP', '高精度', '2002', '各省省选', '湖南', '数位 DP']
---
# [HNOI2002] Kathy函数
## 题目描述

Tiger 非常喜欢数学，所以他参加了学校组织的数学课外兴趣小组。在兴趣小组的学习当中，老师向 Tiger 介绍了 Kathy 函数，Kathy 函数是这样定义的：

$$
\left\{
\begin{aligned}
&f(1)=1\\
&f(3)=3\\
&f(2n)=f(n)\\
&f(4n+1)=2f(2n+1)-f(n)\\
&f(4n+3)=3f(2n+1)-2f(n)
\end{aligned}
\right.
$$

Tiger 对 Kathy 函数产生了浓厚的兴趣，他通过研究发现有很多的数 $n$ 都满足 $f(n)=n$。

对于一个给定的数 $m$，他希望你求出所有的满足 $f(n)=n$ 的正整数 $n$ 的个数，其中 $n\leq m$。
## 输入格式

输入只有一行一个整数，表示 $m$。
## 输出格式

输出一行一个整数，表示 $n$。
## 样例

### 样例输入 #1
```
5
```
### 样例输出 #1
```
3
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq m \leq 10^{100}$。


---

---
title: "[SHOI2002] 取石子游戏|【模板】威佐夫博弈"
layout: "post"
diff: 省选/NOI-
pid: P2252
tag: ['数学', '2002', '各省省选', '上海']
---
# [SHOI2002] 取石子游戏|【模板】威佐夫博弈
## 题目描述

有两堆石子，数量任意，可以不同。游戏开始由两个人轮流取石子。游戏规定，每次有两种不同的取法：一是可以在任意的一堆中取走任意多的石子；二是可以在两堆中同时取走相同数量的石子。最后把石子全部取完者为胜者。现在给出初始的两堆石子的数目，你先取，假设双方都采取最好的策略，问最后你是胜者还是败者。

## 输入格式

输入共一行。

第一行共两个数 $a, b$，表示石子的初始情况。

## 输出格式

输出共一行。

第一行为一个数字 $1,0$ 或 $-1$，如果最后你是胜利者则为 $1$；若失败则为 $0$；若结果无法确定则为 $-1$。

## 样例

### 样例输入 #1
```
8 4

```
### 样例输出 #1
```
1

```
## 提示

**数据范围**

$50\%$ 的数据满足 $a, b \le 1000$；

$100\%$ 的数据满足 $a, b \le 10^9$。



---

---
title: "[HNOI2004] FTP服务器"
layout: "post"
diff: 省选/NOI-
pid: P2262
tag: ['模拟', '2004', '各省省选', '湖南']
---
# [HNOI2004] FTP服务器
## 题目背景

File Transfer Protocol，文件传输协议，简称 FTP。人们可以通过 FTP 实现资源共享。一般的情况下用户访问一个 FTP 服务器是通过类似资源管理器的形式对该服务器上的资源进行浏览，并且不同权限的用户可以实现下载文件/文件夹，上传文件/文件夹。

## 题目描述

一个FTP服务器的所有资源都以文件的形式按树形结构存储在不同的文件夹里，最低一级的是根目录（即根文件夹），根目录里有若干个文件和文件夹，每一个文件夹里都可以拥有 $0$ 个或多个文件及文件夹，同一文件夹里不存在名称相同的文件和文件夹。

一个用户包含三个属性：

- $\text{userType}$：用户类型；
- $\text{userState}$：用户状态（用户正在执行的操作）；
- $\text{userPosition}$：用户当前所处的位置（即用户正在浏览的文件夹）。

用户分 $3$ 种类型：上传用户 $\text{uploadUser}$，下载用户 $\text{downloadUser}$，匿名用户 $\text{guest}$。

操作分 $3$ 种类型：浏览 $\text{scan}$，下载 $\text{download}$，上传 $\text{upload}$。

用户的权限是指用户允许进行的操作。不同类型的用户的权限是不同的。

任何一个用户是不能进行其没有权限的操作的，例如：一个匿名用户想要下载一个文件或者文件夹是不允许的。

一个文件/文件夹包含三个属性：

- $\text{fileName/folderName}$：文件名（不包含空格和回车）；
- $\text{fileSize/folderSize}$：文件大小
（单位 $\text{byte}$，$0 <\mathrm{filesize}< 10^5$，$0<\mathrm{folderSize}< 10^8$，文件夹的大小是它里面所包含的所有文件大小的总和）；
- $\text{fileState/folderState}$：当前状态，当前状态有两种：
  - 一种为正常 $\text{normal}$（文件/文件夹为正常状态时，允许用户对其进行操作）；
  - 另一种为上传未完成 $\text{uploading}$（处在此种状态时，用户只能够对其进行浏览操作，如果一个文件夹中有一个或多个文件处于 $\text{uploading}$ 状态，那么这个文件夹也处于 $\text{uploading}$ 状态）。

一个 FTP 服务器除了它所拥有的文件资源外，还有如下属性：

1. 访问用户的最大数量（包括所有不同类型的用户） $\text{maxUserNumber}<100$。如果当前访问用户数量已经达到最大值的话，其他新的用户对服务器的访问将是失败的。
2. 服务器的最大流量 $\text{maxServerFlux}<10^7$。
3. 单个用户允许的最大下载/上传流量 $\text{maxUserFlux}$。

FTP 服务器运行的最小时间单位为秒。

每一个用户在同一时刻只能进行一种操作。用户下载和上传文件/文件夹是需要一定时间的，而这个时间决定于用户流量 $\text{userFlux}$，单位为 $\text{byte/second}$，注意如果某一时刻文件/文件夹仍须上传/下载的大小（$>0$）小于 $\text{userFlux}$ 的话，上传/下载时间仍将按照一秒钟看待。

而 $\text{userFlux}$ 的值是如何确定的呢？

 $$\mathrm{userFlux} = \min(\mathrm{presentMaxUserFlux},\mathrm{maxUserFlux})$$

其中，$\text{presentMaxUserFlux}$ 为当前服务器的单个用户最大流量：

$$\mathrm{presentMaxUserFlux} = \lfloor \mathrm{maxServerFlux} / \mathrm{userTotal}\rfloor$$

（$\text{userTotal}$ 表示该时刻的正在进行上传和下载操作的用户数量）

一个用户通过一系列命令实现其在 FTP 服务器上的相关操作。下面介绍这些命令：

### $\verb!connect!$ 命令

- 格式：$\verb![name] + 空格 + connect + 空格 + 参数A!$。
- 例：$\verb!tsinghua connect 1!$。
- 表示在名叫 $\verb!name!$ 的用户请求以 $\verb!A!$ 身份连接到服务器上。如果当前的最大使用用户还没达到 $\text{maxUserNumber}$，并且该用户未连接到服务器，则连接成功，服务器反馈回一个相关信息 $\verb!success!$。否则反馈信息为 $\verb!unsuccess!$。一旦连接成功，用户其所处的位置 $\text{userPosition}$ 为服务器的根目录。$A=1$ 表示上传用户，$A=2$ 下载表示用户，$A=3$ 表示匿名用户。

### $\verb!quit!$ 命令

- 格式：$\verb![name] + 空格 + quit!$。
- 例：$\verb!tsinghua quit!$。
- 表示名叫 $\verb!name!$ 的用户断开与服务器的连接。如果用户未连接反馈 $\verb!unsuccess!$，否则反馈 $\verb!success!$。（注意用户在任何状态下都可以断开与服务器的连接）。

### $\verb!cd!$ 命令

- 格式：$\verb![name] + 空格 + cd + 空格 + [folderName/文件夹名称]!$。
- 例：$\verb!THU cd FD!$。
- 表示名叫 $\verb!name!$ 的用户希望从当前所处的文件夹进入该文件夹中的一个名叫 $\text{folderName}$ 的文件夹。如果名叫 $\text{folderName}$ 的文件夹存在并且处于 $\text{normal}$ 状态，则改变用户当前所处位置 $\text{userPosition}$，反馈相关信息 $\verb!success!$，如果该文件夹不存在或该用户没有成功连接，则反馈信息为 $\verb!unsuccess!$。

### $\verb!cd..!$ 命令

- 格式：$\verb![name] + 空格 + cd..!$。
- 例：$\verb!9# cd..!$。
- 表示名叫 $\verb!name!$ 的用户希望从当前所处的文件夹返回到他的上一级文件夹。如果用户处于根目录或者用户未连接，则命令执行失败返回 $\verb!unsuccess!$，否则返回 $\verb!success!$，并且改变用户所处位置 $\text{userPosition}$。

### $\verb!download!$ 命令

- 格式：$\verb![name] + 空格 + download + 空格 + [name1]!$。
- 例：$\verb!A download 1.txt!$。
- 表示名叫 $\verb!name!$ 的用户希望从当前所处文件夹下载名为 $\verb!name1!$ 的文件或者文件夹。如果用户未连接，用户没有下载权限，名为 $\verb!name1!$ 的文件/文件夹不存在，或者该文件/文件夹处于 $\text{uploading}$ 状态时，反馈信息 $\verb!unsuccess!$，否则返回 $\verb!success!$ 并且开始下载该文件/文件夹。（一旦一个下载命令开始执行，那么执行该命令的用户所下载的是下载命令执行的那一时刻的那一个文件/文件夹，也就是说如果一个用户正在下在某个文件夹，在下载过程中，有另外一用户在这个文件夹里面上传文件，那么原下载用户是不可能下载到这个新上传的文件的）。

### $\verb!upload!$ 命令

- 格式：$\verb![name] + 空格 + upload + 空格 + [name1] + 空格 + [size]!$。
- 例：$\verb!A upload B 1!$。
- 表示名叫 $\verb!name!$ 的用户希望在当前所处的文件夹上传一个名叫 $\verb!name1!$ 的大小为 $\text{size}$ 的文件/文件夹。注意：
  - 用户通过 $\verb!upload!$ 命令上传文件夹只能为空文件夹，当 $\text{size}=0$ 表示上传文件夹，size>0表示上传文件。
  - 如果当前目录已经存在了同名的文件/文件夹，用户未成功连接或者用户没有上传权限，反馈信息 $\verb!unsuccess!$，否则反馈 $\verb!success!$，并且开始上传文件/文件夹。（如果一个用户想要上传一个非空文件夹，是很容易通过一系列 $\verb!upload!$ 以及 $\verb!cd!$ 命令实现的）。

---

除上传文件和下载文件/文件夹命令需要耗时外，其他的命令都不需要执行时间。

你的任务是模拟一个 FTP 服务器在某一时间段内的运行过程。
## 输入格式

一开始你将从文件中获得 FTP 的服务器的初始信息。第一行为 $3$ 个正整数，分别表示 $\text{maxUserNumber},\text{maxServerFlux},\text{maxUserFlux}$。接下来的若干行描述 $\text{server}$ 里已有文件资源的存储情况。

第一行总是描述的根目录中的一个文件或者文件夹。

如果某一行描述的是一个文件或者文件夹那么该行的数据为 $\verb!name + 空格 + size!$，如果 $\text{size}=0$ 表示这是一个文件夹，否则表示一个大小为 $\text{size}$ 的文件。

如果某一行描述的是一个文件夹，那么接下来的若干行描述的都是这个文件夹里的内容，直到一个与之对应的减号为止。这些数据都是递归描述的。因为一开始就是描述整个根目录里的文件和文件夹，所以文件信息的最后一行也为减号。（参看输入示例）。

下面的每一行为 $\verb!time + 空格 + order!$ 的形式给出，例如 $\verb!4 ares connect 1!$ 表示：在服务器开启后 $4$ 秒钟，名叫 $\verb!ares!$ 的用户请求以 $\text{uploadUser}$ 的身份连接到服务器上来。

输入的最后一行为一个字符串 $\verb!down!$。

所有输入命令的时刻 $\text{time}$ 都以命令出现的先后递增，同一时刻的命令以输入中出现的先后顺序确定其执行顺序。

## 输出格式

请你将每一条命令的反馈信息输出。

## 样例

### 样例输入 #1
```
5 200 200
unzip.exe 100
xxxx 50
bin 0
tpx.exe 200
turbo.exe 300
tpx.tp 400
temp 0
-
-
readme.txt 100
-
0 ares connect 2
0 ares download zip.exe
1 ares download bin
5 ares download xxxx
6 ares cd bin
6 ares connect 1
6 ares quit
7 ares connect 1
7 rosen connect 2
7 ares cd bin
8 ares upload A 300
9 rosen download bin
10 rosen download bin
down

```
### 样例输出 #1
```
success
unsuccess
success
unsuccess
success
unsuccess
success
success
success
success
success
unsuccess
success

```
## 提示

来源：HNOI2004 经过修改。



---

---
title: "[HNOI2002] 树的排序"
layout: "post"
diff: 省选/NOI-
pid: P2274
tag: ['2002', '各省省选', '湖南']
---
# [HNOI2002] 树的排序
## 题目描述

1. 空树编号为 $0$，只有根节点的树编号为 $1$；
2. 设 $m$ 为一任意非负整数，那么任意一棵有 $m$ 个节点的树的编号小于任意一棵有 $m+1$ 个节点的树；
3. 设 $A,B$ 是两棵节点数相同的树（$A,B$ 不相同），则 $A$ 编号比 $B$ 小时，一定满足下面两个条件之一（反之亦然）：
   1. $A$ 左子树编号小于 $B$ 左子树编号；
   2. $A$ 左子树编号等于 $B$ 左子树编号（即 $A,B$ 左子树形态相同），且 $A$ 右子树编号小于 $B$ 右子树编号；
4. 编号按照正常的规则，编号应是连续的非负整数，任意一棵树唯一对应一个编号，任意一个非负整数唯一对应一棵树。

（注：上述树均指二叉树）
## 输入格式

仅 $1$ 行，为一个整数 $n$，$1\le n\le 500{,}000{,}000$。

对于 $10\%$ 的数据，保证树节点个数不超过三个。
## 输出格式

仅 $1$ 行，为对应编号为 $n$ 的二叉树。按下列方式输出：

- 如果是一个结点的二叉树，则输出 $X$；
- 如果二叉树的左、右子树分别为 $L$ 和 $R$，$L,R$ 的输出形式分别为 $L'$ 和 $R'$，则输出为 $\texttt{(}L'\texttt{)}X\texttt{(}R'\texttt{)}$，当左子树为空时，输出为 $X\texttt{(}R'\texttt{)}$，当左子树为空时 $\texttt{(}L'\texttt{)}X$。

## 样例

### 样例输入 #1
```
20
```
### 样例输出 #1
```
((X)X(X))X
```


---

---
title: "[HNOI2002] 农场的果树"
layout: "post"
diff: 省选/NOI-
pid: P2276
tag: ['2002', '各省省选', '湖南']
---
# [HNOI2002] 农场的果树
## 题目描述

Farmer John 的农场环境优美，其中生长了许多苹果树，而苹果正是 Farmer John 农场里奶牛最喜爱的食物！

一天，闲来无事的奶牛 Besty 坐在苹果树下。她忽然发现，农场里的苹果树都是的二叉树！——当然，这种二叉树并不是严格意义上的二叉树，它可能有左子树而不存在右子树，反之也有可能。

刚学过 Computer Science 的 Besty 给二叉树上每个节点记录下其左子树的节点个数。例如下面的一棵树：

```cpp
                3
              /  \
             1     3
            / \   / \
           0   0  1  0
                 / \
                0   0
```
随后，用先序遍历给这棵树编码，需要注意的是叶子节点上的数值不必考虑。为了更方便表述，Besty 又在这样的编码前加入一个数字：该树上节点总数。于是，上面这棵数的编码就是：9 3 1 3 1。

这样一来，每一种编码就对应了一棵唯一的二叉树。

Besty 还发现，农场里的所有二叉树的节点总数都相同！并且在节点总数确定的情况下，对任意的合法编码，农场里都存在唯一的一棵树与之对应！

于是，Besty 将所有的二叉树按照上述编码规则编码，然后以编码为关键字进行字典排序。

现在，对于一个给定的编码，奶牛 Besty 想知道字典排序紧跟其后的编码是什么。

## 输入格式

输入文件名：next.in

输入文件有一行，为一个二叉树的编码。保证节点总数不超过 $5\times10^3$。

## 输出格式

输出文件名：next.out

输出文件有一行，为按字典排序紧跟其后的编码是什么。如果输入的编码是最后一个，则输出 `-1`。

## 样例

### 样例输入 #1
```
9 3 1 3 1
```
### 样例输出 #1
```
9 3 1 3 2 0
```


---

---
title: "[HNOI2003] 多边形"
layout: "post"
diff: 省选/NOI-
pid: P2283
tag: ['模拟', '贪心', '2003', '各省省选', '湖南', '深度优先搜索 DFS']
---
# [HNOI2003] 多边形
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1330.png)

## 输入格式

输入文件名：input.txt

输入文件第一行是一个自然数N，表示多边形的顶点数。N不超过1500。之后N行每行两个整数(用空格分开)，依次表示多边形的每个顶点的坐标。

## 输出格式

输出文件名：output.txt

输出文件仅1行，是阴影部分的面积，保留2位小数。

## 样例

### 样例输入 #1
```
5									

0 0

0 6

6 6

6 0

3 3


```
### 样例输出 #1
```
9.00
```


---

---
title: "[HNOI2003] 密室之门"
layout: "post"
diff: 省选/NOI-
pid: P2284
tag: ['2003', '各省省选', '湖南']
---
# [HNOI2003] 密室之门
## 题目描述

最近，我国考古学家在秦陵兵马俑的新墓坑中发现了若干个密室，每个密室都可以由一个奇特的门进入。那么怎样才能进入密室呢？

第 $i$ 个密室的门上有 $a_i$ 个转盘，该密室的第 $j$ 个转盘被均匀的分成 $b_{i,j}$ 格，这 $b_{i,j}$ 个格子按顺时针方向依次编号为 $0,1,\dots,b_{i,j}-1$，并且每一个转盘上面都有一个指针（结构类似于钟表），指针大约每过 $1.53$ 秒就会从原来指向编号为 $x$ 的格子变成指向编号为 $(x+1)\mod b_{i,j}$ 的格子。当一扇门上所有的转盘上的指针都指向编号为 $0$ 的格子的时候，那么这扇门就会被开启。

但是当考古学家发现密室时，转盘上的指针都指向不同编号的格子，考古学家经过计算发现按照门被开启的原理，有些密室是永远也打不开的。你的任务就是判断那些密室的门是可能被打开的。
## 输入格式

输入文件的第一行为 $n$，表示密室的个数。接下来的数据分为 $n$ 组，每组描述一扇门。每组数据的第一行为 $a_i$，即该密室门上转盘的个数，接下来的 $a_i$ 行每行有两个数据，第一个数据表示 $b_{i,j}$，第二个数据表示发现该密室时指针所指向的格子的编号。
## 输出格式

输出文件总共有 $n$ 行。若第 $i$ 间密室的门能够被打开，则输出文件的第 $i$ 行输出 `possible`，如果不能打开则输出 `impossible`。（注意小写输出）。
## 样例

### 样例输入 #1
```
2

2

5 3

4 2

2

4 3

6 2


```
### 样例输出 #1
```
possible

impossible


```
## 提示

对于 $100\%$ 的数据，$n<100$。


---

---
title: "[HNOI2004] 最佳包裹"
layout: "post"
diff: 省选/NOI-
pid: P2287
tag: ['动态规划 DP', '递推', '2004', '各省省选', '湖南', '凸包']
---
# [HNOI2004] 最佳包裹
## 题目描述

发强公司生产了一种金属制品，是由一些笔直的金属条连接起来的，金属条和别的金属条在交点上被焊接在了一起。现在由于美观需要，在这个产品用一层特殊的材料包裹起来。公司为了节约成本，希望消耗的材料最少（不计裁剪时的边角料的损失）。

编程，输入包括该产品的顶点的个数，以及所有顶点的坐标；请计算出包裹这个产品所需要的材料的最小面积。结果要求精确到小数点后第六位（四舍五入）。
## 输入格式

输入文件由 $(n+1)$ 行组成。

第 $1$ 行是一个整数 $n$（$4 \leq n \leq 100$），表示顶点的个数；

第 $2$ 行到第 $(n+1)$ 行，第 $(i+1)$ 行有 $3$ 个实数 $x_i$，$y_i$，$z_i$，表示第 $i$ 个顶点的坐标。

保证顶点的位置各不相同。
## 输出格式

输出文件只有一个实数，四舍五入精确到小数点后六位，表示包裹一个该产品所需的材料面积的最小值。
## 样例

### 样例输入 #1
```
4 

0 0 0

1 0 0

0 1 0

0 0 1


```
### 样例输出 #1
```
2.366025
```


---

---
title: "[HNOI2004] L 语言"
layout: "post"
diff: 省选/NOI-
pid: P2292
tag: ['2004', '各省省选', '湖南', 'O2优化', 'AC 自动机', '状压 DP']
---
# [HNOI2004] L 语言
## 题目描述

标点符号的出现晚于文字的出现，所以以前的语言都是没有标点的。现在你要处理的就是一段没有标点的文章。  

一段文章 $T$ 是由若干小写字母构成。一个单词 $W$ 也是由若干小写字母构成。一个字典 $D$ 是若干个单词的集合。我们称一段文章 $T$ 在某个字典 $D$ 下是可以被理解的，是指如果文章 $T$ 可以被分成若干部分，且每一个部分都是字典 $D$ 中的单词。  

例如字典 $D$ 中包括单词 $\texttt{is},\texttt{name},\texttt{what},\texttt{your}$，则文章 $\texttt{whatisyourname}$ 是在字典 $D$ 下可以被理解的，因为它可以分成 $4$ 个单词：$\texttt{what},\texttt{is},\texttt{your},\texttt{name}$，且每个单词都属于字典 $D$，而文章 $\texttt{whatisyouname}$ 在字典 $D$ 下不能被理解，但可以在字典 $D'=D\cup\{\texttt{you}\}$ 下被理解。这段文章的一个前缀 $\texttt{whatis}$，也可以在字典 $D$ 下被理解，而且是在字典 $D$ 下能够被理解的最长的前缀。  

给定一个字典 $D$，你的程序需要判断若干段文章在字典 $D$ 下是否能够被理解。并给出其在字典 $D$ 下能够被理解的最长前缀的位置。
## 输入格式

第一行两个整数 $n$ 和 $m$，表示字典 $D$ 中有 $n$ 个单词，且有 $m$ 段文章需要被处理。

接下来 $n$ 行，每行一个字符串 $s$，表示字典 $D$ 中的一个单词。

接下来 $m$ 行，每行一个字符串 $t$，表示一篇文章。
## 输出格式

对于输入的每一篇文章，你需要输出一行一个整数，表示这段文章在字典 $D$ 可以被理解的最长前缀的位置。
## 样例

### 样例输入 #1
```
4 3 
is
name
what
your
whatisyourname
whatisyouname
whaisyourname

```
### 样例输出 #1
```
14
6
0

```
## 提示

#### 样例 1 解释

- 对于第一个询问，整段文章 `whatisyourname` 都能被理解。
- 对于第二个询问，前缀 `whatis` 能够被理解。
- 对于第三个询问，没有任何前缀能够被理解。

#### 数据规模与约定

- 对于 $80\%$ 的数据，保证 $m \leq 20$，$|t| \leq 10^6$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 20$，$1 \leq m \leq 50$，$1 \leq |s| \leq 20$，$1 \leq |t| \leq 2 \times 10^6$，$s$ 与 $t$ 中均只含小写英文字母。

#### 提示

- 请注意数据读入对程序效率造成的影响。
- 请注意【数据规模与约定】中标注的串长是单串长度，并不是字符串长度和。

#### 说明

本题数据有加强，其中前 $80\%$ 的数据为原测试数据。


---

---
title: "[HNOI2004] 高精度开根"
layout: "post"
diff: 省选/NOI-
pid: P2293
tag: ['高精度', '2004', '各省省选', '湖南', 'O2优化']
---
# [HNOI2004] 高精度开根
## 题目描述

晓华所在的工作组正在编写一套高精度科学计算的软件，一些简单的部分如高精度加减法、乘除法早已写完了，现在就剩下晓华所负责的部分：实数的高精度开m次根。

因为一个有理数开根之后可能得到一个无理数，所以这项工作是有较大难度的。现在要做的只是这项工作的第一步：只对自然数进行开整数次根，求出它的一个非负根，并且不考虑结果的小数部分，只要求把结果截断取整即可。

程序需要根据给定的输入，包括需要开根的次数，以及被开根的整数；计算出它的非负根取整后的结果。

## 输入格式

输入文件共有两行，每行都有一个整数，并且输入中没有多余的空格：

第一行有一个正整数m (1 <= m <= 50)，表示要开的根次；

第二行有一个整数n (0<=n <= 10^10000)，表示被开根的数。

## 输出格式

输出文件只有一行，包括一个数，即为开根取整后的结果。

## 样例

### 样例输入 #1
```
3
1000000000

```
### 样例输出 #1
```
1000
```


---

---
title: "[HNOI2005] 木梳"
layout: "post"
diff: 省选/NOI-
pid: P2314
tag: ['2005', '各省省选', '湖南']
---
# [HNOI2005] 木梳
## 题目描述

 ![](https://cdn.luogu.com.cn/upload/pic/1353.png) 

![](https://cdn.luogu.com.cn/upload/pic/1354.png)

## 输入格式

从文件input.txt中读入数据，文件第一行为整数L，其中4<=L<=100000，且有50%的数据满足L<=10^4，表示木板下侧直线段的长。第二行为L个正整数A1,A2,…,AL，其中1<Ai<=10^8，表示第i段的高度。

## 输出格式

输出文件output.txt中仅包含一个整数D，表示为使梳子面积最大，需要从木板上挖掉的格子数。

## 样例

### 样例输入 #1
```
9 

4 4 6 5 4 2 3 3 5


```
### 样例输出 #1
```
3
```


---

---
title: "[HNOI2005] 数三角形"
layout: "post"
diff: 省选/NOI-
pid: P2315
tag: ['2005', '各省省选', '树状数组', '湖南', '枚举']
---
# [HNOI2005] 数三角形
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1355.png)

## 输入格式

![](https://cdn.luogu.com.cn/upload/pic/1356.png)

## 输出格式

输出文件output.txt中仅包含一个整数T，表示有多少个三角形的边界都没有被删除。

## 样例

### 样例输入 #1
```
5

1 1 1

1 1 0 1 1 0

1 1 1 1 1 1 1 0 1

1 0 1 1 1 1 0 1 1 1 1 1

0 1 1 1 1 1 0 1 1 1 1 1 0 1 1


```
### 样例输出 #1
```
19
```


---

---
title: "[HNOI2005] 分形"
layout: "post"
diff: 省选/NOI-
pid: P2316
tag: ['2005', '并查集', '各省省选', '湖南', '前缀和']
---
# [HNOI2005] 分形
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1357.png)

## 输入格式

![](https://cdn.luogu.com.cn/upload/pic/1358.png)

## 输出格式

![](https://cdn.luogu.com.cn/upload/pic/1359.png)

## 样例

### 样例输入 #1
```
1 3 3

50000

0 0 0 0

150000 0 1 1

0 150000 1 1

3 5.497787 	  2 2.356194

3 1.570796 	  2 0.0

3 0.0         2 1.570796


```
### 样例输出 #1
```
175000

150000

200000


```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/1360.png)



---

---
title: "[HNOI2005] 星际贸易"
layout: "post"
diff: 省选/NOI-
pid: P2317
tag: ['动态规划 DP', '2005', '各省省选', '湖南', '最短路']
---
# [HNOI2005] 星际贸易
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1361.png)

## 输入格式

![](https://cdn.luogu.com.cn/upload/pic/1362.png)

## 输出格式

如果可以找到这样的方案，那么输出文件output.txt中包含两个整数X和Y。X表示贸易额，Y表示净利润并且两个数字之间用一个空格隔开。如果不能完成这次星际贸易，那么输出文件output.txt中包含 “Poor Coke!”（不包括引号）。

## 样例

### 样例输入 #1
```
6 3 10 4
1 2 1 1 1
1 2 2 2 1
1 2 3 9 1
1 1 4 0 1
1 1 5 0 1
1 1 6 1 1

```
### 样例输出 #1
```
6 2
```
### 样例输入 #2
```
6 3 2 4
1 2 1 1 1
1 2 2 2 1
1 2 3 0 1
1 1 4 0 1
1 1 5 0 1
1 1 6 1 1

```
### 样例输出 #2
```
Poor Coke!
```


---

---
title: "[HNOI2006] 潘多拉的宝盒"
layout: "post"
diff: 省选/NOI-
pid: P2321
tag: ['搜索', '2006', '各省省选', '湖南', '广度优先搜索 BFS', 'Tarjan']
---
# [HNOI2006] 潘多拉的宝盒
## 题目描述

 ![](https://cdn.luogu.com.cn/upload/pic/1372.png) 

![](https://cdn.luogu.com.cn/upload/pic/1373.png)

## 输入格式

 ![](https://cdn.luogu.com.cn/upload/pic/1374.png) 

![](https://cdn.luogu.com.cn/upload/pic/1375.png)

## 输出格式

输出一行一个数$t$，表示最长升级序列的长度。

## 样例

### 样例输入 #1
```
4
1  1
0
0  0
2  1
0
1  1
0  0
3  1
0
1  1
2  2
0  0
4  1
0
1  1
2  2
3  3
0  0
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3
1  1
0
0  0
3  1
0
0  1
2  0
1  2
9  1
0
0  1
2  3
4  5
6  7
8  0
1  2
3  4
5  6
7  8
```
### 样例输出 #2
```
3
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/1380.png)



---

---
title: "[SCOI2006] 一孔之见"
layout: "post"
diff: 省选/NOI-
pid: P2333
tag: ['2006', '四川', '各省省选']
---
# [SCOI2006] 一孔之见
## 题目描述

从一个圆孔里看一个凸多边形，为了让看到的面积至少为 $S$，孔的半径至少需要多大？  
假设孔的圆心固定在 $(0,0)$，且 $(0, 0)$ 在多边形的内部（而不是外部或边界上）。

## 输入格式

第一行包含一个整数 $n$ 和一个实数 $S$（精确到小数点后两位），表示凸多边形的顶点数和需要看到的面积。保证 $S$ 不超过凸多边形的面积。

以下 $n$ 行每行包含两个实数 $x,y$（精确到小数点后 $6$ 位），表示各顶点的坐标。顶点按逆时针顺序或顺时针顺序给出。

## 输出格式

包含一个实数 $r$，保留两位小数，表示孔的最小半径。

## 样例

### 样例输入 #1
```
3 1.60
-1 -1
1 -1
0 1

```
### 样例输出 #1
```
0.93
```
## 提示

【限制】

对于 $50\%$ 的数据：$3\le n \le 10$，输入凸多边形是正多边形，且中心在 $(0,0)$   
对于 $100\%$ 的数据：$3\le n \le 50$




---

---
title: "[SCOI2012] 喵星球上的点名"
layout: "post"
diff: 省选/NOI-
pid: P2336
tag: ['2012', '四川', '莫队', '各省省选', 'AC 自动机', '后缀数组 SA']
---
# [SCOI2012] 喵星球上的点名
## 题目描述

a180285 幸运地被选做了地球到喵星球的留学生。他发现喵星人在上课前的点名现象非常有趣。

假设课堂上有 $n$ 个喵星人，每个喵星人的名字由**姓**和**名**构成。喵星球上的老师会选择 $m$ 个串来点名，每次读出一个串的时候，如果这个串是一个喵星人的姓或名的**子串**，那么这个喵星人就必须答到。

然而，由于喵星人的字码如此古怪，以至于不能用 ASCII 码来表示。为了方便描述，a180285 决定用数串来表示喵星人的名字。



现在你能帮助 a180285 统计每次点名的时候有多少喵星人答到，以及 $m$ 次点名结束后每个喵星人答到多少次吗？

## 输入格式

首先定义喵星球上的字符串给定方法：

先给出一个正整数 $l$，表示字符串的长度，接下来 $l$ 个整数，第 $i$ 个整数 $a_i$ 表示字符串的第 $i$ 个字符。

输入的第一行有两个整数，分别表示喵星人的个数 $n$ 个点名次数 $m$。  
接下来 $n$ 行，每行两个喵星球上的字符串，按照定义的方法给出，依次表示第 $i$ 只喵的姓和名。  
接下来 $m$ 行，每行一个喵星球上的字符串，表示一个老师点名的串。
## 输出格式

对于每个老师点名的串，输出一行一个整数表示有多少只喵答到。  
然后在最后一行输出 $n$ 个用空格隔开的整数，第 $i$ 个整数表示第 $i$ 个喵星人被点到的次数。

## 样例

### 样例输入 #1
```
2 3
6 8 25 0 24 14 8 6 18 0 10 20 24 0
7 14 17 8 7 0 17 0 5 8 25 0 24 0
4 8 25 0 24
4 7 0 17 0
4 17 0 8 25

```
### 样例输出 #1
```
2
1
0
1 2
```
## 提示

#### 样例 1 解释

事实上样例给出的数据如果翻译成地球上的语言可以这样来看

```plain
2 3
izayoi sakuya
orihara izaya
izay
hara
raiz
```

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n, m \le 10^3$，喵星人的名字总长不超过 $4\times10^3$，点名串的总长不超过 $2\times10^3$。
- 对于$100\%$ 的数据，保证 $1 \leq n\le 5 \times 10^4$，$1 \leq m \le 10^5$，喵星人的名字总长和点名串的总长分别不超过 $10^5$，保证喵星人的字符串中作为字符存在的数不超过 $10^4$ 。


---

---
title: "[HAOI2012] 外星人"
layout: "post"
diff: 省选/NOI-
pid: P2350
tag: ['数学', '2012', '河南', '各省省选', '欧拉函数']
---
# [HAOI2012] 外星人
## 题目描述

艾莉欧在她的被子上发现了一个数字 $N$，她觉得只要找出最小的 $x$ 使得，$\varphi^x(N) = 1$。根据这个 $x$ 她就能找到曾经绑架她的外星人的线索了。当然，她是不会去算，请你帮助她算出最小的 $x$。
## 输入格式

第一行一个正整数 $\mathrm{test}$，接下来 $\mathrm{test}$ 组数据每组数据第一行一个正整数 $m$，接下来 $m$ 行每行两个正整数 $p_i, q_i$

其中 $\displaystyle \prod_{i = 1}^{m} p_i^{q_i}$ 为 $N$ 的标准分解形式。

$\prod$ 为连乘

$\varphi^x(N)$ 表示嵌套 $x$ 次，不是幂
## 输出格式

输出 $\mathrm{test}$ 行，每行一个整数，表示答案。
## 样例

### 样例输入 #1
```
1
2
2 2
3 1

```
### 样例输出 #1
```
3

```
## 提示

$30\%$ 的数据，$N \le 10^6$。

$60\%$ 的数据，$x \le 100$。

$100\%$ 的数据，$\mathrm{test} \le 50$，$1 \le p_i \le {10}^5$，$1 \le q_i \le {10}^9$，$m \le 2000$。

$\varphi$ 为欧拉函数，$\varphi(n)$ 即小于等于 $n$ 的数中与 $n$ 互质的数的个数。

提示：$\varphi(\prod_{i=1}^mp_i^{q_i})=\prod_{i=1}^m(p_i-1)*p_i^{q_i-1}$。


---

---
title: "[SDOI2012] 吊灯"
layout: "post"
diff: 省选/NOI-
pid: P2351
tag: ['数学', '2012', '各省省选', '山东', 'Ad-hoc']
---
# [SDOI2012] 吊灯
## 题目背景

山东省省队选拔赛第二试（第一天）

## 题目描述

Alice 家里有一盏很大的吊灯。所谓吊灯，就是由很多个灯泡组成。只有一个灯泡是挂在天花板上的，剩下的灯泡都是挂在其他的灯泡上的。也就是说，整个吊灯实际上类似于**一棵树**。其中编号为 $1$ 的灯泡是挂在天花板上的，剩下的灯泡都是挂在编号小于自己的灯泡上的。

现在，Alice 想要办一场派对，她想改造一下这盏吊灯，将灯泡换成不同的颜色。她希望相同颜色的灯泡都是相连的，并且每一种颜色的灯泡个数都是相同的。

Alice 希望你能告诉她，总共有哪些方案。

Alice 是一个贪心的孩子，如果她发现方案不够多，或者太多了，就会很不高兴，于是她会尝试调整。对于编号为 $x$（$x\neq 1$）的灯泡，如果原来是挂在编号为 $f_x$ 的灯泡上，那么 Alice 会把第 $x$ 个灯泡挂到第 $(f_x + 19940105)\bmod (x-1) + 1$ 个灯泡上。

由于九在古汉语中表示极大的数，于是，Alice 决定只调整 $9$ 次。对于原始状态和每一次调整过的状态，Alice 希望你依次告诉她每种状态下有哪些方案。

## 输入格式

第一行一个整数 $n$，表示灯泡的数量。

接下来一行，有 $n-1$ 个整数 $U_i$，第 $i$ 个数表示第 $i+1$ 个灯泡挂在了第 $U_i$ 个的下面。保证编号为 $1$ 的灯泡是挂在天花板上的。数字之间用逗号（西文标点）`,` 隔开且最后一个数字后面没有逗号。

## 输出格式

对于 $10$ 种状态下的方案，需要按照顺序依次输出。

对于每一种状态，需要先输出单独的一行，表示状态编号，如样例所示。

之后若干行，每行 $1$ 个整数，表示划分方案中每种颜色的灯泡个数。

按升序输出。

## 样例

### 样例输入 #1
```
6
1,2,3,4,5
```
### 样例输出 #1
```
Case #1:
1
2
3
6
Case #2:
1
2
6
Case #3:
1
3
6
Case #4:
1
3
6
Case #5:
1
3
6
Case #6:
1
2
6
Case #7:
1
2
3
6
Case #8:
1
6
Case #9:
1
2
6
Case #10:
1
3
6
```
## 提示

对于 $20\%$ 的数据，$n\leq 3\times 10^3$。

对于 $40\%$ 的数据，$n\leq 5\times 10^4$。

对于 $50\%$ 的数据，$n\leq 10^5$。

对于 $60\%$ 的数据，$n\leq 3\times 10^5$。

对于 $70\%$ 的数据，$n\leq 7\times 10^5$。

对于 $100\%$ 的数据，$1\leq n\leq 1.2\times 10^6$。



---

---
title: "[SDOI2009] 最优图像"
layout: "post"
diff: 省选/NOI-
pid: P2410
tag: ['2009', '各省省选', '山东', 'Special Judge', '最短路']
---
# [SDOI2009] 最优图像
## 题目背景

小 E 在好友小 W 的家中发现一幅神奇的图画，对此颇有兴趣。
## 题目描述

这幅画可以被看做一个包含 $n \times m$ 个像素的黑白图像，为了方便起见，我们用 $0$ 表示白色像素，$1$ 表示黑色像素。小 E 认为这幅图画暗藏玄机，因此他记录下了这幅图像中每行、每列的黑色像素数量，以回去慢慢研究其中的奥妙。

有一天，小 W 不慎将图画打湿，原本的图像已经很难分辨。他十分着急，于是找来小 E，希望共同还原这幅图画。根据打湿后的图画，他们无法确定真正的图像，然而可以推测出每个像素原本是黑色像素的概率 $p_{i,j}\%$。那么，一个完整的图像的出现概率就可以定义为:

$$\prod\limits_{i = 1}^n \prod\limits_{j = 1}^{m} p_{i, j}\% \times [s_{i, j} = 1]$$

其中 $s_{i,j}$ 表示在还原后的图像中，像素是白色($0$)还是黑色($1$)，$[s_{i, j} = 1]$ 表示若 $s_{i, j} = 1$，则该表达式的值为 $1$，否则为 $0$。换句话说，一个完整图像出现概率就等于其所有黑色像素的出现概率之积。显然，图像的黑色像素不能包含概率为 $0$ 的像素。

然而，小 E 对此也无能为力。因此他们找到了会编程的小 F，也就是你，请你根据以上信息，告诉他们最有可能是原始图像的答案是什么。


## 输入格式

第一行是两个整数 $n, m$，表示图像大小。

第 $2$ 到第 $(n + 1)$ 行，每行 $m$ 个整数，第 $(i + 1)$ 行的第 $j$ 个整数 $p_{i, j}$ 表示第 $i$ 行第 $j$ 列的像素是黑色的概率。

接下来一行有 $n$ 个整数，第  $i$ 个整数 $a_i$ 表示第 $i$ 行中黑色像素的个数。

接下来一行有 $m$ 个整数，第 $i$ 个整数 $b_i$ 表示第 $i$ 列中黑色像素的个数。

## 输出格式

**本题存在 Special Judge**。

输出 $n$ 行每行一个长度为 $m$ 的只含字符 `0` 和字符 `1` 的字符串，表示答案。

输入数据保证至少存在一个可能的图像。如果有多种最优图像，任意输出一种即可。

## 样例

### 样例输入 #1
```
2 2
90 10
20 80
1 1
1 1

```
### 样例输出 #1
```
10
01

```
## 提示

#### 样例输入输出 1 解释

共有两种可能的图像：

```plain
01
10
```
```plain
10
01
```
前者的出现概率是 $0.1×0.2=0.02$，后者的出现概率是 $0.9×0.8=0.72$，故后者是最优图像。

---

#### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $n, m \leq 5$。
- 对于 $100\%$ 的数据，保证 $1 \leq n, m \leq 100$，$0 \leq p_{i, j} \leq 100$，$0 \leq a_i \leq m$，$0 \leq b_i \leq n$。

---

感谢 @[test12345](https://www.luogu.com.cn/user/23118) 提供 spj。


---

---
title: "[HEOI2012] 朋友圈"
layout: "post"
diff: 省选/NOI-
pid: P2423
tag: ['2012', '各省省选', '河北']
---
# [HEOI2012] 朋友圈
## 题目背景

原 双塔 请做P1651
## 题目描述

在很久很久以前，曾经有两个国家和睦相处，无忧无虑的生活着．

一年一度的评比大会开始了，作为和平的两国，一个朋友圈数量最多的永远都是最值得他人的尊敬，所以现在就是需要你求朋友圈的最大数目．两个国家看成是 AB 两国，现在是两个国家的描述：

- A 国：每个人都有一个友善值，当两个 A 国人的友善值 $a,b$，如果 $(a\mathbin{\mathrm{xor}} b) \bmod 2=1$，那么这两个人都是朋友，否则不是；
- B 国：每个人都有一个友善值，当两个 B 国人的友善值 $a,b$，如果 $(a\mathbin{\mathrm{xor}} b) \bmod 2=0$ 或者 $(a\mathbin{\mathrm{or}} b)$ 化成二进制有奇数个 $1$，那么两个人是朋友，否则不是朋友．

A、B 两国之间的人也有可能是朋友，数据中将会给出 A、B 之间「朋友」的情况．

对于朋友的定义，关系是是双向的．

在 AB 两国，朋友圈的定义：一个朋友圈集合 $S$，满足 $S \subset A \cup B$，对于所有的 $i,j \in S$，$i$ 和 $j$ 是朋友．

## 输入格式

**本题包含多组数据．**

- 第一行一个整数 $T$，表示输入数据总数．
- 对于每组数据：
  - 第 $1$ 行 $3$ 个整数 $A,B,M$，分别表示 A 国人数，B 国人数，AB 两国之间是朋友的对数．
  - 第 $2$ 行 $A$ 个整数 $a_i$，表示 A 国第 $i$ 个人的友善值．
  - 第 $3$ 行 $B$ 个整数 $b_i$，表示 B 国第 $i$ 个人的友善值．
  - 第 $4$ 到第 $3+M$ 行，每行两个整数 $x,y$ 表示 A 国的第 $x$ 个人和 B 国第 $y$ 个人是朋友．
## 输出格式

- 输出 $T$ 行，每行输出一个整数，表示最大朋友圈的数目．
## 样例

### 样例输入 #1
```
1
2 4 7
1 2
2 6 5 4
1 1
1 2
1 3
2 1
2 2
2 3
2 4
```
### 样例输出 #1
```
5

```
## 提示

### 样例解释

最大朋友圈包含 A 国第 $1,2$ 人和 B 国第 $1,2,3$ 人．

### 数据范围

对于 $100\%$ 的数据，$1 \le T \le 6$，$1 \le a_i, b_i < 2^{31}$．

本题共有两类数据，保证所有测试点均满足其中至少一类的限制：

- 第一类：$1 \le A \le 200, 1 \le B \le 200$．
- 第二类：$1 \le A \le 10, 1 \le B \le 3000$．


---

---
title: "[SDOI2005] 动物园"
layout: "post"
diff: 省选/NOI-
pid: P2445
tag: ['2005', '各省省选', '山东', 'Special Judge']
---
# [SDOI2005] 动物园
## 题目描述

位于郊区的动物园很早就采用了当时先进的自动化管理设施对动物进行管理。但是由于当时的系统没有考虑 $2000$ 年问题，使得管理人员十分担心。虽然采取了很多防范措施，系统还是在世纪之交出现了一些 BUG，部分动物的笼子门自动打开了，关在里面的动物都跑出来了。

幸好动物园已经关闭，**动物不会跑出动物园**。警长 Still 接到报警后率领一支干警奔赴现场。这时动物已经跑出了笼子，所以干警们花了很多时间才控制住了局势，所有的动物都己经送到动物园的广场。但是此时有一个棘手的问题，由于系统完全崩溃，无法得知动物是从哪个笼子里面跑出来的。此时，干警们记得动物的一些行动，都是如下的形式：

第 $t$ 分钟看到某某动物在某个位置。

Still 希望通过这些零碎的信息得到动物是从哪个笼子跑出来的。

### 任务

根据给出的信息，编程求出每个动物的笼子的位置。

动物园的地形描述为一个 $n\times n$ 的网格，一个格子可以是建筑物或者平地。笼子的位置只可能在平地，动物也只在平地运动。每种动物的奔跑速度不一样，例如老虎一分钟可以跑 $5$ 个格子，猫一分钟只可以跑 $2$ 个格子等等。以下是一个例子（其中阴影部分是建筑物）：

![](https://cdn.luogu.com.cn/upload/pic/1577.png)

**每个笼子只关一只动物，不同的笼子关不同的动物。不同的笼子可能在同一个格子里。**
## 输入格式

第一行为自然数 $n$，表示网格的边长

以下 $n$ 行为一个 $n\times n$ 的字符串矩阵，表示动物园的地形。其中 `.` 表示空地，`*` 表示建筑物。

接着一行是自然数 $p$，表示笼子的数目（同时也是动物的数目）。

以下 $p$ 行，每行两个自然数 $R,C$，表示一个笼子处于网格的第 $R$ 行，第 $C$ 列。

以下 $p$ 行，每行一个整数 $V_i$，依次表示编号为 $i$ 的动物的速度（格子/分钟），每个动物用它的编号表示。

接着一行是自然数 $r$，表示干警们提供的信息数目。

以下 $r$ 行，每行四个自然数，$t,x, y, j$，表示第 $t$ 分钟在网格的 $(x, y)$ 位置看到动物 $j$。

具体格式参照样例。
## 输出格式

输出任意一个可行解。

包括 $p$ 行，每行三个整数 $i,x,y$，表示动物 $i$ 原来在格子 $(x,y)$。
## 样例

### 样例输入 #1
```
5
.....
.***.
.....
.***.
.....
2
1 3
5 2
1
2
2
5 3 1 2
4 5 5 1

```
### 样例输出 #1
```
1 5 2
2 1 3

```
## 提示

$1\leq n,p\leq 100$，$x,y\leq n$。

注：对于特定的数据可能有多解，输出任意一解即可。


---

---
title: "[SDOI2007] 科比的比赛"
layout: "post"
diff: 省选/NOI-
pid: P2460
tag: ['2007', '各省省选', '山东']
---
# [SDOI2007] 科比的比赛
## 题目描述

NBA球星云集，谁是最厉害的呢？没有定论。

Nba总裁大卫\*斯特恩最近闲得无聊，决定举办一场球员单挑大赛。

比赛是这样的:首先，我们给每人都打上个分数，表示了每个人的整体能力。然后让每个参赛队员都打n场比赛，首先看谁赢得最多，然后看谁打赢的人的能力值的和最大。

本人一向支持科比(我不支持),当然希望他赢。现在让我们和科比一起去赢得这场比赛吧！！

(科比照片一张)

假设总共比赛有m+1个人参加，告诉你科比和另外m个人的比赛的胜利可能性，你的任务就是求出在科比赢了的所有比赛的可能性最大的前提下(误差不超过1e-10)，科必打赢的人的最大能力值的和是多少？当然当一个人被你打败，他就不会再参加比赛了。

这里需要注意的是，科比能打赢其他人的可能性在不同场次是不同的。比如在比赛前期科比的手感不太好，对抗在内线称霸的人因为无法发挥外线的实力，而难以得分(接奥尼儿图一张)

中期时别人手感变好，状态起来，有实力的人会给科比制造很大的麻烦(接韦德图一张)

后期时消耗太多体力，对自己的命中率下降，难以发挥正常水平，所以对抗体力好的球员时占劣势(后接纳什图一张)

现在给你每场比赛科比对每个参赛者的获胜可能性，和每个人的能力值，帮助科比赢得比赛吧。

## 输入格式

第一行n,m(1<=n<<=10,n<=m<=100000),意义如题所述

接下来一行m个整数表示其他m个人的能力值si(1<=si<=100)

接下来是1个n\*m的矩阵，描述在每场碰到每个人的获胜可能vij(0<=vij<=1)

## 输出格式

第一行输出最大获胜可能性

第二行输出最大能力值和

Special Judge

## 样例

### 样例输入 #1
```
3 4

91 92 93 94

0.5 0.5 0.5 0.5

0.5 0.5 0.5 0.5

0.5 0.5 0.5 0.5
```
### 样例输出 #1
```
0.125

279
```


---

---
title: "[SDOI2008] 递归数列"
layout: "post"
diff: 省选/NOI-
pid: P2461
tag: ['2008', '各省省选', '递归', '山东', '矩阵乘法']
---
# [SDOI2008] 递归数列
## 题目描述

一个由自然数组成的数列按下式定义：

对于 $i \le k$：$a_{i}= b_{i}$。

对于 $i > k$：$a_{i}= \sum_{j=1}^{k}{c_{j} \times a_{i-j}}$。

其中 $b_{1\dots k}$ 和 $c_{1\dots k}$ 是给定的自然数。

写一个程序，给定自然数 $m \le n$，计算 $\left( \sum_{i=m}^{n}{a_{i}} \right) \bmod p$。
## 输入格式

第一行一个自然数 $k$。

第二行 $k$ 个自然数 $b_{1},b_{2},\dots,b_{k}$。

第三行 $k$ 个自然数 $c_{1},c_{2},\dots,c_{k}$。

第四行三个自然数 $m,n,p$。
## 输出格式

一行一个正整数，表示 $\sum_{i=m}^{n}{a_{i}} \mod p$ 的值。
## 样例

### 样例输入 #1
```
2
1 1
1 1
2 10 1000003

```
### 样例输出 #1
```
142
```
## 提示

对于 $20\%$ 的数据，$n \le 10^{6}$。

对于另外 $30\%$ 的数据，$k=1$。

对于 $100\%$ 的数据，$1 \le k \le 15$，$1 \le m \le n \le 10^{18}$，$0 \le b_{i},c_{i} \le 10^{9}$，$p \le 10^{8}$。


---

---
title: "[SDOI2007] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P2462
tag: ['动态规划 DP', '2007', '各省省选', '山东', 'Special Judge']
---
# [SDOI2007] 游戏
## 题目描述

小木木和小凳子是两个聪明的孩子，他们五岁的时候就开始学习英语了。

英语老师教他们玩一个很简单的游戏。老师给他们一张全小写并无特殊符号的英语单词表，单词表如下：

ab
arc
arco
bar
bran
carbon
carbons

cobra
crab
crayon
narc
然后让他们从单词表里找词语接龙。接龙的规则如下:

1 前一个单词拥有的所有字母，在后一个单词里必须出现，而且字母出现次数不少于前一单词。

2 后一个单词的长度比前一个单词的长度恰好多1

对于以上例子，一合法的接龙为:

ab
bar
crab
cobra
carbon
carbons

他们之中，谁接龙的长度长，谁就赢了。小木木肯定不想输，所以找到你，放肆撒娇，导致你因为不想再被打扰而帮他了。至于小凳子呢？？说不定找郭大牛去了。嘿嘿，你和郭大牛的编程比赛？？加油吧！！！

## 输入格式

n(1<=n<=10000)行，每行一个长度不超过100的单词。

## 输出格式

第一行，输出最大长度ans

接下来的ans行，每行输出一个字符串代表你的方案。

## 样例

### 样例输入 #1
```
ab
arc
arco
bar
bran
carbon
carbons
cobra
crab
crayon
narc
```
### 样例输出 #1
```
6
ab
bar
crab
cobra
carbon
carbons
```


---

---
title: "[SDOI2008] Sandy 的卡片"
layout: "post"
diff: 省选/NOI-
pid: P2463
tag: ['2008', '各省省选', '山东', 'KMP 算法', '后缀数组 SA']
---
# [SDOI2008] Sandy 的卡片
## 题目描述

Sandy 和 Sue 都热衷于收集干脆面中的卡片。

然而，Sue 收集卡片是因为卡片上漂亮的人物形象，而 Sandy 则是为了积攒卡片兑换超炫的人物模型。

每一张卡片都由一些数字进行标记，第 $i$ 张卡片的序列长度为 $M_i$，要想兑换人物模型，首先必须要集够 $N$ 张卡片，对于这 $N$ 张卡片，如果他们都有一个相同的子串长度为 $k$，则可以兑换一个等级为 $k$ 的人物模型。相同的定义为：两个子串长度相同且一个串的全部元素加上一个数就会变成另一个串。

Sandy 的卡片数远远小于要求的 $N$，于是 Sue 决定在 Sandy 的生日将自己的卡片送给 Sandy，在 Sue 的帮助下，Sandy 终于集够了 $N$ 张卡片，但是，Sandy 并不清楚他可以兑换到哪个等级的人物模型，现在，请你帮助 Sandy 和 Sue，看看他们最高能够得到哪个等级的人物模型。
## 输入格式

第一行为一个数 $N$，表示可以兑换人物模型最少需要的卡片数，即 Sandy 现在有的卡片数。

第 $i+1$ 行到第 $i+N$ 行每行第一个数为第 $i$ 张卡片序列的长度 $M_i$，之后 $j+1$ 到 $j+1+M_i$ 个数，用空格分隔，分别表示序列中的第 $j$ 个数。
## 输出格式

一个数 $k$，表示可以获得的最高等级。
## 样例

### 样例输入 #1
```
2
2 1 2
3 4 5 9

```
### 样例输出 #1
```
2
```
## 提示

$30\%$ 的数据保证 $n\le50$

$100\%$ 的数据保证 $n\le1000,M\le1000,2\le M_i\le101$

update：题面上数据范围 $M_i$ 和 $M$ 的范围其实是一个东西… 真实数据范围: $40\le n\le1000,2\le M_i\le101$,字符串中的每个数字的大小范围为 $[0,1864]$。



---

---
title: "[SDOI2008] 山贼集团"
layout: "post"
diff: 省选/NOI-
pid: P2465
tag: ['2008', '各省省选', '山东', 'O2优化', '枚举', '状压 DP']
---
# [SDOI2008] 山贼集团
## 题目描述

某山贼集团在绿荫村拥有强大的势力。整个绿荫村由 $n$ 个连通的小村落组成，并且保证对于每两个小村落有且仅有一条简单路径相连。将小村落从 $1$ 至 $n$ 编号，山贼集团的总部设在编号为 $1$ 的小村落中。

山贼集团除了老大坐镇总部以外，其他的 $p$ 个部门希望在村落的其他地方（洛谷注：其实也包括总部）建立分部。$p$ 个分部可以在同一个小村落中建设，也可以分别建设在不同的小村落中，在不同的村落建设不同的分部需要花费不同的费用。

每个分部到总部的路径称为这个部门的管辖范围，于是这 $p$ 个分部的管辖范围可能重叠，或者完全相同。当多个分部管辖同一个村落时，他们之间可能发生矛盾，从而损失一部分利益，也可能相互合作，从而获取一部分利益。

请注意，如果相同的分部同时管辖多个村落，那么对于每个村落，都会计算一次收益损失/获取。

现在请你编写一个程序，确定 $p$ 个分部的位置，使得山贼集团能够获得最大的收益。
## 输入格式

输入的第一行有两个整数，分别代表村落数 $n$ 和山贼集团部门数量 $p$。

第 $2$ 到第 $n$ 行，每行有两个整数 $x, y$，代表存在一条连接村落 $x$ 和村落 $y$ 的道路。

第 $(n + 1)$ 到第 $2n$ 行，每行 $p$ 个整数，第 $(i + n)$ 行的第 $j$ 个整数代表在第 $i$ 个村落建设第 $j$ 个部门的花费 $a_{i, j}$。

第 $(2n + 1)$ 行有一个整数，代表集团间相互影响利益的信息条数 $t$。

第 $(2n + 2)$ 行到第 $(2n + t + 1)$ 行，每行首先有一个整数 $v$，若 $v$ 为正，则表示会获得额外的收益，$v$ 为负则表示会有损失。然后有一个整数 $c$，代表涉及分部的数量。接下来有 $c$ 个整数，分别代表涉及的分部 $x_i$。本条信息的含义为若这 $c$ 个分部同时管辖某个小村落（可能同时存在其他分部管辖该村落），则会产生额外收益或损失，其数值大小为 $|v|$。
## 输出格式

输出一行一个整数代表最大的收益。
## 样例

### 样例输入 #1
```
2 1
1 2
2 
1
1
3 1 1
```
### 样例输出 #1
```
5
```
## 提示

#### 样例输入输出 1 解释

在 $2$ 号节点建立 $1$ 号分部，花费为 $1$，则分部集合 $\{1\}$ 可以管辖 $1, 2$ 两个节点，根据第一条信息，该集合每管辖一个节点会产生 $3$ 的收益，因此总共产生了 $2 \times 3 = 6$ 的收益，减去建立分部的花费，最大的收益为 $6 - 1 = 5$。可以证明不存在更优的方案。

#### 数据规模与约定

对于 $40\%$ 的数据，保证 $1 \leq p \leq 6$。

对于 $100\%$ 的数据，保证：

- $1 \leq p \leq 12$，$1 \leq n \leq 100$。
- $1 \leq s,t \leq n$，$1 \leq a_{i, j} \leq 10^8$。
- $1 \leq t \leq 2^p$，$1 \leq |v| \leq 10^8$，$1 \leq c \leq p$，$1 \leq x_i \leq p$ 且 $x_i$ 互不相同。
- 答案的绝对值不超过 $10^8$。


---

---
title: "[SDOI2010] 粟粟的书架"
layout: "post"
diff: 省选/NOI-
pid: P2468
tag: ['2010', '二分', '各省省选', '山东', '枚举', '可持久化线段树']
---
# [SDOI2010] 粟粟的书架
## 题目描述

幸福幼儿园 B29 班的粟粟是一个聪明机灵、乖巧可爱的小朋友，她的爱好是画画和读书，尤其喜欢 Thomas H. Cormen 的文章。粟粟家中有一个 $R$ 行 $C$ 列的巨型书架，书架的每一个位置都摆有一本书，上数第 $i$ 行、左数第 $j$ 列摆放的书有 $P_{i,j}$ 页厚。

粟粟每天除了读书之外，还有一件必不可少的工作就是摘苹果，她每天必须摘取一个指定的苹果。粟粟家果树上的苹果有的高、有的低，但无论如何凭粟粟自己的个头都难以摘到。不过她发现，如果在脚下放上几本书，就可以够着苹果；她同时注意到，对于第 $i$ 天指定的那个苹果，只要她脚下放置书的总页数之和不低于 $H_i$，就一定能够摘到。

由于书架内的书过多，父母担心粟粟一天内就把所有书看完而耽误了上幼儿园，于是每天只允许粟粟在一个特定区域内拿书。这个区域是一个矩形，第 $i$ 天给定区域的左上角是上数第$x1_i$ 行的左数第 $y1_i$ 本书，右下角是上数第 $x2_i$ 行的左数第 $y2_i$ 本书。换句话说，粟粟在这一天，只能在这 $(x2_i－x1_i＋1)\times(y2_i－y1_i＋1)$ 本书中挑选若干本垫在脚下，摘取苹果。

粟粟每次取书时都能及时放回原位，并且她的书架不会再撤下书目或换上新书，摘苹果的任务会一直持续 $M$ 天。给出每本书籍的页数和每天的区域限制及采摘要求，请你告诉粟粟，她每天至少拿取多少本书，就可以摘到当天指定的苹果。

## 输入格式

第一行是三个正整数 $R, C, M$。

接下来是一个 $R$ 行 $C$ 列的矩阵，从上到下、从左向右依次给出了每本书的页数 $P_{i,j}$。

接下来 $M$ 行，第 $i$ 行给出正整数 $x1_i, y1_i, x2_i, y2_i, H_i$，表示第 $i$ 天的指定区域是 $(x1_i, y1_i)$ 与 $(x2_i, y2_i)$ 间的矩形，总页数之和要求不低于Hi。

保证 $1\le x1_i\le x2_i\le R$，$1\le y1_i\le y2_i\le C$。

## 输出格式

输出共 $M$ 行，第 $i$ 行回答粟粟在第 $i$ 天时为摘到苹果至少需要拿取多少本书。如果即使取走所有书都无法摘到苹果，则在该行输出 `Poor QLW`。

## 样例

### 样例输入 #1
```
5 5 7
14 15 9 26 53
58 9 7 9 32
38 46 26 43 38
32 7 9 50 28
8 41 9 7 17
1 2 5 3 139
3 1 5 5 399
3 3 4 5 91
4 1 4 1 33
1 3 5 4 185
3 3 4 3 23
3 1 3 3 108
```
### 样例输出 #1
```
6
15
2
Poor QLW
9
1
3
```
### 样例输入 #2
```
1 10 7
14 15 9 26 53 58 9 7 9 32
1 2 1 9 170
1 2 1 9 171
1 5 1 7 115
1 1 1 10 228
1 4 1 4 45704571
1 1 1 1 1
1 7 1 8 16
```
### 样例输出 #2
```
6
7
3
10
Poor QLW
1
2
```
## 提示

对于 $10\%$ 的数据，满足 $R, C\le10$。

对于 $20\%$ 的数据，满足 $R, C\le 40$。

对于 $50\%$ 的数据，满足 $R, C\le 200$，$M\le 2\times 10^5$。

另有 $50\%$ 的数据，满足 $R＝1$，$C\le 5\times 10^5$，$M\le 2\times 10^4$。

对于 $100\%$ 的数据，满足 $1\le P_{i,j}\le 1000$，$1\le H_i\le 2\times 10^9$。



---

---
title: "[SDOI2010] 星际竞速"
layout: "post"
diff: 省选/NOI-
pid: P2469
tag: ['2010', '各省省选', '网络流', '山东', '费用流']
---
# [SDOI2010] 星际竞速
## 题目描述

10 年一度的银河系赛车大赛又要开始了。作为全银河最盛大的活动之一，夺得这个项目的冠军无疑是很多人的梦想，来自杰森座 $\alpha$ 星的悠悠也是其中之一。

赛车大赛的赛场由 $N$ 颗行星和 $M$ 条双向星际航路构成，其中每颗行星都有一个不同的引力值。大赛要求车手们从一颗与这 $N$ 颗行星之间没有任何航路的天体出发，访问这 $N$ 颗行星每颗恰好一次，首先完成这一目标的人获得胜利。

由于赛制非常开放，很多人驾驶着千奇百怪的自制赛车来参赛。这次悠悠驾驶的赛车名为超能电驴，这是一部凝聚了全银河最尖端科技结晶的梦幻赛车。作为最高科技的产物，超能电驴有两种移动模式：高速航行模式和能力爆发模式。在高速航行模式下，超能电驴会展开反物质引擎，以数倍于光速的速度沿星际航路高速航行。在能力爆发模式下，超能电驴脱离时空的束缚，使用超能力进行空间跳跃——在经过一段时间的定位之后，它能瞬间移动到任意一个行星。

天不遂人愿，在比赛的前一天，超能电驴在一场离子风暴中不幸受损，机能出现了一些障碍：在使用高速航行模式的时候，只能由每个星球飞往引力比它大的星球，否则赛车就会发生爆炸。

尽管心爱的赛车出了问题，但是悠悠仍然坚信自己可以取得胜利。他找到了全银河最聪明的贤者——你，请你为他安排一条比赛的方案，使得他能够用最少的时间完成比赛。

## 输入格式

输入文件 starrace.in 的第一行是两个正整数 $N, M$。

第二行 $N$ 个数 $A_1,\cdots,A_N$，其中 $A_i$ 表示使用能力爆发模式到达行星 $i$ 所需的定位时间。

接下来 $M$ 行，每行 $3$ 个正整数 $u_i, v_i, w_i$，表示在编号为 $u_i$ 和 $v_i$ 的行星之间存在一条需要航行 $w_i$ 时间的星际航路。

输入数据已经按引力值排序，也就是编号小的行星引力值一定小，且不会有两颗行星引力值相同。

## 输出格式

输出文件 starrace.out 仅包含一个正整数，表示完成比赛所需的最少时间。

## 样例

### 样例输入 #1
```
3 3

1 100 100

2 1 10

1 3 1

2 3 1
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
3 3

1 2 3

1 2 100

1 3 100

2 3 100
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
4 5

100 1000 10 100

1 2 100

2 3 100

4 3 100

1 3 20

2 4 20
```
### 样例输出 #3
```
230
```
## 提示

样例一说明：先使用能力爆发模式到行星 $1$，花费时间 $1$。

然后切换到高速航行模式，航行到行星 $2$，花费时间 $10$。

之后继续航行到行星 $3$ 完成比赛，花费时间 $1$。

虽然看起来从行星 $1$ 到行星 $3$ 再到行星 $2$ 更优，但我们却不能那样做，因为那会导致超能电驴爆炸。

【数据规模和约定】

对于 $30\%$ 的数据 $N\leq 20$，$M\leq 50$；

对于 $70\%$ 的数据 $N\leq 200$，$M\leq 4\times 10^3$；

对于 $100\%$ 的数据 $N\leq 800$，$M\leq 1.5\times 10^4$。

输入数据中的任何数都不会超过 $10^6$。

输入数据保证任意两颗行星之间至多存在一条航道，且不会存在某颗行星到自己的航道。



---

---
title: "[SCOI2007] 压缩"
layout: "post"
diff: 省选/NOI-
pid: P2470
tag: ['字符串', '动态规划 DP', '2007', '四川', '各省省选', '区间 DP']
---
# [SCOI2007] 压缩
## 题目描述

给一个由小写字母组成的字符串，我们可以用一种简单的方法来压缩其中的重复信息。压缩后的字符串除了小写字母外还可以（但不必）包含大写字母R与M，其中M标记重复串的开始，R重复从上一个M（如果当前位置左边没有M，则从串的开始算起）开始的解压结果（称为缓冲串）。


`bcdcdcdcd` 可以压缩为 `bMcdRR`，下面是解压缩的过程：


已经解压的部分|解压结果|缓冲串
---|---|---
b|b|b
bM|b|.
bMc|bc|c
bMcd|bcd|cd
bMcdR|bcdcd|cdcd
bMcdRR|bcdcdcdcd|cdcdcdcd


## 输入格式

输入仅一行，包含待压缩字符串，仅包含小写字母，长度为n。

## 输出格式

输出仅一行，即压缩后字符串的最短长度。

## 样例

### 样例输入 #1
```
aaaaaaa
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
bcdcdcdcdxcdcdcdcd
```
### 样例输出 #2
```
12
```
## 提示

在第一个例子中，解为aaaRa，在第二个例子中，解为bMcdRRxMcdRR。


【限制】

50%的数据满足：1<=n<=20

 
100%的数据满足：1<=n<=50




---

---
title: "[SCOI2007] 蜥蜴"
layout: "post"
diff: 省选/NOI-
pid: P2472
tag: ['模拟', '2007', '四川', '各省省选', '网络流']
---
# [SCOI2007] 蜥蜴
## 题目描述

在一个 $r$ 行 $c$ 列的网格地图中有一些高度不同的石柱，第 $i$ 行 $j$ 列的石柱高度为 $h_{i,j}$。

一些石柱上站着一些蜥蜴，你的任务是让尽量多的蜥蜴逃到边界外。

每行每列中相邻石柱的距离为 $1$，蜥蜴的跳跃距离是 $d$，即蜥蜴可以跳到**平面距离**不超过 $d$ 的任何一个石柱上。

石柱都不稳定，每次当蜥蜴跳跃时，所离开的石柱高度减 $1$（如果仍然落在地图内部，则到达的石柱高度不变）。

如果该石柱原来高度为 $1$，则蜥蜴离开后消失，以后其他蜥蜴不能落脚。

任何时刻不能有两只蜥蜴在同一个石柱上。
## 输入格式


#### 输入格式
输入第一行为三个整数 $r,c,d$，即地图的规模与最大跳跃距离。

接下来 $r$ 行每行 $c$ 个数字为石柱的初始状态，$0$ 表示没有石柱，否则表示石柱的初始高度 $h_{i,j}$。

接下来 $r$ 行每行 $c$ 个字符为蜥蜴位置，`L` 表示蜥蜴，`.` 表示没有蜥蜴。
## 输出格式

输出仅一行，包含一个整数，即无法逃离的蜥蜴总数的最小值。
## 样例

### 样例输入 #1
```
5 8 2
00000000
02000000
00321100
02000000
00000000
........
........
..LLLL..
........
........

```
### 样例输出 #1
```
1
```
## 提示

对于 $100\%$ 的数据满足：$1\le r,c\le20$，$1\le d\le 4$，$1\le h\le 3$。


---

---
title: "[SCOI2008] 奖励关"
layout: "post"
diff: 省选/NOI-
pid: P2473
tag: ['2008', '四川', '各省省选', 'O2优化', '期望', '状压 DP']
---
# [SCOI2008] 奖励关
## 题目描述

你正在玩你最喜欢的电子游戏，并且刚刚进入一个奖励关。在这个奖励关里，系统将依次随机抛出 $k$ 次宝物，每次你都可以选择吃或者不吃（必须在抛出下一个宝物之前做出选择，且现在决定不吃的宝物以后也不能再吃）。

宝物一共有 $n$ 种，系统每次抛出这 $n$ 种宝物的概率都相同且相互独立。也就是说，即使前 $(k-1)$ 次系统都抛出宝物 $1$（这种情况是有可能出现的，尽管概率非常小），第 $k$ 次抛出各个宝物的概率依然均为 $\frac 1 n $。

获取第 $i$ 种宝物将得到 $p_i$ 分，但并不是每种宝物都是可以随意获取的。第 $i$ 种宝物有一个前提宝物集合 $s_i$。只有当 $s_i$ 中所有宝物都至少吃过一次，才能吃第 $i$ 种宝物（如果系统抛出了一个目前不能吃的宝物，相当于白白的损失了一次机会）。注意，$p_i$ 可以是负数，但如果它是很多高分宝物的前提，损失短期利益而吃掉这个负分宝物将获得更大的长期利益。

假设你采取最优策略，平均情况你一共能在奖励关得到多少分值？

## 输入格式

第一行为两个整数，分别表示抛出宝物的次数 $k$ 和宝物的种类数 $n$。

第 $2$ 到第 $(n + 1)$ 行，第 $(i + 1)$ 有若干个整数表示第 $i$ 个宝物的信息。每行首先有一个整数，表示第 $i$ 个宝物的分数 $p_i$。接下来若干个互不相同的整数，表示该宝物的各个前提宝物集合 $s_i$，每行的结尾是一个整数 $0$，表示该行结束。
## 输出格式

输出一行一个实数表示答案，保留六位小数。
## 样例

### 样例输入 #1
```
1 2
1 0
2 0

```
### 样例输出 #1
```
1.500000
```
### 样例输入 #2
```
6 6

12 2 3 4 5 0

15 5 0

-2 2 4 5 0

-11 2 5 0

5 0

1 2 4 5 0


```
### 样例输出 #2
```
10.023470
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq k \leq 100$，$1 \leq n \leq 15$，$-10^6 \leq p_i \leq 10^6$。


---

---
title: "[SCOI2008] 天平"
layout: "post"
diff: 省选/NOI-
pid: P2474
tag: ['2008', '四川', '各省省选', '图论建模', '差分约束']
---
# [SCOI2008] 天平
## 题目描述

你有 $n$ 个砝码，均为 $1$ 克，$2$ 克或者 $3$ 克。你并不清楚每个砝码的重量，但你知道其中一些砝码重量的大小关系。你把其中两个砝码 A 和 B 放在天平的左边，需要另外选出两个砝码放在天平的右边。问：有多少种选法使得天平的左边重($c_1$)、一样重($c_2$)、右边重($c_3$)？（只有结果保证唯一确定的选法才统计在内）

## 输入格式

第一行包含三个正整数 $n$, $A$, $B$（$1\le A,B\le n$, $A\neq B$）。

以下 $n$ 行包含重量关系矩阵，其中第 $i$ 行第 $j$ 个字符为加号 `+` 表示砝码 $i$ 比砝码 $j$ 重，减号 `-` 表示砝码 $i$ 比砝码 $j$ 轻，等号 `=` 表示砝码 $i$ 和砝码 $j$ 一样重，问号 `?` 表示二者的关系未知。

数据保证至少存在一种情况符合该矩阵。
## 输出格式

仅一行，包含三个整数，即 $c_1$，$c_2$ 和 $c_3$。

## 样例

### 样例输入 #1
```
6 2 5

?+????

-?+???

?-????

????+?

???-?+

????-?
```
### 样例输出 #1
```
1 4 1
```
### 样例输入 #2
```
14 8 4

?+???++?????++

-??=?=???????=

??????????=???

?=??+?==??????

???-???-???-??

-=????????????

-??=???=?-+???

???=+?=???????

??????????????

??????+???????

??=???-????-??

????+?????+???

-?????????????

-=????????????
```
### 样例输出 #2
```
18 12 11
```
## 提示

$4\le n\le 50$。



---

---
title: "[SCOI2008] 斜堆"
layout: "post"
diff: 省选/NOI-
pid: P2475
tag: ['2008', '四川', '各省省选', '递归']
---
# [SCOI2008] 斜堆
## 题目背景

四川2008NOI省选

## 题目描述

斜堆(skew heap)是一种常用的数据结构。它也是二叉树，且满足与二叉堆相

同的堆性质：每个非根结点的值都比它父亲大。因此在整棵斜堆中，根的值最小。

但斜堆不必是平衡的，每个结点的左右儿子的大小关系也没有任何规定。在本题

中，斜堆中各个元素的值均不相同。

在斜堆 H 中插入新元素X 的过程是递归进行的：当H 为空或者X 小于H

的根结点时X 变为新的树根，而原来的树根（如果有的话）变为X 的左儿子。

当X 大于H 的根结点时，H 根结点的两棵子树交换，而X（递归）插入到交换

后的左子树中。

给出一棵斜堆，包含值为0~n的结点各一次。求一个结点序列，使得该斜堆

可以通过在空树中依次插入这些结点得到。如果答案不惟一，输出字典序最小的

解。输入保证有解。

## 输入格式

第一行包含一个整数n。第二行包含n个整数d1, d2, ... , dn， di<100表示i

是di的左儿子，di>=100 表示i 是di-100 的右儿子。显然0 总是根，所以输入中

不含d0。

## 输出格式

仅一行，包含n+1整数，即字典序最小的插入序列。

## 样例

### 样例输入 #1
```
6

100 0 101 102 1 2
```
### 样例输出 #1
```
0 1 2 3 4 5 6
```
### 样例输入 #2
```
6

100 0 2 102 4 104
```
### 样例输出 #2
```
4 6 5 2 0 1 3
```
### 样例输入 #3
```
7

0 100 1 102 2 3 5
```
### 样例输出 #3
```
2 5 0 3 4 6 7 1
```
## 提示

2 <= n <= 50



---

---
title: "[SDOI2010] 城市规划"
layout: "post"
diff: 省选/NOI-
pid: P2478
tag: ['2010', '各省省选', '山东']
---
# [SDOI2010] 城市规划
## 题目描述

小猪iPig来到了一个叫做pigsty的城市里，pigsty是一座专门为小猪所准备的城市，城市里面一共有n个小区给小猪们居住，并且存在许多条无向边连接着许多小区。因为这里是一个和谐的城市，所以小猪iPig准备在这个城市里面度过他的余生。

若干年之后小猪iPig当上了规划局长，这件事令他非常开心。不过与此同时pigsty城市里面出现了许多反和谐主义者，他们已经厌烦了这样和谐的生活，在城市里到处闹事。小猪iPig为了更好地控制局面，他把城市改造成了另外一个样子：iPig把道路全部摧毁之后重新修建了m条无向边，并且保证每一个小区最多存在于一个由无向边组成的环中。

iPig以为这样做就让那些反和谐主义者不敢继续猖狂下去了，谁知到在新的城市道路修建好以后反和谐主义者宣言要对城市的小区进行一次洗脑！

这下可麻烦了，iPig赶紧收集了许多的情报。iPig给每个小区标记了一个和谐值HX\_i，用它来表示第i个小区的和谐程度。

通过地下消息iPig又得知那些反和谐主义者进攻时有个规律：他们会选择若干个小区下手，这些小区都派一只猪过去，把这些小区的和谐值归零。在这个过程中，每个选择的小区所直接连接着的几个小区都派了一只猪去看守——以防被警猪给干扰。这个计划看似完美但是还是存在一个漏洞：因为人员之间都是在网络上认识的，互相没有见过面，为了防止不必要的麻烦（认错猪之类），每个小区最多只会有一头猪存在。

iPig突然感到了莫大的压力，他想知道在最坏情况下会丢失多少和谐值。但是不懂计算机的他不知道应该怎样计算。你能帮帮他吗？

## 输入格式

输入第一行有两个整数n和m，表示pigsty城市里面有n个小区，在iPig修整城市后有m条无向边连接着n个小区。

接下来一行有n个正整数，第i个正整数HX\_i表示第i个小区的和谐值为HX\_i。

接下来m行，每行两个正整数a和b（1<=a,b<=n），表示存在一条连接着小区a和小区 b的无向边。

## 输出格式

输出只有一行一个整数，表示最坏情况下损失的和谐值为多少。

## 样例

### 样例输入 #1
```
9 9
2 2 3 4 1 2 3 10 11
1 2
2 3
1 3
3 5
5 4
5 6
4 7
6 7
8 9

```
### 样例输出 #1
```
17
```
### 样例输入 #2
```
5 5
4 4 9 7 7
1 2
2 3
1 4
3 5
5 4

```
### 样例输出 #2
```
9
```
## 提示

【样例解释】

反和谐主义者选择的小区分别是小区3（看守的小区是小区1、小区2和小区5）、小区7（看守的小区是小区4和小区6）和小区9（看守的小区是小区8），这样会损失的总和谐值为3+3+11=17。

或者选择的小区分别是小区1（看守的小区是小区2和小区3）、小区4（看守的小区是小区5和小区7）和小区9（看守的小区是小区8），这样会损失的总和谐值为2+4+11=17。

如果同时选择小区3、小区4和小区9，虽然损失的总和谐值为18，但是小区3和小区4都要派猪来看守小区5，这不符合条件，故此方案不可行。


【数据约定】

对于20%的数据，保证每个点不存在于任何一个环中；

对于另外30%的数据，保证图中只存在一个环；

对于100%的数据，有N<=1000000，M<=2000000，所有的权值不超过1000。



---

---
title: "[SDOI2010] 捉迷藏"
layout: "post"
diff: 省选/NOI-
pid: P2479
tag: ['搜索', '2010', '各省省选', '递归', '山东', '枚举']
---
# [SDOI2010] 捉迷藏
## 题目背景

iPig 在大肥猪学校刚上完了无聊的猪文课，天资聪慧的 iPig 被这门对他来说无比简单的课弄得非常寂寞，为了消除寂寞感，他决定和他的好朋友 giPi（鸡皮）玩一个更加寂寞的游戏——捉迷藏。但是，他们觉得，玩普通的捉迷藏没什么意思，还是不够寂寞，于是，他们决定玩寂寞无比的螃蟹版捉迷藏。

## 题目描述

螃蟹版捉迷藏，顾名思义，就是说他们在玩游戏的时候只能沿水平或垂直方向走。

一番寂寞的剪刀石头布后，他们决定 iPig 去捉 giPi。由于他们都很熟悉大肥猪学校的地形了，所以 giPi 只会躲在大肥猪学校内 $N$ 个隐秘地点之一，显然 iPig 也只会在那 $N$ 个地点内找 giPi。

游戏一开始，他们从这 $N$ 个隐秘地点之中选定一个地点，iPig 保持不动，然后 giPi 用 $30$ 秒的时间逃离现场（显然，giPi 不会呆在原地）。然后 iPig 会随机地去找 giPi，直到找到为止。

由于 iPig 很懒，所以他总是走最短的路径，而且，他选择起始点不是随便选的，他想找一个地点，使得该地点到（除了这个地点以外的）最远的地点和最近的地点的距离差最小。iPig现在想知道这个距离差最小是多少。

由于 iPig 现在手上没有电脑，所以不能编程解决这个如此简单的问题，所以他马上打了个电话，要求你帮他解决这个问题。iPig 告诉了你大肥猪学校的 $N$ 个隐秘地点的坐标，请你编程求出 iPig 的问题。
## 输入格式


第 $1$ 行：一个整数 $N$；

接下来 $N$ 行：每行两个整数 $X_i,Y_i$，表示第 $i$ 个地点的坐标。
## 输出格式

一个整数，为距离差的最小值。

## 样例

### 样例输入 #1
```
4
0 0
1 0
0 1
1 1

```
### 样例输出 #1
```
1
```
## 提示

$30\%$ 的数据中，$2\le N\le 10^3$；

$100\%$ 的数据中，$2\le N\le 10^5$，$0\le X_i,Y_i\le 10^9$。

数据保证点不重合。


---

---
title: "[SDOI2010] 古代猪文"
layout: "post"
diff: 省选/NOI-
pid: P2480
tag: ['数学', '2010', '各省省选', '山东', 'O2优化', '素数判断,质数,筛法', '中国剩余定理 CRT']
---
# [SDOI2010] 古代猪文
## 题目背景

“在那山的那边海的那边有一群小肥猪。他们活泼又聪明，他们调皮又灵敏。他们自由自在生活在那绿色的大草坪，他们善良勇敢相互都关心……”

——选自猪王国民歌


很久很久以前，在山的那边海的那边的某片风水宝地曾经存在过一个猪王国。猪王国地理位置偏僻，实施的是适应当时社会的自给自足的庄园经济，很少与外界联系，商贸活动就更少了。因此也很少有其他动物知道这样一个王国。

猪王国虽然不大，但是土地肥沃，屋舍俨然。如果一定要拿什么与之相比的话，那就只能是东晋陶渊明笔下的大家想象中的桃花源了。猪王勤政爱民，猪民安居乐业，邻里和睦相处，国家秩序井然，经济欣欣向荣，社会和谐稳定。和谐的社会带给猪民们对工作火红的热情和对未来的粉色的憧憬。

小猪iPig是猪王国的一个很普通的公民。小猪今年10岁了，在大肥猪学校上小学三年级。和大多数猪一样，他不是很聪明，因此经常遇到很多或者稀奇古怪或者旁人看来轻而易举的事情令他大伤脑筋。小猪后来参加了全猪信息学奥林匹克竞赛(Pig Olympiad in Informatics, POI)，取得了不错的名次，最终保送进入了猪王国大学(Pig Kingdom University, PKU)深造。

现在的小猪已经能用计算机解决简单的问题了，比如能用P++语言编写程序计算出A + B的值。这个“成就”已经成为了他津津乐道的话题。当然，不明真相的同学们也开始对他刮目相看啦~

小猪的故事就将从此展开，伴随大家两天时间，希望大家能够喜欢小猪。

## 题目描述

猪王国的文明源远流长，博大精深。

iPig 在大肥猪学校图书馆中查阅资料，得知远古时期猪文文字总个数为 $n$。当然，一种语言如果字数很多，字典也相应会很大。当时的猪王国国王考虑到如果修一本字典，规模有可能远远超过康熙字典，花费的猪力、物力将难以估量。故考虑再三没有进行这一项劳猪伤财之举。当然，猪王国的文字后来随着历史变迁逐渐进行了简化，去掉了一些不常用的字。

iPig 打算研究古时某个朝代的猪文文字。根据相关文献记载，那个朝代流传的猪文文字恰好为远古时期的 $1/k$，其中 $k$ 是 $n$ 的一个正约数（可以是 $1$ 或 $n$）。不过具体是哪 $1/k$，以及 $k$ 是多少，由于历史过于久远，已经无从考证了。

iPig 觉得只要符合文献，每一种 $k|n$ 都是有可能的。他打算考虑到所有可能的 $k$。显然当 $k$ 等于某个定值时，该朝的猪文文字个数为 $n/k$。然而从 $n$ 个文字中保留下 $n/k$ 个的情况也是相当多的。iPig 预计，如果所有可能的 $k$ 的所有情况数加起来为 $p$ 的话，那么他研究古代文字的代价将会是 $g^p$。

现在他想知道猪王国研究古代文字的代价是多少。由于 iPig 觉得这个数字可能是天文数字，所以你只需要告诉他答案除以 $999911659$ 的余数就可以了。

## 输入格式

一行两个正整数 $n,g$。

## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 2
```
### 样例输出 #1
```
2048
```
## 提示

#### 数据规模与约定
- 对于 $10\%$ 的数据，$1\le n \le 50$；  
- 对于 $20\%$ 的数据，$1\le n \le 1000$；  
- 对于 $40\%$ 的数据，$1\le n \le 10^5$；  
- 对于 $100\%$ 的数据，$1\le n,g \le 10^9$。



---

---
title: "[SDOI2010] 代码拍卖会"
layout: "post"
diff: 省选/NOI-
pid: P2481
tag: ['2010', '各省省选', '山东', '数位 DP', '组合数学']
---
# [SDOI2010] 代码拍卖会
## 题目描述

随着 iPig 在 P++ 语言上的造诣日益提升，他形成了自己一套完整的代码库。猪王国想参加 POI 的童鞋们都争先恐后问 iPig 索要代码库。iPig 不想把代码库给所有想要的小猪，只想给其中的一部分既关系好又肯出钱的小猪，于是他决定举行了一个超大型拍卖会。

在拍卖会上，所有的 $N$ 头小猪将会按照和 iPig 的好感度从低到高，从左到右地在 iPig 面前站成一排。每个小猪身上都有 $9$ 猪币（与人民币汇率不明），从最左边开始，每个小猪依次举起一块牌子，上面写上想付出的买代码库的猪币数量（$1$ 到 $9$ 之间的一个整数）。大家都知道，如果自己付的钱比左边的猪少，肯定得不到梦寐以求的代码库，因此从第二只起，每只猪出的钱都大于等于左边猪出的价钱。最终出的钱最多的小猪（们）会得到 iPig 的代码库真传，向着保送 PKU（Pig Kingdom University）的梦想前进。

iPig 对自己想到的这个点子感到十分满意，在去现场的路上，iPig 就在想象拍卖会上会出现的场景，例如一共会出现多少种出价情况之类的问题，但这些问题都太简单了，iPig 早已不感兴趣了，他想要去研究更加困难的问题。iPig 发现如果他从台上往下看，所有小猪举的牌子从左到右将会正好构成一个 $N$ 位的整数，他现在想要挑战的问题是所有可能构成的整数中能正好被 $P$ 整除的有多少个。由于答案过大，他只想要知道答案 $\bmod\ 999911659$ 就行了。
## 输入格式

有且仅有一行两个数 $N\ (1 \le N \le 10^{18})$ 和 $P\ (1 \le P \le 500)$，用一个空格分开。
## 输出格式

有且仅有一行一个数，表示答案除以 $999911659$ 的余数。

## 样例

### 样例输入 #1
```
2 3
```
### 样例输出 #1
```
15
```
## 提示

### 样例解释

方案可以是：$12,\allowbreak 15,\allowbreak 18,\allowbreak 24,\allowbreak 27,\allowbreak 33,\allowbreak 36,\allowbreak 39,\allowbreak 45,\allowbreak 48,\allowbreak 57,\allowbreak 66,\allowbreak 69,\allowbreak 78,\allowbreak 99$，共 $15$ 种。

### 数据规模

![](https://cdn.luogu.com.cn/upload/image_hosting/y0nme218.png)



---

---
title: "[SDOI2010] 猪国杀"
layout: "post"
diff: 省选/NOI-
pid: P2482
tag: ['模拟', '字符串', '2010', '各省省选', '山东']
---
# [SDOI2010] 猪国杀
## 题目描述

### 游戏背景

《猪国杀》是一种多猪牌类回合制游戏，一共有 $3$ 种角色：主猪，忠猪，反猪。每局游戏主猪有且只有 $1$ 只，忠猪和反猪可以有多只，每只猪扮演 $1 $ 种角色。

### 游戏目的

主猪 / $\texttt{MP}$：自己存活的情况下消灭所有的反猪。  
忠猪 / $\texttt{ZP}$：不惜一切保护主猪，胜利条件与主猪相同。  
反猪 / $\texttt{FP}$：杀死主猪。

### 游戏过程

游戏开始时，每个玩家手里都会有 $4$ 张牌，且体力上限和初始体力都是 $4$ 。

开始游戏时，从主猪开始，按照逆时针方向（数据中就是按照编号从 $ 1 , 2, 3 \ldots n , 1 \ldots $ 的顺序）依次行动。

每个玩家自己的回合可以分为 2 个阶段：

* **摸牌阶段**：从牌堆顶部摸 $2$ 张牌，依次放到手牌的最右边；  
* **出牌阶段**：你可以使用任意张牌，每次使用牌的时候都使用最靠左的能够使用的牌。当然，要满足如下规则：
  1. 如果没有猪哥连弩，每个出牌阶段只能使用 $1$ 次「杀」来攻击；
  2. 任何牌被使用后被弃置（武器是装备上）；被弃置的牌以后都不能再用，即与游戏无关。

### 各种牌介绍

每张手牌用 $1$ 个字母表示，字母代表牌的种类。

#### 基本牌

- 『桃 / $\texttt{P}$』在自己的回合内，如果自己的体力值不等于体力上限，那么使用 $1$ 个桃可以为自己补充 $1$ 点体力，否则不能使用桃；桃只能对自己使用；在自己的回合外，如果自己的血变为 $0$ 或者更低，那么也可以使用。

- 『杀 / $\texttt{K}$』在自己的回合内，对攻击范围内除自己以外的 $1$ 名角色使用。如果没有被『闪』抵消，则造成 $1$ 点伤害。无论有无武器，杀的攻击范围都是 $1$。

- 『闪 / $\texttt{D}$』当你受到杀的攻击时，可以弃置 $1$ 张闪来抵消杀的效果。

#### 锦囊牌

- 『决斗 / $\texttt{F}$』出牌阶段，对除自己以外任意 $1$ 名角色使用，由目标角色先开始，自己和目标角色轮流弃置 $1$ 张杀，首先没有杀可弃的一方受到 $1$ 点伤害，另一方视为此伤害的来源。

- 『南猪入侵 / $\texttt{N}$』出牌阶段，对除你以外所有角色使用，按逆时针顺序从使用者下家开始依次结算，除非弃置 $1$ 张杀，否则受到 $1$ 点伤害。

- 『万箭齐发 / $\texttt{W}$』和南猪入侵类似，不过要弃置的不是杀而是闪。

- 『无懈可击 / $\texttt{J}$』在目标锦囊生效前抵消其效果。每次有 $1$ 张锦囊即将生效时，从使用这张锦囊的猪开始，按照逆时针顺序，依次得到使用无懈可击的机会；效果：用于决斗时，决斗无效并弃置；用于南猪入侵或万箭齐发时，当结算到某个角色时才能使用，当前角色不需弃置牌并且不会受到伤害（仅对 $1$ 个角色产生效果）；用于无懈可击时，成为目标的无懈可击被无效。

#### 装备牌

- 『猪哥连弩 / $\texttt{Z}$』武器，攻击范围 $1$ ，出牌阶段你可以使用任意张杀; 同一时刻最多只能装 $1$ 把武器；如果先前已经有了 $1$ 把武器，那么之后再装武器的话，会弃置以前的武器来装现在的武器。

### 特殊事件及概念解释

* **伤害来源**：杀、南猪入侵、万箭齐发的伤害来源均是使用该牌的猪，决斗的伤害来源如上；

* **距离**：两只猪的距离定义为沿着逆时针方向间隔的猪数 $+1$ 。即初始时 $1$ 和 $2$ 的距离为 $1$ ，但是 $2$ 和 $1$ 的距离就是 $n-1$ 。注意一个角色的死亡会导致一些猪距离的改变；

* **玩家死亡**：如果该玩家的体力降到 $0$ 或者更低，并且自己手中没有足够的桃使得自己的体力值回到 $1$ ，那么就死亡了，死亡后所有的牌（装备区，手牌区）被弃置；

* **奖励与惩罚**：反猪死亡时，最后一个伤害来源处（即使是反猪）立即摸 $3$ 张牌。忠猪死亡时，如果最后一个伤害来源是主猪，那么主猪所有装备牌、手牌被弃置。

注意：一旦达成胜利条件，游戏立刻结束，因此即使会摸 $3$ 张牌或者还有牌可以用也不用执行了。

现在，我们已经知道每只猪的角色、手牌，还有牌堆初始情况，并且假设每个角色会按照如下的行为准则进行游戏，你需要做的就是告诉小猪 iPig 最后的结果。

### 几种行为

* **献殷勤**：使用无懈可击挡下南猪入侵、万箭齐发、决斗；使用无懈可击抵消表敌意；  
* **表敌意**：对某个角色使用杀、决斗；使用无懈可击抵消献殷勤；  
* **跳忠**：即通过行动表示自己是忠猪。跳忠行动就是对主猪或对某只已经跳忠的猪献殷勤，或者对某只已经跳反的猪表敌意；  
* **跳反**：即通过行动表示自己是反猪。跳反行动就是对主猪或对某只已经跳忠的猪表敌意，或者对某只已经跳反的猪献殷勤。

**注意：忠猪不会跳反，反猪也不会跳忠；不管是忠猪还是反猪，能够跳必然跳**。

### 行动准则

#### 共性

* 每个角色如果手里有桃且生命值未满，那么必然吃掉；
* 有南猪入侵、万箭齐发、必然使用；有装备必然装上；
* 受到杀时，有闪必然弃置；
* 响应南猪入侵或者万箭齐发时候，有杀 / 闪必然弃置；
* 不会对未表明身份的猪献殷勤（**包括自己**）。

#### 特性

 - 主猪：
   + 主猪会认为「没有跳身份，且用南猪入侵 / 万箭齐发对自己造成伤害的猪」是**类**反猪（没伤害到不算，注意类反猪并没有表明身份），如果之后跳了，那么主猪会重新认识这只猪；  
   + 对于每种表敌意的方式，对逆时针方向能够执行到的第一只类反猪或者已跳反猪表；如果没有，那么就不表敌意；
   + 决斗时会不遗余力弃置杀；
   + 如果能对已经跳忠的猪或自己献殷勤，那么一定献；如果能够对已经跳反的猪表敌意，那么一定表。
 - 忠猪：
   + 对于每种表敌意的方式，对「逆时针方向能够执行到的第一只已经跳反的猪」表，如果没有，那么就不表敌意；
   + 决斗时，如果对方是主猪，那么不会弃置杀，否则，会不遗余力弃置杀；
   + 如果有机会对主猪或者已经跳忠的猪献殷勤，那么一定献。
 - 反猪：
   + 对于每种表敌意的方式，如果有机会则对主猪表，否则，对「逆时针方向能够执行到的第一只已经跳忠的猪」表，如果没有，那么就不表敌意；
   + 决斗时会不遗余力弃置杀；
   + 如果有机会对已经跳反的猪献殷勤，那么一定献。

限于 iPig 只会用 P++ 语言写 A + B，他请你用 Pigcal (Pascal)、P (C) 或 P++ (C++) 语言来帮他预测最后的结果。
## 输入格式

输入文件第一行包含两个正整数 $ n $ $ (2 \leqslant n \leqslant 10) $ 和 $m$ $ (m \leqslant 2000) $，分别代表玩家数和牌堆中牌的数量。数据保证牌的数量够用。

接下来 $n$ 行，每行 $5$ 个字符串，依次表示对第 $i$ 只猪的角色和初始 $4 $ 张手牌描述。编号为 $1$ 的肯定是主猪。

再接下来一行，一共 $m$ 个字符串，按照从牌堆顶部到牌堆底部的顺序描述每张牌。

**注意：所有的相邻的两个字符串都严格用 $1$ 个空格隔开，行尾没有多余空格**。
## 输出格式

输出数据第一行包含一个字符串代表游戏结果。如果是主猪胜利，那么输出 $\texttt{MP}$ ，否则输出 $\texttt{FP}$ 。数据保证游戏总会结束。

接下来 $n$ 行，第 $i$ 行是对第 $i$ 只猪的手牌描述（注意只需要输出手牌），按照手牌从左往右的顺序输出，相邻两张牌用 $1$ 个空格隔开，行末尾没有多余空格。如果这只猪已阵亡，那么只要输出 $\texttt{DEAD}$ 即可。

**注意：如果要输出手牌而没有手牌的话，那么只需输出 $1$ 个空行**。

**由于数据问题，若牌堆已空，按照每次抽牌抽到的都是最后一张。**
## 样例

### 样例输入 #1
```
3 10
MP D D F F
ZP N N N D
FP J J J J
F F D D J J F F K D

```
### 样例输出 #1
```
FP
DEAD
DEAD
J J J J J J D

```
## 提示

### 样例解释

第一回合：
* 主猪没有目标可以表敌意；
* 接下来忠猪使用了 $3$ 张南猪入侵，主猪掉了 $3$ 点体力，并认为该角色为类反猪，$3$ 号角色尽管手里有无懈可击，但是因为自己未表明身份，所以同样不能对自己用，乖乖掉 $3$ 点体力；  

下一回合：
* 反猪无牌可出；
* 接下来主猪对着类反猪爆发，使用 $4$ 张决斗，忠猪死亡，结果主猪弃掉所有牌；
* 下来反猪摸到 $1$ 张杀直接杀死主猪获胜。

### 子任务

一共 $20$ 组测试数据，每个点 $5$ 分。

$10\%$ 的数据没有锦囊牌，另外 $20\%$ 的数据没有无懈可击。


---

---
title: "[SDOI2011] 染色"
layout: "post"
diff: 省选/NOI-
pid: P2486
tag: ['2011', '线段树', '各省省选', '山东', '树链剖分', '动态树 LCT']
---
# [SDOI2011] 染色
## 题目描述

给定一棵 $n$ 个节点的无根树，共有 $m$  个操作，操作分为两种：

1. 将节点 $a$ 到节点 $b$ 的路径上的所有点（包括 $a$ 和 $b$）都染成颜色 $c$。
2. 询问节点 $a$ 到节点 $b$ 的路径上的颜色段数量。

颜色段的定义是极长的连续相同颜色被认为是一段。例如 `112221` 由三段组成：`11`、`222`、`1`。
## 输入格式

输入的第一行是用空格隔开的两个整数，分别代表树的节点个数 $n$ 和操作个数 $m$。

第二行有 $n$ 个用空格隔开的整数，第 $i$ 个整数 $w_i$ 代表结点 $i$ 的初始颜色。

第 $3$ 到第 $(n + 1)$ 行，每行两个用空格隔开的整数 $u, v$，代表树上存在一条连结节点 $u$ 和节点 $v$ 的边。

第 $(n + 2)$ 到第 $(n + m + 1)$ 行，每行描述一个操作，其格式为：

每行首先有一个字符 $op$，代表本次操作的类型。

- 若 $op$ 为 `C`，则代表本次操作是一次染色操作，在一个空格后有三个用空格隔开的整数 $a, b, c$，代表将 $a$ 到 $b$ 的路径上所有点都染成颜色 $c$。
- 若 $op$ 为 `Q`，则代表本次操作是一次查询操作，在一个空格后有两个用空格隔开的整数 $a, b$，表示查询 $a$ 到 $b$ 路径上的颜色段数量。
## 输出格式

对于每次查询操作，输出一行一个整数代表答案。
## 样例

### 样例输入 #1
```
6 5
2 2 1 2 1 1
1 2
1 3
2 4
2 5
2 6
Q 3 5
C 2 1 1
Q 3 5
C 5 1 2
Q 3 5

```
### 样例输出 #1
```
3
1
2

```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，$1 \leq n, m \leq 10^5$，$1 \leq w_i, c \leq 10^9$，$1 \leq a, b, u, v \leq n$，$op$ 一定为 `C` 或 `Q`，保证给出的图是一棵树。

除原数据外，还存在一组不计分的 hack 数据。



---

---
title: "[SDOI2011] 拦截导弹"
layout: "post"
diff: 省选/NOI-
pid: P2487
tag: ['动态规划 DP', '2011', '各省省选', '树状数组', '山东', 'Special Judge', '分治']
---
# [SDOI2011] 拦截导弹
## 题目描述

某国为了防御敌国的导弹袭击，发展出一种导弹拦截系统。但是这种导弹拦截系统有一个缺陷：虽然它的第一发炮弹能够到达任意的高度、并且能够拦截任意速度的导弹，但是以后每一发炮弹都不能高于前一发的高度，其拦截的导弹的飞行速度也不能大于前一发。某天，雷达捕捉到敌国的导弹来袭。由于该系统还在试用阶段，所以只有一套系统，因此有可能不能拦截所有的导弹。

在不能拦截所有的导弹的情况下，我们当然要选择使国家损失最小、也就是拦截导弹的数量最多的方案。但是拦截导弹数量的最多的方案有可能有多个，如果有多个最优方案，那么我们会随机选取一个作为最终的拦截导弹行动蓝图。

我方间谍已经获取了所有敌军导弹的高度和速度，你的任务是计算出在执行上述决策时，每枚导弹被拦截掉的概率。

## 输入格式



第一行包含一个正整数 $n$，表示敌军导弹数量。

下面 $n$ 行按顺序给出了敌军所有导弹信息。第 $i+1$
 行包含两个正整数 $h_i$ 和 $v_i$，分别表示第 $i$ 枚导弹的高度和速度。
## 输出格式



输出包含两行。

第一行为一个正整数，表示最多能拦截掉的导弹数量；

第二行包含 $n$ 个 $0$ 到 $1$ 之间的实数，第 $i$ 个数字表示第 $i$ 枚导弹被拦截的概率（你可以保留任意多位有效数字）。
## 样例

### 样例输入 #1
```
4
3 30
4 40
6 60
3 30

```
### 样例输出 #1
```
2
0.33333 0.33333 0.33333 1.00000

```
## 提示



保证总方案数不超过 C++ 中 double 类型的存储范围。

### 数据范围及约定

- 均匀分布着约 $30\%$ 的数据，所有 $v_i$ 均相等；
- 均匀分布着约 $50\%$ 的数据，满足 $1\le h_i,v_i\le 1000$。
- 对于 $30\%$ 的数据，满足 $1\le n\le 1000$；
- 对于 $100\%$ 的数据，$1\le n\le 5\times 10^4$，$1\le h_i,v_i\le 10^9$。

### 评分标准

对于每个测试点，若输出的第一行与标准输出相同，则得到该测试点 $40\%$ 的分数，若输出文件的第二行的每个数与标准输出的误差均不大于 $10^{-4}$，则得到该测试点 $60\%$ 的分数，两项相加作为该测试点总得分。


---

---
title: "[SDOI2011] 工作安排"
layout: "post"
diff: 省选/NOI-
pid: P2488
tag: ['2011', '各省省选', '山东', '费用流']
---
# [SDOI2011] 工作安排
## 题目描述


你的公司接到了一批订单。订单要求你的公司提供 $n$ 类产品，产品被编号为 $1 \sim n$，其中第 $i$ 类产品共需要 $C_i$ 件。公司共有 $m$ 名员工，员工被编号为 $1 \sim m$ 员工能够制造的产品种类有所区别。一件产品必须完整地由一名员工制造，不可以由某名员工制造一部分配件后，再转交给另外一名员工继续进行制造。

我们用一个由 $0$ 和 $1$ 组成的 $m \times n$ 的矩阵 $A$ 来描述每名员工能够制造哪些产品。矩阵的行和列分别被编号为 $1 \sim m$ 和 $1 \sim n$，$A_i,j$ 为 $1$ 表示员工 $i$ 能够制造产品 $j$，为 $0$ 表示员工 $i$ 不能制造产品 $j$。

如果公司分配了过多工作给一名员工，这名员工会变得不高兴。我们用愤怒值来描述某名员工的心情状态。愤怒值越高，表示这名员工心情越不爽，愤怒值越低，表示这名员工心情越愉快。员工的愤怒值与他被安排制造的产品数量存在某函数关系，鉴于员工们的承受能力不同，不同员工之间的函数关系也是有所区别的。

对于员工 $i$，他的愤怒值与产品数量之间的函数是一个 $S_i+1$ 段的分段函数。当他制造第 $1 \sim T_{i,1}$ 件产品时，每件产品会使他的愤怒值增加 $W_{i,1}$，当他制造第 $T_{i,1}+1 \sim T_{i,2}$ 件产品时，每件产品会使他的愤怒值增加 $W_{i,2}$ ……为描述方便，设 $T_{i,0}=0,T_{i,s_{i+1}}=+\infty$，那么当他制造第 $T_{i,j-1}+1 \sim T_{i,j}$ 件产品时，每件产品会使他的愤怒值增加 $W_{i,j}$，$1 \le j \le S_i+1$。

你的任务是制定出一个产品的分配方案，使得订单条件被满足，并且所有员工的愤怒值之和最小。由于我们并不想使用Special Judge，也为了使选手有更多的时间研究其他两道题目，你只需要输出最小的愤怒值之和就可以了。

## 输入格式

https://cdn.luogu.com.cn/upload/pic/1608.png

第一行包含两个正整数 $m$ 和 $n$，分别表示员工数量和产品的种类数；

第二行包含 $n$ 个正整数，第 $i$ 个正整数为 $C_i$；

以下 $m$ 行每行 $n$ 个整数描述矩阵 $A$；

下面 $m$ 个部分，第 $i$ 部分描述员工 $i$ 的愤怒值与产品数量的函数关系。每一部分由三行组成：第一行为一个非负整数 $S_i$，第二行包含 $S_i$ 个正整数，其中第 $j$ 个正整数为 $T_{i,j}$，如果 $S_i=0$ 那么输入将不会留空行（即这一部分只由两行组成）。第三行包含 $S_i+1$ 个正整数，其中第 $j$ 个正整数为 $W_{i,j}$。

## 输出格式

仅输出一个整数，表示最小的愤怒值之和。

## 样例

### 样例输入 #1
```
2 3

2 2 2

1 1 0

0 0 1

1

2

1 10

1

2

1 6
```
### 样例输出 #1
```
24
```
## 提示


### 数据范围及约定

- 存在 $30\%$ 的数据，保证 $1\le n,m\le 30$；
- 均匀分布着约 $30\%$ 的数据，满足 $S_i = 0$；
- 均匀分布着约 $30\%$ 的数据，满足 $S_i \le 1$（不包含上述 $S_i = 0$ 的数据）。

对于全部数据，满足 $1\le m,n\le 250$，$0\le S_i\le 5$，$0\le A_{i, j}\le 1$，$0< T_{i, j}< T_{i, j + 1}$，$0< W_{i,j} < W_{i, j + 1}$。所有数据均不大于 $10^5$。


---

---
title: "[SDOI2011] 迷宫探险"
layout: "post"
diff: 省选/NOI-
pid: P2489
tag: ['动态规划 DP', '搜索', '2011', '各省省选', '山东']
---
# [SDOI2011] 迷宫探险
## 题目背景

[](https://paste.ubuntu.com/p/H4h73F2h87/)
## 题目描述

这是一个单人游戏。

游戏开始时，玩家控制的人物出生在迷宫的某个位置，玩家的目标是控制人物走到迷宫的某个出口（出口可能有多个）。

迷宫里有 $k$ 类陷阱（用  `A`,`B`,`C`……表示，相同字母代表相同类型的陷阱），每类陷阱可能是有害的或无害的，而在游戏开始时玩家并不知道哪些陷阱是有害的，哪些是无害的。

同一类陷阱的状态相同，即用同一个字母标志的陷阱要么全部有害，要么全部无害，不会发生一部分有害而另一部分无害的情况。任何陷阱状态的组合都有一个发生概率，考虑下例：

当 $k=2$ 时，迷宫内共有两类陷阱，分别用 `A` 和 `B` 表示，陷阱状态的组合共有 $4$ 种：-
- `A` 是无害陷阱，`B` 是无害陷阱。
- `A` 是有害陷阱，`B` 是无害陷阱；
- `A` 是无害陷阱，`B` 是有害陷阱；
- `A` 是有害陷阱，`B` 是有害陷阱；

下列表格是一个合法的概率表格：

|  | `A` 是无害陷阱 | `A` 是有害陷阱 |
| -----------: | -----------: | -----------: |
| **`B` 是无害陷阱** | $36\%$ | $24\%$ |
| **`B` 是有害陷阱** | $24\%$ | $16\%$ |

当 $k=3$ 时，会有 $8$ 种不同的陷阱状态组合，如果我们依然坚持使用概率表格，那么这个表格将会是三维的（$2\times 2 \times 2$，每一维对应着一类陷阱）。当 $k\ge 3$ 时，这将使得题目难以描述。因此我们使用一个大小为 $2^{k}$ 的数组 $p$ 来描述每种情况发生的可能性，$p$ 的下标范围为 $0\sim 2^{k}-1$。

$p$ 是这样生成的：

对于每个可能的陷阱状态组合，考虑所有 $k$ 类陷阱，令 $1$ 表示某个陷阱有害，$0$ 表示某个陷阱无害，把 `A` 作为二进制数的第 $0$ 位（从右边开始计数），`B` 作为第 $1$ 位，`C` 作为第 $2$ 位……通过以上操作，我们可以得到一个 $k$ 位的二进制数，把它转化成十进制后，$2^{k}$ 种陷阱状态的组合将会与整数 $0\sim2^{k}-1$ 一一对应。

设 $S = \displaystyle\sum_{i=0}^{2^k-1} p_i$，则陷阱状态组合 $i$ 出现的概率为 $\dfrac {p_{i}} {S}$。

上述表格对应的一个合法数组 $p$ 为 $36,24,24,16$。

当然同一个概率表格可能会对应多个数组 $p$（事实上有无数个数组 $p$ 能够迎合表格数据），例如上述表格同时也对应着下面的数组 $p$：$72,48,48,32$。

玩家控制的人物初始情况下有 $H$ 点生命，当人物踏上某个陷阱时，如果这个陷阱是有害的，那么会损失 $1$ 点生命，否则这个陷阱是无害的，不损失生命。无论上述哪种情况发生，玩家会立刻得到这个陷阱的信息（有害或无害）。一旦生命小于等于 $0$，玩家控制的人物会立刻死亡。

迷宫可以看作 $m\times n$ 的方格地图，每个元素可能是：
- `.`：表示这是平地，可以通过；
- `#`：表示这是墙，不能通过；
- `A`，`B` ，`C`……：表示这是一个陷阱；
- `$`：表示这是起点，地图中有且仅有一个；
- `@`：表示这是终点，地图中可以有多个，也可以一个也没有。

人物可以向上下左右四个方向行走，不可以走对角线，也不可以走出地图。

给定 $m\times n$ 的地图、$k$、$h$ 以及大小为 $2^{k}$ 的概率数组。你的任务是求出在执行最优策略时，人物能活着走出迷宫的概率。
## 输入格式

第一行包含 $4$ 个整数，分别表示 $m,n,k,H$；

下面 $m$ 行每行 $n$ 个字符描述迷宫地图；

最后一行包含 $2^{k}$ 个非负整数描述数组 $p$，数组下标从 $0$ 开始。
## 输出格式

仅包含一个数字，表示在执行最优策略时，人物活着走出迷宫的概率。四舍五入保留 $3$ 位小数。
## 样例

### 样例输入 #1
```
4 3 2 1

.$.

A#B

A#B

.@.

30 30 20 20
```
### 样例输出 #1
```
0.600
```
### 样例输入 #2
```
4 3 2 2

.$.

A#B

A#B

.@.

30 30 20 20
```
### 样例输出 #2
```
0.800
```
### 样例输入 #3
```
4 3 2 3

.$.

A#B

A#B

.@.

30 30 20 20
```
### 样例输出 #3
```
1.000
```
### 样例输入 #4
```
4 3 3 2

.$.

A#B

A#C

@@@

143 37 335 85 95 25 223 57
```
### 样例输出 #4
```
0.858
```
## 提示

**【样例说明 1】**

向右边走，经过 `B` ，`B` 为有害陷阱的概率为 $\frac {(20+20)}{(30+30+20+20)}=0.4$，若 `B` 为有害陷阱那么人物就死掉了，游戏失败，否则玩家得知 `B` 是无害陷阱，继续经过另一个 `B` 达到终点，胜利的概率为 $0.6$。

**【样例说明 2】**

向左边走，经过 `A`，`A` 为有害陷阱的概率为 $\frac {(30+30)} {(30+30+20+20)}=0.5$。若 `A` 为有害陷阱，那么损失一点生命，转到右边尝试 `B` ，要想成功到达终点，此时 `B` 必须为无害陷阱，而在 `A`是有害陷阱的前提下，`B` 是无害陷阱的概率是 $\frac {30}{(30+20)}=0.6$，故这种情况发生的概率为 $0.5\times 0.6=0.3$。若 `A`是无害陷阱，玩家可以控制人物连续通过两个 `A` 到达终点，这种情况发生的概率 $0.5$。所以答案为 $0.3+0.5=0.8$。 


**【样例说明 3】**

玩家控制的人物有 $3$ 点生命，但最多只需要经过两个陷阱，所以任意选左路
或右路走过去就可以到达终点了。

**【数据范围与约定】**

|测试点编号  | $m$ | $n$ | $k$ | $H$ |
| -----------: | -----------: | -----------: | -----------: | -----------: |
| $1$ | $29$ | $28$ | $5$ | $1$ |
| $2$ | $28$ | $20$ | $4$ | $1$ |
| $3$ | $25$ | $30$ | $1$ | $1$ |
| $4$ | $25$ | $30$ | $1$ | $2$ |
| $5$ | $25$ | $30$ | $1$ | $3$ |
| $6$ | $5$ | $5$ | $4$ | $4$ |
| $7$ | $12$ | $11$ | $4$ | $5$ |
| $8$ | $19$ | $17$ | $5$ | $3$ |
| $9$ | $23$ | $25$ | $5$ | $4$ |
| $10$ | $30$ | $29$ | $5$ | $5$ |

对于 $100\%$ 的数据，$1\le m\leq 30$，$1\le n\leq 29$，$k\leq 5$，$H\leq 5$，$0\leq p_i\leq 10^5$，且至少有一个 $p_i\gt0$ 。


---

---
title: "[SDOI2011] 黑白棋"
layout: "post"
diff: 省选/NOI-
pid: P2490
tag: ['动态规划 DP', '递推', '博弈论', '2011', '各省省选', '山东', '排列组合']
---
# [SDOI2011] 黑白棋
## 题目描述

小 A 和小 B 又想到了一个新的游戏。

这个游戏是在一个 $1 \times n$ 的棋盘上进行的，棋盘上有 $k$ 个棋子，一半是黑色，一半是白色。

最左边是白色棋子，最右边是黑色棋子，相邻的棋子颜色不同。

![](https://cdn.luogu.com.cn/upload/image_hosting/dmv5zoyy.png)

小 A 可以移动白色棋子，小 B 可以移动黑色的棋子，其中白色不能往左，黑色不能往右。他们每次操作可以移动 $1$ 到 $d$ 个棋子。

每当移动某一个棋子时，这个棋子不能跨越两边的棋子，当然也不可以出界。当谁不可以操作时，谁就失败了。

小 A 和小 B 轮流操作，现在小 A 先移动，有多少种初始棋子的布局会使他胜利呢？

## 输入格式

输入三个数 $n,k,d$。

## 输出格式

输出小 A 胜利的方案总数。答案对 $10^9+7$ 取模。

## 样例

### 样例输入 #1
```
10 4 2
```
### 样例输出 #1
```
182
```
## 提示

- 对于 $30\%$ 的数据，有 $k=2$。
- 对于 $100\%$ 的数据，有 $1 \leq d \leq k \leq n \leq 10^4$，$k$ 为偶数，$k \leq 100$。



---

---
title: "[SDOI2011] 消耗战"
layout: "post"
diff: 省选/NOI-
pid: P2495
tag: ['2011', '各省省选', '山东', '最近公共祖先 LCA', '虚树', '栈']
---
# [SDOI2011] 消耗战
## 题目描述

在一场战争中，战场由 $n$ 个岛屿和 $n-1$ 个桥梁组成，保证每两个岛屿间有且仅有一条路径可达。现在，我军已经侦查到敌军的总部在编号为 $1$ 的岛屿，而且他们已经没有足够多的能源维系战斗，我军胜利在望。已知在其他 $k$ 个岛屿上有丰富能源，为了防止敌军获取能源，我军的任务是炸毁一些桥梁，使得敌军不能到达任何能源丰富的岛屿。由于不同桥梁的材质和结构不同，所以炸毁不同的桥梁有不同的代价，我军希望在满足目标的同时使得总代价最小。  

侦查部门还发现，敌军有一台神秘机器。即使我军切断所有能源之后，他们也可以用那台机器。机器产生的效果不仅仅会修复所有我军炸毁的桥梁，而且会重新随机资源分布（但可以保证的是，资源不会分布到 $1$ 号岛屿上）。不过侦查部门还发现了这台机器只能够使用 $m$ 次，所以我们只需要把每次任务完成即可。  
## 输入格式

第一行一个整数 $n$，表示岛屿数量。  

接下来 $n-1$ 行，每行三个整数 $u,v,w$ ，表示 $u$ 号岛屿和 $v$ 号岛屿由一条代价为 $w$ 的桥梁直接相连。  

第 $n+1$ 行，一个整数 $m$ ，代表敌方机器能使用的次数。  

接下来 $m$ 行，第 $i$ 行一个整数 $k_i$ ，代表第 $i$ 次后，有 $k_i$ 个岛屿资源丰富。接下来 $k_i$ 个整数 $h_1,h_2,..., h_{k_i}$ ，表示资源丰富岛屿的编号。  
## 输出格式

输出共 $m$ 行，表示每次任务的最小代价。  
## 样例

### 样例输入 #1
```
10
1 5 13
1 9 6
2 1 19
2 4 8
2 3 91
5 6 8
7 5 4
7 8 31
10 7 9
3
2 10 6
4 5 7 8 3
3 9 4 6

```
### 样例输出 #1
```
12
32
22

```
## 提示

#### 数据规模与约定

- 对于 $10\%$ 的数据，$n\leq 10, m\leq 5$ 。  
- 对于 $20\%$ 的数据，$n\leq 100, m\leq 100, 1\leq k_i\leq 10$ 。  
- 对于 $40\%$ 的数据，$n\leq 1000, 1\leq k_i\leq 15$ 。  
- 对于 $100\%$ 的数据，$2\leq n \leq 2.5\times 10^5, 1\leq m\leq 5\times 10^5, \sum k_i \leq 5\times 10^5, 1\leq k_i< n, h_i\neq 1, 1\leq u,v\leq n, 1\leq w\leq 10^5$ 。  


---

---
title: "[SDOI2012] 体育课"
layout: "post"
diff: 省选/NOI-
pid: P2496
tag: ['2012', '各省省选', '山东']
---
# [SDOI2012] 体育课
## 题目背景

# 警告：滥用本题评测将被封号
## 题目描述

又是一节体育课的时间了，有 $n$ 个同学排成了一排。他们都很讨厌排在第一个位置的同学，于是后面的同学中比第一个高的都会产生一个高兴值，这个高兴值等于他的身高减去第一个同学的身高。当然比第一个同学矮的同学产生兴奋值为 $0$。

现在体育老师来了，他拥有神奇的魔法，现在他能做如下的三件事：

1. 询问某段区间高兴值最大的那个是多少。

2. 把某两个同学交换一下位置。

3. 选取一段区间的人，把第一个人身高加上 $t$，第二个加上 $2t$，第三个加上 $3t$ 以此类推。

但是体育老师不会数数，于是他找到你了，对于每一个询问，他要你帮他求出那个值。

## 输入格式

第一行两个整数 $n,m$，表示有 $n$ 个人，有 $m$ 个操作。

第二行 $n$ 个整数，顺序输入每个人的身高 $a_i$。

接下来 $m$ 行，每行第一个数位一个 $type$ 表示是做哪一件事情。

- 如果 $type=1$，那么接下来有两个整数 $l,r$，表示询问这段区间的最大的高兴值。
- 如果 $type=2$，接下来两个整数 $a,b$，表示交换这两个位置的人。
- 如果 $type=3$，接下来三个整数 $l,r,t$，表示把 $l$ 个人的升高增加 $t$,$l+1$ 个人增加 $2t$ ...第 $r$ 个人增加 $(r-l+1)t$。

## 输出格式

对于每个询问按照顺序输出每个操作 $1$ 的答案。
## 样例

### 样例输入 #1
```
6 7
109 827 100 530 10 826
3 1 6 1
2 2 6
1 2 4
1 2 3
2 2 6
1 2 6
1 2 5
```
### 样例输出 #1
```
722
722
722
719
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $1 \le n,m \le 5 \times 10^3$。
- 另有 $10\%$ 的数据，没有第三种操作。
- 另有 $20\%$ 的数据，没有第二种操作。
- 对于 $100\%$ 的数据，$1 \le n,m \le 10^5$，$0 \le t \le 10^4$，$1 \leq a_i \leq 10^8$。


---

---
title: "[SDOI2012] 基站建设"
layout: "post"
diff: 省选/NOI-
pid: P2497
tag: ['动态规划 DP', '2012', '线段树', '各省省选', '平衡树', '山东', 'cdq 分治', '斜率优化']
---
# [SDOI2012] 基站建设
## 题目描述

up 主家终于买电脑了，但是接下来有各种问题要处理。首要解决的问题就是网络问题。他要从移动公司开始，通过一些基站来传递网络到他家。

为了简化问题，我们假设移动公司，所有的基站、up 主家位于同一条直线上，他们都位于这一条直线上的某一点 $x$，这些点**可能**会重合。每个基站发射和接收的范围都是一个切于地面的圆，发射的半径 $r$ 是固定的，接收半径 $r'$ 是可调的的。如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/nh8yxjx5.png)

一个点 $i$ 如果能从另一个点 $j$ 接收到信号（当且仅当 $x_j<x_i$），必须满足 $i$ 的接收范围与 $j$ 的发射范围相切，并且需要付 $\sqrt{r'_i}$ 的额外费用。同时启动每一个点 $i$ 都需要费用 $v_i$。

当然一个点如果能够发射的 up 主家只需要这个点的发射范围与 up 主家所在的竖线相切或相交即可，如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/5t4v8687.png)

当然费用越少就越好咯，于是 up 主想要请你帮他的忙。
## 输入格式

第一行两个整数 $n, m$。表示基站个数（包括移动公司），up 主家的坐标。（保证大于等于所有基站的坐标）

记下来 $n$ 行，每行三个整数 $x_i$，$r_i$，$v_i$，表示每个基站的坐标，发射范围以及费用。

$x_i$ 是按照坐标从小到大输入的，移动公司位于最小的那个坐标。

$r$ 为 $1\dots n$ 的排列。
## 输出格式

一个实数，保留小数点后三位。
## 样例

### 样例输入 #1
```
10 33
5 4 660
10 2 2040
11 6 3207
14 5 2006
18 3 6130
19 9 3363
22 1 1265
25 8 2836
27 10 7961
29 7 9075
```
### 样例输出 #1
```
3501.000
```
## 提示

对于 $100\%$ 的数据 $n\le5\times 10^5$，$x_i,m \le 10^{12}$，$v_i \le 10000$


---

---
title: "[SDOI2012] 象棋"
layout: "post"
diff: 省选/NOI-
pid: P2499
tag: ['2012', '各省省选', '山东']
---
# [SDOI2012] 象棋
## 题目描述

小云和小南两姐妹从小喜欢下象棋，现在作为象棋高手的她们，已经不屑于玩平常的象棋了，于是她们便开始用棋盘和棋子玩各种各样的新游戏。

今天天气晴朗，阳光明媚，她们将在 $n\times m$ 的棋盘上进行游戏。

棋盘上有 $k$ 颗棋子和若干有障碍格子，令棋盘左上角格子坐标为 $(1,1)$，右下角格子坐标为 $(n,m)$，参数 $a,b$ 规定了所有棋子的走法：在 $(x, y)$ 的棋子下一步能走到 $(x + a, y + b), (x + a, y - b), (x  – a, y + b), (x – a, y – b), (x + b, y + a), (x + b, y - a), (x – b, y + a), (x – b, y – a)$ 这八个格子中的一个，棋子任何时候不能跃出棋盘或走到有障碍的格子上。

这k颗棋子是相同的，小云和小南的目标是用最少步数把所有棋子移动到特定格子，要求移动过程中不能出现多颗棋子同时在某一格的情况。

她们已经想出步数较少方案，但无法确定这是否为最少步数，所以向作为程序员的你求助。

## 输入格式

第一行五个空格隔开的整数 $n,m,k,a,b$；

接下来 $n$ 行，每行为长度 $m$ 的字符串，描述棋盘，`.` 表示没有障碍的格子，`*` 表示有障碍的格子；

接下来 $k$ 行，每行两个整数 $x$ 和 $y$，分别表示 $k$ 颗棋子的初始位置；

接下来 $k$ 行，每行两个整数 $x$ 和 $y$，分别表示 $k$ 颗棋子的目标位置。

## 输出格式

一个整数，为把所有棋子移动到目标位置的最少步数，数据保证有解。

## 样例

### 样例输入 #1
```
1 8 2 2 0
.......*
1 1
1 3
1 5
1 7
```
### 样例输出 #1
```
4
```
## 提示

【样例说明】

一可行方案如下：第二颗棋子向右跳两步，随后第一颗棋子向右跳两步，共 $4$ 步。值得注意的是，第一颗棋子向右跳三步，随后第二颗棋子向右跳一步的方案尽管能把棋子都移动到目标位置，但途中两颗棋子曾经同时在 $(1, 3)$，违反了规则，所以不能选用此方案。


数据范围

其中 $20\%$ 的数据，$n\times m\le 20$。

另外 $10\%$ 的数据，$n = 1$；

对于 $100\%$ 的数据，$1\le n,m\le 100$，$1\le k\le 500$。



---

---
title: "[SDOI2012] 集合"
layout: "post"
diff: 省选/NOI-
pid: P2500
tag: ['2012', '各省省选', '山东', '根号分治']
---
# [SDOI2012] 集合
## 题目描述

小H在学习“集合与图论”的时候遇到了一个问题，他思考了很久依然无法很好完成这个问题。于是他只好来求助你了，给出n个点m条边的带权无向图（即每条无向边上都有一个权值），有3个集合A、B、C。一开始无向图中所有点都属于A集合，有如下9种操作：

MoveA x：表示将第x个点从所在集合中删除，并加入至A集合。

MoveB x：表示将第x个点从所在集合中删除，并加入至B集合。

MoveC x：表示将第x个点从所在集合中删除，并加入至C集合。

AskAA：询问两个端点都属于A集合的所有边中最小的权值是多少。

AskAB：询问两个端点分别属于A集合和B集合的所有边中最小的权值是多少。

AskAC：询问两个端点分别属于A集合和C集合的所有边中最小的权值是多少。

AskBB：询问两个端点都属于B集合的所有边中最小的权值是多少。

AskBC：询问两个端点分别属于B集合和C集合的所有边中最小的权值是多少。

AskCC：询问两个端点都属于C集合的所有边中最小的权值是多少。

你能帮助他解决这个问题吗？

## 输入格式

输入的第1行有两个正整数，分别表示n和m。

在第2行至第m+1行中，每行有三个正整数，分别为u、v、w。表示这条无向边的两个端点分别为u和v(u != v)，且这个边的权值为w(w<=10^9)。

第m+2行有一个正整数q，表示有q个询问。

在第m+3行至第m+q+2行中，每行的输入方式为题目描述里9种操作中的一种。

## 输出格式

对于所有的Ask操作输出最小的权值，如果不存在则输出“No Found!”。

## 样例

### 样例输入 #1
```
4 3

1 2 1 

2 3 2

3 1 3

5

AskAA

AskAB

MoveB 2

AskAA

AskAB
```
### 样例输出 #1
```
1

No Found!

3

1
```
## 提示

数据范围

对于其中20%的数据，满足n<=50, m<=2500, q<=2500。

对于另外30%的数据，满足n<=100, m<=10000, q<=20000。

对于另外50%的数据，满足n<=100000,m<=500000,q<=100000。且无向图上任意两个点之间至多能选出3条不相交的路径。



---

---
title: "[HAOI2006] 数字序列"
layout: "post"
diff: 省选/NOI-
pid: P2501
tag: ['动态规划 DP', '递推', '2006', '河南', '各省省选', '枚举']
---
# [HAOI2006] 数字序列
## 题目描述

现在我们有一个长度为 $n$ 的整数序列 $a$。但是它太不好看了，于是我们希望把它变成一个单调严格上升的序列。但是不希望改变过多的数，也不希望改变的幅度太大。

## 输入格式

第一行是一个整数，表示序列长度 $n$。  
第二行有 $n$ 个整数，第 $i$ 个整数表示序列的第 $i$ 项 $a_i$。
## 输出格式

第一行输出一个整数，表示最少需要改变多少个数。

第二行输出一个整数，表示在改变的数最少的情况下，每个数改变的绝对值之和的最小值。
## 样例

### 样例输入 #1
```
4

5 2 3 5
```
### 样例输出 #1
```
1

4
```
## 提示

#### 数据规模与约定

- 对于 $90\%$ 的数据，保证 $n \leq 6 \times 10^3$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 3.5 \times 10^4$，$1 \leq a_i \leq 10^5$。数据保证 $a_i$ 随机生成。



---

---
title: "[HAOI2012] 道路"
layout: "post"
diff: 省选/NOI-
pid: P2505
tag: ['2012', '河南', '各省省选', '拓扑排序', '最短路']
---
# [HAOI2012] 道路
## 题目描述

C 国有 $n$ 座城市，城市之间通过 $m$ 条**单向**道路连接。一条路径被称为最短路，当且仅当不存在从它的起点到终点的另外一条路径总长度比它小。两条最短路不同，当且仅当它们包含的道路序列不同。我们需要对每条道路的重要性进行评估，评估方式为计算有多少条不同的最短路经过该道路。现在，这个任务交给了你。

## 输入格式

第一行包含两个正整数 $n, m$。

接下来 $m$ 行每行包含三个正整数 $u, v, w$，表示有一条从 $u$ 到 $v$ 长度为 $w$ 的道路

## 输出格式

输出应有 $m$ 行，第 $i$ 行包含一个数，代表经过第 $i$ 条道路的最短路的数目对 $10^9+7$ 取模后的结果。
## 样例

### 样例输入 #1
```
4 4
1 2 5
2 3 5
3 4 5
1 4 8
```
### 样例输出 #1
```
2
3
2
1
```
## 提示

数据规模

$30\%$ 的数据满足：$n\leq 15, m\leq 30$。

$60\%$ 的数据满足：$n\leq 300, m\leq 1000$。

$100\%$ 的数据满足：$n\leq 1500, m\leq 5000, w\leq 10000$。



---

---
title: "[SCOI2008] 劣质编码"
layout: "post"
diff: 省选/NOI-
pid: P2506
tag: ['2008', '四川', '各省省选']
---
# [SCOI2008] 劣质编码
## 题目背景

四川NOI省选2008

## 题目描述

一个编码方案把每个字符对应到一个01 串。例如{1,1010,01,10101}就是一个编码方案，它把四个字符（假设它们为a,b,c,d）分别对应到串1、1010，01，10101。字符串的编码为各字符编码的连接。例如，在刚才的编码方案中，字符串cac的编码为01101，dcb的编码为10101011010。

进一步分析发现，刚才的编码是相当劣质的，因为字符串ba, acc 和d 的编码都是10101。对于一个编码方案，你的任务是找出三个不同的字符串，使得它们的编码全相同。换句话说，找一个01 编码串，使得它至少有三种解码方式。如果有多组解，这个编码串应当尽量短。

## 输入格式

第一行包含一个整数n，即符号的个数。以下n 行每行为一个长度不超过50的01串（可能为空串），即各符号的编码。

## 输出格式

仅一行，包含一个整数，即最短编码的长度。如果无解，输出-1。

## 样例

### 样例输入 #1
```
4
1
1010
01
10101
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
2
0
1
```
### 样例输出 #2
```
-1
```
### 样例输入 #3
```
7
00011011
000110
11
0001
1011
00
011011
```
### 样例输出 #3
```
8
```
## 提示

2 <= n <= 30



---

---
title: "[HAOI2008] 圆上的整点"
layout: "post"
diff: 省选/NOI-
pid: P2508
tag: ['数学', '2008', '河南', '各省省选', '枚举', '最大公约数 gcd']
---
# [HAOI2008] 圆上的整点
## 题目描述

求一个给定的圆$(x^2+y^2=r^2)$，在圆周上有多少个点的坐标是整数。

## 输入格式

r
## 输出格式

整点个数

## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
4
```
## 提示

$r\leq 2000 000 000$



---

---
title: "[SCOI2008] 警告"
layout: "post"
diff: 省选/NOI-
pid: P2509
tag: ['模拟', '2008', '四川', '各省省选']
---
# [SCOI2008] 警告
## 题目描述

有一个简单的脚本语言，只有赋值语句、条件语句和返回语句三种。变量名必须是单个大写字母，且变量都是 $32$ 位带符号整数。

该语言的每条语句必须单独占一行。程序中不含空行，且每行的行首行末均无空格。每行的不同 token 之间用单个空格隔开。该语言的 BNF 如下：

```cpp
<line> :: <head> | <assignment> | <if> | ELSE | END IF | <return>
<head> :: PARAM <paramlist> | PARAM
<assignment> :: <variable> = <rvalue>
<if> :: IF <variable> <relation> <value> THEN
<return> :: RETURN <value>
<paramlist> :: <variable> | <variable> <paramlist>
<rvalue> :: <value> | <value> <operator> <value>
<value> :: <variable> | <integer>
<operator> :: + | - | * | /
<relation> :: < | = | >
<variable> :: A | B | ... | Z
<integer> :: 不含前导 0 的 32 位带符号整数
```
程序的第一行是一条 `<head>` 语句，定义了函数的参数，而最后一行一定是 `<return>` 语句。`<head>` 语句不能在除了第一行之外的其他任何地方出现，但 `<return>` 语句可以在程序中多次出现。行号从 $1$ 开始编号。
每条 `IF` 语句一定有一个配套的 `END IF` 语句，还有一个可选的 `ELSE` 语句（注意没有 `ELSE IF` 语句）。`IF` 语句可以嵌套，它总是比较一个变量和一个整数或者另一个变量。

你应该分析一个给定的程序，并输出两类警告信息（格式见样例输出）：

- 第一类警告：无法到达的代码行。不管各条 `IF` 语句的布尔表达式是真还是假（假设每条 `IF` 语句的布尔表达式都是既可能为真也可能为假，不受其他 `IF` 语句结果影响）。

- 第二类警告：可能未初始化的变量。该语句用到了某个变量的值，但这个变量既不在第一行指定的参数列表里，也没有在此之前由赋值语句赋值过。如果这条语句无法到达，那么不应该给出这类警告。

注意，语句 `ELSE` 和 `END IF` 不是可执行语句，因此不应该收到任何警告信息。

## 输入格式

最多包含 $50$ 行，即你要处理的程序。保证该程序合法。

## 输出格式

警告按照行号从小到大排序。如果同一行内有多个可能未初始化的变量，按照字母顺序从小到大排列。如果没有任何警告信息，你的输出应该为空。
## 样例

### 样例输入 #1
```
PARAM A B

IF A > 5 THEN

C = B * A

END IF

D = B - C

Z = Y + X

E = T

F = E + E

V = G + G

RETURN F
```
### 样例输出 #1
```
Line 5: variable C might not have been

initialized

Line 6: variable X might not have been

initialized

Line 6: variable Y might not have been

initialized

Line 7: variable T might not have been

initialized

Line 9: variable G might not have been

initialized
```
### 样例输入 #2
```
PARAM G

RETURN G

B = K

RETURN C
```
### 样例输出 #2
```
Line 3: unreachable code

Line 4: unreachable code
```
### 样例输入 #3
```
PARAM T C

B = T

A = 4

IF A < 4 THEN

IF B > 3 THEN

Q = 100 + F

ELSE

IF C = -1111111111 THEN

Q = T - A

IF Q = 0 THEN

V = V - 1

END IF

ELSE

RETURN I

E = A

END IF

END IF

ELSE

Q = 1

END IF

RETURN Q
```
### 样例输出 #3
```
Line 6: variable F might not have been

initialized

Line 11: variable V might not have

been initialized

Line 14: variable I might not have

been initialized

Line 15: unreachable code
```


---

---
title: "[HAOI2008] 下落的圆盘"
layout: "post"
diff: 省选/NOI-
pid: P2510
tag: ['贪心', '2008', '河南', '各省省选']
---
# [HAOI2008] 下落的圆盘
## 题目描述

有n个圆盘从天而降，后面落下的可以盖住前面的。求最后形成的封闭区域的周长。看下面这副图, 所有的红色线条的总长度即为所求.

![](https://cdn.luogu.com.cn/upload/pic/1628.png)

## 输入格式

n ri xi y1 ... rn xn yn

## 输出格式

最后的周长，保留三位小数

## 样例

### 样例输入 #1
```
2

1 0 0

1 1 0
```
### 样例输出 #1
```
10.472
```
## 提示

数据规模

n<=1000



---

---
title: "[HAOI2010] 订货"
layout: "post"
diff: 省选/NOI-
pid: P2517
tag: ['动态规划 DP', '2010', '河南', '各省省选', '费用流']
---
# [HAOI2010] 订货
## 题目描述

某公司估计市场在第 $i$ 个月对某产品的需求量为 $U_i$，已知在第 $i$ 月该产品的订货单价为 $d_i$，上个月月底未销完的单位产品要付存贮费用 $m$，假定第一月月初的库存量为 $0$，第 $n$ 月月底的库存量也为 $0$，问如何安排这 $n$ 个月订购计划，才能使成本最低？每月月初订购，订购后产品立即到货，进库并供应市场，于当月被售掉则不必付存贮费。假设仓库容量为 $S$。
## 输入格式

第 $1$ 行：$n, m, S \ (0\le n\le50, 0\le m\le10, 0\le S\le10000)$。

第 $2$ 行：$U_1 , U_2 , \cdots , U_n \ (0\le U_i\le10000)$。

第 $3$ 行：$d_1, d_2, \cdots ,d_n \ (0\le d_i\le100)$。
## 输出格式

只有 $1$ 行，一个整数，代表最低成本。
## 样例

### 样例输入 #1
```
3 1 1000

2 4 8

1 2 4 
```
### 样例输出 #1
```
34
```


---

---
title: "[HAOI2011] 防线修建"
layout: "post"
diff: 省选/NOI-
pid: P2521
tag: ['2011', '河南', '各省省选', '平衡树', '凸包']
---
# [HAOI2011] 防线修建
## 题目描述

近来A国和B国的矛盾激化，为了预防不测，A 国准备修建一条长长的防线，当然修建防线的话，肯定要把需要保护的城市修在防线内部了。  

可是A国上层现在还犹豫不决，到底该把哪些城市作为保护对象呢？又由于 A 国的经费有限，所以希望你能帮忙完成如下的一个任务：

1、给出你所有的 A 国城市坐标

2、A国上层经过讨论，考虑到经济问题，决定取消对 $u$ 城市的保护，也就是说 $u$ 城市不需要在防线内了

3、A国上层询问对于剩下要保护的城市，修建防线的总经费最少是多少

你需要对每次询问作出回答。注意单位长度的防线花费为 $1$。

A 国的地形是这样的，形如下图，$x$ 轴是一条河流，相当于一条天然防线，不需要你再修建。

![](https://cdn.luogu.com.cn/upload/image_hosting/rkaw5kay.png)

A 国总是有两个城市在河边，一个点是 $(0,0)$，一个点是 $(n,0)$，其余所有点的横坐标均在 $(0,n)$ 范围内，纵坐标均大于0。  
A国有一个不在 $(0,0)$ 和 $(n,0)$ 的首都。$(0,0),(n,0)$ 和首都这三个城市是一定需要保护的。

上图中，A,B,C,D,E 点为 A 国城市，且目前都要保护，那么修建的防线就会是 A-B-C-D，花费也就是线段 AB 的长度+线段 BC 的长度+线段 CD 的长度,如果，这个时候撤销 B 点的保护，那么防线变成下图

![](https://cdn.luogu.com.cn/upload/image_hosting/cd7dpmcj.png)

## 输入格式

第一行三个整数 $n,x,y$ 分别表示河边城市和首都是 $(0,0),(n,0),(x,y)$。

第二行一个整数 $m$。

接下来 $m$ 行，每行两个整数 $a,b$ 表示 A 国的一个非首都非河边城市的坐标为 $(a,b)$。

再接下来一个整数 $q$，表示修改和询问总数。


接下来 $q$ 行每行要么形如 `1 u`，要么形如 `2`，分别表示撤销第 $u$ 个城市的保护和询问。

## 输出格式

对于每个询问输出一行一个实数 $v$，表示修建防线的花费，保留两位小数。

## 样例

### 样例输入 #1
```
4 2 1                                
2                                 
1 2                               
3 2                               
5                                 
2
1 1
2
1 2
2
```
### 样例输出 #1
```
6.47
5.84
4.47
```
## 提示

【数据范围】   
对于 $30\%$ 的数据，$1\le m,q \le 1000$；   
对于 $100\%$ 的数据，$1\le m \le 10^5$，$1\le q \le 2 \times 10^5$，$1 < n \le 10^4$。

所有点的坐标范围均在 $10^4$ 以内, 数据保证没有重点。

---

~~$\text{upd 2022.7.21}$：新增加一组 Hack 数据。~~ 该数据有误，已经被移除。


---

---
title: "[HAOI2011] Problem c"
layout: "post"
diff: 省选/NOI-
pid: P2523
tag: ['动态规划 DP', '2011', '河南', '各省省选', '组合数学']
---
# [HAOI2011] Problem c
## 题目描述

给 $n$ 个人安排座位，先给每个人一个 $1\thicksim n$ 的编号，设第 $i$ 个人的编号为 $a_i$（不同人的编号可以相同）。

接着从第一个人开始，大家依次入座，第 $i$ 个人来了以后尝试坐到 $a_i$，如果 $a_i$ 被占据了，就尝试 $a_i+1$，$a_i+1$ 也被占据了的话就尝试 $a_i+2$……，如果一直尝试到第 $n$ 个都不行，该安排方案就不合法。

然而有 $m$ 个人的编号已经确定（他们或许贿赂了你的上司...），你只能安排剩下的人的编号，求有多少种合法的安排方案。

由于答案可能很大，只需输出其除以 $M$ 后的余数即可。
## 输入格式

第一行一个整数 $T$，表示数据组数。

对于每组数据，第一行有三个整数，分别表示 $n$、$m$、$M$。

若 $m$ 不为 $0$，则接下来一行有 $m$ 对整数，$p_1$、$q_1$，$p_2$、$q_2$，...， $p_m$、$q_m$，其中第 $i$ 对整数 $p_i$、$q_i$ 表示第 $p_i$ 个人的编号必须为 $q_i$。
## 输出格式

对于每组数据输出一行，若是有解则输出 `YES`，后跟一个整数表示方案数 $\bmod M$，注意，`YES` 和数之间只有一个空格，否则输出 `NO`。
## 样例

### 样例输入 #1
```
2
4 3 10
1 2 2 1 3 1
10 3 8882
7 9 2 9 5 10
```
### 样例输出 #1
```
YES 4
NO
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证
- $1 \leq T \leq 10$。
- $1 \leq n \leq 300$， $0 \leq m \leq n$， $2 \leq M \leq 10^9$。
- $1 \leq p_i$、$q_i \leq n$。
- $p_i$ 互不相同。 


---

---
title: "[SHOI2001] 小狗散步"
layout: "post"
diff: 省选/NOI-
pid: P2526
tag: ['2001', '各省省选', '上海', 'Special Judge']
---
# [SHOI2001] 小狗散步
## 题目描述

Grant 喜欢带着他的小狗 Pandog 散步。Grant 以一定的速度沿着固定路线走，该路线可能自交。Pandog 喜欢游览沿途的景点，不过会在给定的  $N$ 个点和主人相遇。小狗和主人同时从  $(X_1,Y_1)$ 点出发，并同时在  $(X_n,Y_n)$ 点汇合。小狗的速度最快是 Grant 的两倍。当主人从一个点以直线走向另一个点时，Pandog 跑向一个它感兴趣的景点。Pandog 每次与主人相遇之前最多只去一个景点。

你现在的任务是：为 Pandog 寻找一条路线（有可能与主人的路线部分相同），使它能够游览最多的景点，并能够准时与主人在给定地点相遇或者汇合。
## 输入格式

第一行是两个整数  $N$ 和  $M$。

第二行的  $N$ 个坐标给出了 Grant 的散步路线，即 Pandog 和主人相遇地点。

第三行的  $M$ 个坐标给出了所有 Pandog 感兴趣的景点。
## 输出格式

输出小狗的移动路线。

第一行是经过的点数，第二行依次为经过的点的二维坐标。
## 样例

### 样例输入 #1
```
4 5
1 4 5 7 5 2 -2 4
-4 -2 3 9 1 2 -1 3 8 -3

```
### 样例输出 #1
```
6
1 4 3 9 5 7 5 2 1 2 -2 4
```
## 提示

对于所有数据，有  $1\le N,M\le 100$，所有输入的坐标均不相同，且绝对值不超过  $10^3$。


---

---
title: "[SHOI2001] 击鼓传花"
layout: "post"
diff: 省选/NOI-
pid: P2529
tag: ['2001', '各省省选', '上海']
---
# [SHOI2001] 击鼓传花
## 题目描述

HC(Happy Child)小朋友最近经常在教室里跟同学一起玩击鼓传花的游戏，规则是第 $n$ 个拿到花的小朋友必须说出 $n!$ 最后一位非 0 的数字，如此循环游戏，如果谁讲错了就得罚唱一支歌曲。

经过几次游戏，HC 小朋友认为只要把前一个小朋友说得数字去乘以 $n$，说出得到的数的最后一位非 $0$ 的数字就可以了，可惜 HC 小朋友这次轮到了第 $15$ 个，结果被罚了唱歌(应该是 $8$，但是HC小朋友却说了$3$)。

HC 小朋友不希望这样的事情再次发生，所以希望你能编写一个程序，能够计算出 $n!$ 的最后一位非 $0$ 的数字。

## 输入格式

输入有 $5$ 行，第 $i$ ($1\le i\le 5$) 行是一个 $n$ ($1\le n\le10^{100}$)。

## 输出格式

输出有 $5$ 行。

第 $i$ 行对应输入中第 $i$ 行的 $n$ 的阶乘的最后一位非 $0$ 的数字。

## 样例

### 样例输入 #1
```
11
12
13
14
15

```
### 样例输出 #1
```
8
6
8
2
8

```


---

---
title: "[AHOI2012] 信号塔"
layout: "post"
diff: 省选/NOI-
pid: P2533
tag: ['计算几何', '2012', '各省省选', '安徽', '随机化']
---
# [AHOI2012] 信号塔
## 题目描述

在野外训练中，为了确保每位参加集训的成员安全，实时的掌握和收集周边环境和队员信息非常重要，集训队采用的方式是在训练所在地散布 $N$ 个小型传感器来收集并传递信息，这些传感器只与设在集训地中的信号塔进行通信，信号塔接收信号的覆盖范围是圆形，可以接收到所有分布在该集训区域内所有 $N$ 个小型传感器（包括在该圆形的边上）发出的信号。信号塔的功率与信号塔接收范围半径的大小成正比，因为是野外训练，只能使用事先储备好的蓄电设备，因此在可以收集所有传感器信息的基础上，还应使得信号塔的功率最小。小龙帮助教官确定了一种信号塔设置的方案，既可以收集到所有 $N$ 个传感器的信号，又可以保证这个信号塔的功率是最小的。同学们，你们知道，这个信号塔的信号收集半径有多大，它应该设置在何处吗?
## 输入格式

共 $N+1$ 行，第一行为正整数 $N$，表示队员个数。接下来 $N$ 行，每行两个实数用空格分开，分别是第 $i$ 个队员的坐标 $x_i$ 和 $y_i$ （$x_i,y_i$ 不超过双精度范围）。
## 输出格式

一行，共三个实数（中间用空格隔开），分别是信号塔的坐标，和信号塔覆盖的半径。
## 样例

### 样例输入 #1
```
5
1.200 1.200
2.400 2.400
3.800 4.500
2.500 3.100
3.900 1.300
```
### 样例输出 #1
```
2.50 2.85 2.10
```
## 提示

队员是否在边界上的判断应该符合他到圆心的距离与信号塔接受半径的差的绝对值小于 $10^{-6}$，最终结果保留 $2$ 位小数。

对于 $30\%$ 的数据，满足 $1\le N \le 10^4$  
对于 $70\%$ 的数据，满足 $1\le N \le 2\times10^4$  
对于 $100\%$ 的数据，满足 $1\le N \le 10^6$

本题存在 hack 数据，计 0 分。


---

---
title: "[AHOI2012] 收集资源"
layout: "post"
diff: 省选/NOI-
pid: P2535
tag: ['2012', '各省省选', '安徽']
---
# [AHOI2012] 收集资源
## 题目描述

 ![](https://cdn.luogu.com.cn/upload/pic/1637.png) 

 ![](https://cdn.luogu.com.cn/upload/pic/1638.png) 


## 输入格式

![](https://cdn.luogu.com.cn/upload/pic/1639.png)

## 输出格式

![](https://cdn.luogu.com.cn/upload/pic/1640.png)

## 样例

### 样例输入 #1
```
8 8 10
1 1 3
2 2 4
3 3 5
3 4 3
4 3 2
4 4 6
5 5 7
6 6 8
```
### 样例输出 #1
```
28
```
## 提示

数据：

50%: 1<=N,M,T<=100

100%: 1<=N,M,T<=200



---

---
title: "[AHOI2005] 穿越磁场"
layout: "post"
diff: 省选/NOI-
pid: P2537
tag: ['2005', '各省省选', '离散化', '安徽', '广度优先搜索 BFS', '最短路']
---
# [AHOI2005] 穿越磁场
## 题目描述

探险机器人在Samuel星球上寻找一块奇特的矿石，然而此时它陷入了一片神秘的磁场区域，动弹不得。

探险空间站立刻扫描了这片区域，绘制出该区域的磁场分布平面图。这片区域中分布了N个磁场，每个磁场呈正方形，且边与坐标轴平行。

例如下图中，存在3个磁场，白点表示机器人的位置，黑点表示矿石的位置：

 ![](https://cdn.luogu.com.cn/upload/pic/1642.png) 

科学家们分析平面图，进一步发现：这些磁场为大小不一的正方形，可能相交，甚至覆盖，但是它们的边缘不会重合，顶点也不会重合。

例如下面的两种情形是不会出现的：

 ![](https://cdn.luogu.com.cn/upload/pic/1643.png) 

科学家们给探险机器人启动了磁力罩，这样它就可以在磁场中自由穿越了。

初始时，探险机器人和所有矿石都不在任何磁场的边缘。由于技术限制，在穿越过程中机器人只能够水平或垂直移动，且不能够沿着磁场的边缘行动。

由于磁力罩的能量有限，科学家们希望探险机器人穿越尽量少的磁场边缘采集到这块矿石。例如上图中，探险机器人最少需要穿越两次磁场边缘。

现在小联请你编写程序，帮助科学家们设计探险机器人的路线，统计探险机器人最少需要穿越多少次磁场边缘。

## 输入格式

第一行有一个整数N，表示有N个磁场（1 < N < 100）。随后有N行，每行有三个整数X、Y、C（0 < X ,Y ,C < 10000），表示一个磁场左下角坐标为（X,Y），边长为C。接下来有一行，共有四个整数SX, SY, TX, TY，表示机器人初始坐标为（SX, SY），矿石坐标为（TX，TY）（其中，1 < SX, SY, TX, TY < 10000）。

## 输出格式

单行输出一个整数，表示机器人最少需要穿越多少次磁场边缘。

## 样例

### 样例输入 #1
```
2
1 3 3 
2 1 4
0 0 3 4
```
### 样例输出 #1
```
2
```


---

---
title: "[SCOI2008] 城堡"
layout: "post"
diff: 省选/NOI-
pid: P2538
tag: ['动态规划 DP', '搜索', '2008', '四川', '各省省选', '基环树']
---
# [SCOI2008] 城堡
## 题目背景

2008NOI四川省选

## 题目描述

在一个国家里，有 $n$ 个城市（编号为 $0$ 到 $n-1$）。这些城市之间有 $n$ 条双向道路相连（编号为 $0$ 到 $n-1$），其中编号为 $i$ 的道路连接了城市 $i$ 和城市 $r_i$（一条道路可以连接一个城市和它自身），长度为 $d_i$。$n$ 个城市中有 $m$ 个拥有自己城堡，可以抵御敌人侵略。如果没有城堡的城市遭受攻击，则离它最近的城堡将派兵前往救援。

你的任务是在不超过 $k$ 个没有城堡的城市中建立城堡，使得所有城市中“离最近城堡的距离”的最大值尽量小。换句话说，若令 $dist(c)$ 表示城市 $c$ 的最近城堡离它的距离，则你的任务是让 $\max\{dist(c)\}$ 尽量小。

输入数据保证存在方案使得对于每个城市，至少有一个城堡能够到达。
## 输入格式

输入第一行为三个正整数 $n, m, k$。第二行包含 $n$ 个整数 $r_0,r_1,\ldots,r_{n-1}$。第三行包含 $n$ 个整数 $d_0,d_1,\ldots,d_{n-1}$。第四行包含 $m$ 个各不相同的 $0$ 到 $n-1$ 之间的整数，分别为 $m$ 个城堡所在的城市编号。
## 输出格式

输出仅一行，包含一个整数，即 $\max\{dist(c)\}$ 的最小值。
## 样例

### 样例输入 #1
```
5 0 1
1 2 3 4 0
1 1 1 1 1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
3 1 1
1 2 0
1 2 3
2
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
2 1 1  
0 1  
1 1  
1 
```
### 样例输出 #3
```
0
```
### 样例输入 #4
```
10 3 3
0 2 0 0 2 2 8 3 8 7
10 9 1 8 1 3 7 2 8 1
3 4 6
```
### 样例输出 #4
```
3
```
### 样例输入 #5
```
2 0 1
1 0
5 10
```
### 样例输出 #5
```
5
```
## 提示

$100\%$ 的数据满足: $2\leq n\leq 50$，$1\leq d_i\leq 10^6$，$0\leq m\leq n-k$。


---

---
title: "[AHOI2005] 航线规划"
layout: "post"
diff: 省选/NOI-
pid: P2542
tag: ['2005', '线段树', '各省省选', '安徽', 'O2优化', '最近公共祖先 LCA', '树链剖分']
---
# [AHOI2005] 航线规划
## 题目描述

对 Samuel 星球的探险已经取得了非常巨大的成就，于是科学家们将目光投向了 Samuel 星球所在的星系——一个巨大的由千百万星球构成的 Samuel 星系。

星际空间站的 Samuel II 巨型计算机经过长期探测，已经锁定了 Samuel 星系中 $n$ 个星球的空间坐标，并对这些星球以 $1$ 至 $n$ 依次编号。

一些先遣飞船已经出发，在星球之间开辟探险航线。

探险航线是双向的，例如从 $1$ 号星球到 $3$ 号星球开辟探险航线，那么从 $3$ 号星球到 $1$ 号星球也可以使用这条航线。

例如下图所示：

 ![](https://cdn.luogu.com.cn/upload/pic/1644.png) 

在 $5$ 个星球之间，有 $5$ 条探险航线。

$A,B$ 两星球之间，如果某条航线不存在，就无法从 $A$ 星球抵达 $B$ 星球，我们则称这条航线为关键航线。

显然上图中，$1$ 号与 $5$ 号星球之间的关键航线有 $1$ 条：即为 $4\leftrightarrow5$ 航线。

然而，在宇宙中一些未知的磁暴和行星的冲撞，使得已有的某些航线被破坏，随着越来越多的航线被破坏，探险飞船又不能及时恢复这些航线，可见两个星球之间的关键航线会越来越多。

假设在上图中，航线 $4\leftrightarrow2$（从 $4$ 号星球到 $2$ 号星球）被破坏。此时，$1$ 号与 $5$ 号星球之间的关键航线就有 $3$ 条：$1 \leftrightarrow 3$，$3 \leftrightarrow 4$，$4 \leftrightarrow 5$。

小联的任务是，不断关注航线被破坏的情况，并随时给出两个星球之间的关键航线数目。现在请你帮助完成。

## 输入格式

第一行有两个整数，分别表示星球个数 $n$ 和初始时的航线条数 $m$。

接下来 $m$ 行，每行有两个不相同的整数 $u, v$，表示星球 $u$ 和星球 $v$ 之间存在一条航线。

接下来有若干行，每行首先给出一个整数 $op$，表示一次操作的类型。

- 若 $op = 1$，则后接两个整数 $u, v$，表示询问当前 $u, v$ 两星球之间有多少关键航线。
- 若 $op = 0$，则后接两个整数 $u, v$，表示 $u, v$ 之间的航线被破坏。
- 若 $op = -1$，则表示输入结束，后面不再存在操作。

## 输出格式

对每个 $op = 1$ 的询问，输出一行一个整数表示关键航线数目。

## 样例

### 样例输入 #1
```
5 5
1 2
1 3
3 4
4 5
4 2
1 1 5
0 4 2
1 5 1
-1
```
### 样例输出 #1
```
1
3
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 3 \times 10^4$，$1 \leq m \leq 10^5$。
- $-1 \leq op \leq 1$，$1 \leq u, v \leq n$。
- 无论航线如何被破坏，任意时刻任意两个星球都能够相互到达。在整个数据中，任意两个星球之间最多只可能存在一条直接的航线。
- 对于 $op = 0$ 的操作，保证操作前航线 $u \leftrightarrow v$ 存在。
- 询问与破坏航线的总次数不超过 $4 \times 10^4$。


---

---
title: "[AHOI2004] 数字迷阵"
layout: "post"
diff: 省选/NOI-
pid: P2544
tag: ['2004', '各省省选', '递归', '安徽', '斐波那契数列']
---
# [AHOI2004] 数字迷阵
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1655.png)

## 输入格式

每行有三个正整数，分别是i,j,m，其中i,j<=10^9,2<=m<=10^4。

## 输出格式

每行输出对应的第i行，第j列的那个正整数对m取模的结果。

## 样例

### 样例输入 #1
```
1 2 99
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
9 1 999
```
### 样例输出 #2
```
22
```


---

---
title: "[AHOI2002] 黑白瓷砖"
layout: "post"
diff: 省选/NOI-
pid: P2561
tag: ['搜索', '数学', '2002', '各省省选', '安徽', '置换']
---
# [AHOI2002] 黑白瓷砖
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1685.png) 

![](https://cdn.luogu.com.cn/upload/pic/1686.png)

## 输入格式

一行，一个正整数 $n$，$n \leq 20$ 。

## 输出格式

以一行的形式输出问题的解 $s$ (解的位数不超过 $200$ 位)。

## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
2
```
### 样例输出 #2
```
4
```


---

---
title: "[SCOI2009] 围豆豆"
layout: "post"
diff: 省选/NOI-
pid: P2566
tag: ['2009', '四川', '各省省选', '状压 DP']
---
# [SCOI2009] 围豆豆
## 题目背景

四川NOI2009省选

## 题目描述

是不是平时在手机里玩吃豆豆游戏玩腻了呢？最近MOKIA手机上推出了一种新的围豆豆游戏，大家一起来试一试吧。


游戏的规则非常简单，在一个N×M的矩阵方格内分布着D颗豆子，每颗豆有不同的分值Vi。游戏者可以选择任意一个方格作为起始格，每次移动可以随意的走到相邻的四个格子，直到最终又回到起始格。最终游戏者的得分为所有被路径围住的豆豆的分值总和减去游戏者移动的步数。矩阵中某些格子内设有障碍物，任何时刻游戏者不能进入包含障碍物或豆子的格子。游戏者可能的最低得分为0，即什么都不做。


注意路径包围的概念，即某一颗豆在路径所形成的多边形（可能是含自交的复杂多边形）的内部。下面有两个例子：

 
 ![](https://cdn.luogu.com.cn/upload/pic/1690.png) 

第一个例子中，豆在路径围成的矩形内部，所以豆被围住了。第二个例子中，虽然路径经过了豆的周围的8个格子，但是路径形成的多边形内部并不包含豆，所以没有围住豆子。

布布最近迷上了这款游戏，但是怎么玩都拿不了高分。聪明的你决定写一个程序来帮助他顺利通关。

## 输入格式

第一行两个整数N和M，为矩阵的边长。

第二行一个整数D，为豆子的总个数。

第三行包含D个整数V1到VD，分别为每颗豆子的分值。

接着N行有一个N×M的字符矩阵来描述游戏矩阵状态，0表示空格，#表示障碍物。而数字1到9分别表示对应编号的豆子。

## 输出格式

仅包含一个整数，为最高可能获得的分值。

## 样例

### 样例输入 #1
```
3 8

3

30 -100 30

00000000

010203#0

00000000


```
### 样例输出 #1
```
38
```
## 提示

50%的数据满足1≤D≤3。

100%的数据满足1≤D≤9，1≤N, M≤10，-10000≤Vi≤10000。



---

---
title: "[ZJOI2005] 梦幻折纸"
layout: "post"
diff: 省选/NOI-
pid: P2576
tag: ['2005', '各省省选', '浙江']
---
# [ZJOI2005] 梦幻折纸
## 题目背景

你是一个喜欢幻想的小女孩，特别喜欢追求一些完美的理想的东西——“理想的圆”，“理想的均等”，“理想的材料”，“理想的最优解”……

最近，偶然的机会，你迷恋上了折纸。你把自己的作业本扯下来折成了各种各样的小把戏——小花，小草，小鸟，小兔子，小老鼠……一张又一张，直到作业本的封面都被你折成了纸鹤。但是你还是觉得不过瘾。

终于……你克制不住自己心中压抑的想法，从可怜的同桌那儿拿了一张用过的草稿纸。正当你打算用同样的方法折掉它的时候，你十分惊奇的发现：这不是一张普通的草稿纸，而是一张非常特殊的草稿纸：它薄得厚度可以忽略不计，柔韧得怎么撕也撕不破，而且无论怎么折都行。

你如获至宝，这不就是你梦寐以求的“理想的材料”吗？真所谓“踏破铁鞋无觅处，得来全不费功夫。梦里寻它千百度，蓦然回首，它却在灯火阑珊处 ！”你决心要把它折成一个有难度一点的东西，才对得住一张这么好的纸。

## 题目描述

你仔细观察了一下纸的特点：

纸的大小为n(cm)×m(cm)，上面等距离的印好了格线，n-1条横线和m-1条竖线（线的宽度忽略不计）。这些格线将纸分成了n×m个大小完全相同的正方形小格。你的同桌已经在每一块小格(i,j)上写下了一个互不相同的正整数P[i,j]，1<=P[i,j]<=n×m。

“他干嘛在纸上写下这么些数字呢？”你看着这些数字，疑惑不解。

这时，你的同桌突然出现了，他发现你正拿着他的纸，看着上面的数字发呆。于是傻乎乎地对你说：

“我刚刚也想学你折纸，可是我很笨，只折出一个1(cm)×1(cm)的正方形，也就是一个n×m层纸的纸垛，每一层恰好是一个小格，所有的格线都恰好在正方形的边界上。”

“哦，折得不错，挺好的。”你口里说不错，心里却暗笑：没见过你这么笨的。居然把这么好的纸折成一个如此简单的正方形，简直是暴殄天物，罪过啊，罪过！

“是吗？你也觉得不错啊？我刚刚就在想，如果给这些小格编上号，最上面一层编为1，从上往下数的第i层编为i，那么能不能从这些编号复原出刚刚我折的那个图形呢？于是我就在这些格子上写下了它们的编号”

“这……”你一时语塞，确切的说，惊讶得说不出话来，原来一向傻乎乎的同桌脑子里也有这么深奥的想法。

“这样吧，如果你能根据我把我刚刚折的正方形折出来，那我就把这张纸送给你！” 同桌接着说，“不管你折法是否和我一样，只要折出来也是个1(cm)×1(cm)的正方形，从上往下数的第i层的编号恰好也是i，并且纸不能破，就算你折对了。”

“好啊，不过我先要检查检查你有没有骗我，要是你故意骗我或者自己粗心在编号的时候写错了数字而害得我折不出来，我可饶不了你！”

## 输入格式

第一行为整数t，代表输入数据的总数。

以下有t组数据，每组数据的结构如下：

第一行两个正整数n,m。

以下n行，每行m个正整数，相邻两个整数之间用一个空格隔开，描述矩阵p[i,j]。

## 输出格式

输出t行，对应t个输入数据。

对于第i组数据，输出AllRight——如果可以折出来；输出Cheat——如果折不出来。

## 样例

### 样例输入 #1
```
4



1 7

3 1 7 6 5 4 2



2 2

1 2

3 4



2 3

2 1 6

3 4 5



4 4

11 12 15 14

10 9 16 13

5 8 1 2

6 7 4 3


```
### 样例输出 #1
```
AllRight

Cheat

AllRight

AllRight


```
## 提示

    t ≤ 10

    1 ≤ n，m ≤ 100



---

---
title: "[ZJOI2008] 杀蚂蚁"
layout: "post"
diff: 省选/NOI-
pid: P2586
tag: ['模拟', '2008', '各省省选', '浙江']
---
# [ZJOI2008] 杀蚂蚁
## 题目描述

最近，佳佳迷上了一款好玩的小游戏：antbuster。

游戏规则非常简单：在一张地图上，左上角是蚂蚁窝，右下角是蛋糕，蚂蚁会源源不断地从窝里爬出来，试图把蛋糕搬回蚂蚁窝。而你的任务，就是用原始资金以及杀蚂蚁获得的奖金造防御塔，杀掉这些试图跟你抢蛋糕的蚂蚁~

为了拿到尽可能高的分数，佳佳设计了很多种造塔的方案，但在尝试了其中的一小部分后，佳佳发现，这个游戏实在是太费时间了。为了节省时间，佳佳决定写个程序，对于每一种方案，模拟游戏进程，根据效果来判断方案的优劣。

根据自己在游戏中积累的一些经验，以及上网搜到的一些参数，佳佳猜了蚂蚁爬行的算法，并且假设游戏中的蚂蚁也是按这个规则选择路线：

1. 每一秒钟开始的时候，蚂蚁都在平面中的某个整点上。如果蚂蚁没有扛着蛋糕，它会在该点留下 $2$ 单位的信息素，否则它会留下 $5$ 单位的信息素。然后蚂蚁会在正北、正南、正东、正西四个方向中选择一个爬过去。

2. 选择方向的规则是：首先，爬完一个单位长度后到达的那个点上，不能有其他蚂蚁或是防御塔，并且那个点不能是蚂蚁上一秒所在的点（除非上一个时刻蚂蚁就被卡住，且这个时刻它仍无法动），当然，蚂蚁也不会爬出地图的边界（我们定义这些点为不可达点）。如果此时有多个选择，蚂蚁会选择信息素最多的那个点爬过去。

3. 如果此时仍有多种选择，蚂蚁先面向正东，如果正东不是可选择的某个方向，它会顺时针转 $90^\degree$，再次判断，如果还不是，再顺时针旋转 $90^\degree$，直到找到可以去的方向。

4. 如果将每只蚂蚁在洞口出现的时间作为它的活动时间的第 $1$ 秒，那么每当这只蚂蚁的活动时间秒数为 $5$ 的倍数的时候，它先按规则 $1\sim 3$ 确定一个方向，面对该方向后逆时针转 $90^\degree$，若它沿当前方向会走到一个不可达点，它会不停地每次逆时针转 $90^\degree$，直到它面对着一个可达的点，这样定下的方向才是蚂蚁最终要爬去的方向。

5. 如果蚂蚁的四周都是不可达点，那么蚂蚁在这一秒内会选择停留在当前点。下一秒判断移动方向时，它上一秒所在点为其当前停留的点。

6. 你可以认为蚂蚁在选定方向后，瞬间移动到它的目标点，这一秒钟剩下的时间里，它就停留在目标点。

7. 蚂蚁按出生的顺序移动，出生得比较早的蚂蚁先移动。

然后，是一些有关地图的信息：

1. 每一秒，地图所有点上的信息素会损失 $1$ 单位，如果那个点上有信息素的话。

2. 地图上某些地方是炮台。炮台的坐标在输入中给出。

3. 地图的长、宽在输入中给出，对于 $n\times m$ 的地图，它的左上角坐标为 $(0,0)$，右下角坐标为 $(n,m)$。蚂蚁洞的位置为 $(0,0)$，蛋糕的位置为 $(n,m)$。

4. 你可以把蚂蚁看做一个直径为 $1$ 单位的圆，圆心位于蚂蚁所在的整点。

5. 游戏开始时，地图上没有蚂蚁，每个点上的信息素含量均为 $0$。

一些有关炮塔的信息：

1. 炮塔被放置在地图上的整点处。

2. 为了简单一些，我们认为这些炮塔都是激光塔。激光塔的射速是 $1$ 秒每次，它的攻击伤害为 $d$ 单位每次，攻击范围为 $r$。你可以认为每秒蚂蚁移动完毕后，塔才开始攻击。并且，只有当代表蚂蚁的圆的圆心与塔的直线距离不超过 $r$ 时，塔才算打得到那只蚂蚁。

3. 如果一只蚂蚁扛着蛋糕，那么它会成为 target，也就是说，任何打得到它的塔的炮口都会对准它。如果蛋糕好好地呆在原位，那么每个塔都会挑离它最近的蚂蚁进行攻击，如果有多只蚂蚁，它会选出生较早的一只。如果有蚂蚁扛着蛋糕，但是不在某个塔的攻击范围内，这个塔会选择最近的蚂蚁进行攻击。

4. 激光塔有个比较奇怪的特性：它在选定了打击目标后，只要目标在其射程内，塔到目标蚂蚁圆心的连线上的所有蚂蚁（这里“被打到”的判定变成了表示激光的线段与表示蚂蚁的圆有公共点）都会被打到并损 $d$ 格血，但激光不会穿透它的打击目标打到后面的蚂蚁。

5. 尽管在真实游戏中，塔是可以升级的，但在这里我们认为塔的布局和等级就此定了下来，不再变动。

再介绍一下蚂蚁窝：

1. 如果地图上的蚂蚁不足 $6$ 只，并且洞口（即点 $(0,0)$）没有蚂蚁，那么窝中每秒会爬出一只蚂蚁，直到地图上的蚂蚁数为 $6$ 只。

2. 刚出生的蚂蚁站在洞口。

3. 每只蚂蚁有一个级别，级别决定了蚂蚁的血量，级别为 $k$ 的蚂蚁的血量为 $\lfloor 4\times 1.1^k\rfloor$（$\lfloor x\rfloor$ 表示对 $x$ 下取整）。每被塔打一次，蚂蚁的血减少 $d$。注意，血量为 $0$ 的蚂蚁仍能精力充沛地四处乱爬，只有一只蚂蚁的血被打成负数时，它才算挂了。

4. 蚂蚁的级别是这样算的：前 $6$ 只出生的蚂蚁是 $1$ 级，第 $7\sim 12$ 只是 $2$级，依此类推第 $6k+1\sim 6k+6$ 的等级是 $k+1(k\in \Bbb{N})$。

最后给出关于蛋糕的介绍：

1. 简单起见，你可以认为此时只剩最后一块蛋糕了。如果有蚂蚁走到蛋糕的位置，并且此时蛋糕没有被扛走，那么这只蚂蚁就扛上了蛋糕。蚂蚁被打死后蛋糕回到点 $(n,m)$。

2. 如果一只扛着蛋糕的蚂蚁走到蚂蚁窝的位置，我们就认为蚂蚁成功抢到了蛋糕，游戏结束。这个回合不会对蚂蚁的年龄产生贡献。

3. 蚂蚁扛上蛋糕时，血量会增加 $\left\lfloor\dfrac{x}{2}\right\rfloor$（$x$ 表示蚂蚁出生时的血量），但不会超过蚂蚁的血量上限。

整理一下 $1$ 秒钟内发生的事件：

1. $1$ 秒的最初，如果地图上蚂蚁数不足 $6$，一只蚂蚁就会在洞口出生。

2. 接着，蚂蚁们在自己所在点留下一些信息素后，考虑移动。先出生的蚂蚁先移动。

3. 移动完毕后，如果有蚂蚁在蛋糕的位置上并且蛋糕没被拿走，它把蛋糕扛上，血量增加，并在这时被所有塔设成 target。

4. 然后所有塔同时开始攻击。如果攻击结束后那只扛着蛋糕的蚂蚁挂了，蛋糕瞬间归位。扛着蛋糕的蚂蚁死后，蛋糕会在下一秒钟所有蚂蚁移动完之后再出现。下一秒钟出现在 $(n,m)$ 的蚂蚁才会获得蛋糕。

5. 攻击结束后，如果发现扛蛋糕的蚂蚁没死并在窝的位置，就认为蚂蚁抢到了蛋糕，游戏也在此时结束。

6. 最后，地图上所有点的信息素损失 $1$ 单位。所有蚂蚁的年龄加 $1$。漫长的 $1$ 秒到此结束。
## 输入格式

输入的第一行是两个用空格隔开的正整数，$n,m$，分别表示了地图的长和宽。

第二行是三个用空格隔开的整数，$s,d,r$，依次表示炮塔的个数、单次攻击伤害以及攻击范围。

接下来 $s$ 行，每行两个用空格隔开的整数 $x,y$，描述了一个炮塔的位置。当然，蚂蚁窝的洞口以及蛋糕所在的位置上一定没有炮塔。

最后一行是一个正整数 $t$，表示我们模拟游戏的前 $t$ 秒钟。
## 输出格式

如果在第 $t$ 秒或之前蚂蚁抢到了蛋糕，输出一行 `Game over after x seconds`，其中 $x$ 为游戏结束的时间，否则输出 `The game is going on`。

如果游戏在 $t$ 秒或之前结束，输出游戏结束时所有蚂蚁的信息，否则输出 $t$ 秒后所有蚂蚁的信息。格式如下：

第一行是一个整数 $s$，表示此时活着的蚂蚁的总数。

接下来 $s$ 行，每行五个整数，依次表示一只蚂蚁的年龄（单位为秒）、等级、当前血量，以及在地图上的位置 $(a,b)$。输出按蚂蚁的年龄递减排序。
## 样例

### 样例输入 #1
```
3 5
1 1 2
2 2
5

```
### 样例输出 #1
```
The game is going on
5
5 1 3 1 4
4 1 3 0 4
3 1 3 0 3
2 1 3 0 2
1 1 4 0 1

```
## 提示

### 样例说明：

$3\times 5$ 的地图，有一个单次伤害为 $1$、攻击范围为 $2$ 的激光炮塔，它的位置为 $(2,2)$，模拟游戏的前 $5$ 秒。

$5$ 秒内有 $5$ 只蚂蚁出生，都是向东爬行，其中第 $1\sim 4$ 只在路过 $(0,2)$ 点时被激光塔射伤了 $1$ 格血。在第 $5$ 秒的时候，最早出生的蚂蚁按移动规则 $1\sim 3$ 本来该向东移动，但由于规则 $4$ 的作用，它在发现向北和向西移动都会到达不可达点后，最终选择了向南移动。

### 数据范围说明：

对于 $100\%$ 的数据，满足 $1\leqslant n,m\leqslant 8,s\leqslant 20,t\leqslant 2\times 10^5,0\leqslant d\leqslant 10^4,0\leqslant r\leqslant 15$。（这里的 $s$ 指的是炮塔的总数）。


---

---
title: "[ZJOI2008] Risk"
layout: "post"
diff: 省选/NOI-
pid: P2588
tag: ['动态规划 DP', '计算几何', '2008', '各省省选', '浙江']
---
# [ZJOI2008] Risk
## 题目描述

经过连续若干年的推广，Risk这个游戏已经风靡全国，成为大众喜闻乐见的重要娱乐方式。Risk这个游戏可以理解为一种简易的策略游戏，游戏者的目的是占领所有的土地。由于游戏规则的规定，只要两个国家相邻，就认为两个国家有交战的可能性。我们现在希望知道在当前的局面下，哪些国家之间有交战的可能性。注意，我们认为只有当两个国家的国界线有公共边的时候才认为相邻，若两个国家的领土只有公共点，则认为两个国家不相邻。

每一个国家的边界由一系列线段组成，保证这个边界是一个简单多边形，即严格不自交。为了定位每个国家的位置，我们还给出每个国家最庞大的一支军队的位置，保证这个位置一定出现在某一个形内，而不是出现在某条边界上。

## 输入格式

输入文件的第一行中包括两个整数n,m。分别表示地图上的国家数和描述国家的边界的线段的数量。1<=n<=600，1<=m<=4000。接下来n行，每行用一对数描述了某个国家的主力军队的坐标。接下来m行，每行有4个数x1,y1,x2,y2，（x1,y1）-(x2,y2)描述了一条国界线。所有点的坐标都是0-10000之间的整数。

保证输入的所有线段至多只会在线段交点处相交。整张地图上有且仅有一块面积无限的空白区域不属于任何国家。每一条国界线两侧的区域或者隶属于两个不同的国家，或者分隔了一个国家与那块无穷大的空白区域。即保证一条国界线两侧的区域不同时属于同一个国家或是同时都是空白区域。所有封闭区域内部包含且仅包含一支主力军队，表示了该区域的归属。

 ![](https://cdn.luogu.com.cn/upload/pic/1707.png) 

例如上图中第一行的数据是合法的。而第二行中的数据都是不合法的。左边的那幅图包含线段两侧都是空白区域；中间的图包含线段两侧区域同时属于同一个国家；右边的图中军队被布置在了国界线上，因此非法；此外若最右侧的图中若没有军队也是非法的。保证输入文件提供的数据都是合法的，你的程序不需要进行数据合法性的判定。

## 输出格式

输出文件包括n行，每行第一个数字x表示有x个国家可能与这个国家交战，接着在同一行中升序输出x个整数，表示可能与这个国家交战的国家的编号。国家按输入中给出的顺序从1到n编号。注意数字间严格以一个空格隔开，并且不要在行末输出多余的空白字符。

## 样例

### 样例输入 #1
```
4 12

3 2

11 8

12 17

1 19

0 0 10 0

10 0 20 0

20 0 20 10

20 10 20 20

20 20 10 20

10 20 0 20

0 20 0 10

0 10 0 0

10 0 10 10

0 10 10 10

20 10 10 10

10 20 10 10


```
### 样例输出 #1
```
2 2 4

2 1 3

2 2 4

2 1 3


```
### 样例输入 #2
```
4 16

170 13

24 88

152 49

110 130

60 60 140 60

140 60 140 140

140 140 60 140

60 140 60 60

0 0 200 0

200 0 200 200

200 200 0 200

0 200 0 0

40 40 160 40

160 40 160 160

160 160 40 160

40 160 40 40

20 20 180 20

180 20 180 180

180 180 20 180

20 180 20 20


```
### 样例输出 #2
```
1 2

2 1 3

2 2 4

1 3


```


---

---
title: "[ZJOI2009] 染色游戏"
layout: "post"
diff: 省选/NOI-
pid: P2594
tag: ['递推', '博弈论', '2009', '各省省选', '浙江', '素数判断,质数,筛法', 'SG 函数']
---
# [ZJOI2009] 染色游戏
## 题目描述

一共n × m 个硬币，摆成n × m 的长方形。dongdong 和xixi 玩一个游戏， 每次可以选择一个连通块，并把其中的硬币全部翻转，但是需要满足存在一个 硬币属于这个连通块并且所有其他硬币都在它的左上方(可以正左方也可以正 上方)，并且这个硬币是从反面向上翻成正面向上。dongdong 和xixi 轮流操作。 如果某一方无法操作，那么他(她) 就输了。dongdong 先进行第一步操作，假 设双方都采用最优策略。问dongdong 是否有必胜策略。

## 输入格式

第一行一个数T，表示他们一共玩T 局游戏。接下来是T 组游戏描述。每 组游戏第一行两个数n;m，接下来n 行每行m 个字符，第i 行第j 个字符如 果是“H” 表示第i 行第j 列的硬币是正面向上，否则是反面向上。第i 行j 列 的左上方是指行不超过i 并且列不超过j 的区域。

## 输出格式

对于每局游戏，输出一行。如果dongdong 存在必胜策略则输出“-\_-”(不含 引号) 否则输出“=\_=”(不含引号)。(注意输出的都是半角符号，即三个符号 ASCII 码分别为45,61,95)

## 样例

### 样例输入 #1
```
3
2 3
HHH
HHH
2 3
HHH
TTH
2 1
T
H
```
### 样例输出 #1
```
=_=
-_-
-_-
```
## 提示

对于40% 的数据，满足1 ≤ n;m ≤ 5。

对于100% 的数据，满足1 ≤ n;m ≤ 100，1 ≤ T ≤ 50。



---

---
title: "[ZJOI2006] 书架"
layout: "post"
diff: 省选/NOI-
pid: P2596
tag: ['2006', '各省省选', '平衡树', '浙江']
---
# [ZJOI2006] 书架
## 题目描述

小 T 有一个很大的书柜。这个书柜的构造有些独特，即书柜里的书是从上至下堆放成一列。她用 $1$ 到 $n$ 的正整数给每本书都编了号。

小 T 在看书的时候，每次取出一本书，看完后放回书柜然后再拿下一本。由于这些书太有吸引力了，所以她看完后常常会忘记原来是放在书柜的什么位置。不过小 T 的记忆力是非常好的，所以每次放书的时候至少能够将那本书放在拿出来时的位置附近，比如说她拿的时候这本书上面有 $x$ 本书，那么放回去时这本书上面就只可能有 $x-1$、$x$ 或 $x+1$ 本书。

当然也有特殊情况，比如在看书的时候突然电话响了或者有朋友来访。这时候粗心的小 T 会随手把书放在书柜里所有书的最上面或者最下面，然后转身离开。

久而久之，小 T 的书柜里的书的顺序就会越来越乱，找到特定的编号的书就变得越来越困难。于是她想请你帮她编写一个图书管理程序，处理她看书时的一些操作，以及回答她的两个提问：
- 编号为 $x$ 的书在书柜的什么位置。
- 从上到下第 $i$ 本书的编号是多少。

## 输入格式

第一行有两个整数，分别表示书的个数 $n$ 以及命令条数 $m$。

第二行有 $n$ 个整数，第 $i$ 个整数表示初始时从上向下书第 $i$ 本书的编号 $p_i$。

接下来 $m$ 行，每行表示一个操作。每行初始时有一个字符串  $op$。

- 若 $op$ 为 `Top`，则后有一个整数 $s$，表示把编号为 $s$ 的书放在最上面。
- 若 $op$ 为 `Bottom`，则后有一个整数 $s$，表示把编号为 $s$ 的书放在最下面。
- 若 $op$ 为 `Insert`，则后有两个整数 $s, t$，表示若编号为 $s$ 的书上面有 $x$ 本书，则放回这本书时他的上面有 $x + t$ 本书。
- 若 $op$ 为 `Ask`，则后面有一个整数 $s$，表示询问编号为 $s$ 的书上面有几本书。
- 若 $op$ 为 `Query`，则后面有一个整数 $s$，询问从上面起第 $s$ 本书的编号。
## 输出格式

对于每次查询，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
10 10
1 3 2 7 5 8 10 4 9 6
Query 3
Top 5
Ask 6
Bottom 3
Ask 3
Top 6
Insert 4 -1
Query 5
Query 2
Ask 2

```
### 样例输出 #1
```
2
9
9
7
5
3
```
## 提示

### 数据规模与约定

对于 $100\%$ 的数据，保证：
- $3 \leq n, m \leq 8 \times 10^4$。
- $p_i$ 是一个 $1 \sim n$ 的排列。
- $1 \leq s \leq n$，$-1 \leq t \leq 1$，$op$ 只可能是输入的五种字符串之一。
- 当编号为 $s$ 的书上面没有书的时候，不会对它进行 `Insert s -1` 操作。
- 当编号为 $s$ 的书下面没有书的时候，不会对它进行 `Insert s 1` 操作。


---

---
title: "[ZJOI2012] 灾难"
layout: "post"
diff: 省选/NOI-
pid: P2597
tag: ['2012', '倍增', '各省省选', '浙江', 'O2优化', '拓扑排序', '最近公共祖先 LCA']
---
# [ZJOI2012] 灾难
## 题目背景

阿米巴是小强的好朋友。

阿米巴和小强在草原上捉蚂蚱。小强突然想，如果蚂蚱被他们捉灭绝了，那么吃蚂蚱的小鸟就会饿死，而捕食小鸟的猛禽也会跟着灭绝，从而引发一系列的生态灾难。

学过生物的阿米巴告诉小强，草原是一个极其稳定的生态系统。如果蚂蚱灭绝了，小鸟照样可以吃别的虫子，所以一个物种的灭绝并不一定会引发重大的灾难。
## 题目描述

我们现在从专业一点的角度来看这个问题。我们用一种叫做食物网的有向图来描述生物之间的关系：

- 一个食物网有 $n$ 个点，代表 $n$ 种生物，生物从 $1$ 到 $n$ 编号。
- 如果生物 $x$ 可以吃生物 $y$，那么从 $y$ 向 $x$ 连一个有向边。
- 这个图没有环。
- 图中有一些点没有连出边，这些点代表的生物都是生产者，可以通过光合作用来生存。
- 而有连出边的点代表的都是消费者，它们必须通过吃其他生物来生存。
- 如果某个消费者的所有食物都灭绝了，它会跟着灭绝。

我们定义一个生物在食物网中的“灾难值”为，如果它突然灭绝，那么会跟着一起灭绝的生物的种数。

举个例子：在一个草场上，生物之间的关系如下

![](https://cdn.luogu.com.cn/upload/image_hosting/oiw4lh97.png)

如果小强和阿米巴把草原上所有的羊都给吓死了，那么狼会因为没有食物而灭绝，而小强和阿米巴可以通过吃牛、牛可以通过吃草来生存下去。所以，羊的灾难值是 $1$。但是，如果草突然灭绝，那么整个草原上的 $5$ 种生物都无法幸免，所以，草的灾难值是 $4$。

给定一个食物网，你要求出每个生物的灾难值。
## 输入格式

第一行有一个整数，表示食物网的结点个数 $n$。

第 $2$ 到第 $(n + 1)$ 行，每行若干个互不相同的整数，第 $(i + 1)$ 行的整数 $a_{i, j}$ 表示编号为 $i$ 的生物可以吃编号为 $a_{i, j}$ 的生物。每行结尾有一个整数 $0$ 表示本行结束。
## 输出格式

输出 $n$ 行，每行一个整数，第 $i$ 行输出编号为 $i$ 的生物的灾难值。
## 样例

### 样例输入 #1
```
5
0
1 0
1 0
2 3 0
2 0

```
### 样例输出 #1
```
4
1
0
0
0
```
## 提示

### 样例 1 解释

样例输入描述了题目描述中举的例子。

### 数据规模与约定

- 对于 $50\%$ 的数据，保证 $n \leq 10^4$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 65534$，$1 \leq a_{i, j} \leq n$，输入的文件大小不超过 1 MB，且图上不存在环。


---

---
title: "[ZJOI2009] 取石子游戏"
layout: "post"
diff: 省选/NOI-
pid: P2599
tag: ['数学', '博弈论', '2009', '各省省选', '浙江']
---
# [ZJOI2009] 取石子游戏
## 题目描述

在研究过 Nim 游戏及各种变种之后，Orez 又发现了一种全新的取石子游戏，这个游戏是这样的：

有 $n$ 堆石子，将这 $n$ 堆石子摆成一排。游戏由两个人进行，两人轮流操作，每次操作者都可以从最左或最右的一堆中取出若干颗石子，可以将那一堆全部取掉，但不能不取，不能操作的人就输了。

Orez 问：对于任意给出一个初始一个局面，是否存在先手必胜策略。
## 输入格式

文件的第一行为一个整数 $T$，表示有 $T$ 组测试数据。对于每组测试数据：

第一行为一个整数 $n$，表示有 $n$ 堆石子。

第二行为 $n$ 个整数 $a_1, a_2, \ldots , a_n$，依次表示每堆石子的数目。
## 输出格式

对于每组测试数据仅输出一个整数 $0$ 或 $1$。其中 $1$ 表示有先手必胜策略，$0$ 表示没有。
## 样例

### 样例输入 #1
```
1
4
3 1 9 4

```
### 样例输出 #1
```
0

```
## 提示

对于 $30 \%$ 的数据，$n \le 5$，$a_i \le {10}^5$。  
对于 $100 \%$ 的数据，$1 \le T \le 10$，$1 \le n \le 1000$，$1 \le a_i \le {10}^9$。


---

---
title: "[ZJOI2008] 瞭望塔"
layout: "post"
diff: 省选/NOI-
pid: P2600
tag: ['计算几何', '2008', '各省省选', '浙江', '半平面交']
---
# [ZJOI2008] 瞭望塔
## 题目描述

致力于建设全国示范和谐小村庄的H村村长dadzhi，决定在村中建立一个瞭望塔，以此加强村中的治安。

我们将H村抽象为一维的轮廓。如下图所示

 
 ![](https://cdn.luogu.com.cn/upload/pic/1710.png) 

我们可以用一条山的上方轮廓折线(x1, y1), (x2, y2), …. (xn, yn)来描述H村的形状，这里x1 < x2 < …< xn。瞭望塔可以建造在[x1, xn]间的任意位置, 但必须满足从瞭望塔的顶端可以看到H村的任意位置。可见在不同的位置建造瞭望塔，所需要建造的高度是不同的。为了节省开支，dadzhi村长希望建造的塔高度尽可能小。

请你写一个程序，帮助dadzhi村长计算塔的最小高度。

## 输入格式

输入文件tower.in第一行包含一个整数n，表示轮廓折线的节点数目。接下来第一行n个整数, 为x1 ~ xn. 第三行n个整数，为y1 ~ yn。

## 输出格式

输出文件tower.out仅包含一个实数，为塔的最小高度，精确到小数点后三位。

## 样例

### 样例输入 #1
```
6

1 2 4 5 6 7

1 2 2 4 2 1


```
### 样例输出 #1
```
1.000
```
## 提示

对于60%的数据， N ≤ 60；

对于100%的数据， N ≤ 300，输入坐标绝对值不超过106，注意考虑实数误差带来的问题。



---

---
title: "[ZJOI2009] 对称的正方形"
layout: "post"
diff: 省选/NOI-
pid: P2601
tag: ['2009', '二分', '各省省选', '浙江', '哈希 hashing']
---
# [ZJOI2009] 对称的正方形
## 题目描述

Orez 很喜欢搜集一些神秘的数据，并经常把它们排成一个矩阵进行研究。最近，Orez 又得到了一些数据，并已经把它们排成了一个 $n$ 行 $m$ 列的矩阵。通过观察，Orez 发现这些数据蕴涵了一个奇特的数，就是矩阵中上下对称且左右对称的正方形子矩阵的个数。Orez 自然很想知道这个数是多少，可是矩阵太大，无法去数。只能请你编个程序来计算出这个数。

## 输入格式

文件的第一行为两个整数 $n$ 和 $m$。接下来 $n$ 行每行包含 $m$ 个正整数，表示 Orez 得到的矩阵。

## 输出格式

文件中仅包含一个整数 $ans$，表示矩阵中有 $ans$ 个上下左右对称的正方形子矩阵。

## 样例

### 样例输入 #1
```
5 5

4 2 4 4 4 

3 1 4 4 3 

3 5 3 3 3 

3 1 5 3 3 

4 2 1 2 4 
```
### 样例输出 #1
```
27
```
## 提示

- 对于 $30\%$ 的数据 $1\le n,m\le 100$；
- 对于 $100\%$ 的数据 $1\le n,m\le 1000$，矩阵中的数的大小不超过 $10^9$。



---

---
title: "[ZJOI2008] 无序运动"
layout: "post"
diff: 省选/NOI-
pid: P2603
tag: ['2008', '各省省选', '浙江', '向量', 'AC 自动机']
---
# [ZJOI2008] 无序运动
## 题目描述

D 博士对物理有着深入的研究，经典物理、天体物理、量子物理都有着以他的名字命名的定理。最近 D 博士着迷于研究粒子运动的无规则性。对圣经深信不疑的他相信，上帝创造的任何事物必然是有序的、有理可循的，而不是无规则的、混沌的。

经过长时间的研究，D 博士找到了很多出现相当频繁的轨迹片断，他把这些轨迹片断储存在一个很大的数据库内。他需要你帮助他写一个程序，对于一个给出的粒子运动轨迹，统计数据库中每个轨迹片断的出现的次数。

为清楚起见，我们定义一个粒子的轨迹为二维平面上的一个点列 $(P_1, P_2, \dots, P_N)$。点列 $P$ 的一个子列 $[i, j]$ 定义为 $P$ 中一段连续的子序列 $(P_i, P_{i + 1}, \dots, P_j)$。点列 $P$ 的一个子列 $[u, v]$ 被称为点列 $Q = (Q_1, Q_2, \dots, Q_{v - u + 1})$ 在 $P$ 中的一次出现，当且仅当 $Q$ 经过有限次的平移、旋转、翻转、放缩之后得到 $Q'$ 满足 $\forall 1 \le k \le u - v + 1$，$ Q'_k = P_{u + k - 1}$。

对点列进行四种操作的解释：
|操作名称|解释|
|:-:|:-:|
|平移|设平移向量为 $(d_x, d_y)$，则任意点 $(x, y)$ 平移后的结果为 $(x + d_x, y + d_y)$|
|旋转|设旋转角为 $t$，则任意点 $(x, y)$ 旋转后的结果为 $(x \cos t - y \sin t, x \sin t + y \cos t)$|
|翻转|任意点 $(x, y)$ 翻转后的结果为 $(x, -y)$
|放缩|设放缩比例为 $p(p \ne 0)$，则任意点 $(x, y)$ 放缩后的结果为 $(px, py)$|
## 输入格式

第一行两个整数 $N, M$，分别描述待处理的粒子运动轨迹的点列大小与数据库内的轨迹片断个数。

接下来 $M$ 行依次给出每个轨迹片断。每行先是一个正整数 $K$，表示该轨迹片断点列的长度。然后 $2K$ 个整数，依次描述点列中的 $K$ 个点的横坐标与纵坐标。

接下来一行 $2N$ 个整数，依次描述待处理的粒子运动轨迹的点列中 $N$ 个点的横坐标与纵坐标。

注：输入中的每条轨迹中任意相邻两点不会相同。
## 输出格式

应包含 $M$ 行，依次给出每个片段在待处理运动轨迹中的出现次数。
## 样例

### 样例输入 #1
```
3 2
2 17 0 10 1
3 0 0 1 0 1 -1
0 0 1 0 1 1

```
### 样例输出 #1
```
2
1

```
## 提示

记片段总长度为 $L$。

对于 $30\%$ 的测试数据，满足 $N, M, K \le 100$，$L \le 500$;

对于 $50\%$ 的测试数据，满足 $N, M, K \le 1000$，$L \le 5000$;

对于 $100\%$ 的测试数据，满足 $N, K \le 2 \times 10 ^ 5$，$L \le 2 \times 10 ^ 6$，保证输入中给出所有点坐标绝对值均不大于 $10 ^ 4$。


---

---
title: "[ZJOI2010] 网络扩容"
layout: "post"
diff: 省选/NOI-
pid: P2604
tag: ['2010', '各省省选', '网络流', '浙江', '图论建模', '费用流']
---
# [ZJOI2010] 网络扩容
## 题目描述

给定一张有向图，每条边都有一个容量 $c$ 和一个扩容费用 $w$。这里扩容费用是指将容量扩大 $1$ 所需的费用。求： 

1. 在不扩容的情况下，$1$ 到 $n$ 的最大流；

2. 将 $1$ 到 $n$ 的最大流增加 $k$ 所需的最小扩容费用。
## 输入格式

第一行包含三个整数 $n,m,k$，表示有向图的点数、边数以及所需要增加的流量。

接下来的 $M$ 行每行包含四个整数 $u,v,c,w$，表示一条从$u$ 到 $v$，容量为 $c$，扩容费用为 $w$ 的边。
## 输出格式

输出文件一行包含两个整数，分别表示问题 $1$ 和问题 $2$ 的答案。
## 样例

### 样例输入 #1
```
5 8 2
1 2 5 8
2 5 9 9
5 1 6 2
5 1 1 8
1 2 8 7
2 5 4 9
1 2 1 1
1 4 2 1
```
### 样例输出 #1
```
13 19

```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n\le 100$。
- 对于 $100\%$ 的数据，保证 $1\le n\le 10^3$，$1\le m\le 5\times 10^3$，$1\le k\le 10$，$1 \leq u, v \leq n$，$1\le c,w\le 100$。


---

---
title: "[ZJOI2010] 基站选址"
layout: "post"
diff: 省选/NOI-
pid: P2605
tag: ['动态规划 DP', '2010', '线段树', '各省省选', '浙江']
---
# [ZJOI2010] 基站选址
## 题目描述

有 $N$ 个村庄坐落在一条直线上，第 $i(i>1)$ 个村庄距离第 $1$ 个村庄的距离为 $D_i$。需要在这些村庄中建立不超过 $K$ 个通讯基站，在第 $i$ 个村庄建立基站的费用为 $C_i$。如果在距离第 $i$ 个村庄不超过 $S_i$ 的范围内建立了一个通讯基站，那么就村庄被基站覆盖了。如果第 $i$ 个村庄没有被覆盖，则需要向他们补偿，费用为 $W_i$。现在的问题是，选择基站的位置，使得总费用最小。

## 输入格式

输入文件的第一行包含两个整数 $N,K$，含义如上所述。

第二行包含 $N-1$ 个整数，分别表示 $D_2,D_3,\cdots,D_N$ ，这 $N-1$ 个数是递增的。

第三行包含 $N$ 个整数，表示 $C_1,C_2,\cdots,C_N$。

第四行包含 $N$ 个整数，表示 $S_1,S_2,\cdots,S_N$。

第五行包含 $N$ 个整数，表示 $W_1,W_2,\cdots,W_N$。

## 输出格式

输出文件中仅包含一个整数，表示最小的总费用。

## 样例

### 样例输入 #1
```
3 2
1 2
2 3 2
1 1 0
10 20 30
```
### 样例输出 #1
```
4
```
## 提示

### 数据规模与约定

$30\%$ 的数据中，$N \leq 500$；

$100\%$ 的数据中，$K\leq N$，$K\leq 100$，$N\leq 2\times 10^4$，$D_i \leq 10^9$，$C_i\leq 10^4$，$S_i \leq10^9$，$W_i \leq 10^4$。



---

---
title: "[ZJOI2012] 数列"
layout: "post"
diff: 省选/NOI-
pid: P2609
tag: ['数学', '高精度', '2012', '各省省选', '递归', '浙江']
---
# [ZJOI2012] 数列
## 题目描述

小白和小蓝在一起上数学课，下课后老师留了一道作业，求下面这个数列的通项公式：

$$a_0=0,a_1=1,a_{2i}=a_i,a_{2i+1}=a_i+a_{i+1}$$

小白作为一个数学爱好者，很快就计算出了这个数列的通项公式。于是，小白告诉小蓝自己已经做出来了，但为了防止小蓝抄作业，小白并不想把公式公布出来。于是小白为了向小蓝证明自己的确做出来了此题以达到其炫耀的目的，想出了一个绝妙的方法：即让小蓝说一个正整数 $n$，小白则说出 $a_n$ 的值，如果当 $n$ 很大时小白仍能很快的说出正确答案，这就说明小白的确得到了公式。但这个方法有一个很大的漏洞：小蓝自己不会做，没法验证小白的答案是否正确。作为小蓝的好友，你能帮帮小蓝吗？
## 输入格式

输入文件第一行有且只有一个正整数 $T$，表示测试数据的组数。

接下来 $T$ 行，每行一个整数 $n$。
## 输出格式

对于每组数据：输出一行一个整数代表 $a_n$。
## 样例

### 样例输入 #1
```
3
1
3
10

```
### 样例输出 #1
```
1
2
3

```
## 提示

- 对于 $20\%$ 的数据，$1 \le n \le 10^8$。 
- 对于 $50\%$ 的数据，$1 \le n \le 10^{12}$。
- 对于 $100\%$ 的数据，$1 \le T \le 20$，$1 \le n \le 10^{100}$。


---

---
title: "[ZJOI2012] 小蓝的好友"
layout: "post"
diff: 省选/NOI-
pid: P2611
tag: ['2012', '各省省选', '平衡树', '浙江', '深度优先搜索 DFS', '栈']
---
# [ZJOI2012] 小蓝的好友
## 题目背景

终于到达了这次选拔赛的最后一题，想必你已经厌倦了小蓝和小白的故事。

为了回馈各位比赛选手，此题的主角是贯穿这次比赛的关键人物——小蓝的好友。

在帮小蓝确定了旅游路线后，小蓝的好友也不会浪费这个难得的暑假。

与小蓝不同，小蓝的好友并不想将时间花在旅游上，而是盯上了最近发行的即时战略游戏——SangoCraft。

但在前往通关之路的道路上，一个小游戏挡住了小蓝的好友的步伐。
## 题目描述


“国家的战争其本质是抢夺资源的战争”是整款游戏的核心理念，这个小游戏也不例外。

简单来说，用户需要在一块 $R\times C$ 的长方形土地上选出一块子矩形。

而系统随机生成了 $N$ 个资源点，第 $i$ 个资源点的坐标为 $(x_i,y_i)$。

位于用户所选的长方形土地上的资源点越多，给予用户的奖励也越多。

悲剧的是，小蓝的好友虽然拥有着极其优秀的能力，但同时也有着极差的 RP，小蓝的好友所选的区域总是没有一个资源点。

终于有一天，小蓝的好友决定投诉这款游戏的制造厂商，为了搜集证据，小蓝的好友想算出至少包含一个资源点的区域的数量。

具体的说，你需要计算有多少个四元组 $(LB,DB,RB,UB)$ 满足 $1\le LB\le RB\le R,1\le DB\le UB\le C$ ，且存在一个 $i$ 使得 $LB\le x_i\le RB,DB\le y_i\le UB$ 均成立。

作为小蓝的好友，这自然是你分内之事。
## 输入格式

第一行三个正整数 $R,C,N$。

接下来有 $N$ 行，每行包含两个整数 $x_i,y_i$，表示第 $i$ 个资源点的坐标。
## 输出格式

一行一个整数，表示至少包含一个资源点的区域的数量。
## 样例

### 样例输入 #1
```
5 5 4
1 2
2 3
3 5
4 1

```
### 样例输出 #1
```
139
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，$N\le 50$。
- 对于 $40\%$ 的数据，$N\le 2\times 10^3$。
- 对于 $100\%$ 的数据，$1\le R,C\le 4\times 10^4$，$1\le N\le 10^5$，题目保证资源点的位置两两不同，且位置为随机生成。


---

---
title: "[HNOI2008] 明明的烦恼"
layout: "post"
diff: 省选/NOI-
pid: P2624
tag: ['2008', '各省省选', '湖南']
---
# [HNOI2008] 明明的烦恼
## 题目背景

原 编译优化 参见P1792
## 题目描述

自从明明学了树的结构,就对奇怪的树产生了兴趣...... 
给出标号为1到N的点,以及某些点最终的度数,允许在任意两点间连线,可产生多少棵度数满足要求的树?
## 输入格式

第一行为N(0<N<=1000),接下来N行,第i+1行给出第i个节点的度数Di,如果对度数不要求,则输入-1
## 输出格式

一个整数,表示不同的满足要求的树的个数,无解输出0
## 样例

### 样例输入 #1
```
3
1
-1
-1
```
### 样例输出 #1
```
2
```
## 提示

两棵树分别为1-2-3;1-3-2




---

---
title: "[TJOI2012] 桥"
layout: "post"
diff: 省选/NOI-
pid: P2685
tag: ['2012', '各省省选', '天津']
---
# [TJOI2012] 桥
## 题目描述

有 $n$ 个岛屿，$m$ 座桥，每座桥连通两座岛屿，桥上会有一些敌人，玩家只有消灭了桥上的敌人才能通过，与此同时桥上的敌人会对玩家造成一定伤害。而且会有一个大 Boss 镇守一座桥，以玩家目前的能力，是不可能通过的。而 Boss 是邪恶的， Boss 会镇守某一座使得玩家受到最多的伤害才能从岛屿 $1$ 到达岛屿 $n$（当然玩家会选择伤害最小的路径）。问，Boss 可能镇守的桥有哪些。

注意可以有**重边**和**自环**。
## 输入格式

第一行两个整数 $n,m$。

接下来 $m$ 行，每行三个整数 $s,t,c$，表示一座连接岛屿 $s$ 和 $t$ 的桥上的敌人会对玩家造成 $c$ 的伤害。

## 输出格式

一行，两个整数 $d,cnt$，$d$ 表示有 Boss 的情况下，玩家至少要受到的伤害，$cnt$ 表示 Boss 可能镇守的桥的数目。

## 样例

### 样例输入 #1
```
3 4
1 2 1
1 2 2
2 3 1
2 3 2
```
### 样例输出 #1
```
3 2
```
## 提示

- $30\%$ 的数据，$1 ≤ n ≤ 1000$；
- $100\%$ 的数据，$1 ≤ n ≤ 100000, 1 ≤ m ≤ 200000, 1 ≤ c ≤ 10000$；
- 数据保证玩家可以从岛屿 $1$ 到达岛屿 $n$。



---

---
title: "[SHOI2005] 树的双中心"
layout: "post"
diff: 省选/NOI-
pid: P2726
tag: ['2005', '各省省选', '上海']
---
# [SHOI2005] 树的双中心
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/15902.png)
## 输入格式

第一行为N，1<N<=50000,表示树的节点数目，树的节点从1到N编号。
接下来N-1行，每行两个整数U，V，表示U与V之间有一条边。
再接下N行，每行一个正整数，其中第i行的正整数表示编号为i的节点权值为W(I),树的深度<=100
## 输出格式

将最小的S（x,y)输出到median.out，结果保证不超过$10^9$
## 样例

### 样例输入 #1
```
5
1 2
1 3
3 4
3 5
5
7
6
5
4
```
### 样例输出 #1
```
14
```
## 提示

选取的两个中心节点分别为2和3


---

---
title: "[JSOI2008] 小店购物"
layout: "post"
diff: 省选/NOI-
pid: P2792
tag: ['图论', '2008', '各省省选', '江苏', '生成树']
---
# [JSOI2008] 小店购物
## 题目背景

JSOI集训队的队员发现，在他们经常活动的集训地，有一个小店因为其丰富的经营优惠方案深受附近居民的青睐，生意红火。

## 题目描述

小店的优惠方案十分简单有趣：

一次消费过程中，如您在本店购买了精制油的话，您购买香皂时就可以享受 $2.00$ 元 / 块的优惠价；如果您在本店购买了香皂的话，您购买可乐时就可以享受 $1.50$ 元 / 听的优惠价……诸如此类的优惠方案可概括为：如果您在本店购买了商品 $A$ 的话，您就可以以 $P$ 元 / 件的优惠价格购买商品 $B$（购买的数量不限）。

有趣的是，你需要购买同样一些商品，由于不同的买卖顺序，老板可能会叫你付不同数量的钱。比如你需要一块香皂（原价 $2.50$ 元）、一瓶精制油（原价 $10.00$ 元）、一听可乐（原价 $1.80$ 元），如果你按照可乐、精制油、香皂这样的顺序购买的话，老板会问你要 $13.80$ 元；而如果你按照精制油、香皂、可乐这样的顺序购买的话，您只需付 $13.50$ 元。

该处居民发现 JSOI 集训队的队员均擅长电脑程序设计，于是他们请集训队的队员编写一个程序：在告诉你该小店商品的原价，所有优惠方案及所需的商品后，计算至少需要花多少钱（不允许购买任何不必要的商品，即使这样做可能使花的钱更少）。
## 输入格式

输入文件第一行为一个整数 $n\ (1 \le n \le 50)$，表示小店的商品总数。

接下来是 $n$ 行，其中第 $i+1$ 行由一个实数 $c_i\ (0<c_i \le 1000)$ 和一个整数 $m_i\ (0 \le m_i \le 100)$ 组成，其间由一个空格分隔，分别表示第 $i$ 种商品的原价和所需数量。第 $n+2$ 行又是一个整数 $k\ (1 \le k \le 500)$，表示小店的优惠方案总数。

接着 $k$ 行，每行有二个整数 $A,B(1 \le A,B \le n)$ 和一个实数 $P(0 \le P<1000)$，表示一种优惠方案，即如果您购买了商品 $A$，您就可以以 $P$ 元 / 件的优惠价格购买商品 $B$，$P$ 小于商品 $B$ 的原价。所有优惠方案的 $(A,B)$ 都是不同的。为了方便老板不收分币，所以所有价格都不出现单位分。
## 输出格式

输出只有一个实数，表示最少需要花多少钱。输出实数须保留两位小数。

## 样例

### 样例输入 #1
```
4
10.00 1
1.80 1
3.00 0
2.50 2
2
1 4 2.00
4 2 1.50
```
### 样例输出 #1
```
15.50
```
## 提示

数据范围见输入格式



---

---
title: "[HEOI2016/TJOI2016] 排序"
layout: "post"
diff: 省选/NOI-
pid: P2824
tag: ['2016', '线段树', '二分', '各省省选', '河北', '排序']
---
# [HEOI2016/TJOI2016] 排序
## 题目描述

在 $2016$ 年，佳媛姐姐喜欢上了数字序列。因而她经常研究关于序列的一些奇奇怪怪的问题，现在她在研究一个难题，需要你来帮助她。  

这个难题是这样子的：给出一个 $1$ 到 $n$ 的排列，现在对这个排列序列进行 $m$ 次局部排序，排序分为两种：  

- `0 l r` 表示将区间 $[l,r]$ 的数字升序排序  
- `1 l r` 表示将区间 $[l,r]$ 的数字降序排序  

注意，这里是对**下标**在区间 $[l,r]$ 内的数排序。  
最后询问第 $q$ 位置上的数字。

## 输入格式

输入数据的第一行为两个整数 $n$ 和 $m$，$n$ 表示序列的长度，$m$ 表示局部排序的次数。  

第二行为 $n$ 个整数，表示 $1$ 到 $n$ 的一个排列。  

接下来输入 $m$ 行，每一行有三个整数 $\text{op},l,r$，$\text{op}$ 为 $0$ 代表升序排序，$\text{op}$ 为 $1$ 代表降序排序, $l,r$ 表示排序的区间。  

最后输入一个整数 $q$，表示排序完之后询问的位置

## 输出格式

输出数据仅有一行，一个整数，表示按照顺序将全部的部分排序结束后第 $q$ 位置上的数字。

## 样例

### 样例输入 #1
```
6 3
1 6 2 5 3 4
0 1 4
1 3 6
0 2 4
3
```
### 样例输出 #1
```
5
```
## 提示

河北省选2016第一天第二题。

对于 $30\%$ 的数据，$n,m\leq 1000$

对于 $100\%$ 的数据，$n,m\leq 10^5$，$1\leq q\leq n$


---

---
title: "[HEOI2016/TJOI2016] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P2825
tag: ['2016', '各省省选', '网络流', '河北', '连通块', '二分图', '天津']
---
# [HEOI2016/TJOI2016] 游戏
## 题目描述

在 2016 年，佳媛姐姐喜欢上了一款游戏，叫做泡泡堂。

简单的说，这个游戏就是在一张地图上放上若干个炸弹，看是否能炸到对手，或者躲开对手的炸弹。在玩游戏的过程中，小 H 想到了这样一个问题：当给定一张地图，在这张地图上最多能放上多少个炸弹能使得任意两个炸弹之间不会互相炸到。炸弹能炸到的范围是该炸弹所在的一行和一列，炸弹的威力可以穿透软石头，但是不能穿透硬石头。

给定一张 $ n \times m $ 的网格地图:其中 ``*`` 代表空地，炸弹的威力可以穿透，可以在空地上放置一枚炸弹。 ``x`` 代表软石头，炸弹的威力可以穿透，不能在此放置炸弹。``#`` 代表硬石头，炸弹的威力是不能穿透的，不能在此放置炸弹。例如：给出 $ 1 \times 4 $ 的网格地图 `` *xx*``，这个地图上最多只能放置一个炸弹。给出另一个$ 1 \times 4 $ 的网格地图 ``*x#*``，这个地图最多能放置两个炸弹。

现在小 H 任意给出一张 $ n \times m $ 的网格地图，问你最多能放置多少炸弹。
## 输入格式

第一行输入两个正整数 $ n, m $，$ n $ 表示地图的行数，$ m $ 表示地图的列数。

接下来输入 $ n $ 行 $ m $ 列个字符，代表网格地图。``*``的个数不超过 $ n \times m $ 个。
## 输出格式

输出一个整数 $ a $，表示最多能放置炸弹的个数。
## 样例

### 样例输入 #1
```
4 4
#***
*#**
**#*
xxx#
```
### 样例输出 #1
```
5
```
## 提示

$1 \leq n,m \leq 50$


---

---
title: "[FJOI2014] 最短路径树问题"
layout: "post"
diff: 省选/NOI-
pid: P2993
tag: ['2014', '各省省选', '福建']
---
# [FJOI2014] 最短路径树问题
## 题目描述

给一个包含 $n$ 个点，$m$ 条边的无向连通图。从顶点 $1$ 出发，往其余所有点分别走一次并返回。

往某一个点走时，选择总长度最短的路径走。若有多条长度最短的路径，则选择经过的顶点序列字典序最小的那条路径（如路径 A 为 $1,32,11$，路径 B 为 $1,3,2,11$，路径 B 字典序较小。注意是序列的字典序的最小，而非路径中节点编号相连的字符串字典序最小）。到达该点后按原路返回，然后往其他点走，直到所有点都走过。

可以知道，经过的边会构成一棵最短路径树。请问，在这棵最短路径树上，最长的包含 $K$ 个点的简单路径长度为多长？包含 $K$ 个点的长度为该最长长度的不同路径有多少条？

这里的简单路径是指：对于一个点最多只经过一次的路径。不同路径是指路径两端端点至少有一个不同，点 A 到点 B 的路径和点 B 到点 A 视为同一条路径。
## 输入格式

第一行输入三个正整数 $n,m,K$，表示有 $n$ 个点 $m$ 条边，要求的路径需要经过 $K$ 个点。

接下来输入 $m$ 行，每行三个正整数 $A_i,B_i,C_i(1\leq Ai,Bi\leq n,1\leq C_i \leq 10000)$，表示 $A_i$ 和 $B_i$ 间有一条长度为 $C_i$ 的边。

数据保证输入的是连通的无向图。
## 输出格式

输出一行两个整数，以一个空格隔开，第一个整数表示包含 $K$ 个点的路径最长为多长，第二个整数表示包含 $K$ 个点的长度为该最长长度的不同路径有多少条。
## 样例

### 样例输入 #1
```
6 6 4
1 2 1
2 3 1
3 4 1
2 5 1
3 6 1
5 6 1
```
### 样例输出 #1
```
3 4
```
## 提示

对于所有数据 $n\leq 30000,m\leq 60000，2\leq K\leq n$。

数据保证最短路径树上至少存在一条长度为 $K$ 的路径。


---

---
title: "[CQOI2009] 跳舞"
layout: "post"
diff: 省选/NOI-
pid: P3153
tag: ['贪心', '2009', '重庆', '各省省选', '网络流']
---
# [CQOI2009] 跳舞
## 题目描述

一次舞会有 $n$ 个男孩和 $n$ 个女孩。

每首曲子开始时，所有男孩和女孩恰好配成 $n$ 对跳交谊舞。每个男孩都不会和同一个女孩跳两首（或更多）舞曲。

有一些男孩女孩相互喜欢，而其他相互不喜欢（不会“单向喜欢”）。每个男孩最多只愿意和 $k$ 个不喜欢的女孩跳舞，而每个女孩也最多只愿意和 $k$ 个不喜欢的男孩跳舞。

给出每对男孩女孩是否相互喜欢的信息，舞会最多能有几首舞曲？
## 输入格式

第一行包含两个整数 $n$ 和 $k$。

以下 $n$ 行每行包含 $n$ 个字符，每个字符只可能是 `Y` 或 `N`。第 $(i + 1)$ 行的第 $j$ 个字符为 `Y` 当且仅当男孩 $i$ 和女孩 $j$ 相互喜欢。

## 输出格式

一行一个整数代表舞曲数目的最大值。
## 样例

### 样例输入 #1
```
3 0
YYY
YYY
YYY
```
### 样例输出 #1
```
3
```
## 提示

#### 数据规模与约定

- 对于 $100\%$ 的数据，保证 $1\leq n\leq 50$，$0\leq k\leq 30$。


---

---
title: "[CQOI2011] 动态逆序对"
layout: "post"
diff: 省选/NOI-
pid: P3157
tag: ['2011', '重庆', '各省省选', '树状数组', 'cdq 分治', '可持久化线段树']
---
# [CQOI2011] 动态逆序对
## 题目描述

对于序列 $a$，它的逆序对数定义为集合  
$$\{(i,j)| i<j \wedge a_i > a_j \}$$
中的元素个数。  

现在给出 $1\sim n$ 的一个排列，按照某种顺序依次删除 $m$ 个元素，你的任务是在每次删除一个元素**之前**统计整个序列的逆序对数。

## 输入格式

第一行包含两个整数 $n$ 和 $m$，即初始元素的个数和删除的元素个数。  
以下 $n$ 行，每行包含一个 $1 \sim n$ 之间的正整数，即初始排列。  
接下来 $m$ 行，每行一个正整数，依次为每次删除的元素。

## 输出格式

输出包含 $m$ 行，依次为删除每个元素之前，逆序对的个数。

## 样例

### 样例输入 #1
```
5 4
1
5
3
4
2
5
1
4
2
```
### 样例输出 #1
```
5
2
2
1
```
## 提示

【数据范围】   
对于 $100\%$ 的数据，$1\le n \le 10^5$，$1\le m \le 50000$。

【样例解释】  
删除每个元素之前的序列依次为：  
$$1,5,3,4,2$$  
$$1,3,4,2$$  
$$3,4,2$$  
$$3,2$$  


---

---
title: "[CQOI2011] 放棋子"
layout: "post"
diff: 省选/NOI-
pid: P3158
tag: ['动态规划 DP', '2011', '重庆', '各省省选', '容斥原理', '构造']
---
# [CQOI2011] 放棋子
## 题目描述

在一个 $m$ 行 $n$ 列的棋盘里放一些彩色的棋子，使得每个格子最多放一个棋子，且不同颜色的棋子不能在同一行或者同一列，有多少种方法？

例如，$n=m=3$，有两个白棋子和一个灰棋子，下面左边两种方法都是合法的，但右边两种都是非法的。

![](https://cdn.luogu.com.cn/upload/pic/28150.png)
## 输入格式

输入第一行为两个整数 $n,m,c$，即行数、列数和棋子的颜色数。

第二行包含 $c$ 个正整数，即每个颜色的棋子数。
## 输出格式

输出仅一行，即方案总数除以 $10^9+9$ 的余数。
## 样例

### 样例输入 #1
```
4 2 2
3 1
```
### 样例输出 #1
```
8
```
## 提示

$1\le n,m\le 30$，$1\le c\le 10$，总棋子数 $\le \max (250,n\times m)$。


---

---
title: "[CQOI2012] 交换棋子"
layout: "post"
diff: 省选/NOI-
pid: P3159
tag: ['2012', '重庆', '各省省选', '网络流', '费用流']
---
# [CQOI2012] 交换棋子
## 题目描述

有一个 $n$ 行 $m$ 列的黑白棋盘，你每次可以交换两个相邻格子（**相邻是指有公共边或公共顶点**）中的棋子，最终达到目标状态。要求第 $i$ 行第 $j$ 列的格子只能参与 $m_{i,j}$ 次交换。
## 输入格式

第一行包含两个整数 $n,m$。以下 $n$ 行为初始状态，每行为一个包含 $m$ 个字符的 $01$ 串，其中 $0$ 表示黑色棋子，$1$ 表示白色棋子。以下 $n$ 行为目标状态，格式同初始状态。以下 $n$ 行每行为一个包含 $m$ 个 $0\sim9$ 数字的字符串，表示每个格子参与交换的次数上限。

## 输出格式

输出仅一行，为最小交换总次数。如果无解，输出 $-1$。
## 样例

### 样例输入 #1
```
3 3
110
000
001
000
110
100
222
222
222
```
### 样例输出 #1
```
4
```
## 提示

### 数据规模与约定

对于 $100\%$ 的数据，$1\leq n,m\leq20$。


---

---
title: "[CQOI2012] 局部极小值"
layout: "post"
diff: 省选/NOI-
pid: P3160
tag: ['2012', '重庆', '各省省选', '容斥原理', '状压 DP']
---
# [CQOI2012] 局部极小值
## 题目描述

有一个 $n$ 行 $m$ 列的整数矩阵，其中 $1$ 到 $n\times m$ 之间的每个整数恰好出现一次。

如果一个格子比所有相邻格子（相邻是指有公共边或公共顶点）都小，我们说这个格子是局部极小值。给出所有局部极小值的位置，你的任务是判断有多少个可能的矩阵。

答案对 $12{,}345{,}678$ 取模。
## 输入格式

输入第一行包含两个整数 $n$ 和 $m$，即行数和列数。

以下 $n$ 行每行 $m$ 个字符，第 $(i + 1)$ 行的第 $j$ 个字符代表第 $i$ 列的第 $j$ 个格子是否是局部极小值，该字符只可能是 `X` 或 `.`，其中 `X` 表示局部极小值，`.` 表示非局部极小值。
## 输出格式

输出仅一行，为可能的矩阵总数除以 $12345678$ 的余数。
## 样例

### 样例输入 #1
```
3 2
X.
..
.X
```
### 样例输出 #1
```
60
```
## 提示

#### 数据规模与约定

- 对于 $100\%$ 的数据，保证 $1\le n\le4$，$1\le m\le7$。


---

---
title: "[CQOI2012] 模拟工厂"
layout: "post"
diff: 省选/NOI-
pid: P3161
tag: ['模拟', '贪心', '2012', '重庆', '各省省选']
---
# [CQOI2012] 模拟工厂
## 题目描述

有一个称为“模拟工厂”的游戏是这样的：在时刻 $0$，工厂的生产力等于 $1$。在每个时刻，你可以提高生产力或者生产商品。如果选择提高生产力，在下一个时刻时工厂的生产力加 $1$；如果选择生产商品，则下一个时刻你所拥有的商品数量增加 $p$，其中 $p$ 是本时刻工厂的生产力。  

有 $n$ 个订单，可以选择接受或者不接受。第 $i$ 个订单 $(t_i, g_i, m_i)$ 要求在时刻 $t_i$ 给买家提供 $g_i$ 个商品，事成之后商品数量减少 $g_i$，而收入增加 $m_i$ 元。如果接受订单 $i$，则必须恰好在时刻 $t_i$ 交易，不能早也不能晚。同一时刻可以接受多个订单，但每个订单只能被接受一次。要求最后的总收入最大。  

例如，如果一共有两个订单 $(5,1,8)$ 和 $(7,15,3)$，用如下策略是最优的：时刻 $0$, $1$, $2$ 提高生产力（时刻 $3$ 的生产力为 $4$），然后在时刻 $3$，$4$ 生产商品，则在时刻 $5$ 时将拥有 $8$ 个商品。此时接受第 $1$ 个订单（还会剩下 $7$ 个商品），并且在时刻 $5$，$6$ 继续生产商品，则在时刻 $7$ 时拥有 $7+4+4=15$ 个商品，正好满足订单 $2$。
## 输入格式

输入第一行包含一个整数 $n$，即订单数目。以下 $n$ 行每行三个整数 $t_i, g_i, m_i$。
## 输出格式

输出仅一行，为最大总收入。输出保证在 $32$ 位带符号整数范围内。
## 样例

### 样例输入 #1
```
2
5 1 8
7 15 3
```
### 样例输出 #1
```
11
```
## 提示

**【数据范围】**

| 编号 | $n \le$ | $t_i \le$ | $g_i \le$ | $m_i \le$ |
|:-:|:-:|:-:|:-:|:-:|
| $1 \sim 3$ | $5$ | $100$ | $10000$ | $10000$ |
| $4 \sim 6$ | $10$ | $100$ | $10000$ | $10000$ |
| $7 \sim 10$ | $15$ | $100000$ | $10^9$ | $10^9$ |


---

---
title: "[CQOI2012] 组装"
layout: "post"
diff: 省选/NOI-
pid: P3162
tag: ['数学', '贪心', '2012', '重庆', '各省省选', '排序']
---
# [CQOI2012] 组装
## 题目描述

数轴上有 $m$ 个生产车间可以生产零件。一共有 $n$ 种零件，编号为 $1\sim n$。第 $i$ 个车间的坐标为 $x_i$ ，生产第 $p_i$ 种零件（$1\le p_i\le n$）。你需要在数轴上的某个位置修建一个组装车间，把这些零件组装起来。为了节约运输成本，你需要最小化 $cost_1+cost_2+\ldots+cost_n$，其中 $cost_x$ 表示生产第 $x$ 种零件的车间中，到组装车间距离的平方的最小值。
## 输入格式

输入第一行为两个整数 $n$, $m$ ，即零件的种类数和生产车间的个数。以下 $m$ 行每行两个整数 $x_i$ 和 $p_i$（$1\le p_i\le n$）。输入按照生产车间从左到右的顺序排列（即 $x_i\le x_{i+1}$ 。注意车间位置可以重复）。输入保证每种零件都有车间生产。
## 输出格式

输出仅一行，即组装车间的最优位置（可以和某个生产车间重合），四舍五入保留四位小数。输入保证最优位置惟一。

## 样例

### 样例输入 #1
```
3 5
-1 3
0 1
2 3
4 2
5 2
```
### 样例输出 #1
```
2.0000
```
## 提示

- 测试点 $1 \sim 4$，满足 $n\le 15$，$m\le 25$，$x_i\le100$；
- 测试点 $5 \sim 10$，满足 $n\le 10^4,m\le 10^5,x_i\le10^5$。


---

---
title: "[CQOI2014] 危桥"
layout: "post"
diff: 省选/NOI-
pid: P3163
tag: ['2014', '重庆', '各省省选', '网络流']
---
# [CQOI2014] 危桥
## 题目描述

Alice 和 Bob 居住在一个由 $N$ 座岛屿组成的国家，岛屿被编号为 $0$ 到 $N-1$。某些岛屿之间有桥相连，桥上的道路是双向的，但一次只能供一人通行。其中一些桥由于年久失修成为危桥，最多只能通行两次。

Alice 希望在岛屿 $a_1$ 和 $a_2$ 之间往返 $a_n$ 次（从 $a1$ 到 $a2$ 再从 $a2$ 到 $a1$ 算一次往返）。同时，Bob 希望在岛屿 $b_1$ 和 $b_2$ 之间往返 $b_n$ 次。这个过程中，所有危桥最多通行两次，其余的桥可以无限次通行。请问 Alice 和 Bob 能完成他们的愿望吗？

## 输入格式

本题有多组测试数据。

每组数据第一行包含七个空格隔开的整数，分别为$N$、$a_1$、$a_2$、$a_n$、$b_1$、$b_2$、$b_n$。  
接下来是一个 $N$ 行 $N$ 列的对称矩阵，由大写字母组成。矩阵的 $i$ 行 $j$ 列描述编号 $i-1$ 和 $j-1$ 的岛屿间的连接情况，若为 “`O`” 则表示有危桥相连：为 “`N`” 表示有普通的桥相连：为 “`X`” 表示没有桥相连。
## 输出格式

对于每组测试数据输出一行，如果他们都能完成愿望输出 “Yes”，否则输出 “No”（不含引号）。

## 样例

### 样例输入 #1
```
4 0 1 1 2 3 1
XOXX
OXOX
XOXO
XXOX
4 0 2 1 1 3 2
XNXO
NXOX
XOXO
OXOX

```
### 样例输出 #1
```
Yes
No

```
## 提示

对于所有数据，$4 \leq N\leq 50,\ 0 \leq a_1, a_2, b_1, b_2 \leq N-1,\ 1 \leq a_n, b_n \leq 50$。


---

---
title: "[CQOI2014] 和谐矩阵"
layout: "post"
diff: 省选/NOI-
pid: P3164
tag: ['2014', '重庆', '各省省选', 'Special Judge', '高斯消元']
---
# [CQOI2014] 和谐矩阵
## 题目描述

我们称一个由 $0$ 和 $1$ 组成的矩阵是和谐的，当且仅当每个元素都有偶数个相邻的 $1$。一个元素相邻的元素包括它本身，及他上下左右的 $4$ 个元素（如果存在）。给定矩阵的行数和列数，请计算并输出一个和谐的矩阵。注意：所有元素为 $0$ 的矩阵是不允许的。

## 输入格式

输入一行，包含两个空格分隔的整数 $m$ 和 $n$，分别表示矩阵的行数和列数。

## 输出格式

输出包含 $m$ 行，每行 $n$ 个空格分隔整数（$0$ 或 $1$），为所求矩阵。测试数据保证有解。

## 样例

### 样例输入 #1
```
4 4
```
### 样例输出 #1
```
0 1 0 0
1 1 1 0
0 0 0 1
1 1 0 1


```
## 提示

数据范围

$1\le n,m\le 40$。

感谢@miaomiao 提供spj。



---

---
title: "[CQOI2014] 排序机械臂"
layout: "post"
diff: 省选/NOI-
pid: P3165
tag: ['2014', '重庆', '各省省选', '平衡树']
---
# [CQOI2014] 排序机械臂
## 题目描述

为了把工厂中高低不等的物品按从低到高排好序，工程师发明了一种排序机械臂。它遵循一个简单的排序规则，第一次操作找到高度最低的物品的位置 $P_1$ ，并把左起第一个物品至 $P_1$  间的物品 (即区间 $[1,P_1]$  间的物品) 反序；第二次找到第二低的物品的位置 $P_2$ ，并把左起第二个至 $P_2$  间的物品 (即区间 $[2,P_2]$  间的物品) 反序……最终所有的物品都会被排好序。

![样例说明](https://cdn.luogu.com.cn/upload/pic/15642.png)

上图给出有六个物品的示例，第一次操作前，高度最低的物品在位置 $4$ ，于是把第一至第四的物品反序；第二次操作前，第二低的物品在位罝六，于是把第二至六的物品反序……

你的任务便是编写一个程序，确定一个操作序列，即每次操作前第 $i$ 低的物品所在位置 $P_i$ ，以便机械臂工作。需要注意的是，如果有高度相同的物品，必须保证排序后它们的相对位置关系与初始时相同。

## 输入格式

第一行包含正整数n,表示需要排序的物品数星。

第二行包含n个空格分隔的整数$P_i$,表示每个物品的高度。

## 输出格式

输出一行包含n个空格分隔的整数Pi。

## 样例

### 样例输入 #1
```
6
3 4 5 1 6 2
```
### 样例输出 #1
```
4 6 4 5 6 6
```
## 提示

$N \le 100000$

$P_i \le 10^7$



---

---
title: "[CQOI2015] 任务查询系统"
layout: "post"
diff: 省选/NOI-
pid: P3168
tag: ['2015', '重庆', '线段树', '各省省选', '可持久化线段树', '可持久化']
---
# [CQOI2015] 任务查询系统
## 题目描述

最近实验室正在为其管理的超级计算机编制一套任务管理系统，而你被安排完成其中的查询部分。  

超级计算机中的任务用三元组 $(s_i, e_i, p_i)$ 描述，$(s_i, e_i, p_i)$ 表示任务从第 $s_i$ 秒开始，在第 $e_i$ 秒后结束（第 $s_i$ 秒和 $e_i$ 秒任务也在运行），其优先级为 $p_i$。同一时间可能有多个任务同时执行，它们的优先级可能相同，也可能不同。  

调度系统会经常向查询系统询问，第 $x_i$ 秒正在运行的任务中，优先级最小的 $k_i$ 个任务（即将任务按照优先级从小到大排序后取前 $k_i$ 个）的优先级之和是多少。  

特别的，如果 $k_i$ 大于第 $x_i$ 秒正在运行的任务总数，则直接回答第 $x_i$ 秒正在运行的任务优先级之和。上述所有参数均为整数，时间的范围在 $[1, n]$ 之间。

## 输入格式

输入文件第一行包含两个空格分开的正整数 $m$ 和 $n$，分别表示任务总数和时间范围。  

接下来 $m$ 行，每行包含三个空格分开的正整数 $s_i,e_i,p_i$（$s_i \le e_i$），描述一个任务。  

接下来 $n$ 行，每行包含四个空格分开的整数 $x_i,a_i,b_i,c_i$，描述一次查询。  

**本题强制在线**。查询的参数 $k_i$ 需要由公式 $k_i = 1 +(a_i \times \text{pre}+b_i) \bmod c_i$ 计算得到。其中 $\text{pre}$ 表示上一次查询的结果，定义初始 $\text{pre} = 1$ 。

## 输出格式

输出共 $n$ 行，每行一个整数，表示查询结果。

## 样例

### 样例输入 #1
```
4 3
1 2 6
2 3 3
1 3 2
3 3 4
3 1 3 2
1 1 3 4
2 2 4 3
```
### 样例输出 #1
```
2
8
11
```
## 提示

【样例解释】

$k_1 = (1\times 1 + 3)\bmod 2 + 1 = 1$；

$k_2 = (1\times 2+3)\bmod 4 + 1 = 2$；

$k_3 = (2 \times 8+4)\bmod 3+1 = 3$。

【数据范围】
 
对于 $100\%$ 的数据，$1\le m,n,c_i \le 10 ^ 5$，$0 \le a _ i, b _ i \le 10 ^ 5$，$1\leq s_i\leq e_i\leq n$，$1\le p_i \le 10^7$，$x_i$ 为 $1$ 到 $n$ 的一个排列。


注：2024-12-28 加入一个 hack 数据，[帖子链接](https://www.luogu.com.cn/discuss/1025247)。


---

---
title: "[CQOI2015] 多项式"
layout: "post"
diff: 省选/NOI-
pid: P3169
tag: ['数学', '递推', '2015', '重庆', '各省省选', '矩阵加速']
---
# [CQOI2015] 多项式
## 题目描述

在学习完二项式定理后，数学老师给出了一道题目：已知整数 $n,t$ 和 $a_k$（$0\le k\le n$），求 $b_k$（$0\le k\le n$）的表达式使得:

$$
\sum_{k=0}^n a_kx^k=\sum_{k=0}^nb_k(x-t)^k
$$

同学们很快算出了答案。见大家这么快就搞定了，老师便布置了一个更 BT 的作业：计算某个 $b_k$ 的具体数值！接着便在黑板上写下了 $n,t$ 的数值，由于 $a_k$ 实在太多，不能全写在黑板上，老师只给出了一个 $a_k$ 的递推式，让学生自行计算:

$$
a_k=
\begin{cases}
(1234\cdot a_{k-1}+5678)\bmod 3389 & k\gt 0 \\
1 & k=0 \\
\end{cases}
$$

正在学习信息竞赛的你觉得这个作业实在不适合手工完成，便敲起了代码……

## 输入格式

输入文件共三行，第一行为一个正整数 $n$，第二行为一个非负整数 $t$，第三行为一个非负整数 $m$。

## 输出格式

输出一行，为 $b_m$ 的值。
## 样例

### 样例输入 #1
```
3
2
2
```
### 样例输出 #1
```
10536
```
## 提示

数据范围：

对于 $20\%$ 的数据，$t=0$。

对于另外 $30\%$ 的数据，$n\le 10^5$。

对于 $100\%$ 的数据，$0\lt n\le 10^{3000}$，$0\le t\le 10^4$，$0\le n-m\le 5$。



---

---
title: "[CQOI2015] 网络吞吐量"
layout: "post"
diff: 省选/NOI-
pid: P3171
tag: ['2015', '重庆', '各省省选', '网络流', '最短路']
---
# [CQOI2015] 网络吞吐量
## 题目背景

路由是指通过计算机网络把信息从源地址传输到目的地址的活动，也是计算机网络设计中的重点和难点。网络中实现路由转发的硬件设备称为路由器。为了使数据包最快的到达目的地，路由器需要选择最优的路径转发数据包。例如在常用的路由算法 OSPF (开放式最短路径优先) 中，路由器会使用经典的 Dijkstra 算法计算最短路径，然后尽量沿最短路径转发数据包。

## 题目描述

现在，若已知一个计算机网络中各路由器间的连接情况，以及各个路由器的最大吞吐量（即每秒能转发的数据包数量），网络中的路由器使用 $1$ 到 $n$ 编号，假设所有数据包一定沿最短路径转发，试计算从路由器 $1$ 到路由器 $n$ 的网络的最大吞吐量。计算中忽略转发及传输的时间开销，不考虑链路的带宽限制，即认为数据包可以瞬间通过网络。路由器 $1$ 到路由器 $n$ 作为起点和终点，自身的吞吐量不用考虑，网络上也不存在将 $1$ 和 $n$ 直接相连的链路。

## 输入格式

输入的第一行是用空格隔开的两个整数，分别代表路由器的数量 $n$ 和链路的数量 $m$。

第 $2$ 到第 $(m + 1)$  行，每行三个整数 $u, v, w$，代表存在一条连结路由器 $u$ 和路由器 $v$  的距离为 $w$ 的双向链路。

第 $(m + 2)$ 到第 $(n + m + 1)$  行，每行一个整数，第 $(i + m + 1)$ 行的整数代表路由器 $i$ 的吞吐量 $c_i$。

## 输出格式

输出一行一个整数，代表网络的最大吞吐量。

## 样例

### 样例输入 #1
```
7 10
1 2 2
1 5 2
2 4 1
2 3 3
3 7 1
4 5 4
4 3 1
4 6 1
5 6 2
6 7 1
1
100
20
50
20
60
1
```
### 样例输出 #1
```
70
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1 \leq n \leq 500$，$1 \leq m \leq 10^5$，$1 \leq w, c_i \leq 10^9$。



---

---
title: "[CQOI2015] 选数"
layout: "post"
diff: 省选/NOI-
pid: P3172
tag: ['递推', '2015', '重庆', '各省省选', '最大公约数 gcd', '莫比乌斯反演']
---
# [CQOI2015] 选数
## 题目描述

我们知道，从区间 $[L,H]$（$L$ 和 $H$ 为整数）中选取 $N$ 个整数，总共有 $(H-L+1)^N$ 种方案。小 z 很好奇这样选出的数的最大公约数的规律，他决定对每种方案选出的 $N$ 个整数都求一次最大公约数，以便进一步研究。然而他很快发现工作量太大了，于是向你寻求帮助。你的任务很简单，小 z 会告诉你一个整数 $K$，你需要回答他最大公约数刚好为 $K$ 的选取方案有多少个。

由于方案数较大，你只需要输出其除以 $10^9+7$ 的余数即可。
## 输入格式

输入一行，包含四个空格分开的正整数，依次为 $N,K,L,H$。

## 输出格式

输出一个整数，为所求方案数除以 $10^9 + 7$ 的余数。

## 样例

### 样例输入 #1
```
2 2 2 4
```
### 样例输出 #1
```
3
```
## 提示

#### 样例 1 解释

所有可能的选择方案：$(2, 2), (2, 3), (2, 4), (3, 2), (3, 3), (3, 4), (4, 2), (4, 3), (4, 4)$。

其中最大公约数等于 $2$ 的只有 $3$ 组：$(2, 2), (2, 4), (4, 2)$。
#### 数据规模与约定
对于 $100\%$ 的数据，$1\le N,K\le 10^9$，$1\le L\le H\le 10^9$，$H-L\le 10^5$。


---

---
title: "[HNOI2009] 最小圈"
layout: "post"
diff: 省选/NOI-
pid: P3199
tag: ['2009', '各省省选', '湖南', '深度优先搜索 DFS', '分数规划']
---
# [HNOI2009] 最小圈
## 题目描述

考虑带权有向图 $G=(V,E)$ 以及 $w:E\rightarrow \R$，每条边 $e=(i,j)$（$i\neq j$，$i, j\in V$）的权值定义为 $w_{i,j}$。设 $n=|V|$。

$c=(c_1,c_2,\cdots,c_k)$（$c_i\in V$）是 $G$ 中的一个圈当且仅当 $(c_i,c_{i+1})$（$1\le i<k$）和 $(c_k,c_1)$ 都在 $E$ 中。称 $k$ 为圈 $c$ 的长度，同时记 $c_{k+1}=c_1$，并定义圈 $c=(c_1,c_2,\cdots,c_k)$ 的平均值为
$$
\mu(c)= \frac 1 k \sum\limits_{i=1}^{k} w_{c_i,c_{i+1}}
$$
即 $c$ 上所有边的权值的平均值。设 $\mu'(G)=\min_c\mu(c)$ 为 $G$ 中所有圈 $c$ 的平均值的最小值。

给定图 $G=(V,E)$ 以及 $w:E\rightarrow \R$，求出 $G$ 中所有圈 $c$ 的平均值的最小值 $\mu'(G)$。

## 输入格式

第一行两个正整数，分别为 $n$ 和 $m$，并用一个空格隔开。其中 $n=|V|$，$m=|E|$ 分别表示图中有 $n$ 个点 和 $m$ 条边。

接下来 $m$ 行，每行三个数 $i,j,w_{i,j}$，表示有一条边 $(i,j)$ 且该边的权值为 $w_{i,j}$，注意边权可以是实数。输入数据保证图 $G=(V,E)$ 连通，存在圈且有一个点能到达其他所有点。

## 输出格式

一个实数 $\mu'(G)$，要求精确到小数点后 $8$ 位。

## 样例

### 样例输入 #1
```
4 5
1 2 5
2 3 5
3 1 5
2 4 3
4 1 3
```
### 样例输出 #1
```
3.66666667
```
### 样例输入 #2
```
2 2
1 2 -2.9
2 1 -3.1
```
### 样例输出 #2
```
-3.00000000
```
## 提示

对于 $100\%$ 的数据，$2\leq n\le 3000$，$1\leq m\le 10000$，$|w_{i,j}| \le 10^7$，$1\leq i, j\leq n$ 且 $i\neq j$。

------------
提示：本题存在 $O(nm)$ 的做法，但是 $O(nm\log n)$ 的做法也可以通过。


---

---
title: "[HNOI2009] 梦幻布丁"
layout: "post"
diff: 省选/NOI-
pid: P3201
tag: ['2009', '线段树', '各省省选', '平衡树', '湖南', '枚举']
---
# [HNOI2009] 梦幻布丁
## 题目描述

$n$ 个布丁摆成一行，进行 $m$ 次操作。每次将某个颜色的布丁全部变成另一种颜色的，然后再询问当前一共有多少段颜色。

例如，颜色分别为 $1,2,2,1$ 的四个布丁一共有 $3$ 段颜色.
## 输入格式

第一行是两个整数，分别表示布丁个数 $n$ 和操作次数 $m$。  
第二行有 $n$ 个整数，第 $i$ 个整数表示第 $i$ 个布丁的颜色 $a_i$。  
接下来 $m$ 行，每行描述一次操作。每行首先有一个整数 $op$ 表示操作类型：
- 若 $op = 1$，则后有两个整数 $x, y$，表示将颜色 $x$ 的布丁全部变成颜色 $y$。
- 若 $op = 2$，则表示一次询问。
## 输出格式

对于每次询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 3
1 2 2 1
2
1 2 1
2

```
### 样例输出 #1
```
3
1
```
## 提示

### 样例 1 解释
初始时布丁颜色依次为 $1, 2, 2, 1$，三段颜色分别为 $[1, 1], [2, 3], [4, 4]$。  
一次操作后，布丁的颜色变为 $1, 1, 1, 1$，只有 $[1, 4]$ 一段颜色。

### 数据规模与约定

对于全部的测试点，保证 $1 \leq n, m \leq 10^5$，$1 \leq a_i ,x, y \leq 10^6$。

### 提示

请注意，**不保证**颜色的编号不大于 $n$，也**不保证** $x \neq y$，$m$ **不是**颜色的编号上限。


---

---
title: "[HNOI2010] 弹飞绵羊"
layout: "post"
diff: 省选/NOI-
pid: P3203
tag: ['2010', '各省省选', '湖南', '动态树 LCT', '分块']
---
# [HNOI2010] 弹飞绵羊
## 题目描述

某天，Lostmonkey 发明了一种超级弹力装置，为了在他的绵羊朋友面前显摆，他邀请小绵羊一起玩个游戏。  

游戏一开始，Lostmonkey 在地上沿着一条直线摆上 $n$ 个装置，每个装置设定初始弹力系数 $k_i$，当绵羊达到第 $i$ 个装置时，它会往后弹 $k_i$ 步，达到第 $i+k_i$ 个装置，若不存在第 $i+k_i$ 个装置，则绵羊被弹飞。  

绵羊想知道当它从第 $i$ 个装置起步时，被弹几次后会被弹飞。为了使得游戏更有趣，Lostmonkey 可以修改某个弹力装置的弹力系数，任何时候弹力系数均为正整数。

## 输入格式

第一行包含一个整数 $n$，表示地上有 $n$ 个装置，装置的编号从 $0 \sim n-1$。

接下来一行有 $n$ 个正整数，依次为那 $n$ 个装置的初始弹力系数。

第三行有一个正整数 $m$，表示操作次数。接下来 $m$ 行每行至少有两个数 $i,j$。  

- 若 $i=1$，你要输出从编号为 $j$ 的装置出发被弹几次后被弹飞  

- 若 $i=2$，则还会再输入一个正整数 $k$，表示编号为 $j$ 的弹力装置的系数被修改成 $k$。
## 输出格式

对于每个 $i=1$ 的操作，输出一行一个整数表示答案。

## 样例

### 样例输入 #1
```
4
1 2 1 1
3
1 1
2 1 1
1 1
```
### 样例输出 #1
```
2
3
```
## 提示

【数据范围】   
对于 $20\%$ 的数据，$1 \le n,m \le 10^4$；   
对于 $100\%$ 的数据，$1\le n \le 2\times 10^5$，$1\le m \le 10^5$。



---

---
title: "[HNOI2010] 公交线路"
layout: "post"
diff: 省选/NOI-
pid: P3204
tag: ['2010', '各省省选', '湖南', '进制', '状压 DP']
---
# [HNOI2010] 公交线路
## 题目描述

小Z所在的城市有N个公交车站，排列在一条长(N-1)km的直线上，从左到右依次编号为1到N，相邻公交车站间的距离均为1km。 作为公交车线路的规划者，小Z调查了市民的需求，决定按下述规则设计线路：

1. 设共K辆公交车，则1到K号站作为始发站，N-K+1到N号台作为终点站。
2. 每个车站必须被一辆且仅一辆公交车经过（始发站和终点站也算被经过）。 
3. 公交车只能从编号较小的站台驶往编号较大的站台。 
4. 一辆公交车经过的相邻两个站台间距离不得超过Pkm。 

在最终设计线路之前，小Z想知道有多少种满足要求的方案。由于答案可能很大，你只需求出答案对30031取模的结果。

## 输入格式

仅一行包含三个正整数N K P，分别表示公交车站数，公交车数，相邻站台的距离限制。N<=10^9，1<P<=10，K<N，1<K<=P

## 输出格式

仅包含一个整数，表示满足要求的方案数对30031取模的结果。

## 样例

### 样例输入 #1
```
10 3 3
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5 2 3
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
10 2 4
```
### 样例输出 #3
```
81
```
## 提示

【样例说明】

样例一的可行方案如下： (1,4,7,10)，(2,5,8)，(3,6,9)

样例二的可行方案如下： (1,3,5)，(2,4) (1,3,4)，(2,5) (1,4)，(2,3,5)

P<=10 , K <=8



---

---
title: "[HNOI2011] 任务调度"
layout: "post"
diff: 省选/NOI-
pid: P3212
tag: ['搜索', '2011', '各省省选', '湖南', '随机化']
---
# [HNOI2011] 任务调度
## 题目描述


有 $n$ 个任务和两台机器 A 与 B。每个任务都需要既在机器 A 上执行，又在机器 B 上执行，

第 $i$ 个任务需要在机器 A 上执行时间 $a_i$，且需要在机器 B 上执行时间 $b_i$。最终的目标是所有任务在 A 和 B 上都执行完，且希望执行完所有任务的总时间尽量少。当然问题没有这么简单，有些任务对于先在机器 A 上执行还是先在机器 B 上执行有一定的限制。据此可将所有任务分为三类：

1. 任务必须先在机器 A 上执行完然后再在机器 B 上执行。
2. 任务必须先在机器 B 上执行完然后再在机器 A 上执行。
3. 任务没有限制，既可先在机器 A 上执行，也可先在机器 B 上执行。

现在给定每个任务的类别和需要在机器 A 和机器 B 上分别执行的时间，问使所有任务都能按规定完成所需要的最少总时间是多少。
## 输入格式

输入的第一行只有一个正整数 $n$，表示任务的个数。

接下来的 $n$ 行，每行是用空格隔开的三个正整数 $t_i,a_i,b_i$，分别表示第 $i$ 个任务的类别（类别 $1$，$2$，$3$ 的定义如上）以及第 $i$ 个任务需要在机器 A 和机器 B 上分别执行的时间。
## 输出格式

输出仅包含一个正整数，表示所有任务都执行完所需要的最少总时间。
## 样例

### 样例输入 #1
```
3
3 5 7
1 6 1 
2 2 6

```
### 样例输出 #1
```
14
```
## 提示

#### 样例 1 解释

一种最优任务调度方案为：

机器 A 上执行的各任务依次安排如下：

任务 $1\ (0\to 5)$，任务 $2\ (5\to 11)$, 任务 $3\ (11\to 13)$；

机器 B 上执行的各任务依次安排如下：

任务 $3\ (0 \to 6)$, 任务 $1\ (6 \to 13)$, 任务 $2\ (13 \to14)$，

这样，所有任务都执行完所需要的总时间为 $14$。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1\le n\le 20$，$1\le a_i\le 10^3$，$1\le t_i\le 3$，并保证 $t_i=3$ 的 $i$ 不超过 $10$ 个。


---

---
title: "[HNOI2011] 卡农"
layout: "post"
diff: 省选/NOI-
pid: P3214
tag: ['数学', '2011', '各省省选', '湖南', '组合数学', '逆元']
---
# [HNOI2011] 卡农
## 题目描述

众所周知卡农是一种复调音乐的写作技法，小余在听卡农音乐时灵感大发，发明了一种新的音乐谱写规则。  

他将声音分成 $n$ 个音阶，并将音乐分成若干个片段。音乐的每个片段都是由 $1$ 到 $n$ 个音阶构成的和声，即从 $n$ 个音阶中挑选若干个音阶同时演奏出来。  

为了强调与卡农的不同，他规定任意两个片段所包含的音阶集合都不同。同时为了保持音乐的规律性，他还规定在一段音乐中每个音阶被奏响的次数为偶数。  

现在的问题是：小余想知道包含 $m$ 个片段的音乐一共有多少种。  
两段音乐 $a$ 和 $b$ 同种当且仅当将 $a$ 的片段重新排列后可以得到 $b$。例如：假设 $a$ 为 $\{\{1,2\},\{2,3\}\}$，$b$ 为 $\{\{2,3\},\{1,2\}\}$，那么 $a$ 与 $b$ 就是同种音乐。

答案对 $10^8+7$ 取模。


## 输入格式

仅一行两个正整数 $n,m$

## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2 3
```
### 样例输出 #1
```
1
```
## 提示

【数据范围】  
对于 $20\%$ 的数据，$1\le n,m \le 5$；   
对于 $50\%$ 的数据，$1\le n,m \le 3000$；  
对于 $100\%$ 的数据，$1\le n,m \le 10^6$。 

【样例解释】   
音乐为 $\{\{1\},\{2\},\{1,2\}\}$



---

---
title: "[HNOI2011] 括号修复 / [JSOI2011] 括号序列"
layout: "post"
diff: 省选/NOI-
pid: P3215
tag: ['字符串', '2011', '各省省选', '平衡树', '湖南']
---
# [HNOI2011] 括号修复 / [JSOI2011] 括号序列
## 题目描述

一个合法的括号序列是这样定义的：

1.    空串是合法的。
2.    如果字符串 `S` 是合法的，则`(S)`也是合法的。
3.    如果字符串 `A` 和 `B` 是合法的，则 `AB` 也是合法的。

现在给你一个长度为 $n$ 的由`(`和`)`组成的字符串，位置标号从 $1$ 到 $n$。对这个字符串有下列四种操作：


-  `Replace a b c`：将 $[a,b]$ 之间的所有括号改成 $c$。假设原来的字符串为：`))())())(`，那么执行操作 `Replace 2 7 (`  后原来的字符串变为：`)(((((()(`。

-  `Swap a b`：将 $[a,b]$ 之间的字符串翻转。假设原来的字符串为：`))())())(`，那么执行操作 `Swap 3 5` 后原来的字符串变为：`))))(())(`。

-  `Invert a b`：将 $[a,b]$ 之间的 `(` 变成 `)` ，`)` 变成 `(`。假设原来的字符串为：`))())())(`，那么执行操作 `Invert 4 8` 后原来的字符串变为：`))((()(((`。

-  `Query a b`：询问 $[a,b]$ 之间的字符串至少要改变多少位才能变成合法的括号序列。改变某位是指将该位的 `(` 变成 `)` 或 `)` 变成 `(`。注意执行操作 `Query` 并不改变当前的括号序列。假设原来的字符串为：`))())())(`，那么执行操作 `Query 3 6` 的结果为 $2$，因为要将位置 $5$ 的`)`变成`(`并将位置 $6$ 的`(`变成`)`。

## 输入格式

输入文件的第一行是用空格隔开的两个正整数 $n,q$，分别表示字符串的长度和将执行的操作个数。  

第二行是长度为 $n$ 的初始字符串 $S$。接下来的 $q$ 行是将依次执行的$q$个操作，其中操作名与操作数之间以及相邻操作数之间均用空格隔开。

## 输出格式

对于每个 `Query` 操作，输出一行一个整数表示答案。输入数据保证有解。
## 样例

### 样例输入 #1
```
4 5
((((
Replace 1 2 )
Query 1 2
Swap 2 3
Invert 3 4
Query 1 4
```
### 样例输出 #1
```
1
2

```
## 提示

### 样例解释

输入中有 $2$ 个 `Query` 操作，所以输出有 $2$ 行。   
执行第一个 `Query` 操作时的括号序列为 `))((`，因改变第 $1$ 位可使 $[1,2]$ 之间的字符串变成合法的括号序列，故输出的第一行为 `1`。  

执行第二个 `Query` 操作时的括号序列为 `)(()`，因要改变第 $1$ 位和第 $2$ 位才能使 $[1,4]$ 之间的字符串变成合法的括号序列，故输出的第二行为 `2`。

### 数据范围

对于 $30\%$ 的数据，$1\le n,q \le 3000$；   
对于 $100\%$ 的数据，$1\le n,q \le 10^5$。


---

---
title: "[HNOI2012] 永无乡"
layout: "post"
diff: 省选/NOI-
pid: P3224
tag: ['2012', '线段树', '各省省选', '平衡树', '湖南']
---
# [HNOI2012] 永无乡
## 题目描述

永无乡包含 $n$ 座岛，编号从 $1$ 到 $n$ ，每座岛都有自己的独一无二的重要度，按照重要度可以将这 $n$ 座岛排名，名次用 $1$  到 $n$ 来表示。某些岛之间由巨大的桥连接，通过桥可以从一个岛到达另一个岛。如果从岛 $a$ 出发经过若干座（含 $0$ 座）桥可以 到达岛 $b$ ，则称岛 $a$ 和岛 $b$ 是连通的。

现在有两种操作：

`B x y` 表示在岛 $x$ 与岛 $y$ 之间修建一座新桥。

`Q x k` 表示询问当前与岛 $x$ 连通的所有岛中第 $k$ 重要的是哪座岛，即所有与岛 $x$ 连通的岛中重要度排名第 $k$ 小的岛是哪座，请你输出那个岛的编号。
## 输入格式

第一行是用空格隔开的两个整数，分别表示岛的个数 $n$ 以及一开始存在的桥数 $m$。

第二行有 $n$ 个整数，第 $i$ 个整数表示编号为 $i$ 的岛屿的排名 $p_i$。

接下来 $m$ 行，每行两个整数 $u, v$，表示一开始存在一座连接编号为 $u$ 的岛屿和编号为 $v$ 的岛屿的桥。

接下来一行有一个整数，表示操作个数 $q$。

接下来 $q$ 行，每行描述一个操作。每行首先有一个字符 $op$，表示操作类型，然后有两个整数 $x, y$。
- 若 $op$ 为 `Q`，则表示询问所有与岛 $x$ 连通的岛中重要度排名第 $y$ 小的岛是哪座，请你输出那个岛的编号。
- 若 $op$ 为 `B`，则表示在岛 $x$ 与岛 $y$ 之间修建一座新桥。

## 输出格式

对于每个询问操作都要依次输出一行一个整数，表示所询问岛屿的编号。如果该岛屿不存在，则输出 $-1$ 。
## 样例

### 样例输入 #1
```
5 1
4 3 2 5 1
1 2
7
Q 3 2
Q 2 1
B 2 3
B 1 5
Q 2 1
Q 2 4
Q 2 3

```
### 样例输出 #1
```
-1
2
5
1
2
```
## 提示

### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $n \leq 10^3$, $q \leq 10^3$。
- 对于 $100\%$ 的数据，保证 $1 \leq m \leq n \leq 10^5$, $1 \leq q \leq 3 \times 10^5$，$p$ 为一个 $1 \sim n$ 的排列，$op \in \{\texttt Q, \texttt B\}$，$1 \leq u, v, x, y \leq n$。


---

---
title: "[HNOI2015] 实验比较"
layout: "post"
diff: 省选/NOI-
pid: P3240
tag: ['动态规划 DP', '数学', '2015', '并查集', '各省省选', '湖南']
---
# [HNOI2015] 实验比较
## 题目描述

小 D 被邀请到实验室，做一个跟图片质量评价相关的主观实验。

实验用到的图片集一共有 $N$ 张图片，编号为 $1$ 到 $N$。实验分若干轮进行，在每轮实验中，小 D 会被要求观看某两张随机选取的图片， 然后小 D 需要根据他自己主观上的判断确定这两张图片谁好谁坏，或者这两张图片质量差不多。 

用符号 ”$<$”、“$>$” 和 “$=$” 表示图片 $x$ 和 $y$（$x$、$y$ 为图片编号）之间的比较：如果上下文中 $x$ 和 $y$ 是图片编号，则 $x<y$ 表示图片 $x$「质量优于」$y$，$x>y$ 表示图片 $x$「质量差于」$y$，$x=y$ 表示图片 $x$ 和 $y$ 「质量相同」；也就是说，这种上下文中，“$<$”、“$>$”、“$=$” 分别是质量优于、质量差于、质量相同的意思；在其他上下文中，这三个符号分别是小于、大于、等于的含义。

图片质量比较的推理规则（在 $x$ 和 $y$ 是图片编号的上下文中）：
1. $x < y$ 等价于 $y > x$。
2. 若 $x < y$ 且 $y = z$，则 $x < z$。
3. 若 $x < y$ 且 $x = z$，则 $z < y$。
4. $x=y$ 等价于 $y=x$。
5. 若 $x=y$ 且 $y=z$，则 $x=z$。 

实验中，小 D 需要对一些图片对 $(x, y)$，给出 $x < y$ 或 $x = y$ 或 $x > y$ 的主观判断。小 D 在做完实验后， 忽然对这个基于局部比较的实验的一些全局性质产生了兴趣。

在主观实验数据给定的情形下，定义这 $N$ 张图片的一个合法质量序列为形如 “$x_1 R_1 x_2 R_2 x_3 R_3 …x_{N-1} R_{N-1} x_N$” 的串，也可看作是集合 $\{ x_i R_i x_{i+1}|1 \leq i \leq N-1 \}$，其中  $x_i$ 为图片编号，$x_1,x_2, \ldots ,x_N$ 两两互不相同（即不存在重复编号），$R_i$ 为 $<$ 或 $=$，「合法」是指这个图片质量序列与任何一对主观实验给出的判断不冲突。 

例如： 质量序列 $3 < 1 = 2$ 与主观判断 “$3 > 1$，$3 = 2$” 冲突（因为质量序列中 $3<1$ 且 $1=2$，从而 $3<2$，这与主观判断中的 $3=2$ 冲突；同时质量序列中的 $3<1$ 与主观判断中的 $3>1$ 冲突） ，但与主观判断 “$2 = 1$，$3 < 2$”  不冲突；因此给定主观判断 “$3>1$，$3=2$” 时，$1<3=2$ 和 $1<2=3$ 都是合法的质量序列，$3<1=2$ 和 $1<2<3$ 都是非法的质量序列。

由于实验已经做完一段时间了，小 D 已经忘了一部分主观实验的数据。对每张图片 $X_i$，小 D 都**最多**只记住了某一张质量不比 $X_i$ 好的另一张图片 $K_{X_i}$。这些小 D 仍然记得的质量判断一共有 $M$ 条（$0 \leq M \leq N$），其中第 $i$ 条涉及的图片对为 $(K_{X_i}, X_i)$，判断要么是 $K_{X_i} < X_i$，要么是 $K_{X_i} = X_i$，而且所有的 $X_i$ 互不相同。小 D 打算就以这 M 条自己还记得的质量判断作为他的所有主观数据。

现在，基于这些主观数据，我们希望你帮小 D 求出这 $N$ 张图片一共有多少个不同的合法质量序列。我们规定：如果质量序列中出现 “$x = y$”，那么序列中交换 $x$ 和 $y$ 的位置后仍是同一个序列。因此： $1<2=3=4<5$ 和 $1<4=2=3<5$ 是同一个序列， $1 < 2 = 3$ 和 $1 < 3 = 2$ 是同一个序列，而 $1 < 2 < 3$ 与 $1 < 2 = 3$ 是不同的序列，$1<2<3$ 和 $2<1<3$ 是不同的序列。

由于合法的图片质量序列可能很多， 所以你需要输出答案对 $10^9 + 7$ 取模的结果。
## 输入格式

第一行两个正整数 $N,M$，分别代表图片总数和小 $D$ 仍然记得的判断的条数；

接下来 $M$ 行，每行一条判断，每条判断形如「$x < y$」或者「$x = y$」。
## 输出格式

输出仅一行，包含一个正整数，表示合法质量序列的数目对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
5 4
1 < 2
1 < 3
2 < 4
1 = 5
```
### 样例输出 #1
```
5
```
## 提示

不同的合法序列共5个，如下所示：

- $1 = 5 < 2 < 3 < 4$ 
- $1 = 5 < 2 < 4 < 3$
- $1 = 5 < 2 < 3 = 4$ 
- $1 = 5 < 3 < 2 < 4$ 
- $1 = 5 < 2 = 3 < 4$

$100\%$ 的数据满足 $N \leq 100$。


---

---
title: "[HNOI2016] 序列"
layout: "post"
diff: 省选/NOI-
pid: P3246
tag: ['2016', '各省省选', '湖南', '前缀和', '栈', 'ST 表']
---
# [HNOI2016] 序列
## 题目描述

给定长度为 $ n $ 的序列：$ a_1, a_2, \cdots , a_n $，记为 $ a[1 \colon n] $。类似地，$ a[l \colon r] $（$ 1 \leq l \leq r \leq N$）是指序列：$ a_{l}, a_{l+1}, \cdots ,a_{r-1}, a_r$。若 $1\leq l \leq s \leq t \leq r \leq n$，则称 $ a[s \colon t] $ 是 $ a[l \colon r] $ 的子序列。

现在有 $ q $ 个询问，每个询问给定两个数 $ l $ 和 $ r $，$ 1 \leq l \leq r \leq n $，求 $ a[l \colon r] $ 的不同子序列的最小值之和。例如，给定序列
 $ 5, 2, 4, 1, 3 $，询问给定的两个数为 $ 1 $ 和 $ 3 $，那么 $ a[1 \colon 3] $ 有 $ 6 $ 个子序列 $a[1 \colon 1], a[2 \colon 2], a[3 \colon 3], a[1 \colon 2],a[2 \colon 3], a[1 \colon 3] $，这 $6 $ 个子序列的最小值之和为 $5+2+4+2+2+2=17$。
## 输入格式

输入文件的第一行包含两个整数 $ n $ 和 $ q $，分别代表序列长度和询问数。

接下来一行，包含 $ n $ 个整数，以空格隔开，第 $ i $ 个整数为 $ a_i $，即序列第 $i$ 个元素的值。

接下来 $ q $ 行，每行包含两个整数 $ l $ 和 $ r $，代表一次询问。
## 输出格式

对于每次询问，输出一行，代表询问的答案。

## 样例

### 样例输入 #1
```
5 5
5 2 4 1 3
1 5
1 3
2 4
3 5
2 5
```
### 样例输出 #1
```
28 
17 
11 
11 
17
```
## 提示

对于 $100\%$ 的数据，$ 1 \leq n,q \leq 100000$，$|a_i| \leq 10^9$。


---

---
title: "[HNOI2016] 树"
layout: "post"
diff: 省选/NOI-
pid: P3248
tag: ['2016', '各省省选', '湖南', '最近公共祖先 LCA', '树套树', '可持久化线段树']
---
# [HNOI2016] 树
## 题目描述

小A想做一棵很大的树，但是他手上的材料有限，只好用点小技巧了。开始，小A只有一棵结点数为 $N$ 的树，结点的编号为 $1,2,...,N$，其中结点 $1$ 为根；我们称这颗树为模板树。小A决定通过这棵模板树来构建一颗大树。构建过程如下：

1. 将模板树复制为初始的大树。

2. 以下(2.1)(2.2)(2.3)步循环执行 $M$ 次

（2.1）选择两个数字 $a,b$，其中 $1 \leq a \leq N, 1 \leq b \leq \text{当前大树的结点数}$。

（2.2）将模板树中以结点 $a$ 为根的子树复制一遍，挂到大树中结点 $b$ 的下方(也就是说，模板树中的结点 $a$ 为根的子树复制到大树中后，将成为大树中结点 $b$ 的子树)。

（2.3）将新加入大树的结点按照在模板树中编号的顺序重新编号。例如，假设在进行2.2步之前大树有 $L$ 个结点，模板树中以 $a$ 为根的子树共有 $C$ 个结点，那么新加入模板树的 $C$ 个结点在大树中的编号将是 $L+1,L+2,...,L+C$ ；大树中这C个结点编号的大小顺序和模板树中对应的 $C$ 个结点的大小顺序是一致的。下面给出一个实例。假设模板树如下图：![](https://cdn.luogu.com.cn/upload/image_hosting/mchs3i55.png)

根据第(1)步，初始的大树与模板树是相同的。

在(2.1)步，假设选择了 $a=4, b=3$。运行(2.2)和(2.3)后，得到新的大树如下图所示

![](https://cdn.luogu.com.cn/upload/image_hosting/ey2lqez8.png)

现在他想问你，树中一些结点对的距离是多少。

## 输入格式

第一行三个整数：$N,M,Q$，以空格隔开，$N$ 表示模板树结点数，$M$ 表示第(2)中的循环操作的次数，$Q$ 表示询问数量。

接下来 $N-1$ 行，每行两个整数 $fr,to$，表示模板树中的一条树边。

再接下来$M$行，每行两个整数$x,to$，表示将模板树中 $x$ 为根的子树复制到大树中成为结点 $to$ 的子树的一次操作。

再接下来 $Q$ 行，每行两个整数 $fr,to$，表示询问大树中结点 $fr$ 和 $to$ 之间的距离是多少。

$N,M,Q \leq 100000$

## 输出格式

输出 $Q$ 行，每行一个整数，第 $i$ 行是第 $i$ 个询问的答案。

## 样例

### 样例输入 #1
```
5 2 3
1 4
1 3
4 2
4 5
4 3
3 2
6 9
1 8
5 3
```
### 样例输出 #1
```
6
3
3
```
## 提示

经过两次操作后，大树变成了下图所示的形状：

![](https://cdn.luogu.com.cn/upload/image_hosting/370xfnn2.png)

结点6到9之间经过了6条边，所以距离为6；类似地，结点1到8之间经过了3条边；结点5到3之间也经过了3条边。



---

---
title: "[JLOI2014] 路径规划"
layout: "post"
diff: 省选/NOI-
pid: P3259
tag: ['数学', '2014', '各省省选', '吉林', '最短路']
---
# [JLOI2014] 路径规划
## 题目描述

相信大家都用过地图上的路径规划功能，只要输入起点终点就能找出一条最优路线。现在告诉你一张地图的信息，请你找出最优路径（即最短路径）。考虑到实际情况，一辆车加满油能开的时间有限，**为 $limit$**，所以在地图上增加了几个加油站。

地图由点和双向边构成，每个点代表一个路口，也有可能是加油站或起点终点。有些路口还装有红绿灯。由于经过太多的红绿灯会让人感到不爽，所以请求在经过不超过 $k$ 个红绿灯的情况下，最少平均花费多少时间能从起点到终点。保证起点终点和加油站没有红绿灯。（题目不考虑最坏情况下能否加到油，只考虑平均花费时间的前提下，车能否到达加油站加油）。


注意：

1. $limit$ 指的是车最多能走多长时间，可以看作车的油箱，是不能叠加的（比如不能连续经过多个加油站后剩余能走的时间 $>limit$）。
2. 与上面类似，一个加油站最多只能加到 $limit$，不能累加。
3. 不管在加油站加多少油，反正加一次耗费的时间都是 $cost$。
4. 经过加油站可以不加油。


## 输入格式

第一行输入 $5$ 个整数 $n,m,k,limit,cost$，表示有 $n$ 个点 $m$ 条边，车能开 $limit$ 长的时间，及加油所花时间 $cost$。

接下来 $n$ 行输入每个点信息，包括点的名称（带 `gas` 的为加油站，`start` 为起点，`end` 为终点），及该点是否有红绿灯，用 $a,b$ 表示。（若为 $a=0$ 则表示没有，$a$ 表示红灯长，$b$ 表示绿灯长）。

接下来 $m$ 行输入每条边信息，包括边的起点，终点，边的名称，通过该边所花时长。

保证点和边名的长度不大于 $20$，只有大小写字母，数字及 `_` 组成。

## 输出格式

一行输出最少平均花费时长。

## 样例

### 样例输入 #1
```
5 8 1 100 10
start 0 0
azhan 10 10
xxgasxx 0 5
bpoint 20 5
end 0 100
start azhan sdf 30
azhan xxgasxx ewfg 20
start end r3tg 200
end azhan 1xq2 70
azhan bpoint gg 10
xxgasxx bpoint kk 30
bpoint end dsg 40
xxgasxx end t_s 100
```
### 样例输出 #1
```
162.500
```
## 提示

共 $14$ 组数据。

- 其中 $3$ 组数据，满足 $1 \le n<10$，$1 \le m<20$，$1 \le k<5$。
- 另有 $3$ 组没有红绿灯。

所有数据满足 $1 \le n \le 10000$，$1 \le m \le 20000$，$1 \le k \le 10$，加油站 $\le 50$。


---

---
title: "[JLOI2015] 战争调度"
layout: "post"
diff: 省选/NOI-
pid: P3262
tag: ['搜索', '2015', '各省省选', '吉林', '枚举', '深度优先搜索 DFS']
---
# [JLOI2015] 战争调度
## 题目描述

脸哥最近来到了一个神奇的王国，王国里的公民每个公民有两个下属或者没有下属，这种关系刚好组成一个 $n$ 层的完全二叉树。公民 $i$ 的下属是 $2i$ 和 $2i +1$。最下层的公民即叶子节点的公民是平民，平民没有下属，最上层的是国王，中间是各级贵族。

现在这个王国爆发了战争，国王需要决定每一个平民是去种地以供应粮食还是参加战争，每一个贵族（包括国王自己）是去管理后勤还是领兵打仗。一个平民会对他的所有直系上司有贡献度，若一个平民 $i$ 参加战争，他的某个直系上司 $j$ 领兵打仗，那么这个平民对上司的作战贡献度为 $w_{ij}$。若一个平民 $i$ 种地，他的某个直系上司 $j$ 管理后勤，那么这个平民对上司的后勤贡献度为 $f_{ij}$，若 $i$ 和 $j$ 所参加的事务不同，则没有贡献度。为了战争需要保障后勤，国王还要求不多于 $m$ 个平民参加战争。

国王想要使整个王国所有贵族得到的贡献度最大，并把这件事交给了脸哥。但不幸的是，脸哥还有很多 deadline 没有完成，他只能把这件事又转交给你。你能帮他安排吗？
## 输入格式

第一行两个数 $n,m$。

接下来 $2^{n-1}$ 行，每行 $n-1$ 个数，第 $i$ 行表示编号为 $2^{n-1}-1+ i$ 的平民对其 $n-1$ 个直系上司的作战贡献度，其中第一个数表示对第一级直系上司，即编号为 $\frac{2^{n-1}-1+ i}{2}$ 的贵族的作战贡献度 $w_{ij}$，依次往上。

接下来 $2^{n-1}$ 行，每行 $n-1$ 个数，第 $i$ 行表示编号为 $2^{n-1}-1+ i$ 的平民对其 $n-1$ 个直系上司的后勤贡献度，其中第一个数表示对第一级直系上司，即编号为 $\frac{2^{n-1}-1+ i}{2}$ 的贵族的后勤贡献度 $f_{ij}$ ，依次往上。
## 输出格式

一行一个数表示满足条件的最大贡献值。
## 样例

### 样例输入 #1
```
3 4
503 1082
1271 369
303 1135
749 1289
100 54
837 826
947 699
216 389
```
### 样例输出 #1
```
6701
```
## 提示

对于 $100 \%$ 的数据，$2 \leq n \leq 10, \ m \leq 2^{n-1}, \ 0 \leq w_{ij}, f_{ij} \leq 2000$。


---

---
title: "[JLOI2015] 骗我呢"
layout: "post"
diff: 省选/NOI-
pid: P3266
tag: ['2015', '各省省选', '吉林']
---
# [JLOI2015] 骗我呢
## 题目描述

说起来，毕业之后 B 君也就见过 R 君两面而已。  
R 君有一个 $n \times m$ 的数组 $x_{i,j}(1 \le i \le n; 1 \le j \le m)$。  
对于 $1 \le i \le n; 1 \le j \le m$，满足$0 \le x_{i,j} \le m$。求 可能的数组$x_{i,j}$ 的解数。  
B 君觉得限制太宽松，还要求对于 $1 \le i \le n; 1 \le j<m$，满足 $x_{i,j} <x_{i,j+1}$，对于$1 <i \le n; 1 \le j<m$，满足 $x_{i,j} <x_{i-1,j+1}$。  
B 君认为 R 君可以直接 pwn 掉这个题。  
R 君说：「黑的实在逼真 =.=，你起码把解数模 $10^9+7$ 吧。」B 君觉得 R 君说的有道理，于是想让你求解数模 $10^9+7$ 的结果。

## 输入格式

一行两个整数表示 $n, m$，含义如题目中所述。

## 输出格式

一行一个数表示同时满足 B 君和 R 君的条件 $x_{i,j}$ 的解数，模 $10^9+7$ 的结果。

## 样例

### 样例输入 #1
```
3 3
```
### 样例输出 #1
```
40
```
## 提示

对于 $100\%$ 的数据，$1 \leq m, n \leq 10^6$



---

---
title: "[JLOI2016] 成绩比较"
layout: "post"
diff: 省选/NOI-
pid: P3270
tag: ['递推', '2016', '各省省选', '吉林', '容斥原理']
---
# [JLOI2016] 成绩比较
## 题目描述

G 系共有 $N$ 位同学，$M$ 门必修课。这 $N$ 位同学的编号为 $0$ 到 $N-1$ 的整数，其中 B 神的编号为 $0$ 号。这 $M$ 门必修课编号为 $0$ 到 $M-1$ 的整数。一位同学在必修课上可以获得的分数是 $1$ 到 $U_i$ 中的一个整数。

如果在每门课上 A 获得的成绩均小于等于 B 获得的成绩，则称 A 被 B 碾压。在 B 神的说法中，G 系共有 $K$ 位同学被他碾压（不包括他自己），而其他 $N-K-1$ 位同学则没有被他碾压。D 神查到了 B 神每门必修课的排名。

这里的排名是指：如果 B 神某门课的排名为 $R$，则表示有且仅有 $R-1$ 位同学这门课的分数大于 B 神的分数，有且仅有 $N-R$ 位同学这门课的分数小于等于 B 神（不包括他自己）。

我们需要求出全系所有同学每门必修课得分的情况数，使其既能满足 B 神的说法，也能符合 D 神查到的排名。这里两种情况不同当且仅当有任意一位同学在任意一门课上获得的分数不同。

你不需要像 D 神那么厉害，你只需要计算出情况数模 $10^9+7$ 的余数就可以了。
## 输入格式

第一行包含三个正整数 $N,M,K$，分别表示 G 系的同学数量（包括 B 神），必修课的数量和被 B 神碾压的同学数量。

第二行包含 $M$ 个正整数，依次表示每门课的最高分 $U_i$。

第三行包含 $M$ 个正整数，依次表示 B 神在每门课上的排名 $R_i$。

数据保证至少有 $1$ 种情况使得 B 神说的话成立。
## 输出格式

仅一行一个正整数，表示满足条件的情况数模 $10^9+7$ 的余数。
## 样例

### 样例输入 #1
```
3 2 1
2 2
1 2
```
### 样例输出 #1
```
10
```
## 提示

$1\leq N\leq 100$，$1\leq M\leq 100$，$1\leq U_i\leq 10^9$，$1\leq R_i\leq N$。


---

---
title: "[SCOI2013] 多项式的运算"
layout: "post"
diff: 省选/NOI-
pid: P3278
tag: ['2013', '四川', '线段树', '各省省选', '枚举']
---
# [SCOI2013] 多项式的运算
## 题目描述

某天，mzry1992 一边思考着一个项目问题一边在高速公路上骑着摩托车。一个光头踢了他一脚，摩托车损坏，而他也被送进校医院打吊针。现在该项目的截止日期将近，他不得不请你来帮助他完成这个项目。


该项目的目的是维护一个动态的关于x 的无穷多项式 ，这个多项式初始时对于所有i有$a_i = 0$。

$f(x)=a_0x^0+a_1x^1+a_2x^2...$

操作者可以进行四种操作：


将$x^L$ 到$x^R$ 这些项的系数乘上某个定值v


将$x^L$ 到$x^R$ 这些项的系数加上某个定值v


将$x^L 到x^R $这些项乘上x变量


将某个定值v代入多项式F(x)，并输出代入后多项式的值，之后多项式还原为代入前的状况

经过观察，项目组发现使用者的操作集中在前三种，第四种操作不会出现超过10次。mzry1992 负责这个项目的核心代码，你能帮他实现么？

## 输入格式

输入的第一行有一个整数n 代表操作的个数。


接下来n 行，每行一个操作，格式如下：


mul L R v 代表第一种操作


add L R v 代表第二种操作


mulx L R 代表第三种操作


query v 代表第四种操作


## 输出格式

对于每个query 操作，输出对应的答案，结果可能较大，需要模上20130426。

## 样例

### 样例输入 #1
```
6
add 0 1 7
query 1
mul 0 1 7
query 2
mulx 0 1
query 3
```
### 样例输出 #1
```
14
147
588

```
## 提示

【样例解释】

操作一之后，多项式为F(x) = 7x + 7。

操作三之后，多项式为F(x) = 49x + 49。

操作五之后，多项式为F(x) = 49x^2 + 49x。

【数据范围与约定】

对于30% 的数据：N ≤ 5000，0 ≤ L ≤ R ≤ 5000，0 ≤ v ≤ 10^9


另有20% 的数据：N ≤ 10^5，0 ≤ L ≤ R ≤ 10^5，0 ≤ v ≤ 10^9，没有mulx 操作


剩下的50% 的数据：N ≤ 10^5，0 ≤ L ≤ R ≤ 10^5，0 ≤v ≤ 10^9



---

---
title: "[SCOI2013] 密码"
layout: "post"
diff: 省选/NOI-
pid: P3279
tag: ['字符串', '2013', '四川', '并查集', '各省省选']
---
# [SCOI2013] 密码
## 题目描述

Fish是一条生活在海里的鱼。有一天他很无聊，就到处去寻宝。他找到了位于海底深处的宫殿，但是一扇带有密码锁的大门却阻止了他的前进。

通过翻阅古籍，Fish 得知了这个密码的相关信息：

1. 该密码的长度为N。

2. 密码仅含小写字母。

3. 以每一个字符为中心的最长回文串长度。

4. 以每两个相邻字符的间隙为中心的最长回文串长度。

很快Fish 发现可能有无数种满足条件的密码。经过分析，他觉得这些密码中字典序最小的一个最有可能是答案，你能帮他找到这个密码么？

注意：对于两个串A和B，如果它们的前i个字符都相同，而A的第i+1个字符比B的第i+1个字符小，那么认为是则称密码A 的字典序小于密码B 的字典序，例如字符串abc 字典序小于字符串acb。如果密码A的字典序比其他所有满足条件的密码的字典序都小，则密码A是这些密码中字典序最小的一个。

## 输入格式

输入由三行组成。第一行仅含一个整数N，表示密码的长度。第二行包含N 个整数，表示以每个字符为中心的最长回文串长度。第三行包含N - 1 个整数，表示每两个相邻字符的间隙为中心的最长回文串长度。

## 输出格式

输出仅一行。输出满足条件的最小字典序密码。古籍中的信息是一定正确的，故一定存在满足条件的密码。

## 样例

### 样例输入 #1
```
3
1 1 1
0 0
```
### 样例输出 #1
```
abc

```
### 样例输入 #2
```
3
1 3 1
0 0
```
### 样例输出 #2
```
aba
```
### 样例输入 #3
```
3
1 3 1
2 2
```
### 样例输出 #3
```
aaa
```
## 提示

对于20% 的数据，1 <= n <= 100。

另有30% 的数据，1 <= n <= 1000。

最后50% 的数据，1 <= n <= 10^5。



---

---
title: "[ZJOI2015] 幻想乡 Wi-Fi 搭建计划"
layout: "post"
diff: 省选/NOI-
pid: P3344
tag: ['动态规划 DP', '2015', '各省省选', '浙江', '分治']
---
# [ZJOI2015] 幻想乡 Wi-Fi 搭建计划
## 题目描述

傲娇少女幽香是一个很萌很萌的妹子。随着科技的进步，幻想乡的大家也开始使用手机了。这时幽香发现没人来她的太阳花田玩了，她感到很伤心，于是向别人打听了一下，才知道原来大家都嫌弃这里没有 Wi-Fi，手机上网还需要流量。

怎么办呢？幽香决定赶快搭建几个 Wi-Fi 点，让所有人都能在太阳花田里畅快地上网。

我们可以近似地把太阳花田看成一个 $y$ 轴在 $[0,R]$ 之间，$x$ 坐标在 $(-\infty,+\infty)$（也就是在 $x$ 轴上无限延伸）的无限长方形。

太阳花田里面有 $n$ 个景点，是游客们经常光顾的，幽香认为只要让这些景点尽量被 Wi-Fi 覆盖，那么游客们就肯定心满意足了。

八云紫表示她可以帮幽香架设 Wi-Fi 路由器。现在通用的路由器，每个的覆盖半径正好也是 $R$。八云紫扫视了一遍地图，发现在太阳花田外面，只有 $m$ 个有网络的地点，她只可以在那里架设路由器。如果你在点 $p$ 搭建了路由器，那么位于 $q$ 的地点，只要 $p$ 和 $q$ 的欧几里得距离小于等于 $R$，$q$ 点就会被 Wi-Fi 覆盖。

同时八云紫表示，架设难度随着地点的不同而不同，所以收费也不一样，在第 $i$ 个位置架设需要 $c_i$ 的钱。

现在幽香想要覆盖尽量多的景点，在这个前提下，幽香也想要尽量节省钱。你能帮助她吗？
## 输入格式

输入第一行三个整数 $n,m,R$，分别表示景点的数量，网络架设地点的数量和太阳花田的宽度。

接下来 $n$ 行，每行两个整数 $x,y$，满足 $|x|\le 10^8,0\le y\le R$，表示一个景点。两个景点的位置不会重合。

接下来 $m$ 行，每行三个整数 $x,y,c$，满足 $|x|\le 10^9$，$-10^8\lt y\lt 0$ 或者 $R\lt y\lt 10^8$，表示一个网络架设点的位置和花费。两个网络架设点不会重合。
## 输出格式

输出第一行表示最多覆盖的景点数。

第二行表示在覆盖景点数最多的前提下，最少的花费。
## 样例

### 样例输入 #1
```
10 10 10000
6743 2963
3505 1986
3565 7235
1735 5522
16877 5597
11621 6
3100 8243
1750 6173
5709 7671
7915 3915
14339 -438 3075
4278 15210 8371
13996 19000 6750
17049 -4969 7788
737 16339 2934
904 14023 2322
8982 14759 4311
13102 11458 5554
4135 12183 576
5087 -2459 6787
```
### 样例输出 #1
```
10
10438
```
## 提示

- 对于 $10\%$ 的数据，$n,m\le 20$；
- 对于另 $30\%$ 的数据，$n,m\le 100$，所有网络架设点的 $y$ 坐标都大于 $R$；
- 对于另 $60\%$ 的数据，$n,m\le 100$。

对于全部数据，$1\le R\le 10^8,0\le c\le 10^4$。


---

---
title: "[ZJOI2017] 仙人掌"
layout: "post"
diff: 省选/NOI-
pid: P3687
tag: ['2017', '各省省选', '浙江', 'O2优化', '枚举', '仙人掌']
---
# [ZJOI2017] 仙人掌
## 题目描述

如果一个**无自环无重边无向连通图**的任意一条边最多属于一个简单环，我们就称之为仙人掌。所谓简单环即不经过重复的结点的环。

 ![](https://cdn.luogu.com.cn/upload/pic/4742.png) 

现在九条可怜手上有一张**无自环无重边的无向连通图**，但是她觉得这张图中的边数太少了，所以她想要在图上连上一些新的边。同时为了方便的存储这张无向图，图中的边数又不能太多。经过权衡，她想要加边后得到的图为一棵仙人掌。

不难发现合法的加边方案有很多，可怜想要知道总共有多少不同的加边方案。

两个加边方案是不同的当且仅当一个方案中存在一条另一个方案中没有的边。

## 输入格式

多组数据，第一行输入一个整数 $T$ 表示数据组数。

每组数据第一行输入两个整数 $n$,$m$，表示图中的点数与边数。

接下来 m 行，每行两个整数 $u$,$v$(1 ≤ $u$,$v$ ≤ $n$,$u$ ≠ $v$) 表示图中的一条边。保证输入的图联通且没有自环与重边。

## 输出格式

对于每组数据，输出一个整数表示方案数，当然方案数可能很大，请对 998244353 取模后输出。

## 样例

### 样例输入 #1
```
2
3 2
1 2
1 3
5 4
1 2
2 3
2 4
1 5
```
### 样例输出 #1
```
2
8
```
## 提示

**样例说明**

对于第一组样例合法加边的方案有 {},{(2,3)}，共 2 种。

**时空限制**

时间限制1s，空间限制512M。

**数据范围**

![](https://cdn.luogu.com.cn/upload/pic/4743.png)



---

---
title: "[ZJOI2017] 树状数组"
layout: "post"
diff: 省选/NOI-
pid: P3688
tag: ['2017', '线段树', '各省省选', '树状数组', '浙江']
---
# [ZJOI2017] 树状数组
## 题目描述

漆黑的晚上，九条可怜躺在床上辗转反侧。难以入眠的她想起了若干年前她的一次悲惨的 OI 比赛经历。那是一道基础的树状数组题。

给出一个长度为 $n$ 的数组 $A$，初始值都为 $0$，接下来进行 $m$ 次操作，操作有两种：

* $1\ x$，表示将 $A_x$  变成 $(A_x + 1) \bmod 2$。
* $2\ l\ r$，表示询问 $(\sum_{i=l}^r A_i) \bmod 2$。

尽管那个时候的可怜非常的 simple，但是她还是发现这题可以用树状数组做。当时非常 young 的她写了如下的算法：

![](https://cdn.luogu.com.cn/upload/pic/4744.png)

其中 $\mathrm{lowbit}(x)$ 表示数字 $x$ **最低**的非 $0$ 二进制位，例如 $\text{lowbit}(5) = 1, \text{lowbit}(12) = 4$。进行第一类操作的时候就调用 $\mathrm{Add}(x)$，第二类操作的时候答案就是 $\mathrm{Query}(l, r)$。

如果你对树状数组比较熟悉，不难发现可怜把树状数组写错了：**$\text{Add}$ 和 $\text{Find}$ 中 $x$  变化的方向反了**。因此这个程序在最终测试时华丽的爆 0 了。

然而奇怪的是，在当时，这个程序通过了出题人给出的大样例——这也是可怜没有进行对拍的原因。

现在，可怜想要算一下，这个程序回答对每一个询问的概率是多少，这样她就可以再次的感受到自己是一个多么非的人了。然而时间已经过去了很多年，即使是可怜也没有办法完全回忆起当时的大样例。幸运的是，她回忆起了大部分内容，唯一遗忘的是每一次第一类操作的 $x$ 的值，因此她假定这次操作的 $x$ 是在 $[l_i, r_i]$  范围内**等概率随机**的。

具体来说，可怜给出了一个长度为 $n$ 的数组 $A$，初始为 $0$，接下来进行了 $m$ 次操作：

* $1\ l\ r$，表示在区间 $[l, r]$ 中等概率选取一个 $x$ 并执行 $\text{Add}(x)$ 。

* $2\ l\ r$，表示询问执行 $\text{Query}(l, r)$ 得到的结果是正确的概率是多少。
## 输入格式

第一行输入两个整数 $n,m$。

接下来 $m$ 行每行描述一个操作，格式如题目中所示。

## 输出格式

对于每组询问，输出一个整数表示答案。如果答案化为最简分数后形如 $\frac x y$，那么你只需要输出 $x\times y^{-1} \bmod 998244353$ 后的值（即输出答案模 $998244353$）。
## 样例

### 样例输入 #1
```
5 5
1 3 3
2 3 5
2 4 5
1 1 3
2 2 5
```
### 样例输出 #1
```
1
0
665496236
```
## 提示

#### 样例说明

在进行完 $\mathrm{Add}(3)$ 之后，$A$ 数组变成了 $[0, 1, 1, 0, 0]$。所以前两次询问可怜的程序答案都是 $1$，因此第一次询问可怜一定正确，第二次询问可怜一定错误。

#### 数据范围

| 测试点编号 |        $n$         |              $m$               |      其他约定      |
| :--------: | :----------------: | :----------------------------: | :----------------: |
|    $1$     |      $\le 5$       |            $\le 10$            |         无         |
|    $2$     |      $\le 50$      |      $\le 50$      |         无         |
|    $3$     |      $\le 50$      |      $\le 50$      |         无         |
|    $4$     | $\le 3\times 10^3$ | $\le 3\times 10^3$ |         无         |
|    $5$     | $\le 3\times 10^3$ | $\le 3\times 10^3$ |         无         |
|    $6$     |       $10^5$       |       $10^5$       | 所有询问都在修改后 |
|    $7$     |       $10^5$       |       $10^5$       | 所有询问都在修改后 |
|    $8$     |       $10^5$       |       $10^5$       |         无         |
|    $9$     |       $10^5$       |       $10^5$       |         无         |
|    $10$    |       $10^5$       |       $10^5$       |         无         |


对于 $100\%$ 的数据，保证 $1\leq l\leq r\leq n$。

更新：2018/05/13 @larryzhong 提供了 5 组强的数据。


---

---
title: "[SDOI2017] 树点涂色"
layout: "post"
diff: 省选/NOI-
pid: P3703
tag: ['2017', '线段树', '各省省选', '山东', '树链剖分', '动态树 LCT']
---
# [SDOI2017] 树点涂色
## 题目描述

Bob 有一棵 $n$ 个点的有根树，其中 $1$ 号点是根节点。Bob 在每个点上涂了颜色，并且每个点上的颜色不同。

定义一条路径的权值是：这条路径上的点（包括起点和终点）共有多少种不同的颜色。

Bob可能会进行这几种操作：

- `1 x` 表示把点 $x$ 到根节点的路径上所有的点染上一种没有用过的新颜色。


- `2 x y` 求 $x$ 到 $y$ 的路径的权值。

- `3 x` 在以 $x$ 为根的子树中选择一个点，使得这个点到根节点的路径权值最大，求最大权值。


Bob一共会进行 $m$ 次操作

## 输入格式

第一行两个数 $n,m$。

接下来 $n-1$ 行，每行两个数 $a,b$，表示 $a$ 与 $b$ 之间有一条边。

接下来 $m$ 行，表示操作，格式见题目描述
## 输出格式

每当出现 $2,3$ 操作，输出一行。

如果是 $2$ 操作，输出一个数表示路径的权值

如果是 $3$ 操作，输出一个数表示权值的最大值

## 样例

### 样例输入 #1
```
5 6
1 2
2 3
3 4
3 5
2 4 5
3 3
1 4
2 4 5
1 5
2 4 5
```
### 样例输出 #1
```
3
4
2
2
```
## 提示

共 $10$ 个测试点。

测试点 $1$，$1\leq n,m\leq1000$；

测试点 $2,3$，没有 $2$ 操作；

测试点 $4,5$，没有 $3$ 操作；

测试点 $6$，树的生成方式是，对于 $i(2\leq i \leq n)$，在 $1 \sim i-1$ 中随机选一个点作为 $i$ 的父节点；

测试点 $7$，$1\leq n,m\leq 5\times 10^4$；

测试点 $8$，$1\leq n \leq 5 \times 10^4$；

测试点9,10，无特殊限制

对所有数据，$1\leq n \leq 10^5$，$1\leq m \leq 10^5$。



---

---
title: "[SDOI2017] 数字表格"
layout: "post"
diff: 省选/NOI-
pid: P3704
tag: ['2017', '各省省选', '山东', 'O2优化', '枚举', '莫比乌斯反演', '分块']
---
# [SDOI2017] 数字表格
## 题目背景

Doris 刚刚学习了 fibonacci 数列。用 $f_i$ 表示数列的第 $i$ 项，那么

$$f_0=0,f_1=1$$

$$f_n=f_{n-1}+f_{n-2},n\geq 2$$
## 题目描述

Doris 用老师的超级计算机生成了一个 $n\times m$ 的表格，

第 $i$ 行第 $j$ 列的格子中的数是 $f_{\gcd(i,j)}$，其中 $\gcd(i,j)$ 表示 $i,j$ 的最大公约数。


Doris 的表格中共有 $n\times m$ 个数，她想知道这些数的乘积是多少。

答案对 $10^9+7$ 取模。

## 输入格式

**本题单个测试点内有多组测试数据**。

输入的第一行是一个整数 $T$，表示测试数据的组数。

接下来 $T$ 行，每行两个整数 $n, m$，表示一组数据。
## 输出格式

对于每组数据，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3
2 3
4 5
6 7
```
### 样例输出 #1
```
1
6
960
```
## 提示

#### 数据规模与约定

- 对于 $10\%$ 的数据，保证 $n,m\leq 10^2$。
- 对于 $30\%$ 的数据，保证 $n,m\leq 10^3$。
- 另有 $30\%$ 的数据，保证 $T\leq 3$。
- 对于 $100\%$ 的数据，保证 $1 \leq T\leq 10^3$，$1\leq n,m\leq 10^6$。



---

---
title: "[SDOI2017] 新生舞会"
layout: "post"
diff: 省选/NOI-
pid: P3705
tag: ['2017', '二分', '各省省选', '山东', 'O2优化', '分数规划', '费用流']
---
# [SDOI2017] 新生舞会
## 题目描述

学校组织了一次新生舞会，Cathy 作为经验丰富的老学姐，负责为同学们安排舞伴。


有 $n$ 个男生和 $n$ 个女生参加舞会，一个男生和一个女生一起跳舞，互为舞伴。


Cathy 收集了这些同学之间的关系，比如两个人之前认识没，计算得出 $a_{i,j}$。

Cathy 还需要考虑两个人一起跳舞是否方便，比如身高体重差别会不会太大，计算得出 $b_{i,j}$，表示第 $i$ 个男生和第 $j$ 个女生一起跳舞时的不协调程度。


当然，还需要考虑很多其他问题。


Cathy 想先用一个程序通过 $a_{i,j}$ 和 $b_{i,j}$ 求出一种方案，再手动对方案进行微调。

Cathy 找到你，希望你帮她写那个程序。


一个方案中有 n 对舞伴，假设每对舞伴的喜悦程度分别是 $a'_1,a'_2,...,a'_n$，假设每对舞伴的不协调程度分别是 $b'_1,b'_2,...,b'_n$。令

$C=\frac {a'_1+a'_2+...+a'_n}{b'_1+b'_2+...+b'_n}$

Cathy 希望 $C$ 值最大。

## 输入格式

第一行一个整数 $n$。


接下来 $n$ 行，每行 $n$ 个整数，第 $i$ 行第 $j$ 个数表示 $a_{i,j}$。


接下来 $n$ 行，每行 $n$ 个整数，第 $i$ 行第 $j$ 个数表示 $b_{i,j}$。

## 输出格式

一行一个数，表示 $C$ 的最大值。四舍五入保留 $6$ 位小数，选手输出的小数需要与标准输出相等。

## 样例

### 样例输入 #1
```
3
19 17 16
25 24 23
35 36 31
9 5 6
3 4 2
7 8 9
```
### 样例输出 #1
```
5.357143
```
## 提示

对于 10% 的数据，$1\le n\le 5$

对于 40% 的数据，$1\le n\le 18$

另有 20% 的数据，$b_{i,j}\le 1$

对于 100% 的数据，$1\le n\le 100,1\le a_{i,j},b_{i,j}\le10^4$



---

---
title: "[SDOI2017] 相关分析"
layout: "post"
diff: 省选/NOI-
pid: P3707
tag: ['2017', '线段树', '各省省选', '山东', 'Special Judge', '前缀和', '分块']
---
# [SDOI2017] 相关分析
## 题目描述

Frank 对天文学非常感兴趣，他经常用望远镜看星星，同时记录下它们的信息，比如亮度、颜色等等，进而估算出星星的距离，半径等等。

Frank 不仅喜欢观测，还喜欢分析观测到的数据。他经常分析两个参数之间（比如亮度和半径）是否存在某种关系。

现在 Frank 要分析参数 $X$ 与 $Y$ 之间的关系。他有 $n$ 组观测数据，第 $i$ 组观测数据记录了 $x_i$ 和 $y_i$。他需要一下几种操作。

###  $\verb!1 L R!$

用直线拟合第 $L$ 组到第 $R$ 组观测数据。用 $\overline{x}$ 表示这些观测数据中 $x$ 的平均数，用 $\overline{y}$ 表示这些观测数据中 $y$ 的平均数，即
 
$$\begin{aligned}\overline{x}&={1 \over R-L+1} \sum _{i=L} ^R x_i \\\overline{y}&={1 \over R-L+1} \sum _{i=L} ^R y_i\end{aligned}$$

如果直线方程是 $y=ax+b$，那么 $a$ 应当这样计算：

$$a={\displaystyle\sum_{i=L} ^R (x_i-\overline{x})(y_i-\overline{y}) \over \displaystyle\sum _{i=L} ^R (x_i -\overline{x})^2}$$

 
你需要帮助 Frank 计算 $a$。

 
###  $\verb!2 L R S T!$

Frank 发现测量数据第 $L$ 组到第 $R$ 组数据有误差，对每个 $i$ 满足 $L \leq i \leq R$，$x_i$ 需要加上 $S$，$y_i$ 需要加上 $T$。
 
###  $\verb!3 L R S T!$

Frank 发现第 $L$ 组到第 $R$ 组数据需要修改，对于每个 $i$ 满足 $L \leq i \leq R$，$x_i$ 需要修改为 $(S+i)$，$y_i$ 需要修改为 $(T+i)$。

## 输入格式

第一行两个数 $n,m$，表示观测数据组数和操作次数。

接下来一行 $n$ 个数，第 $i$ 个数是 $x_i$。

接下来一行 $n$ 个数，第 $i$ 个数是 $y_i$。

接下来 $m$ 行，表示操作，格式见题目描述。

## 输出格式

对于每个 $1$ 操作，输出一行，表示直线斜率 $a$。选手输出与标准输出的绝对误差或相对误差不超过 $10^{-5}$ 即为正确。

## 样例

### 样例输入 #1
```
3 5
1 2 3
1 2 3
1 1 3
2 2 3 -3 2
1 1 2
3 1 2 2 1
1 1 3

```
### 样例输出 #1
```
1.0000000000
-1.5000000000
-0.6153846154

```
## 提示

### 数据范围及约定

- 对于 $20\%$ 的数据 $1 \leq n,m \leq 1000$；
- 另有 $20\%$ 的数据，没有 $3$ 操作，且 $2$ 操作中 $S=0$；
- 另有 $30\%$ 的数据，没有 $3$ 操作。

对于 $100\%$ 的数据，$1 \leq n,m \leq 10^5$，$0 \leq |S|,|T| \leq 10^5$，$0 \leq |x_i|,|y_i| \leq 10^5$。

保证 $1$ 操作不会出现分母为 $0$ 的情况。



---

---
title: "[BJOI2017] 机动训练"
layout: "post"
diff: 省选/NOI-
pid: P3713
tag: ['动态规划 DP', '搜索', '2017', '各省省选', '记忆化搜索']
---
# [BJOI2017] 机动训练
## 题目背景

> AM 4:45
>
> 又是晴朗的好天气。
>
> AM 5:00
>
> 不要嘛，再睡一会
>
> AM 5:05
>
> 呜……欺负人
## 题目描述

睡眼朦胧的菜酱 (?) 已经被二爷拉起来晨跑了。而这个时间你在做什么呢？

咳咳，言归正传，最近菜酱的训练遇到了点小麻烦。

凌晨绕格瑞赛亚岛跑一圈是基本，在那之后，菜酱还要接受严格的机动训练。所谓机动训练，就是在紧急情况 (?) 下，高速且隐蔽地从位置 $s$ 移动到位置 $t$ 的训练。一般来说，$s$ 和 $t$ 是根据二爷的心情随机决定的，但是由于菜酱已经熟悉了地形，每次总是能找到不太费劲的路径，二爷决定增大难度。所谓增大难度，其实就是指定整条路径，这样菜酱就没办法抄近道了。当然，由于是为了实战而进行的训练，二爷也不会随便乱指定路径，至少不会故意绕路。然后发生的问题就是，如何才能「随机」一整条路径出来？二爷统计了全岛所有的合法路径，打算每次在这个表格里随机抽一条出来。但是很快二爷发现，许多路径所经过的地形是完全相同的，这类路径的训练会更加有用。于是二爷修改了随机策略，地形较为常见的路径权重会变得更大。

一次偶然的机会，菜酱看到了二爷的随机策略，并发动技能「过目不忘 (?)」记了下来。现在你要帮菜酱分析数据。

为什么是你？当然是因为否则就会被菜酱爆头 (并不)。

整个岛可以看作一片 $m\times n$ 的区域，每个格子有自己的地形。

一条路径由一系列八连通的格子组成，两个格子八连通当且仅当这两个格子拥有公共的顶点。

定义一条“机动路径”如下：

1. 它是一条不自交的路径，即路径上任意两个格子都不是同一个。
2. 它的起点和终点处于不同位置，换言之这条路径至少包含 $2$ 个格子。
3. 从起点开始，任何一步只能向不远离终点的方向移动，这里不远离指的是 $x$ 和 $y$ 两个方向都不远离。

举例说明：

```plain
.....t    ......    .---.
-++...    ---...    .-s-.
-s+...    -s+..t    .-+-.
---...    ---...    ..t..
```

图中加号和减号标明了与 $s$ 八连通的所有格子，其中加号是“不远离 $t$”的方向。

因此可以看出，如下路径是机动路径：

```plain
++++++t    ......+t    .......t
+......    .....++.    ......+.
+......    ..++++..    ...+++..
s......    s++.....    s+++....
```

而如下路径不是机动路径：

```plain
\../---t    .......t    .s.
|--.....    ....../.    /..
|.......    s..../..    \..
s.......    .\--/...    .t.
```

需要注意的是，某些不合法的路径甚至比机动路径还要短，这是因为机动路径不是按照长度来定义的。

接下来定义一条机动路径的地形，岛上的地形由一个矩阵给出，如：

```plain
.**.
*..*
*..*
.**.
```

那么，一条机动路径的地形序列就是它所经过的地形排成一列，如：

```plain
s-\.
...\
...|
...t
```

地形序列就是 `.****.`。

每条机动路径的权重就是与之拥有相同地形序列的机动路径数量之和，例如与这条路径拥有相同地形序列的路径有

```plain
./-t    t...    ...s    s-\.    ./-s    s...    ...t    t-\.
/...    |...    ...|    ...\    /...    |...    ...|    ...\
|...    \...    .../    ...|    |...    \...    .../    ...|
s...    .\-s    t-/.    ...t    t...    .\-t    s-/.    ...s
```

共 $8$ 条，注意回文时正反算两条，以及自己也算一条。

所以这条机动路径的权重是 $8$，同时所有这 $8$ 条机动路径的权重都是 $8$。

现在你需要统计所有的机动路径权重之和。

如果对这种统计方式没有直观的感受，可以查看样例说明。

## 输入格式

第一行两个整数 $m,n$，表示岛的大小。

接下来 $m$ 行，每行 $n$ 个字符，表示岛的地形。
## 输出格式

仅一个数，表示所有机动路径的权重之和。

由于这个数可能很大，你只需要输出它对 $10^9+9$ 取模的结果。
## 样例

### 样例输入 #1
```
2 2
.*
*.
```
### 样例输出 #1
```
72
```
### 样例输入 #2
```
2 3
.*.
*.*
```
### 样例输出 #2
```
418
```
### 样例输入 #3
```
4 4
abba
baab
baab
abba
```
### 样例输出 #3
```
44512
```
## 提示

### 样例解释 1
用中括号括起来的一些数对表示一条机动路径，坐标先行后列：

- 地形序列 `.*`：$[(1, 1), (1, 2)],\ [(1, 1), (2, 1)],\ [(2, 2), (2, 1)],\ [(2, 2), (1, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。
- 地形序列 `*.`：$[(1, 2), (1, 1)],\ [(2, 1), (1, 1)],\ [(2, 1), (2, 2)],\ [(1, 2), (2, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。
- 地形序列 `..`：$[(1, 1), (2, 2)],\ [(2, 2), (1, 1)]$，共 $2$ 条，每条权重为 $2$，计 $4$。
- 地形序列 `**`：$[(1, 2), (2, 1)],\ [(2, 1), (1, 2)]$，共 $2$ 条，每条权重为 $2$，计 $4$。
- 地形序列 `.*.`：$[(1, 1), (1, 2), (2, 2)],\ [(1, 1), (2, 1), (2, 2)],\ [(2, 2), (2, 1), (1, 1)],\ [(2, 2), (1, 2), (1, 1)]$，共 $4$ 条，每条权重为 $4$，计 $16$。
- 地形序列 `*.*`：$[(1, 2), (1, 1), (2, 1)],\ [(2, 1), (1, 1), (1, 2)],\ [(1, 2), (2, 2), (2, 1)],\ [(2, 1), (2, 2), (1, 2)]$，共 $4$ 条，每条权重为 $4$，计 $16$。

共计 $16+16+4+4+16+16=72$。

### 样例解释 2
- 地形序列 `.*`：$7$ 条，每条权重为 $7$，计 $49$。
- 地形序列 `*.`：$7$ 条，每条权重为 $7$，计 $49$。
- 地形序列 `..`：$4$ 条，每条权重为 $4$，计 $16$。
- 地形序列 `**`：$4$ 条，每条权重为 $4$，计 $16$。
- 地形序列 `..*`：$2$ 条，每条权重为 $2$，计 $4$。
- 地形序列 `.*.`：$10$ 条，每条权重为 $10$，计 $100$。
- 地形序列 `.**`：$2$ 条，每条权重为 $2$，计 $4$。
- 地形序列 `*..`：$2$ 条，每条权重为 $2$，计 $4$。
- 地形序列 `*.*`：$10$ 条，每条权重为 $10$，计 $100$。
- 地形序列 `**.`：$2$ 条，每条权重为 $2$，计 $4$。
- 地形序列 `.*.*`：$6$ 条，每条权重为 $6$，计 $36$。
- 地形序列 `*.*.`：$6$ 条，每条权重为 $6$，计 $36$。

共计 $49+49+16+16+4+100+4+4+100+4+36+36=418$。

### 数据范围

- 对于 $10\%$ 的数据，$m\times n \le 4$。
- 对于 $30\%$ 的数据，$m, n \le 5$。
- 对于 $60\%$ 的数据，$m, n \le 10$。
- 另有 $20\%$ 的数据，所有地形均相同。
- 对于 $100\%$ 的数据，$1 \le m, n \le 30$，字符集由大小写字母，数字和 `.` `*` 构成。


---

---
title: "[BJOI2017] 树的难题"
layout: "post"
diff: 省选/NOI-
pid: P3714
tag: ['2017', '各省省选', '点分治', '单调队列', '分治', '深度优先搜索 DFS']
---
# [BJOI2017] 树的难题
## 题目描述

给你一棵 $n$ 个点的无根树。

树上的每条边具有颜色。一共有 $m$ 种颜色，编号为 $1$ 到 $m$，第 $i$ 种颜色的权值为 $c_i$。

对于一条树上的简单路径，路径上经过的所有边按顺序组成一个颜色序列，序列可以划分成若干个相同颜色段。定义路径权值为颜色序列上每个同颜色段的颜色权值之和。

请你计算，经过边数在 $l$ 到 $r$ 之间的所有简单路径中，路径权值的最大值。
## 输入格式

第一行，四个整数 $n, m, l, r$。

第二行，$m$ 个整数 $c_1, c_2, \ldots, c_m$，由空格隔开，依次表示每个颜色的权值。

接下来 $n-1$ 行，每行三个整数 $u, v, c$，表示点 $u$ 和点 $v$ 之间有一条颜色为 $c$ 的边。
## 输出格式

输出一行，一个整数，表示答案。

## 样例

### 样例输入 #1
```
5 3 1 4
-1 -5 -2
1 2 1
1 3 1
2 4 2
2 5 3
```
### 样例输出 #1
```
-1
```
### 样例输入 #2
```
8 4 3 4
-7 9 6 1
1 2 1
1 3 2
1 4 1
2 5 1
5 6 2
3 7 1
3 8 3
```
### 样例输出 #2
```
11
```
## 提示

### 样例解释 1
颜色权值均为负，最优路径为 $(1, 2)$ 或 $(1, 3)$。

### 样例解释 2
最优路径为 $(3, 1, 2, 5, 6)$，其颜色序列为 $(2, 1, 1, 2)$。

### 数据范围
| 测试点编号 | $n$ | $m$ | 特殊限制 |
|-|-|-|-|
| $1$ | $=10^3$ | $\le n$ | 无特殊限制 |
| $2$ | $=10^4$ | $=2$ | 无特殊限制 |
| $3$ | $=10^5$ | $\le n$ | 所有点的度数不超过 $2$ |
| $4$ | $=2\times10^5$ | $\le n$ | 所有点的度数不超过 $2$ |
| $5$ | $=10^5$ | $=10$ | $l=1$，$r=n-1$ |
| $6$ | $=2\times10^5$ | $\le n$ | $l=1$，$r=n-1$ |
| $7$ | $=10^5$ | $=50$ | 无特殊限制 |
| $8$ | $=10^5$ | $\le n$ | 无特殊限制 |
| $9$ | $=2\times 10^5$ | $=100$ | 无特殊限制 |
| $10$ | $=2\times 10^5$ | $\le n$ | 无特殊限制 |

对于 $100\%$ 的数据，$1 \leq n, m \leq 2 \times 10^5$，$1 \leq l \leq r \leq n$，$\mid c_i \mid \leq 10^4$。保证树上至少存在一条经过边数在 $l$ 到 $r$ 之间的路径。


---

---
title: "[BJOI2017] 魔法咒语"
layout: "post"
diff: 省选/NOI-
pid: P3715
tag: ['字符串', '2017', '各省省选', '矩阵加速', 'AC 自动机', '构造']
---
# [BJOI2017] 魔法咒语
## 题目描述

Chandra 是一个魔法天才。

从一岁时接受火之教会洗礼之后，Chandra 就显示出对火元素无与伦比的亲和力，轻而易举地学会种种晦涩难解的法术。这也多亏 Chandra 有着常人难以企及的语言天赋，让她能轻松流利地说出咒语中那些极其拗口的魔法词汇。

直到十四岁，开始学习威力强大的禁咒法术时，Chandra 才遇到了障碍。

根据火之魔法规则，禁咒的构成单位是 $N$ 个基本词汇。施法时只要凝聚精神力，说出一段用这些词语组成的长度恰好等于 $L$ 的语言，就能释放威力超乎想象的火法术。过去的魔法师们总结了几种表达起来最连贯的组合方式，方便施法者以最快语速完成法术。

但具有魔法和语言双重天才的 Chandra 不满足于这几种流传下来的禁咒，因为她可以毫无困难地说出普通人几乎不可能表达的禁咒语句。然而，在实际施法时，Chandra 发现有些自创禁咒念出后不但没有预期效果，反而会使自己的精神力迅速枯竭，十分难受。

这个问题令 Chandra 万分不解。她大量阅读典籍，到处走访魔法学者，并且不顾精神折磨一次又一次尝试新咒语，希望找出问题的答案。

很多年过去了，在一次远古遗迹探险中，Chandra 意外闯进了火之神艾利克斯的不知名神殿。根据岩土特征分析，神殿应该有上万年的历史，这是极其罕见的。Chandra 小心翼翼地四处探索，沿着魔力流动来到一间密室。她看见密室中央悬浮着一本书籍。在魔法保护下书籍状况完好。精通上古语言的 Chandra 读过此书，终于解开了多年的困惑。


禁咒法术之所以威力强大，是因为咒语借用了火之神艾利克斯的神力。这本书里记载了艾利克斯生平忌讳的 $M$ 个词语，比如情敌的名字、讨厌的植物等等。使用禁咒法术时，如果语言中含有任何忌讳词语，就会触怒神力而失效，施法者也一并遭受惩罚。

例如，若 `banana` 是唯一的忌讳词语，`an`、`ban`、`analysis` 是基本词汇，禁咒长度须是 $11$，则 `bananalysis` 是无效法术，`analysisban`、`anbanbanban` 是两个有效法术。注意：一个基本词汇在禁咒法术中可以出现零次、一次或多次；只要组成方式不同就认为是不同的禁咒法术，即使书写形式相同。

谜题破解，Chandra 心情大好。她决定计算一共有多少种有效的禁咒法术。

由于答案可能很大，你只需要输出答案模 $10 ^ 9 + 7$ 的结果。

## 输入格式

第一行，三个正整数 $N, M, L$。

接下来 $N$ 行，每行一个只含小写英文字母的字符串，表示一个基本词汇。

接下来 $M$ 行，每行一个只含小写英文字母的字符串，表示一个忌讳词语。

## 输出格式

仅一行，一个整数，表示答案（模 $10^9+7$）。

## 样例

### 样例输入 #1
```
4 2 10
boom
oo
ooh
bang
ob
mo
```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
3 1 3
a
ab
aba
aaa
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
3 1 14
ban
an
analysis
banana
```
### 样例输出 #3
```
15
```
## 提示

【样例解释 1】

有效的禁咒法术共有 $14$ 种：`boom/bang/oo`，`oo/oo/oo/oo/oo`，`oo/oo/ooh/ooh`，`oo/ooh/oo/ooh`，`oo/ooh/ooh/oo`，`ooh/oo/oo/ooh`，`ooh/oo/ooh/oo`，`
ooh/ooh/boom`，`ooh/ooh/oo/oo`，`ooh/ooh/bang`，`ooh/bang/ooh`，`bang/oo/oo/oo`，`bang/ooh/ooh`，`bang/bang/oo`。

【样例解释 2】

有效的禁咒法术有 `a/ab`，`ab/a`，`aba` 共三种。注意，`ab/a` 和 `aba` 算成两种不同的禁咒法术。

【数据规模与约定】

本题一共有 $10$ 个测试点。

下表是每个测试点的数据规模和约定：

 ![](https://cdn.luogu.com.cn/upload/pic/5191.png) 

对于 $100\%$ 的数据，$1 \le N, M \le 50，1 \le L \le 10^8$，基本词汇的长度之和不超过 $100$，忌讳词语的长度之和不超过 $100$。保证基本词汇不重复，忌讳词语不重复。



---

---
title: "[AH2017/HNOI2017] 单旋"
layout: "post"
diff: 省选/NOI-
pid: P3721
tag: ['模拟', '2017', '线段树', '各省省选', '离散化', '湖南', '动态树 LCT']
---
# [AH2017/HNOI2017] 单旋
## 题目描述

H国是一个热爱写代码的国家，那里的人们很小去学校学习写各种各样的数据结构。伸展树（splay）是一种数据结构，因为代码好写，功能多，效率高，掌握这种数据结构成为了H国的必修技能。有一天，邪恶的“卡”带着他的邪恶的“常数”来企图毁灭H国。“卡”给H国的人洗脑说，splay如果写成单旋的，将会更快。“卡”称“单旋splay”为“spaly”。虽说他说的很没道理，但还是有H国的人相信了，小H就是其中之一，spaly马上成为他的信仰。而H国的国王，自然不允许这样的风气蔓延，国王构造了一组数据，数据由m（不超过10^5）个操作构成，他知道这样的数据肯定打垮spaly，但是国王还有很多很多其他的事情要做，所以统计每个操作

所需要的实际代价的任务就交给你啦。数据中的操作分为5种：

1. 插入操作：向当前非空spaly中插入一个关键码为key的新孤立节点。插入方法为，先让key和根比较，如果key比根小，则往左子树走，否则往右子树走，如此反复，直到某个时刻，key比当前子树根x小，而x的左子树为空，那就让key成为x的左孩子；或者key比当前子树根x大，而x的右子树为空，那就让key成为x的右孩子。该操作的代价为：插入后，key的深度。特别地，若树为空，则直接让新节点成为一个单个节点的树。（各节点关键码互不相等。对于“深度”的解释见末尾对spaly的描述。）

2. 单旋最小值:将spaly中关键码最小的元素xmin单旋到根。操作代价为：单旋前xmin的深度。（对于单旋操作的解释见末尾对spaly的描述。）

3. 单旋最大值:将spaly中关键码最大的元素xmax单旋到根。操作代价为：单旋前xmax的深度。

4. 单旋删除最小值：先执行2号操作，然后把根删除。由于2号操作之后，根没有左子树，所以直接切断根和右子树的联系即可。（具体见样例解释）。操作代价同2号操作。

5. 单旋删除最大值：先执行3号操作，然后把根删除。操作代价同3号操作。

 ![](https://cdn.luogu.com.cn/upload/pic/5106.png) 

对于不是H国的人，你可能需要了解一些spaly的知识，才能完成国王的任务：

1. spaly是一棵二叉树，满足对于任意一个节点x，它如果有左孩子lx，那么lx的关键码小于x的关键码。如果有右孩子rx，那么rx的关键码大于x的关键码。

2. 一个节点在spaly的深度定义为：从根节点到该节点的路径上一共有多少个节点（包括自己）。

3. 单旋操作是对于一棵树上的节点x来说的。一开始，设f为x在树上的父亲。如果x为f的左孩子，那么执行zig(x)操作（如上图中，左边的树经过zig(x)变为了右边的树）,否则执行zag(x)操作（在上图中，将右边的树经过zag(f)就变成了左边的树）。每当执行一次zig(x)或者zag(x),x的深度减小1，如此反复，直到x为根。总之，单旋x就是通过反复执行zig和zag将x变为根。

## 输入格式

输入文件名为 splay.in。

第一行单独一个正整数 m (1 <= m <= 10^5)。

接下来 m 行，每行描述一个操作：首先是一个操作编号 c（ 1<=c<=5），既问题描述中给出的 5 种操作中的编号，若 c= 1，则再输入一个非负整数 key，表示新插入节点的关键码。

## 输出格式

输出文件名为 splay.out。

输出共 m 行，每行一个整数，第 i 行对应第 i 个输入的操作的代价。

## 样例

### 样例输入 #1
```
5
1 2
1 1
1 3
4 
5
```
### 样例输出 #1
```
1 
2 
2
2 
2
```
## 提示

20%的数据满足： 1 <= m <= 1000。

另外 30%的数据满足： 不存在 4,5 操作。

100%的数据满足： 1<=m<=10^5； 1<=key<=10^9。 所有出现的关键码互不相同。 任何一个非插入操作，一定保证树非空。 在未执行任何操作之前，树为空。



---

---
title: "[AH2017/HNOI2017] 影魔"
layout: "post"
diff: 省选/NOI-
pid: P3722
tag: ['2017', '线段树', '各省省选', '湖南', '排序', '栈']
---
# [AH2017/HNOI2017] 影魔
## 题目背景

影魔，奈文摩尔，据说有着一个诗人的灵魂。事实上，他吞噬的诗人灵魂早已成千上万。

千百年来，他收集了各式各样的灵魂，包括诗人、牧师、帝王、乞丐、奴隶、罪人，当然，还有英雄。

每一个灵魂，都有着自己的战斗力，而影魔，靠这些战斗力提升自己的攻击。
## 题目描述

奈文摩尔有 $n$ 个灵魂，他们在影魔宽广的体内可以排成一排，从左至右标号 $1$ 到 $n$。第 $i$ 个灵魂的战斗力为 $k_i$，灵魂们以点对的形式为影魔提供攻击力。对于灵魂对 $i, j\ (i<j)$ 来说，若不存在 $k_s\ (i<s<j)$ 大于 $k_i$ 或者 $k_j$，则会为影魔提供 $p_1$ 的攻击力。另一种情况，令 $c$ 为 $k_{i + 1}, k_{i + 2}, \cdots, k_{j -1}$ 的最大值，若 $c$ 满足：$k_i < c < k_j$，或者 $k_j < c < k_i$，则会为影魔提供 $p_2$ 的攻击力，当这样的 $c$ 不存在时，自然不会提供这 $p_2$ 的攻击力；其他情况的点对，均不会为影魔提供攻击力。

影魔的挚友噬魂鬼在一天造访影魔体内时被这些灵魂吸引住了，他想知道，对于任意一段区间 $[a, b]$，位于这些区间中的灵魂对会为影魔提供多少攻击力，即考虑所有满足 $a\le i<j\le b$ 的灵魂对 $i, j$ 提供的攻击力之和。

顺带一提，灵魂的战斗力组成一个 $1$ 到 $n$ 的排列：$k_1, k_1, \cdots, k_n$。
## 输入格式

第一行四个整数 $n,m,p_1,p_2$。  

第二行 $n$ 个整数 $k_1, k_2,\cdots, k_n$。

接下来 $m$ 行,每行两个数 $a,b$，表示询问区间 $[a,b]$ 中的灵魂对会为影魔提供多少攻击力。
## 输出格式

共输出 $m$ 行，每行一个答案，依次对应 $m$ 个询问。
## 样例

### 样例输入 #1
```
10 5 2 3
7 9 5 1 3 10 6 8 2 4
1 7
1 9
1 3
5 9
1 5
```
### 样例输出 #1
```
30
39
4
13
16
```
## 提示

对于 $30\%$ 的数据，$1\le n, m\le 500$。

另有 $30\%$ 的数据，$p_1 = 2p_2$。

对于 $100\%$ 的数据，$1\le n,m\le 200000, 1\le p_1, p_2\le 1000$。


---

---
title: "[AH2017/HNOI2017] 礼物"
layout: "post"
diff: 省选/NOI-
pid: P3723
tag: ['2017', '各省省选', '递归', '安徽', '湖南', '进制', '快速傅里叶变换 FFT']
---
# [AH2017/HNOI2017] 礼物
## 题目描述

我的室友最近喜欢上了一个可爱的小女生。马上就要到她的生日了，他决定买一对情侣手环，一个留给自己，一个送给她。每个手环上各有 $n$ 个装饰物，并且每个装饰物都有一定的亮度。

但是在她生日的前一天，我的室友突然发现他好像拿错了一个手环，而且已经没时间去更换它了！他只能使用一种特殊的方法，将其中一个手环中所有装饰物的亮度增加一个相同的非负整数 $c$。并且由于这个手环是一个圆，可以以任意的角度旋转它，但是由于上面装饰物的方向是固定的，所以手环不能翻转。需要在经过亮度改造和旋转之后，使得两个手环的差异值最小。

在将两个手环旋转且装饰物对齐了之后，从对齐的某个位置开始逆时针方向对装饰物编号 $1 \sim n$，其中 $n$ 为每个手环的装饰物个数， 第 $1$ 个手环的 $i$ 号位置装饰物亮度为 $x_i$，第 $2$ 个手环的 $i$ 号位置装饰物亮度为 $y_i$，两个手环之间的差异值为（参见输入输出样例和样例解释）：

$$\sum_{i=1}^{n} (x_i-y_i)^2$$

麻烦你帮他计算一下，进行调整（亮度改造和旋转），使得两个手环之间的差异值最小，这个最小值是多少呢？

## 输入格式

输入数据的第一行有两个数 $n,m$，代表每条手环的装饰物的数量为 $n$，每个装饰物的初始亮度小于等于 $m$。

接下来两行，每行各有 $n$ 个数，分别代表第一条手环和第二条手环上从某个位置开始逆时针方向上各装饰物的亮度。

## 输出格式

输出一个数，表示两个手环能产生的最小差异值。注意在将手环改造之后，装饰物的亮度可以大于 $m$。

## 样例

### 样例输入 #1
```
5 6
1 2 3 4 5
6 3 3 4 5
```
### 样例输出 #1
```
1
```
## 提示

【样例解释】

需要将第一个手环的亮度增加 $1$，第一个手环的亮度变为：$2,3,4,5,6$

旋转一下第二个手环。对于该样例，是将第二个手环的亮度 $6,3,3,4,5$ 向左循环移动一个位置，使得第二手环的最终的亮度为：$3,3,4,5,6$。

此时两个手环的亮度差异值为 $1$。

【数据范围】

对于 $30\%$ 的数据，$n \le 500$，$m \le 10$；

对于 $70\%$ 的数据，$n \le 5000$；

对于 $100\%$ 的数据，$1 \le n \le 50000$, $1 \le a_i \le m \le 100$。



---

---
title: "[HAOI2017] 新型城市化"
layout: "post"
diff: 省选/NOI-
pid: P3731
tag: ['2017', '河南', '各省省选', '强连通分量', '二分图']
---
# [HAOI2017] 新型城市化
## 题目描述

Anihc 国有 $n$ 座城市。城市之间存在一些贸易合作关系，如果城市 $x$ 与城市 $y$ 之间存在贸易协定，那么城市 $x$ 和城市 $y$ 则是一对贸易伙伴（注意： $(x,y)$ 和 $(y,x)$ 是同一对城市）。

为了实现新型城市化，实现统筹城乡一体化以及发挥城市群辐射与带动作用，国家决定规划新型城市关系。一些城市能够被称为城市群的条件是：这些城市两两都是贸易伙伴。由于Anihc 国之前也一直很重视城市关系建设，所以可以保证在目前已存在的贸易合作关系的情况下 Anihc 的 $n$ 座城市可以恰好被划分为不超过两个城市群。

为了建设新型城市关系 Anihc 国想要选出两个之前并不是贸易伙伴的城市，使这两个城市成为贸易伙伴，并且要求在这两个城市成为贸易伙伴之后，最大城市群的大小至少比他们成为贸易伙伴之前的最大城市群的大小增加 $1$。

Anihc 国需要在下一次会议上讨论扩大建设新型城市关系的问题，所以要请你求出在哪些城市之间建立贸易伙伴关系可以使得这个条件成立，即建立此关系前后的最大城市群的大小至少相差 $1$。
## 输入格式

第一行 $2$ 个整数 $n,m$，表示城市的个数，目前还没有建立贸易伙伴关系的城市的对数。

接下来 $m$ 行，每行 $2$ 个整数 $x,y$ 表示城市 $x,y$ 之间目前还没有建立贸易伙伴关系。
## 输出格式

第一行 $1$ 个整数 $\text{ans}$，表示符合条件的城市的对数。

接下来 $\text{ans}$ 行，每行两个整数，表示一对可以选择来建立贸易伙伴关系的城市。对于一对城市 $x,y$，请先输出编号更小的那一个。最后城市对与城市对之间顺序请按照字典序从小到大输出。
## 样例

### 样例输入 #1
```
5 3
1 5
2 4
2 5
```
### 样例输出 #1
```
2
1 5
2 4
```
## 提示

数据点 $1$：$n\le 16$；

数据点 $2$：$n\le 16$；

数据点 $3\sim 5$：$n\le 100$；

数据点 $6$：$n\le 500$；

数据点 $7\sim10$：$n\le 10^4$。

对于所有的数据保证： $n \le 10^4,0 \le m \le \min(1.5\times 10^5,\dfrac{n(n-1)}{2})$。保证输入的城市关系中不会出现 $(x,x)$ 这样的关系，同一对城市也不会出现两次（无重边，无自环）。


---

---
title: "[HAOI2017] 供给侧改革"
layout: "post"
diff: 省选/NOI-
pid: P3732
tag: ['2017', '河南', '各省省选', '排序', '进制', '字典树 Trie']
---
# [HAOI2017] 供给侧改革
## 题目描述

你调查了某个产业近来 $n$ 个时期的供求关系平衡情况，每个时期的情况都用 $0$ 或 $1$ 中的一个数字来表示。于是这就是—个长度为 $n$ 的 $\texttt{01}$ 字符串 $S$。为了更好的了解这一些数据，你需要解决一些询问，我们令 $\text{data}(L,R)$ 表示：在字符串 $S$ 中，起始位置在 $[L,R]$ 之间的这些后缀之中，具有最长公共前缀的两个后缀的最长公共前缀的长度。

对于每一个询问 $L,R$，求：

$$ans = \sum_{L \leqslant i < R} \text{data}(i,R)$$

数据范围保证，串 $S$ 中的每一位都是在 $0$ 和 $1$ 之间随机产生的。
## 输入格式

第一行 $2$ 个整数 $n,Q$，表示字符串的长度，以及询问个数。

接下来一行长度为 $n$ 的一个 $\texttt{01}$ 串 $S$。

接下来 $Q$ 行，每行 $2$ 个整数 $L,R$，一个询问 $L,R$。
## 输出格式


共 $Q$ 行，每行一个整数，表示对应询问的答案。
## 样例

### 样例输入 #1
```
6 3
010110
2 5
1 6
1 2
```
### 样例输出 #1
```
4
6
0
```
## 提示

【数据规模与约定】

|数据点|$n$ 的规模|$Q$ 的规模|
|:-:|:-:|:-:|
|$1,2$|$\leqslant 20$|$\leqslant 20$|
|$3,4$|$\leqslant 100$|$\leqslant 100$|
|$5,6$|$\leqslant 5 \times 10^3$|$\leqslant 5 \times 10^3$|
|$7,8,9,10$|$\leqslant 10^5$|$\leqslant 10^5$|



对于所有的数据保证：$n \leqslant 10^5$，$Q \leqslant 10^5$，$1 \leqslant L < R \leqslant n$，$\texttt{01}$ 串随机生成。


---

---
title: "[HAOI2017] 八纵八横"
layout: "post"
diff: 省选/NOI-
pid: P3733
tag: ['2017', '河南', '线段树', '各省省选', '分治', '线性基', '线段树分治']
---
# [HAOI2017] 八纵八横
## 题目描述

Anihc 国有 $n$ 个城市，这 $n$ 个城市从 $1$ 到 $n$ 编号，$1$ 号城市为首都。城市间初始时有 $m$ 条高速公路，每条高速公路都有一个非负整数的经济影响因子，每条高速公路的两端都是城市（可能两端是同一个城市），保证任意两个城市都可以通过高速公路互达。

国正在筹划“八纵八横”的高铁建设计划，计划要修建一些高速铁路，每条高速铁路两端也都是城市（可能两端是同一个城市)，也都有一个非负整数的经济影响因子。国家还计划在“八纵八横”计划建成之后，将“一带一路”扩展为“一带一路一环”，增加“内陆城市经济环”即选择一条从首都出发沿若一系列高铁与高速公路走的路径，每条高铁或高速公路可以经过多次，每座城市也可以经过多次，最后路径又在首都结束。令“内陆城市经济环”的 GDP 为依次将这条路径上所经过的高铁或高速公路的经济影响因子异或起来（一条路经过多次则会被计算多次）。

现在 Anihc 在会议上讨论“八纵八横”的建设计划方案，他们会不断地修改计划方案，希望你能实时反馈对于当前的“八纵八横”的建设计划的方案“内陆城市经济环”的最大是多少。

初始时，八纵八横计划中不包含任何一条高铁，有以下 $3$ 种操作：

`Add x y z`

在计划中给在城市 $x$ 和城市 $y$ 之间建设一条高铁，其经济影响因子为 $z$，如果这是第 $k$ 个 `Add` 操作，则将这条高铁命名为 $k$ 号高铁。

`Cancel k`

将计划中的 $k$ 号高铁取消掉，保证此时 $k$ 号高铁一定存在。

`Change k z`

表示将第 $k$ 号高铁的经济影响因子更改为 $z$，保证此时 $k$ 号高铁一定存在。

## 输入格式

第一行 $3$ 个整数 $n,m,Q$，表示城市个数，高速公路条数，操作个数。

接下来 $m$ 行，每行 $3$ 个整数表示高速公路的信息。

接下来 $Q$ 行，每行为一个操作。

注意：输入的所有经济影响因子都将以二进制的形式从高位到低位给出。

## 输出格式

第一行一个整数。表示如果不修建任何高铁，“内陆城市经济环”的 GDP 最大值。

接下 $Q$ 行每行一个整数，表示进行了对应的每一个操作之后，对于当前的计划，“内陆城市经济环”的 GDP 最大值。

注意：输出的答案也要以二进制的形式从高位到低位给出。

## 样例

### 样例输入 #1
```
4 4 3
1 2 1110
1 3 10
2 4 1110
2 3 100
Add 3 4 11
Change 1 101
Cancel 1
```
### 样例输出 #1
```
1000
1001
1111
1000
```
## 提示

### 数据规模与约定

令所有的经济因子二进制表示的最多位数为 $len$。数据满足以下表格：

| 数据点 | $n$ | $m$ | $Q$ | $len$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 1 | $\leq 5$ | $\leq 8$ | $0$ | $\leq 31$ |  |
| 2 | $\leq 100$ | $=n + 1$ | $0$ | $\leq 100$ |  |
| 3 | $\leq 100$ | $\leq 100$ | $0$ | $\leq 100$ |  |
| 4 | $\leq 500$ | $\leq 500$ | $0$ | $\leq 1000$ |  |
| 5 |$\leq 100$ | $\leq 100$ | $\leq 100$ | $\leq 200$ | 只存在 `Add` 操作 |
| 6 | $\leq 500$ | $\leq 500$ | $\leq 200$ | $\leq 1000$ |  |
| 7 | $\leq 100$ | $\leq 100$ | $\leq 1000$ | $\leq 200$ |  |
| 8 | $\leq 500$ | $\leq 500$ | $\leq 1000$ | $\leq 1000$ |  |
| 9 | $\leq 500$ | $\leq 500$ | $\leq 1000$ | $\leq 1000$ |  |
| 10 | $\leq 500$ | $\leq 500$ | $\leq 1000$ | $\leq 1000$ |  |

对于所有的数据保证：$1\leq n,m\leq 500$，$0\leq Q\leq 1000$，$1\leq len\leq 1000$，$1\leq x,y\leq n$。且 `Add` 操作不超过 $550$ 个。两个城市之间可能有多条高速公路或高铁，高速公路或高铁的两端可能是同一个城市（即：有重边，有自环）。



---

---
title: "[HAOI2017] 方案数"
layout: "post"
diff: 省选/NOI-
pid: P3734
tag: ['2017', '河南', '各省省选']
---
# [HAOI2017] 方案数
## 题目描述

考虑定义非负整数间的“$ \subseteq $”，如果 $ a \subseteq b $，那么 $ a \land b = a $，其中 $ \land $ 表示二进制下的“与”操作。


考虑现在有一个无限大的空间，现在你在 $ (0, 0, 0) $，有三种位移操作。


一、$(x,y,z)\to(x',y,z)$ if $x\subseteq x'$  
二、$(x,y,z)\to(x,y',z)$ if $y\subseteq y'$  
三、$(x,y,z)\to(x,y,z')$ if $z\subseteq z'$  

由于来自东方的神秘力量，有些点被屏蔽了，也就是不能经过了。现在问你到某个点 $ (n, m, r) $ 的方案数，答案对 $ 998244353 $ 取模。

## 输入格式

第一行三个整数 $ n, m, r $。


接下来一行一个整数 $ o $，表示障碍物的数量。


接下来 $ o $ 行，每行三个整数 $ x, y, z $ 表示障碍物的坐标，$ 0 \le x \le n, 0 \le y \le m, 0 \le z \le r $，且障碍物不在 $ (0, 0, 0) $ 和 $ (n, m, r) $ 上，障碍物不会重复。


## 输出格式

一行一个整数，代表要求的答案。

## 样例

### 样例输入 #1
```
1 1 1
0
```
### 样例输出 #1
```
6
```
## 提示

【样例解释】

有8种状态（0,0,0),(0,0,1),(0,1,0),(0,1,1),(1,0,0),(1,0,1),(1,1,0),(1,1,1),分别方案数为 1,1,1,2,1,2,2,6。

【数据规模和约定】

对于 $ 20\% $ 的数据，满足：$ n, m, r \le 100 $


对于 $ 50\% $ 的数据，满足：$ n, m, r \le 10^6 $


对于另外 $ 20\% $ 的数据，满足：$ o \le 10 $


对于 $ 100\% $ 的数据，满足：$ n, m, r \le 10^{18}, o \le 10^4 $



---

---
title: "[HAOI2016] 字符合并"
layout: "post"
diff: 省选/NOI-
pid: P3736
tag: ['2016', '河南', '各省省选', '枚举', '状压 DP']
---
# [HAOI2016] 字符合并
## 题目描述

有一个长度为 $n$ 的 $01$ 串，你可以每次将相邻的 $k$ 个字符合并，得到一个新的字符并获得一定分数。

得到的新字符和分数由这 $k$ 个字符确定。你需要求出你能获得的最大分数。

## 输入格式

输入的第一行是两个整数，分别代表字符串长度 $n$ 和参数 $k$。  

输入的第二行有 $n$ 个用空格隔开的非零即一的字符，第 $i$ 个字符表示初始串的第 $i$ 个字符。。  

第 $3$ 到第 $(2^k + 2)$ 行，每行有一个字符和一个整数，第 $(i + 2)$ 行的字符 $c_i$ 个整数 $w_i$ 表示长度为 $k$ 的 $01$ 串连成二进制后按从小到大顺序得到的第 $i$ 种合并方案得到的新字符,  $w_i$ 表示对应的第 $i$ 种方案对应获得的分数。  
## 输出格式

输出一个整数表示答案。

## 样例

### 样例输入 #1
```
3 2
1 0 1
1 10
1 10
0 20
1 30

```
### 样例输出 #1
```
40
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证：

- $1\leq n\leq 300$，$1 \lt k \leq 8$。
- $c_i\in\{0,1\}$，$1 \leq w_i \leq 10^9$。


---

---
title: "[六省联考 2017] 组合数问题"
layout: "post"
diff: 省选/NOI-
pid: P3746
tag: ['数学', '递推', '2017', '各省省选', '矩阵乘法']
---
# [六省联考 2017] 组合数问题
## 题目描述

组合数 $C_n^m$ 表示的是从 $n$ 个互不相同的物品中选出 $m$ 个物品的方案数。举个例子， 从 $(1, 2, 3)$ 三个物品中选择两个物品可以有 $(1, 2)$，$(1, 3)$，$(2, 3)$ 这三种选择方法。根据组合数的定义，我们可以给出计算组合数  $C_n^m$  的一般公式：

$$ C_n^m = \frac {n!} {m! \ (n - m)!}  $$

其中 $n! = 1 \times 2 \times \cdots \times n$。（特别地，当 $n = 0$ 时，$n! = 1$；当 $m > n$ 时，$C_n^m = 0$。）

小葱在 NOIP 的时候学习了 $C_i^j$ 和 $k$ 的倍数关系，现在他想更进一步，研究更多关于组合数的性质。小葱发现，$C_i^j$ 是否是 $k$ 的倍数，取决于 $C_i^j \bmod k$ 是否等于 $0$，这个神奇的性质引发了小葱对 $\mathrm{mod}$ 运算（取余数运算）的兴趣。现在小葱选择了是四个整数 $n, p, k, r$，他希望知道

$$\left( \sum_{i = 0}^\infty C_{nk}^{ik + r} \right) \bmod p,$$

即

$$\left( C_{nk}^{r} + C_{nk}^{k + r} + C_{nk}^{2k + r} + \cdots + C_{nk}^{(n - 1)k + r}  + C_{nk}^{nk + r} + \cdots \right) \bmod p$$

的值。
## 输入格式

第一行有四个整数 $n, p, k, r$，所有整数含义见问题描述。
## 输出格式

一行一个整数代表答案。
## 样例

### 样例输入 #1
```
2 10007 2 0
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
20 10007 20 0
```
### 样例输出 #2
```
176
```
## 提示

对于 $30\%$ 的测试点，$1 \leq n, k \leq 30$，$p$ 是质数；   
对于另外 $5\%$ 的测试点，$p = 2$；  
对于另外 $5\%$ 的测试点，$k = 1$；  
对于另外 $10\%$ 的测试点，$k = 2$；  
对于另外 $15\%$ 的测试点，$1 \leq n \leq 10^3, 1 \leq k \leq 50$，$p$ 是质数；  
对于另外 $15\%$ 的测试点，$1 \leq n \times k \leq 10^6$，$p$ 是质数；  
对于另外 $10\%$ 的测试点，$1 \leq n \leq 10^9, 1 \leq k \leq 50$，$p$ 是质数；  
对于 $100\%$ 的测试点，$1 \leq n \leq 10^9, 0 \leq r < k \leq 50, 2 \leq p \leq 2^{30} - 1$。



---

---
title: "[六省联考 2017] 相逢是问候"
layout: "post"
diff: 省选/NOI-
pid: P3747
tag: ['数学', '2017', '线段树', '各省省选', 'O2优化', '素数判断,质数,筛法']
---
# [六省联考 2017] 相逢是问候
## 题目描述

> Informatik verbindet dich und mich.  
> 信息将你我连结。

B 君希望以维护一个长度为 $n$ 的数组，这个数组的下标为从 $1$ 到 $n$ 的正整数。

一共有 $m$ 个操作，可以分为两种：

- `0 l r` 表示将第 $l$ 个到第 $r$ 个数（ $a_l,a_{l+1} ...a_r$）中的每一个数 $a_i$ 替换为 $c^{a_i}$，即 $c$ 的 $a_i$ 次方，其中 $c$ 是输入的一个常数，也就是执行赋值 $a_i = c^{a_i}$。

- `1 l r` 求第 $l$ 个到第 $r$ 个数的和，也就是输出： $\sum_{i=l}^{r}a_i$

因为这个结果可能会很大，所以你只需要输出结果 $\bmod \space p$ 的值即可。

## 输入格式

第一行有四个整数 $n, m, p, c$，所有整数含义见问题描述。  
接下来一行 $n$ 个整数，表示 $a$ 数组的初始值。  
接下来 $m$ 行，每行三个整数，其中第一个整数表示了操作的类型。  

- 如果是 $0$ 的话，表示这是一个修改操作，操作的参数为 $l, r$。
- 如果是 $1$ 的话，表示这是一个询问操作，操作的参数为 $l, r$。


## 输出格式

对于每个询问操作，输出一行，包括一个整数表示答案 $\bmod \space p$ 的值。

## 样例

### 样例输入 #1
```
4 4 7 2
1 2 3 4
0 1 4
1 2 4
0 1 4
1 1 3
```
### 样例输出 #1
```
0
3
```
### 样例输入 #2
```
1 40 19910626 2
0
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
0 1 1
1 1 1
```
### 样例输出 #2
```
1
2
4
16
65536
11418102
18325590
13700558
13700558
13700558
13700558
13700558
13700558
13700558
13700558
13700558
13700558
13700558
13700558
13700558
```
## 提示

【数据范围】  

对于 $0\%$ 的测试点，和样例一模一样；

对于另外 $10\%$ 的测试点，没有修改；

对于另外 $20\%$ 的测试点，每次修改操作只会修改一个位置（也就是 $l = r$ ），并且每个位置至多被修改一次；

• 对于另外 $10\%$ 的测试点， $p = 2$；

对于另外 $10\%$ 的测试点， $p = 3$；

对于另外 $10\%$ 的测试点， $p = 4$；

对于另外 $20\%$ 的测试点， $1\le n,m \le 100$；

对于 $100\%$ 的测试点， $1\le n,m \le 5\times 10^4$，$1 \le p \le 10^8$，$0< c < p$，$0 \le a_i < p$。



---

---
title: "[六省联考 2017] 摧毁“树状图”"
layout: "post"
diff: 省选/NOI-
pid: P3748
tag: ['动态规划 DP', '2017', '各省省选', '枚举']
---
# [六省联考 2017] 摧毁“树状图”
## 题目描述

自从上次神刀手帮助蚯蚓国增添了上千万人口（蚯口？），蚯蚓国发展得越来越繁荣了！最近，他们在地下发现了一些神奇的纸张，经过仔细研究，居然是 D 国 X 市的超级计算机设计图纸！

这台计算机叫做 “树状图”，由 $n$ 个计算节点与 $n - 1$ 条可以双向通信的网线连接而成，所有计算节点用不超过 $n$ 的正整数编号。顾名思义，这形成了一棵树的结构。

蚯蚓国王已在图纸上掌握了这棵树的完整信息，包括 $n$ 的值与 $n - 1$ 条网线的连接信息。于是蚯蚓国王决定，派出蚯蚓国最强大的两个黑客，小 P 和小 H，入侵 “树状图”，尽可能地摧毁它。

小 P 和小 H 精通世界上最好的编程语言，经过一番商量后，他们决定依次采取如 下的步骤：
* 小 P 选择某个计算节点，作为他入侵的起始点，并在该节点上添加一个 **P** 标记。
* 重复以下操作若干次（可以是 $0$ 次）：
    * 小 P 从他当前所在的计算节点出发，选择一条没有被标记过的网线，入侵到该网线的另一端的计算节点，并在路过的网线与目的计算节点上均添加一个 **P** 标记。
* 小 H 选择某个计算节点，作为她入侵的起始点，并在该节点上添加一个 **H** 标记。
* 重复以下操作若干次（可以是 $0$ 次）：
    * 小 H 从她当前所在的计算节点出发，选择一条没有被标记过的网线，入侵到该网线的另一端的计算节点，并在路过的网线与目的计算节点上均添加一个 **H** 标记。（注意，小 H 不能经过带有 **P** 标记的网线，但是可以经过带有 **P** 标记的计算节点）
* 删除所有被标记过的计算节点和网线。
* 对于剩下的每条网线，如果其一端或两端的计算节点在上一步被删除了，则也删除这条网线。

经过以上操作后，“树状图” 会被断开，剩下若干个（可能是 $0$ 个）连通块。为了达到摧毁的目的，蚯蚓国王希望，连通块的个数越多越好。于是他找到了你，希望你能帮他计算这个最多的个数。

小 P 和小 H 非常心急，在你计算方案之前，他们可能就已经算好了最优方案或最优方案的一部分。你能得到一个值 $x$：
* 若 $x = 0$，则说明小 P 和小 H 没有算好最优方案，你需要确定他们两个的入侵路线。
* 若 $x = 1$，则说明小 P 已经算好了某种两人合作的最优方案中，他的入侵路线。他将选择初始点 $p_0$，并沿着网线一路入侵到了目标点 $p_1$，并且他不会再沿着网线入侵；你只需要确定小 H 的入侵路线。
* 若 $x = 2$，则说明小 P 和小 H 算好了一种两人合作的最优方案，小 P 从点 $p_0$ 入侵到了 $p_1$ 并停下，小 H 从点 $h_0$ 入侵到了 $h_1$ 并停下。此时你不需要指挥他们入侵了，只需要计算最后两步删除计算节点与网线后，剩下的连通块个数即可。
## 输入格式

每个输入文件包含多个输入数据。输入文件的第一行为两个整数 $T$ 和 $x$，$T$ 表示该文件包含的输入数据个数，$x$ 的含义见上述。（同一个输入文件的所有数据的 x 都是相同的。）

接下来依次输入每个数据。
## 输出格式

对于每个数据，输出一行，表示在给定条件下，剩下连通块的最大个数。
## 样例

### 样例输入 #1
```
1 0
13
1 2
2 3
2 4
4 5
4 6
4 7
7 8
7 9
9 10
10 11
10 12
12 13
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
8 0
1
2
1 2
3
1 2
2 3
4
1 3
2 3
2 4
5
1 5
2 5
3 5
4 5
16
1 2
1 3
1 4
1 5
5 6
5 7
5 8
5 9
9 10
9 11
9 12
9 13
13 14
13 15
13 16
17
1 2
1 3
1 4
1 5
5 6
5 7
5 8
5 17
17 9
9 10
9 11
9 12
9 13
13 14
13 15
13 16
17
8 6
2 6
11 6
4 6
14 2
10 2
5 4
1 4
9 8
17 11
12 5
3 6
13 6
16 8
7 11
15 16

```
### 样例输出 #2
```
0
1
2
2
4
12
13
10

```
### 样例输入 #3
```
8 1
1 1 1
2 1 1
1 2
3 2 2
1 2
2 3
4 2 2
1 3
2 3
2 4
5 5 5
1 5
2 5
3 5
4 5
16 1 5
1 2
1 3
1 4
1 5
5 6
5 7
5 8
5 9
9 10
9 11
9 12
9 13
13 14
13 15
13 16
17 1 5
1 2
1 3
1 4
1 5
5 6
5 7
5 8
5 17
17 9
9 10
9 11
9 12
9 13
13 14
13 15
13 16
17 2 4
8 6
2 6
11 6
4 6
14 2
10 2
5 4
1 4
9 8
17 11
12 5
3 6
13 6
16 8
7 11
15 16

```
### 样例输出 #3
```
0
1
2
2
4
12
13
10

```
## 提示

* 若 $x = 0$，则该行只有一个整数 $n$。
* 若 $x = 1$，则该行依次有三个整数 $n, p_0, p_1$。
* 若 $x = 2$，则该行依次有五个整数 $n, p_0, p_1, h_0, h_1$。

保证 $p_0, p_1, h_0, h_1$ 均为不超过 $n$ 的正整数。

每个数据接下来有 $n - 1$ 行，每行有两个不超过 $n$ 的正整数，表示这两个编号的计算节点之间有一条网线将其相连。保证输入的是一棵树。

同一行相邻的整数之间用恰好一个空格隔开。

**数据文件可能较大，请避免使用过慢的输入输出方法。**

【样例 1 说明】

这个输入文件只有一个输入数据。一种最优的方案如下：

- 小 P 从节点 $2$ 开始入侵，节点 $2$ 被小 P 标记。

- 小 P 从节点 $2$ 入侵到节点 $4$，节点 $4$ 和经过的网线被小 P 标记。

- 小 P 从节点 $4$ 入侵到节点 $7$，节点 $7$ 和经过的网线被小 P 标记。

- 小 H 从节点 $10$ 开始入侵，节点 $10$ 被小 H 标记。

- 删除被标记的节点 $2,4,7,10$ 和被标记的网线 $(2,4)$ 和 $(4,7)$。

- 删除任意一端在上一步被删除的网线。

此时还剩下 $8$ 个连通块。其中节点 $1,3,5,6,8,9,11$ 各自形成一个连通块，节点$12,13$形成了一个连通块。


【样例 2 说明】

- 数据 1：只有 $1$ 个计算节点，唯一可行的方案是小 P 从节点 $1$ 开始入侵（并马上停止），小 H 也从节点 $1$ 入侵到节点 $1$。所有的节点都被删去，剩下 $0$ 个连通块。

- 数据 2：一种最优方案是，小 P 从节点 $1$ 入侵到节点 $1$，小 H 也从节点 $1$ 入侵到节点 $1$。在删除操作后，剩下 $1$ 个连通块（只有节点 $2$）。

- 数据 3：唯一的最优方案是，小 P 从节点 $2$ 入侵到节点 $2$，小 H 也从节点 $2$ 入侵到节点 $2$，剩下 $2$ 个连通块。

- 数据 4：一种最优方案是，小 P 从节点 $2$ 入侵到节点 $2$，小 H 也从节点 $2$ 入侵到节点 $2$，剩下 $2$ 个连通块。

- 数据 5：唯一的最优方案是，小 P 从节点 $5$ 入侵到节点 $5$，小 H 也从节点 $5$ 入侵到节点 $5$，剩下 $4$ 个连通块。



![](https://cdn.luogu.com.cn/upload/pic/38934.png)

![](https://cdn.luogu.com.cn/upload/pic/38935.png)

![](https://cdn.luogu.com.cn/upload/pic/38936.png)

对于整数 $k$，设$\sum n^k$ 为某个输入文件中，其$ T$ 个输入数据的 $n^k$ 之和。

对于所有数据，$T \leq 10^5, \sum n^1 <5 \times 10^5$

请注意初始化的时间复杂度，避免输入大量小数据时超时。

每个测试点的详细数据范围见下表。如果表中 “完全二叉” 为 Yes，则该输入文件的每个数据满足：网线信息的第 $j$ 行 $(1 \leq j < n)$ 输入的两个数依次是 $\left\lfloor \frac {j + 1} {2} \right\rfloor$ 和 $j + 1$。

![](https://cdn.luogu.com.cn/upload/pic/38937.png)


---

---
title: "[六省联考 2017] 寿司餐厅"
layout: "post"
diff: 省选/NOI-
pid: P3749
tag: ['2017', '各省省选', '广度优先搜索 BFS', '深度优先搜索 DFS', '最小割']
---
# [六省联考 2017] 寿司餐厅
## 题目描述

Kiana 最近喜欢到一家非常美味的寿司餐厅用餐。

每天晚上，这家餐厅都会按顺序提供 $n$ 种寿司，第 $i$ 种寿司有一个代号 $a_i$ 和美味度 $d_{i, i}$，不同种类的寿司有可能使用相同的代号。每种寿司的份数都是无限的，Kiana 也可以无限次取寿司来吃，但每种寿司每次只能取一份，且每次取走的寿司必须是按餐厅提供寿司的顺序连续的一段，即 Kiana 可以一次取走第 $1, 2$ 种寿司各一份，也可以一次取走第 $2, 3$ 种寿司各一份，但不可以一次取走第 $1, 3$ 种寿司。

由于餐厅提供的寿司种类繁多，而不同种类的寿司之间相互会有影响：三文鱼寿司和鱿鱼寿司一起吃或许会很棒，但和水果寿司一起吃就可能会肚子痛。因此，Kiana 定义了一个综合美味度 $d_{i, j} \ (i < j)$，表示在一次取的寿司中，如果包含了餐厅提供的从第 $i$ 份到第 $j$ 份的所有寿司，吃掉这次取的所有寿司后将获得的额外美味度。由于取寿司需要花费一些时间，所以我们认为分两次取来的寿司之间相互不会影响。注意在吃一次取的寿司时，不止一个综合美味度会被累加，比如若 Kiana 一次取走了第 $1, 2, 3$ 种寿司各一份，除了 $d_{1, 3}$ 以外，$d_{1, 2}, d_{2, 3}$ 也会被累加进总美味度中。

神奇的是，Kiana 的美食评判标准是有记忆性的，无论是单种寿司的美味度，还是多种寿司组合起来的综合美味度，在计入 Kiana 的总美味度时都只会被累加一次。比如，若 Kiana 某一次取走了第 $1, 2$ 种寿司各一份，另一次取走了第 $2, 3$ 种寿司各一份，那么这两次取寿司的总美味度为 $d_{1, 1} + d_{2, 2} + d_{3, 3} + d_{1, 2} + d_{2, 3}$，其中 $d_{2, 2}$ 只会计算一次。

奇怪的是，这家寿司餐厅的收费标准很不同寻常。具体来说，如果 Kiana 一共吃过了 $c \ (c > 0)$ **种**代号为 $x$ 的寿司，则她需要为这些寿司付出 $mx^2 + cx$ 元钱，其中 $m$ 是餐厅给出的一个常数。

现在 Kiana 想知道，在这家餐厅吃寿司，自己能获得的总美味度（包括所有吃掉的单种寿司的美味度和所有被累加的综合美味度）减去花费的总钱数的最大值是多少。由于她不会算，所以希望由你告诉她。
## 输入格式

第一行包含两个正整数 $n, m$，分别表示这家餐厅提供的寿司总数和计算寿司价格中使用的常数。  
第二行包含 $n$ 个正整数，其中第 $k$ 个数 $a_k$ 表示第 $k$ 份寿司的代号。  
接下来 $n$ 行，第 $i$ 行包含 $n - i + 1$ 个整数，其中第 $j$ 个数 $d_{i, i+j-1}$ 表示吃掉寿司能获得的相应的美味度，具体含义见问题描述。
## 输出格式

输出共一行包含一个正整数，表示 Kiana 能获得的总美味度减去花费的总钱数的最大值。
## 样例

### 样例输入 #1
```
3 1
2 3 2
5 -10 15
-10 15
15
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
5 0
1 4 1 3 4
50 99 8 -39 30
68 27 -75 -32
70 24 72
-10 81
-95
```
### 样例输出 #2
```
381
```
### 样例输入 #3
```
10 1
5 5 4 4 1 2 5 1 5 3
83 91 72 29 22 -5 57 -14 -36 -3
-11 34 45 96 32 73 -1 0 29
-48 68 44 -5 96 66 17 74
88 47 69 -9 2 25 -49
86 -9 -77 62 -10 -30
2 40 95 -74 46
49 -52 2 -51
-55 50 -44
72 22
-68
```
### 样例输出 #3
```
1223
```
## 提示

### 样例解释 1

在这组样例中，餐厅一共提供了 $3$ 份寿司，它们的代号依次为 $a_1 = 2, a_2 = 3, a_3 = 2$，计算价格时的常数 $m = 1$。

在保证每次取寿司都能获得新的美味度的前提下，Kiana 一共有 $14$ 种不同的吃寿司方案。以下列出其中几种：
1. Kiana 一个寿司也不吃，这样她获得的总美味度和花费的总钱数都是 $0$，两者相减也是 $0$；
2. Kiana 只取 $1$ 次寿司，且只取第 $1$ 个寿司，即她取寿司的情况为 $\{[1, 1]\}$，这样获得的总美味度为 $5$，花费的总钱数为 $1 \times 2^2 + 1 \times 2 = 6$，两者相减为 $-1$；
3. Kiana 取 $2$ 次寿司，第一次取第 $1, 2$ 个寿司，第二次取第 $2, 3$ 个寿司，即她取寿司的情况为 $\{[1, 2], [2, 3]\}$，这样获得的总美味度为 $5 + (-10) + 15 + (-10) + 15 = 15$，花费的总钱数为 $(1 \times 2^2 + 2 \times 2) + (1 \times 3^2 + 1 \times 3) = 20$，两者相减为 $-5$；
4. Kiana 取 $2$ 次寿司，第一次取第 $1$ 个寿司，第二次取第 $3$ 个寿司，即她取寿司的情况为 $\{[1, 1], [3, 3]\}$，这样获得的总美味度为 $5 + 15 = 20$，花费的总钱数为 $1 \times 2^2 + 2 \times 2 = 8$，两者相减为 $12$。

在 $14$ 种方案中，惟一的最优方案是列出的最后一种方案，这时她获得的总美味度减去花费的总钱数的值最大为 $12$。

### 数据范围

对于所有数据，保证 $-500 \leq d_{i, j} \leq 500$。

数据的一些特殊约定如下表：

| Case # | $n$ | $a_i$ | $m$ | 附加限制 |
|:-:|:-:|:-:|:-:|:-:|
| 1 | $\leq 2$ | $\leq 30$ | $= 0$ | - |
| 2 | $\leq 2$ | $\leq 30$ | $= 1$ | - |
| 3 | $\leq 3$ | $\leq 30$ | $= 0$ | - |
| 4 | $\leq 3$ | $\leq 30$ | $= 1$ | - |
| 5 | $\leq 5$ | $\leq 30$ | $= 0$ | - |
| 6 | $\leq 5$ | $\leq 30$ | $= 1$ | - |
| 7 | $\leq 10$ | $\leq 30$ | $= 0$ | 所有的 $a_i$ 相同 |
| 8 | $\leq 10$ | $\leq 30$ | $= 1$ | - |
| 9 | $\leq 15$ | $\leq 30$ | $= 0$ | 所有的 $a_i$ 相同 |
| 10 | $\leq 15$ | $\leq 30$ | $= 1$ | - |
| 11 | $\leq 30$ | $\leq 1000$ | $= 0$ | 所有的 $a_i$ 相同 |
| 12 | $\leq 30$ | $\leq 30$ | $= 0$ | 所有的 $a_i$ 相同 |
| 13 | $\leq 30$ | $\leq 1000$ | $= 0$ | - |
| 14 | $\leq 30$ | $\leq 1000$ | $= 1$ | - |
| 15 | $\leq 50$ | $\leq 1000$ | $= 0$ | 所有的 $a_i$ 相同 |
| 16 | $\leq 50$ | $\leq 30$ | $= 0$ | 所有的 $a_i$ 相同 |
| 17 | $\leq 50$ | $\leq 1000$ | $= 0$ | - |
| 18 | $\leq 50$ | $\leq 1000$ | $= 1$ | - |
| 19 | $\leq 100$ | $\leq 1000$ | $= 0$ | - |
| 20 | $\leq 100$ | $\leq 1000$ | $= 1$ | - |


---

---
title: "[六省联考 2017] 分手是祝愿"
layout: "post"
diff: 省选/NOI-
pid: P3750
tag: ['动态规划 DP', '递推', '2017', '各省省选', '枚举', '期望']
---
# [六省联考 2017] 分手是祝愿
## 题目描述

> Zeit und Raum trennen dich und mich.
时空将你我分开。

B 君在玩一个游戏，这个游戏由 $n$ 个灯和 $n$ 个开关组成，给定这 $n$ 个灯的初始状态，下标为从 $1$ 到 $n$ 的正整数。

每个灯有两个状态亮和灭，我们用 $1$ 来表示这个灯是亮的，用 $0$ 表示这个灯是灭的，游戏的目标是使所有灯都灭掉。

但是当操作第 $i$ 个开关时，所有编号为 $i$ 的约数（包括 $1$ 和 $i$）的灯的状态都会被改变，即从亮变成灭，或者是从灭变成亮。

B 君发现这个游戏很难，于是想到了这样的一个策略，每次等概率随机操作一个开关，直到所有灯都灭掉。

这个策略需要的操作次数很多，B 君想到这样的一个优化。如果当前局面，可以通过操作小于等于 $k$ 个开关使所有灯都灭掉，那么他将不再随机，直接选择操作次数最小的操作方法（这个策略显然小于等于 $k$ 步）操作这些开关。

B 君想知道按照这个策略（也就是先随机操作，最后小于等于 $k$ 步，使用操作次数最小的操作方法）的操作次数的期望。

这个期望可能很大，但是 B 君发现这个期望乘以 $n$ 的阶乘一定是整数，所以他只需要知道这个整数对 $100003$ 取模之后的结果。

## 输入格式

第一行两个整数 $n, k$。
接下来一行 $n$ 个整数，每个整数是 $0$ 或者 $1$，其中第 $i$ 个整数表示第 $i$ 个灯的初始情况。

## 输出格式

输出一行，为操作次数的期望乘以 $n$ 的阶乘对 $100003$ 取模之后的结果。

## 样例

### 样例输入 #1
```
4 0
0 0 1 1

```
### 样例输出 #1
```
512
```
### 样例输入 #2
```
5 0
1 0 1 1 1
```
### 样例输出 #2
```
5120
```
## 提示

对于 $0\%$ 的测试点，和样例一模一样；  
对于另外 $30\%$ 的测试点，$n \leq 10$；  
对于另外 $20\%$ 的测试点，$n \leq 100$；  
对于另外 $30\%$ 的测试点，$n \leq 1000$；  
对于 $100\%$ 的测试点，$1 \leq n \leq 100000, 0 \leq k \leq n$；  
对于以上每部分测试点，均有一半的数据满足 $k = n$。



---

---
title: "[CQOI2017] 老C的任务"
layout: "post"
diff: 省选/NOI-
pid: P3755
tag: ['2017', '重庆', '各省省选', '离散化', 'cdq 分治', '可持久化线段树']
---
# [CQOI2017] 老C的任务
## 题目描述

老 C 是个程序员。


最近老 C 从老板那里接到了一个任务——给城市中的手机基站写个管理系统。作为经验丰富的程序员，老 C 轻松地完成了系统的大部分功能，并把其中一个功能交给你来实现。

由于一个基站的面积相对于整个城市面积来说非常的小，因此每个的基站都可以看作坐标系中的一个点，其位置可以用坐标 $(x,y)$ 来表示。此外，每个基站还有很多属性，例如高度、功率等。运营商经常会划定一个区域，并查询区域中所有基站的信息。

现在你需要实现的功能就是，对于一个给定的矩形区域，回答该区域中（包括区域边界上的）所有基站的功率总和。如果区域中没有任何基站，则回答 $0$。

## 输入格式

第一行两个整数 $n,m$，表示一共有 $n$ 个基站和 $m$ 次查询。接下来一共有 $n$ 行，每行由 $x_i,y_i,p_i$ 三个空格隔开的整数构成，表示一个基站的坐标 $(x_i,y_i)$ 和功率 $p_i$。不会有两个基站位于同一坐标。

接下来一共有 $m$ 行，每行由 $x_1,y_1,x_2,y_2$ 四个空格隔开的整数构成，表示一次查询的矩形区域。该矩形对角坐标为 $(x_1,y_1)$ 和 $(x_2,y_2)$，且边与坐标轴平行。

## 输出格式

输出 $m$ 行，每行一个整数，对应每次查询的结果。

## 样例

### 样例输入 #1
```
4 2   
0 0 1 
0 1 2  
2 2 4  
1 0 8  
0 0 1 1 
1 1 5 6 
```
### 样例输出 #1
```
11
4
```
### 样例输入 #2
```
3 2
-100 0 16 
1 -10 32 
1000 100 64 
0 0 0 1 
-1000 -1000 10000 10000 
```
### 样例输出 #2
```
0
112
```
## 提示

对于第 $1\sim2$ 个测试点，$1≤n,m≤100$；

对于第 $3\sim5$ 个测试点，$1≤n≤50000,1≤m≤10000$；

对于第 $6\sim10$ 个测试点，$1≤n≤100000,1≤m≤100000$，数据有梯度；

对于所有测试点，$-2^{31}\le x_i,y_i,p_i,x_1,y_1,x_2,y_2<2^{31},x_1\le x_2,y_1\le y_2$。



---

---
title: "[CQOI2017] 老C的键盘"
layout: "post"
diff: 省选/NOI-
pid: P3757
tag: ['动态规划 DP', '2017', '重庆', '线段树', '各省省选', '树形 DP', '前缀和']
---
# [CQOI2017] 老C的键盘
## 题目描述

老 C 是个程序员。

作为一个优秀的程序员，老 C 拥有一个别具一格的键盘，据说这样可以大幅提升写程序的速度，还能让写出来的程序在某种神奇力量的驱使之下跑得非常快。

小 Q 也是一个程序员。有一天他悄悄潜入了老 C 的家中，想要看看这个键盘究竟有何妙处。他发现，这个键盘共有 $n$ 个按键，这 $n$ 个按键虽然整齐的排成一列，但是每个键的高度却互不相同。聪明的小 Q 马上将每个键的高度用 $1 \sim n$ 的整数表示了出来，得到一个 $1 \sim n$ 的排列 $h_1,h_2, \cdots ,h_n$。

为了回去之后可以仿造一个新键盘（新键盘每个键的高度也是一个 $1 \sim n$ 的排列），又不要和老 C 的键盘完全一样，小 Q 决定记录下若干对按键的高度关系。作为一个程序员，小 Q 当然不会随便选几对就记下来，而是选了非常有规律的一些按键对：对于 $i=2,3, \cdots ,n$，小 Q 都记录下了一个字符 `<` 或者 `>`，表示 $h_{\frac i2}<h_i$ 或者$h_{\frac i2}>h_i$。于是，小 Q 得到了一个长度为 $n-1$ 的字符串，开开心心的回家了。

现在，小 Q 想知道满足他所记录的高度关系的键盘有多少个。虽然小 Q 不希望自己的键盘和老 C 的完全相同，但是完全相同也算一个满足要求的键盘。答案可能很大，你只需要告诉小 Q 答案 $\bmod ~ 1,000,000,007$ 之后的结果即可。

## 输入格式

输入共一行，包含一个正整数 $n$ 和一个长度为 $n - 1$ 的只包含 `<` 和 `>` 的字符串，分别表示键盘上按键的数量，和小 Q 记录的信息，整数和字符串之间有一个空格间隔。

## 输出格式

输出共一行，包含一个整数，表示答案 $\bmod      ~ 1,000,000,007$ 后的结果。

## 样例

### 样例输入 #1
```
5 <>><
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5 <<<<
```
### 样例输出 #2
```
8
```
### 样例输入 #3
```
5 <<>>
```
### 样例输出 #3
```
18
```
## 提示



![](https://cdn.luogu.com.cn/upload/pic/5095.png)



---

---
title: "[TJOI2017] 不勤劳的图书管理员"
layout: "post"
diff: 省选/NOI-
pid: P3759
tag: ['2017', '线段树', '各省省选', '枚举', '树套树', '天津']
---
# [TJOI2017] 不勤劳的图书管理员
## 题目描述

加里敦大学有个帝国图书馆，小豆是图书馆阅览室的一个书籍管理员。

他的任务是把书排成有序的，所以无序的书让他产生厌烦。

两本乱序的书会让小豆产生这两本书页数的和的厌烦度。

现在有 $n$ 本被打乱顺序的书，在接下来 $m$ 天中每天都会因为读者的阅览导致书籍顺序改变位置。

因为小豆被要求在接下来的 $m$ 天中至少要整理一次图书。

小豆想知道，如果他前 $i$ 天不去整理，第 $i$ 天他的厌烦度是多少，这样他好选择厌烦度最小的那天去整理。
## 输入格式

第一行会有两个数，$n,m$ 分别表示有 $n$ 本书，$m$ 天。

接下来 $n$ 行，每行两个数，$a_i,v_i$，分别表示第 $i$ 本书本来应该放在 $a_i$ 的位置，这本书有 $v_i$ 页，保证不会有放置同一个位置的书。

接下来 $m$ 行，每行两个数，$x_j$ 和 $y_j$，表示在第 $j$ 天的第 $x_j$ 本书会和第 $y_j$ 本书会因为读者阅读交换位置。
## 输出格式

一共 $m$ 行，每行一个数，第 $i$ 行表示前 $i$ 天不去整理，第 $i$ 天小豆的厌烦度，因为这个数可能很大，所以将结果模 $10^9 +7$ 后输出。
## 样例

### 样例输入 #1
```
5 5
1 1
2 2
3 3
4 4
5 5
1 5
1 5
2 4
5 3
1 3
```
### 样例输出 #1
```
42
0
18
28
48
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，$1\le a_i,x_j,y_j\le n \le 5\times 10^3$，$1\le m\le 5\times 10^3$， $1\le v_i\le10^5$。
- 对于 $100\%$ 的数据，$1\le a_i,x_j,y_j\le n\le 5\times 10^4$，$1\le m\le 5\times 10^4$，$1\le v_i\le 10^5$。


---

---
title: "[TJOI2017] 异或和"
layout: "post"
diff: 省选/NOI-
pid: P3760
tag: ['2017', '各省省选', '树状数组', '进制', '前缀和', '天津']
---
# [TJOI2017] 异或和
## 题目描述

在加里敦中学的小明最近爱上了数学竞赛，很多数学竞赛的题都是与序列的连续和相关的。  所以对于一个序列，求出它们所有的连续和来说，小明觉得十分的简单。  

但今天小明遇到了一个序列和的难题，这个题目不仅要求你快速的求出所有的连续和（即子串和），还要快速的求出这些连续和的异或值。  

小明很快的就求出了所有的连续和，但是小明要考考你，在不告诉连续和的情况下，让你快速求是序列所有连续和的异或值。

## 输入格式

第一行输入一个 $n$，表示这序列的数序列。

第二行输入 $n$ 个非负整数 $a_1,a_2 \dots a_n$ 代表这个序列。
## 输出格式

输出这个序列所有的连续和的异或值。

## 样例

### 样例输入 #1
```
3
1 2 3
```
### 样例输出 #1
```
0
```
## 提示

【样例解释】

序列 $[1,2,3]$ 有 $6$ 个连续和，它们分别是 $1,2,3,3,5,6$，而 $1 \text{ xor } 2 \text{ xor } 3 \text{ xor } 3 \text{ xor } 5 \text{ xor } 6 = 0$。

【数据范围】

- 对于 $20\%$ 的数据，$1\le n \le 100$；
- 对于 $100\%$ 的数据，$1\le n \le 10^5$，$\sum a_i \le 10^6$。



---

---
title: "[TJOI2017] 城市"
layout: "post"
diff: 省选/NOI-
pid: P3761
tag: ['2017', '各省省选', '枚举', '树的直径', '天津']
---
# [TJOI2017] 城市
## 题目描述

从加里敦大学城市规划专业毕业的小明来到了一个地区城市规划局工作。这个地区一共有 $n$ 座城市，$n-1$ 条高速公路，保证了任意两运城市之间都可以通过高速公路相互可达，但是通过一条高速公路需要收取一定的交通费用。小明对这个地区深入研究后，觉得这个地区的交通费用太贵。

小明想彻底改造这个地区，但是由于上司给他的资源有限，因而小明现在只能对一条高速公路进行改造，改造的方式就是去掉一条高速公路，并且重新修建一条一样的高速公路（即交通费用一样），使得这个地区的两个城市之间的最大交通费用最小（即使得交通费用最大的两座城市之间的交通费用最小），并且保证修建完之后任意两座城市相互可达。如果你是小明，你怎么解决这个问题？

## 输入格式

输入数据的第一行为一个整数 $n$，代表城市个数。

接下来的 $n - 1$ 行分别代表了最初的 $n-1$ 条公路情况。每一行都有三个整数 $u,v,d$。$u,v$ 代表这条公路的两端城市标号，$d$ 代表这条公路的交通费用。

$1 \leq u,v \leq n$，$1\leq d \leq 2000$。

## 输出格式

输出数据仅有一行，一个整数，表示进行了最优的改造之后，该地区两城市 之间最大交通费用。

## 样例

### 样例输入 #1
```
5
1 2 1
2 3 2
3 4 3
4 5 4
```
### 样例输出 #1
```
7
```
## 提示

对于 $30\%$ 的数据，$1\leq n\leq 500$。

对于 $100\%$ 的数据，$1\leq n\leq 5000$。



---

---
title: "[TJOI2017] 龙舟"
layout: "post"
diff: 省选/NOI-
pid: P3762
tag: ['2017', '各省省选', '天津']
---
# [TJOI2017] 龙舟
## 题目描述

加里敦大学有一个龙舟队，龙舟队有 $n$ 支队伍，每只队伍有 $m$ 个划手。龙舟比赛是一个集体项目，和每个人的能力息息相关，但由于龙舟讲究配合，所以评价队伍的能力的是一个值 $C=\frac{b_1 \times b_2 \times \cdots \times b_m}{a_1 \times a_2 \times \cdots \times a_m}$，其中 $b_i$ 表示第 $i$ 个位置的标准能力值，$a_i$ 表示在队伍中第 $i$ 个位置的划手的能力值。最后通过约分，我们会得到 $C=\frac{B}{A}$，其中 $\gcd(B,A)=1$，即 $A,B$ 互质。

但是由于比赛现场的情况不一样，我们认为在现场压力为 $M$ 的情况下，队伍最后的表现情况是 $C^{-1}\mod M$。我们规定在模 $M$ 的条件下 $\frac{1}{x}=y$，其中 $y$ 满足 $xy \equiv 1\pmod M$，并且 $y$ 大于等于 $0$ 小于 $M$。如果不存在这样的 $y$ 我们就认为在压力为 $M$ 的条件下这支队伍会发挥失常（即 $y$ 是 $x$ 在模 $M$ 意义下的逆元，如果不存在逆元我们认为队伍发挥失常）。给出这个赛季的比赛安排情况，现在教练组想知道各队在比赛中的表现情况。
## 输入格式


第一行输入三个整数 $n,m,k$，表示有 $n$ 支队伍，每支队伍由 $m$ 个人组成，有 $k$ 场比赛。

第二行输入 $m$ 个整数，第 $i$ 个整数表示第 $i$ 个位置的标准能力值为 $b_i$。

第三行到第 $n+2$ 行，共 $n$ 行，每行有 $m$ 个数，第 $2+i$ 行第 $j$ 个数表示第 $i$ 支队伍第 $j$ 个位置划手的能力值。

第 $n+3$ 行到第 $n+k+2$ 行，共 $k$ 行，每行有两个数 $x,M$，分别表示第 $x$ 支队伍会在压力为 $M$ 的比赛中出战。
## 输出格式

共 $k$ 行，第 $i$ 行表示在第 $i$ 个参赛安排中队伍的现场表现情况 $C$，如果出现队伍发挥失常，输出 `-1`。
## 样例

### 样例输入 #1
```
2 3 3
5 2 3
3 2 3
2 3 2
1 4
2 4
1 7
```
### 样例输出 #1
```
3
-1
4
```
## 提示

对于 $20\%$ 的数据，$1<M,a_i,b_i<10^8$，$m \le 100$。

对于 $100\%$ 的数据，$1<M,a_i,b_i<2 \times 10^{18}$，$m \le 10000$，$n \le 20$，$k \le 50$。


---

---
title: "[TJOI2017] DNA"
layout: "post"
diff: 省选/NOI-
pid: P3763
tag: ['2017', '各省省选', '后缀数组 SA', '快速傅里叶变换 FFT', '天津']
---
# [TJOI2017] DNA
## 题目描述

加里敦大学的生物研究所，发现了决定人喜不喜欢吃藕的基因序列 $S$,有这个序列的碱基序列就会表现出喜欢吃藕的性状，但是研究人员发现对碱基序列 $S$，任意修改其中不超过 $3$ 个碱基，依然能够表现出吃藕的性状。现在研究人员想知道这个基因在 DNA 链 $S_0$ 上的位置。所以你需要统计在一个表现出吃藕性状的人的 DNA 序列 $S_0$ 上，有多少个连续子串可能是该基因，即有多少个 $S_0$ 的连续子串修改小于等于三个字母能够变成 $S$。

## 输入格式

第一行有一个整数 $T$，表示有几组数据。

每组数据第一行一个长度不超过 $10^5$ 的碱基序列 $S_0$。

每组数据第二行一个长度不超过 $10^5$ 的吃藕基因序列 $S$。

## 输出格式

共 $T$ 行，第 $i$ 行表示第 $i$ 组数据中，在 $S_0$中有多少个与 $S$ 等长的连续子串可能是表现吃藕性状的碱基序列。

## 样例

### 样例输入 #1
```
1
ATCGCCCTA
CTTCA
```
### 样例输出 #1
```
2
```
## 提示

对于 $20\%$ 的数据，$S_0,S$ 的长度不超过 $10^4$。

对于 $100\%$ 的数据，$S_0,S$ 的长度不超过 $10^5$，$0\lt T\leq 10$。

注：DNA 碱基序列只有 ATCG 四种字符。


---

---
title: "[FJOI2017] 矩阵填数"
layout: "post"
diff: 省选/NOI-
pid: P3813
tag: ['2017', '各省省选', '离散化', '福建', '枚举', '容斥原理']
---
# [FJOI2017] 矩阵填数
## 题目描述

给定一个 $h \times w$ 的矩阵，矩阵的行编号从上到下依次为 $1 \sim h$，列编号从左到右依次 $1 \sim w$。

在这个矩阵中你需要在每个格子中填入 $1 \sim m$ 中的某个数。

给这个矩阵填数的时候有一些限制，给定 $n$ 个该矩阵的子矩阵，以及该子矩阵的最大值 $v$，要求你所填的方案满足该子矩阵的最大值为 $v$。

现在，你的任务是求出有多少种填数的方案满足 $n$ 个限制。

两种方案是不一样的当且仅当两个方案至少存在一个格子上有不同的数。由于答案可能很大，你只需要输出答案对 $10 ^ 9 + 7$ 取模后的结果。
## 输入格式

输入数据的第一行为一个数 $T$，表示数据组数。

对于每组数据，第一行为四个数 $h,w,m,n$。

接下来 $n$ 行，每一行描述一个子矩阵的最大值 v。每行为五个整数 $x1,y1,x2,y2,v$，表示一个左上角为$(x1,y1)$,右下角为$(x2,y2)$的子矩阵的最大值为 $v$。 $1 \le x1 \le x2 \le h$, $1 \le y1 \le y2 \le w$

## 输出格式

对于每组数据输出一行，表示填数方案 mod $1,000,000,007$ 后的值。

## 样例

### 样例输入 #1
```
2
3 3 2 2
1 1 2 2 2
2 2 3 3 1
4 4 4 4
1 1 2 3 3
2 3 4 4 2
2 1 4 3 2
1 2 3 4 4
```
### 样例输出 #1
```
28
76475
```
## 提示

对于 $20\%$ 的数据，$n \le 2$。

另有 $20\%$ 的数据，$1 \le h, w \le 50$。

对于 $100\%$ 的数据，$T \le 5$，$1 \le h, w, m \le 10 ^ 4$，$1 \le n \le 10$，$1 \le v \le m$。


---

---
title: "[FJOI2017] 树的平均路长问题"
layout: "post"
diff: 省选/NOI-
pid: P3816
tag: ['字符串', '动态规划 DP', '2017', '各省省选', '福建', '枚举']
---
# [FJOI2017] 树的平均路长问题
## 题目描述

一棵树 $T$ 的平均路长 $IPL(T)$定义为：

$IPL(T)=\sum_{v\varepsilon T}length(path(v))$

其中， $v$ 是树 $T$ 中的内结点， $length(path(v))$是从树根到结点$v$的路径长度。

红黑树是一类特殊的二叉搜索树，其中每个结点被“染成”红色或黑色。若将二叉搜索树结点中的空指针看作是指向一个空结点，则称这类空结点为二叉搜索树的前端结点。并规定所有前端结点的高度为$-1$。除了前端结点外，其他结点均为内结点。

一棵红黑树是满足下面“红黑性质”染色二叉搜索树：

1. 每个结点被染成红色或黑色；

2. 每个前端结点为黑色结点；

3. 任一红结点的儿子结点均为黑结点；

4. 在从任一结点到其子孙前端结点的所有路径上具有相同的黑结点数。

从红黑树中任一结点 $x$ 出发(不包括结点 $x$)，到达一个前端结点的任意一条路径上的黑结点个数称为结点 $x$ 的黑高度，记作 $bh(x)$。红黑树的黑高度定义为其根结点的黑高度。

给定正整数 $n$，试设计一个算法，计算出在所有含有 $n$ 个结点的红黑树中，平均路长的最大值。

## 输入格式

文件有多个测试项。每行有1个正整数$n$， ($1\le n\le 30000$)，表示红黑树的结点数。文件最后以一个$0$结束。

## 输出格式

对每行中红黑树的结点数 $n$，将计算出的平均路长的最大值输出到文件中。

每行输出一个最大值。 文件最后以一个$0$ 结束。

## 样例

### 样例输入 #1
```
1
2
3
0
```
### 样例输出 #1
```
1
3
5
0
```


---

---
title: "[SHOI2012] 火柴游戏"
layout: "post"
diff: 省选/NOI-
pid: P3828
tag: ['2012', '各省省选', '上海']
---
# [SHOI2012] 火柴游戏
## 题目背景

SHOI2012D1T1

## 题目描述

小明非常喜欢玩火柴游戏：首先用火柴棒摆出一个可能是错误的等式，然后通过添加、删除或移动火柴棒，使得等式成立。下图展示每个数字的样子：

 ![](https://cdn.luogu.com.cn/upload/pic/6548.png) 

我们只考虑形如“A = B”的式子，其中 A 和 B 是两个具有相同位数的整数。

小明可进行三种操作：

1. 在任意位置添加一根火柴棒；

2. 从任意位置删除一根火柴棒；

3. 将任意一根火柴棒移动到另一个位置。

在完成所有操作后，等号两侧必须都是合法的数字，且完全相等。我们约定：

1. 小明不能消除任何数字，也就是说，可以删除一个数字的部分火柴，但不能令它消失；

2. 小明不能增加任何数字，也就是说，可以在一个已有的数字上添加火柴，或将火柴移动到一个已有的数字上，但不能凭空增加一个数字；

3. 小明不能拆分或者合并数字，比如将一个 8 变成两个 1，或者将两个 1合并成一个 8；

4. 其中代表 1 的火柴棒必须靠右边摆放，放在左边不是有效的数字。每种操作都有一定的代价：

 对一个添加操作，如果这是第$i$次进行添加操作，这一步的费用为 $p_1\times i+q_1$

 对一个删除操作，如果这是第$i$次进行删除操作，这一步的费用为$p_2\times i+q_2$

 对一个移动操作，如果这是第$i$次进行移动操作，这一步的费用为$p_3\times i+q_3$

例如，小明在游戏中添加了 3 根火柴，移动了 1 根火柴，删除了 2 根火柴，那么他总的花费为$[(p_1\times 1+q_1)+(p_1\times 2+q_1)+(p_1\times 3+q_1)]+(p_3\times 1+q_3)+[(p_2\times 1+q_2 )+(p_2\times 2+q_2)]$。

小明想知道，他如何才能用最少的花费使等式成立。你能写个程序帮助他吗？

## 输入格式

第 1 行，一个整数 L，表示等式中两个数的位数。

第 2-3 行，每行各一个长度为 L、仅由数字构成的字符串，表示等式两侧的数。

第 4 行，给出六个不超过 100 的非负整数$p_1,q_1,p_2,q_2,p_3,q_3$。

## 输出格式

输出一行，包含一个整数，为使等式成立的最小的操作代价。

## 样例

### 样例输入 #1
```
2
46
78
0 1 0 1 0 1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
2
23
52
1 1 1 1 1 1
```
### 样例输出 #2
```
9
```
## 提示

对于 30%数据，有$L\le 20$，且$p_1 = p_2 = p_3 = 0$；

对于 60%数据，有$L\le 100$；

对于 100%数据，有$L\le 200$。



---

---
title: "[SHOI2012] 随机树"
layout: "post"
diff: 省选/NOI-
pid: P3830
tag: ['动态规划 DP', '2012', '各省省选', '上海', '期望', '构造']
---
# [SHOI2012] 随机树
## 题目背景

SHOI2012 D1T3

## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/6555.png)

## 输入格式

输入仅有一行，包含两个正整数 q, n，分别表示问题编号以及叶结点的个数。

## 输出格式

输出仅有一行，包含一个实数 d，四舍五入精确到小数点后 6 位。如果 q = 1，则 d 表示叶结点平均深度的数学期望值；如果 q = 2，则 d 表示树深度的数学期望值。

## 样例

### 样例输入 #1
```
1 4
```
### 样例输出 #1
```
2.166667
```
### 样例输入 #2
```
2 4
```
### 样例输出 #2
```
2.666667
```
### 样例输入 #3
```
1 12
```
### 样例输出 #3
```
4.206421
```
### 样例输入 #4
```
2 12
```
### 样例输出 #4
```
5.916614
```
## 提示

 ![](https://cdn.luogu.com.cn/upload/pic/6556.png) 

 ![](https://cdn.luogu.com.cn/upload/pic/6557.png) 

![](https://cdn.luogu.com.cn/upload/pic/6558.png)



---

---
title: "[TJOI2007] 足彩投注"
layout: "post"
diff: 省选/NOI-
pid: P3849
tag: ['2007', '各省省选', '天津']
---
# [TJOI2007] 足彩投注
## 题目背景

了解足球彩票的人可能知道，足球彩票中有一种游戏叫做“胜负彩”，意为猜比赛的胜负。下面是一些与胜负彩有关的术语：

注      ：每一组有效组合数据。

投    注：彩民以现金购买足球彩票的行为。

单式投注：彩民对于所有球队的比赛成绩均只选择一种预测结果的投注方式。投注的数量（注数）为1。

复式投注：彩民对于某些场次的比赛成绩选择两种以上的预测结果的投注方式。投注的数量为复式投注的组合数。例如，某彩民对一场比赛预测了两个结果（例如，胜平），           另一场比赛预测了三个结果（胜负平），其他比赛都只预测了一种结果，那么注数就是2×3 = 6。这样的一个复式投注，可以看成一个包含六种单式投注的集合。


胜负彩的玩法一般是这样的。彩票机构指定一轮比赛中的若干场，让彩民去猜每场比赛的结果（胜、负、平）。根据彩民猜中比赛的场次，来确定中奖的额度。

## 题目描述

我们现在考虑一个简化的模型。对于一轮比赛，彩民需要竞猜其中n场比赛的结果，每场比赛的胜负平都有一个概率p(i, r)。其中，i表示第i场比赛。r = 0, 1, 2，分别表示比赛结果的（主队）负、平、胜。p(i, r)则表示第i场比赛、结果为r的概率。此外，还有一个概率q(i, r)，表示第i场比赛，投注购买结果为r的概率。


例如，如果q(1,0) = 0.5，我们可以知道第一场比赛有50%的投注会买主队输球。我们假设这n场比赛互不相关，即p(i, r)的结果不会受p(j, r’)的影响，q(i, r)的结果也不会受q(j, r’)的影响（r ≠ r’）。


在这个模型里，我们规定，必须猜中全部n场比赛的结果才能获奖。总奖金为M，由所有获奖的投注平分。因此，对于一个单式投注Ri = {ri1, ri2, …, rin}，rij表示投注Ri对第j场比赛的预测结果，它的中奖概率为：

 ![](https://cdn.luogu.com.cn/upload/pic/6080.png) 

设投注总数为N，那么中奖的投注总数为：

 ![](https://cdn.luogu.com.cn/upload/pic/6081.png) 

于是，投注Ri所能得到的奖金的期望（平均意义下能够获得的奖金数）就是：

 ![](https://cdn.luogu.com.cn/upload/pic/6082.png) 

以上考虑的仅仅是单式投注的情况，即仅考虑单注Ri的中奖情况。对于复式投注，情况要复杂一些。采用复式投注时，投注的是一个集合R = {R1, R2, …, Rk}，其中k是投注的数量。例如，三场比赛，第一场猜“胜负”，第二场猜“平”，第三场猜“负平”，则k = 4，R集合如下：

 ![](https://cdn.luogu.com.cn/upload/pic/6083.png) 

复式投注R中，只要有一个Ri猜对所有比赛结果，即可中奖。因此，复式投注R所能获得的奖金的期望就是：


 ![](https://cdn.luogu.com.cn/upload/pic/6084.png) 

我们的问题是，给定n场比赛的信息（胜负平的概率和彩民购买三种结果的概率），以及复式投注中可以购买的最大注数U，要求设计一种复式投注的方案，在不超过最大注数（复式投注的注数k ≤ U）的前提下，使得获得奖金的期望最大。

## 输入格式

第一行四个整数n, N, M, U（n, U ≤ 10^4, N, M ≤ 10^9）。

以下n行，每行六个实数。第i + 1行的六个实数为p(i, 0), p(i, 1), p(i, 2), q(i, 0), q(i, 1)和q(i, 2)，用来描述第i场比赛的相关信息。其中，p(i, 0) + p(i, 1) + p(i, 2) = 1, q(i, 0) + q(i, 1) + q(i, 2) = 1, q(i, j) ≠ 0。

## 输出格式

一个实数，表示最大的奖金期望的自然对数

 ![](https://cdn.luogu.com.cn/upload/pic/6085.png) 

输出保留3位小数（四舍五入）。

## 样例

### 样例输入 #1
```
1 10 10 1
0.3 0.2 0.5 0.7 0.2 0.1
```
### 样例输出 #1
```
1.609
```


---

---
title: "[TJOI2007] 书架"
layout: "post"
diff: 省选/NOI-
pid: P3850
tag: ['2007', '各省省选', '平衡树', '枚举', '天津']
---
# [TJOI2007] 书架
## 题目描述

Knuth 先生家里有个精致的书架，书架上有 $N$ 本书，如今他想学到更多的知识，于是又买来了 $M$ 本不同的新书。现在他要把新买的书依次插入到书架中，他已经把每本书要插入的位置标记好了，并且相应的将它们放好。由于 Knuth 年龄已大，过几天他已经记不清某些位置上放的到底是什么书了，请问你能帮助他吗？

## 输入格式

输入文件的第一行为整数 $N$，接下来 $N$ 行分别是书架上依次放着的 N 本书的书名（书名由不含空格的字符串构成，长度不超过 $10$）。下一行将要输入一个整数 $M$，接下来的 $M$ 行分别为这本书的书名和要插入的位置。下一行将要输入一个整数 $Q$，接下来共有 $Q$ 次询问，每行都是一个整数表示询问的位置。（书架上位置的编号从 $0$ 开始）

## 输出格式

输出 $Q$ 行，每行对应着相应查询位置的书名。

## 样例

### 样例输入 #1
```
3
Math
Algorithm
Program
2
Picture 2
System 1
3
0
1
3
```
### 样例输出 #1
```
Math
System
Picture
```
## 提示

原来有三本书 Math、Algorithm、Program，后来又买了两本书，分别插入到 $2$ 和 $1$ 的位置，每次插入时其他书都要向后挪一个位置，最后书架上书的序列为：

```plain
0  Math
1  System
2  Algorithm
3  Picture
4  Program
```
$Q$ 次询问依次为 $0$, $1$, $3$ 位置的书，所以答案为：Math、System、Picture


对于 $30\%$ 的数据，$1 \leqslant N \leqslant 100$, $1 \leqslant M \leqslant 10^3$, $1 \leqslant Q \leqslant 10^3$

对于 $100\%$ 的数据，$1 \leqslant N \leqslant 200$, $1 \leqslant M \leqslant 10^5$, $1 \leqslant Q \leqslant 10^4$

对于 $100\%$ 的数据都符合题目中所描述的限制关系，数据保证每次插入的位置均不超过当时书架上书的数量，而且保证 $Q$ 次查询中的每个位置上一定有书。


---

---
title: "[TJOI2007] 脱险"
layout: "post"
diff: 省选/NOI-
pid: P3851
tag: ['2007', '各省省选', '天津']
---
# [TJOI2007] 脱险
## 题目背景

一批探险队员正在一个迷宫一样的山洞里摸索，突然他们得到了一个糟糕的消息，由于附近发生地震，这个山洞将有可能在 $T$ 个单位时间后坍塌。现在他们要用最快的速度找出一个方案，使得在 $T$ 个单位时间内逃出的队员最多。已知探险队员在一个单位时间内可以向前后左右任一方向移动一格，也可以停留在原地不动。有一个糟糕的情况是，虽然山洞的内部比较宽敞，但山洞的出口都非常狭窄，一个单位时间只能允许一名队员通过。

## 题目描述

山洞的地图用一个 $R \times C$ 的字符矩阵表示：

- `.` 表示在开始的时候没有探险队员的空地，空地可以容纳任意多的探险队员；
- `P`表示在开始的时候有探险队员的空地，我们假设在开始的时候所有的队员都在不同的位置上，且没有队员恰好位于出口所在的方格；
- `*` 表示障碍物，探险队员不能经过被障碍物占据的方格；
- `O`（大写字母 `O`）表示出口，输入数据保证出口一定位于地图的边界上，即只有第 $1$ 行，第 $R$ 行，第 $1$ 列，第 $C$ 列有可能出现 `O`。

另外，输入数据保证整个地图被边界和出口围住，即第 $1$ 行，第 $R$ 行，第 $1$ 列，第 $C$ 列只能是 `*` 或 `O`。

## 输入格式

输入文件的第一行是用空格隔开的两个整数 $R$ 和 $C$，表示地图的大小。第二行是整数 $T$，即山洞将要坍塌的时间。接下来 $R$ 行，每行包含 $C$ 个字符，表示一幅山洞地图。

## 输出格式

输出一行，包含一个整数，即 $T$ 个单位时间内最多能逃出的人数。

## 样例

### 样例输入 #1
```
5 5
4
*****
*P..*
O**.O
*P..*
*****
```
### 样例输出 #1
```
1
```
## 提示

山洞有两个出口，但只有右边的出口是可以到达的。虽然在 $3$ 个单位时间内两人都可以到达出口左侧的方格处，但由于在出口处一个单位时间只能允许一人通过，故 $4$ 个单位时间内只能逃出一人。两人都逃出需要 $5$ 个单位时间。

- 对于 $30\%$ 的数据，队员数和出口数均不超过 $10$；
- 对于 $100\%$ 的数据，$3 \le R, C \le 12，0 < T \le 50$。



---

---
title: "[TJOI2007] 小朋友"
layout: "post"
diff: 省选/NOI-
pid: P3852
tag: ['2007', '各省省选', '天津', '弦图']
---
# [TJOI2007] 小朋友
## 题目背景

幼儿园里有N个小朋友，老师要从中选出来一部分做丢手绢的游戏，可是老师没有想到这么小的孩子里面有些人之间还有矛盾。老师想找出尽量多的小朋友去玩游戏，但是又很头疼，他不想看到找出来玩游戏的小朋友里面还有任何两个人之间存在着矛盾。如果告诉你小朋友之间存在的M对矛盾关系，你能否帮助幼儿园老师计算出他最多可以选出多少个小朋友来做这个丢手绢的游戏？

## 题目描述

关于矛盾限制的说明：

如果我们把存在着矛盾的两个小朋友看作是无向图中相连的两个点，那么题目中的数据保证M对矛盾所构成的图中不会有超过3个点的环。（图1符合要求，图2则不符合）

![](https://cdn.luogu.com.cn/upload/pic/6098.png)

## 输入格式

输入文件的第一行是用空格隔开的两个整数N和M，表示一共有N个小朋友，这些小朋友之间有M对矛盾关系。接下来的M行，每行将有一对整数a和b（用空格隔开），表示小朋友a与小朋友b有矛盾。（小朋友的编号都是从1开始的）

## 输出格式

输出一行，包含一个整数，即幼儿园老师最多可以选出来做游戏的人数。

## 样例

### 样例输入 #1
```
5 6
1 2
3 2
1 3
3 5
3 4
4 5
```
### 样例输出 #1
```
2
```
## 提示

幼儿园有6个小朋友，矛盾关系中1 - 2 - 3组成一个环，3 - 4 - 5组成一个环，因此只能在这两个环中分别选一个小朋友，并且不能选择3号小朋友。

    
对于20%的数据，1 ≤ N ≤ 20

对于40%的数据，1 ≤ N ≤ 50

对于100%的数据，1 ≤ N ≤ 200

对于100%的数据都符合题目中所描述的矛盾限制关系。



---

---
title: "[TJOI2008] 公共子串"
layout: "post"
diff: 省选/NOI-
pid: P3856
tag: ['动态规划 DP', '2008', '各省省选', '枚举', '天津']
---
# [TJOI2008] 公共子串
## 题目描述

一个字符串的子串是在这个串基础上去掉0个或者若干个字符所形成的，例如abc, aa和abbc都是字符串aabbcc的子串，而aba不是。 现给你三个字符串，请问他们三个共同含有多少种子串（不算空串）?

注意： 有些相同的公共子串尽管出现在不同的位置，但仍算1种，详见样例。

## 输入格式

每组测试数据只有3行，每行都是一个只包含有小写字母的字符串。

## 输出格式

输出3个字符串共有的公共子串种类数。

## 样例

### 样例输入 #1
```
apartment
apache
approach

```
### 样例输出 #1
```
6
```
## 提示

3个字符串共有的公共子串有： “a”, “p”, “ap”, “pa”, “aa”, “apa”。 其中子串 “a” 有多个，但由于统计的是公共子串种类，所以 “a” 只算1种子串。


100%的数据中，字符串的长度不超过100。字符串中只含有小写字母。





---

---
title: "[TJOI2009] 战争游戏"
layout: "post"
diff: 省选/NOI-
pid: P3866
tag: ['2009', '各省省选', '最小割', '天津']
---
# [TJOI2009] 战争游戏
## 题目背景

小R正在玩一个战争游戏。游戏地图是一个M行N列的矩阵，每个格子可能是障碍物，也可能是空地，在游戏开始时有若干支敌军分散在不同的空地格子中。每支敌军都可以从当前所在的格子移动到四个相邻的格子之一，但是不能移动到包含障碍物的格子。如果敌军移动出了地图的边界，那么战争就失败了。

## 题目描述

现在你的任务是，在敌军开始移动前，通过飞机轰炸使得某些原本是空地的格子变得不可通行，这样就有可能阻止敌军移出地图边界（出于某种特殊的考虑，你不能直接轰炸敌军所在的格子）。由于地形不同的原因，把每个空地格子轰炸成不可通行所需的炸药数目可能是不同的，你需要计算出要阻止敌军所需的最少的炸药数。

## 输入格式

输入文件的第一行包含两个数M和N，分别表示矩阵的长和宽。接下来M行，每行包含用空格隔开的N个数字，每个数字表示一个格子的情况：若数字为-1，表示这个格子是障碍物；若数字为0，表示这个格子里有一支敌军；若数字为一个正数x，表示这个格子是空地，且把它轰炸成不可通行所需的炸药数为x。

地图上的敌军数量不为1，即地图上有多个0。
## 输出格式

输出一个数字，表示所需的最少炸药数。数据保证有解存在。

## 样例

### 样例输入 #1
```
4 3
1 2 1
1 10 1
1 0 -1
1 1 1
```
### 样例输出 #1
```
6
```
## 提示

对50%的数据，1 ≤ M,N ≤ 10

对100%的数据，1 ≤ M,N ≤ 30

矩阵里的每个数不超过100



---

---
title: "[TJOI2010] 电影迷"
layout: "post"
diff: 省选/NOI-
pid: P3872
tag: ['2010', '各省省选', '图论建模', '最小割', '天津']
---
# [TJOI2010] 电影迷
## 题目描述

小A是一个电影迷，他收集了上百部的电影，打算从中挑出若干部在假期看完。他根据自己的口味和网上的介绍，对每部电影X都打了一个分数vX，表示自己喜欢的程度。这个分数的范围在-1000至1000之间，越大表示越喜欢。小A每看一部电影X，他的体验值就会加上vX。

另外，因为某些电影是组成一个系列的，比如著名的《终结者》系列、《黑客帝国》系列等等，如果小A只看了前一部而没有看后一部的话，他就会觉得不是很爽。准确来讲，对于任意两部不同的电影X,Y，他们可能存在一个依赖值dXY，表示如果小A看了X但是没看Y，他的体验值就会减少dXY。（注意与观看的顺序无关，只要两部都看过，就不会减少体验值）

现在他要选出若干电影来看，使得得到的总的体验值最大。如果他无法得到正的体验值，就输出0。

## 输入格式

输入的第一行是两个整数：电影总数N和依赖关系数目M。第二行包含用空格隔开的N个数，表示对每部电影的打分。接下来M行，每行包含三个整数X, Y, dXY，表示一个依赖关系。每个有序对(X,Y)最多出现一次。(1 ≤ X,Y ≤ N)

## 输出格式

输出一个整数，表示小A能得到的最大体验值。

## 样例

### 样例输入 #1
```
2 2
100 -50
1 2 49
2 1 10

```
### 样例输出 #1
```
51
```
## 提示

如果小A只看电影1，体验值为100-49 = 51。如果只看电影2，体验值为-50-10 = -60。如果两部都看，体验值为100+(-50) = 50。所以应该只看电影1。

数据规模与约定

对于20%的数据，1 ≤ N ≤ 15

对于100%的数据，1 ≤ N ≤ 100, -1000 ≤ vX ≤ 1000, 0 < dXY ≤ 1000

每个测试点时限1秒



---

---
title: "[TJOI2010] 数字序列"
layout: "post"
diff: 省选/NOI-
pid: P3876
tag: ['2010', '各省省选', '天津']
---
# [TJOI2010] 数字序列
## 题目描述

考虑一个由数字0,1,2,3组成的长度为n的序列，如果它是一个合法序列，那么它应当满足以下两个条件：

1) 序列中任意相邻的两元素没有出现模式{'00', '11', '22', '33', '02', '20', '23', '32', '13', '31'}中的任一种;

2) 序列满足m个约束条件，每个约束条件的形式均为：{p1, p2, ... pL}，它表示序列中的p1, p2, ..., pL这些位置的值不同。例如约束条件{1, 5, 11}表示序列中的第一个，第五个和第十一个元素两两各不相同。

现在已知序列长度n，约束条件个数m以及这m个约束条件，问是否存在这样的合法序列。

## 输入格式

输入文件的第一行是一个正整数T，表示文件中包含T组测试数据。从文件的第二行开始，将依次给出所有的测试数据。每个测试数据的第一行是两个整数n和m，它们的涵义如上面题目描述中所示。接下来有m行，每行描述一个约束条件，其中在描述第i个约束条件的行中，第一个数字是表示这个约束条件包含多少个元素的正整数Li，后面由Li个正整数给出第i个约束的具体情况。

## 输出格式

共输出T行，对每组测试数据输出一行，如果存在满足条件的合法序列，输出"Yes"；否则，输出"No"。

## 样例

### 样例输入 #1
```
2
7 2
3 1 2 4
4 2 4 5 7
3 1
2 1 1

```
### 样例输出 #1
```
Yes
No

```
## 提示

T ≤ 10，1 ≤ n ≤ 100000，0 ≤ m ≤ 5000，1 ≤ Li ≤ 100，1 ≤ pi ≤ n

每个测试点时限1秒

第一组样例中，序列0103012是满足要求的一个合法序列。



---

---
title: "[TJOI2010] 打扫房间"
layout: "post"
diff: 省选/NOI-
pid: P3877
tag: ['2010', '各省省选', '天津']
---
# [TJOI2010] 打扫房间
## 题目描述

学校新建了一批宿舍，值日生小A要把所有的空房间都打扫一遍。这些宿舍的布局很奇怪，整个建筑物里所有的房间组成一个N \* M的矩阵，每个房间的东南西北四面墙上都有一个门通向隔壁房间。另外有些房间是堆放杂物的，无需打扫。小A想设计若干条打扫路线，使得恰好进出每个需打扫的房间各一次，而且进出每个房间不能通过同一个门。要求每条路线都是一个闭合的环线，并且每条路线经过的房间数大于2。

如下面两图所示均为满足要求的打扫方案（灰色格子为放杂物的房间）：

 ![](https://cdn.luogu.com.cn/upload/pic/6841.png) 

小A发现对于某些房间布局是不存在这样的满足要求的方案的。他请你写一个程序计算一下，对于一种给定的房间布局，满足要求的方案是否存在。

## 输入格式

输入文件的第一行是一个整数T (1 ≤ T ≤ 10)，表示该文件中一共有T组数据。接下来依次是T组数据的信息。每组数据的第一行包含两个整数N和M，接下来的N行，每行包含M个字符，表示一个房间布局。字符'.'表示该房间需要打扫，'#'表示该房间是堆放杂物的，无需打扫。

## 输出格式

共输出T行，对每组数据输出一行，为"YES"或"NO"，表示打扫方案存在与否。

## 样例

### 样例输入 #1
```
4
3 4
##..
....
....
3 4
##..
....
#...
3 4
##..
#...
#...
3 4
####
#..#
####

```
### 样例输出 #1
```
YES
NO
YES
NO

```
## 提示

对50%的数据，3 ≤ N,M ≤ 12

对100%的数据，3 ≤ N,M ≤ 30

每个测试点时限1秒



---

---
title: "[JLOI2008] 将军"
layout: "post"
diff: 省选/NOI-
pid: P3882
tag: ['2008', '各省省选', '吉林', '图论建模', '二分图']
---
# [JLOI2008] 将军
## 题目描述

刘先生最近在学习国际象棋，使用一个叫 jloi-08 的游戏软件。在这个游戏里，不但可以和电脑普通地对弈，还可以学习著名的棋局，还有针对初学者的规则指导等丰富功能。但是…大小却要 1.4G T\_T。

言归正传，在这个软件里，为了让玩家更好地理解和运用各个棋子，有很多趣味的游戏，比如以下就是一个：

给出一个棋盘和一些棋子，让你把这些棋子摆放在棋盘上，使得两两不互相攻击。你的得分由你摆放上去的棋子的个数与种类有关。

这个游戏很复杂，刘先生老是玩不到高分。于是电脑便降低了难度，替刘先生摆上了一些棋子，最后只给你任意多个 bishop（教主）。

现在刘先生便要考一考你，在电脑给出的这张棋盘上，最多能放几个 bishop。

国际象棋中一共有 6 种棋子：

- king（国王）；
- queen（皇后）；
- bishop（教主）；
- knight（骑士）；
- rook（车）；
- pawn（步兵）。

各棋子的攻击范围如下：

- queen 可以攻击与它在同一行，同一列，同一条对角线的棋子；
- knight 的攻击范围如下图所示：

![](https://cdn.luogu.com.cn/upload/pic/2669.png)

- rook 攻击水平和垂直两条线上的所有格子；
- pawn 攻击前方两条斜线方向各一格(“前方”指 $x$ 递增的方向，$x$ 行 $y$ 列）；
- king 攻击周围 8 个方向各 1 格；
- bishop 攻击两条对角线上的所有格子。

除 knight 以外，所有棋子的攻击范围均会被别的棋子所阻挡。

可惜的是这个软件也不是顶优秀，给出的棋盘上的棋子可能互相会攻击，不过你不用理会这些，你只要保证你摆放的 bishop 不与它们以及不互相攻击就可以了。
## 输入格式

第一行是两个整数 $x,y$（$1 \leq x,y \leq 1024$）。

下面的 $x$ 行每行 $y$ 个字符表示棋盘。

其中：`K` – king，`Q` – queen，`B` – bishop，`N` – knight，`R` – rook，`P` – pawn，`.` – blank.
## 输出格式

仅一行一个数，表示最多能够摆放的 bishop 的个数。

## 样例

### 样例输入 #1
```
3 3
..N
...
...

```
### 样例输出 #1
```
2
```
## 提示

```plain
BBN
...
...
```

```plain
BBN
...
B..
```

虽然看上去下面的方法比上面的优秀，但是 N 被第三行的 B 攻击了。也就是说，你需要避免的有 2 种情况： 你摆放的 bishop 之间的互相攻击以及你摆放的 bishop 与预先摆放好的棋子之间的互相攻击；但不用考虑预先摆放好的棋子之间的互相攻击。



---

---
title: "[JLOI2008] 棋局定式"
layout: "post"
diff: 省选/NOI-
pid: P3883
tag: ['2008', '各省省选', '吉林']
---
# [JLOI2008] 棋局定式
## 题目描述

在“jloi-08”游戏中，还存有非常非常多的棋局定式，也就是常会用到的下棋的组合。有时在学习一个著名棋局时，电脑会考一考刘先生：在这局棋里面，有多少个定式啊？分别是什么啊？


对于30~40步的普通棋局，刘先生还能回答出来，可是有时候2个实力相当的大牛下的棋局，2000000步都有可能。如果电脑对这样的棋局提上面的问题时，刘先生就必须写一个程序来帮助自己了。可是，刘先生在这方面却…，怎么写也写不对。你能帮助刘先生吗？


棋局是由很多step组成的，而step是由一个字符串组成的，比如Kh2或者是Nxb7。

前者表示K(king)移动至h2格，后者表示N(knight)移动至b7格并吃掉原有的棋子。


第一个字符可能有6种：K Q B N R P，而后面可能是一个坐标或者是字符x后跟一个坐标。


坐标是由一个小写英文字母(a~h)和一个数字(1~8)组成的。


如果一个棋局中完整地并连续地包含一个定式中所有的step，那么这个棋局便包含这个定式。

## 输入格式

第一行2个整数n, m，表示定式的个数(1<=n<=2000)以及这个棋局所包含的步数


下面的n个块(block)，每块包含：

第一行一个整数k表示定式包含的步数(1<=k<=100000, ∑k<=200000)

第二行一个字符串表示该定式的名称(长度不超过50)

下面的k行每行一个字符串表示定式中的一步


最后的m行每行一个字符串，表示棋局中的一步

## 输出格式

按照输入文件包含的定式的顺序，输出棋局包含的所有定式的名称，一个一行。

## 样例

### 样例输入 #1
```
2 5
3
King's Knight Opening
Pe4
Pe5
Nf3
3
Nimzowitsch Variation
Pc4
Pe5
Nf3
Pe4
Pe5
Nf3
Nc6
Bb5

```
### 样例输出 #1
```
King's Knight Opening
```
## 提示

不保证给出的棋局和定式符合国际象棋的规则。



---

---
title: "[GDOI2014] 吃"
layout: "post"
diff: 省选/NOI-
pid: P3889
tag: ['2014', '各省省选', '广东']
---
# [GDOI2014] 吃
## 题目背景

感谢 @FFjet 提醒，第 8 个数据点损坏暂时删除。
## 题目描述

W师兄计划了很久，终于成功的在BG开了一家寿司店。

正当W师兄还在兴奋的时候，这时一个噩耗传来，吃货L师姐居然知道了这件事，而且正赶过来，W师兄瞬间心就冷了下去，但是机智的W师兄也瞬间想到了应付L师姐的策略.......

这时，L师姐到了寿司店，先四处望了望风景，发现现在只有L师姐一个顾客，下面是L师姐的选餐说明：

1.寿司店内的寿司被排在一行共N个盘子里，按从左到右编号为1~N。

2.每个位置上寿司的数量是确定的并且有玻璃窗保护。

3.每隔一段时间就会有一个选餐时间，L师姐可以在一个连续的区间[l, r]中选择其中一盘，然后在该区间之外选择另一盘（如果区间外有盘子）。

L师姐发现这家寿司店厨师的制作速度很快，总能在下一次选餐时间前将寿司数量恢复原样。

作为有尊严有追求的吃货，L师姐也有自己的规则，L师姐在选完两盘寿司后，会决定每口恰好吃D个寿司，且使得两盘寿司刚好可以分别吃完，不剩余任何寿司。比如两盘寿司数量为2和4,那么D=1或者D=2都可以恰好将两盘寿司分别吃干净，而两盘寿司数量为3和5时，那么只能D=1才行。

作为有特殊追求的L师姐才不在乎吃的数量，L师姐在乎的是一口吃多个寿司的感觉。于是，如果L师姐可以一口吃D个寿司，那么L师姐的愉悦值为D，但是L师姐没有选到两盘寿司，那么她的愉悦值为0。

现在L师姐知道每个盘子所放着的寿司数量，L师姐想知道每次选择时间过后她可以获得的最大愉悦值是多少？

## 输入格式

第一行输入一个整数N，表示寿司的盘子数量。

第二行输入N个整数a1,a2,…,aN，ai表示第i个盘子内的寿司数量。

第三行输入一个整数M，表示有多少个选餐时间。

接下来M行，每行两个整数li, ri (1 <= li <= ri <= N)，含义如题面所示。

## 输出格式

输出M行，第i行表示第i个选择时间师姐可能达到的最大愉悦值D。

## 样例

### 样例输入 #1
```
5
1 2 3 4 5
2
2 3
2 4
```
### 样例输出 #1
```
2
1
```
### 样例输入 #2
```
5
2 4 8 16 32
2
3 4
2 3
```
### 样例输出 #2
```
16
8

```
## 提示

###样例解释

样例1里的第一个选餐时间，可以选择2和4，这样L师姐就可以每次吃两个寿司，使得两个盘子都可以吃干净，第二个选餐时间，师姐不管选哪两个盘子，都只能每次吃一个。

样例2 里的第一个选餐时间，可以选择16和32,而第二个选餐时间，L师姐可以选择8和16或者8和32。

对于20%的数据，N <= 100, M <= 100, max(a1,a2,…,aN) <= 100。

对于50%的数据，N <= 10000, M <= 10000, max(a1,a2,…,aN) <= 10000。

对于100%的数据，N <= 100000, M <= 100000, max(a1,a2,…,aN) <= 100000。



---

---
title: "[GDOI2014] 比特矩阵"
layout: "post"
diff: 省选/NOI-
pid: P3890
tag: ['2014', '各省省选', '广东']
---
# [GDOI2014] 比特矩阵
## 题目背景

你知道矩阵乘法吗？

对于两个 $n\times n$ 的矩阵 A 和 B， 假设 $a_{i, j}$ 表示位于矩阵 A 的第 $i$ 行第 $j$ 列的元素， 同样对于B可以定义类似的 $b_{i,j}$。 那么如果 $C = A \times B$，则有 $c_{i, j}=\sum_{k=1}^{n} a_{ik} \times b_{kj}$。 其中 $ \sum$ 是序列求和符号，例如 $\sum_{i=1}^{n} i$ 表示 $1 + 2 + \cdots + n$。

## 题目描述

由于霍比特人的大热， L 的室友 X 最近热衷于研究它们所使用的货币。为了进行研究，X 需要了解一种叫比特矩阵的东西。 虽然比特矩阵也是矩阵，但是它的乘法和一般的矩阵有点不一样。

对于比特矩阵 $C = A \times B$， 意味着 $c_{i,j} = V_{k=1}^{n}a_{ik} \bigoplus b_{kj}$。其中 $V$ 是序列求按位或的符号，例如 $V_{i=1}^{n} i$ 表示 $1 \mid 2 \mid \cdots \mid n$。 $\mid$ 就是按位或的意思。 按位或是指从二进制的角度看两个数， 如果第 $i$ 位上两个数至少一个是1的话那结果的第 $i$ 位就是1， 否则第 $i$ 位就是 $0$。 $\bigoplus$ 表示按位异或运算， 即如果两个二进制数的第$i$位是不相同的话那么结果的第 $i$ 位就是 $1$，否则就是 $0$。

举个比特矩阵相乘的例子:

$$\begin{bmatrix}1&6\\3&5\end{bmatrix}\times\begin{bmatrix}3&6\\5&7\end{bmatrix}=\begin{bmatrix}3&7\\0&7\end{bmatrix}$$

现在 X 想要拜托你帮他算 $A^{m}$，其中 $A$ 是一个 $n\times n$ 的比特矩阵， 而 $A^{m}$ 表示 $m$ 个 $ A$ 相乘的结果。严谨地说:

- $A^{1}=A$；
- $A^{m}=A^{m-1}\times A,\ m>1$。

## 输入格式

输入第一行包含两个正整数 $n,m$。

接下来 $n$ 行，每行包含 $n$ 个非负整数，这 $n$ 行中第 $i$ 行的第 $j$ 个数表示比特矩阵 $a_{i,j}$ 的元素 。

## 输出格式

根据输入，输出一个比特矩阵 $A^{m}$。即按照输入给出 $A$ 的方式输出一个比特矩阵。 具体参看样例输出。

## 样例

### 样例输入 #1
```
2 4
10 5
5 10

```
### 样例输出 #1
```
0 15
15 0

```
### 样例输入 #2
```
3 16
6 5 7
5 6 7
7 7 6

```
### 样例输出 #2
```
0 3 3
3 0 3
3 3 0

```
## 提示

### 数据范围及约定

- 对于 $10\%$ 的数据 $n\le 4$，$ m\le 10000$。
- 对于 $30\%$ 的数据 $n\le 10$，$ m\le 10^9$。
- 对于 $100\%$ 的数据 $n\le 500$，$ m\le 10^9$, 所有输入的整数不超过$10^9$。



---

---
title: "[GDOI2014] 传送"
layout: "post"
diff: 省选/NOI-
pid: P3894
tag: ['2014', '各省省选', '广东']
---
# [GDOI2014] 传送
## 题目描述

有 $n$ 个国家，编号分别为 $0$ 到 $n-1$。第 $i$ 个国家包含 $m_i$ 个城市，编号分别为 $0$ 到 $m_{i}-1$，其中编号为 $0$ 的城市是该国家的首都。为了表示的方便，我们用 $(i,j)$ 来表示第 $i$ 个国家的第 $j$ 个城市。同一个国家的城市之间有通路，这些通路构成一棵树，首都则是这棵树的根。而不同国家的城市之间没有通路，只能通过传送门。每个国家只有处于叶子节点的城市具有传送门，传送门的目的地可以是编号相邻的国家的任意一个处于叶子节点的城市，每次传送需要花费 $1$ 个单位时间，并且每个传送门只能使用一次。如下图所示，如果出发地是 $(0,2)$，目的地是 $(2,1)$，则 $(0,2)\rightarrow(1,1)\rightarrow(1,0)\rightarrow(1,2)\rightarrow(2,1)$ 是一条可行路径，而 $(0,2)\rightarrow(1,1)\rightarrow(2,1)$ 则是非法的，因为 $(1,1)$ 的传送门在 $(0,2)\rightarrow(1,1)$ 的时候被使用了一次，在 $(1,1)\rightarrow(2,1)$ 的时候又被使用了一次。

 ![](https://cdn.luogu.com.cn/upload/pic/6852.png) 

给定出发地和目的地，问最少需要多少时间。
## 输入格式

输入第一行有一个正整数 $n$。

接下来有 $n$ 个模块，每块描述一个国家的情况。每个模块的第一行是一个正整数 $m_i$，表示编号为 $i$ 的国家包含的城市个数，接下来 $m_{i}-1$ 行，每行包含三个整数 $u,v,t$，表示从城市 $u$ 到城市 $v$ 有通路，需要花费的时间为 $t (1 \leq t \leq 10^{3})$。

接下来一行有一个正整数 $q$，表示查询的个数。接下来 $q$ 行，每一行包含四个整数，$s_0,s_1,e_0,e_1$，其中，$(s_0,s_1)$ 为出发地，$(e_0,e_1)$ 为目的地。
## 输出格式

输出有 $q$ 行，每行只包含一个整数。如果能从出发地到达目的地，输出最少时间，否则，输出 $-1$。
## 样例

### 样例输入 #1
```
5
3
0 1 1
0 2 1
3
0 1 2
2 0 1
3
0 1 1
0 2 1
2
0 1 2
3
0 1 1
0 2 1
3
0 2 2 1
0 0 2 1
2 2 4 1

```
### 样例输出 #1
```
5
6
-1

```
## 提示

对于 $40\%$ 的数据，$n \leq 10,\sum m_i \leq 10^{3},q \leq 10$。

对于 $60\%$ 的数据，$n \leq 10^{3},\sum m_i \leq 10^{6}$。

对于 $100\%$ 的数据，$n \leq 3.5 \times 10^{5},\sum m_i \leq 10^{6},1 \leq t \leq 10^{3},q \leq 10^{5}$。


---

---
title: "[TJOI2013] 数字根"
layout: "post"
diff: 省选/NOI-
pid: P3962
tag: ['2013', '各省省选', '天津']
---
# [TJOI2013] 数字根
## 题目描述

一个数字的数字根定义为:这个数字每一位的数字加起来求和,反复这个过程直到和小于10。例如,64357的数字跟为7,因为6+4+3+5+7=25,2+5=7个区间的数字根定义为这个区间所有数字和的数字根。

给定一个序列A1,A2,A3,…,An,你需要回答一些询问。每一个询问给定个区间[L,R],求出这个区间所有连续子区间里最大的前5个不同的数字根，不够5个的用-1补全

## 输入格式

第一行一个整数N,表示序列的长度。第二行是N个整数Ai(0≤Ai<10^9)。第三行是一个整数Q表示询问次数。接下来Q行,每一行两个正整数1,r,表示询问区间。(1≤l≤r≤N)

## 输出格式

Q行,表示每一个查询区间所有连续子区间里最大的前5个不同的数字根,按降序输出,输出用空格隔开。

## 样例

### 样例输入 #1
```
5
101 240 331 4 52
3
1 3
4 5
1 5
```
### 样例输出 #1
```
8 7 6 4 2
7 4 2 -1 -1
9 8 7 6 4
```
## 提示

### 样例解释

第一个查询区间[1,3],它的连续子区间有[1,1],[2,2],[3,3],[1,2],[2,3],[1,3].可对应的数字根分别为2,6,7,8,4,6。所以最大的5个是8,7,6,4,2。

### 数据范围

30%的数据，N ≤ 1000; Q ≤ 1000

100%的数据，N ≤ 100000; Q ≤ 100000



---

---
title: "[TJOI2013] 循环格"
layout: "post"
diff: 省选/NOI-
pid: P3965
tag: ['2013', '各省省选', '图论建模', '费用流', '天津']
---
# [TJOI2013] 循环格
## 题目背景

一个循环格就是一个矩阵,其中所有元素为箭头,指向相邻四个格子。每个元素有一个坐标(行,列),其中左上角元素坐标为(0,0)。给定一个起始位(r,c),你可以沿着箭头方向在格子间行走。即:如果(r,c)是一个左箭头，那么走到(r,c-1);如果是一个右箭头,走到(r,c+1);如果是上箭头,走到(r-1,c);如果是下箭头,走到(r+1,c)。每一行和每一列都是循环的,即如果走出边界,你会出现在另一侧。比如在一个5\*5的循环格里,从(3,0)向左走会出现在(3,4)。

## 题目描述

一个完美的循环格是这样定义的:对于任意一个起始位置,你都可以沿着箭头最终回到起始位置。如果一个循环格不满足完美,你可以随意修改任意一个元素的箭头直到完美。例如下图,左边不是一个完美的循环格,因为只有从(1,1),(1,2),(2,0),(2,3)出发才会回到起始位置。通过修改其中两个箭头,可以得到右图,一个完美的循环格。

 ![](https://cdn.luogu.com.cn/upload/pic/10987.png) 

给定一个循环格,你需要计算最少需要修改多少个元素使其完美。

## 输入格式

第一行两个整数R和C,表示循环格的行和列。接下来R行,每一行包含C个字符LRUD表示左右上下

## 输出格式

一个整数,表示最少需要修改多少个元素使得给定的循环格完美。

## 样例

### 样例输入 #1
```
4 4
RRRD
URDD
UULD
ULLL
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
3 4
RRRD
URLL
LRRR
```
### 样例输出 #2
```
2
```
## 提示

### 数据范围

30%的数据，1 ≤ R, C ≤ 7

100%的数据，1 ≤ R, C ≤ 15



---

---
title: "[TJOI2014] 匹配"
layout: "post"
diff: 省选/NOI-
pid: P3967
tag: ['2014', '各省省选', '枚举', '二分图', '费用流', '天津']
---
# [TJOI2014] 匹配
## 题目描述

有 $N$ 个单身的男孩和 $N$ 个单身女孩，男孩 $i$ 和女孩 $j$ 在一起得到的幸福值为 $H_{i,j}$。

一个匹配即对这 $N$ 个男孩女孩的安排：每个男孩恰好有一个女朋友，每个女孩恰好有一个男朋友。

一个匹配的幸福值即这 $N$ 对男女朋友的幸福值的和。

经典的问题是计算幸福值最大的匹配，即完美匹配。然而完美匹配有时候并不唯一，你需要计算对于所有的完美匹配，其交集是什么。
## 输入格式

输入的第一行是一个正整数 $N$ 。

接下来是一个 $N\times N$ 大小的矩阵 $H$，$H_{i,j}$ 表示男孩 $i$ 和女孩 $j$ 在一起的幸福值。
## 输出格式

第一行输出完美匹配的幸福值，接下来是若干行，每一行是一对整数 $i$ 和 $j$，表示男孩 $i$ 和女孩 $j$ 在所有完美匹配的交集中，以 $i$ 的递增顺序输出。
## 样例

### 样例输入 #1
```
3
1 1 1
2 1 1
1 1 1
```
### 样例输出 #1
```
4
2 1
```
## 提示

- 对于 $30\%$ 的数据，$N \leq 30$；
- 对于 $100\%$ 的数据，$1\leq N \leq 80$，$0\leq H_{i,j}\leq 5\times10^3$。


---

---
title: "[TJOI2014] 电源插排"
layout: "post"
diff: 省选/NOI-
pid: P3968
tag: ['2014', '线段树', '各省省选', '平衡树', '天津']
---
# [TJOI2014] 电源插排
## 题目描述

小 M 的实验室有很多电源插排。这些插排的编号从 $1$ 到 $n$，由左向右排成一排。

每天早晨，这些插排都是没有被使用的。每当一个学生来到实验室，他就将自己的笔记本电源插到某一个未被使用的插排上。

实验室的同学们都很奇怪，他们完成这个过程是这样的：首先，他们找到还没有被使用的插排的最长区间。

如果有多个区间长度相同，他们就选择最靠右的那个。然后将自己的电源插到该区间的中间。

如果区间长度是偶数，他们同样选择靠右的那个。当一个同学离开实验室时,他会将自己的电源拔出来。

数据保证每一个同学来到实验室时，至少有一个空的插排。

需要计算在区间 $[l,r]$ 已经有多少个插排被使用了。
## 输入格式

第一行是两个整数 $n$ 和 $q$，表示插排数量和询问数量。

接下来 $q$ 行，每一行以一个整数 $k$ 开头。

> 如果 $k$ 为 $0$，接下来就是两个整数 $l$ 和 $r$，表示一个询问。
>
> 否则 $k$ 表示表示编号为 $k$ 的学生到来或离开。$k$ 的奇数次出现表示到来，偶数次出现表示离开。每个学生的编号都是唯一的。

## 输出格式

对于每一个询问，输出一个整数，表示询问区间内有多少个插排已经被使用。
## 样例

### 样例输入 #1
```
7 10
1
2
3
0 1 2
0 4 7
0 2 5
20
0 6 6
99
0 4 6
```
### 样例输出 #1
```
1
2
2
1
3
```
## 提示

#### 数据规模与约定

对于 $30\%$ 的数据，$n \le 10^5，q \le 10^3$；

对于 $100\%$ 的数据，$1\le n \le 10^9,1\le q \le 10^5,0\le k \le 10^9,1\le l\le r\le n$。


---

---
title: "[TJOI2014] Alice and Bob"
layout: "post"
diff: 省选/NOI-
pid: P3971
tag: ['2014', '各省省选', '天津']
---
# [TJOI2014] Alice and Bob
## 题目描述

Alice 和 Bob 发明了一个新的游戏。给定一个序列 $\{x_0,x_1,\cdots,x_{n-1}\}$，Alice 得到一个序列 $\{a_0,a_1,\cdots,a_{n-1}\}$，其中 $a_i$ 表示以 $x_i$ 结尾的最长上升子序列的长度；Bob 得到一个序列$\{b_0,b_1,\cdots,b_{n-1}\}$，其中 $b_i$ 表示以 $x_i$ 开头的最长下降子序列的长度。Alice 的得分是序列 $\{a_i\}$ 的和，Bob的得分是序列 $\{b_i\}$ 的和。

## 输入格式

输入的第一行是 $n$，第二行是序列 $\{a_0,a_1,\cdots,a_{n-1}\}$。数据保证序列 $\{a_i\}$ 可以由至少一个 $1$ 到 $n$ 的排列得到。
## 输出格式

输出包含一行,表示在序列 $\{a_i\}$ 给定的情况下 Bob 能得到的最高分数。
## 样例

### 样例输入 #1
```
4
1 2 2 3
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4
1 1 2 3
```
### 样例输出 #2
```
5
```
## 提示

### 数据范围

对于 $30\%$ 的数据，$N \le 1000$。

对于 $100\%$ 的数据，$N \le 10^5$。



---

---
title: "[TJOI2014] 电影评分"
layout: "post"
diff: 省选/NOI-
pid: P3972
tag: ['2014', '各省省选', '天津']
---
# [TJOI2014] 电影评分
## 题目描述

小Z发明了一套新的电影评分系统。这套系统有三种操作:发布新电影、对电影评分、以及询问电影评分的排名。具体是这样运作的:如果是发布新电影,并且这部电影的有所主演之前均没有出现过,那么这部新电影的评分为0,否则这部电影的评分为**最近一部**与该电影**至少有一个共同主演**的电影的评分;如果是对电影进行评分,那么这部电影的评分就变成之前评分与新的评分的平均数;如果是查询排名,则根据评分输出相应排名。评分最高的为第一名。如果有多部电影分数相同,那么输出最早的一部。电影的评分在0到5之间。

## 输入格式

输入的第一行是n,表示操作次数。接下来n行,每一行是以下三种操作之一：

1. Q x:查询当前排名为x的电影ID

2. R ID x actor1 actor2 …· actorx:发布新电影ID,该电影有x个主演分别为 actor1, actor2,…’

3. C ID score:评分操作,表示对电影ID的评分为 score

数据保证每个电影的ID不相同,且每部电影至多不超过5名主演。

1≤ actor1, actor2,··≤10^5

1≤ID≤10^5

## 输出格式

对于每一个查询操作,输出相应排名的电影的ID。

## 样例

### 样例输入 #1
```
10 
R 1 1 1 
R 2 2 1 2 
C 2 2 
R 3 1 2 
Q 1 
C 3 2 
C 1 5 
Q 1 
Q 2 
Q 3
```
### 样例输出 #1
```
2 
1 
3 
2
```
## 提示

### 样例解释

| Movie | 1 | 2 | 3 | 
| :-: | :-: | :-: | :-: | :-: | :-: |
| | 0 | - | - |
| | 0 | 0 | - |
| | 0 | 1 | - |
| | 0 | 1 | 1 |
| Q 1 => 2 | //Movie 2 wa|s released be|fore Movie 3 |
| | 0 | 1 | 1.5 |
| | 2.5 | 1 | 1.5 |
| Q 1 => 1 |
| Q 2 => 3 |
| Q 3 => 2 |
### 数据范围

对于 30% 的数据，n ≤ 100

对于 100% 的数据，n ≤ 10000



---

---
title: "[TJOI2015] 线性代数"
layout: "post"
diff: 省选/NOI-
pid: P3973
tag: ['2015', '各省省选', '图论建模', '最小割', '天津']
---
# [TJOI2015] 线性代数
## 题目描述

为了提高智商，ZJY 开始学习线性代数。

她的小伙伴菠萝给她出了这样一个问题：给定一个 $n \times n$ 的矩阵 $B$ 和一个 $1 \times n$ 的矩阵 $C$。求出一个 $1×n$ 的 01 矩阵 $A$，使得 $D=(A×B-C)×A^{\sf T}$ 最大，其中$A^{\sf T}$为$A$的转置，输出$D$。
## 输入格式

第一行输入一个整数 $n$。接下来 $n$ 行输入 $B$ 矩阵，第 $i$ 行第 $j$ 个数代表 $B$ 接下来一行输入 $n$ 个整数，代表矩阵 $C$。矩阵 $B$ 和矩阵 $C$ 中每个数字都是不过 $1000$ 的非负整数。

## 输出格式

输出一个整数，表示最大的 $D$。
## 样例

### 样例输入 #1
```
3
1 2 1
3 1 0
1 2 3
2 3 7
```
### 样例输出 #1
```
2
```
## 提示

- 对于 $30\%$ 的数据，$n \leq 15$；
- 对于 $100\%$ 的数据，$1 \leq n \leq 500$；
- 另外还有两组不计分的 hack 数据，放在 subtask 2 中，数据范围与上面一致。



---

---
title: "[TJOI2015] 组合数学"
layout: "post"
diff: 省选/NOI-
pid: P3974
tag: ['数学', '递推', '2015', '各省省选', '线性递推', '天津']
---
# [TJOI2015] 组合数学
## 题目描述

为了提高智商，ZJY 开始学习组合数学。某一天她解决了这样一个问题：给一个网格图，其中某些格子有财宝。每次从左上角出发，只能往右或下走。问至少要走几次才可能把财宝全捡完。

但是她还不知足，想到了这个问题的一个变形：假设每个格子中有好多块财宝，而每一次经过一个格子至多只能捡走一块财宝，其他条件不变，至少要走几次才可能把财宝全捡完？

这次她不会做了，你能帮帮她吗？
## 输入格式

第一行为一个正整数 $t$，表示数据组数。

每组数据的第一行是两个正整数 $n$ 和 $m$，表示这个网格图有 $n$ 行 $m$ 列。

接下来 $n$ 行，每行 $m$ 个非负整数，表示这个格子中的财宝数量（$0$ 表示没有财宝）。
## 输出格式

对于每组数据，输出一个整数，表示至少走的次数。

## 样例

### 样例输入 #1
```
1
3 3
0 1 5
5 0 0
1 0 0
```
### 样例输出 #1
```
10
```
## 提示

### 数据范围

对于 $30\%$ 的数据，$n \le 5$，$m \le 5$，每个格子中的财宝数不超过 $5$ 块。

对于 $50\%$ 的数据，$n \le 100$，$m \le 100$，每个格子中的财宝数不超过 $1000$ 块。

对于 $100\%$ 的数据，$1\le t\le 2$，$1\le n \le 1000$，$1\le m \le 1000$，每个格子中的财宝不超过 $10^6$ 块。


---

---
title: "[TJOI2015] 弦论"
layout: "post"
diff: 省选/NOI-
pid: P3975
tag: ['2015', '各省省选', '后缀自动机 SAM', '枚举', '后缀数组 SA', '天津']
---
# [TJOI2015] 弦论
## 题目描述

为了提高智商，ZJY 开始学习弦论。这一天，她在《String theory》中看到了这样一道问题：对于一个给定的长度为 $n$ 的字符串，求出它的第 $k$ 小子串是什么。你能帮帮她吗?

## 输入格式

第一行是一个仅由小写英文字母构成的字符串 $s$。

第二行为两个整数 $t$ 和 $k$，$t$ 为 $0$ 则表示不同位置的相同子串算作一个，$t$ 为 $1$ 则表示不同位置的相同子串算作多个。$k$ 的意义见题目描述。

## 输出格式

输出数据仅有一行,该行有一个字符串，为第 $k$ 小的子串。若子串数目不足 $k$ 个，则输出 $-1$。

## 样例

### 样例输入 #1
```
aabc
0 3
```
### 样例输出 #1
```
aab
```
### 样例输入 #2
```
aabc
1 3
```
### 样例输出 #2
```
aa
```
### 样例输入 #3
```
aabc
1 11
```
### 样例输出 #3
```
-1
```
## 提示

### 数据范围

对于 $10\%$ 的数据，$n\leq 1000$。

对于 $50\%$ 的数据，$t = 0$。

对于 $100\%$ 的数据，$1\leq n \leq 5 \times 10^5$，$0\leq t \leq 1$，$1\leq k \leq 10^9$。



---

---
title: "[TJOI2015] 旅游"
layout: "post"
diff: 省选/NOI-
pid: P3976
tag: ['2015', '线段树', '各省省选', '树链剖分', '动态树 LCT', '天津']
---
# [TJOI2015] 旅游
## 题目描述

为了提高智商，ZJY 准备去往一个新世界去旅游。这个世界的城市布局像一棵树，每两座城市之间只有一条路径可以互达。  

每座城市都有一种宝石,有一定的价格。ZJY 为了赚取最高利益,她会选择从 A 城市买入再转手卖到 B 城市。  

由于ZJY买宝石时经常卖萌，因而凡是 ZJY 路过的城市，这座城市的宝石价格会上涨。让我们来算算 ZJY 旅游完之后能够赚取的最大利润。(如 A 城市宝石价格为 $v$，则ZJY出售价格也为 $v$)

## 输入格式

第一行输入一个正整数 $n$ 表示城市个数

接下来一行输入 $n$ 个正整数表示每座城市宝石的最初价格 $p$,每个宝石的初始价格不超过 $100$。

第三行开始连续输入 $n-1$ 行,每行有两个数字 $x$ 和 $y$。表示 $x$ 城市和 $y$ 城市有一条路径。城市编号从$1$开始。  

下一行输入一个正整数 $q$ 表示询问次数。

接下来 $q$ 行每行输入三个正整数 $a,b,v$，表示 ZJY 从 $a$ 旅游到 $b$，城市宝石上涨 $v$。

## 输出格式

对于每次询问，输出 ZJY 可能获得的最大利润，如果亏本了则输出 $0$。

## 样例

### 样例输入 #1
```
3
1 2 3
1 2
2 3
2
1 2 100
1 3 100
```
### 样例输出 #1
```
1
1
```
### 样例输入 #2
```
5
1 2 3 4 5
1 2
1 3
2 4
4 5
6
1 5 50
2 4 500
3 4 5000
3 5 50000
1 3 500000
2 3 5000000

```
### 样例输出 #2
```
4
2
551
551
0
499499
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n \le 100$，$q \le 10^4$。
- 对于 $100\%$ 的数据，保证 $1\le n,q \le 5\times 10^4$，在任何时刻任何城市的宝石价格都不超过 $10^9$。



---

---
title: "[TJOI2015] 棋盘"
layout: "post"
diff: 省选/NOI-
pid: P3977
tag: ['递推', '2015', '各省省选', '枚举', '矩阵加速', '进制', '天津', '状压 DP']
---
# [TJOI2015] 棋盘
## 题目描述

为了提高智商，ZJY 去新世界旅游了。可是旅游过后的 ZJY 杯具地发现要打开通往原来世界的门，必须要解开门上面画的谜题。谜题是这样的：

有个 $n$ 行 $m$ 列的棋盘，棋盘上可以放许多特殊的棋子。每个棋子的攻击范围是 $3$ 行 $p$ 列。输入数据用一个 $3\times p$ 的矩阵给出了棋子攻击范围的模板，棋子被默认为模板中的第 $1$ 行，第 $k$ 列，则棋子能攻击到的位置是 $1$，不能攻击到的位置是 $0$。输入数据保证第 $1$ 行第 $k$ 列的位置是 $1$。打开门的密码就是，在要求棋子互相不能攻击到的前提下，摆放棋子的方案数。注意什么棋子都不摆放也算作一种可行方案。由于方案数可能很大,而密码为 $32$ 位的二进制密码,所以 ZJY 仅需要知道方案数对 $2^{32}$ 次方取余数的结果即可。

注意：编号从 $0$ 开始，即第 $1$ 行指的是中间那行。
## 输入格式

输入数据的第一行为两个整数 $n$ 和 $m$，表示棋盘的大小。

第二行为两个整数 $p$ 和 $k$，表示接下来的攻击范围模板的大小，以及棋子在模板中的位置。

接下来三行,每行有 $p$ 个数,表示攻击范围的模版。每个数字后有一个空格。
## 输出格式

输出数据仅有一行，一个整数，表示可行的方案数模 $2^{32}$ 的余数。
## 样例

### 样例输入 #1
```
5 5
3 1
0 1 0
1 1 1
0 1 0

```
### 样例输出 #1
```
55447

```
## 提示

### 数据范围

对于 $10\%$ 的数据，$1 \leq n \leq 5$，$1 \leq m \leq5$。

对于 $50\%$ 的数据，$1 \leq n \leq 1000$，$1 \leq m \leq 6$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^{6}$，$1 \leq m \leq 6$。


---

---
title: "[TJOI2015] 概率论"
layout: "post"
diff: 省选/NOI-
pid: P3978
tag: ['递推', '2015', '各省省选', 'Special Judge', 'Catalan 数', '生成函数', '期望', '天津']
---
# [TJOI2015] 概率论
## 题目描述

为了提高智商，ZJY 开始学习概率论。有一天，她想到了这样一个问题：对于一棵随机生成的 $n$ 个结点的有根二叉树（所有互相不同构的形态等概率出现），它的叶子节点数的期望是多少呢？

判断两棵树是否同构的伪代码如下：

$$
\def\arraystretch{1.2}
    \begin{array}{ll}
    \hline
    \textbf{算法 1}&\text{Check}(T1,T2) \\
    \hline
    1&\textbf{Require: }\text{ 两棵树的节点}T1,T2\\
    2&\qquad\textbf{if}\ \ T1=\text{null}\textbf{ or }T2=\text{null}\textbf{ then }\\
    3&\qquad\qquad\textbf{return}\ \ T1=\text{null}\textbf{ and }T2=\text{null}\\
    4&\qquad\textbf{else}\\
    5&\qquad\qquad\textbf{return}\ \text{Check}(T1\to\mathit{leftson},T2\to\mathit{leftson}) \\ 
    & \qquad\qquad\qquad \textbf{ and }\text{Check}(T1\to\mathit{rightson},T2\to\mathit{rightson})\\
    6&\qquad\textbf{endif}\\
    \hline
    \end{array} 
    $$


## 输入格式

输入一个正整数 $n$，表示有根树的结点数。

## 输出格式

输出这棵树期望的叶子节点数，要求误差小于 $10^{-9}$。

## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
1.000000000
```
### 样例输入 #2
```
3
```
### 样例输出 #2
```
1.200000000
```
## 提示

## 数据范围

对于 $30\%$ 的数据，$1 \le n \le 10$。

对于 $70\%$ 的数据，$1 \le n \le 100$。

对于 $100\%$ 的数据，$1 \le n \le 10^9$。


---

---
title: "[SHOI2013] 发牌"
layout: "post"
diff: 省选/NOI-
pid: P3988
tag: ['模拟', '2013', '线段树', '各省省选', '平衡树', '树状数组', '上海', '可持久化线段树']
---
# [SHOI2013] 发牌
## 题目描述

在一些扑克游戏里，如德州扑克，发牌是有讲究的。一般称呼专业的发牌手为荷官。荷官在发牌前，先要销牌（burn card）。所谓销牌，就是把当前在牌库顶的那一张牌移动到牌库底，它用来防止玩家猜牌而影响游戏。

假设一开始，荷官拿出了一副新牌，这副牌有 $N$ 张不同的牌，编号依次为 $1$ 到 $N$。由于是新牌，所以牌是按照顺序排好的，从牌库顶开始，依次为 $1,2,\cdots,N$，$N$ 号牌在牌库底。为了发完所有的牌，荷官会进行 $N$ 次发牌操作，在第 $i$ 次发牌之前，他会连续进行 $R_i$ 次销牌操作，$R_i$ 由输入给定。请问最后玩家拿到这副牌的顺序是什么样的？

举个例子，假设 $N=4$，则一开始的时候，牌库中牌的构成顺序为 $1,2,3,4$。

- 假设 $R_1=2$，则荷官应该连销两次牌，将 $1$ 和 $2$ 放入牌库底，再将 $3$ 发给玩家。目前牌库中的牌顺序为 $4,1,2$。
- 假设 $R_2=0$，荷官不需要销牌，直接将 $4$ 发给玩家，目前牌库中的牌顺序为 $1,2$。
- 假设 $R_3=3$，则荷官依次销去了 $1,2,1$，再将 $2$ 发给了玩家。目前牌库仅剩下一张牌 $1$。
- 假设 $R_4=2$，荷官在重复销去两次 $1$ 之后，还是将 $1$ 发给了玩家，这是因为 $1$ 是牌库中唯一的一张牌。
## 输入格式

第一行，一个整数 $N$，表示牌的数量。

第二行到第 $N+1$ 行，在第 $i+1$ 行，有一个整数 $R_i$。

## 输出格式

共 $N$ 行，第 $i$ 行有一个整数，表示玩家收到的第 $i$ 张牌的编号。
## 样例

### 样例输入 #1
```
4
2
0
3
2
```
### 样例输出 #1
```
3
4
2
1
```
## 提示

#### 数据规模与约定

对于 $100 \%$ 的数据，$0 \le R_i < N$。  

| 测试点编号 | $N=$ | 测试点编号 | $N=$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $5\times 10^3$ | $6$ | $3\times 10^5$ |
| $2$ | $10^4$ |  $7$ | $4\times 10^5$ |
| $3$ | $5\times 10^4$ | $8$ | $5\times 10^5$ |
| $4$ | $10^5$ | $9$ | $6\times 10^5$ |
| $5$ | $2\times 10^5$ | $10$ | $7\times 10^5$ |


---

---
title: "[SHOI2013] 阶乘字符串"
layout: "post"
diff: 省选/NOI-
pid: P3989
tag: ['2013', '各省省选', '上海']
---
# [SHOI2013] 阶乘字符串
## 题目背景

shoi2013d1t2

（本题卡常数注意）

## 题目描述

给定一个由前 $n$ 个小写字母组成的串 $S$。串 $S$ 是阶乘字符串当且仅当前 $n$ 个小写字母的全排列（共 $n!$ 种）都作为的子序列（可以不连续）出现。

由这个定义出发，可以得到一个简单的枚举法去验证，但是它实在太慢了。所以现在请你设计一个算法，在 $1$ 秒内判断出给定的串是否是阶乘字符串。
## 输入格式

输入第 $1$ 行一个整数 $T$，表示这个文件中会有 $T$ 组数据。

接下来分 $T$ 个块，每块 $2$ 行：

- 第 $1$ 行一个正整数 $n$，表示 $S$ 由前 $n$ 个小写字母组成。
- 第 $2$ 行一个字符串 $s$。
## 输出格式

对于每组数据，分别输出一行。每行是 `YES` 或者 `NO`，表示该数据对应的串 $S$ 是否是阶乘字符串。
## 样例

### 样例输入 #1
```
2
2
bbaa
2
aba
```
### 样例输出 #1
```
NO
YES
```
## 提示

第一组数据中，`ab` 这个串没有作为子序列出现。

![](https://cdn.luogu.com.cn/upload/image_hosting/9zs871wl.png)



---

---
title: "[SHOI2013] 超级跳马"
layout: "post"
diff: 省选/NOI-
pid: P3990
tag: ['2013', '各省省选', '上海', '前缀和', '矩阵乘法', '构造']
---
# [SHOI2013] 超级跳马
## 题目描述

现有一个 $n$ 行 $m$ 列的棋盘，一只马欲从棋盘的左上角跳到右下角。每一步它向右跳奇数列，且跳到本行或相邻行。跳越期间，马不能离开棋盘。例如，当 $n = 3$，$m = 10$ 时，下图是一种可行的跳法。

![](https://cdn.luogu.com.cn/upload/pic/9367.png) 

试求跳法种数对 $30\,011$ 取模的结果。
## 输入格式

仅有一行，包含两个正整数 $n, m$，表示棋盘的规模。
## 输出格式

仅有一行，包含一个整数，即跳法种数模 $30\,011$ 后的结果。

## 样例

### 样例输入 #1
```
3 5
```
### 样例输出 #1
```
10
```
## 提示

- 对于 $10\%$ 的数据，$1 \leq n \leq 10$，$2 \leq m \leq 10$；
- 对于 $50\%$ 的数据，$1 \leq n \leq 10$，$2 ≤ m ≤ 10^5$；
- 对于 $80\%$ 的数据，$1 \leq n \leq 10$，$2 \leq m \leq 10^9$；
- 对于 $100\%$ 的数据，$1 \leq n \leq 50$，$2 \leq m \leq 10^9$。



---

---
title: "[BJOI2017] 喷式水战改"
layout: "post"
diff: 省选/NOI-
pid: P3991
tag: ['动态规划 DP', '2017', '各省省选', '平衡树', '北京', 'O2优化', '分治']
---
# [BJOI2017] 喷式水战改
## 题目背景

拿到了飞机的驾照(?)，这样补给就不愁了

XXXX年XX月XX日

拿到了喷气机(??)的驾照，这样就飞得更快了

XXXX年XX月XX日

拿到了攻击机(???)的驾照（不存在的）

XXXX年XX月XX日

用铅版做夹层的话，机身可是会变重的呢

XXXX年XX月XX日

幸酱的特制快递，精确投递到了目标地点

-------------------------------------

又是核平的一天。

天音正在给喷气机做保养，并充填燃料。

这种喷气机是某姬(?????)特别制作的，发动机拥有三种工作状态

1、通常型（Original）：在高空平飞或隐蔽飞行时进行的低功耗高效率工作状态

2、后期型（Extended）：为在俯冲时最大化能量利用率而特别改造过的工作状态

3、增强型（Enhanced）：在俯冲攻击结束后为产生极限扭力抬高高度的工作状态

在一次攻击中，喷气机将会经历"通常-后期-增强-通常"的工作流程

不同工作状态中，燃料的利用效率是不同的

现在天音正在调整喷气机燃料装填序列

你需要做的就是求出燃料能产生的最大总能量

为什么是你？

和平还是核平，选一个吧

## 题目描述

初始燃料序列为空。每次操作会向序列中的 $p _ i$ 位置添加 $x _ i$ 单位的同种燃料，该燃料每一单位在三种工作状态下能产生的能量分别为 $a _ i, b _ i, c _ i$。

添加的位置 $p _ i$ 是指，在添加后，加入的第一个单位燃料前面有 $p _ i$ 个单位的原燃料。

全部的 $x _ i$ 单位燃料依次放置，然后原来在 $p _ i$ 位置的燃料（如果有的话）依次向后排列。

对于一个确定的燃料序列，其能产生的最大总能量为：将序列依次分成"通常-后期-增强-通常"四段（每段可以为空），每一段在对应工作状态下产生的能量之和的最大值。

对于每次添加操作，你需要给出该次操作使得最大总能量增加了多少。

如果对于这种计算方式没有直观的感受，可以查看样例说明。

## 输入格式

第一行一个数 $n$，表示操作个数。

接下来 $n$ 行，每行 $5$ 个数 $p _ i, a _ i, b _ i, c _ i, x _ i$，空格分隔，表示向序列中的 $p _ i$ 位置添加 $x _ i$ 单位的同种燃料

这种燃料每单位在通常、后期、增强工作状态下产生的能量分别为 $a _ i, b _ i, c _ i$。


## 输出格式

$n$ 行，每行一个数，表示该次操作后能量序列所能产生的最大总能量增加了多少。

## 样例

### 样例输入 #1
```
5
0 25 37 46 2
1 32 14 16 3
3 99 77 88 4
2 43 68 57 5
14 72 36 18 6

```
### 样例输出 #1
```
92
75
396
319
432
```
## 提示

第一次操作后，燃料序列为[1 1]，最大能量发生方式为[En1 En1]，共46+46=92。

第二次操作后，燃料序列为[1 2 2 2 1]，最大能量发生方式为[Or1 Or2 Or2 Or2 En1]，共25+32+32+32+46=167，增加了167-92=75。

第三次操作后，燃料序列为[1 2 2 3 3 3 2 1]，最大能量发生方式为[Or1 Or2 Or2 Or3 Or3 Or3 Or3 Or2 En1]，增加了99\*4=396。

第四次操作后，燃料序列为[1 2 4 4 4 4 4 2 3 3 3 2 1]

最大能量发生方式为[Or1 Or2 Ex4 Ex4 Ex4 Ex4 Ex4 Or2 Or3 Or3 Or3 Or3 Or2 Or1]。

第五次操作后，燃料序列为[1 2 4 4 4 4 4 2 3 3 3 2 1 5 5 5 5 5 5]

最大能量发生方式为[Or1 Or2 Ex4 Ex4 Ex4 Ex4 Ex4 Or2 Or3 Or3 Or3 Or3 Or2 Or1 Or5 Or5 Or5 Or5 Or5 Or5]。


对于 $100\%$ 的数据，$1 \leq n \leq 10^5$, $1 \leq a_i, b_i, c_i \leq 10^4$， $1 \leq x_i \leq 10^9$。

对于 $100\%$ 的数据，保证插入时序列中至少已有 $p _ i$ 单位的燃料。

后 $50\%$ 数据有梯度。



---

---
title: "[SHOI2013] 扇形面积并"
layout: "post"
diff: 省选/NOI-
pid: P3997
tag: ['2013', '线段树', '各省省选', '递归', '上海', 'O2优化', '排序']
---
# [SHOI2013] 扇形面积并
## 题目描述

 ![](https://cdn.luogu.com.cn/upload/pic/11825.png) 

给定 n 个同心的扇形，求有多少面积，被至少 $k$ 个扇形所覆盖。

## 输入格式

第一行是三个整数 $n$，$m$，$k$。$n$ 代表同心扇形个数，$m$ 代表将 $(−\pi ,\pi]$ 的角度区间平均分成 $2m$ 份。

从第二行开始的 $n$ 行，每行三个整数 $r，a_1，a_2$。描述了一个圆心在原点的扇形，半径为 $r$，圆心角是从弧度 $\pi\times \frac{a_1}{m}$ 到 $\pi\times \frac{a_2}{m}$（$a_1$ 不一定小于 $a_2$）。

## 输出格式

输出一个整数 $ans$ ，$\frac{\pi}{2m}\times ans$ 等于至少 $k$ 个扇形所覆盖的总面积。

数据保证答案在 $2^{63} - 1$ 范围内。

## 样例

### 样例输入 #1
```
3 8 2
1 -8 8
3 -7 3
5 -5 5
```
### 样例输出 #1
```
76
```
### 样例输入 #2
```
2 4 1
4 -4 2
1 -4 4
```
### 样例输出 #2
```
98
```
## 提示

对于 $100\%$ 的数据，$1\leq n\leq 10^5$, $1\leq m\leq 10^6$, $1\leq k\leq 5000$, $1\leq r_i\leq 10^5$,$-m\leq a_1,a_2\leq m$。



---

---
title: "[SHOI2008] 循环的债务"
layout: "post"
diff: 省选/NOI-
pid: P4026
tag: ['动态规划 DP', '2008', '各省省选', '上海', '枚举', '背包 DP']
---
# [SHOI2008] 循环的债务
## 题目描述

Alice、Bob和Cynthia总是为他们之间混乱的债务而烦恼，终于有一天，他们决定坐下来一起解决这个问题。不过，鉴别钞票的真伪是一件很麻烦的事情，于是他们决定要在清还债务的时候尽可能少的交换现金。

比如说，Alice欠Bob 10元，而Cynthia和他俩互不相欠。现在假设Alice只有一张50元，Bob有3张10元和10张1元，Cynthia有3张20元。一种比较直接的做法是：Alice将50元交给Bob，而Bob将他身上的钱找给Alice，这样一共就会有14张钞票被交换。但这不是最好的做法，最好的做法是：Alice把50块给Cynthia，Cynthia再把两张20给Alice，另一张20给Bob，而Bob把一张10块给C，此时只有5张钞票被交换过。

没过多久他们就发现这是一个很棘手的问题，于是他们找到了精通数学的你为他们解决这个难题。

## 输入格式

输入的第一行包括三个整数：$x_1$、$x_2$、$x_3$（-1,000≤$x_1$，$x_2$，$x_3$≤1,000），其中

$x_1$代表Alice欠Bob的钱（如果$x_1$是负数，说明Bob欠了Alice的钱）

$x_2$代表Bob欠Cynthia的钱（如果$x_2$是负数，说明Cynthia欠了Bob的钱）

$x_3$代表Cynthia欠Alice的钱（如果$x_3$是负数，说明Alice欠了Cynthia的钱）

接下来有三行，每行包括6个自然数：

a100，a50，a20，a10，a5，a1

b100，b50，b20，b10，b5，b1

c100，c50，c20，c10，c5，c1

a100表示Alice拥有的100元钞票张数，b50表示Bob拥有的50元钞票张数，以此类推。另外，我们保证有a10+a5+a1≤30，b10+b5+b1≤30，c10+c5+c1≤30，而且三人总共拥有的钞票面值总额不会超过1,000。

## 输出格式

如果债务可以还清，则输出需要交换钞票的最少张数；如果不能还清，则输出“impossible”（注意单词全部小写，输出到文件时不要加引号）。

## 样例

### 样例输入 #1
```
10 0 0
0 1 0 0 0 0
0 0 0 3 0 10
0 0 3 0 0 0
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
-10 -10 -10
0 0 0 0 0 0
0 0 0 0 0 0
0 0 0 0 0 0
```
### 样例输出 #2
```
0
```
## 提示

对于30%的数据，$x_1$、$x_2$、$x_3$ ≤ |50|。
对于100%的数据，$x_1$、$x_2$、$x_3$ ≤ |1,000|。



---

---
title: "[JSOI2008] 火星人"
layout: "post"
diff: 省选/NOI-
pid: P4036
tag: ['字符串', '2008', '各省省选', '平衡树', '江苏', '哈希 hashing']
---
# [JSOI2008] 火星人
## 题目描述

火星人最近研究了一种操作：求一个字串两个后缀的公共前缀。

比方说，有这样一个字符串：madamimadam，我们将这个字符串的各个字符予以标号：
```
序号 1 2 3 4 5 6 7 8 9 10 11 
字符 m a d a m i m a d a m
```
现在，火星人定义了一个函数 $LCQ(x, y)$，表示：该字符串中第 $x$ 个字符开始的字串，与该字符串中第 $y$ 个字符开始的字串，两个字串的公共前缀的长度。比方说，$LCQ(1, 7) = 5, LCQ(2, 10) = 1, LCQ(4, 7) = 0$

在研究 $LCQ$ 函数的过程中，火星人发现了这样的一个关联：如果把该字符串的所有后缀排好序，就可以很快地求出 $LCQ$ 函数的值；同样，如果求出了 $LCQ$ 函数的值，也可以很快地将该字符串的后缀排好序。

尽管火星人聪明地找到了求取 $LCQ$ 函数的快速算法，但不甘心认输的地球人又给火星人出了个难题：在求取 $LCQ$ 函数的同时，还可以改变字符串本身。具体地说，可以更改字符串中某一个字符的值，也可以在字符串中的某一个位置插入一个字符。地球人想考验一下，在如此复杂的问题中，火星人是否还能够做到很快地求取 $LCQ$ 函数的值。
## 输入格式

第一行给出初始的字符串。第二行是一个非负整数 $M$ ，表示操作的个数。接下来的M行，每行描述一个操作。操作有 $3$ 种，如下所示

1. 询问。语法：$Q$ $x$ $y$ ，$x$ ,$y$ 均为正整数。功能：计算 $LCQ(x,y)$ 限制：$1$ $\leq$ $x$ , $y$ $\leq$ 当前字符串长度 。
2. 修改。语法：$R$ $x$ $d$，$x$ 是正整数，$d$ 是字符。功能：将字符串中第 $x$ 个数修改为字符 $d$ 。限制：$x$ 不超过当前字符串长度。
3. 插入：语法：$I$ $x$ $d$ ，$x$ 是非负整数，$d$ 是字符。功能：在字符串第 $x$ 个字符之后插入字符 $d$ ，如果 $x=0$，则在字符串开头插入。限制：$x$ 不超过当前字符串长度
## 输出格式

对于输入文件中每一个询问操作，你都应该输出对应的答案。一个答案一行。
## 样例

### 样例输入 #1
```
madamimadam
7
Q 1 7
Q 4 8
Q 10 11
R 3 a
Q 1 7
I 10 a
Q 2 11
```
### 样例输出 #1
```
5
1
0
2
1
```
## 提示

1. 所有字符串自始至终都只有小写字母构成。
2. $M\leq150,000$
3. 字符串长度L自始至终都满足$L\leq100,000$
4. 询问操作的个数不超过 $10,000$ 个。

对于第 $1$，$2$ 个数据，字符串长度自始至终都不超过 $1,000$
对于第 $3$，$4$，$5$ 个数据，没有插入操作。

2024/07/40 更新一组 hack。


---

---
title: "[JSOI2008] 魔兽地图"
layout: "post"
diff: 省选/NOI-
pid: P4037
tag: ['2008', '各省省选', '江苏', 'O2优化', '枚举', '背包 DP']
---
# [JSOI2008] 魔兽地图
## 题目描述

DotR (Defense of the Robots) Allstars是一个风靡全球的魔兽地图，他的规则简单与同样流行的地图DotA (Defense of the Ancients) Allstars。

DotR里面的英雄只有一个属性——力量。他们需要购买装备来提升自己的力量值，每件装备都可以使佩戴它的英雄的力量值提高固定的点数，所以英雄的力量值等于它购买的所有装备的力量值之和。装备分为基本装备和高级装备两种。基本装备可以直接从商店里面用金币购买，而高级装备需要用基本装备或者较低级的高级装备来合成，合成不需要附加的金币。装备的合成路线可以用一棵树来表示。

比如，Sange and Yasha的合成需要Sange,Yasha和Sange and Yasha Recipe Scroll三样物品。其中Sange又要用Ogre Axe, Belt of Giant Strength和 Sange Recipe Scroll合成。每件基本装备都有数量限制，这限制了你不能无限制地合成某些性价比很高的装备。

现在，英雄Spectre有M个金币，他想用这些钱购买装备使自己的力量值尽量高。你能帮帮他吗？他会教你魔法Haunt（幽灵附体）作为回报的。

## 输入格式

第一行包含两个整数，N (1 <= n <= 51) 和 m (0 <= m <= 2,000)。分别表示装备的种类数和金币数。装备用1到N的整数编号。

接下来的N行，按照装备1到装备n的顺序，每行描述一种装备。

每一行的第一个非负整数表示这个装备贡献的力量值。

接下来的非空字符表示这种装备是基本装备还是高级装备，A表示高级装备，B表示基本装备。如果是基本装备，紧接着的两个正整数分别表示它的单价（单位为金币）和数量限制（不超过100）。如果是高级装备，后面紧跟着一个正整数C，表示这个高级装备需要C种低级装备。后面的2C个数，依次描述某个低级装备的种类和需要的个数。

## 输出格式

第一行包含一个整数S，表示最多可以提升多少点力量值。

## 样例

### 样例输入 #1
```
10 59
5 A 3 6 1 9 2 10 1
1 B 5 3
1 B 4 3
1 B 2 3
8 A 3 2 1 3 1 7 1
1 B 5 3
5 B 3 3
15 A 3 1 1 5 1 4 1
1 B 3 5
1 B 4 3
```
### 样例输出 #1
```
33
```


---

---
title: "[AHOI2014/JSOI2014] 宅男计划"
layout: "post"
diff: 省选/NOI-
pid: P4040
tag: ['贪心', '2014', '各省省选', '江苏', '安徽']
---
# [AHOI2014/JSOI2014] 宅男计划
## 题目背景

自从迷上了拼图，JYY 就变成了个彻底的宅男。为了解决温饱问题，JYY 不得不依靠叫外卖来维持生计。

## 题目描述

外卖店一共有 $n$ 种食物，分别从 $1$ 到 $n$ 编号。第 $i$ 种食物有固定的价钱 $p_i$ 和保质期 $s_i$。第 $i$ 种食物会在 $s_i$ 天后过期。JYY 是不会吃过期食物的。

比如 JYY 如果今天点了一份保质期为 $1$ 天的食物，那么 JYY 必须在今天或者明天把这个食物吃掉，否则这个食物就再也不能吃了。保质期可以为 $0$ 天，这样这份食物就必须在购买当天吃掉。

JYY 现在有 $m$ 块钱，每一次叫外卖需要额外付给送外卖小哥外送费 $f$ 元。

送外卖的小哥身强力壮，可以瞬间给 JYY 带来任意多份食物。JYY 想知道，在满足每天都能吃到至少一顿没过期的外卖的情况下，他可以最多宅多少天呢？

## 输入格式

第一行包含三个整数，分别表示 $m, f, n$。

第 $2$ 到第 $(n + 1)$ 行，每行两个整数，第 $(i + 1)$ 行的整数表示第 $i$ 种食物的价格 $p_i$ 和保质期 $s_i$。
## 输出格式

输出一行一个整数，表示 JYY 可以宅的最多的天数。

## 样例

### 样例输入 #1
```
32 5 2
5 0
10 2
```
### 样例输出 #1
```
3
```
## 提示

#### 样例输入输出 1 解释
JYY的最佳策略是：
- 第一天买一份食物 $1$ 和一份食物 $2$ 并且吃一份食物 $1$；
- 第二天吃一份食物 $2$；
- 第三天买一份食物 $1$ 并且吃掉。

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq n \leq 200$，$0 \leq s_i \leq 10^{18}$，$1 \leq f, p_i, m \leq10^{18}$。


---

---
title: "[AHOI2014/JSOI2014] 奇怪的计算器"
layout: "post"
diff: 省选/NOI-
pid: P4041
tag: ['2014', '各省省选', '江苏', '安徽']
---
# [AHOI2014/JSOI2014] 奇怪的计算器
## 题目背景

JYY 有个奇怪的计算器，有一天这个计算器坏了，JYY 希望你能帮助他写一个程序来模拟这个计算器的运算。
## 题目描述

JYY 的计算器可以执行 $N$ 条预设好的指令。每次 JYY 向计算器输入一个正整数 $X$，计算器就会以 $X$ 作为初始值，接着依次执行预设的 $N$ 条指令，最后把最终得出的结果返回给 JYY。

每一条指令可以是以下四种指令之一：（这里 $a$ 表示一个正整数。）

1. $+a$：表示将当前的结果加上 $a$；
2. $-a$：表示将当前的结果减去 $a$；
3. $\times a$：表示将当前的结果乘以 $a$；
4. $@a$：表示将当前的结果加上 $a\times X$（$X$ 是一开始 JYY 输入的数）。

计算器用于记录运算结果的变量的存储范围是有限的，所以每次运算结束之后会有计算结果溢出的问题。

JYY 的计算器中，存储每计算结果的变量只能存储 $L$ 到 $R$ 之间的正整数，如果一次指令执行过后，计算结果超过了 $R$，那么计算器就会自动把结果变成 $R$，然后再以 $R$ 作为当前结果继续进行之后的计算。同理，如果运算结果小于 $L$，计算器也会把结果变成 $L$，再接着计算。

比如，假设计算器可以存储 $1$ 到 $6$ 之间的值，如果当前的计算结果是 $2$，那么在执行 $+5$ 操作之后，存储结果的变量中的值将会是 $6$。虽然 $2+5$ 的实际结果是 $7$，但是由于 $7$ 超过了存储范围的上界，所以结果就被自动更正成了上界的大小，也就是 $6$。

JYY 一共想在计算器上输入 $Q$ 个值，他想知道这 $Q$ 个值输入计算器之后，分别会得到什么结果呢？
## 输入格式

第一行包含三个正整数，$N$，$L$ 和 $R$。

接下来 $N$ 行，每行一个指令，每个指令如题述，由一个字符和一个正整数组成，字符和正整数中间有一个空格隔开。

第 $N+2$ 行包含一个整数 $Q$，表示 JYY 希望输入的数的数量。

第接下来 $Q$ 行每行一个正整数，第 $k$ 个正整数 $X_k$ 表示 JYY 在第 $k$ 次输入的整数。
## 输出格式

输出 $Q$ 行每行一个正整数，第 $k$ 行的整数表示输入 $X_k$ 后，依次经过 $N$ 个指令进行计算所得到的结果。
## 样例

### 样例输入 #1
```
5 1 6
+ 5
- 3
* 2
- 7
@ 2
3
2
1
5
```
### 样例输出 #1
```
5
3
6
```
## 提示

### 样例解释

当 JYY 输入 $2$ 时，计算器会进行 $5$ 次运算，每一次运算之后得到的结果分别是 $6$（实际计算结果为 $7$ 但是超过了上界），$3,6,1$（实际结果为 $-1$ 但是低于了下界）和 $5$（由于一开始输入的是 $2$，所以这一次计算为 $1+2 \times 2$）。

### 数据范围及约定

对于所有测试数据，$1\le N$，$Q\le 10^5$，$1\le L\le X_k\le R\le 10^9$，$1\le a\le 10^9$。


---

---
title: "[AHOI2014/JSOI2014] 支线剧情"
layout: "post"
diff: 省选/NOI-
pid: P4043
tag: ['2014', '各省省选', '网络流', '江苏', '安徽', '上下界网络流', '费用流']
---
# [AHOI2014/JSOI2014] 支线剧情
## 题目背景

宅男 JYY 非常喜欢玩 RPG 游戏，比如仙剑，轩辕剑等等。不过 JYY 喜欢的并不是战斗场景，而是类似电视剧一般的充满恩怨情仇的剧情。这些游戏往往都有很多的支线剧情，现在 JYY 想花费最少的时间看完所有的支线剧情。
## 题目描述

JYY 现在所玩的 RPG 游戏中，一共有 $N$ 个剧情点，由 $1$ 到 $N$ 编号，第 $i$ 个剧情点可以根据 JYY 的不同的选择，而经过不同的支线剧情，前往 $K_i$ 种不同的新的剧情点。当然如果为 $0$，则说明 $i$ 号剧情点是游戏的一个结局了。

JYY 观看一个支线剧情需要一定的时间。JYY 一开始处在 $1$ 号剧情点，也就是游戏的开始。显然任何一个剧情点都是从 $1$ 号剧情点可达的。此外，随着游戏的进行，剧情是不可逆的。所以游戏保证从任意剧情点出发，都不能再回到这个剧情点。由于 JYY 过度使用修改器，导致游戏的“存档”和“读档”功能损坏了，

所以 JYY 要想回到之前的剧情点，唯一的方法就是退出当前游戏，并开始新的游戏，也就是回到 $1$ 号剧情点。JYY 可以在任何时刻退出游戏并重新开始。不断开始新的游戏重复观看已经看过的剧情是很痛苦，JYY 希望花费最少的时间，看完所有不同的支线剧情。
## 输入格式

输入一行包含一个正整数 $N$。

接下来 $N$ 行，第 $i$ 行为 $i$ 号剧情点的信息；

第一个整数为 $K_i$，接下来 $K_i$ 个整数对，$b_{i,j}$ 和 $t_{i,j}$，表示从剧情点 $i$ 可以前往剧情点 $b_{i,j}$，并且观看这段支线剧情需要花费 $t_{i,j}$ 的时间。
## 输出格式

输出一行包含一个整数，表示 JYY 看完所有支线剧情所需要的最少时间。
## 样例

### 样例输入 #1
```
6
2 2 1 3 2
2 4 3 5 4
2 5 5 6 6
0
0
0
```
### 样例输出 #1
```
24
```
## 提示

### 样例解释

JYY 需要重新开始 $3$ 次游戏，加上一开始的一次游戏，$4$ 次游戏的进程是：

- $1 \to 2 \to 4$；
- $1 \to 2 \to 5$；
- $1 \to 3 \to 5$；
- $1 \to 3 \to 6$。

对于 $100\%$ 的数据满足 $N \le 300$，$0 \le K_i \le 50$，$1 \le T_{i,j} \le 300$，$\sum K_i \le 5000$。


---

---
title: "[AHOI2014/JSOI2014] 保龄球"
layout: "post"
diff: 省选/NOI-
pid: P4044
tag: ['2014', '各省省选', '江苏', '安徽']
---
# [AHOI2014/JSOI2014] 保龄球
## 题目背景

JYY 很喜欢打保龄球，虽然技术不高，但是还是总想着的高分。这里 JYY 将向你介绍他所参加的特殊保龄球比赛的规则，然后请你帮他得到尽量多的分数。

## 题目描述

一场保龄球比赛一共有 $n$ 个轮次，每一轮都会有十个木瓶放置在木板道的另一端。每一轮中，选手都有两次投球的机会来尝试击倒全部的十个木瓶。对于每一次投球机会，选手投球的得分等于这一次投球所击倒的木瓶数量。选手每一轮的得分是他两次机会击倒全部木瓶的数量。

对于每一个轮次，有如下三种情况：

1、 “全中”：如果选手第一次尝试就击倒了全部十个木瓶，那么这一轮就为“全中”。在一个“全中”轮中，由于所有木瓶在第一次尝试中都已经被击倒，所以选手不需要再进行第二次投球尝试。同时，在计算总分时，选手在下一轮的得分将会被乘2计入总分。

2、“补中”：如果选手使用两次尝试击倒了十个木瓶，那么这一轮就称为“补中”。同时，在计算总分时，选手在下一轮中的第一次尝试的得分将会以双倍计入总分。

3、“失误”：如果选手未能通过两次尝试击倒全部的木瓶，那么这一轮就被称为“失误”。同时，在计算总分时，选手在下一轮的得分会被计入总分，没有分数被翻倍。此外，如果第 $n$ 轮是“全中”，那么选手可以进行一次附加轮：也就是，如果第 $n$ 轮是“全中”，那么选手将一共进行 $n+1$ 轮比赛。显然，在这种情况下，第 $n+1$ 轮的分数一定会被加倍。

附加轮的规则只执行一次。也就是说，即使第 $n+1$ 轮选手又打出了“全中”，也不会进行第 $n+2$ 轮比赛。因而，附加轮的成绩不会使得其他轮的分数翻番。最后，选手的总得分就是附加轮规则执行过，并且分数按上述规则加倍后的每一轮分数之和。

JYY 刚刚进行了一场 $n$ 个轮次的保龄球比赛，但是，JYY非常不满意他的得分。JYY想出了一个办法：他可以把记分表上，他所打出的所有轮次的顺序重新排列，这样重新排列之后，由于翻倍规则的存在，JYY就可以得到更高的分数了！

当然了，JYY不希望做的太假，他希望保证重新排列之后，所需要进行的轮数和重排前所进行的轮数是一致的：比如如果重排前JYY在第 $n$ 轮打出了“全中”，那么重排之后，第 $n$ 轮还得是“全中”以保证比赛一共进行 $n+1$ 轮；同样的，如果 JYY 第 $n$ 轮没有打出“全中”，那么重排过后第 $n$ 轮也不能是全中。请你帮助 JYY 计算一下，他可以得到的最高的分数。

## 输入格式

第一行包含一个整数 $n$，表示保龄球比赛所需要进行的轮数。

接下来包含 $n$ 或 $n+1$ 行，第i行包含两个非负整数 $x_i,y_i$，表示 JYY 在这一轮两次投球尝试所得到的分数，$x_i$ 表示第一次尝试，$y_i$ 表示第二次尝试。

特别地，`10 0` 表示一轮“全中”。

读入数据存在 $n+1$ 行，当且仅当 $x_n=10$ 且 $y_n=0$。

## 输出格式

输出一行一个整数，表示 JYY 最大可能得到的分数。

## 样例

### 样例输入 #1
```
2
5 2
10 0
3 7
```
### 样例输出 #1
```
44
```
## 提示

【样例说明】  
按照输入顺序，JYY 将得到 $37$ 分。
最佳方案是排列成如下顺序：
```plain
3 7
10 0
5 2
```

【数据范围】
对于 $100\%$ 的数据，$1\le n \le 50$。



---

---
title: "[JSOI2009] 密码"
layout: "post"
diff: 省选/NOI-
pid: P4045
tag: ['字符串', '2009', '各省省选', '江苏', 'AC 自动机', '状压 DP']
---
# [JSOI2009] 密码
## 题目描述

众所周知，密码在信息领域起到了不可估量的作用。对于普通的登陆口令以，唯一的破解方法就是暴力破解——逐个尝试所有可能的字母组合，但这是一项很耗时又容易被发现的工作。所以，为了获取对方的登陆口令，在暴力破解密码之前，必须先做大量的准备工作。经过情报的搜集，现在得到了若干有用信息，形如：

> ​     “我观察到，密码中含有字符串*。”

例如，对于一个 $10$ 位的密码以及观察到的字符串 `hello` 与 `world`，可能的密码组合为 `helloworld`与 `worldhello`；而对于 $6$ 位的密码以及到的字符串 `good` 与 `day`,可能的密码组合为 `gooday`。

有了这些信息，就能够大大地减少尝试的次数了。请编一个程序，计算所有密码组合的可能。密码中仅可能包含 `a-z` 之间的小写字母。
## 输入格式

输入数据首先输入两个整数 $L,N$，分别表示密码的长度与观察到子串的个数。

接下来 $N$ 行，每行若干个字符，描述了每个观察到的字符串。

## 输出格式

输出数据第一行为一个整数，代表了满足所有观察条件字符串的总数。

若这个数字小于等于 $42$，则按字典顺序输出所有密码的可能情况，每行一个，否则，只输出满足所有观察条件字符串的总数即可。

## 样例

### 样例输入 #1
```
10 2
hello
world
```
### 样例输出 #1
```
2
helloworld
worldhello
```
## 提示

对于 $100\%$ 的数据，$1\leq L\leq 25,1\leq N\leq 10$，每个观察到的字符串长不超过 $10$，并且保证输出结果小于 $2^{63}$。



---

---
title: "[JSOI2010] 冷冻波"
layout: "post"
diff: 省选/NOI-
pid: P4048
tag: ['计算几何', '2010', '各省省选', '江苏', '枚举']
---
# [JSOI2010] 冷冻波
## 题目描述

WJJ喜欢“魔兽争霸”这个游戏。在游戏中，巫妖是一种强大的英雄，它的技能Frozen Nova每次可以杀死一个小精灵。我们认为，巫妖和小精灵都可以看成是平面上的点。

当巫妖和小精灵之间的直线距离不超过R，且巫妖看到小精灵的视线没有被树木阻挡（也就是说，巫妖和小精灵的连线与任何树木都没有公共点）的话，巫妖就可以瞬间杀灭一个小精灵。

在森林里有N个巫妖，每个巫妖释放Frozen Nova之后，都需要等待一段时间，才能再次施放。不同的巫妖有不同的等待时间和施法范围，但相同的是，每次施放都可以杀死一个小精灵。

现在巫妖的头目想知道，若从0时刻开始计算，至少需要花费多少时间，可以杀死所有的小精灵？

## 输入格式

输入文件第一行包含三个整数N、M、K(N,M,K<=200)，分别代表巫妖的数量、小精灵的数量和树木的数量。

接下来N行，每行包含四个整数x, y, r, t，分别代表了每个巫妖的坐标、攻击范围和施法间隔（单位为秒）。

再接下来M行，每行两个整数x, y，分别代表了每个小精灵的坐标。

再接下来K行，每行三个整数x, y, r，分别代表了每个树木的坐标。

输入数据中所有坐标范围绝对值不超过10000，半径和施法间隔不超过20000。

## 输出格式

输出一行，为消灭所有小精灵的最短时间（以秒计算）。如果永远无法消灭所有的小精灵，则输出-1。

## 样例

### 样例输入 #1
```
2 3 1
-100 0 100 3
100 0 100 5
-100 -10
100 10
110 11
5 5 10
```
### 样例输出 #1
```
5
```


---

---
title: "[JSOI2007] 合金"
layout: "post"
diff: 省选/NOI-
pid: P4049
tag: ['2007', '各省省选', '江苏', '图论建模', '最短路', '凸包']
---
# [JSOI2007] 合金
## 题目描述

某公司加工一种由铁、铝、锡组成的合金。他们的工作很简单。首先进口一些铁铝锡合金原材料，不同种类的原材料中铁铝锡的比重不同。然后，将每种原材料取出一定量，经过融解、混合，得到新的合金。新的合金的铁铝锡比重为用户所需要的比重。 

现在，用户给出了 $n$ 种他们需要的合金，以及每种合金中铁铝锡的比重。公司希望能够订购最少种类的原材料，并且使用这些原材料可以加工出用户需要的所有种类的合金。
## 输入格式

第一行两个整数 $m$ 和 $n$，分别表示原材料种数和用户需要的合金种数。

第 $2$ 到 $m+1$ 行，每行三个实数 $a_i, b_i, c_i$，分别表示铁铝锡在一种原材料中所占的比重。

第 $m+2$ 到 $m+n+1$ 行，每行三个实数 $d_i, e_i, f_i$，分别表示铁铝锡在一种用户需要的合金中所占的比重。
## 输出格式

一个整数，表示最少需要的原材料种数。若无解，则输出 `–1`。
## 样例

### 样例输入 #1
```
10 10
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0
```
### 样例输出 #1
```
5
```
## 提示

#### 数据规模与约定

对于全部的测试点，满足 $1\le m,n\le 500$，$0 \leq a_i,b_i,c_i,d_i,e_i,f_i \leq 1$，且 $a_i+b_i+c_i=1$，$d_i+e_i+f_i=1$，小数点后最多有六位数字。


---

---
title: "[JSOI2007] 字符加密"
layout: "post"
diff: 省选/NOI-
pid: P4051
tag: ['字符串', '2007', '各省省选', '江苏', '后缀数组 SA']
---
# [JSOI2007] 字符加密
## 题目描述

喜欢钻研问题的JS 同学，最近又迷上了对加密方法的思考。一天，他突然想出了一种他认为是终极的加密办法：把需要加密的信息排成一圈，显然，它们有很多种不同的读法。

例如‘JSOI07’，可以读作：  JSOI07 SOI07J OI07JS I07JSO 07JSOI 7JSOI0 把它们按照字符串的大小排序： 07JSOI 7JSOI0 I07JSO JSOI07 OI07JS SOI07J 读出最后一列字符：I0O7SJ，就是加密后的字符串（其实这个加密手段实在很容易破解，鉴于这是突然想出来的，那就^^）。 但是，如果想加密的字符串实在太长，你能写一个程序完成这个任务吗？

## 输入格式

输入文件包含一行，欲加密的字符串。注意字符串的内容不一定是字母、数字，也可以是符号等。

## 输出格式

输出一行，为加密后的字符串。

## 样例

### 样例输入 #1
```
JSOI07
```
### 样例输出 #1
```
I0O7SJ
```
## 提示

对于40%的数据字符串的长度不超过10000。

对于100%的数据字符串的长度不超过100000。



---

---
title: "[JSOI2007] 文本生成器"
layout: "post"
diff: 省选/NOI-
pid: P4052
tag: ['动态规划 DP', '2007', '各省省选', '江苏', 'O2优化', 'AC 自动机']
---
# [JSOI2007] 文本生成器
## 题目描述

JSOI 交给队员 ZYX 一个任务，编制一个称之为“文本生成器”的电脑软件：该软件的使用者是一些低幼人群，他们现在使用的是 GW 文本生成器 v6 版。

该软件可以随机生成一些文章——总是生成一篇长度固定且完全随机的文章。 也就是说，生成的文章中每个字符都是完全随机的。如果一篇文章中至少包含使用者们了解的一个单词，那么我们说这篇文章是可读的（我们称文章 $s$ 包含单词 $t$，当且仅当单词 $t$ 是文章 $s$ 的子串）。但是，即使按照这样的标准，使用者现在使用的 GW 文本生成器 v6 版所生成的文章也是几乎完全不可读的。ZYX 需要指出 GW 文本生成器 v6 生成的所有文本中，可读文本的数量，以便能够成功获得 v7 更新版。你能帮助他吗？

答案对 $10^4 + 7$ 取模。
## 输入格式

第一行有两个整数，分别表示使用者了解的单词总数 $n$ 和生成的文章长度 $m$。

接下来 $n$ 行，每行一个字符串 $s_i$，表示一个使用者了解的单词。
## 输出格式

输出一行一个整数表示答案对 $10^4 + 7$ 取模的结果。
## 样例

### 样例输入 #1
```
2 2
A
B

```
### 样例输出 #1
```
100
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 60$，$1 \leq m \leq 100$。
- $1 \leq |s_i| \leq 100$，其中 $|s_i|$ 表示字符串 $s_i$ 的长度。
- $s_i$ 中只含大写英文字母。


---

---
title: "[JSOI2009] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P4055
tag: ['2009', '各省省选', '网络流', '江苏', '二分图']
---
# [JSOI2009] 游戏
## 题目描述

小 AA 和小 YY 得到了《喜羊羊和灰太狼》的电影票，都很想去观看，但是电影票只有一张，于是他们用智力游戏决定胜负，赢得游戏的人可以获得电影票。

在 $N \times M$ 的迷宫中有一个棋子，小 AA 首先任意选择棋子放置的位置。然后，小 YY 和小 AA 轮流将棋子移动到相邻的格子里。游戏的规则规定，在一次游戏中，同一个格子不能进入两次，且不能将棋子移动到某些格子中去。当玩家无法继续移动棋子时，游戏结束，最后一个移动棋子的玩家赢得了游戏。

例如下图所示的迷宫，迷宫中 `.` 表示棋子可以经过的格子，而 `#` 表示棋子不可以经过的格子：

```cpp
                                 .##
                                 ...
                                 #.# 
```                                 
若小 AA 将棋子放置在 $(1,1)$，则小 AA 则无论如何都无法赢得游戏。

而若小 AA 将棋子放置在 $(3,2)$ 或 $(2,3)$，则小 AA 能够赢得游戏。例如，小 AA 将棋子放置在 $(3,2)$，小 YY 只能将它移动到 $(2,2)$，此时小 AA 再将棋子移动到 $(2,3)$，就赢得了游戏。

小 AA 和小 YY 都是绝顶聪明的小朋友，且从不失误。小 AA 到底能不能赢得这场游戏，从而得到珍贵的电影票呢？
## 输入格式

输入数据首先输入两个整数 $N,M$，表示了迷宫的边长。

接下来 $N$ 行，每行 $M$ 个字符，描述了迷宫。

## 输出格式

若小 AA 能够赢得游戏，则输出一行 `WIN`，然后输出所有可以赢得游戏的起始位置，按行优先顺序输出，每行一个。

否则输出一行 `LOSE`。

## 样例

### 样例输入 #1
```
3 3
.##
...
#.#
```
### 样例输出 #1
```
WIN
2 3
3 2
```
## 提示

- 对 $30\%$ 的数据，有 $n,m \leq 5$；
- 对 $100\%$ 的数据，有 $1 \leq n,m \leq 100$。



---

---
title: "[JSOI2009] 火星藏宝图"
layout: "post"
diff: 省选/NOI-
pid: P4056
tag: ['动态规划 DP', '2009', '各省省选', '江苏', '斜率优化']
---
# [JSOI2009] 火星藏宝图
## 题目背景

JSOI2009第三轮二试

## 题目描述

在火星游玩多日,jyy 偶然地发现了一张藏宝图。根据藏宝图上说法，宝藏被埋藏在一个巨大的湖里的 $N$ 个岛上 $(2\le N \le 2 \times 10^{5})$。为了方便描述，地图把整个湖划分成 $M$ 行 $M$ 列 $(1\le M\le 1000)$,共 $M \times M$ 个小块，并把所有岛按照 $1...N$ 编了号。第 $i$ 个岛位于第 $X_i$ 行 $Y_i$ 列 (设其坐标为 $(X_i,Y_i)$的格子 （ $X_i,Y_i$ 均为整数，并且满足 $1<=X_i,Y_i<=M$ ）,岛上藏有价值财富 $V_i(1\le V_i\le 10,000)$。湖的左上角 $(1,1)$ 和右下角 $(M,M)$ 都有岛，有桥将它们与陆地相连。

jyy 没费多大劲，就找到了那个湖，同时哭笑不得地发现，所谓的财富，是各个岛上出产的珍稀水果。jyy 在左上角的岛的岸边找到了一条小木船，他可以划船到其他岛上去。划船是要消耗体力的，具体地说，等于两岛 Euclidean 距离的平方(即，从 $(X_1,Y_1)$ 划船到 $(X_2,Y_2)$ 所耗费的体力为 $(X_1-X_2)^2+(Y_1-Y_2)^2$ 个单位)。jyy 可以吃水果来恢复体力，吃掉 $1$ 单位价值的水果能恢复 $1$ 单位体力。

现在 jyy 打算从 $(1,1)$ 旅行到 $(M,M)$，沿途收集珍稀水果。按藏宝图上的提示，jyy 离开一个岛后，就只能去该岛右下方的区域（正下和正右方向也是允许的），否则会遭遇水怪。jyy 可以在旅行途中饿一段时间，即体力为负。但抵达终点后，只要身边有足够多的水果，他就会通过吃水果将体力恢复到旅行前的水平。

jyy想知道，经过一次旅行，他最多能得到多少收益，即 `jyy 收集到的水果总价值- jyy 在旅途中花的总体力` 。(如果吃完所有水果他还饿着，收益就是负数，具体的例子见样例)
## 输入格式

第 $1$ 行：两个整数 $N,M$。第 $2...N+1$ 行：每行 $3$ 个整数，第 $i+1$ 行的 $3$ 个整数分别为 $ X_i$，$Y_i$，$V_i$。每个岛的坐标不同。保证存在坐标 $(1,1)$ 和 $(M,M)$ 的岛。
## 输出格式

第 $1$ 行：输出一个整数，表示最大收益。
## 样例

### 样例输入 #1
```
4  10 
1  1  20 
10 10 10 
3  5  60 
5  3  30
```
### 样例输出 #1
```
-4
```
## 提示

### 样例解释

$20+60+10-\left ( \left(3-1 \right )^2+\left (5-1 \right )^2 \right )-\left ( \left (10-3 \right )^2+\left (10-5 \right )^2 \right )=-4$

### 数据范围

对 $20\%$ 的数据 $M\le 200$，且 $N\le 2\times 10^3$。

对 $50\%$ 的数据 $M\le 200$，且 $N\le 2\times 10^4$。

对 $100\%$ 的数据 $M\le 1000$，且 $N\le 2\times 10^5$。


---

---
title: "[JXOI2017] 数列"
layout: "post"
diff: 省选/NOI-
pid: P4063
tag: ['2017', '各省省选']
---
# [JXOI2017] 数列
## 题目描述

九条可怜手上有一个长度为 $n$ 的整数数列 $r_i$，她现在想要构造一个长度为 $n$ 的，满足如下条件的整数数列 $A$ ：

- $1 \le A_i \le r_i$

- 对于任意 $3 \le i \le n$ ，令 $R$ 为 $A_1$ 至 $A_{i-2}$ 中大于等于 $A_{i-1}$ 的最小值，$L$ 为 $A_1$ 至 $A_{i-2}$ 中小于等于 $A_{i-1}$ 的最大值。$A_i$ 必须满足 $L \le A_i \le R$ 。如果不存在大于等于 $A_{i-1}$ 的，那么 $R=+\infty$ ；如果不存在小于等于 $A_{i-1} $ 的，那么 $L = -\infty$ 。

现在可怜想要知道共有多少不同的数列满足这个条件。两个数列 $A$ 和 $B$ 是不同的当且仅当至少存在一个位置 $i$ 满足 $A_i \neq B_i$ 。
## 输入格式

第一行输入一个整数 $n$ ，第二行输入 $n$ 个整数$ r_i$。
## 输出格式

输出一个整数表示方案数，答案可能很大，对 $998244353$ 取模后输出。
## 说明
满足条件的序列有 $[1, 1, 1], [1, 2, 1], [1, 2, 2], [2, 1, 1], [2, 1, 2], [2, 2, 2]$
## 样例

### 样例输入 #1
```
3
2 2 2
```
### 样例输出 #1
```
6
```
## 提示

| 测试点编号 | $n$ | $r_i$ |
| :----------: | :----------: | :----------: |
| $1,2$ | $n\le7$ | $r_i\le7$ |
| $3,4$ | $n\le50$ | $r_i\le10$ |
| $5,6$ | $n\le50$ | $r_i\le16$ |
| $7,8$ | $n\le50$ | $r_i\le50$ |
| $9,10$ | $n\le50$ | $r_i\le150$ |


---

---
title: "[JXOI2017] 颜色"
layout: "post"
diff: 省选/NOI-
pid: P4065
tag: ['2017', '线段树', '各省省选', '枚举', '概率论', '栈']
---
# [JXOI2017] 颜色
## 题目描述

可怜有一个长度为 $n$ 的正整数序列 $A_i$，其中相同的正整数代表着相同的颜色。

现在可怜觉得这个序列太长了，于是她决定选择一些颜色把这些颜色的所有位置都删去。

删除颜色 $i$ 可以定义为把所有满足 $A_j = i$ 的位置 $j$ 都从序列中删去。

然而有些时候删去之后，整个序列变成了好几段，可怜不喜欢这样，于是她想要知道有多少种删去颜色的方案使得最后剩下来的序列非空且连续。

例如颜色序列 $\{1, 2, 3, 4, 5\}$，删除颜色 $3$ 后序列变成了 $\{1, 2\}$ 和 $\{4, 5\}$ 两段，不满足条件。而删除颜色 $1$ 后序列变成了 $\{2, 3, 4, 5\}$，满足条件。

两个方案不同当且仅当至少存在一个颜色 $i$ 只在其中一个方案中被删去。

## 输入格式

第一行输入一个整数 $T$ 表示数据组数。

每组数据第一行，输入一个整数 $n$ 表示数列长度；第二行输入 $n$ 个整数描述颜色序列。

## 输出格式

对于每组数据输出一个整数表示答案。
## 样例

### 样例输入 #1
```
1
5
1 3 2 4 3
```
### 样例输出 #1
```
6
```
## 提示

满足条件的删颜色方案有 $\{1\}, \{1, 3\}, \{1, 2, 3\}, \{1, 3, 4\}, \{2, 3, 4\}, \varnothing$。

对于 $20\%$ 的数据，保证 $1 \le \sum n \le  20$。

对于 $40\%$ 的数据，保证 $1 \le \sum n \le  500$。

对于 $60\%$ 的数据，保证 $1 \le \sum n \le  10^4$。

对于 $100\%$ 的数据，保证 $1 \le  T,\sum n \le  3 \times 10^5, 1 \le  A_i \le  n$。

$\text{Statement fixed by @Starrykiller.}$


---

---
title: "[SHOI2003] 吃豆豆"
layout: "post"
diff: 省选/NOI-
pid: P4066
tag: ['2003', '各省省选', '上海', '剪枝']
---
# [SHOI2003] 吃豆豆
## 题目描述

两个 PACMAN 吃豆豆。一开始的时候，PACMAN 都在坐标原点的左下方，豆豆都在右上方。PACMAN 走到豆豆处就会吃掉它。  
PACMAN 行走的路线很奇怪，只能向右走或者向上走，他们行走的路线可以有交点但不能互相穿过。  
请你帮这两个 PACMAN 计算一下，他们俩加起来最多能吃掉多少豆豆。

## 输入格式

第一行为一个整数 $N$，表示豆豆的数目。 接下来 $N$ 行，每行一对正整数，表示第 $i$ 个豆豆的坐标。任意两个豆豆的坐标都不会重合。

## 输出格式

仅有一行包含一个整数，即两个 PACMAN 加起来最多能吃掉的豆豆数量

## 样例

### 样例输入 #1
```
8 
8 1 
1 5
5 7 
2 2 
7 8 
4 6 
3 3 
6 4
```
### 样例输出 #1
```
7
```
## 提示

对于 $100\%$ 的数据，$N \leq 2000$。


---

---
title: "[SDOI2016] 储能表"
layout: "post"
diff: 省选/NOI-
pid: P4067
tag: ['2016', '各省省选', '山东']
---
# [SDOI2016] 储能表
## 题目描述

有一个 $n$ 行 $m$ 列的表格，**行从 $0$ 到 $n-1$ 编号，列从 $0$ 到 $m-1$ 编号**。每个格子都储存着能量。最初，第 $i$ 行第 $j$ 列的格子储存着 $(i \oplus j)$ 点能量（$\oplus$ 表示**按位异或**）。所以，整个表格储存的总能量是

$$\sum_{i=0}^{n-1} \sum_{j=0}^{m-1} i \oplus j$$

随着时间的推移，格子中的能量会渐渐减少。每经过一个时间单位，每个格子中的能量都会减少 $1$。显然，**一个格子的能量减少到 $0$ 之后就不会再减少了。**

也就是说，$k$ 个时间单位后，整个表格储存的总能量是

$$\sum_{i=0}^{n-1} \sum_{j=0}^{m-1} \max((i \oplus j)-k,0)$$

给出一个表格，求 $k$ 个时间单位后它储存的总能量。

由于总能量可能较大，输出时对 $p$ 取模。
## 输入格式

第一行一个整数 $T$，表示数据组数。接下来 $T$ 行，每行四个整数 $n,m,k,p$。

## 输出格式

共 $T$ 行，每行一个数，表示总能量对 $p$ 取模后的结果。

## 样例

### 样例输入 #1
```
3
2 2 0 100
3 3 0 100
3 3 1 100
```
### 样例输出 #1
```
2
12
6
```
## 提示

对于 $100\%$ 的数据，保证 $1\le T\le 5000$，$1\le p\le 10^9$，$1\le n,m,k\le 10^{18}$。

| 测试点编号 | $T=$ | $n\le$ | $m\le$ | $k\le$ | $p\le$ |
| :--: | :--: | :--: | :--: | :--: | :--: |
| $1,2$ | $5000$ | $100$ | $100$ | $100$ | $10^9$ |
| $3$ | $5000$ | $10^{18}$ | $10^{18}$ | $0$ | $10^9$ |
| $4$ | $5000$ | $10^{18}$ | $10^{18}$ | $1$ | $10^9$ |
| $5$ | $5000$ | $10$ | $10^{18}$ | $10$ | $10^9$ |
| $6$ | $1$ | $10^5$ | $10^{18}$ | $10^5$ | $10^9$ |
| $7$ | $1$ | $10^{18}$ | $10^{18}$ | $10^{18}$ | $10^9$ |
| $8$ | $100$ | $10^{18}$ | $10^{18}$ | $10^{18}$ | $10^9$ |
| $9,10$ | $5000$ | $10^{18}$ | $10^{18}$ | $10^{18}$ | $10^9$ |

$\texttt{Statement fixed by Starrykiller.}$


---

---
title: "[SDOI2016] 数字配对"
layout: "post"
diff: 省选/NOI-
pid: P4068
tag: ['贪心', '2016', '各省省选', '网络流', '山东', '二分图', '素数判断,质数,筛法']
---
# [SDOI2016] 数字配对
## 题目描述

有 $n$ 种数字，第 $i$ 种数字是 $a_i$、有 $b_i$ 个，权值是 $c_i$。

若两个数字 $a_i$、$a_j$ 满足，$a_i$ 是 $a_j$ 的倍数，且 $a_i/a_j$ 是一个质数，

那么这两个数字可以配对，并获得 $c_i \times c_j$ 的价值。

一个数字只能参与一次配对，可以不参与配对。

在获得的价值总和不小于 $0$ 的前提下，求最多进行多少次配对。
## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个整数 $a_1,a_2,\cdots,a_n$。

第三行 $n$ 个整数 $b_1,b_2,\cdots,b_n$。

第四行 $n$ 个整数 $c_1,c_2,\cdots,c_n$。
## 输出格式

一行一个数，最多进行多少次配对。
## 样例

### 样例输入 #1
```
3
2 4 8
2 200 7
-1 -2 1

```
### 样例输出 #1
```
4
```
## 提示

测试点 $1 \sim 3$： $n \leq 10 $， $a_i \leq 10 ^ 9 $ ， $b_i = 1 $，$ | c_i | \leq 10 ^ 5$；   

测试点 $4 \sim 5$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5  $，$c_i = 0$；

测试点 $6 \sim 10$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5$ ，$ | c_i | \leq 10 ^ 5$。


---

---
title: "[SDOI2016] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P4069
tag: ['2016', '线段树', '各省省选', '山东', '最近公共祖先 LCA', '树链剖分']
---
# [SDOI2016] 游戏
## 题目描述

Alice 和 Bob 在玩一个游戏。

游戏在一棵有 $n$ 个点的树上进行。最初，每个点上都只有一个数字，那个数字是 $123456789123456789$。

有时，Alice 会选择一条从 $s$ 到 $t$ 的路径，在这条路径上的每一个点上都添加一个数字。对于路径上的一个点 $r$，若 $r$ 与 $s$ 的距离是 $dis$，那么 Alice 在点 $r$ 上添加的数字是 $a\times dis+b$。

有时，Bob 会选择一条从 $s$ 到 $t$ 的路径。他需要先从这条路径上选择一个点，再从那个点上选择一个数字。

Bob 选择的数字越小越好，但大量的数字让 Bob 眼花缭乱。Bob 需要你帮他找出他能够选择的最小的数字。

## 输入格式

第一行两个数字 $n,m$，表示树的点数和进行的操作数。

接下来 $n-1$ 行，每行三个数字 $u,v,w$，表示树上有一条连接 $u,v$ 的边，长度是 $w$。

接下来 $m$ 行。每行第一个数字是 $1$ 或 $2$。

若第一个数是 $1$，表示 Alice 进行操作，接下来四个数字 $s,t,a,b$。

若第一个数是 $2$，表示 Bob 进行操作，接下来两个数字 $s,t$。

## 输出格式

每当 Bob 进行操作，输出一行一个数，表示他能够选择的最小的数字

## 样例

### 样例输入 #1
```
3 5
1 2 10
2 3 20
2 1 3
1 2 3 5 6
2 2 3
1 2 3 -5 -6
2 2 3
```
### 样例输出 #1
```
123456789123456789
6
-106
```
## 提示

测试点 1 ~ 2：$ n \leq 10 $，$ m \leq 10 $，$ | a | \leq 10000 $；

测试点 3 ~ 4：$ n \leq 1000 $，$ m \leq 1000 $，$ | a | \leq 10000 $；

测试点 5：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 0 $，树是一条链；

测试点 6 ~ 7：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 0 $；

测试点 8：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 1 $，树是一条链；

测试点 9 ~ 10：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 1 $；

测试点 11 ~ 13：$ n \leq 100000 $，$ m \leq 100000 $，$ | a | \leq 10000 $，树是一条链；

测试点 14 ~ 20：$ n \leq 100000 $，$ m \leq 100000 $，$ | a | \leq 10000 $。

对于所有数据，$0\le w, |b|\le 10^9$。


---

---
title: "[SDOI2016] 生成魔咒"
layout: "post"
diff: 省选/NOI-
pid: P4070
tag: ['字符串', '2016', '各省省选', '平衡树', '山东', '后缀自动机 SAM', '后缀数组 SA']
---
# [SDOI2016] 生成魔咒
## 题目描述

魔咒串由许多魔咒字符组成，魔咒字符可以用数字表示。例如可以将魔咒字符 $1,2$ 拼凑起来形成一个魔咒串 $[1,2]$。

一个魔咒串 $S$ 的非空字串被称为魔咒串 $S$ 的生成魔咒。

例如 $S=[1,2,1]$ 时，它的生成魔咒有 $[1],[2],[1,2],[2,1],[1,2,1]$ 五种。$S=[1,1,1]$ 时，它的生成魔咒有 $[1],[1,1],[1,1,1]$ 三种，最初 S 为空串。  

共进行 $n$ 次操作，每次操作是在 $S$ 的结尾加入一个魔咒字符。每次操作后都需要求出，当前的魔咒串 $S$ 共有多少种生成魔咒。

## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个数，第 $i$ 个数表示第 $i$ 次操作加入的魔咒字符 $x_i$。

## 输出格式

输出 $n$ 行，每行一个数。  
第 $i$ 行的数表示第 $i$ 次操作后 $S$ 的生成魔咒数量。

## 样例

### 样例输入 #1
```
7
1 2 3 3 3 1 2
```
### 样例输出 #1
```
1
3
6
9
12
17
22
```
## 提示

#### 数据规模与约定   
对于 $10\%$ 的数据，保证 $1 \le n \le 10$；  
对于 $30\%$ 的数据，保证 $1 \le n \le 100$；  
对于 $60\%$ 的数据，保证 $1 \le n \le 10^3$；   
对于 $100\%$ 的数据，保证 $1 \le n \le 10^5$，$1 \leq x_i \leq 10^9$。



---

---
title: "[SDOI2016] 征途"
layout: "post"
diff: 省选/NOI-
pid: P4072
tag: ['2016', '各省省选', '单调队列', '山东', 'O2优化', '斜率优化', '前缀和', '凸包']
---
# [SDOI2016] 征途
## 题目描述

Pine 开始了从 $S$ 地到 $T$ 地的征途。

从 $S$ 地到 $T$ 地的路可以划分成 $n$ 段，相邻两段路的分界点设有休息站。

Pine 计划用 $m$ 天到达 $T$ 地。除第 $m$ 天外，每一天晚上 Pine 都必须在休息站过夜。所以，一段路必须在同一天中走完。

Pine 希望每一天走的路长度尽可能相近，所以他希望每一天走的路的长度的方差尽可能小。

帮助 Pine 求出最小方差是多少。

设方差是 $v$，可以证明，$v\times m^2$ 是一个整数。为了避免精度误差，输出结果时输出 $v\times m^2$。
## 输入格式

第一行两个数 $n, m$。

第二行 $n$ 个数，表示 $n$ 段路的长度。
## 输出格式

一个数，最小方差乘以 $m^2$ 后的值。
## 样例

### 样例输入 #1
```
5 2
1 2 5 8 6
```
### 样例输出 #1
```
36
```
## 提示

### 数据范围及约定

- 对于 $30\%$ 的数据，$1 \le n \le 10$；
- 对于 $60\%$ 的数据，$1 \le n \le 100$；
- 对于 $100\%$ 的数据，$1 \le n \le 3000$。

保证从 $S$ 到 $T$ 的总路程不超过 $3\times 10^4$。

$2 \leq m \leq n+1$，每段路的长度为不超过 $3 \times 10^4$ 的**正整数**。


---

---
title: "[SDOI2016] 硬币游戏"
layout: "post"
diff: 省选/NOI-
pid: P4077
tag: ['2016', '各省省选', '山东']
---
# [SDOI2016] 硬币游戏
## 题目描述

Alice 和 Bob 现在在玩的游戏，主角是依次编号为 $1$ 到 $n$ 的 $n$ 枚硬币。每一枚硬币都有两面，我们分别称之为正面和反面。一开始的时候，有些硬币是正面向上的，有些是反面朝上的。Alice 和 Bob 将轮流对这些硬币进行翻转操作，且 Alice 总是先手。


具体来说每次玩家可以选择一枚编号为 $x$，要求这枚硬币此刻是反面朝上的。对于编号 $x$ 来说，我们总可以将 $x$ 写成 $ c\cdot 2^a \cdot 3^b$ ，其中 $a$ 和 $b$ 是非负整数，$c$ 是与 $2,3$ 都互质的非负整数，然后有两种选择：


选择整数 $p,q$ 满足 $a \ge pq , p \ge 1$ 且 $1 \leq q \leq \text{MAXQ}$，然后同时翻转所有编号为 $c \cdot 2^{a-pj} \cdot 3^b$  的硬币，其中 $j = 0, 1, 2, \ldots ,q$。

选择整数 $p,q$ 满足 $b \ge pq, p \ge 1$  且 $1 \leq q \leq \text{MAXQ}$，然后同时翻转所有编号为 $c \cdot 2^a \cdot 3^{b-pj}$ 的硬币，其中 $j = 0, 1, 2, \ldots, q$。

可以发现这个游戏不能无限进行下去，当某位玩家无法继续操作上述操作时，便输掉了游戏。作为先手的 Alice，总是希望可以在比赛开始之前就知道自己能否获胜。她知道自己和 Bob 都是充分聪明的，所以在游戏过程中，两人都会最优化自己的策略并尽量保证自己处于不败的情形中。

## 输入格式


本题有多组测试数据，第一行输入一个整数 $T$，表示总的数据组数。之后给出 $T$ 组数据。

每组数据第一行输入两个整数 $n,\text{MAXQ}$。

第二行输入 $n$ 个整数，第 $i$ 个数表示第 $i$ 个硬币的初始状态，$0$ 表示反面朝上，$1$ 表示正面朝上。
## 输出格式

输出共有 $T$ 行。对于每一组数据来说，如果 Alice 先手必胜，则输出 `win`，否则输出 `lose`。

## 样例

### 样例输入 #1
```
6
16 14
1 0 0 1 0 0 0 0 1 0 0 0 1 0 1 1
16 14
0 1 0 0 0 1 1 1 1 1 1 0 1 0 0 1
16 11
0 1 0 0 0 1 1 1 0 1 0 0 0 1 0 1
16 12
1 1 1 1 1 1 1 1 0 0 1 1 0 1 1 0
16 4
1 0 0 1 0 0 1 0 0 0 0 1 0 1 1 0
16 20
0 0 0 0 1 0 1 0 0 0 1 0 0 1 0 0
```
### 样例输出 #1
```
win
lose
win
lose
win
win
```
## 提示

对于 $100\%$ 的数据 $1\le n \le 30000,1 \le \text{MAXQ} \le 20,t\le 100$。



---

---
title: "[SDOI2016] 探险路线"
layout: "post"
diff: 省选/NOI-
pid: P4078
tag: ['2016', '各省省选', '山东']
---
# [SDOI2016] 探险路线
## 题目描述

你所面对的丛林，可以被刻画为n行m列的格点图，其中第i行第j列的格子代表了一块区域，每个格子有整数权值v(i,j)（可能为负），表明了访问这一块区域的收益或代价。每一个格子最多只能被访问一次，且不可走出地图的边界，你被要求从第一行第一列出发，到第n行第m列结束，你的目标是最大化途经的所有格子的权值和。

因为一些缘故，你的探险路线受到了一些限制。起初你在起点，之后每一天的行动中，首先你需要选择上下左右中的某一个方向，沿着这个方向走0步（也就是不走）或任意步；之后重新选择一个方向（可以与原来方向相同，也可以是不同的方向），沿着这个方向一直走下去，走到地图的某个边界位置结束这一天的探险。探险可以有任意多天，每一天探险结束的边界位置就是第二天的起点位置，除非这一天就是探险的结束。注意，因为每一块格子只能被访问一次，且你最终的结束点必须是第n行第m列的位置，所以你需要谨慎计划每一天的路线。

你希望知道最优方案下，整个探险之旅的收益有多大，即你可以获得的权值和最大是多少。

## 输入格式

第一行输入两个整数，分别表示总行数n与总列数m。之后n行，每行有m个整数，。其中第i行第j列的整数对应了访问第i行第j列区域的收益或代价。

## 输出格式

输出一个整数，表示最优探险路线中所有被访问格子的权值和。

## 样例

### 样例输入 #1
```
10 10
+1 +1 +1 +1 +1 -1 -1 -1 -1 -1
-1 -1 +1 +1 +1 -1 -1 -1 -1 -1
-1 -1 +1 +1 +1 +1 +1 +1 +1 +1
+1 +1 +1 +1 -1 -1 -1 -1 -1 +1
+1 -1 -1 +1 -1 -1 -1 -1 -1 +1
+1 +1 +1 +1 -1 -1 -1 -1 -1 +1
+1 +1 +1 +1 +1 +1 +1 +1 +1 +1
+1 -1 -1 -1 -1 -1 -1 -1 -1 -1
+1 +1 +1 +1 -1 +1 +1 +1 +1 +1
-1 -1 -1 +1 +1 +1 -1 -1 -1 +1
```
### 样例输出 #1
```
53
```
## 提示

对于所有数据3<=n<=800且3<=m<=800，保证收益代价绝对值在100000以内



---

---
title: "[HEOI2016/TJOI2016] 序列"
layout: "post"
diff: 省选/NOI-
pid: P4093
tag: ['2016', '线段树', '各省省选', '河北', 'cdq 分治', 'O2优化', '树套树', '天津']
---
# [HEOI2016/TJOI2016] 序列
## 题目描述

佳媛姐姐过生日的时候，她的小伙伴从某宝上买了一个有趣的玩具送给他。

玩具上有一个数列，数列中某些项的值可能会变化，但同一个时刻最多只有一个值发生变化。现在佳媛姐姐已经研究出了所有变化的可能性，她想请教你，能否选出一个子序列，使得在**任意一种变化和原序列**中，这个子序列都是不降的？请你告诉她这个子序列的最长长度即可。
## 输入格式

输入的第一行有两个正整数 $n,m$，分别表示序列的长度和变化的个数。

接下来一行有 $n$ 个整数，表示这个数列原始的状态。

接下来 $m$ 行，每行有 $2$ 个整数 $x,y$，表示数列的第 $x$ 项可以变化成 $y$ 这个值。

## 输出格式

输出一个整数，表示对应的答案。

## 样例

### 样例输入 #1
```
3 4 
1 2 3 
1 2 
2 3 
2 1 
3 4
```
### 样例输出 #1
```
3

```
## 提示

注意：每种变化最多只有一个值发生变化。

在样例输入中，所有的变化是：
```plain
1 2 3
2 2 3
1 3 3
1 1 3
1 2 4
```
选择子序列为原序列，即在任意一种变化中均为不降子序列。

对于 $20\%$ 数据，所有数均为正整数，且小于等于 $300$。

对于 $50\%$ 数据，所有数字均为正整数，且小于等于 $3000$。

对于 $100\%$ 数据，所有数字均为正整数，且小于等于 $10^5$。$1\le x\le n$。



---

---
title: "【模板】李超线段树 / [HEOI2013] Segment"
layout: "post"
diff: 省选/NOI-
pid: P4097
tag: ['贪心', '2013', '线段树', '各省省选', '递归', '河北', '分块', '李超线段树']
---
# 【模板】李超线段树 / [HEOI2013] Segment
## 题目描述

要求在平面直角坐标系下维护两个操作：

1. 在平面上加入一条线段。记第 $i$ 条被插入的线段的标号为 $i$。
2. 给定一个数 $k$，询问与直线 $x = k$ 相交的线段中，交点纵坐标最大的线段的编号。
## 输入格式

**本题输入强制在线**。

输入的第一行是一个整数 $n$，代表操作的个数。

接下来 $n$ 行，每行若干个用空格隔开的整数，第 $i + 1$ 行的第一个整数为 $op$，代表第 $i$ 次操作的类型。

若 $op = 0$，则后跟一个整数 $k$，代表本次操作为查询所所有与直线 $x = (k + lastans - 1) \bmod 39989 + 1$ 相交的线段中，交点纵坐标最大的线段编号。

若 $op = 1$，则后跟四个整数 $x_0, y_0, x_1, y_1$，记 $x_i' = (x_i + lastans - 1) \bmod 39989 + 1$，$y_i' = (y_i + lastans - 1) \bmod 10^9 + 1$。本次操作为插入一条两端点分别为 $(x_0', y_0')$，$(x_1',y_1')$ 的线段。

其中 $lastans$ 为上次询问的答案，初始时，$lastans = 0$。
## 输出格式

对于每次查询，输出一行一个整数，代表交点纵坐标最大的线段的编号。若不存在任何一条线段与查询直线有交，则输出 $0$；若有多条线段与查询直线的交点纵坐标都是最大的，则输出编号最小的线段，同时 $lastans$ 也应更新为编号最小的一条线段。
## 样例

### 样例输入 #1
```
6 
1 8 5 10 8 
1 6 7 2 6 
0 2 
0 9 
1 4 7 6 7 
0 5
```
### 样例输出 #1
```
2 
0 
3
```
## 提示

### 样例 $1$ 解释

对于第一次操作，解密后为 `1 8 5 10 8`。

对于第二次操作，解密后为 `1 6 7 2 6`。

对于第三次操作，解密后为 `0 2`，此时 $lastans$ 被更新为 $2$。

对于第四次操作，解密后为 `0 11`，此时 $lastans$ 被更新为 $0$。

对于第五次操作，解密后为 `1 4 7 6 7`。

对于第六次操作，解密后为 `0 5`。

### 数据范围与约定

对于 $30\%$ 的数据，保证 $n \leq 10^3$。

对于 $100\%$ 的数据，保证 $1 \leq n \leq 10^5$，$1 \leq k, x_0, x_1 \leq 39989$，$1 \leq y_0, y_1 \leq 10^9$。

### 提示

不保证 $x_0 \neq x_1$。对于一条 $x_0' = x_1'$ 的线段，认为其与 $x = x_0'$ 的交点为其两端点中纵坐标较大的端点。


---

---
title: "[HEOI2013] ALO"
layout: "post"
diff: 省选/NOI-
pid: P4098
tag: ['2013', '各省省选', '河北', '枚举', '可持久化', '字典树 Trie']
---
# [HEOI2013] ALO
## 题目描述

Welcome to ALO (Arithmetic and Logistic Online）。这是一个 VR MMORPG，如名字所见，到处充满了数学的谜题。

现在你拥有 $n$ 颗宝石，第 $i$ 颗宝石有一个能量密度，记为 $a_i$，这些宝石的能量密度**两两不同**。现在你可以选取**连续**的一些宝石（必须多于一个）进行融合，设他们的能量密度为 $a_i,a_{i+1},\cdots,a_j$，则融合而成的宝石的能量密度为这些宝石中能量密度的次大值与其他任意一颗宝石的能量密度按位异或的值的最大值。即，假设该段宝石能量密度次大值为 $k$，则生成的宝石的能量密度为 $\max\{k\oplus a_p\mid a_p\ne k, i\le p\le j\}$。

现在你需要知道你怎么选取需要融合的宝石，才能使生成的宝石能量密度最大。
## 输入格式

第一行，一个整数 $n$，表示宝石个数。

第二行，$n$ 个整数，分别表示 $a_1$ 至 $a_n$，表示每颗宝石的能量密度，保证对于 $i\ne j$ 有 $a_i\ne a_j$。
## 输出格式

输出一行一个整数，表示最大能生成的宝石能量密度。

## 样例

### 样例输入 #1
```
5 
9 2 1 4 7
```
### 样例输出 #1
```
14
```
## 提示

### 样例解释

选择区间 $[1,5]$，最大值为 $7\oplus 9 = 14$。

### 数据规模与约定

- 对于 $20\%$ 的数据有 $n\le 100$；
- 对于 $50\%$ 的数据有 $n\le 2000$；
- 对于 $100\%$ 的数据有 $1\le n\le 50000$，$0\le a_i\le 10^9$。

2023.4.28：添加两组 hack 数据，不计分。


---

---
title: "[HEOI2013] SAO"
layout: "post"
diff: 省选/NOI-
pid: P4099
tag: ['动态规划 DP', '2013', '各省省选', '河北', '枚举', '拓扑排序', '前缀和']
---
# [HEOI2013] SAO
## 题目描述

Welcome to SAO ( Strange and Abnormal Online)。这是一个 VR MMORPG， 含有 n 个关卡。但是，挑战不同关卡的顺序是一个很大的问题。

某款游戏有 $n-1$ 个对于挑战关卡的限制，诸如第 $i$ 个关卡必须在第 $j$ 个关卡前挑战，或者完成了第 $k$ 个关卡才能挑战第 $l$ 个关卡。并且，如果不考虑限制的方向性，那么在这 $n-1$ 个限制的情况下，任何两个关卡都存在某种程度的关联性。即，我们不能把所有关卡分成两个非空且不相交的子集，使得这两个子集之间没有任何限制。

## 输入格式

第一行，一个整数 $T$，表示数据组数。

对于每组数据，第一行一个整数 $n$，表示关卡数。接下来 $n - 1$ 行，每行为 $i \text{ sign } j$，其中 $0 \leq i, j \leq n - 1$ 且 $i \neq j$，$\text{sign}$ 为 $\tt{<}$ 或者 $\tt{>}$，表示第 $i$ 个关卡必须在第 $j$ 个关卡前或后完成。

## 输出格式

对于每个数据，输出一行一个整数，为攻克关卡的顺序方案个数，$\bmod (10^9+7)$ 输出。

## 样例

### 样例输入 #1
```
2 
5 
0 < 2 
1 < 2 
2 < 3 
2 < 4 
4 
0 < 1 
0 < 2 
0 < 3
```
### 样例输出 #1
```
4 
6
```
## 提示

对于 $20\%$ 的数据有 $n \le 10$。

对于 $40\%$ 的数据有 $n \le 100$。

对于另外 $20\%$ 的数据有，保证数据中 sign 只会是 <，并且 $i<j$。

对于 $100\%$ 的数据有 $T \le 5$，$1 \le n \le 1000$。


---

---
title: "[HEOI2014] 大工程"
layout: "post"
diff: 省选/NOI-
pid: P4103
tag: ['2014', '倍增', '各省省选', '河北', '虚树', '栈']
---
# [HEOI2014] 大工程
## 题目描述

国家有一个大工程，要给一个非常大的交通网络里建一些新的通道。

我们这个国家位置非常特殊，可以看成是一个单位边权的树，城市位于顶点上。

在 $2$ 个国家 $a,b$ 之间建一条新通道需要的代价为树上 $a,b$ 的最短路径的长度。

现在国家有很多个计划，每个计划都是这样，我们选中了 $k$ 个点，然后在它们两两之间 新建 $\dbinom{k}{2}$ 条新通道。

现在对于每个计划，我们想知道： 
1. 这些新通道的代价和。
2. 这些新通道中代价最小的是多少。
3. 这些新通道中代价最大的是多少。
## 输入格式

第一行 $n$ 表示点数。

接下来 $n-1$ 行，每行两个数 $a,b$ 表示 $a$ 和 $b$ 之间有一条边。点从 $1$ 开始标号。

接下来一行 $q$ 表示计划数。对每个计划有 $2$ 行，第一行 $k$ 表示这个计划选中了几个点。

第二行用空格隔开的 $k$ 个互不相同的数表示选了哪 $k$ 个点。
## 输出格式

输出 $q$ 行，每行三个数分别表示代价和，最小代价，最大代价。

## 样例

### 样例输入 #1
```
10 
2 1 
3 2 
4 1 
5 2 
6 4 
7 5 
8 6 
9 7 
10 9 
5 
2 
5 4 
2
10 4 
2 
5 2 
2
6 1 
2 
6 1
```
### 样例输出 #1
```
3 3 3 
6 6 6 
1 1 1 
2 2 2 
2 2 2
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^6,1\le q\le 5\times 10^4,\sum k\le 2\times n$。

每个测试点的具体限制见下表：

| 测试点编号 | $n$ | 特殊性质 |
| :-----------: | :-----------: | :-----------: |
| $1\sim 2$ | $\le 10^4$ |  |
|$3\sim 5$  | $\le 10^5$ | 树的形态是链 |
| $6\sim 7$ | $\le 10^5$ |  |
| $8\sim 10$ | $\le 10^6$ |  |


---

---
title: "[HEOI2014] 平衡"
layout: "post"
diff: 省选/NOI-
pid: P4104
tag: ['2014', '各省省选', '河北']
---
# [HEOI2014] 平衡
## 题目描述

下课了，露露、花花和萱萱在课桌上用正三棱柱教具和尺子摆起了一个“跷跷板”。

这个“跷跷板”的结构是这样的：底部是一个侧面平行于地平面的正三棱柱教具，上面 摆着一个尺子，尺子上摆着若干个相同的橡皮。尺子有 2n + 1 条等距的刻度线，第 n + 1 条 刻度线恰好在尺子的中心，且与正三棱柱的不在课桌上的棱完全重合。

露露发现这个“跷跷板”是不平衡的（尺子不平行于地平面）。于是，她又在尺子上放 了几个橡皮，并移动了一些橡皮的位置，使得尺子的 2n + 1 条刻度线上都恰有一块相同质 量的橡皮。“跷跷板”平衡了，露露感到很高兴。

花花觉得这样太没有意思，于是从尺子上随意拿走了 k 个橡皮。令她惊讶的事情发生了： 尺子依然保持着平衡！     萱萱是一个善于思考的孩子，她当然不对尺子依然保持平衡感到吃惊，因为这只是一个 偶然的事件罢了。令她感兴趣的是，花花有多少种拿走 k 个橡皮的方法，使得尺子依然保 持平衡？当然，为了简化问题，她不得不做一些牺牲——假设所有橡皮都是拥有相同质量的 质点。但即使是这样，她也没能计算出这个数目。放学后，她把这个问题交给了她的哥哥/ 姐姐——Hibarigasaki 学园学生会会长，也就是你。当然，由于这个问题的答案也许会过于 庞大，你只需要告诉她答案 mod p 的值。

## 输入格式

第一行，一个正整数，表示数据组数 T（萱萱向你询问的次数）。

接下来 T 行，每行 3 个正整数 n, k, p。

## 输出格式

共 T 行，每行一个正整数，代表你得出的对应问题的答案。

## 样例

### 样例输入 #1
```
10
6 5 10000  
4 1 10000 
9 6 10000 
4 6 10000 
5 1 10000 
8318 10 9973 
9862 9 9973 
8234 9 9973 
9424 9 9973 
9324 9 9973
```
### 样例输出 #1
```
73
1
920
8
1
4421
2565
0
446
2549
```
## 提示

10%的数据满足：n <= 10。

30%的数据满足：n <= 50。

50%的数据满足：n <= 1000。

另有 10%的数据满足：k = 3。

在此基础上，另有 10%的数据满足：p = 2。

100%的数据满足：T <= 20，1 <= n <= 10000，1 <= k <= 10，2 <= p <= 10000，且 k <= 2n+1。



---

---
title: "[HEOI2015] 兔子与樱花"
layout: "post"
diff: 省选/NOI-
pid: P4107
tag: ['贪心', '2015', '各省省选', '河北']
---
# [HEOI2015] 兔子与樱花
## 题目描述

很久很久之前，森林里住着一群兔子。有一天，兔子们突然决定要去看樱花。

兔子们所在森林里的樱花树很特殊。樱花树由 $n$ 个树枝分叉点组成，编号从 $0$ 到 $n-1$，这 $n$ 个分叉点由 $n-1$ 个树枝连接，我们可以把它看成一个有根树结构，其中 $0$ 号节点是根节点。

这个树的每个节点上都会有一些樱花，其中第 $i$ 个节点有 $c_i$ 朵樱花。樱花树的每一个节点都有最大的载重 $m$，对于每一个节点 $i$，它的儿子节点的个数和 $i$ 节点上樱花个数之和不能超过 $m$，即 $son(i) + c_i \leq m$，其中 $son(i)$ 表示 $i$ 的儿子的个数，如果 $i$ 为叶子节点，则 $son(i) = 0$。

现在兔子们觉得樱花树上节点太多，希望去掉一些节点。当一个节点被去掉之后，这个节点上的樱花和它的儿子节点都被连到删掉节点的父节点上。如果父节点也被删除，那么就会继续向上连接，直到第一个没有被删除的节点为止。

现在兔子们希望计算在不违背最大载重的情况下，最多能删除多少节点。

注意根节点不能被删除，被删除的节点不被计入载重。
## 输入格式

第一行输入两个正整数，$n$ 和 $m$ 分别表示节点个数和最大载重。

第二行 $n$ 个整数 $c_i$，表示第 $i$ 个节点上的樱花个数。

接下来 $n$ 行，每行第一个数 $k_i$ 表示这个节点的儿子个数，接下来 $k_i$ 个整数表示这个节点儿子的编号。
## 输出格式

一行一个整数，表示最多能删除多少节点。

## 样例

### 样例输入 #1
```
10 4
0 2 2 2 4 1 0 4 1 1
3 6 2 3
1 9
1 8
1 1
0
0
2 7 4
0
1 5
0
```
### 样例输出 #1
```
4
```
## 提示

- 对于 $30\%$ 的数据，$n \leq 5 \times 10^3$，$m \leq 100$，$c_i \leq 100$；
- 对于 $70\%$ 的数据，$n \leq 2 \times 10^5$，$m \leq 2 \times 10^3$，$c_i \leq 10^3$；
- 对于 $100\%$ 的数据，$1 \leq n \leq 2 \times 10^6$，$1 \leq m \leq 10^5$，$0 \leq c_i \leq 10^3$，保证初始时，每个节点樱花数与儿子节点个数之和大于 $0$ 且不超过 $m$。



---

---
title: "[HEOI2015] 公约数数列"
layout: "post"
diff: 省选/NOI-
pid: P4108
tag: ['2015', '各省省选', '河北', '枚举']
---
# [HEOI2015] 公约数数列
## 题目描述

设计一个数据结构. 给定一个正整数数列 $a_0, a_1, \cdots, a_{n - 1}$，你需要支持以下两种操作：


1. $\text{\texttt{MODIFY} \textit{id} \textit{x}}$：将 $a_{id}$ 修改为 $x$；
2. $\text{\texttt{QUERY} \textit{x}}$：求最小的整数 $p \ (0 \le p < n)$，使得 $\gcd(a_0, a_1, \cdots, a_p) \times  \operatorname{xor}(a_0, a_1, \cdots, a_p) = x$。其中 $\operatorname{xor}(a_0, a_1, \cdots, a_p)$ 代表 $a_0, a_1, \cdots, a_p$ 的异或和，$\gcd$ 表示最大公约数。

## 输入格式

第一行包含一个正整数 $n$。

接下来一行包含 $n$ 个正整数 $a_0,a_1,\cdots,a_{n-1}$。

之后一行包含一个正整数 $q$，表示询问的个数。

之后 $q$ 行，每行包含一个询问。格式如题目中所述。
## 输出格式

对于每个 $\texttt{QUERY}$ 询问，在单独的一行中输出结果。如果不存在这样的 $p$，输出 `no`。
## 样例

### 样例输入 #1
```
10
1353600 5821200 10752000 1670400 3729600 6844320 12544000 117600 59400 640
10
MODIFY 7 20321280
QUERY 162343680
QUERY 1832232960000
MODIFY 0 92160
QUERY 1234567
QUERY 3989856000
QUERY 833018560
MODIFY 3 8600
MODIFY 5 5306112
QUERY 148900352
```
### 样例输出 #1
```
6
0
no
2
8
8
```
## 提示

### 数据范围及约定

- 对于 $30\%$ 的数据，$n\le10^4$，$q\le 1000$。
- 对于 $100\%$ 的数据，$n\le10^5$，$q\le 10000$，$1\le a_i\le 10^9$，询问操作中 $x \le 10^{18}$，修改操作中 $0\le id<n$，$1\le x\le 10^9$。


---

---
title: "[HEOI2015] 小L的白日梦"
layout: "post"
diff: 省选/NOI-
pid: P4110
tag: ['2015', '各省省选', '河北']
---
# [HEOI2015] 小L的白日梦
## 题目描述

在某一天，你有了一个女性朋友。

你打算利用k天时间陪她，每天有很多种娱乐方式可供选择，你需要从中选择一种进行（一天只能进行一个项目），比如说一起去看电影、一起去主题公园，一起去逛街等等，一共n种项目。当然每个项目重复太多次你都会觉得无聊，因此第i个项目最多进行c[i]次。你虽然智商很高，但是情商堪忧，即使这些你准备的活动都是希望让她开心的，不过由于你笨拙的语言表达和过于理智的行动，可能使这些活动出现意外。经过你悉心的计算，你发现如果某一天进行了第i个项目，如果一切顺利的话她应该是很高兴的，但她会有a[i]的概率不高兴。如果她本来是很高兴的，但突然今天你让她不高兴了，她就会觉得很失落，并且对你的好感度大大下降。你希望尽可能避免这种情况发生，因此你要安排这k天之内每天进行的项目，最小化她感到失落的期望次数。

你的女性朋友十分在意你，所以她的心情只会因为你发生改变。第一天之前，因为你没有邀请她进行任何活动，所以她是不高兴的。

## 输入格式

第一行有一个非负整数t，表示一共有t组数据。

对于每组数据，第一行有两个非负整数n,k，分别表示你准备的项目个数和你用来陪她的天数。（n<=10^5, k<=10^9）

接下来n行，每一行描述一个项目，形如“x[i]/y[i] c[i]”且三个数均为非负整数，表示进行完这个项目之后她有x[i]/y[i]的概率不高兴，并且这个项目只能进行不超过c[i]次。（x[i],y[i] <= 10^4,c[i] <= 10^9）

## 输出格式

一共t行，对于每组数据输出使她感到失落的最小期望次数，四舍五入保留6位小数。

## 样例

### 样例输入 #1
```
3
1 2
0/1 3
1 2
1/1 3
1 2
1/2 3
```
### 样例输出 #1
```
0.000000
0.000000
0.250000
```
## 提示

【样例说明】

考虑第三组数据，因为只有一个项目所以只好每天都安排这个。

在第一天之前她总是不高兴的，一共有：

第一天不高兴，第二天也不高兴、

第一天高兴，第二天不高兴、

第一天不高兴，第二天高兴、

第一天不高兴，第二天也不高兴，

这四种情况，又因为每天的项目让她高兴或者是不高兴的概率都是0.5，因此这四种情况是等概率发生的。

只有在第二种情况下，她会感到失落一次。

因此答案是(1\*1+0\*3)/4=0.25.

【数据规模与约定】

对于前10%的数据，n,k<=5.

对于前30%的数据，n,k<=7.

对于前40%的数据，n,k<=10.

对于前60%的数据，n<=1000,k<=10^5.

对于100%的数据，n<=10^5，k<=10^9，数据组数不会太多，大概不超过10组，数据保证分数有意义并且∑c[i]>=k。



---

---
title: "[HEOI2015] 小 Z 的房间"
layout: "post"
diff: 省选/NOI-
pid: P4111
tag: ['2015', '各省省选', '河北', '生成树', '素数判断,质数,筛法', '高斯消元']
---
# [HEOI2015] 小 Z 的房间
## 题目描述

你突然有了一个大房子，房子里面有一些房间。事实上，你的房子可以看做是一个包含 $n\times m$ 个格子的格状矩形，每个格子是一个房间或者是一个柱子。在一开始的时候，相邻的格子之间都有墙隔着。

你想要打通一些相邻房间的墙，使得所有房间能够互相到达。在此过程中，你不能把房子给打穿，或者打通柱子（以及柱子旁边的墙）。同时，你不希望在房子中有小偷的时候会很难抓，所以你希望任意两个房间之间都只有一条通路。现在，你希望统计一共有多少种可行的方案，答案对 $10^9$ 取模。

## 输入格式

第一行两个整数 $n,m$。

接下来 $n$ 行，每行 $m$ 个字符 `.` 或 `*`，其中 `.` 代表房间，`*` 代表柱子。

## 输出格式

一行一个整数，表示合法的方案数对 $10^9$ 取模后的值。
## 样例

### 样例输入 #1
```
2 2
..
..

```
### 样例输出 #1
```
4

```
### 样例输入 #2
```
2 2
*.
.*

```
### 样例输出 #2
```
0

```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，$n,m \le 3$。
- 对于 $50\%$ 的数据，$n,m \le 5$。
- 有 $40\%$ 的数据，$\min(n,m) \le 3$。
- 有 $30\%$ 的数据，不存在柱子。
- 对于 $100\%$ 的数据，$1 \le n,m \le 9$。



---

---
title: "[HEOI2015] 最短不公共子串"
layout: "post"
diff: 省选/NOI-
pid: P4112
tag: ['2015', '各省省选', '河北', '后缀自动机 SAM', 'O2优化', '广度优先搜索 BFS', '后缀数组 SA']
---
# [HEOI2015] 最短不公共子串
## 题目描述

在虐各种最长公共子串、子序列的题虐的不耐烦了之后，你决定反其道而行之。

下面给出一些定义：

- 一个串的“子串”指的是它的连续的一段，例如 `bcd` 是 `abcdef` 的子串，但 `bde` 不是。
- 一个串的“子序列”指的是它的可以不连续的一段，例如 `bde` 是 `abcdef` 的子串，但 `bdd` 不是。

下面，给两个小写字母串 $a, b$，请你计算：

1. $a$ 的一个最短的子串，它不是 $b$ 的子串。
2. $a$ 的一个最短的子串，它不是 $b$ 的子序列。
3. $a$ 的一个最短的子序列，它不是 $b$ 的子串。
4. $a$ 的一个最短的子序列，它不是 $b$ 的子序列。

## 输入格式

有两行，每行一个小写字母组成的字符串，分别代表 $a$ 和 $b$。

## 输出格式

输出 $4$ 行，每行一个整数，依次表示以上 $4$ 个问题的答案的长度。如果没有符合要求的答案，输出 $-1$。

## 样例

### 样例输入 #1
```
aabbcc
abcabc
```
### 样例输出 #1
```
2
4
2
4
```
### 样例输入 #2
```
aabbcc
aabbcc
```
### 样例输出 #2
```
-1
-1
2
-1
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $a$ 和 $b$ 的长度都不超过 $20$。
- 对于 $50\%$ 的数据，保证 $a$ 和 $b$ 的长度都不超过 $500$。
- 对于 $100\%$ 的数据，保证 $a$ 和 $b$ 的长度都不超过 $2000$。



---

---
title: "[CQOI2016] 不同的最小割"
layout: "post"
diff: 省选/NOI-
pid: P4123
tag: ['2016', '重庆', '各省省选', '网络流', '分治', '最小割']
---
# [CQOI2016] 不同的最小割
## 题目描述

学过图论的同学都知道最小割的概念：对于一个图，某个对图中结点的划分将图中所有结点分成两个部分，如果结点 $s,t$ 不在同一个部分中，则称这个划分是关于 $s,t$ 的割。对于带权图来说，将所有顶点处在不同部分的边的权值相加所得到的值定义为这个割的容量，而 $s,t$ 的最小割指的是在关于 $s,t$ 的割中容量最小的割。

而对冲刺 NOI 竞赛的选手而言，求带权图中两点的最小割已经不是什么难事了。我们可以把视野放宽，考虑有 $N$ 个点的无向连通图中所有点对的最小割的容量，共能得到 $N(N-1)/2$ 个数值。这些数值中互不相同的有多少个呢？这似乎是个有趣的问题。
## 输入格式

第一行包含两个数 $N,M$，表示点数和边数。

接下来 $M$ 行，每行三个数 $u,v,w$，表示点 $u$ 和点 $v$ (从 $1$ 开始标号) 之间有一条权值是 $w$ 的边。
## 输出格式

第一行为一个整数，表示不同的最小割容量的个数。
## 样例

### 样例输入 #1
```
4 4
1 2 3
1 3 6
2 4 5
3 4 4
```
### 样例输出 #1
```
3
```
## 提示

$1\leq N\leq 850,1\leq M\leq 8500,1\leq w\leq 100000$。


---

---
title: "[AHOI2009] 最小割"
layout: "post"
diff: 省选/NOI-
pid: P4126
tag: ['2009', '并查集', '各省省选', '安徽', '强连通分量', '最小割']
---
# [AHOI2009] 最小割
## 题目描述

A,B两个国家正在交战，其中A国的物资运输网中有$N$个中转站，$M$条单向道路。设其中第$i (1≤i≤M)$条道路连接了$v_i,u_i$两个中转站，那么中转站$v_i$可以通过该道路到达$u_i$中转站，如果切断这条道路，需要代价$c_i$。

现在B国想找出一个路径切断方案，使中转站$s$不能到达中转站$t$，并且切断路径的代价之和最小。

小可可一眼就看出，这是一个求最小割的问题。但爱思考的小可可并不局限于此。现在他对每条单向道路提出两个问题：

- 问题一：是否存在一个最小代价路径切断方案，其中该道路被切断？
- 问题二：是否对任何一个最小代价路径切断方案，都有该道路被切断？

现在请你回答这两个问题。

## 输入格式

第一行有$4$个正整数，依次为$N,M,s,t$。

第$2$行到第$(M+1)$行每行$3$个正整数$v,u,c$，表示$v$中转站到$u$中转站之间有单向道路相连，单向道路的起点是$v$， 终点是$u$,切断它的代价是$c(1≤c≤100000)$。

注意:两个中转站之间可能有多条道路直接相连。 同一行相邻两数之间可能有一个或多个空格。

## 输出格式

对每条单向边，按输入顺序，依次输出一行，包含两个非$0$即$1$的整数，分别表示对问题一和问题二的回答(其中输出$1$表示是，输出$0$表示否)。 同一行相邻两数之间用一个空格隔开，每行开头和末尾没有多余空格。

## 样例

### 样例输入 #1
```
6 7 1 6
1 2 3
1 3 2
2 4 4
2 5 1
3 5 5
4 6 2
5 6 3
```
### 样例输出 #1
```
1 0
1 0
0 0
1 0
0 0
1 0
1 0
```
## 提示

设第$(i+1)$行输入的边为$i$号边，那么$\{1,2\},\{6,7\},\{2,4,6\}$是仅有的三个最小代价切割方案。它们的并是$\{1,2,4,6,7\}$，交是 $\{\varnothing \}$ 。

测试数据规模如下表所示

数据编号|N|M|数据编号|N|M
-|-|-|-|-|-
1|10|50|6|1000|20000
2|20|200|7|1000|40000
3|200|2000|8|2000|50000
4|200|2000|9|3000|60000
5|1000|20000|10|4000|60000



---

---
title: "[SHOI2006] 仙人掌"
layout: "post"
diff: 省选/NOI-
pid: P4129
tag: ['动态规划 DP', '高精度', '2006', '各省省选', '上海', '仙人掌']
---
# [SHOI2006] 仙人掌
## 题目背景

#本题不同于bzoj1023
bzoj1023快捷通道：[[SHOI2008] cactus仙人掌图(II)](https://www.luogu.org/problemnew/show/P4244)
## 题目描述

仙人掌图（cactus）是一种无向连通图，它的每条边最多只能出现在一个简单回路（simple cycle）里面。从直观上说，可以把仙人掌图理解为允许存在回路的树。但是仙人掌图和树之间有个本质的不同，仙人掌图可以拥有多个支撑子图（spanning subgraph），而树的支撑子图只有一个（它自身），我们把仙人掌图的支撑子图的数目称为“仙人数”。你的任务就是计算给定图的“仙人数”。

一些关于仙人掌图的举例：

 ![](https://cdn.luogu.com.cn/upload/pic/13241.png) 

第一张图是一个仙人掌图，第二张图的边（2，3）在两个不同的回路里面，所以不是仙人掌图，第三张图不是一个连通图，所以也不是仙人掌图。


以下是对一些术语的解释：


简单回路（simple cycle）：简单回路是原图的一条路径，这条路径的边集构成了回路，回路中顶点只能出现一次。比如对于上例中第二个图来说，它一共有三个简单回路，分别是（4，3，2，1，6，5）、（7，8，9，10，2，3）和（4，3，7，8，9，10，2，1，6，5）


支撑子图（spanning subgraph）：支撑子图也是原图的子图，这种子图可以比原来少一些边，但是不能破坏图的连通性，也不能去除原来图上的任何顶点。“支撑”的概念类似于我们熟知的“最小支撑树”，对于上例中的第一张图来说，任意去除回路I中的图或回路II中的一条边都能构成一个支撑子图，所以它的支撑子图一共有6 + 4 + 6 × 4 + 1 = 35种（注意图自身也是自己的一个子图）

## 输入格式

输入文件的第一行是两个整数n和m（1≤n≤20000, 0≤m≤1000）。n代表图的顶点数，顶点的编号总是从1到n表示的。

接下来一共有m行。每行都代表了图上的一条路径（注意：这里所表示的一条路径可不一定是一条回路）。这些行的格式是首先有一个整数ki（2≤ki≤1000）代表这条路径通过了几个顶点，接下来是ki个在1到n之间的数字，其中每个数字代表了图上的一个顶点，相邻的顶点之间就定义了一条边。一条路径上可能通过一个顶点好几次，比如对于第一个例子，第一条路径从2经过3，又从8返回到了3，但是我们保证所有的边都会出现在某条路径上，而且不会重复出现在两条路径上，或者在一条路径上出现两次。

## 输出格式

输出这张图的“仙人数”，如果它不是一张仙人掌图，输出0。注意最后的答案可能是一个很大很大的数。

## 样例

### 样例输入 #1
```
14 3
9 1 2 3 4 5 6 7 8 3
7 2 9 10 11 12 13 10
2 2 14
```
### 样例输出 #1
```
35
```
### 样例输入 #2
```
10 2
7 1 2 3 4 5 6 1
6 3 7 8 9 10 2
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
5 1
4 1 2 3 4
```
### 样例输出 #3
```
0
```


---

---
title: "[BJOI2012] 连连看"
layout: "post"
diff: 省选/NOI-
pid: P4134
tag: ['2012', '各省省选', '北京', '二分图', '费用流']
---
# [BJOI2012] 连连看
## 题目描述

凡是考智商的题里面总会有这么一种消除游戏。不过现在面对的这关连连看可不是 QQ 游戏里那种考眼力的游戏。我们的规则是，给出一个闭区间 $[a,b]$ 中的全部整数，如果其中某两个数 $x$，$y$（$x>y$）的平方差 $x^2-y^2$ 是一个完全平方数 $z^2$，并且 $y$ 与 $z$ 互质，那么就可以将 $x$ 和 $y$ 连起来并且将它们一起消除，同时得到 $x+y$ 点分数。那么过关的要求就是，消除的数对尽可能多的前提下，得到足够的分数。快动手动笔算一算吧。
## 输入格式

只有一行，两个整数，分别表示 $a$，$b$。
## 输出格式

两个数，可以消去的对数，及在此基础上能得到的最大分数。

## 样例

### 样例输入 #1
```
1 15
```
### 样例输出 #1
```
2 34
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $1\le a,b\le100$。
- 对于 $100\%$ 的数据，保证 $1\le a,b\le1000$。


---

---
title: "[JSOI2010] 挖宝藏"
layout: "post"
diff: 省选/NOI-
pid: P4164
tag: ['2010', '各省省选', '江苏']
---
# [JSOI2010] 挖宝藏
## 题目描述

JP 不好好训练，又喜欢上了另一个游戏——寻宝。

游戏里有 $n$ 处宝藏，它们被埋在一个无限大的二维网格中。每个宝藏都有价值 $P_i$，位置是 $(x_i,y_i)$。

如果网格 $(x,y)$ 满足下面两个条件之一，则它是可挖掘的：

- $y=-1$。

- $(x-1,y+1),(x,y+1),(x+1,y+1)$ 这三个方格都已经被挖掘了。

挖掘一个方格的代价为 $1$。当一个宝藏被挖掘出来时，就认为已经获得了它的价值。请你帮 JP 求出所能得到的最大利润，也即价值减代价。（可能一个宝藏也不挖，利润为 $0$）

## 输入格式

第一行为 $n$，表示宝藏数量。

接下来 $n$ 行，每行三个整数 $x_i,y_i,P_i$ 表示宝藏的位置和价值。
## 输出格式

一行一个整数，表示最大利润。
## 样例

### 样例输入 #1
```
5
1 -1 2
0 -1 2
4 -1 1
3 -1 2
2 -1 2
```
### 样例输出 #1
```
4
```
## 提示

### 样例解释 1

挖 $1,2,4,5$ 号宝藏，价值为 $8$，花费代价为 $4$，所以利润为 $4$。可以证明没有更优的方案。

### 数据范围

对于 $30\%$ 的数据，$n\leq 15$。

对于 $50\%$ 的数据，$-10^3\leq y_i\leq 0$。

对于 $100\%$ 的数据，$n\leq 10^3,-10^4\leq x_i\leq 10^4,-10^4\leq y_i<0,1\leq P_i\leq 10^6$。



---

---
title: "[SCOI2007] 组队"
layout: "post"
diff: 省选/NOI-
pid: P4165
tag: ['2007', '四川', '各省省选', '枚举', '排序']
---
# [SCOI2007] 组队
## 题目描述

NBA每年都有球员选秀环节。通常用速度和身高两项数据来衡量一个篮球运动员的基本素质。假如一支球队里速度最慢的球员速度为minV，身高最矮的球员高度为minH，那么这支球队的所有队员都应该满足: A × ( height – minH ) + B × ( speed – minV ) <= C 其中A和B，C为给定的经验值。这个式子很容易理解，如果一个球队的球员速度和身高差距太大，会造成配合的不协调。

请问作为球队管理层的你，在N名选秀球员中，最多能有多少名符合条件的候选球员。

## 输入格式

第一行四个数N、A、B、C 下接N行每行两个数描述一个球员的height和speed

## 输出格式

最多候选球员数目。

## 样例

### 样例输入 #1
```
4 1 2 10
5 1
3 2
2 3
2 1
```
### 样例输出 #1
```
4
```
## 提示

数据范围： N <= 5000 ,height和speed不大于10000。A、B、C在长整型以内。




---

---
title: "[SCOI2007] 最大土地面积"
layout: "post"
diff: 省选/NOI-
pid: P4166
tag: ['2007', '四川', '各省省选', '枚举', '向量', '凸包', '叉积']
---
# [SCOI2007] 最大土地面积
## 题目描述

在某块平面土地上有N个点，你可以选择其中的任意四个点，将这片土地围起来，当然，你希望这四个点围成的多边形面积最大。

## 输入格式

第1行一个正整数N，接下来N行，每行2个数x,y，表示该点的横坐标和纵坐标。

## 输出格式

最大的多边形面积，答案精确到小数点后3位。

## 样例

### 样例输入 #1
```
5
0 0
1 0
1 1
0 1
0.5 0.5
```
### 样例输出 #1
```
1.000
```
## 提示

数据范围 n<=2000, |x|,|y|<=100000



---

---
title: "[HNOI2006] 花仙子的魔法"
layout: "post"
diff: 省选/NOI-
pid: P4176
tag: ['2006', '各省省选', '湖南']
---
# [HNOI2006] 花仙子的魔法
## 题目描述

相传，在天地初成的远古时代，世界上只有一种叫做“元”的花。接下来，出现了一位拥有魔法的花仙子，她能给花附加属性，从此，“元”便不断变异，产生了大千世界千奇百怪的各种各样的花。据说，花仙子既可存在于二维空间（平面），又可存在于三维空间（立体），还可存在于 $n$ 维空间（想象）。二维空间的点可用向量 $\left(x_1,x_2\right)$ 表示，三维空间的点可用向量 $\left(x_1,x_2,x_3\right)$ 表示，一般来说，$n$ 维空间的点可用向量 $\left(x_1,x_2,\cdots,x_n\right)$ 表示。而 $n$ 维空间中两点 $\left(x_1,x_2,\cdots,x_n\right)$ 与 $\left(w_1,w_2,\cdots,w_n\right)$ 之间的距离定义为$\sqrt{\sum_{i=1}^{n}(X_i-W_i)^2}$。 在 $n$ 维空间中，花仙子每实施魔法就要选择一个参考点 $\left(w_1,w_2,\cdots,w_n\right)$ 和一个作用半径 $r$，并且参考点的位置和作用半径的大小可以任意选择。这时，$n$ 维空间中所有与参考点 $\left(w_1,w_2,\cdots,w_n\right)$ 之间的距离小于作用半径 $r$ 的花都会受到这次魔法的影响。每次魔法都会给受到影响的花带来不同的属性，且的效 果可以叠加。一般来说，若花仙子总共实施了 $m$ 次魔法，则 $n$ 维空间中处于某点的花所具有的属性可用长度为 $m$ 的二进制串 $\left(a_1,a_2,\cdots,a_n\right)$ 来描述，其中对 $1\le i\le m$，若该花受到第 $i$ 次魔法的影响，则 $a_i$ 的值为 $1$,否则为 $0$。显然，不同的属性对应不同的花。 现在的问题是：花仙子在 $n$ 维空间中实施了 $m$ 次魔法后，最多能得到多少种不同的花？

## 输入格式

包含两个整数，并用一个空格隔开，第一个整数表示实施魔法的次数 $m$，第二个整数表示空间的维数 $n$。其中，$1\le m\le 100$，$1 \le n \le 15$。

## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 1
```
### 样例输出 #1
```
6
```


---

---
title: "[CQOI2010] 鼹鼠"
layout: "post"
diff: 省选/NOI-
pid: P4179
tag: ['2010', '重庆', '各省省选']
---
# [CQOI2010] 鼹鼠
## 题目描述

Hilbert鼹鼠住在Hilbert地洞里——地洞的边界是一条$n$阶Hilbert曲线${H_n}$。Hilbert曲线的定义如下：${H_1}$是一个上端缺口的单位正方形；$H_n$由四份${H_n}-1$组成，其中左下和右下两份没有任何变化，而左上的那一份逆时针旋转了90度，而右上的那一份顺时针旋转了90度。这四份$H_n-1$用三条单位长度的线段连接起来构成了$H_n$。$H_1$~$H_4$如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/0vif0fh6.png)

你想捉一只Hilbert鼹鼠来玩，所以往地洞里使劲倒水想把它们赶出来。不过，由于地洞里有空气，无论你怎么倒水，有些地方总是淹不到的（假设水和空气都不可压缩）。输入Hilbert曲线

![](https://cdn.luogu.com.cn/upload/image_hosting/aaj85oki.png)

的阶数 $n$ 和地面的倾斜角 $α$ ，你的任务是计算能淹没到的面积。

注意，只有当水位严格高于一个障碍物时，水才能越过它往下流。更多细节可以参考下面的例子。

![](https://cdn.luogu.com.cn/upload/image_hosting/bbvmrpvd.png)

## 输入格式

输入仅包含两个整数$n$，$α$。

## 输出格式

输出仅一行，即被淹没的面积，输出保留小数点后6位。

## 样例

### 样例输入 #1
```
5 30
```
### 样例输出 #1
```
190.803848
```
### 样例输入 #2
```
3 45
```
### 样例输出 #2
```
15.500000
```
### 样例输入 #3
```
4 10
```
### 样例输出 #3
```
91.573592

```
### 样例输入 #4
```
3 0
```
### 样例输出 #4
```
26.000000


```
## 提示

$rt,n<=12,0<=alpha<=90$


---

---
title: "[BJWC2010] 严格次小生成树"
layout: "post"
diff: 省选/NOI-
pid: P4180
tag: ['2010', '倍增', '各省省选', '北京', 'O2优化', '生成树']
---
# [BJWC2010] 严格次小生成树
## 题目描述

小 C 最近学了很多最小生成树的算法，Prim 算法、Kruskal 算法、消圈算法等等。正当小 C 洋洋得意之时，小 P 又来泼小 C 冷水了。小 P 说，让小 C 求出一个无向图的次小生成树，而且这个次小生成树还得是严格次小的，也就是说：如果最小生成树选择的边集是 $E_M$，严格次小生成树选择的边集是 $E_S$，那么需要满足：($value(e)$ 表示边 $e$ 的权值) $\sum_{e \in E_M}value(e)<\sum_{e \in E_S}value(e)$。

这下小 C 蒙了，他找到了你，希望你帮他解决这个问题。

## 输入格式

第一行包含两个整数 $N$ 和 $M$，表示无向图的点数与边数。

接下来 $M$ 行，每行 $3$ 个数 $x,y,z$ 表示，点 $x$ 和点 $y$ 之间有一条边，边的权值为 $z$。

## 输出格式

包含一行，仅一个数，表示严格次小生成树的边权和。

## 样例

### 样例输入 #1
```
5 6
1 2 1 
1 3 2 
2 4 3 
3 5 4 
3 4 3 
4 5 6 
```
### 样例输出 #1
```
11
```
## 提示

数据中无向图**不保证无自环**。

对于 $50\%$ 的数据， $N\le 2000$，$M\le 3000$。

对于 $80\%$ 的数据， $N\le 5\times 10^4$，$M\le 10^5$。

对于 $100\%$ 的数据， $N\le 10^5$，$M\le 3\times10^5$，边权  $\in [0,10^9]$，数据保证必定存在严格次小生成树。


---

---
title: "[CQOI2006] 凸多边形 /【模板】半平面交"
layout: "post"
diff: 省选/NOI-
pid: P4196
tag: ['2006', '重庆', '各省省选', '排序', '向量', '栈', '队列', '半平面交']
---
# [CQOI2006] 凸多边形 /【模板】半平面交
## 题目描述

逆时针给出 $n$ 个凸多边形的顶点坐标，求它们交的面积。例如 $n=2$ 时，两个凸多边形如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/7ieux7g3.png)

则相交部分的面积为 $5.233$。
## 输入格式

第一行有一个整数 $n$，表示凸多边形的个数，以下依次描述各个多边形。第 $i$ 个多边形的第一行包含一个整数 $m_i$，表示多边形的边数，以下 $m_i$ 行每行两个整数，逆时针给出各个顶点的坐标。
## 输出格式

输出文件仅包含一个实数，表示相交部分的面积，保留三位小数。
## 样例

### 样例输入 #1
```
2
6
-2 0
-1 -2
1 -2
2 0
1 2
-1 2
4
0 -3
1 -1
2 2
-1 0
```
### 样例输出 #1
```
5.233
```
## 提示

对于 $100\%$ 的数据：$2 \leq n \leq 10$，$3 \leq m_i \leq 50$，每维坐标为 $[-1000,1000]$ 内的整数。


---

---
title: "[JSOI2008] 最小生成树计数"
layout: "post"
diff: 省选/NOI-
pid: P4208
tag: ['2008', '并查集', '各省省选', '江苏', '生成树', '素数判断,质数,筛法', '高斯消元']
---
# [JSOI2008] 最小生成树计数
## 题目描述

现在给出了一个简单无向加权图。你不满足于求出这个图的最小生成树，而希望知道这个图中有多少个不同的最小生成树。（如果两棵最小生成树中至少有一条边不同，则这两个最小生成树就是不同的）。由于不同的最小生成树可能很多，所以你只需要输出方案数对 $31011$ 的模就可以了。
## 输入格式

第一行包含两个数，$n$ 和 $m$，其中 $1 \le n \le 100$，$1 \le m \le 1000$，表示该无向图的节点数和边数。每个节点用 $1 \sim n$ 的整数编号。

接下来的 $m$ 行，每行包含两个整数：$a,b,c$，表示节点 $a,b$ 之间的边的权值为 $c$，其中 $1 \le c \le 10^9$。

数据保证不会出现自回边和重边。注意：具有相同权值的边不会超过 $10$ 条。
## 输出格式

输出不同的最小生成树有多少个。你只需要输出数量对 $31011$ 的模就可以了。
## 样例

### 样例输入 #1
```
4 6
1 2 1
1 3 1
1 4 1
2 3 2
2 4 1
3 4 1
```
### 样例输出 #1
```
8

```
## 提示

### 数据范围及约定

对于全部数据，$1 \le n \le 100$，$1 \le m \le 1000$，$1\leq c_i\leq 10^9$。


---

---
title: "[LNOI2014] LCA"
layout: "post"
diff: 省选/NOI-
pid: P4211
tag: ['2014', '线段树', '各省省选', '辽宁', '最近公共祖先 LCA', '树链剖分', '差分', '离线处理']
---
# [LNOI2014] LCA
## 题目描述

给出一个 $n$ 个节点的有根树（编号为 $0$ 到 $n-1$，根节点为 $0$）。

一个点的深度定义为这个节点到根的距离 $+1$。 

设 $dep[i]$ 表示点 $i$ 的深度，$\operatorname{LCA}(i, j)$ 表示 $i$ 与 $j$ 的最近公共祖先。 

有 $m$ 次询问，每次询问给出 $l, r, z$，求 $\sum_{i=l}^r dep[\operatorname{LCA}(i,z)]$ 。
## 输入格式

第一行 $2$ 个整数，$n, m$。

接下来 $n-1$ 行，分别表示点 $1$ 到点 $n-1$ 的父节点编号。

接下来 $m$ 行，每行 $3$ 个整数，$l, r, z$。
## 输出格式

输出 $m$ 行，每行表示一个询问的答案。每个答案对 $201314$ 取模输出。
## 样例

### 样例输入 #1
```
5 2
0
0
1
1
1 4 3
1 4 2
```
### 样例输出 #1
```
8
5
```
## 提示

### 数据范围及约定

- 对于 $20\%$ 的数据，$n\le 10000,m\le 10000$；
- 对于 $40\%$ 的数据，$n\le 20000,m\le 20000$；
- 对于 $60\%$ 的数据，$n\le 30000,m\le 30000$；
- 对于 $80\%$ 的数据，$n\le 40000,m\le 40000$；
- 对于 $100\%$ 的数据，$1\le n\le 50000,1\le m\le 50000$。


---

---
title: "[SCOI2015] 情报传递"
layout: "post"
diff: 省选/NOI-
pid: P4216
tag: ['2015', '四川', '线段树', '各省省选', '平衡树', '树链剖分', '可持久化线段树']
---
# [SCOI2015] 情报传递
## 题目描述

奈特公司是一个巨大的情报公司，它有着庞大的情报网络。情报网络中共有 $n$ 名情报员。每名情报员可能有若干名 (可能没有) 下线，除 $1$ 名大头目外其余 $n-1$ 名情报员有且仅有 $1$ 名上线。奈特公司纪律森严，每名情报员只能与自己的上、下线联系，同时，情报网络中任意两名情报员一定能够通过情报网络传递情报。

奈特公司每天会派发以下两种任务中的一个任务：

1. 搜集情报：指派 $T$ 号情报员搜集情报；
2. 传递情报：将一条情报从 $X$ 号情报员传递给 $Y$ 号情报员。

情报员最初处于潜伏阶段，他们是相对安全的，我们认为此时所有情报员的危险值为 $0$；一旦某个情报员开始搜集情报，他的危险值就会持续增加，每天增加 $1$ 点危险值 (开始搜集情报的当天危险值仍为 $0$，第 $2$ 天危险值为 $1$，第 $3$ 天危险值为 $2$，以此类推)。传递情报并不会使情报员的危险值增加。

为了保证传递情报的过程相对安全，每条情报都有一个风险控制值 $C$。奈特公司认为，参与传递这条情报的所有情报员中，危险值大于 $C$ 的情报员将对该条情报构成威胁。现在，奈特公司希望知道，对于每个传递情报任务，参与传递的情报员有多少个，其中对该条情报构成威胁的情报员有多少个。
## 输入格式

第一行包含一个正整数 $n$，表示情报员个数。
笫二行包含 $n$ 个非负整数，其中第 $i$ 个整数 $P_i$ 表示 $i$ 号情报员上线的编号。特别地，若 $P_i=0$，表示 $i$ 号情报员是大头目。
第三行包含一个正整数 $q$，表示奈特公司将派发 $q$ 个任务 (每天一个)。

随后 $q$ 行，依次描述 $q$ 个任务。每行首先有一个正整数 $k$。

- 若 $k=1$，表示任务是传递情报，随后有三个正整数 $X_i$、$Y_i$、$C_i$，依次表示传递情报的起点、终点和风险控制值。
- 若 $k=2$，表示任务是搜集情报，随后有 $1$ 个正整数 $T_i$，表示搜集情报的情报员编号。
## 输出格式

对于每个传递情报任务输出一行，包含两个整数，分别是参与传递情报的情报员个数和对该条情报构成威胁的情报员个数。
## 样例

### 样例输入 #1
```
7
0 1 1 2 2 3 3 
6
1 4 7 0
2 1
2 4
2 7
1 4 7 1
1 4 7 3
```
### 样例输出 #1
```
5 0
5 2
5 1
```
## 提示

样例解释：

对于 $3$ 个传递情报任务，都是经过 $5$ 名情报员，分别是 $4$ 号、$2$ 号、$1$ 号、$3$ 号和 $7$ 号。

- 第 $1$ 个任务，所有情报员 (危险值为 $0$) 都不对情报构成威胁；
- 第 $2$ 个任务，有 $2$ 名情报员对情报构成威胁，分别是 $1$ 号情报员 (危险值为 $3$) 和 $4$ 号情报员 (危险值为 $2$)，$7$ 号情报员 (危险值为 $1$) 并不构成威胁；
- 第 $3$ 个任务，只有 $1$ 名情报员对情报构成威胁。

数据范围：

$n\leqslant 2\times 10^5,Q\leqslant 2\times 10^5,0<P_i,C_i\leqslant N,1\leqslant T_i,X_i,Y_i\leqslant n$。


---

---
title: "[JSOI2009] 等差数列"
layout: "post"
diff: 省选/NOI-
pid: P4243
tag: ['2009', '线段树', '各省省选', '江苏', '差分']
---
# [JSOI2009] 等差数列
## 题目背景

“一个长度为$l$的数列$a_i$，若相邻两数间的差$a_i - a_{i-1} \ (2 \leq i \leq l)$全部相同，则这个数列为等差数列。”火星特级数学老师jyy，正在给他的火星学生们上数学课。
## 题目描述

为了检验学生的掌握情况，jyy布置了一道习题：给定一个长度为$N$（$1 \leq N \leq 100,000$）的数列，初始时第$i$个数为$v_i$（$v_i$是整数，$-100,000 \leq v_i \leq 100,000$），学生们要按照jyy的给出的操作步骤来改变数列中的某些项的值。操作步骤的具体形式为：`A s t a b` （$s, t, a, b$均为整数，$1 \leq s \leq t \leq N$，$-100,000 \leq a, b \leq 100,000$），它表示，在序列的$[s, t]$区间上加上初值为$a$，步长为$b$的等差数列。即$v_i$变为$v_i + a + b \times (i - s)$（对于$s \leq i \leq t$）。

在焦头烂额地计算之余，可怜的火星学生们还得随时回答jyy提出的问题。问题形式为：`B s t`（$s, t$均为整数，$1 \leq s \leq t \leq N$），表示jyy询问当前序列的$[s, t]$区间最少能划分成几段，使得每一段都是等差数列。比如说`1 2 3 5 7`最少能划分成$2$段，一段是`1 2 3`，另一段是`5 7`。询问是需要同学们计算出答案后，作为作业交上来的。

虽然操作数加问题数总共只有$Q$（$1 \leq Q \leq 100,000$）个，jyy还是觉得这个题很无聊很麻烦。于是他想让你帮他算一份标准答案。
## 输入格式

第$1$行：$1$个整数$N$，第$2 \cdots N + 1$行：每行一个整数。第$i + 1$行表示$v_i$。

第$N + 2$行：$1$个整数$Q$，第$N + 3 \cdots N + Q + 2$行：每行描述了一个操作或问题，格式如题中所述，不含引号。
## 输出格式

若干行，每行一个整数，表示对一个问题的回答。请按照输入中的顺序依次给出回答。
## 样例

### 样例输入 #1
```
5
1
3
-1
-4
7
2
A 2 4 -1 5
B 1 5
```
### 样例输出 #1
```
2
```
## 提示

**样例说明：**

原数列`1 3 -1 -4 7`。经过操作之后，数列变为`1 2 3 5 7`。如题中所述，最少能划分成$2$段。

**数据规模：**

对$30\%$的数据，$N, Q \leq 5000$。

对$100\%$的数据，$1 \leq N, Q \leq 100,000$。

其他数据范围见题面。


---

---
title: "[SHOI2008] 仙人掌图 II"
layout: "post"
diff: 省选/NOI-
pid: P4244
tag: ['动态规划 DP', '2008', '各省省选', '上海', '深度优先搜索 DFS', '区间 DP', '仙人掌']
---
# [SHOI2008] 仙人掌图 II
## 题目背景

题目这个II是和[SHOI2006的仙人掌图](https://www.luogu.org/problemnew/show/P4129)区分的，bzoj没有。
**但是实际上还是和bzoj1023是一个题目的**。
## 题目描述

如果某个无向连通图的任意一条边至多只出现在一条简单回路（simple cycle）里，我们就称这张图为仙人掌图（cactus）。所谓简单回路就是指在图上不重复经过任何一个顶点的回路。

![](https://cdn.luogu.com.cn/upload/pic/13241.png)

举例来说，上面的第一个例子是一张仙人图，而第二个不是——注意到它有三条简单回路：（4，3，2，1，6，5，4）、（7，8，9，10，2，3，7）以及（4，3，7，8，9，10，2，1，6，5，4），而（2，3）同时出现在前两个的简单回路里。另外，第三张图也不是仙人图，因为它并不是连通图。显然，仙人图上的每条边，或者是这张仙人图的桥（bridge），或者在且仅在一个简单回路里，两者必居其一。定义在图上两点之间的距离为这两点之间最短路径的距离。定义一个图的直径为这张图相距最远的两个点的距离。**现在我们假定仙人图的每条边的权值都是1，你的任务是求出给定的仙人图的直径**。
## 输入格式

输入的第一行包括两个整数n和m（1≤n≤50000以及0≤m≤10000）。其中n代表顶点个数，我们约定图中的顶点将从1到n编号。接下来一共有m行。代表m条路径。每行的开始有一个整数k（2≤k≤1000），代表在这条路径上的顶点个数。接下来是k个1到n之间的整数，分别对应了一个顶点，相邻的顶点表示存在一条连接这两个顶点的边。一条路径上可能通过一个顶点好几次，比如对于第一个样例，第一条路径从3经过8，又从8返回到了3，但是我们保证所有的边都会出现在某条路径上，而且不会重复出现在两条路径上，或者在一条路径上出现两次。
## 输出格式

只需输出一个数，这个数表示仙人图的直径长度。
## 样例

### 样例输入 #1
```
15 3
9 1 2 3 4 5 6 7 8 3
7 2 9 10 11 12 13 10
5 2 14 9 15 10
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
10 1
10 1 2 3 4 5 6 7 8 9 10
```
### 样例输出 #2
```
9
```
## 提示


对第一个样例的说明：6号点和12号点的最短路径长度为8，所以这张图的直径为8。

【注意】使用Pascal语言的选手请注意：你的程序在处理大数据的时候可能会出现栈溢出。
如果需要调整栈空间的大小，可以在程序的开头填加一句：{\$M 5000000}，其中5000000即指代栈空间的大小，请根据自己的程序选择适当的数值。


---

---
title: "[SHOI2008] 堵塞的交通"
layout: "post"
diff: 省选/NOI-
pid: P4246
tag: ['2008', '线段树', '各省省选', '递归', '上海']
---
# [SHOI2008] 堵塞的交通
## 题目描述

有一天，由于某种穿越现象作用，你来到了传说中的小人国。小人国的布局非常奇特，整个国家的交通系统可以被看成是一个 $2$ 行 $C$ 列的矩形网格，网格上的每个点代表一个城市，相邻的城市之间有一条道路，所以总共有 $2C$ 个城市和 $3C-2 $条道路。 

小人国的交通状况非常槽糕。有的时候由于交通堵塞，两座城市之间的道路会变得不连通，直到拥堵解决，道路才会恢复畅通。初来咋到的你决心毛遂自荐到交通部某份差事，部长听说你来自一个科技高度发达的世界，喜出望外地要求你编写一个查询应答系统，以挽救已经病入膏肓的小人国交通系统。 小人国的交通部将提供一些交通信息给你，你的任务是根据当前的交通情况回答查询的问题。交通信息可以分为以下几种格式：

- `Close r1 c1 r2 c2`：相邻的两座城市 $(r_1, c_1)$ 和 $(r_2, c_2)$ 之间的道路被堵塞了；
- `Open r1 c1 r2 c2`：相邻的两座城市 $(r_1, c_1)$ 和 $(r_2, c_2)$ 之间的道路被疏通了；
- `Ask r1 c1 r2 c2`：询问城市 $(r_1, c_1)$ 和 $(r_2, c_2)$ 是否连通。如果存在一条路径使得这两条城市连通，则返回 `Y`，否则返回 `N`。

*注：$r_i$ 表示行数，$c_i$ 表示列数，$1 \leq r_i \leq 2, 1 \leq c_i \leq C$。*
## 输入格式

第一行只有一个整数 $C$，表示网格的列数。接下来若干行，每行为一条交通信息，以单独的一行 `Exit` 作为结束。我们假设在一开始所有的道路都是堵塞的。我们保证 $C$ 小于等于 $100000$，信息条数小于等于 $100000$。
## 输出格式

对于每个查询，输出一个 `Y` 或 `N`。
## 样例

### 样例输入 #1
```
2
Open 1 1 1 2
Open 1 2 2 2
Ask 1 1 2 2
Ask 2 1 2 2
Exit
```
### 样例输出 #1
```
Y
N
```
## 提示

**数据范围：**

对于 $100\%$ 的数据，$1 \leq C \leq 100000$，$1 \leq$ 信息条数 $\leq 100000$。


---

---
title: "[AHOI2013] 差异"
layout: "post"
diff: 省选/NOI-
pid: P4248
tag: ['2013', '各省省选', '安徽', '后缀自动机 SAM', '后缀数组 SA', '后缀树']
---
# [AHOI2013] 差异
## 题目描述

给定一个长度为 $n$ 的字符串 $S$，令 $T_i$ 表示它从第 $i$ 个字符开始的后缀。求

$$\displaystyle \sum_{1\leqslant i<j\leqslant n}\operatorname{len}(T_i)+\operatorname{len}(T_j)-2\times\operatorname{lcp}(T_i,T_j)$$

其中，$\text{len}(a)$ 表示字符串 $a$ 的长度，$\text{lcp}(a,b)$ 表示字符串 $a$ 和字符串 $b$ 的最长公共前缀。
## 输入格式

一行，一个字符串 $S$。
## 输出格式

一行，一个整数，表示所求值。
## 样例

### 样例输入 #1
```
cacao
```
### 样例输出 #1
```
54
```
## 提示

#### 数据规模与约定

- 对于 $100\%$ 的数据，保证 $2\le n\le 500000$，且 $S$ 中均为小写字母。


---

---
title: "[SCOI2015] 小凸玩矩阵"
layout: "post"
diff: 省选/NOI-
pid: P4251
tag: ['2015', '四川', '二分', '各省省选', '网络流', '二分图']
---
# [SCOI2015] 小凸玩矩阵
## 题目描述

小凸和小方是好朋友，小方给了小凸一个 $n$ × $m$ $(n \leq m)$ 的矩阵 $A$，并且要求小凸从矩阵中选出 $n$ 个数，其中任意两个数都不能在同一行或者同一列。现在小凸想知道，选出的 $n$ 个数中第 $k$ 大的数的最小值是多少。
## 输入格式

第 $1$ 行读入 $3$ 个整数 $n, m, k$。

接下来 $n$ 行，每一行有 $m$ 个数字，第 $i$ 行第 $j$ 个数字代表矩阵中第 $i$ 行第 $j$ 列的元素 $A_{i,j}$。
## 输出格式

输出包含一行，为选出的 $n$ 个数中第 $k$ 大数的最小值。
## 样例

### 样例输入 #1
```
2 3 1
1 2 4
2 4 1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3 4 2
1 5 6 6
8 3 4 3
6 8 6 3
```
### 样例输出 #2
```
3
```
## 提示

对于 $20$% 的数据， $1 \leq n \leq m \leq 9$

对于 $40$% 的数据， $1 \leq n \leq m \leq 22, 1 \leq n \leq 12$

对于 $100$% 的数据， $1 \leq k \leq n \leq m \leq 250, 1 \leq A_{i,j} \leq 10^9$


---

---
title: "[SCOI2015] 小凸玩密室"
layout: "post"
diff: 省选/NOI-
pid: P4253
tag: ['2015', '四川', '各省省选', '树形 DP']
---
# [SCOI2015] 小凸玩密室
## 题目描述

小凸和小方相约玩密室逃脱，这个密室是一棵有 $n$ 个节点的完全二叉树，每个节点有一个灯泡。点亮所有灯泡即可逃出密室。每个灯泡有个权值 $a_i$，每条边也有个权值 $b_i$。点亮第一个灯泡不需要花费，之后每点亮一个新的灯泡 $v$ 的花费，等于上一个被点亮的灯泡 $u$ 到这个点 $v$ 的距离 $D_{u,v}$，乘以这个点的权值 $a_v$。在点灯的过程中，要保证任意时刻所有被点亮的灯泡必须连通，在点亮一个灯泡后必须先点亮其子树所有灯泡才能点亮其他灯泡。请告诉他们，逃出密室的最少花费是多少。
## 输入格式

第 $1$ 行包含 $1$ 个数 $n$，代表节点的个数

第 $2$ 行包含 $n$ 个数，代表每个节点的权值 $a_i$。 $(i = 1, 2,$……$, n)$

第 $3$ 行包含 $n - 1$ 个数，代表每条边的权值 $b_i$，第 $i$ 号边是由第 $(i+1)/2$ 号点连向第 $i + 1$ 号点的边。$(i = 1, 2,$……$, n - 1)$
## 输出格式

输出包含 $1$ 个数，代表最少的花费。
## 样例

### 样例输入 #1
```
3
5 1 2
2 1

```
### 样例输出 #1
```
5
```
## 提示

对于 $10$% 的数据， $1 \leq n \leq 10$

对于 $20$% 的数据， $1 \leq n \leq 20$

对于 $30$% 的数据， $1 \leq n \leq 2000$

对于 $100$% 的数据， $1 \leq n \leq 2 \times 10^5, 1 \leq a_i, b_i \leq 10^5$


---

---
title: "[JSOI2008] Blue Mary 开公司"
layout: "post"
diff: 省选/NOI-
pid: P4254
tag: ['2008', '各省省选', '递归', '江苏', '李超线段树']
---
# [JSOI2008] Blue Mary 开公司
## 题目背景

Blue Mary 最近在筹备开一家自己的网络公司。由于他缺乏经济头脑，所以先后聘请了若干个金融顾问为他设计经营方案。
## 题目描述

万事开头难，经营公司更是如此。开始的收益往往是很低的，不过随着时间的增长会慢慢变好。也就是说，**对于一个金融顾问 $i$，他设计的经营方案中，每天的收益都比前一天高，并且均增长一个相同的量 $P_i$。**

由于金融顾问的工作效率不高，**所以在特定的时间，Blue Mary 只能根据他已经得到的经营方案来估算某一时间的最大收益**。由于 Blue Mary 是很没有经济头脑的，所以他在估算每天的最佳获益时完全不会考虑之前的情况，而是直接从所有金融顾问的方案中选择一个在当天获益最大的方案的当天的获益值，例如：

有如下两个金融顾问分别对前四天的收益方案做了设计：

|   | 第一天 | 第二天 | 第三天 | 第四天 | $P_i$ |
| :-: | :-: | :-: | :-: | :-: | :-: |
| 顾问 1 | $1$ | $5 $| $9$ | $13$ | $4$ |
| 顾问 2 | $2$ | $5$ | $8$ | $11$ | $3$ |

在第一天，Blue Mary 认为最大收益是 $2$（使用顾问 2 的方案），而在第三天和第四天，他认为最大收益分别是 $9$ 和 $13$（使用顾问 1 的方案）。而他认为前四天的最大收益是：$2 + 5 + 9 + 13 = 29$。

现在你作为 Blue Mary 公司的副总经理，会不时收到金融顾问的设计方案，也需要随时回答 Blue Mary 对某天的“最大收益”的询问（这里的“最大收益”是按照 Blue Mary 的计算方法）。**一开始没有收到任何方案时，你可以认为每天的最大收益值是 0**。下面是一组收到方案和回答询问的例子：


- 询问 $2$，回答 $0$。
- 收到方案：$0\ 1\ 2\ 3\ 4\ 5\ \cdots$
- 询问 $2$，回答 $1$。
- 收到方案：$2\ 2.1\ 2.2\ 2.3\ 2.4\ \cdots$
- 询问 $2$，回答 $2.1$。
## 输入格式

第一行 ：一个整数 $N$，表示方案和询问的总数。 

接下来 $N$ 行，每行开头一个单词 `Query` 或 `Project`。 

若单词为 `Query`，则后接一个整数 $T$，表示 Blue Mary 询问第 $T$ 天的最大收益。 

若单词为 `Project`，则后接两个实数 $S, P$，表示该种设计方案第一天的收益 $S$，以及以后每天比上一天多出的收益 $P$。
## 输出格式

对于每一个 `Query`，输出一个整数，表示询问的答案，并精确到整百元（以百元为单位，例如：该天最大收益为 $210$ 或 $290$ 时，均应该输出 $2$）。没有方案时回答询问要输出 $0$。
## 样例

### 样例输入 #1
```
10
Project 5.10200 0.65000
Project 2.76200 1.43000
Query 4
Query 2
Project 3.80200 1.17000
Query 2
Query 3
Query 1
Project 4.58200 0.91000
Project 5.36200 0.39000
```
### 样例输出 #1
```
0
0
0
0
0
```
## 提示

**数据范围**

$1 \leq N \leq 10 ^ 5$，$1 \leq T \leq 5\times 10 ^ 4$，$0 < P < 100$，$|S| \leq 10 ^ 5$。

**提示**

本题读写数据量可能相当巨大，请选手注意选择高效的文件读写方式。


---

---
title: "[SHOI2014] 概率充电器"
layout: "post"
diff: 省选/NOI-
pid: P4284
tag: ['2014', '各省省选', '上海', '连通块', '条件概率', '期望', '高斯消元']
---
# [SHOI2014] 概率充电器
## 题目描述

著名的电子产品品牌 SHOI 刚刚发布了引领世界潮流的下一代电子产品——概率充电器：

“采用全新纳米级加工技术，实现元件与导线能否通电完全由真随机数决定！SHOI 概率充电器，您生活不可或缺的必需品！能充上电吗？现在就试试看吧！”

SHOI 概率充电器由 $n-1$ 条导线连通了 $n$ 个充电元件。进行充电时，每条导线是否可以导电以概率决定，每一个充电元件自身是否直接进行充电也由概率决定。随后电能可以从直接充电的元件经过通电的导线使得其他充电元件进行间接充电。

作为 SHOI 公司的忠实客户，你无法抑制自己购买 SHOI 产品的冲动。在排了一个星期的长队之后终于入手了最新型号的 SHOI 概率充电器。你迫不及待地将 SHOI 概率充电器插入电源——这时你突然想知道，进入充电状态的元件个数的期望是多少呢？
## 输入格式

第一行一个整数 $n$。概率充电器的充电元件个数。充电元件由 $1 \sim n$ 编号。

之后的 $n-1$ 行每行三个整数 $a, b, p$，描述了一根导线连接了编号为 $a$ 和 $b$ 的充电元件，通电概率为 $p\%$。

第 $n+2$ 行 $n$ 个整数 $q_i$。表示 $i$ 号元件直接充电的概率为 $q_i\%$。
## 输出格式

输出一行一个实数，为能进入充电状态的元件个数的期望，四舍五入到小数点后 6 位小数。
## 样例

### 样例输入 #1
```
3
1 2 50
1 3 50
50 0 0
```
### 样例输出 #1
```
1.000000
```
### 样例输入 #2
```
5
1 2 90
1 3 80
1 4 70
1 5 60
100 10 20 30 40
```
### 样例输出 #2
```
4.300000
```
## 提示

对于 $30\%$ 的数据，$n \leq 5 \times 10^3$。

对于 $100\%$ 的数据，$n \leq 5 \times 10^5$，$0 \leq p,q_i \leq 100$。


---

---
title: "[SHOI2008] 汉诺塔"
layout: "post"
diff: 省选/NOI-
pid: P4285
tag: ['递推', '2008', '各省省选', '递归', '上海', '线性递推']
---
# [SHOI2008] 汉诺塔
## 题目描述

汉诺塔由三根柱子（分别用A、B、C表示）和n个大小互不相同的空心盘子组成。一开始n个盘子都摞在柱子A上，大的在下面，小的在上面，形成了一个塔状的锥形体。
    对汉诺塔的一次合法的操作是指：从一根柱子的最上层拿一个盘子放到另一根柱子的最上层，同时要保证被移动的盘子一定放在比它更大的盘子上面（如果移动到空柱子上就不需要满足这个要求）。我们可以用两个字母来描述一次操作：第一个字母代表起始柱子，第二个字母代表目标柱子。例如，AB就是把柱子A最上面的那个盘子移到柱子B。汉诺塔的游戏目标是将所有的盘子从柱子A移动到柱子B或柱子C上面。
有一种非常简洁而经典的策略可以帮助我们完成这个游戏。首先，在任何操作执行之前，我们以任意的次序为六种操作（AB、AC、BA、BC、CA和CB）赋予不同的优先级，然后，我们总是选择符合以下两个条件的操作来移动盘子，直到所有的盘子都从柱子A移动到另一根柱子：
（1）这种操作是所有合法操作中优先级最高的；
（2）这种操作所要移动的盘子不是上一次操作所移动的那个盘子。
可以证明，上述策略一定能完成汉诺塔游戏。现在你的任务就是假设给定了每种操作的优先级，计算按照上述策略操作汉诺塔移动所需要的步骤数。

![](https://cdn.luogu.com.cn/upload/pic/21997.png)

## 输入格式

输入有两行。第一行为一个整数n（1≤n≤30），代表盘子的个数。第二行是一串大写的ABC字符，代表六种操作的优先级，靠前的操作具有较高的优先级。每种操作都由一个空格隔开。
## 输出格式

只需输出一个数，这个数表示移动的次数。我们保证答案不会超过10的18次方。
## 样例

### 样例输入 #1
```
3
AB BC CA BA CB AC
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
2
AB BA CA BC CB AC
```
### 样例输出 #2
```
5
```
## 提示

对于20%的数据，n ≤ 10。
对于100%的数据，n ≤ 30。


---

---
title: "[SHOI2008] 安全的航线"
layout: "post"
diff: 省选/NOI-
pid: P4286
tag: ['2008', '各省省选', '上海']
---
# [SHOI2008] 安全的航线
## 题目描述

在设计航线的时候，安全是一个很重要的问题。首先，最重要的是应采取一切措施确保飞行不会发生任何事故，但同时也需要做好最坏的打算，一旦事故发生，就要确保乘客有尽量高的生还几率。

当飞机迫降到海上的时候，最近的陆地就是一个关键的因素。航线中最危险的地方就是距离最近的陆地最远的地方，我们称这种点为这条航线“孤地点”。孤地点到最近陆地的距离被称为“孤地距离”。作为航空公司的高级顾问，你接受的第一个任务就是尽量找出一条航线的孤地点，并计算这条航线的孤地距离。

为了简化问题，我们认为地图是一个二维平面，陆地可以用多边形近似，飞行线路为一条折线。航线的起点和终点都在陆地上，但中间的转折点是可能在海上（如下图所示，方格标示出了孤地点）。

![](https://cdn.luogu.com.cn/upload/pic/15457.png)
## 输入格式

输入的第一行包括两个整数C和N（1≤C≤20，2≤N≤20），分别代表陆地的数目的航线的转折点的数目。

接下来有N行，每行有两个整数x,y。(x,y)表示一个航线转折点的坐标，第一个转折点为航线的起点，最后一个转折点为航线的终点。

接下来的输入将用来描述C块大陆。每块输入由一个正整数M开始（M≤30），M表示多边形的顶点个数，接下来的M行，每行会包含两个整数x,y，(x,y)表示多边形的一个顶点坐标，我们保证这些顶点以顺时针或逆时针给出了该多边形的闭包，不会出现某些边相交的情况。此外我们也保证输入数据中任何两块大陆不会相交。

输入的所有坐标将保证在-10,000到10,000的范围之间。
## 输出格式

输出一个浮点数，表示航线的孤地距离，数据保留2位小数。
## 样例

### 样例输入 #1
```
1 2
-9 -6
5 1
3
0 16
-16 -12
17 -6
```
### 样例输出 #1
```
0.00
```
### 样例输入 #2
```
2 3
12 4
16 17
3 9
4
1 0
4 19
19 14
6 12
3
10 10
5 3
18 2
```
### 样例输出 #2
```
2.94
```
## 提示

对于50%的数据，1≤C≤2，2≤N≤5;

对于100%的数据，1≤C≤20，2≤N≤20。


---

---
title: "[SHOI2011] 双倍回文"
layout: "post"
diff: 省选/NOI-
pid: P4287
tag: ['字符串', '2011', '各省省选', '上海', '回文自动机 PAM', 'Manacher 算法']
---
# [SHOI2011] 双倍回文
## 题目描述

记字符串 $w$ 的倒置为 $w^{\mathsf R}$。例如$\tt (abcd)^{\mathsf R}=dcba$，$\tt (abba)^{\mathsf R}=abba$。

对字符串 $x$，如果 $x$ 满足 $x^{\mathsf R}=x$，则称之为回文。例如 $\tt abba$ 是一个回文，而 $\tt abed$ 不是。

如果 $x$ 能够写成 $ww^{\mathsf R} ww^{\mathsf R}$ 形式，则称它是一个“双倍回文”。换句话说，若要 $x$ 是双倍回文，它的长度必须是 $4$ 的倍数，而且 $x$，$x$ 的前半部分，$x$ 的后半部分都要是回文。例如 $\tt abbaabba$ 是一个双倍回文，而 $\tt abaaba$ 不是，因为它的长度不是 $4$ 的倍数。

- $x$ 的子串是指在 $x$ 中连续的一段字符所组成的字符串。例如 $\tt be$ 是 $\tt abed$ 的子串，而 $\tt ac$ 不是。
- $x$ 的回文子串，就是指满足回文性质的 $x$ 的子串。
- $x$ 的双倍回文子串，就是指满足双倍回文性质的 $x$ 的子串。

你的任务是，对于给定的字符串，计算它的最长双倍回文子串的长度。
## 输入格式

输入分为两行。

第一行为一个整数，表示字符串的长度。  
第二行有个连续的小写的英文字符，表示字符串的内容。
## 输出格式

输出文件只有一行即输入数据中字符串的最长双倍回文子串的长度，如果双倍回文子串不存在，则输出 $0$。
## 样例

### 样例输入 #1
```
16
ggabaabaabaaball
```
### 样例输出 #1
```
12
```
## 提示

### 数据范围及约定

对于全部数据，$1\le N \le 500000$。


---

---
title: "[SHOI2014] 信号增幅仪"
layout: "post"
diff: 省选/NOI-
pid: P4288
tag: ['2014', '各省省选', '上海']
---
# [SHOI2014] 信号增幅仪
## 题目描述

无线网络基站在理想状况下有效信号覆盖范围是个圆形。而无线基站的功
耗与圆的半径的平方成正比。现给出平面上若干网络用户的位置，请你选择一
个合适的位置建设无线基站 ……

就在你拿起键盘准备开始敲代码的时候，你的好朋友发明家SHTSC 突然出
现了。SHTSC 刚刚完成了他的新发明——无线信号增幅仪。增幅仪能够在不增
加无线基站功耗的前提下，使得有效信号的覆盖范围在某一特定方向上伸长若
干倍。即：使用了增幅仪的无线基站覆盖范围是个椭圆，其功耗正比于半短轴
长的平方。

现给出平面上若干网络用户的位置，请你选择一个合适的位置建设无线基
站，并在增幅仪的帮助下使所有的用户都能接收到信号，且无线基站的功耗最
小。

注意：由于SHTSC 增幅仪的工作原理依赖地磁场，增幅的方向是恒定的。
## 输入格式

第一行一个整数：n。平面内的用户个数。之后的n 行每行两个整数x, y，表示一个用户的位置。

第n+2 行一个整数：a。表示增幅仪的增幅方向，单位是度。表示增幅仪的
方向是从x 正方向逆时针转a 度。

第n+3 行一个整数：p。表示增幅仪的放大倍数。
## 输出格式

输出一行一个实数，为能够覆盖所有用户的最小椭圆的半短轴长，四舍五入到三位小数。
## 样例

### 样例输入 #1
```
2
1 0
-1 0
0
2
```
### 样例输出 #1
```
0.500
```
### 样例输入 #2
```
3
1 1
-1 -1
0 0
45
7
```
### 样例输出 #2
```
0.202
```
## 提示

- 对于10%的数据，保证最优方案的中心在原点。
- 对于20%的数据，保证点是随机生成的。
- 对于30%的数据，n≤100。
- 对于50%的数据，n≤5000。
- 对于100%的数据，n≤50000，0≤a<180，1≤p≤100，|x|,|y|≤$2×10^8$。


---

---
title: "[HAOI2008] 排名系统"
layout: "post"
diff: 省选/NOI-
pid: P4291
tag: ['模拟', '字符串', '2008', '河南', '各省省选', '平衡树']
---
# [HAOI2008] 排名系统
## 题目描述

排名系统通常要应付三种请求：上传一条新的得分记录、查询某个玩家的当前排名以及返回某个区段内的排名记录。当某个玩家上传自己最新的得分记录时，他原有的得分记录会被删除。为了减轻服务器负担，在返回某个区段内的排名记录时，最多返回10条记录。
## 输入格式

第一行是一个整数n（10<=n<=250000）表示请求总数目。接下来n行,每行包含了一个请求。请求的具体格式如下：

+Name Score 上传最新得分记录。Name表示玩家名字，由大写英文字母组成，不超过10个字符。Score为最多8位的正整数。

?Name 查询玩家排名。该玩家的得分记录必定已经在前面上传。如果两个玩家的得分相同，则先得到该得分的玩家排在前面。

?Index 返回自第Index名开始的最多10名玩家名字。Index必定合法，即不小于1，也不大于当前有记录的玩家总数。
## 输出格式

对于?Name格式的请求，应输出一个整数表示该玩家当前的排名。

对于?Index格式的请求，应在一行中依次输出从第Index名开始的最多10名玩家姓名，用一个空格分隔。
## 样例

### 样例输入 #1
```
20
+ADAM 1000000
+BOB 1000000
+TOM 2000000
+CATHY 10000000
?TOM
?1
+DAM 100000
+BOB 1200000
+ADAM 900000
+FRANK 12340000
+LEO 9000000
+KAINE 9000000
+GRACE 8000000
+WALT 9000000
+SANDY 8000000
+MICK 9000000
+JACK 7320000
?2
?5
?KAINE
```
### 样例输出 #1
```
2
CATHY TOM ADAM BOB
CATHY LEO KAINE WALT MICK GRACE SANDY JACK TOM BOB
WALT MICK GRACE SANDY JACK TOM BOB ADAM DAM
4
```
## 提示

20%数据满足N<=100

100%数据满足N<=250000


---

---
title: "[SCOI2003] 严格N元树"
layout: "post"
diff: 省选/NOI-
pid: P4295
tag: ['高精度', '2003', '四川', '各省省选', '前缀和', '差分']
---
# [SCOI2003] 严格N元树
## 题目描述

如果一棵树的所有非叶节点都恰好有 $n$ 个儿子，那么我们称它为严格 $n$ 元树。如果该树中最底层的节点深度为 $d$（根的深度为 $0$），那么我们称它为一棵深度为 $d$ 的严格 $n$ 元树。例如，深度为２的严格２元树有三个，如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/um9mtoxb.png)
 
给出 $n,d$，编程数出深度为 $d$ 的 $n$ 元树数目。
## 输入格式

仅包含两个整数 $n,d(0<n \le 32,0 \le d \le 16)$。输入数据保证你不需要考虑某一层多于 $1024$ 个节点的树（即 $nd \le 1024$）。提示：答案保证不超过 $200$ 位十进制数。
## 输出格式

仅包含一个数，即深度为 $d$ 的 $n$ 元树的数目。
## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
2 3
```
### 样例输出 #2
```
21
```
### 样例输入 #3
```
3 5
```
### 样例输出 #3
```
58871587162270592645034001

```


---

---
title: "[AHOI2006] 上学路线"
layout: "post"
diff: 省选/NOI-
pid: P4300
tag: ['2006', '各省省选', '安徽']
---
# [AHOI2006] 上学路线
## 题目描述

可可和卡卡家住 HF 市的东郊，每天上学他们都要转车多次才能到达市区西端的学校。直到有一天他们两人参加了学校的信息学奥林匹克竞赛小组才发现每天上学的乘车路线不一定是最优的。

可可：“很可能我们在上学的路途上浪费了大量的时间，让我们写一个程序来计算上学需要的最少时间吧！”

HF 市一共设有 $N$ 个公交车站，不妨将它们编号为 $1\sim N$ 的自然数，并认为可可和卡卡家住在 $1$ 号汽车站附近，而他们学校在 $N$ 号汽车站。市内有 $M$ 条直达汽车路线，执行第 $i$ 条路线的公交车往返于站点 $p_i$ 和 $q_i$ 之间，从起点到终点需要花费的时间为 $t_i$（$1\leq i\leq M$，$1\leq p_i,q_i\leq N$）。

两个人坐在电脑前，根据上面的信息很快就编程算出了最优的乘车方案。然而可可忽然有了一个鬼点子，他想趁卡卡不备，在卡卡的输入数据中删去一些路线，从而让卡卡的程序得出的答案大于实际的最短时间。而对于每一条路线 $i$ 事实上都有一个代价 $c_i$：删去路线的 $c_i$ 越大卡卡就越容易发现这个玩笑，可可想知道什么样的删除方案可以达到他的目的而让被删除的公交车路线 $c_i$ 之和最小。

编写一个程序：
-  从输入文件中读取 HF 市公交路线的信息；
-  计算出实际上可可和卡卡上学需要花费的最少时间；
-  帮助可可设计一个方案，删除输入信息中的一些公交路线，使得删除后从家到学校需要的最少时间变大，而被删除路线的 $c_i$ 和最小；
- 向输出文件输出答案。
## 输入格式

输入文件中第一行有两个正整数 $N$ 和 $M$，分别表示 HF 市公交车站和公交汽车路线的个数。

以下 $M$ 行，每行（第 $i$ 行，总第 $(i+1)$ 行）用四个正整数描述第 $i$ 条路线：$p_i,q_i,t_i,c_i$，具体含义见上文描述。
## 输出格式

第一行中仅有一个整数，表示从可可和卡卡家到学校需要的最短时间。 

第二行输出一个整数 $C$，表示 $c_i$ 之和。
## 样例

### 样例输入 #1
```
6 7 
1 2 1 3 
2 6 1 5 
1 3 1 1 
3 4 1 1 
4 6 1 1 
5 6 1 2 
1 5 1 4
```
### 样例输出 #1
```
2
5

```
## 提示

$2\leq N\leq 500$，$1\leq M\leq 124750$，$1\leq t_i,c_i\leq 10^4$。

HF 市的公交网络十分发达，你可以认为任意两个车站间都可以通过直达或转车互相到达，当然如果在你提供的删除方案中，家和学校无法互相到达，那么则认为上学需要的最短为正无穷大：这显然是一个合法的方案。


---

---
title: "[JSOI2009] 球队收益 / 球队预算"
layout: "post"
diff: 省选/NOI-
pid: P4307
tag: ['2009', '各省省选', '江苏', '图论建模', '费用流']
---
# [JSOI2009] 球队收益 / 球队预算
## 题目描述

在一个篮球联赛里，有$n$支球队，球队的支出是和他们的胜负场次有关系的，具体来说，第i支球队的赛季总支出是$C_i\times x^2+D_i \times y^2,D_i \le C_i$。(赢得多，给球员的奖金就多嘛)
其中$x,y$分别表示这只球队本赛季的胜负场次。现在赛季进行到了一半，每只球队分别取得了$a_i$场胜利和$b_i$场失利。而接下来还有$m$场比赛要进行。问联盟球队的最小总支出是多少。
## 输入格式

第一行$n$，$m$

接下来$n$行每行$4$个整数$a_i,b_i,C_i,D_i$

再接下来$m$行每行两个整数$s$，$t$表示第$s$支队伍和第$t$支队伍之间将有一场比赛，注意两只队间可能有多场比赛。
## 输出格式

一个整数代表总支出的最小值。
## 样例

### 样例输入 #1
```
3 3
1 0 2 1
1 1 10 1
0 1 3 3
1 2
2 3
3 1
```
### 样例输出 #1
```
43
```
## 提示

对于20%的数据$2 \le n \le 10,0 \le m \le 20$；  
对于100%的数据$2 \le n \le 5000,0 \le m \le 1000,0 \le D_i \le C_i \le 10,0 \le a_i,b_i \le 50$。


---

---
title: "[TJOI2013] 最长上升子序列"
layout: "post"
diff: 省选/NOI-
pid: P4309
tag: ['2013', '线段树', '各省省选', '平衡树', '树状数组', '天津']
---
# [TJOI2013] 最长上升子序列
## 题目描述

给定一个序列，初始为空。现在我们将 $1$ 到 $N$ 的数字插入到序列中，每次将一个数字插入到一个特定的位置。每插入一个数字，我们都想知道此时最长上升子序列长度是多少？
## 输入格式

第一行一个整数 $N$，表示我们要将 $1$ 到 $N$ 插入序列中。

接下是 $N$ 个数字，第 $k$ 个数字 $X_k$，表示我们将 $k$ 插入到位置 $X_k(0\le X_k\le k-1,1\le k\le N)$

## 输出格式

$N$ 行，第 $i$ 行表示 $i$ 插入 $X_i$ 位置后序列的最长上升子序列的长度是多少。
## 样例

### 样例输入 #1
```
3
0 0 2
```
### 样例输出 #1
```
1
1
2
```
## 提示

$100\%$ 的数据 $n\le10^5$。


---

---
title: "[SHOI2014] 三叉神经树"
layout: "post"
diff: 省选/NOI-
pid: P4332
tag: ['模拟', '2014', '线段树', '各省省选', '上海', 'O2优化', '分治', '树链剖分', '动态树 LCT']
---
# [SHOI2014] 三叉神经树
## 题目描述

计算神经学作为新兴的交叉学科近些年来一直是学术界的热点。一种叫做 SHOI 的神经组织因为其和近日发现的化合物 SHTSC 的密切联系引起了人们的极大关注。

SHOI 组织由若干个 SHOI 细胞构成，SHOI 细胞之间形成严密的树形结构。每个 SHOI 细胞都有且只有一个输出端,被称为轴突,除了一个特殊的、被称为根细胞的 SHOI 细胞的输出作为整个组织的输出以外,其余细胞的轴突均连向其上级 SHOI 细胞；并且有且只有三个接收端,被称为树突,从其下级细胞或者其它神经组织那里接收信息。SHOI 细胞的信号机制较为简单,仅有 $0$和 $1$ 两种。每个 SHOI 细胞根据三个输入端中 $0$和 $1$ 信号的多寡输出较多的那一种。

现在给出了一段 SHOI 组织的信息，以及外部神经组织的输入变化情况。请你模拟 SHOI 组织的输出结果。
## 输入格式

输入的第一行包含一个整数 $n$。表示 SHOI 组织的总细胞个数。SHOI 细胞由 $1\sim n$ 编号,编号为 $1$ 的是根细胞。

从第二行开始的 $n$ 行,每行三个整数 $x_1, x_2, x_3$，分别表示编号为 $1\sim n$ 的 SHOI 细胞的树突连接。$1 < x_i \leq n$ 表示连向编号为 $x_i$ 的细胞的轴突, $n < x_i \leq 3n+1$ 表示连向编号为 $x_i$ 的外界输入。输入数据保证给出的 SHOI 组织是合法的，且所有的 $x_i$ 两两不同。

接下来一行包含 $2n+1$ 个整数（$0$ 或者 $1$），表示初始时的外界输入。

第 $n+3$ 行有一个整数 $q$，表示总操作数。

之后 $q$ 行，每行一个整数 $x$，表示编号为 $x$ 的外界输入发生了变化。
## 输出格式

输出共 $q$ 行，每行一个整数，对应第 $i$ 次外界输入变化后的根细胞的输出。
## 样例

### 样例输入 #1
```
3
2 3 4
5 6 7
8 9 10
0 0 0 0 1 1 1
5
4
4
5
6
8

```
### 样例输出 #1
```
1
0
0
1
1

```
## 提示

- 对于 $10 \%$ 的数据，满足 $1\le n \leq 10^3$，$ 1\le q \leq 10^3$。
- 对于 $30 \%$ 的数据，满足 $1\le n \leq 10^5$，$ 1\le q \leq 10^5$。
- 对于 $100 \%$ 的数据，满足 $1\le n \leq 5\times 10^5$，$ 1\le q \leq 5\times 10^5$。


---

---
title: "[JSOI2010] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P4333
tag: ['2010', '各省省选', '江苏']
---
# [JSOI2010] 游戏
## 题目描述

JSOI 集训队的小 L，小 H，小 X 在紧张的训练之余，总是喜欢玩一个称之为“取数”的游戏来调节自己：

这是一个人玩的游戏，仅仅需要一张白纸和一支笔。玩家在纸上随机写下一行共 $n$ 个整数，形成一个数列，就可以开始游戏了。

每次玩家从原数列最左端或最右端选择一个数，将它从原数列中划去，并写在下一行。当原数列的数全部被划去后，在第二行就出现了一个新的长度为 $n$ 的数列，记为 $S$。将按照如下方式计算数列 $S$ 的分数 $P$：

$$P=S_1\times 5^0+S_2\times 5^1+\cdots+S_n\times 5^{n-1}$$

算出分数 $P$ 后，将其转为二进制表示，如果末三位数字是  $011$ 的话，玩家就取得了游戏的胜利，否则就失败了。

在玩了很多次这个游戏后，小 L，小 H，小 X 发现一个重要的事实：对于某些随机写下的数列，是无论如何也无法取得游戏胜利的，这样的数列被称为“刁列”，其它的数列则被
称为“良列”。

这个游戏虽然趣味性极强，但有一个弊端：每次游戏前需要花很多时间来写出这个随机数列，这一点一直深深困扰着小 L，小 H 和小 X。

直到在今年省选前的那天晚上，小 L 想出了一个惊为天人的创意，一举攻克了这个难题：他们先在纸上画出一颗庞大的无根树（共 $m$ 个结点），每个结点上写下一个整数。当想要玩游戏时，玩家只需随便选择两个结点，通过找出连接这两个结点的那条唯一的路径，将路径上所有结点（包括两个端点）上标注的整数按路径的顺序列出来，就得到了一个数列，然后就可以在这个数列上玩游戏了。如果选择的两个端点分别是树上结点 $v_i$ 和结点 $v_j$，得到的数列就简记为 $i\sim j$。当然，如前所述，$i\sim j$ 这个数列也有“良列”和“刁列”两种可能。

他们发现这样改进以后真的方便了很多！不仅如此，还给游戏带来了一些新的趣味。比如小 X 就声称他发现了一个重要的规律：数列的属性是具有传递性的，即：对于任意互不相同的 $i,j,k$ 有：

- 如果 $i\sim j$ 是良列，$j\sim k$ 是良列，则 $i\sim k$ 是良列。

- 如果 $i\sim j$ 是刁列或 $j\sim k$ 是刁列，则 $i\sim k$ 是刁列。

这个结论出奇地优美，但很快就被小 H 找到了反例，这让小 X 心情沮丧。小 L 为了安慰小 X，说：不如我们来看看你这个结论在多少情况下是成立的吧。

小 X 振作了起来，大家一起投入了繁重的工作中。他们要找出存在多少个三元组 $(i,j,k)$，其中 $i<j<k$，使得 $i,j,k$ 满足小 X 发现的传递性结论。

## 输入格式

第一行一个整数 $m$，代表无根树的节点个数。

接下来 $m$ 行，每行两个整数 $f_i,x_i$，其中 $f_i<i$。$f_i$ 表示节点 $v_i$ 的父节点编号，如果 $f_i=0$ 则该节点为根，$x_i$ 表示节点 $v_i$ 上写的数。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3
0 3
1 5
1 7
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
5
0 8626
1 29255
2 21486
2 26193
1 22439
```
### 样例输出 #2
```
7
```
## 提示

### 数据范围

对于 $10\%$ 的数据，$1\leq m\leq 5$。

对于 $30\%$ 的数据，$1\leq m\leq 100$。

对于 $50\%$ 的数据，$1\leq m\leq 10^3$。

对于 $100\%$ 的数据，$1\leq m\leq 10^5$。


---

---
title: "[SHOI2016] 黑暗前的幻想乡"
layout: "post"
diff: 省选/NOI-
pid: P4336
tag: ['2016', '各省省选', '矩阵树定理', '上海', '生成树', '容斥原理']
---
# [SHOI2016] 黑暗前的幻想乡
## 题目背景

四年一度的幻想乡大选开始了，最近幻想乡最大的问题是很多来历不明的妖怪涌入了幻想乡，扰乱了幻想乡昔日的秩序。但是幻想乡的建制派妖怪（人类）博丽灵梦和八云紫等人整日高谈所有妖怪平等，幻想乡多元化等等，对于幻想乡目前面临的种种大问题却给不出合理的解决方案。

风见幽香是幻想乡里少有的意识到了问题严重性的大妖怪。她这次勇敢地站了出来参加幻想乡大选，提出包括在幻想乡边境建墙（并让人类出钱），大力开展基础设施建设挽回失业率等一系列方案，成为了大选年出人意料的黑马并顺利地当上了幻想乡的大统领。
## 题目描述

幽香上台以后，第一项措施就是要修建幻想乡的公路。幻想乡一共有 $n$ 个城市，之前原来没有任何路。幽香向选民承诺要减税，所以她打算只修 $n-1$ 条公路将这些城市连接起来。但是幻想乡有正好 $n-1$ 个建筑公司，每个建筑公司都想在修路的过程中获得一些好处。虽然这些建筑公司在选举前没有给幽香钱，幽香还是打算和他们搞好关系，因为她还指望他们帮她建墙。所以她打算让每个建筑公司都负责一条路来修。

每个建筑公司都告诉了幽香自己有能力负责修建的路是哪些城市之间的。所以幽香打算 $n - 1$ 条能够连接幻想乡所有城市的边，然后每条边都交给一个能够负责该边的建筑公司修建，并且每个建筑公司都恰好修建一条边。

幽香现在想要知道一共有多少种可能的方案呢？两个方案不同当且仅当它们要么修的边的集合不同，要么边的分配方式不同。
## 输入格式

第一行包含一个整数 $n$，表示城市个数。

第 $2$ 到第 $n$ 行，第 $(i + 1)$ 行表示 第 $i$ 个建筑公司可以修建的路的列表：以一个非负整数 $m_i$ 开头，表示其可以修建条路的条数；接下来有 $m_i$ 对整数 $u, v$，每对数表示一条边的两个端点。其中不会出现重复的边，也不会出现自环。
## 输出格式

输出一行一个整数，表示所有可能的方案数对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
4
2 3 2 4 2
5 2 1 3 1 3 2 4 1 4 3
4 2 1 3 2 4 1 4 2
```
### 样例输出 #1
```
17
```
## 提示

#### 数据规模与约定

+ 对于 $20\%$ 的测试点，$n \le 5$。
+ 对于 $50\%$ 的测试点，$n \le 8$。
+ 对于 $60\%$ 的测试点，$n \le 10$。
+ 对于 $100\%$ 的测试点，$2 \leq n \le 17$，$0 \leq m_i \leq \frac{n(n - 1)}{2}$，$1 \leq u, v \leq n$。


---

---
title: "[SHOI2016] 随机序列"
layout: "post"
diff: 省选/NOI-
pid: P4340
tag: ['2016', '线段树', '各省省选', '上海', '逆元']
---
# [SHOI2016] 随机序列
## 题目描述

你的面前有 $n$ 个数排成一行，分别为 $a_1,a_2,...,a_n$ 。你打算在每相邻的两个 $a_i$​​  和 $a_{i+1}$ 间都插入一个加号、减号或者乘号。那么一共有$3^{n-1}$ 种可能的表达式。

你对所有可能的表达式的值的和非常感兴趣。但这毕竟太简单了，所以你还打算支持一个修改操作，可以修改某个 $a_i$ 的值。

你能够编写一个程序对每个修改都输出修改完之后所有可能表达式的和吗？注意，修改是永久的，也就是说每次修改都是在上一次修改的基础上进行，而不是在最初的表达式上进行。
## 输入格式

第一行包含两个正整数 $n$ 和 $Q$，为数的个数和询问的个数。
第二行包含 $n$ 个非负整数，依次表示 $a_1,a_2,...,a_n$。
接下来 $Q$ 行，每行包含两个非负整数 $t$ 和 $v$，表示要将 $a_t$ 修改为 $v$，其中 $1≤t≤n$。

保证对于 $1≤j≤n$,$1≤i≤Q$，都有 $aj,vi≤10^4$

## 输出格式

输出 $Q$ 行。对于每个修改输出一行，包含一个整数，表示修改之后所有可能表达式的和，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
5 5
9384 887 2778 6916 7794
2 8336
5 493
3 1422
1 28
4 60
```
### 样例输出 #1
```
890543652
252923708
942282590
228728040
608998099
```
## 提示

对于20%的数据，n,q<=20

对于50%的数据，n,q<=1000

对于100%的数据，n,q<=100000

- 2023.11.17 添加一组 hack 数据。


---

---
title: "[SHOI2015] 超能粒子炮·改"
layout: "post"
diff: 省选/NOI-
pid: P4345
tag: ['数学', '2015', '各省省选', '上海', 'Lucas 定理']
---
# [SHOI2015] 超能粒子炮·改
## 题目描述

曾经发明了脑洞治疗仪与超能粒子炮的发明家 SHTSC 又公开了他的新发明：超能粒子炮・改——一种可以发射威力更加强大的粒子流的神秘装置。

超能粒子炮・改相比超能粒子炮，在威力上有了本质的提升。它有两个参数 $n,k$ ，它会向每个编号为 $0$ 到 $k$ （包含两端）的位置 $i$ 发射威力为 $C_{n}^{i} \bmod 2333$ 的粒子流。

现在 SHTSC 给出了他的超能粒子炮・改的参数，让你求出其发射的粒子流的威力之和除以 $2333$ 所得的余数。
## 输入格式

第一行一个整数 $t$ 表示数据组数。

之后 $t$ 行，每行两个整数 $n,k$，含义如题面描述。
## 输出格式

$t$ 行，每行一个整数，表示其粒子流的威力之和模 $2333$ 的值。
## 样例

### 样例输入 #1
```
3
5 5
10 7
1145 14
```
### 样例输出 #1
```
32
968
763
```
## 提示

对于 $10\%$ 的数据，$t = 1,n,k \le 1000$ ；  
对于 $30\%$ 的数据，$t = 1,n,k \le 1000000$ ；  
对于 $50\%$ 的数据，$t = 1,n \le 10^{18},k \le 1000$ ；  
对于 $70\%$ 的数据，$t = 100,n,k \le 10^{18}$ ；  
对于 $100\%$ 的数据，$t = 100000,n,k \le 10^{18}$ .


---

---
title: "[CQOI2016] K 远点对"
layout: "post"
diff: 省选/NOI-
pid: P4357
tag: ['2016', '重庆', '各省省选', 'K-D Tree']
---
# [CQOI2016] K 远点对
## 题目描述

已知平面内 $N$ 个点的坐标，求欧氏距离下的第 $K$ 远点对。

两个点 $P(x_1,y_1)$ 和 $Q(x_2,y_2)$ 的欧氏距离定义为 $\sqrt{(x_1-x_2)^2+(y_1-y_2)^2}$
## 输入格式

输入文件第一行为用空格隔开的两个整数 $N,K$ 。

接下来 $N$ 行，每行两个整数 $X,Y$ ，表示一个点的坐标。
## 输出格式

输出文件第一行为一个整数，表示第 $K$ 远点对的距离的平方（一定是个整数）。
## 样例

### 样例输入 #1
```
10 5
0 0
0 1
1 0
1 1
2 0
2 1
1 2
0 2
3 0
3 1
```
### 样例输出 #1
```
9
```
## 提示

对于 $100\%$ 的测试点，$N \le 100000,1 \le K \le 100,K \le \dfrac {N(N-1)}{2},0 \le X,Y < 2^{31}$


---

---
title: "[CQOI2016] 密钥破解"
layout: "post"
diff: 省选/NOI-
pid: P4358
tag: ['2016', '重庆', '各省省选', '递归', '素数判断,质数,筛法', '逆元']
---
# [CQOI2016] 密钥破解
## 题目描述

一种非对称加密算法的密钥生成过程如下：

1.任选两个不同的质数$p,q$

2.计算$N=p \times q$，$r=(p-1)(q-1)$

3.选取小于$r$，且与$r$互质的整数$e$

4.计算整数$d$，使得$ed≡1(mod r)$

5.二元组$(N,e)$称为公钥，二元组$(N,d)$称为私钥。

当需要加密消息$n$时，（假设$n$是一个小于$N$的整数，因为任何格式的消息都可转为整数表示），使用公钥$(N,e)$，按照

$$n^e≡c(mod N)$$

运算，可得到密文$c$

对密文$c$解密时，用私钥$(N,d)$，按照

$$c^d≡n(mod N)$$

运算，可得到原文 $n$。算法正确性证明省略。

由于用公钥加密的密文仅能用对应的私钥解密，而不能用公钥解密，因此称为非对称加密算法。通常情况下，公钥由消息的接收方公开，而私钥由消息的接收方自己持有。这样任何发送消息的人都可以用公钥对消息加密，而只有消息的接收方自己能够解密消息。

现在，你的任务是寻找一种可行的方法来破解这种加密算法，即根据公钥破解出私钥，并据此解密密文。
## 输入格式

输入文件内容只有一行，为空格分隔的三个正整数$e,N,c$。
## 输出格式

输出文件内容只有一行，为空格分隔的两个整数$d,n$。
## 样例

### 样例输入 #1
```
3 187 45
```
### 样例输出 #1
```
107 12
```
## 提示

对于$30\%$的数据，$e,N,c \le 2^{20}$；

对于$100\%$的数据，$e,N,c \le 2^{62},c<N$


---

---
title: "[CQOI2016] 伪光滑数"
layout: "post"
diff: 省选/NOI-
pid: P4359
tag: ['搜索', '2016', '重庆', '各省省选', '可并堆', '素数判断,质数,筛法']
---
# [CQOI2016] 伪光滑数
## 题目描述

若一个大于 $1$ 的整数 $M$ 的质因数分解有 $k$ 项，其最大的质因子为 $a_k$ ，并且满足 $a_{k}^{k} \le N$，$a_k < 128$，我们就称整数 $M$ 为 $N$ - 伪光滑数。

现在给出 $N$，求所有整数中，第 $K$ 大的 $N$ - 伪光滑数。

### 题意澄清

设 $M = 36 = 2^2 \times 3^2$，则其对应的 $k = 4$，也就是说，对 $M$ 运用唯一分解定理，$M = \prod_{i=1}^n{p_i^{c_i}}$，$k = \sum_{i=1}^n{c_i}$。

第 $K$ 大为字面意思，是真的从大到小第 $K$ 个。

modified by expect2004 2020-11-25，这或许是他退役前对洛谷公共题库的最后一次贡献
## 输入格式

只有一行，为用空格隔开的整数 $N$ 和 $K$ 。
## 输出格式

只有一行，为一个整数，表示答案。
## 样例

### 样例输入 #1
```
12345 20
```
### 样例输出 #1
```
9167
```
## 提示

对于 $30\%$ 的数据，$N \le 10^6$；  
对于 $100\%$ 的数据，$2 \le N \le 10^{18},1 \le K \le 800000$。保证至少有 $K$ 个满足要求的数。


---

---
title: "[九省联考 2018] 一双木棋 chess"
layout: "post"
diff: 省选/NOI-
pid: P4363
tag: ['搜索', '2018', '各省省选', '状压 DP']
---
# [九省联考 2018] 一双木棋 chess
## 题目描述

菲菲和牛牛在一块 $n$ 行 $m$ 列的棋盘上下棋，菲菲执黑棋先手，牛牛执白棋后手。

棋局开始时，棋盘上没有任何棋子，两人轮流在格子上落子，直到填满棋盘时结束。  

落子的规则是：一个格子可以落子当且仅当这个格子内没有棋子且这个格子的左侧及上方的所有格子内都有棋子。

棋盘的每个格子上，都写有两个非负整数，从上到下第 $i$ 行中从左到右第 $j$ 列的格子上的两个整数记作 $a_{i,j}$ 和 $b_{i,j}$。

在游戏结束后，菲菲和牛牛会分别计算自己的得分：菲菲的得分是所有有黑棋的格子上的 $a_{i,j}$ 之和，牛牛的得分是所有有白棋的格子上的 $b_{i,j}$ 的和。

菲菲和牛牛都希望，自己的得分减去对方的得分得到的结果最大。现在他们想知道，在给定的棋盘上，如果双方都采用最优策略且知道对方会采用最优策略，那么，最终的结果如何？

## 输入格式

第一行有两个整数，分别表示棋盘的行数 $n$ 和列数 $m$。  
第 $2$ 到第 $(n + 1)$ 行，每行 $m$ 个整数，第 $(i + 1)$ 行的第 $j$ 个整数表示 $a_{i, j}$。  
第 $(n + 2)$ 到第 $(2n + 1)$ 行，每行 $m$ 个整数，第 $(n + i + 1)$ 行的第 $j$ 个整数表示 $b_{i, j}$。
## 输出格式

输出一行一个整数，表示菲菲的得分减去牛牛的得分的结果。
## 样例

### 样例输入 #1
```
2 3
2 7 3
9 1 2
3 7 2
2 3 1

```
### 样例输出 #1
```
2
```
## 提示

### 样例 1 说明

![](https://cdn.luogu.com.cn/upload/pic/16877.png)

棋盘如图所示，双方都采用最优策略时，棋局如下：

- 菲菲下在第 $1$ 行第 $1$ 列（这是第一步时唯一可以落子的格子）。
- 牛牛下在第 $1$ 行第 $2$ 列。
- 菲菲下在第 $2$ 行第 $1$ 列。
- 牛牛下在第 $1$ 行第 $3$ 列。
- 菲菲下在第 $2$ 行第 $2$ 列。
- 牛牛下在第 $2$ 行第 $3$ 列（这是这一步时唯一可以落子的格子）。
- 填满棋盘，游戏结束。

盘面如下：

![](https://cdn.luogu.com.cn/upload/pic/16878.png)

菲菲的得分为 $2 + 9 + 1 = 12$，牛牛的得分为 $7 + 2 + 1 = 10$。

### 数据规模与约定

各测试点信息如下表。

![](https://cdn.luogu.com.cn/upload/pic/16879.png)

- 对于编号为奇数的测试点，保证 $b_{i, j} = 0$。
- 对于全部的测试点，保证 $1 \leq n, m \leq 10$，$0 \leq a_{i, j}, b_{i, j} \leq 10^5$。



---

---
title: "[AHOI2013] 作业"
layout: "post"
diff: 省选/NOI-
pid: P4396
tag: ['2013', '莫队', '各省省选', '树状数组', '安徽', '分块']
---
# [AHOI2013] 作业
## 题目描述

此时己是凌晨两点，刚刚做了 Codeforces 的小 A 掏出了英语试卷。英语作业其实不算多，一个小时刚好可以做完。然后是一个小时可以做完的数学作业，接下来是分别都是一个小时可以做完的化学，物理，语文……小 A 压力巨大。

这时小 A 碰见了一道非常恶心的数学题，给定了一个长度为 $n$ 的数列和若干个询问，每个询问是关于数列的区间表示数列的第 $l$ 个数到第 $r$ 个数)，首先你要统计该区间内大于等于 $a$，小于等于 $b$ 的数的个数，其次是所有大于等于 $a$，小于等于 $b$ 的，且在该区间中出现过的数值的个数。

小 A 望着那数万的数据规模几乎绝望，只能向大神您求救，请您帮帮他吧。
## 输入格式

第一行两个整数 $n,m$

接下来 $n$ 个不超过 $10^5$ 的正整数表示数列

接下来 $m$ 行，每行四个整数 $l,r,a,b$，具体含义参见题意。

## 输出格式

输出 $m$ 行，分别对应每个询问，输出两个数，分别为在 $l$ 到 $r$ 这段区间中大小在 $[a,b]$ 中的数的个数，以及大于等于 $a$，小于等于 $b$ 的，且在该区间中出现过的数值的个数（具体可以参考样例）。

## 样例

### 样例输入 #1
```
3 4
1 2 2
1 2 1 3
1 2 1 1
1 3 1 3
2 3 2 3
```
### 样例输出 #1
```
2 2
1 1
3 2
2 1
```
## 提示

$N\leq 100000,M\leq 100000$，读入的数字均为 $[1,10^5]$ 内的正整数。


---

---
title: "[JSOI2008] Blue Mary的旅行"
layout: "post"
diff: 省选/NOI-
pid: P4400
tag: ['2008', '各省省选', '江苏']
---
# [JSOI2008] Blue Mary的旅行
## 题目描述

在一段时间之后，网络公司终于有了一定的知名度，也开始收到一些订单，其中最大的一宗来自 B 市。

Blue Mary 决定亲自去签下这份订单。为了节省旅行经费，他的某个金融顾问建议只购买 U 航空公司的机票。 U 航空公司的所有航班每天都只有一班，并且都是上午出发当天下午到达的，所以他们每人每天只能坐一班飞机。

经过调查，他们得到了 U 航空公司经营的所有航班的详细信息，这包括每一航班的出发地，目的地以及最多能买到的某一天出发的票数。(注意: 对于一个确定的航班，无论是哪一天，他们最多能买到的那一天出发的票数都是相同的）。

Blue Mary 注意到他们一定可以只乘坐 U 航空公司的航班就从 A 市到达 B 市，但是，由于每一航班能买到的票的数量的限制，他们所有人可能不能在同一天到达 B 市。

所以现在 Blue Mary 需要你的帮助，设计一个旅行方案使得最后到达B市的人的到达时间最早。
## 输入格式

第一行包含 $3$ 个正整数 $N$，$M$ 和 $T$。  
题目中会出现的所有城市分别编号为 $1,2,\dots,N$，其中城市 A 编号一定为 $1$，城市 B 编号一定为 $N$。  
U 公司一共有 $M$ 条（单向）航班。而连 Blue Mary 在内，公司一共有 $T$ 个人要从 A 市前往 B 市。

以下 $M$ 行，每行包含3个正整数 $x,y,z,$ 表示 U 公司的每一条航班的出发地，目的地以及 Blue Mary 最多能够买到的这一航班某一天出发的票数。(即：无论是哪一天，Blue Mary 最多只能买到 $z$ 张 U 航空公司的从城市 $x$ 出发到城市 $y$ 的机票)。

输入保证从一个城市到另一个城市的单向航班最多只有一个。
## 输出格式

仅有一行，包含一个正整数，表示最后到达 B 市的人的最早到达时间。假设他们第一次乘飞机的那一天是第一天。
## 样例

### 样例输入 #1
```
3 3 5
1 2 1
2 3 5
3 1 4

```
### 样例输出 #1
```
6

```
## 提示

对于 $100\%$ 的数据，$2\le N\le 50,1\le M\le 2450,1\le T,z\le 50,1\le x,y\le N,x\neq y$。


---

---
title: "[JSOI2010] 缓存交换"
layout: "post"
diff: 省选/NOI-
pid: P4404
tag: ['贪心', '2010', '各省省选', '离散化', '江苏', '优先队列']
---
# [JSOI2010] 缓存交换
## 题目背景

感谢@ACdreamer 贡献数据
## 题目描述

在计算机中，CPU只能和高速缓存Cache直接交换数据。当所需的内存单元不在Cache中时，则需要从主存里把数据调入Cache。此时，如果Cache容量已满，则必须先从中删除一个。 

例如，当前Cache容量为3，且已经有编号为10和20的主存单元。 
此时，CPU访问编号为10的主存单元，Cache命中。 

接着，CPU访问编号为21的主存单元，那么只需将该主存单元移入Cache中，造成一次缺失（Cache Miss）。 

接着，CPU访问编号为31的主存单元，则必须从Cache中换出一块，才能将编号为31的主存单元移入Cache，假设我们移出了编号为10的主存单元。 

接着，CPU再次访问编号为10的主存单元，则又引起了一次缺失。我们看到，如果在上一次删除时，删除其他的单元，则可以避免本次访问的缺失。 

在现代计算机中，往往采用LRU(最近最少使用)的算法来进行Cache调度——可是，从上一个例子就能看出，这并不是最优的算法。 
对于一个固定容量的空Cache和连续的若干主存访问请求，聪聪想知道如何在每次Cache缺失时换出正确的主存单元，以达到最少的Cache缺失次数。
## 输入格式

输入文件第一行包含两个整数N和M(1<=M<=N<=100,000)，分别代表了主存访问的次数和Cache的容量。 

第二行包含了N个空格分开的正整数，按访问请求先后顺序给出了每个主存块的编号(不超过1,000,000,000)。
## 输出格式

输出一行，为Cache缺失次数的最小值。
## 样例

### 样例输入 #1
```
6 2
1 2 3 1 2 3
```
### 样例输出 #1
```
4
```
## 提示

在第4次缺失时将3号单元换出Cache。 


---

---
title: "[ZJOI2009] 硬币游戏"
layout: "post"
diff: 省选/NOI-
pid: P4405
tag: ['2009', '各省省选', '浙江']
---
# [ZJOI2009] 硬币游戏
## 题目描述

Orez很喜欢玩游戏，他最近发明了一款硬币游戏。他在桌子的边缘上划分出2*n个位置并按顺时针把它们标号为1，2，……，2n，然后把n个硬币放在标号为奇数的位置上。

接下来每次按如下操作：在任意两个硬币之间放上一个硬币，然后将原来的硬币拿走；所放硬币的正反面由它两边的两个硬币决定，若两个硬币均为正面朝上或反面朝上，则所放硬币为正面朝上，否则为反面朝上。 那么操作T次之后桌子边缘上硬币的情况会是怎样的呢？
## 输入格式

文件的第一行包含两个整数n和T。

 接下的一行包含n个整数，表示最开始桌面边缘的硬币摆放情况，第i个整数ai表示第i个硬币摆放在2*i-1个位置上，ai=1表示正面朝上，ai=2表示反面朝上。

## 输出格式

文件仅包含一行，为2n个整数，其中第i个整数bi桌面边缘的第i个位置上硬币的情况，bi=1表示正面朝上，bi=2表示反面朝上，bi=0表示没有硬币。

## 样例

### 样例输入 #1
```
10 5
2 2 2 1 1 1 1 1 1 2
```
### 样例输出 #1
```
0 1 0 1 0 1 0 1 0 2 0 1 0 2 0 1 0 1 0 1
```
## 提示

30%的数据 n≤1000 T≤1000

100%的数据 n≤100000 T≤2^60

样例解释
```
20202010101010101020
01010201010101010201
10102020101010102020
01020102010101020102
20202020201010202020
01010101020102010101
```


---

---
title: "[CQOI2005] 三角形面积并"
layout: "post"
diff: 省选/NOI-
pid: P4406
tag: ['2005', '重庆', '各省省选', '枚举', '排序']
---
# [CQOI2005] 三角形面积并
## 题目描述

给出 $n$ 个三角形，求它们并的面积。
## 输入格式

第一行为 $n(n \leq 100)$， 即三角形的个数。

以下 $n$ 行，每行 $6$ 个实数 $x_1$, $y_1$, $x_2$, $y_2$, $x_3$, $y_3$，代表三角形的顶点坐标。坐标均为不超过 $10^6$ 的实数，输入数据保留 $1$ 位小数。
## 输出格式

输出并的面积 $u$, 保留两位小数。

## 样例

### 样例输入 #1
```
2
0.0 0.0 2.0 0.0 1.0 1.0
1.0 0.0 3.0 0.0 2.0 1.0
```
### 样例输出 #1
```
1.75
```


---

---
title: "[HNOI2009] 无归岛"
layout: "post"
diff: 省选/NOI-
pid: P4410
tag: ['动态规划 DP', '2009', '各省省选', '湖南', '仙人掌']
---
# [HNOI2009] 无归岛
## 题目描述

Neverland 是个神奇的地方，它由一些岛屿环形排列组成，每个岛上都生活着之中与众不同的物种。

但是这些物种都有一个共同的生活习性：对于同一个岛上的任意两个生物，他们有且仅有一个公共朋友，即对同一岛上的任意两个生物 a 和 b 有且仅有一个生物 c 既是 a 的朋友也是 b 的朋友，当然某些岛上也可能会只有一个生物孤单地生活着。

这一习性有一个明显的好处，当两个生物发生矛盾的时候，他们可以请那个唯一的公共朋友来裁决谁对谁错。 另外，岛与岛之间也有交流，具体来说，每个岛都会挑选出一个最聪明的生物做代表，然后这个生物与他相邻的两个岛的代表成为朋友。 

不幸运的是，A 世界准备入侵 Neverland，作为 Neverland 的守护者，Lostmonkey 想知道在一种比较坏的情况下 Neverland 的战斗力。因为和朋友并肩作战，能力会得到提升，所以 Lostmonkey 想知道在不选出一对朋友的情况下Neverland的最大战斗力。即选出一些生物，且没有一对生物是朋友，并且要求它们的战斗力之和最大。
## 输入格式

第一行包含用空格隔开的两个整数 $n$ 和 $m$，分别表示 Neverland 的生物种数和朋友对数。

接下来的 $m$ 行描述所有朋友对，具体来说，每行包含用空格隔开的两个整数 $a$ 和 $b$，表示生物 $a$ 和生物 $b$ 是朋友（每对朋友只出现一次）。第 $m+2$ 行包含用空格隔开的 $n$ 个整数，其中第 $i$ 个整数表示生物 $i$ 的战斗力 $A_i$。
## 输出格式

仅包含一个整数，表示满足条件的最大战斗力。
## 样例

### 样例输入 #1
```
6 7
1 2
2 3
3 4
4 1
3 6
3 5
5 6
20 10 30 15 20 10
```
### 样例输出 #1
```
50
```
## 提示

**【样例说明】**

有四个岛，生物 $1$ 在 $1$ 号岛，生物 $2$ 在 $2$ 号岛，生物 $3$、$5$、$6$ 在 $3$ 号岛，生物 $4$ 在 $4$ 号岛。

输入数据保证 $4≤n≤100000$，$1 \le a,b \le n$，$1 \le m \le 200000$，$-1000 \le A_i \le 1000$。


---

---
title: "[SHOI2004] 最小生成树"
layout: "post"
diff: 省选/NOI-
pid: P4412
tag: ['2004', '各省省选', '上海']
---
# [SHOI2004] 最小生成树
## 题目描述


给定一个筒单图 $G=\langle V.E.W\rangle$，$V$ 为顶点集合，$E$ 为边的集合（无重边，即任意两个顶点之间至多只有一条边)，$W$ 为定义在 $E$ 上的权函数（值为整数)。给出其上的一棵生成树 $T$，现在要求用最小的代价修改 $W$，使得 $T$ 是 $G$ 上的一棵最小生成树（一个图可以有多棵最小生成树，只要 $T$ 的边权和最小即可)。对于任意一条边 $e \in E$ 修改方法为：

- 增加 $e$ 的权值，即令 $W'(e)=W(e)+\Delta(e)$，则修改该边的代价为 $\Delta(e)$
- 减小 $e$ 的权值，即令 $W'(e)=W(e)-\Delta(e)$，则修改该边的代价为 $\Delta(e)$
- 不改变 $e$ 的权，即 $W'(e)=W(e)$，修改代价为 $\Delta(e)=0$。

请注意：修改后的权函数 $W'$ 的值域也为整数。

总的修改代价记为 $S=\sum\limits_{e \in E} \Delta(e)$。
## 输入格式

第一行为 $N,M$，其中 $N$ 表示顶点的数目，$M$ 表示边的数目。顶点的编号为 $1,2,3,\cdots,N-1,N$。

接下来的 $M$ 行，每行三个整数 $U_i,V_i,W_i$，表示顶点 $U_i$ 与 $V_i$ 之间有一条边，其权值为 $W_i$。

所有的边在输入中会且仅会出现一次。再接着 $N-1$ 行，每行两个整数 $X_i,Y_i$，表示顶点 $X_i$ 与 $Y_i$ 之间的边是 $T$ 的一条边。
## 输出格式

输出最小的 $S$。
## 样例

### 样例输入 #1
```
6 9
1 2 2
1 3 2
2 3 3
3 4 3
1 5 1
2 6 3
4 5 4
4 6 7
5 6 6
1 3
2 3
3 4
4 5
4 6
```
### 样例输出 #1
```
8

```
## 提示

边 $(4,6)$ 的权由 $7$ 修改为 $3$，代价为 $4$；  
边 $(1,2)$ 的权由 $2$ 修改为 $3$，代价为 $1$；  
边 $(1,5)$ 的权由 $1$ 修改为 $4$，代价为 $3$；  

所以总代价为 $4+1+3=8$。

$1 \le N \le 50,1 \le M \le 1500,1 \le W_i \le 1000$。


---

---
title: "[BJOI2018] 二进制"
layout: "post"
diff: 省选/NOI-
pid: P4428
tag: ['2018', '线段树', '各省省选', '树状数组', '北京', 'O2优化', '构造']
---
# [BJOI2018] 二进制
## 题目描述

pupil 发现对于一个十进制数，无论怎么将其的数字重新排列，均不影响其是不是$3$ 的倍数。他想研究对于二进制，是否也有类似的性质。

于是他生成了一个长为$n$ 的二进制串，希望你对于这个二进制串的一个子区间，能求出其有多少位置不同的连续子串，满足在重新排列后（可包含前导$0$）是一个$3$ 的倍数。

两个位置不同的子区间指开始位置不同或结束位置不同。

由于他想尝试尽量多的情况，他有时会修改串中的一个位置，并且会进行多次询问。
## 输入格式

输入第一行包含一个正整数$n$，表示二进制数的长度。

之后一行$n$ 个空格隔开的整数，保证均是$0$ 或$1$，表示该二进制串。

之后一行一个整数$m$ ，表示询问和修改的总次数。

之后m 行每行为```1 i```，表示pupil 修改了串的第$i$ 个位置（$0$ 变成$1$ 或$1$ 变成$0$ ），或```2 l r```，表示pupil 询问的子区间是$[l,r]$。

串的下标从$1$ 开始。
## 输出格式

对于每次询问，输出一行一个整数表示对应该询问的结果。
## 样例

### 样例输入 #1
```
4
1 0 1 0
3
2 1 3
1 3
2 3 4
```
### 样例输出 #1
```
2
3
```
## 提示

###样例解释

对于第一个询问，区间$[2,2]$ 只有数字$0$，是$3$ 的倍数，区间$[1,3]$ 可以重排成$011_{(2)} = 3_{(10)}$，是$3$ 的倍数，其他区间均不能重排成$3$ 的倍数。

对于第二个询问，全部三个区间均能重排成$3$ 的倍数（注意$00$ 也是合法的）。

###数据范围

对于$20\%$ 的数据，$1 \leq n,m \leq 100$。

对于$50\%$ 的数据，$1 \leq n,m \leq 5000$。

对于$100\%$ 的数据，$1 \leq n,m \leq 100000$，$l \leq r$。



---

---
title: "[HNOI/AHOI2018] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P4436
tag: ['2018', '各省省选', '安徽', '湖南', '枚举', '剪枝', '强连通分量', '栈']
---
# [HNOI/AHOI2018] 游戏
## 题目描述

一次小G和小H在玩寻宝游戏，有 $n$ 个房间排成一列，编号为 $1,2,\cdots,n$ ，相邻的房间之间都有一道门。其中一部分门上锁（因此需要有对应的钥匙才能开门），其余的门都能直接打开。现在小G告诉了小H每把锁的钥匙在哪个房间里（**每把锁有且只有一把钥匙与之对应**），并作出 $p$ 次指示：第 $i$ 次让小H从第 $S_i$ 个房间出发到 $T_i$ 个房间里。但是小G有时会故意在指令中放入死路，而小H也不想浪费多余的体力去尝试，于是想事先调查清楚每次的指令是否会存在一条通路。

你是否能为小H作出解答呢？
## 输入格式

第一行三个数字： $n,m,p$ ，代表有 $n$ 个房间， $m$ 道门上了锁，以及 $p$ 个询问。接下来$m$行，每行两个数字 $x,y$ 代表 $x$ 到 $x+1$ 的钥匙在房间 $y$ 。接下来 $p$ 行，其中第$i$行是两个整数 $S_i$，$T_i$，代表一次询问
## 输出格式

输出 $p$ 行，每行一个`YES`或`NO`，分别代表能或不能到达。
## 样例

### 样例输入 #1
```
5 4 5 
1 3
2 2 
3 1
4 4
2 5
3 5
4 5 
2 1
3 1
```
### 样例输出 #1
```
YES
NO
YES
YES
NO
```
### 样例输入 #2
```
7 5 4
2 2
3 3 
4 2 
5 3 
6 6
2 1
3 4
3 7
4 5
```
### 样例输出 #2
```
YES
YES
NO
NO
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/17503.png)

$1\le n,p\le 10^6$ ， $0\le m <n$ ， $1\le x,y,S_i,T_i<n$ 保证 $x$ 不重复


---

---
title: "[HNOI/AHOI2018] 排列"
layout: "post"
diff: 省选/NOI-
pid: P4437
tag: ['贪心', '2018', '各省省选', '安徽', '湖南']
---
# [HNOI/AHOI2018] 排列
## 题目描述

给定 $n$ 个整数 $a_1, a_2, \dots, a_n, 0 \le a_i \le n$，以及 $n$ 个整数 $w_1, w_2, \dots, w_n$。称 $a_1, a_2, \dots, a_n$的 一个排列 $a_{p[1]}, a_{p[2]}, \dots, a_{p[n]}$为 $a_1, a_2, \dots, a_n$的一个合法排列，当且仅当该排列满足：对于任意 的 $k$ 和任意的 $j$，如果 $j \le k$，那么 $a_{p[j]}$不等于 $p[k]$。（换句话说就是：对于任意的 $k$ 和任意的 $j$，如果 $p[k]$等于 $a_{p[j]}$，那么 $k<j$。）定义这个合法排列的权值为 $w_{p[1]} + 2w_{p[2]} + \dots + nw_{p[n]}$。

你 需要求出在所有合法排列中的最大权值。如果不存在合法排列，输出 $-1$ 。 

样例解释中给出了合法排列和非法排列的实例。
## 输入格式

第一行一个整数 $n$。 

接下来一行 $n$ 个整数，表示$a_1, a_2, \dots, a_n$ 。 接下来一行 $n$ 个整数，表示 $w_1, w_2, \dots, w_n$ 。
## 输出格式

输出一个整数表示答案。
## 样例

### 样例输入 #1
```
3 
0 1 1 
5 7 3 
```
### 样例输出 #1
```
32
```
### 样例输入 #2
```
3 
2 3 1 
1 2 3 
```
### 样例输出 #2
```
-1
```
### 样例输入 #3
```
10 
6 6 10 1 7 0 0 1 7 7 
16 3 10 20 5 14 17 17 16 13 
```
### 样例输出 #3
```
809
```
## 提示


【样例解释 1】
 
对于 $a_1=0,a_2=1,a_3=1$，其排列有 

$a_1=0,a_2=1,a_3=1$，是合法排列，排列的权值是 $1*5+2*7+3*3=28$；

$a_2=1,a_1=0,a_3=$1，是非法排列，因为 $a_{p[1]}$等于 $p[2]$；

$a_1=0,a_3=1,a_2=$1，是合法排列，排列的权值是 $1*5+2*3+3*7=32$；

$a_3=1,a_1=0,a_2=1$，是非法排列，因为 $a_{p[1]}$等于 $p[2]$；

$a_2=1,a_3=1,a_1=0$，是非法排列，因为 $a_{p[1]}$等于 $p[3]$；

$a_3=1,a_2=1,a_1=0$，是非法排列，因为 $a_{p[1]}$等于 $p[3]$。

因此该题输出最大权值 $32$。 

【样例解释 2】 

对于 $a_1=2,a_2=3,a_3=1$，其排列有：  

$a_1=2,a_2=3,a_3=1$，是非法排列，因为 $a_{p[1]}$等于 $p[2]$；

$a_2=3,a_1=2,a_3=1$，是非法排列，因为 $a_{p[1]}$等于 $p[3]$； 

$a_1=2,a_3=1,a_2=3$ ，是非法排列，因为 $a_{p[1]}$等于 $p[3]$；  

$a_3=1,a_1=2,a_2=3$ ，是非法排列，因为 $a_{p[2]}$等于 $p[3]$； 

$a_2=3,a_3=1,a_1=2$ ，是非法排列，因为 $a_{p[2]}$等于 $p[3]$； 

$a_3=1,a_2=3,a_1=2$ ，是非法排列，因为 $a_{p[1]}$等于 $p[3]$

因此该题没有合法排列。 

【数据范围】 

对于前 $20\%$ 的数据，$1 \le n \le 10$。

对于前 $40\%$ 的数据，$1 \le n  \le  15$。

对于前 $60\%$ 的数据，$1 \le n  \le 1000$。  

对于前 $80\%$ 的数据，$1 \le n  \le 10^5$。  

对于 $100\%$ 的数据，$1 \le n  \le  5\times10^5$，$0  \le  a_i  \le  n$，$1  \le  w_i  \le  10^9 $，所有$w_i$的和不超过 $1.5×10^{13}$。


---

---
title: "[CQOI2018] 社交网络"
layout: "post"
diff: 省选/NOI-
pid: P4455
tag: ['2018', '重庆', '各省省选', '生成树', '向量', '构造']
---
# [CQOI2018] 社交网络
## 题目背景

当今社会，在社交网络上看朋友的消息已经成为许多人生活的一部分。通常，一个用户在社交网络上发布一条消息后，他的好友们也可以看见这条消息，并可能转发。转发的消息还可以继续被人转发，进而扩散到整个社交网络中。
## 题目描述

在一个实验性的小规模社交网络中我们发现，有时一条热门消息最终会被所有人转发。为了研究这一现象发生的过程，我们希望计算一条消息所有可能的转发途径有多少种。为了编程方便，我们将初始消息发送者编号为 $1$，其他用户编号依次递增。

该社交网络上的所有好友关系是已知的，也就是说对于 $a, b$ 两个用户，我们知道 $a$ 用户可以看到 $b$ 用户发送的消息。注意可能存在单向的好友关系，即 $a$ 能看到 $b$ 的消息，但 $b$ 不能看到 $a$ 的消息。

还有一个假设是，如果某用户看到他的多个好友转发了同一条消息，他只会选择从其中一个转发，最多转发一次消息。从不同好友的转发，被视为不同的情况。

如果用箭头表示好友关系，下图展示了某个社交网络中消息转发的所有可能情况。（初始消息是用户 $1$ 发送的，加粗箭头表示一次消息转发）

![](https://cdn.luogu.com.cn/upload/pic/17549.png)
![](https://cdn.luogu.com.cn/upload/pic/17550.png)
![](https://cdn.luogu.com.cn/upload/pic/17551.png)
![](https://cdn.luogu.com.cn/upload/pic/17552.png)
![](https://cdn.luogu.com.cn/upload/pic/17553.png)
![](https://cdn.luogu.com.cn/upload/pic/17554.png)

答案对 $10^4 + 7$ 取模。
## 输入格式

第一行有一个整数，表示用户的数量 $n$。  
第二行有一个整数，表示好友关系数目 $m$。  
接下来 $m$ 行，每行两个整数 $a, b$，表示一组好友关系，即用户 $a$ 可以看到用户 $b$ 发送的信息。
## 输出格式

输出一行一个整数表示答案对 $10^4 + 7$ 取模的结果。
## 样例

### 样例输入 #1
```
4
7
2 1
3 1
1 3
2 3
3 2
4 3
4 2

```
### 样例输出 #1
```
6
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n \leq 10$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 250$，$1 \leq m \leq n \times (n - 1)$，$1 \leq a, b \leq n$。


---

---
title: "[CQOI2018] 解锁屏幕"
layout: "post"
diff: 省选/NOI-
pid: P4460
tag: ['2018', '重庆', '各省省选', '广度优先搜索 BFS', '状压 DP']
---
# [CQOI2018] 解锁屏幕
## 题目背景

使用过 Android 手机的同学一定对手势解锁屏幕不陌生。 Android 的解锁屏幕由 $3 \times 3$ 个点组成，手指在屏幕上画一条线，将其中一些点连接起来，即可构成一个解锁图案。如下面三个例子所示：

![](https://cdn.luogu.com.cn/upload/pic/17556.png)
![](https://cdn.luogu.com.cn/upload/pic/17557.png)
![](https://cdn.luogu.com.cn/upload/pic/17558.png)
## 题目描述

画线时还需要遵循一些规则：
1. 连接的点数不能少于 $4$ 个。也就是说只连接两个点或者三个点会提示错误。
2. 两个点之间的联线不能弯曲。
3. 每个点只能“使用”一次，不可重复。这里的“使用”是指手指划过一个点，该点变绿。
4. 两个点之间的连线不能“跨过”另一个点，除非那个点之前已经被“使用”过。

对于最后一条规则，参见下图的解释。左边两幅图违反了该规则；而右边两幅图（分别为 $ 2 \rightarrow 4 \rightarrow 1 \rightarrow 3 \rightarrow 6$ 和 $ 6 \rightarrow 5 \rightarrow 4 \rightarrow 1 \rightarrow 9 \rightarrow 2$ ）则没有违反规则，因为在“跨过”点时，点已经被使用过了。

![](https://cdn.luogu.com.cn/upload/pic/17566.png)

现在工程师希望改进解锁屏幕，增减点的数目，并移动点的位置，不再是一个九宫格形状，但保持上述画线规则不变。

请计算新的解锁屏幕上，一共有多少满足规则的画线方案。
## 输入格式

输入第一行为一个整数 $n$ ，表示点的数目。

接下来 $n$ 行，每行两个空格分开的整数 $x_i$ 和 $y_i$ ，表示每个点的坐标。
## 输出格式

输出共一行，为题目所求方案数除以 $10^8+7$ 的余数。
## 样例

### 样例输入 #1
```
4
0 0
1 1
2 2
3 3
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
4
0 0
0 1
0 2
1 0
```
### 样例输出 #2
```
18
```
## 提示

#### 样例解释 1

设 $4$ 个点编号为 $1$ 到 $4$ ，方案有 $1 \rightarrow 2 \rightarrow 3 \rightarrow 4$ ， $2 \rightarrow 1 \rightarrow 3 \rightarrow 4$ ，  $3 \rightarrow 2 \rightarrow 1 \rightarrow 4$ ，  $2 \rightarrow 3 \rightarrow 1 \rightarrow 4$ 以及它们的镜像。

### 数据范围

- 对于 $30\%$ 的数据，$1 \le n \le 10$。
- 对于 $100\%$ 的数据，$-1000 \le x_i ,y_i \le 1000$，$ 1 \le n < 20$。各点坐标不相同。


---

---
title: "[CQOI2018] 九连环"
layout: "post"
diff: 省选/NOI-
pid: P4461
tag: ['搜索', '2018', '重庆', '各省省选', '快速傅里叶变换 FFT']
---
# [CQOI2018] 九连环
## 题目背景

九连环是一种源于中国的传统智力游戏。如图所示，九个的圆环套在一把“剑”上，并且互相牵连。游戏的目标是把九个圆环全部从“剑”上卸下。

![](https://cdn.luogu.com.cn/upload/pic/17568.png)
## 题目描述

圆环的装卸需要遵守两个规则:

1. 第一个(最右边) 环任何时候都可以任意装上或卸下

2. 如果第k 个环没有被卸下，且第k 个环右边的所有环都被卸下，则第k+1个环(第k 个环左边相邻的环) 可以任意装上或卸下

与魔方的千变万化不同，解九连环的最优策略是唯一的。为简单起见，我们以“四连环”为例，演示这一过程。这里用1表示环在“剑”上，0 表示环已经卸下。

初始状态为1111,每步的操作如下:

1. 1101 (根据规则2,卸下第2 个环)

2. 1100 (根据规则1,卸下第1 个环)

3. 0100 (根据规则2,卸下第4 个环)

4. 0101 (根据规则1,装上第1 个环)

5. 0111 (根据规则2,装上第2 个环)

6. 0110 (根据规则1,卸下第1 个环)

7. 0010 (根据规则2,卸下第3 个环)

8. 0011 (根据规则1,装上第1 个环)

9. 0001 (根据规则2,卸下第2 个环)

10. 0000 (根据规则1,卸下第1 个环)

由此可见，卸下“四连环”至少需要10 步。随着环数增加，需要的步数也会随之增多。例如卸下九连环，就至少需要341步。

请你计算，有n 个环的情况下，按照规则，  全部卸下至少需要多少步。
## 输入格式

输入文件第一行，为一个整数m，表示测试点数目。

接下来m行，每行一个整数n。
## 输出格式

输出文件共m行，对应每个测试点的计算结果。
## 样例

### 样例输入 #1
```
3
3
5
9
```
### 样例输出 #1
```
5
21
341
```
## 提示

对于10%的数据，$1≤n≤10$

对于30%的数据，$1≤n≤30$

对于100%的数据，$1≤n≤10^5,1≤m≤10$


---

---
title: "[SCOI2007] k短路"
layout: "post"
diff: 省选/NOI-
pid: P4467
tag: ['字符串', '2007', '四川', '各省省选', '排序', '最短路', 'A*  算法']
---
# [SCOI2007] k短路
## 题目描述

有 $n$ 个城市和 $m$ 条单向道路，城市编号为 $1$ 到 $n$。每条道路连接两个不同的城市，且任意两条道路要么起点不同要么终点不同，因此 $n$ 和 $m$ 满足$m \le n(n-1)$。

给定两个城市 $a$ 和 $b$，可以给 $a$ 到 $b$ 的所有简单路（所有城市最多经过一次，包括起点和终点）排序：先按长度从小到大排序，长度相同时按照字典序从小到大排序。你的任务是求出 $a$ 到 $b$ 的第 $k$ 短路。

## 输入格式

输入第一行包含五个正整数 $n,m,k,a,b$。

以下 $m$ 行每行三个整数 $u,v,l$，表示从城市 $u$ 到城市 $v$ 有一条长度为 $l$ 的单向道路。
## 输出格式

如果 $a$ 到 $b$ 的简单路不足 $k$ 条，输出 `No`，否则输出第 $k$ 短路：从城市 $a$ 开始依次输出每个到达的城市，直到城市 $b$，中间用减号 `-` 分割。
## 样例

### 样例输入 #1
```
5 20 10 1 5
1 2 1
1 3 2
1 4 1
1 5 3
2 1 1
2 3 1
2 4 2
2 5 2
3 1 1
3 2 2
3 4 1
3 5 1
4 1 1
4 2 1
4 3 1
4 5 2
5 1 1
5 2 1
5 3 1
5 4 1
```
### 样例输出 #1
```
1-2-4-3-5
```
### 样例输入 #2
```
4 6 1 1 4
2 4 2
1 3 2
1 2 1
1 4 3
2 3 1
3 4 1
```
### 样例输出 #2
```
1-2-3-4
```
### 样例输入 #3
```
3 3 5 1 3
1 2 1
2 3 1
1 3 1
```
### 样例输出 #3
```
No
```
## 提示

第一个例子有 $5$ 个城市，所有可能出现的道路均存在。从城市 $1$ 到城市 $5$ 一共有 $5$ 条简单路，排序如下：

![](https://cdn.luogu.com.cn/upload/pic/17706.png)

- $20\%$ 的数据满足：$n\leq 5$；
- $40\%$ 的数据满足：$n\leq 30$；
- $100\%$ 的数据满足：$2\leq n\leq 50$，$1\leq k\leq 200$，$1\le l\le 10^4$。


---

---
title: "[HAOI2018] 染色"
layout: "post"
diff: 省选/NOI-
pid: P4491
tag: ['2018', '河南', '各省省选', 'O2优化', '容斥原理', '生成函数', '快速数论变换 NTT']
---
# [HAOI2018] 染色
## 题目背景

HAOI2018 Round2 第二题
## 题目描述

为了报答小 C 的苹果，小 G 打算送给热爱美术的小 C 一块画布，这块画布可以抽象为一个长度为 $N$ 的序列，每个位置都可以被染成 $M$ 种颜色中的某一种。

然而小 C 只关心序列的 $N$ 个位置中出现次数恰好为 $S$ 的颜色种数，如果恰好出现了 $S$ 次的颜色有 $K$ 种，则小 C 会产生 $W_k$ 的愉悦度。

小 C 希望知道对于所有可能的染色方案，他能获得的愉悦度的和对 $1004535809$
取模的结果是多少。
## 输入格式

从标准输入读入数据。第一行三个整数 $N, M, S$。

接下来一行 $M + 1$ 个整数，第 $i$ 个数表示 $W_{i-1}$。
## 输出格式

输出到标准输出中。输出一个整数表示答案。
## 样例

### 样例输入 #1
```
8 8 3
3999 8477 9694 8454 3308 8961 3018 2255 4910
```
### 样例输出 #1
```
524070430
```
### 样例输入 #2
```
见 sample.zip/data2.in
```
### 样例输出 #2
```
见 sample.zip/data2.ans
```
## 提示

特殊性质: $\forall 1 \le i \le m, W_i = 0$。

对于 $100\%$ 的数据，满足 $1 \le N \le 10 ^ 7$，$1 \le M \le 10 ^ 5$，$1 \le S \le 150$，$0 \le W_i < 1004535809$。

![Data](https://cdn.luogu.com.cn/upload/pic/18057.png)



---

---
title: "[HAOI2018] 苹果树"
layout: "post"
diff: 省选/NOI-
pid: P4492
tag: ['2018', '河南', '各省省选', 'O2优化', '树形 DP', '双连通分量', '概率论']
---
# [HAOI2018] 苹果树
## 题目背景

HAOI2018 Round2 第一题
## 题目描述

小 C 在自己家的花园里种了一棵苹果树, 树上每个结点都有恰好两个分支. 经过细心的观察, 小 C 发现每一天这棵树都会生长出一个新的结点.

第一天的时候, 果树会长出一个根结点, 以后每一天, 果树会随机选择一个当前树中没有长出过结点 的分支, 然后在这个分支上长出一个新结点, 新结点与分支所属的结点之间连接上一条边.

小 C 定义一棵果树的不便度为树上两两结点之间的距离之和, 两个结点之间 的距离定义为从一个点走到另一个点的路径经过的边数.

现在他非常好奇, 如果 $N$ 天之后小 G 来他家摘苹果, 这个不便度的期望 $E$ 是多少. 但是小 C 讨厌分数, 所以他只想知道 $E \times N !$ 对 $P$ 取模的结果, 可以证明这是一个整数.
## 输入格式

从标准输入中读入数据. 一行两个整数 $N$, $P$ .
## 输出格式

输出到标准输出中. 输出一个整数表示答案．
## 样例

### 样例输入 #1
```
3 610745795
```
### 样例输出 #1
```
24
```
### 样例输入 #2
```
305 1000000007
```
### 样例输出 #2
```
865018107
```
## 提示

![Explanation](https://cdn.luogu.com.cn/upload/pic/18067.png)

以上是所有 $N = 3$ 时可能的苹果树形态, 其中编号表示这个结点是第几天生
长出来的, 显然每种情况两两结点的距离均为 $4$ .

### 数据范围与约定
| 测试点编号   | $N$  | $P$  |
| :--------: | :--: | :--: |
| $1$ |  $\le 10$    |  $\le 10^9 + 7$    |
| $2$ |  $\le 10$    |   $\le 10^9 + 7$    |
| $3$ |  $\le 500$    |  $\le 10^9 + 7$     |
| $4$ |  $\le 500$    |   $\le 10^9 + 7$    |
| $5$ |  $\le 500$    |   $\le 10^9 + 7$    |
| $6$ |  $\le 2000$    |   $= 10^9 + 7$    |
| $7$ |  $\le 2000$    |   $= 10^9 + 7$    |
| $8$ |  $\le 2000$    |   $\le 10^9 + 7$    |
| $9$ |  $\le 2000$    |   $\le 10^9 + 7$    |
| $10$ | $\le 2000$     |    $\le 10^9 + 7$   |




---

---
title: "[HAOI2018] 反色游戏"
layout: "post"
diff: 省选/NOI-
pid: P4494
tag: ['2018', '河南', '各省省选', 'O2优化']
---
# [HAOI2018] 反色游戏
## 题目描述

小$C$和小$G$经常在一起研究搏弈论问题，有一天他们想到了这样一个游戏．
有一个$n$个点$m$条边的无向图，初始时每个节点有一个颜色，要么是黑色，要
么是白色．现在他们对于每条边做出一次抉择：要么将这条边连接的两个节点都
反色（黑变白，白变黑），要么不作处理．他们想把所有节点都变为白色，他们
想知道在$2^m$种决策中，有多少种方案能达成这个目标．
小$G$认为这个问题太水了，于是他还想知道，对于第$i$个点，在删去这个点及
与它相连的边后，新的答案是多少．
由于答案可能很大，你只需要输出答案对$10^9+7$取模后的结果．
## 输入格式

从文件$game.in$中读入数据.
第一行一个整数$T$，表示数据组数．
每组数据第一行两个整数$n$,$m$表示点数和边数.
接下来$m$行，每行两个整数$u$,$v$,描述无向图的一条边．
接下来一行一个长度为$n$的$0/1$串，如果第$i$个字符为$0$表示第$i$个点为白色，否
则为黑色．
## 输出格式

输出到文件$game.out$中.
每组数据输出一行$n+1$个整数，第一个整数表示不删去任何点时的答案．接
下来$n$个整数，第$i$个表示删去第$i$个点时的答案．
## 样例

### 样例输入 #1
```
2
5 5
1 2
2 3
3 4
2 4
3 5
00000
5 4
1 2
2 3
2 4
2 5
11111
```
### 样例输出 #1
```
2 2 1 1 1 2
0 1 0 1 1 1
```
## 提示

对于所有数据，有$1\le T\le5$,$1\le n,m\le10^5$,$1\le u,v\le n$，没有重边和自
环．
![](https://cdn.luogu.com.cn/upload/pic/18145.png)
HAOI2018 round1 T2


---

---
title: "[HAOI2018] 奇怪的背包"
layout: "post"
diff: 省选/NOI-
pid: P4495
tag: ['动态规划 DP', '2018', '河南', '各省省选', 'O2优化', '枚举']
---
# [HAOI2018] 奇怪的背包
## 题目描述

小 C 非常擅长背包问题，他有一个奇怪的背包，这个背包有一个参数 $P$ ，当他向这个背包内放入若干个物品后，背包的重量是物品总体积对 $P$ 取模后的结果。

现在小 C 有 $n$ 种体积不同的物品，第 $i$ 种占用体积为 $V_i$ ，每种物品都有无限个。他会进行 $q$ 次询问，每次询问给出重量 $w_i$ ，你需要回答有多少种放入物品的方案，能将一个初始为空的背包的重量变为 $w_i$。注意，两种方案被认为是不同的，当且仅当放入物品的种类不同，而与每种物品放入的个数无关．不难发现总的方案数为 $2^n$。

由于答案可能很大，你只需要输出答案对 $10^9 + 7$ 取模的结果。
## 输入格式

第一行三个整数 $n, q, P$，含义见问题描述。

接下来一行 $n$ 个整数表示 $V_i$。

接下来一行 $q$ 个整数表示 $w_i$。
## 输出格式

输出 $q$ 行，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3 6
1 3 4
5 2 3
```
### 样例输出 #1
```
5
6
6
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/18144.png)
HAOI2018 round1 T1


---

---
title: "[ZJOI2018] 胖"
layout: "post"
diff: 省选/NOI-
pid: P4501
tag: ['2018', '线段树', '二分', '各省省选', '浙江', 'ST 表']
---
# [ZJOI2018] 胖
## 题目背景

Cedyks 是九条可怜的好朋友（可能这场比赛公开以后就不是了），也是这题的主人公。
## 题目描述

Cedyks 是一个富有的男孩子。他住在著名的 The Place（宫殿）中。

Cedyks 是一个努力的男孩子。他每天都做着不一样的题来锻炼他的 The Salt（灵魂）。

这天，他打算在他的宫殿外围修筑一道城墙，城墙上有 $n$ 座瞭望塔。你可以把城墙看做一条线段，瞭望塔是线段上的 $n$ 个点，其中 $1$ 和 $n$ 分别为城墙的两个端点。其中第 $i$ 座瞭望塔和第 $i + 1$ 座瞭望塔的距离为 $w_i$，他们之间的道路是双向的。

城墙很快就修建好了，现在 Cedyks 开始计划修筑他的宫殿到城墙的道路。因为这题的题目名称，Cedyks 打算用他的宫殿到每一个瞭望塔的最短道路之和来衡量一个修建计划。

现在 Cedyks 手上有 $m$ 个设计方案，第 $k$ 个设计方案会在宫殿和瞭望塔之间修建 $T_k$ 条双向道路，第 $i$ 条道路连接着瞭望塔 $a_i$，长度为 $l_i$。

计算到每一个瞭望塔的最短路之和是一个繁重的工程，本来 Cedyks 想用广为流传的 SPFA 算法来求解，但是因为他的 butter（缓冲区）实在是太小了，他只能转而用原始的贝尔福特曼算法来计算，算法的流程大概如下：

1. 定义宫殿是 $0$ 号点，第 $i$ 个瞭望塔是 $i$ 号点，双向边 $(u_i, v_i, l_i)$ 为一条连接 $u_i$ 和 $v_i$ 的双向道路。令 $d$ 为距离数组，最开始 $d_0 = 0, d_i = 10^{18}(i ∈ [1, n])$。
2. 令辅助数组 $c = d$。依次对于每一条边 $(u_i, v_i,w_i)$ 进行增广，$c_{u_i} = \min(c_{u_i} , d_{v_i} + w_i)$，$c_{v_i} = \min(c_{v_i} , d_{u_i} + w_i)$。
3. 令 $t$ 为 $c$ 和 $d$ 中不一样的位置个数，即令 $S = \{i|c_i≠d_i\}$，则 $t = |S|$。若 $t = 0$，说明 $d$ 就是最终的最短路，算法结束。否则令 $d = c$，回到第二步。

因为需要计算的设计方案实在是太多了，所以 Cedyks 雇佣了一些人来帮他进行计算。为了避免这些人用捏造出来的数据偷懒，他定义一个设计方案的校验值为在这个方案上运行贝尔福特曼算法每一次进入第三步 $t$ 的和。他会让好几个雇佣来的人计算同样的设计方案，并比对每一个人给出的校验值。

你是 Cedyks 雇佣来的苦力之一，聪明的你发现在这个情形下计算最短路的长度的和是一件非常简单的事情。但是寄人篱下不得不低头，你不得不再计算出每一个方案的校验值来交差。
## 输入格式

第一行输入两个整数 $n,m$，表示瞭望塔个数和设计方案个数。

接下来一行 $n - 1$ 个数 $w_i$，表示瞭望塔 $i$ 和 $i + 1$ 之间道路的长度。

接下来 $m$ 行，每行描述一个设计方案。第一个整数 $K$ 表示设计方案中的道路数量，接下来 $K$ 个数对 $(a_i, l_i)$ 为一条宫殿到瞭望塔的边。
## 输出格式

对于每一个设计方案，输出一行一个整数表示校验值。
## 样例

### 样例输入 #1
```
5 5
2 3 1 4
1 2 2
2 1 1 4 10
3 1 1 3 1 5 1
3 1 10 2 100 5 1
5 1 1 2 1 3 1 4 1 5 1
```
### 样例输出 #1
```
5
8
5
8
5
```
## 提示

### 样例解释

对于第一个设计方案，每一个阶段 $d$ 的变化为：

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,10^{18},2,10^{18},10^{18},10^{18}] \rightarrow$ $[0,4,2,5,10^{18},10^{18}] \rightarrow [0,4,2,5,6,10^{18}] \rightarrow [0,4,2,5,6,10]$。

因此校验值为 $1+2+1+1=5$。

对于第二个设计方案，每一个阶段 $d$ 的变化为：

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,1,10^{18},10^{18},10,10^{18}] \rightarrow$ $[0,1,3,11,10,14] \rightarrow [0,1,3,6,10,14] \rightarrow [0,1,3,6,7,14] \rightarrow [0,1,3,6,7,11]$。

因此校验值为 $2+3+1+1+1=8$。

对于第三个设计方案，每一个阶段 $d$ 的变化为：

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,1,10^{18},1,10^{18},1] \rightarrow [0,1,3,1,2,1]$。

因此校验值为 $3+1+1=5$。

对于第四个设计方案，每一个阶段 $d$ 的变化为：

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,10,100,10^{18},10^{18},1] \rightarrow$ $[0,10,12,103,5,1] \rightarrow [0,10,12,6,5,1] \rightarrow [0,10,9,5,1]$。

因此校验值为 $3+3+1+1=8$。

对于第五个设计方案，每一个阶段 $d$ 的变化为：

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,1,1,1,1,1]$

因此校验值为 $5$。

### 数据范围

测试点|$n$|$m$|$K$|其他约定
-|-|-|-|-
1,2|$\le 1000$|$\le 1000$|$\le 100$|无
3,4|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$\le 100$|无
5,6|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$1 \le w_i,l_i \le 50$
7,8,9,10|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$\le 2 \times 10^5$|无


对于 $100\%$ 的数据，保证每个设计方案 $a_i$ 两两不同且 $1\le a_i\le n$。  
对于 $100\%$ 的数据，保证 $1\le w_i,l_i\le 10^9,1\le\sum K\le 2\times 10^5$。

感谢 @Xeonacid 提供题面


---

---
title: "[JSOI2018] 潜入行动"
layout: "post"
diff: 省选/NOI-
pid: P4516
tag: ['2018', '各省省选', '江苏', '背包 DP']
---
# [JSOI2018] 潜入行动
## 题目描述

外星人又双叒叕要攻打地球了，外星母舰已经向地球航行！这一次，``JYY`` 已经联系好了黄金舰队，打算联合所有 ``JSOIer`` 抵御外星人的进攻。

在黄金舰队就位之前，``JYY`` 打算事先了解外星人的进攻计划。现在，携带了监听设备的特工已经秘密潜入了外星人的母舰，准备对外星人的通信实施监听。

外星人的母舰可以看成是一棵 $n$ 个节点、 $n-1$ 条边的**无向树**，树上的节点用 $1,2,\cdots,n$ 编号。``JYY`` 的特工已经装备了隐形模块，可以在外星人母舰中不受限制地活动，可以神不知鬼不觉地在节点上安装监听设备。

如果在节点 $u$ 上安装监听设备，则 ``JYY`` 能够监听与 $u$ **直接相邻**所有的节点的通信。换言之，如果在节点 $u$ 安装监听设备，则对于树中每一条边 $(u,v)$ ，节点 $v$ 都会被监听。特别注意**放置在节点 $u$ 的监听设备并不监听 $u$ 本身的通信**，这是 ``JYY`` 特别为了防止外星人察觉部署的战术。

``JYY`` 的特工一共携带了 $k$ 个监听设备，现在 ``JYY`` 想知道，有多少种不同的放置监听设备的方法，能够使得母舰上**所有节点**的通信都被监听？为了避免浪费，**每个节点至多只能安装一个监听设备，且监听设备必须被用完**。

## 输入格式

输入第一行包含两个整数 $n,k$ ，表示母舰节点的数量 $n$ 和监听设备的数量 $k$ 。
接下来 $n-1$ 行，每行两个整数 $u,v$ $(1\le u,v\le n)$，表示树中的一条边。
## 输出格式

输出一行，表示满足条件的方案数。因为答案可能很大，你只需要输出答案 $\text{mod 1,000,000,007}$ 的余数即可。
## 样例

### 样例输入 #1
```
5 3
1 2
2 3
3 4
4 5
```
### 样例输出 #1
```
1
```
## 提示

**样例 1 解释**

样例数据是一条链 $1-2-3-4-5$ 。首先，节点 $2$ 和 $4$ 必须放置监听设备，否则 $1,5$ 将无法被监听（放置的监听设备无法监听它所在的节点）。剩下一个设备必须放置在 $3$ 号节点以同时监听 $2,4$ 。因此在 $2,3,4$ 节点放置监听设备是唯一合法的方案。

**数据范围**

存在 $10\%$ 的数据，$1 \le n \le 20$ ；

存在另外 $10\%$ 的数据，$1 \le n \le 100$ ；

存在另外 $10\%$ 的数据，$1 \le k \le 10$ ；

存在另外 $10\%$ 的数据，输入的树保证是一条链；

对于所有数据，$1\le n\le 10^5$​ ，$1\le k\le \min\{n,100\}$ 。


---

---
title: "[SCOI2003] 切割多边形"
layout: "post"
diff: 省选/NOI-
pid: P4529
tag: ['2003', '四川', '各省省选', 'Special Judge']
---
# [SCOI2003] 切割多边形
## 题目描述

我们希望通过切割得到一个凸 $p$ 边形，$p\le 8$。

一开始的时候，你有一个 $n\times m$ 的矩形，即它的四角的坐标分别为 $(0,0), (0,m), (n,0), (n,m)$。每次，你可以选择一条直线把当前图形切割成两部分，保留其中一个部分（另一部分扔掉），切割线的长度为此直线在多边形内部的部分的长度。

求出最短的切割线总长度。

下面是一个例子，我们需要得到中间的多边形。

![](https://cdn.luogu.com.cn/upload/pic/18468.png)

分别沿着直线 $1,2,3,4$ 进行切割即可，得到中间的四边形。
## 输入格式

第一行有两个整数 $n,m\ (0 < n,m < 500)$。

第二行为一个整数 $p(3\le p\le 8)$，以下 $p$ 行每行为两个整数 $x, y(0 < x < n, 0 < y < m)$，为按顺时针给出的各顶点坐标。

数据保证多边形的是凸的，无三点共线，输入数据无错误。
## 输出格式

仅一行，为最短切割线的总长度，四舍五入到小数点后 $3$ 位。允许有 $0.001$ 的误差。
## 样例

### 样例输入 #1
```
100 100
4
80 80
70 30
20 20
20 80
```
### 样例输出 #1
```
312.575
```
## 提示

样例对应于图中给出的例子。


---

---
title: "[HNOI2006] 军机调度"
layout: "post"
diff: 省选/NOI-
pid: P4540
tag: ['2006', '各省省选', '湖南', '枚举', '排序', '位运算']
---
# [HNOI2006] 军机调度
## 题目描述

凯萨拥有一支由n个人组成的雇佣军，他们靠在威尼斯商行接任务过活。

这支军队的成份比较复杂，不同的人往往具有不同的技能，有的人还拥有多项技能。

威尼斯商行的任务也参差不齐，有的需要几个人合作完成，有的只需要一个人独立完成：有的很简单，不需要耗多少时间，因此报酬也较低，有的很有难度，需要多个人长期合作完成，因此报酬就高。完成这些任务的时间不会超过一个月。并且，一个人不能同时执行两项任务，也不能中途加入或者退出任务。但可以不执行任何任务。

一项只需要n个人来完成的任务，如果执行该任务的人数p大于n,那么反而会得到更少的报酬，即原报酬的1/(p-n+1)。

凯萨是一位英明的领袖，他往往在每个月的月底召开军事会议，总结上个月的成果，发给大家报酬，并指派下个月的任务。

请问，凯萨应该怎样指派任务，才能使总报酬最高？总报酬为多少？
## 输入格式

一行包含两个正整数n,m。彼此用空格隔开，

其中n〈10表示雇佣军的人数，m〈15表示下个月可选的任务数。

接下来的n行中第i行（对应文件的第i+1行）的第一个整数小于等于表示编号为i的雇佣军可执行的任务数

后面的整数是编号为i的雇佣军可以执行的所有任务的编号，这些整数之间用空格隔开。

最后的m行中，每行有四个整数b、e、p和r，彼此之间用空格隔开，

其中第j行（对应整个文件的第n+j+1行）是编号为j的任务的描述：

0<b<32表示该任务的开始日（这一天会被计入任务所需的时间中），

0<e<32表示该任务的结束日（这一天也会被计入任务所需的时间中），

p<10表示该任务所需人数，0<r<100000表示该任务的报酬。
## 输出格式

第一行只有一个整数t,表示最多可获得的总报酬
## 样例

### 样例输入 #1
```
3 5
2 1 4
2 2 4
3 3 4 5
2 20 1 100 
1 18 1 200 
3 28 1 800 
21 30 3 1500 
19 21 1 400 
```
### 样例输出 #1
```
1800
```


---

---
title: "[ZJOI2011] 细胞"
layout: "post"
diff: 省选/NOI-
pid: P4541
tag: ['2011', '各省省选', '递归', '浙江', '进制', '斐波那契数列']
---
# [ZJOI2011] 细胞
## 题目描述

2222年，人类在银河系外的某颗星球上发现了生命，并且携带了一个细胞回到了地球。经过反复研究，人类已经完全掌握了这类细胞的发展规律：

这种细胞最初的形态是“长条形”，一端是头，一端是尾，中间是躯干。细胞内部含有一列密码（你可以认为它是这种细胞的DNA）。密码是一个长度为n的数字串，且仅含有1~9这9种数字，沿着细胞的躯干从头到尾排列着。

首先，细胞会经历一次分裂。细胞将沿躯干方向分裂成若干个球体，躯干将退化成丝状物，连接着相邻的球体。在分裂过程中，质量是均匀分布的。换句话说，若分裂成k个球体，每个球体的质量为原来的1/k。然而，密码的分布是不确定的。若分割成k个球体，密码会被切割成k段（每段长度至少为1），并按从头到尾的顺序分布在各个球体中。如图，为其中一种合法的一次分裂：

![](https://cdn.luogu.com.cn/upload/pic/18508.png)

接下来，细胞会经历二次分裂。对于每个球体，其中会含有一小段密码（注意他是有序的），我们把它看作一个十进制的数T。这个球体会被分割成T个小球体，并排成一排，之间用躯干退化成的丝状物相连接，并且质量仍然是均匀分布的，每个小球体的质量都是原球体的1/T。至此，密码已经发挥了它的作用，便消失了。如图，为二次分裂：

![](https://cdn.luogu.com.cn/upload/pic/18509.png)

最后，细胞会进行变异。相邻小球体之间的丝状物可能会退化掉，这两个小球体便会以相切的方式直接连接。显然，二次分裂后，除两端外的每个小球体都有两段丝状物与其连接（头尾两端的小球体只有一段丝状物与其相连）。对于每个小球体，必须至少退化一段与其相连的丝状物，否则这个结构不稳定，会继续变异。如图，为一种稳定的变异：

![](https://cdn.luogu.com.cn/upload/pic/18510.png)

现在，我们想知道，对于一个给定密码的细胞，总共有多少种稳定的结构。两种结构被认为相同，当且仅当他们拥有相同个数的小球体，从头到尾每个小球体的质量相同，并且从头到尾每对相邻小球体之间的连接方式相同（都是通过丝状物相连或都是通过相切直接相连）。你只需要回答这个结果 mod 1000000007即可。
## 输入格式

第一行为一个正整数n，表示细胞密码的长度。

第二行共n个数字，为给定的细胞密码，中间没有空格。
## 输出格式

只包含一个整数，为细胞的种数 mod 1000000007的结果。
## 样例

### 样例输入 #1
```
1
1
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
1
5
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
2
11
```
### 样例输出 #3
```
56
```
## 提示

对于5%的数据满足，n ≤ 6；

对于25%的数据满足，n ≤ 25；

对于60%的数据满足，n ≤ 100；

对于70%的数据满足，n ≤ 300；

对于100%的数据满足，n ≤ 1 000。


---

---
title: "[JSOI2011] Apple 的美食"
layout: "post"
diff: 省选/NOI-
pid: P4543
tag: ['2011', '各省省选', '江苏']
---
# [JSOI2011] Apple 的美食
## 题目描述

Apple 很喜欢吃巧克力，但它是一头挑剔的猪，有的品种的巧克力并不能满足它的胃口。如果主人给它的巧克力它不喜欢吃，它就会很不开心。主人并不知道，什么样的巧克力 Apple 喜欢吃，但她知道巧克力的可可含量是巧克力
口感的重要因素，因此她决定根据巧克力的可可含量来判断什么样的巧克力拿给 Apple 吃，什么样的巧克力不拿给 Apple 吃。

假设一块巧克力的可可含量有 $1\sim N$ 种不同的计量，则她认为可可含量在 $[a,b]$ 的范围内的巧克力是好吃的
。不过她不知道的这个范围到底是多少，需要你来帮忙确定这个范围，使得她可以让 Apple 吃到最多的喜欢吃的巧克力。

设 $pos_i$ 是可可脂含量为 $i$，且 Apple 认为是好吃的巧克力的数量，$neg_i$ 是可可脂含量为 $i$，且 Apple 认为是不好吃的巧克力的数量。这两个序列由以下方法生成：
$$\begin{cases}pos_i=a_{2i-1}\\neg_i=a_{2i}\end{cases}$$

其中，$a_i=(p_1a_{i-1}+p_2)\bmod M(i>1)$。

设 $TP$ 是 Apple 认为好吃的、且被主人认为是好吃的巧克力数量，$TN$ 是Apple 认为不好吃的、且被主人认为是不好吃的巧克力数量，$FP$ 是 Apple 认为不好吃的、且被主人认为是好吃的巧克力数量，$FN$ 是 Apple 认为好吃的、且被主人认为是不好吃的巧克力数量。

设 $r$ 为被正确判断为好吃的巧克力数占所有好吃的巧克力的比率，$p$ 为被正确判断为好吃的巧克力占所有被判定为好吃的巧克力数的比率，则

$$\begin{cases}r=\frac{TP}{TP+FN}\\p=\frac{TP}{TP+FP}\end{cases}$$

请你帮助 Apple 求出一个范围，使得 $f=\frac{2pr}{p+r}$ 最大。
## 输入格式

输入由若干行组成，每行是一组数据：$N,a_1,p_1,p_2,M$，中间用空格分开。

输入以一个 $0$ 结束，数据组数不超过 $1000$。
## 输出格式

每组数据输出一行，为 $f$ 的最大值（四舍五入保留 $6$ 位小数）。
## 样例

### 样例输入 #1
```
4 4 4 1 5
12 9 6 6 11
0
```
### 样例输出 #1
```
0.800000
0.683938
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq N\leq 10^6,a_1,p_1,p_2<M\leq 20$，保证至少有一块 Apple 认为好吃的巧克力。


---

---
title: "[JSOI2018] 列队"
layout: "post"
diff: 省选/NOI-
pid: P4559
tag: ['2018', '线段树', '各省省选', '递归', '江苏', '可持久化线段树']
---
# [JSOI2018] 列队
## 题目描述

作为一名大学生，九条可怜在去年参加了她人生中的最后一次军训。

军训中的一个重要项目是练习列队，为了训练学生，教官给每一个学生分配了一个休息位置。每次训练开始前，所有学生都在各自的休息位置休息，但是当教官发出集合命令后，被点到的学生必须要到指定位置集合。

为了简化问题，我们把休息位置和集合位置抽象成一根数轴。一共有 $n$ 个学生，第 $i$ 个学生的休息位置是 $a_i$。每一次命令，教官会指定一个区间 $[l,r]$ 和集合点 $K$ ，所有编号在 $[l,r]$ 内的学生都必须赶到集合点列队。在列队时，每一个学生需要选择 $[K,K+r-l]$ 中的一个整数坐标站定且不能有任何两个学生选择的坐标相同。学生从坐标 $x$ 跑到坐标 $y$ 需要耗费体力 $\vert y-x \vert$ 。

在一天的训练中，教官一共发布了 $m$ 条命令 $(l,r,K)$ ，现在你需要计算对于每一条命令，在所有可能的列队方案中，消耗的体力值总和最小是多少。

以下是对题意的一些补充：

1.    任何两条命令是无关的，即在一条集合命令结束后，所有学生都会回到自己的休息位置，然后教官才会发出下一条命令。
    
2.    在集合的时候，可能有编号不在 $[l,r]$ 内的学生处在区间 $[K,K+r-l]$ 中，这时他会自己跑开，且跑动的距离不记在消耗的体力值总和中。


## 输入格式

第一行输入两个整数 $n,m$。

第二行 $n$ 个整数 $a_i$ 表示学生的休息位置。保证学生休息的位置两两不同。

接下来 $m$ 行每行三个整数 $l,r,K$ 表示一条命令。

## 输出格式

对于每一条命令输出一行一个整数表示最小的体力值总和。
## 样例

### 样例输入 #1
```
5 5
1 5 7 6 2
1 5 2
1 5 3
1 3 9
2 4 2
3 5 5
```
### 样例输出 #1
```
5
4
17
9
3
```
## 提示

**样例 1 解释**


在第一条命令中，五名学生依次跑到 $[2,5,4,6,3]$，则总代价为 $|2-1|+|5-5|+|4-7|+|6-6|+|3-2|=5$。
    
在第二条命令中，五名学生依次跑到 $[4,5,7,6,3]$，则总代价为 $|4-1|+|5-5|+|7-7|+|6-6|+|3-2|=4$。
    
在第三条命令中，三名学生依次跑到 $[11,10,9]$，则总代价为 $|11-1|+|10-5|+|9-7|=17$。
    
在第四条命令中，三名学生依次跑到 $[4,2,3]$，则总代价为 $|4-5|+|2-7|+|3-6|=9$。
    
在第五条命令中，三名学生依次跑到 $[7,6,5]$，则总代价为 $|7-7|+|6-6|+|5-2|=3$。

**数据范围**

对于 $10\%$ 的数据，$n,m \leq 10$；

对于 $40\%$ 的数据，$n,m \leq 10^3$；

对于 $70\%$ 的数据，$n,m \leq 10^5$；

对于 $100\%$ 的数据，$n,m \leq 5 \times 10^5,1 \leq a_i,K \leq 10^6$。

对于 $100\%$ 的数据，学生休息的位置两两不同。



---

---
title: "[JXOI2018] 排序问题"
layout: "post"
diff: 省选/NOI-
pid: P4561
tag: ['数学', '贪心', '2018', '各省省选', '期望']
---
# [JXOI2018] 排序问题
## 题目背景

九条可怜是一个热爱思考的女孩子。
## 题目描述



九条可怜最近正在研究各种排序的性质，她发现了一种很有趣的排序方法： Gobo sort ！

Gobo sort 的算法描述大致如下：

- 假设我们要对一个大小为 $n$ 的数列 $a$ 排序。
- 等概率随机生成一个大小为 $n$ 的排列 $p$ 。
- 构造一个大小为 $n$ 的数列 $b$ 满足 $b_i=a_{p_i}$ ，检查 $b$ 是否有序，如果 $b$ 已经有序了就结束算法，并返回 $b$ ，不然返回步骤 2。


显然这个算法的期望时间复杂度是 $O(n\times n!)$ 的，但是九条可怜惊奇的发现，利用量子的神奇性质，在量子系统中，可以把这个算法的时间复杂度优化到线性。

九条可怜对这个排序算法进行了进一步研究，她发现如果一个序列满足一些性质，那么 Gobo sort 会很快计算出正确的结果。为了量化这个速度，她定义 Gobo sort 的执行轮数是步骤 2 的执行次数。

于是她就想到了这么一个问题：

现在有一个长度为 $n$ 的序列 $x$ ，九条可怜会在这个序列后面加入 $m$ 个元素，每个元素是 $[l,r]$ 内的正整数。 她希望新的长度为 $n+m$ 的序列执行 Gobo sort 的期望执行轮数尽量的多。她希望得到这个最多的期望轮数。

九条可怜很聪明，她很快就算出了答案，她希望和你核对一下，由于这个期望轮数实在是太大了，于是她只要求你输出对 $998244353$ 取模的结果。
## 输入格式

第一行输入一个整数 $T$，表示数据组数。

接下来 $2 \times T$ 行描述了 $T$ 组数据。

每组数据分成两行，第 1 行有四个正整数 $n,m,l,r$ ，表示数列的长度和加入数字的个数和加入数字的范围。
第 2 行有 $n$ 个正整数，第 $i$ 个表示 $x_i$ 。
## 输出格式

输出 $T$ 个整数，表示答案。

## 样例

### 样例输入 #1
```
2
3 3 1 2
1 3 4
3 3 5 7
1 3 4
```
### 样例输出 #1
```
180
720

```
## 提示

###样例解释

对于第一组数据，我们可以添加 $\{1,2,2\}$ 到序列的最末尾，使得这个序列变成 `1 3 4 1 2 2` ，那么进行一轮的成功概率是 $\frac{1}{180}$ ，因此期望需要 $180$ 轮。

对于第二组数据，我们可以添加 $\{5,6,7\}$ 到序列的最末尾，使得这个序列变成 `1 3 4 5 6 7` ，那么进行一轮的成功概率是 $\frac{1}{720}$ ，因此期望需要 $720$ 轮。

### 数据范围

对于 30% 的数据， $T\leq 10 , n,m,l,r\leq 8$。  
对于 50% 的数据， $T\leq 300,n,m,l,r,a_i\leq 300$ 。  
对于 60% 的数据， $\sum{r-l+1}\leq 10^7$ 。  
对于 70% 的数据， $\sum{n} \leq 2\times 10^5$ 。  
对于 90% 的数据， $m\leq 2\times 10^5$。  
对于 100% 的数据， $T\leq 10^5,n\leq 2\times 10^5,m\leq 10^7,1\leq l\leq r\leq 10^9$ ， $1\leq a_i\leq 10^9,\sum{n}\leq 2\times 10^6$ 。


---

---
title: "[JXOI2018] 守卫"
layout: "post"
diff: 省选/NOI-
pid: P4563
tag: ['2018', '各省省选']
---
# [JXOI2018] 守卫
## 题目背景

九条可怜是一个热爱运动的女孩子。
## 题目描述

这一天她去爬山，她的父亲为了她的安全，雇了一些保镖，让他们固定地呆在在山的某些位置，来实时监视九条可怜，从而保护她。

具体来说，一座山可以描述为一条折线，折线的下方是岩石。这条折线有 $n$ 个折点，每个折点上有一个亭子，第 $i$ 个折点的坐标是 $(i,h_i)$ 。九条可怜只可能会在亭子处玩耍，那些保镖也只会在亭子处监视可怜。

由于技术方面的原因，一个保镖只能监视所有他能看得到的，横坐标不超过他所在位置的亭子。我们称一个保镖能看到一个亭子 $p$ ，当且仅当他所在的亭子 $q$ 和 $p$ 的连线不经过任何一块岩石。特别地，如果这条连线恰好经过了除了 $p,q$ 以外的亭子，那么我们认为保镖看不到可怜。

雇佣保镖是一件很费钱的事情，可怜的父亲希望保镖越少越好。

可怜的父亲还希望得到详尽的雇佣保镖的方案，他知道有些亭子可能正在维修，他想对所有的 $1\leq l\leq r\leq n$ 计算：如果事先已知了只有区间 $[l,r]$ 的亭子可以用来玩耍（和监视），那么最少需要多少个保镖，才能让 $[l,r]$ 中的每一个亭子都被监视到。

可怜的父亲已经得到了一个结果，他希望和你核实他的结果是否正确。
## 输入格式

第一行输入一个整数 $n$ 表示亭子的数目。

接下来一行 $n$ 个整数，第 $i$ 个整数 $h_i$ 表示第 $i$ 个亭子的坐标是 $(i,h_i)$。
## 输出格式

对所有的 $1\leq l\leq r\leq n$ 计算：如果事先已知了可怜只会在 $[l,r]$ 这个区间的亭子里面玩耍，那么最少需要多少个保镖，才能让 $[l,r]$ 中的每一个亭子都被监视到。由于输出量太大，可怜的父亲只要你输出所有 $[l,r]$ 的答案的异或即可。

## 样例

### 样例输入 #1
```
3
2 3 1
```
### 样例输出 #1
```
3

```
## 提示

### 样例解释

如果 $r-l+1\leq 2$，那么答案显然是 $1$。

如果 $l=1$，$r=n$，那么答案是 $2$，需要安排两个保镖在 $(2,3),(3,1)$ 两个位置监视可怜。

### 数据范围与提示

对于 $30\%$ 的数据，$n\leq 20$。  
对于 $70\%$ 的数据，$n\leq 500$。  
对于 $100\%$ 的数据，$n\leq 5000$，$1\leq h_i\leq 10^9$。


---

---
title: "[AHOI2006] 文本编辑器"
layout: "post"
diff: 省选/NOI-
pid: P4567
tag: ['2006', '各省省选', '平衡树', '安徽']
---
# [AHOI2006] 文本编辑器
## 题目描述

这些日子，可可不和卡卡一起玩了，原来可可正废寝忘食的想做一个简单而高效的文本编辑器。你能帮助他吗？为了明确任务目标，可可对“文本编辑器”做了一个抽象的定义： 

- `Move k`：将光标移动到第 $k$ 个字符之后，如果 $k=0$，将光标移到文本第一个字符之前。
- `Insert n (换行) S`：在光标后插入长度为 $n$ 的字符串 $S$，光标位置不变，$n \ge 1$。
- `Delete n`：删除光标后的 $n$ 个字符，光标位置不变，$n \ge 1$。
- `Rotate n`：反转光标后的 $n$ 个字符，光标位置不变，$n \ge 1$。
- `Get`：输出光标后的一个字符，光标位置不变。
- `Prev`：光标前移一个字符。
- `Next`：光标后移一个字符。


下面是几个定义：

- 文本：由 $0$ 个或多个字符构成的序列。这些字符的 ASCII 码在闭区间 $[32, 126]$ 内，也就是说，这些字符均为可见字符或空格。
- 光标：在一段文本中用于指示位置的标记，可以位于文本的第一个字符之前，文本的最后一个字符之后或文本的某两个相邻字符之间。
- 文本编辑器：为一个可以对一段文本和该文本中的一个光标进行如下七条操作的程序。如果这段文本为空，我们就说这个文本编辑器是空的。 

编写一个程序：
1. 建立一个空的文本编辑器。
2. 从输入文件中读入一些操作指令并执行。
3. 对所有执行过的 `GET` 操作，将指定的内容写入输出文件。
## 输入格式

输入文件中第一行是指令条数 $N$，以下是需要执行的 $N$ 个操作。除了回车符之外，输入文件的所有字符的 ASCII 码都在闭区间 $[32, 126]$ 内。且行尾没有空格。
## 输出格式

依次对应输入文件中每条 `GET` 指令的输出，不得有任何多余的字符。
## 样例

### 样例输入 #1
```
10
Insert 13
Balanced eert
Move 2
Delete 5
Next
Insert 7
 editor
Move 0
Get
Move 11
Rotate 4
Get
```
### 样例输出 #1
```
B
t
```
## 提示

对输入数据我们有如下假定：
1. `MOVE` 操作不超过 $5\times 10^4$ 个，`INSERT`, `DELETE` 和 `ROTATE` 操作作的总个数不超过 $6\times 10^3$，`GET` 操作不超过 $2\times 10^4$ 个，`PREV` 和 `NEXT` 操作的总个数不超过 $2\times 10^4$。
2.  所有 `INSERT` 插入的字符数之和不超过 $2M$（$1M=2^{20}$)。
3. `DELETE` 操作、`ROTATE` 操作和 `GET` 操作执行时光标后必然有足够的字符。`MOVE`、`PREV`、`NEXT` 操作不会把光标移动到非法位置。
4. 输入文件没有错误。


---

---
title: "[JSOI2013] 哈利波特与死亡圣器"
layout: "post"
diff: 省选/NOI-
pid: P4572
tag: ['2013', '各省省选', '江苏']
---
# [JSOI2013] 哈利波特与死亡圣器
## 题目描述

伏地魔的黑暗势力控制了魔法部与霍格沃茨魔法学校之后，哈利与罗恩、赫敏不得不逃亡在外，隐形遁迹。为了完成校长邓布利多的遗命，一直在暗中寻机销毁伏地魔魂器的哈利，意外地获悉如果他们能够拥有传说中的三件死亡圣器，伏地魔将必死无疑。

在凤凰社成员的帮助下，哈利一行人重新掌控了霍格沃茨。然而此举激怒了伏地魔，他很快率领大批食死徒和黑暗生物向霍格沃茨进军。麦格教授紧急疏散了霍格沃茨的学生，并开始了守卫霍格沃茨的战斗。

霍格沃茨魔法学校的主要建筑共有 $n$ 处，我们编号为 $1$ 到 $n$，这些建筑间由魔法道路连接，整体呈树状分布，即任意两个建筑间有且仅有一条路径相连（路径可以是一条或多条道路组成）。霍格沃茨历经多年风雨，每个建筑自身有许多保护魔法，比如“石墩触动咒”、“降敌陷阱咒”、“统统加护咒”等，只需有人前往施用咒语即能保卫建筑。

现在，伏地魔大军已经到达 $1$ 号建筑——学校大门，凤凰社成员也已经在大门迎战，并且已经启用了大门的保护魔法。然而伏地魔大军势力壮大，保护魔法只能延缓大军的进攻锋芒，他们仍能用一个小时攻克一个建筑，随后整个大军便随机前往与之相邻的另一个建筑（兵贵神速，大军移动过程不需要时间；兵法无常，他们有可能前往已经攻克的建筑）。

目前除了 $1$ 号建筑，其他建筑的保护魔法都尚未被启用，凤凰社决定派出一些成员去其他建筑施用咒语来启动保护魔法。每个凤凰社成员可以瞬间达到任意一个建筑，并用一个小时完成对该建筑保护魔法的启用，之后可以再前往其他的建筑。他们的任务是，保证不论伏地魔大军如何行动，大军所到建筑的保护魔法都已经启用。为了集中更多力量直接打击伏地魔大军，凤凰社希望派出施用咒语的成员数尽可能少。

请你计算，至少需要派出多少位成员。

注：

- 伏地魔大军到达 $1$ 号建筑开始攻击的同时，凤凰社派出成员去其他建筑施咒。

- 当大军攻克某个建筑后，凤凰社成员可以在知道大军下一个小时去哪个建筑的情况下，再决定他们去哪些建筑施咒。这个过程也不需要时间。

- 已经启用过保护魔法的建筑无需再施咒，即便大军攻克该建筑以后某个时候又回到这个建筑，大军也会在这个建筑持续攻击一个小时后再离开。
## 输入格式

第一行一个整数 $n$，表示建筑的数量。

接下来 $n-1$ 行，每行两个整数 $u,v$，表示建筑 $u$ 和建筑 $v$ 之间有一条魔法道路。

## 输出格式

一行一个整数，表示最少需要派出施用咒语的成员数。
## 样例

### 样例输入 #1
```
7
1 2
1 3
2 5
2 6
7 2
4 1
```
### 样例输出 #1
```
3
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n\leq 3\times 10^5$。


---

---
title: "[CQOI2013] 二进制A+B"
layout: "post"
diff: 省选/NOI-
pid: P4574
tag: ['动态规划 DP', '2013', '重庆', '各省省选', '枚举', '进制']
---
# [CQOI2013] 二进制A+B
## 题目描述

输入三个整数$a, b, c$，把它们写成无前导0的二进制整数。
比如$a=7, b=6, c=9$，写成二进制为$a=111, b=110, c=1001$。

接下来以位数最多的为基准，其他整数在前面添加前导0，使得$a, b, c$拥有相同的位数。比如在刚才的例子中，添加完前导0后为$a=0111, b=0110, c=1001$。

最后，把$a, b, c$的各位进行重排，得到a’, b’, c’，使得a’+b’=c’。比如在刚才的例子中，可以这样重排：a’=0111, b’=0011, c’=1010。


你的任务是让c’最小。如果无解，输出-1。
## 输入格式

输入仅一行，包含三个整数$a, b, c$。
## 输出格式

仅一行，为c’的最小值。
## 样例

### 样例输入 #1
```
7 6 9
```
### 样例输出 #1
```
10
```
## 提示

$a,b,c <= 2^{30}$



---

---
title: "[FJOI2018] 领导集团问题"
layout: "post"
diff: 省选/NOI-
pid: P4577
tag: ['2018', '线段树', '各省省选', '福建', '位运算', '差分']
---
# [FJOI2018] 领导集团问题
## 题目描述

一个公司的组织领导架构可以用一棵领导树来表示。公司的每个成员对应于树中一个结点 $v_i$，且每个成员都有响应的级别 $w_i$。越高层的领导，其级别值 $w_i$ 越小。树中任何两个结点之间有边相连，则表示与结点相应的两个成员属于同一部门。领导集团问题就是根据公司的领导树确定公司的最大部门。换句话说，也就是在领导树中寻找最大的部门结点子集，使得的结点 $v_i$ 和 $v_j$，如果 $v_i$ 是 $v_j$ 的子孙结点，则 $w_i \ge w_j$。

编程任务：对于任意对于给定的领导树，计算出领导树中最大的部门结点子集。

## 输入格式

第一行有一个正整数 $n$，表示领导树的结点数。

接下来的一行中有 $n$ 个整数。第 $i$ 个数表示 $w_i$。

再接下来的 $n-1$ 行中，第 $i$ 行有一个整数 $v_i$ 表示 $v_i$ 是 $i+1$ 的双亲结点。
## 输出格式

输出找到的最大的部门的成员数。
## 样例

### 样例输入 #1
```
6
2 5 1 3 5 4
1
1
2
2
4
```
### 样例输出 #1
```
4
```
## 提示

对于 $10\%$ 的数据，$n\le 20$；

对于 $40\%$ 的数据，$n\le 2000$；

对于 $100\%$ 的数据，$1\le n\le 2\times 10 ^ 5$，$0 < w_i \le 10 ^ 9$。


---

---
title: "[FJOI2014] 树的重心"
layout: "post"
diff: 省选/NOI-
pid: P4582
tag: ['2014', '各省省选', '福建']
---
# [FJOI2014] 树的重心
## 题目描述

给定一个 $n$ 个点的树，每个点的编号从 $1 \sim n$ ，问这个树有多少不同的连通子树，和这个树有相同的重心。

其中 $n$ 个点的树指的是 $n$ 个点的最小连通图，显然 $n$ 个点的树有 $n-1$ 条边，去掉这 $n-1$ 条边中的任何一条，原图都不再联通，任意两个点之间由唯一一条路径相连。

对于一个树，树的重心定义为：删掉某点 $i$ 后，若剩余 $k$ 个连通分量，那么定义 $d(i)$ 为这些连通分量中点的个数的最大值，所谓重心，就是使得 $d(i)$ 最小的点 $i$。

基于以上定义，一个树的重心可能会有一个或者两个，题中所要求的联通子树，其重心编号和个数必须和原树的完全一样。

找出给定的树中有多少联通的子树和这个树有相同的重心。输出答案 $\bmod 10007$ 后的结果。
## 输入格式

第 $1$ 行中给出正整数 $Q$，表示该组数据中有多少组测试样例。

每组样例首先输入一个整数 $n$（$0 < n \le 200$），表示该组样例中输入的树包含 $n$ 个点，之后 $n-1$ 行，每行输入两整数数 $x,y$（$1 \le x,y \le n$），表示编号为 $x$ 的点和编号为 $y$ 的点之间存在一条边，所有点的编号从 $1 \sim n$。

## 输出格式

首先输出样例编号，之后输出满足条件的子树的个数，由于这个数字较大，你只需要输出这个数字 $\bmod\ 10007$ 后的结果，详见输出示例，请严格按照输出实例中的格式输出。

## 样例

### 样例输入 #1
```
3
2
1 2
3
1 2
2 3
5
1 2
1 3
2 4
2 5
```
### 样例输出 #1
```
Case 1: 1
Case 2: 2
Case 3: 6
```
## 提示

对于 $100 \%$ 的数据，满足 $1 \le Q \le 50, 1 \le n \le 200$。


---

---
title: "[FJOI2015] 世界树"
layout: "post"
diff: 省选/NOI-
pid: P4583
tag: ['2015', '各省省选', '福建']
---
# [FJOI2015] 世界树
## 题目描述

奥丁杀死的巨人伊米尔后，从伊米尔的尸体上生长出来一株巨大的梣树，它是整个宇宙的核心，被称为世界之树，这个巨木的枝干构成了整个世界，它被神秘的奥术力量所守护。

奥丁发现，世界树的每个节点至多有两棵子树，其蕴含的奥术力量是子树奥术力量的最大值 $+1$，如果一个节点没有子树，其奥术力量为 $1$，这些节点被称为“源”。

世界树在悠长的岁月里形成了奇妙的魔法平衡，具体来说，它的左子树与右子树的奥术力量的差的绝对值不会超过 $1$。若一个节点只有一棵子树（不妨设为左子树），则右子树的奥术力量视为 $0$。

现在奥丁想知道，在 $n$ 个节点的世界树中，最高和最低的两个“源”（即叶子节点）的深度差最大是多少？
## 输入格式

第一行一个整数 $T$，表示数据组数。

以下 $T$ 行，每行一个整数 $n$ 表示世界树的节点数。
## 输出格式

$T$ 行，每行一个整数表示任意两个“源”的奥术力量的差的最大值。
## 样例

### 样例输入 #1
```
2
5
12345
```
### 样例输出 #1
```
1
9
```
## 提示

对于 $100\%$ 的数据，$1\leq n\leq 10^{10000}$，$T\leq 50$。


---

---
title: "[FJOI2015] 带子串包含约束LCS问题"
layout: "post"
diff: 省选/NOI-
pid: P4584
tag: ['2015', '各省省选', '福建']
---
# [FJOI2015] 带子串包含约束LCS问题
## 题目描述

带有子串包含约束的最长公共子序列问题可以具体表述如下。
 
给定2个长度分别为n和m的序列X和Y，以及一个子串包含约束集S。

S中共有k个字符串$S=\{S_1,S_2,…,S_k\}$，其中字符串$S_i$的长度为$l_i$，1≤i≤k。带有子串包含约束的最长公共子序列问题就是要找出X和Y的包含约束集S中所有字符串为其子串的最长公共子序列。 

例如，如果给定的序列X和Y分别为X=actaagacct, Y=gacctacctc，子串包含约束集S={ata, tact}，则子序列actacct是X和Y的一个无约束的最长公共子序列，而包含约束集S中所有字符串为其子串的一个最长公共子序列是atact 。 
在本题中请特别关注子串与子序列的区别。字符串$T=t_1…t_n$的子串是一个形如$T$’$=t_1+i…t_m+i$的字符串，其中，0≤i，m+i≤n。例如，T=abcdefg，则bcd是T 的一个子串，而bce是T的一个子序列，但不是T 的子串。

设计一个算法，找出给定序列X和Y带有子串包含约束S的最长公共子序列。 
## 输入格式

第1行中给出正整数n,m,k，m＜300, n＜300, k＜6。n和m分别表示给定序列X和Y的长度。k表示子串包含约束集S中共有k个字符串。

第2行中有k个整数$l_i$，$0≤l_i≤300,1≤i≤k$，分别表示子串包含约束集S中k个字符串的长度。

第3行和第4行分别给出序列X和Y 。

接下来k行每行一个字符串$S_i$
## 输出格式

将计算出的X和Y带子串包含约束S的最长公共子序列的长度输出。
## 样例

### 样例输入 #1
```
10 10 2
3 4
actaagacct
gacctacctc
ata
tact
```
### 样例输出 #1
```
5
```
## 提示

字符串仅包含大小写字母.


---

---
title: "[FJOI2015] 火星商店问题"
layout: "post"
diff: 省选/NOI-
pid: P4585
tag: ['2015', '线段树', '各省省选', '福建', '分治', '可持久化', '线段树分治']
---
# [FJOI2015] 火星商店问题
## 题目描述

火星上的一条商业街里按照商店的编号 $1 \sim n$ ，依次排列着 $n$ 个商店。商店里出售的琳琅满目的商品中，每种商品都用一个非负整数 $\text{val}$ 来标价。每个商店每天都有可能进一些新商品，其标价可能与已有商品相同。
 
火星人在这条商业街购物时，通常会逛这条商业街某一段路上的所有商店，譬如说商店编号在区间 $[l,r]$ 中的商店，从中挑选一件自己最喜欢的商品。每个火星人对商品的喜好标准各不相同。  

通常每个火星人都有一个自己的喜好密码 $x$。对每种标价为 $\text{val}$ 的商品，喜好密码为 $x$ 的火星人对这种商品的喜好程度与 $\text{val}$ 异或 $x$ 的值成正比。也就是说，$\text{val xor }x$ 的值越大，他就越喜欢该商品。  

每个火星人的购物卡在所有商店中只能购买最近 $d$ 天内（含当天）进货的商品。另外，每个商店都有一种特殊商品不受进货日期限制，每位火星人在任何时刻都可以选择该特殊商品。每个商店中每种商品都能保证供应，不存在商品缺货的问题。 

对于给定的按时间顺序排列的事件，计算每个购物的火星人的在本次购物活动中最喜欢的商品，即输出 $\text{val xor }x$ 的最大值。这里所说的按时间顺序排列的事件是指以下两种事件： 

`0 s v`，表示编号为 $s$ 的商店在当日新进一种标价为 $v$ 的商品。 

`1 l r x d`，表示一位火星人当日在编号在 $[l,r]$ 的商店购买 $d$ 天内的商品，该火星人的喜好密码为 $x$。
## 输入格式

第一行两个正整数 $n,m$，分别表示商店总数和事件总数。   
第二行中有 $n$ 个整数，第 $i$ 个整数表示商店 $i$ 的特殊商品标价。 

接下来的 $m$ 行，每行表示一个事件。每天的事件按照先事件 $0$，后事件 $1$ 的顺序排列。 
## 输出格式

对于每个事件 $1$，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 6
1 2 3 4
1 1 4 1 0
0 1 4
0 1 3
1 1 1 1 0
1 1 1 1 1
1 1 2 1 2
```
### 样例输出 #1
```
5
0
2
5
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，所有输入的整数在 $[0,10^5]$ 范围内。


---

---
title: "[FJOI2016] 神秘数"
layout: "post"
diff: 省选/NOI-
pid: P4587
tag: ['2016', '各省省选', '福建', '可持久化线段树']
---
# [FJOI2016] 神秘数
## 题目描述

一个可重复数字集合 $S$ 的神秘数定义为最小的不能被 $S$ 的子集的和表示的正整数。例如 $S=\{1,1,1,4,13\}$，有：$1 = 1$，$2 = 1+1$，$3 = 1+1+1$，$4 = 4$，$5 = 4+1$，$6 = 4+1+1$，$7 = 4+1+1+1$。

$8$ 无法表示为集合 $S$ 的子集的和，故集合 $S$ 的神秘数为 $8$。

现给定长度为 $n$ 的**正整数**序列 $a$，$m$ 次询问，每次询问包含两个参数 $l,r$，你需要求出由 $a_l,a_{l+1},\cdots,a_r$ 所组成的可重集合的神秘数。
## 输入格式

第一行一个整数 $n$，表示数字个数。

第二行 $n$ 个正整数，从 $1$ 编号。

第三行一个整数 $m$，表示询问个数。
## 输出格式

对于每个询问，输出一行对应的答案。
## 样例

### 样例输入 #1
```
5
1 2 4 9 10
5
1 1
1 2
1 3
1 4
1 5
```
### 样例输出 #1
```
2
4
8
8
8
```
## 提示

对于 $100\%$ 的数据点，$1\le n,m\le {10}^5$，$\sum a\le {10}^9$。


---

---
title: "[TJOI2018] 智力竞赛"
layout: "post"
diff: 省选/NOI-
pid: P4589
tag: ['2018', '二分', '各省省选', '二分图', '天津']
---
# [TJOI2018] 智力竞赛
## 题目描述

小豆报名参加智力竞赛，他带上了 $n$ 个好朋友作为亲友团一块来参加比赛。比赛规则如下：

一共有 $m$ 道题目，每个人都有 $1$ 次答题机会，每次答题为选择一道题目回答，在回答正确后，可以继续回答这个题目的后续题目，直到答错题目或者没有后续题目。

每个问题都会有一个价值，比赛最后参赛选手获得的奖励价值等价于该选手和他的亲友团没有回答的问题中的最低价值。

我们现在知道小豆和他的亲友团实力非常强，能够做出这次竞赛中的所有题目。

小豆想知道在知道题目和后续题目的条件下，他最大能获得的价值是多少？
## 输入格式

第一行有两个整数 $n,m$。（$n\leq50,m\leq500$）

接下来 $m$ 行，第 $i+1$ 行表示编号为 $i$ 的题目的题目信息，格式形如 $v_i,k_i,a_{i,1},a_{i,2},...,a_{i,k_i}$，其中 $v_i$ 表示该题目的价值，$k_i$ 表示这个题目的后续题目个数，$a_{i,1},a_{i,2},...,a_{i,k_i}$ 表示 $k_i$ 个后续题目的编号。
## 输出格式

如果全部题目都能答对，则输出 `AK`，否则输出小豆可以获得的最高奖励价值。
## 样例

### 样例输入 #1
```
1 3
1 0
2 1 3
3 0
```
### 样例输出 #1
```
AK
```
### 样例输入 #2
```
1 6
1 2 2 3
2 1 4
3 1 4
4 1 6
5 0
6 0
```
### 样例输出 #2
```
5
```
## 提示

对于 $10\%$ 的数据，有 $1<n,m\leq10$。

对于 $20\%$ 的数据，有 $1<n,m\leq100$。

对于 $100\%$ 的数据，有 $1<n\leq50,1<m\leq500,v_i\leq10^9,k_i,a_{i,j}\leq m$。


---

---
title: "[TJOI2018] 游园会"
layout: "post"
diff: 省选/NOI-
pid: P4590
tag: ['字符串', '递推', '2018', '各省省选', '枚举', '有限状态自动机', '天津', 'DP 套 DP']
---
# [TJOI2018] 游园会
## 题目描述

小豆参加了 NOI 的游园会，会场上每完成一个项目就会获得一个奖章，奖章只会是 $\texttt{N}$、$\texttt{O}$、$\texttt{I}$ 的字样。在会场上他收集到了 $K$ 个奖章组成的串。兑奖规则是奖章串和兑奖串的最长公共子序列长度为小豆最后奖励的等级。现在已知兑奖串长度为 $N$，并且在兑奖串上不会出现连续三个奖章为 $\texttt{NOI}$，即奖章中不会出现子串 $\texttt{NOI}$。现在小豆想知道各个奖励等级会对应多少个不同的合法兑奖串。

## 输入格式

第一行两个数，$N, K$ 分别代表兑奖串的长度，小豆收集的奖章串的长度（$N\leq1000,K\leq15$）。

第二行一共 $K$ 个字符，表示小豆得到的奖章串。
## 输出格式

一共 $K+1$ 行，第行表示小豆最后奖励等级为 $i-1$ 的不同的合法兑奖串的个数，可能这个数会很大，结果对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
3 2
NO
```
### 样例输出 #1
```
1
19
6
```
## 提示

### 样例解释

最长公共子序列长度为 $0$ 的串有：$\texttt{III}$;

最长公共子序列长度为 $2$ 的串有：$\texttt{NON}$、$\texttt{NNO}$、$\texttt{NOO}$、$\texttt{ONO}$、$\texttt{INO}$、$\texttt{NIO}$；

除去 $\texttt{NOI}$，余下的 $19 = 26-6-1$ 种为最长公共子序列长度为 $1$。

### 数据范围

- 对于 $10\%$ 的数据，$N\leq10,K\leq10$；
- 对于 $30\%$ 的数据，$N\leq100,K\leq4$；
- 对于 $100\%$ 的数据，$N\leq1000,K\leq15$。


---

---
title: "[TJOI2018] 碱基序列"
layout: "post"
diff: 省选/NOI-
pid: P4591
tag: ['2018', '各省省选', '天津']
---
# [TJOI2018] 碱基序列
## 题目描述

小豆参加了生物实验室。在实验室里，他主要研究蛋白质。他现在研究的蛋白质是由 $k$ 个氨基酸按一定顺序构成的。每一个氨基酸都可能有 $a$ 种碱基序列 $s_{i,j}$ 构成。

现在小豆有一个碱基串 $s$，小豆想知道在这个碱基上都多少种不同的组合方式可能得到这个蛋白质。即求由 $k$ 段字符串有序合并成的字符串 $s_1$，有多少种不同方式能够匹配字符串 $s$，其中 $k$ 段字符串的选法不同，或者与 $s$ 匹配上的位置不同认为是不同的方式。
## 输入格式


第一行一个数，表示这个蛋白质由 $k$ 个氨基酸组成。

第二行一个字符串 $s$，表示小豆现在有的碱基串。

第三行开始接下来 $k$ 行表示第 $i$ 个氨基酸可能的碱基序列，对于第 $i$ 个氨基酸，$a_i$ 表示这个氨基酸可能的碱基序列种数，接下来 $a_i$ 个字符串表示这 $a_i$ 种可能的碱基序列，用空格隔开。

## 输出格式

输出一个数目标是不同的方案数（不同的方案数是指不同的子碱基串或者相同的碱基串不同的氨基酸排列方式）。

答案对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
2
ABC
2 A AB
2 C BC
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
2
AAA
2 A AA
2 A AA
```
### 样例输出 #2
```
4
```
## 提示

### 样例 1 解释

- 第一个选 $\tt A$ 第二个选 $\tt C$，得到 $\tt AC$ 能够与 $\tt ABC$ 产生 $0$ 种匹配方式；
- 第一个选 $\tt A$ 第二个选 $\tt BC$，得到 $\tt ABC$ 能够与 $\tt ABC$ 产生 $1$ 种匹配方式；
- 第一个选 $\tt AB$ 第二个选 $\tt C$，得到 $\tt ABC$ 能够与 $\tt ABC$ 产生 $1$ 种匹配方式；
- 第一个选 $\tt AB$ 第二个选 $\tt BC$，得到 $\tt ABBC$ 能够与 $\tt ABC$ 产生 $0$ 种匹配方式。

所以一共 $2$ 种。

### 样例 2 解释

- 第一个选 $\tt A$ 第二个选 $\tt A$，得到 $\tt AA$ 能够与 $\tt AAA$ 产生 $2$ 种匹配方式；
- 第一个选 $\tt A$ 第二个选 $\tt AA$，得到 $\tt AAA$ 能够与 $\tt AAA$ 产生 $1$ 种匹配方式；
- 第一个选 $\tt AA$ 第二个选 $\tt A$，得到 $\tt AAA$ 能够与 $\tt AAA$ 产生 $1$ 种匹配方式；
- 第一个选 $\tt AA$ 第二个选 $\tt AA$,得到 $\tt AAAA$ 能够与 $\tt AAA$ 产生 $0$ 种匹配方式。

所以一共 $4$ 种。

### 数据范围及约定

- 对于 $30\%$ 的数据，$1\leq k\leq 25$，$1\le |s|\leq 10000$，$1\le a_i\leq 3$。
- 对于 $100\%$ 的数据，$1\leq k\leq100$，$1\le |s|\leq 10000$，$1\le a_i \leq10$。碱基序列的长度均不超过 $15$。字符集为大写字母。


---

---
title: "[TJOI2018] 异或"
layout: "post"
diff: 省选/NOI-
pid: P4592
tag: ['贪心', '2018', '各省省选', '可持久化', '进制', '天津']
---
# [TJOI2018] 异或
## 题目描述

现在有一颗以 $1$ 为根节点的由 $n$ 个节点组成的树，节点从 $1$ 至 $n$ 编号。树上每个节点上都有一个权值 $v_i$。现在有 $q$ 次操作，操作如下：

- $1~x~z$：查询节点 $x$ 的子树中的节点权值与 $z$ 异或结果的最大值。
- $2~x~y~z$：查询节点 $x$ 到节点 $y$ 的简单路径上的节点的权值与 $z$ 异或结果最大值。
## 输入格式

输入的第一行是两个整数，分别代表结点个数 $n$ 和询问个数 $q$。

第二行有 $n$ 个整数，第 $i$ 个整数表示点 $i$ 的的权值 $v_i$。

接下来 $n-1$ 行，每行有两个整数 $u, v$，表示存在一条连结 $u$ 和 $v$ 的边。

接下来 $q$ 行，每行首先有一个整数 $op$，代表操作类型。

- 若 $op = 1$，则一个空格后有两个整数 $x, z$，代表查询节点 $x$ 的子树中的节点权值与 $z$ 异或结果的最大值。
- 若 $op = 2$，则一个空格后有三个整数 $x, y, z$，代表查询节点 $x$ 到节点 $y$ 的简单路径上的节点的权值与 $z$ 异或结果最大值。
## 输出格式

对于每一个查询，输出一行一个整数代表答案。
## 样例

### 样例输入 #1
```
7 5
1 3 5 7 9 2 4
1 2
1 3
2 4
2 5
3 6
3 7
1 3 5
2 4 6 3
1 5 5
2 5 7 2
1 1 9
```
### 样例输出 #1
```
7
6
12
11
14
```
## 提示

#### 数据规模与约定


- 对于 $10\%$ 的数据，保证 $n, q \leq 10^2$；
- 对于 $20\%$ 的数据，保证 $n, q \leq 10^3$；
- 对于 $40\%$ 的数据，保证 $n, q \leq 10^4$；
- 对于 $100\%$ 的数据，保证 $2\leq n, q \leq10^5$，$1 \leq u, v, x, y \leq n$，$1 \leq op \leq 2$，$1 \leq v_i, z \lt 2^{30}$。


---

---
title: "[TJOI2018] 教科书般的亵渎"
layout: "post"
diff: 省选/NOI-
pid: P4593
tag: ['模拟', '递推', '2018', '各省省选', '天津', '差分']
---
# [TJOI2018] 教科书般的亵渎
## 题目描述

小豆喜欢玩游戏，现在他在玩一个游戏遇到这样的场面，每个怪的血量为 $a_i$，且每个怪物血量均不相同，小豆手里有无限张“亵渎”。亵渎的效果是对所有的怪造成 $1$ 点伤害，如果有怪死亡，则再次施放该法术。我们认为血量为 $0$ 怪物死亡。

小豆使用一张“亵渎”会获得一定的分数，分数计算如下，在使用一张“亵渎”之后，每一个被亵渎造成伤害的怪会产生 $x^k$，其中 $x$ 是造成伤害前怪的血量为 $x$ 和需要杀死所有怪物所需的“亵渎”的张数 $k$。
## 输入格式

第一行输入一个 $T$（$T\leq10$），表示有多少组测试数据。

每组测试数据第一行为 $n$，$m$，表示有当前怪物最高的血量 $n$，和 $m$ 种没有出现的血量。

接下来 $m$ 行，每行 $1$ 个数 $a_i$，表示场上没有血量为 $a_i$ 的怪物。
## 输出格式

一共 $T$ 行，每行一个数，第 $i$ 行表示第 $i$ 组测试数据中小豆的最后可以获得的分数，因为这个分数会很大需要模 $10^9+7$。
## 样例

### 样例输入 #1
```
2
10 1
5
4 2
1
2
```
### 样例输出 #1
```
415
135
```
## 提示

- 对于 $10\%$ 的数据，有 $m=0$；
- 对于 $20\%$ 的数据，有 $m\leq1$；
- 对于 $30\%$ 的数据，有 $m\leq2$
- 对于 $40\%$ 的数据，有 $m\leq3$；
- 对于 $50\%$ 的数据，有 $m\leq4$；
- 对于 $60\%$ 的数据，有 $m\leq5$；
- 对于 $100\%$ 的数据，有 $m\leq50$，$n\leq10^{13}$，$1 \le a_i <n$。


---

---
title: "[HEOI2012] Akai 的数学作业"
layout: "post"
diff: 省选/NOI-
pid: P4598
tag: ['2012', '各省省选', '河北']
---
# [HEOI2012] Akai 的数学作业
## 题目背景

这里是广袤无垠的宇宙

这里是一泻千里的银河

这里是独一无二的太阳系

这里是蔚蓝色的地球

这里，就是这里，是富饶的中国大陆！

这里是神奇的河北大地

这里是美丽的唐山

这里是神话般的唐山一中

这里是 Akai 曾经的教室
## 题目描述

黑板上还留有当年 Akai 做过的数学作业，其实也并不是什么很困难的题目:

“

给出一个一元 $n$ 次方程： 

$$a_0 + a_1x + a_2x^2 +…+ a^nx^n= 0$$ 

求此方程的所有有理数解。 

” 

Akai 至今还深刻记得当年熬夜奋战求解的时光

他甚至还能记得浪费了多少草稿纸

但是却怎么也想不起来最后的答案是多少了

你能帮助他么？ 
## 输入格式

第一行一个整数 $n$。第二行 $n+1$ 个整数，分别代表 $a_0$ 到$a_n$ 
## 输出格式

第一行输出一个整数 $t$，表示有理数解的个数 

接下来 $t$ 行，每行表示一个解 

解以分数的形式输出，要求分子和分母互质，且分母必须是正整数 

特殊的，如果这个解是一个整数，那么直接把这个数输出 

等价的解只需要输出一次 

所有解按照从小到大的顺序输出 
## 样例

### 样例输入 #1
```
3
-24 14 29 6 
```
### 样例输出 #1
```
3
-4
-3/2
2/3 
```
## 提示

对于 30%的数据，$n\leq10$ 

对于 100%的数据，$n\leq100$，$|a_i| <= 2\times10^7$，$a_n\not= 0$

HEOI 2012 Day1 Task1



---

---
title: "[HEOI2012] 旅行问题"
layout: "post"
diff: 省选/NOI-
pid: P4600
tag: ['2012', '各省省选', '河北']
---
# [HEOI2012] 旅行问题
## 题目描述

yz 是 Z 国的领导人，他规定每个地区的名字只能为 $26$ 个小写拉丁字母的一个。由于地区数有可能超过 $26$ 个，便产生了一个问题，如何辨别名字相同的地区？于是 yz 规定，一个地区的描述必须包含它的所有上级，且上级按次序排列。于是，一个地区的描述是一个字符串。比如说，一个地区的名字为 $\tt c$，它的上级为 $\tt b$，$\tt b$ 的上级为 $\tt a$，$\tt a$ 没有上级，那么这个地区就描述为 $\tt abc$。显然，这个描述同时包含了 $\tt c$ 的上级 $\tt b$ 和 $\tt b$ 的上级 $\tt a$ 的描述，分别为 $\tt ab$ 和 $\tt a$。

值得注意的是，每个地区最多有一个上级，同一上级的地区之间名字不同，没有上级的地区之间名字不同。

现在，yz 对外公布了 $n$ 个地区的描述，这些描述中包含了 Z 国所有地区的描述，并让你处理来访者的旅行问题。

现有 $m$ 对人访问这个国家，对于每对人，第一个人喜欢第 $i$ 个描述中的第 $j$ 个地区，设这个地区描述为 $s_1$，第二个人喜欢第 $k$ 个描述中的第 $l$ 个地区，设这个地区描述为 $s_2$。他们为了统一行程，决定访问描述为 $s$ 的地区（显然他们只关心地区的名字，并非是地区本身），设 $s$ 的长度为 $t$，$s$ 需要满足以下条件：

1. $t\leq j$，$t\leq l$。
2. $s[1\cdots t]=s_1[j-t+1\cdots j]$，$s[1\cdots t]=s_2[l-t+1\cdots l]$，即 $s$ 为 $s_1$ 中 $1$ 到 $j$ 位与 $s_2$ 中 $1$ 到 $l$ 位的公共后缀。
2. $t$ 最大化。

为了不使输出过大，你只需把这个字符串按照如下生成的 $26$ 进制数转成 $10$ 进制后 $\bmod\ (10^9+7)$ 后输出：

- $a \to 0$；
- $b \to 1$；
- ……
- $z \to 25$。

比如地区 $\tt cab$ 被编码成 $2\times26^2+0\times26^1+1\times26^0=1353$。
## 输入格式

第一行给定一个整数 $n$。

第 $2\cdots n+1$ 行，每 $i+1$ 行给定一个字符串 $a_i$，表示第 $i$ 个描述。

接下来一行一个整数 $m$。 

接下来 $m$ 行，每行给定四个整数 $i,j,k,l$，字母含义与题目描述一致。 
## 输出格式

共 $m$ 行，每行一个整数，表示答案字符串的编码。 
## 样例

### 样例输入 #1
```
2
aabb
babb
2
1 3 2 3
1 4 2 4 
```
### 样例输出 #1
```
1
1
```
## 提示

### 样例解释

询问 $1$ 中的公共后有 $\tt ab$ 和 $\tt b$，但是没有 $\tt ab$ 这个地区，只有 $\tt b$ 地区，所以只能选择 $\tt b$ 这个地区；

询问 $2$ 中的公共后有 $\tt abb$，$\tt bb$ 和 $\tt b$，但是没有 $\tt abb$ 和 $\tt bb$ 这两个地区，只有 $\tt b$ 地区，所以只能选择 $\tt b$ 这个地区。

### 数据范围及约定

设这个国家地区总数数为 $tot$（注意：输入的字符串总长度可能超过 $tot$！）

- 对于 $30\%$ 的数据，满足 $1\le tot, m, n \le 100$；
- 对于 $50\%$ 的数据，满足 $1\le tot, m, n \le 1000$；
- 对于 $80\%$ 的数据，满足 $1\le tot, m, n \le 10^5$；
- 对于 $100\%$ 的数据，满足$1\le  tot, m, n \le 10^6$。

保证输入文件不超过 $20\text{MB}$。

HEOI2012 Day 2 Task 2


---

---
title: "[SDOI2018] 战略游戏"
layout: "post"
diff: 省选/NOI-
pid: P4606
tag: ['2018', '各省省选', '山东', 'O2优化', '深度优先搜索 DFS', '双连通分量', '虚树', '圆方树']
---
# [SDOI2018] 战略游戏
## 题目描述

省选临近，放飞自我的小 Q 无心刷题，于是怂恿小 C 和他一起颓废，玩起了一款战略游戏。

这款战略游戏的地图由 $n$ 个城市以及 $m$ 条连接这些城市的双向道路构成，并且从任意一个城市出发总能沿着道路走到任意其他城市。

现在小 C 已经占领了其中至少两个城市，小 Q 可以摧毁一个小 C 没占领的城市，同时摧毁所有连接这个城市的道路。只要在摧毁这个城市之后能够找到某两个小 C 占领的城市 $u$ 和 $v$，使得从 $u$ 出发沿着道路无论如何都不能走到 $v$，那么小 Q 就能赢下这一局游戏。

小 Q 和小 C 一共进行了 $q$ 局游戏，每一局游戏会给出小 C 占领的城市集合 $S$，你需要帮小 Q 数出有多少个城市在他摧毁之后能够让他赢下这一局游戏。
## 输入格式

第一行包含一个正整数 $T$，表示测试数据的组数。

对于每组测试数据：

第一行是两个整数 $n$ 和 $m$ ，表示地图的城市数和道路数。

接下来 $m$ 行，每行包含两个整数 $u$ 和 $v (1 \le u < v \le n)$，表示第 $u$ 个城市和第 $v$ 个城市之间有一条道路，同一对城市之间可能有多条道路连接。


第 $m + 1$ 是一个整数 $q$，表示游戏的局数，

接下来 $q$ 行，每行先给出一个整数 $|S| (2 \le |S| \le n)$，表示小 C 占领的城市数量，然后给出 $|S|$ 个整数 $(1 \le S_1 < S_2 < \cdots < S_{|S|} ≤ n)$，表示小 C 占领的城市。
## 输出格式

对于每一局游戏，输出一行，包含一个整数，表示这一局游戏中有多少个城市在小 Q 摧毁之后能够让他赢下这一局游戏。
## 样例

### 样例输入 #1
```
2
7 6
1 2
1 3
2 4
2 5
3 6
3 7
3
2 1 2
3 2 3 4
4 4 5 6 7
6 6
1 2
1 3
2 3
1 4
2 5
3 6
4
3 1 2 3
3 1 2 6
3 1 5 6
3 4 5 6

```
### 样例输出 #1
```
0
1
3
0
1
2
3
```
## 提示

- $1 \le T \le 10$；
- $2 \le n \le 10^5$ 且 $n - 1 \le m \le 2\times 10 ^ 5$；
- $1 \le q \le 10^5$；
- 对于每组测试数据，有 $\sum|S| \le 2 \times 10^5$。

### Subtasks

- 子任务 1 (30 分)：对于每组测试数据，满足 $\sum|S| \le 20$；
- 子任务 2 (45 分)：对于每一次询问，满足 $|S| = 2$；
- 子任务 3 (25 分)：没有任何附加的限制。



---

---
title: "[FJOI2016] 所有公共子序列问题"
layout: "post"
diff: 省选/NOI-
pid: P4608
tag: ['字符串', '高精度', '2016', '各省省选', '福建', '有限状态自动机']
---
# [FJOI2016] 所有公共子序列问题
## 题目描述

一个给定序列的子序列是在该序列中删去若干元素后得到的序列。确切地说，若给定序列 $X=x_1x_2\ldots x_m$，则另一序列 $Z=z_1z_2\ldots z_k$ 是 $X$ 的子序列是指存在一个严格递增下标序列 $i_1,i_2, \ldots ,i_k$ 使得对于所有 $j=1,2,…,k$ 有 $z_j=x_{i_j}$。

例如，序列 $Z=$``GACT`` 是序列 $X=$``GCTACT`` 的子序列，相应的递增下标序列为 $1,4,5,6$。给定两个序列 $X$ 和 $Y$，当另一序列 $Z$ 既是 $X$ 的子序列又是 $Y$ 的子序列时，称 $Z$ 是序列 $X$ 和 $Y$ 的公共子序列。例如，若 $X=$``GCTACT``， $Y=$``GATCCT``，序列 $T$ 是 $X$ 和 $Y$ 的一个公共子序列，序列 ``GACT`` 也是 $X$ 和 $Y$ 的一个公共子序列。注意对于任何给定的序列 $X$ 和 $Y$，空序列总是它们的一个公共子序列。

所有公共子序列问题是要求对于给定的 $2$ 个序列 $X=x_1x_2\ldots x_m$ 和 $Y=y_1y_2\ldots y_m$，找出 $X$ 和 $Y$ 的所有不同的公共子序列。
## 输入格式

文件的第一行有两个正整数 $m$ 和 $n$，分别表示 $2$ 个输入序列 $X$ 和 $Y$ 的长度。

接下来的两行分别给出输入序列 $X=x_1x_2\cdots x_m$ 和 $Y=y_1y_2\cdots y_m$，其中序列中每个元素均为二十六个英文大小写字母。

文件的最后一行给出一个非负整数 $k$。

$k$ 的值为 $1$ 时，表示计算结果要输出 $X$ 和 $Y$ 的所有不同的公共子序列，以及 $X$ 和 $Y$ 有多少个不同的公共子序列。

$k$ 的值为 $0$ 时，表示计算结果只要输出 $X$ 和 $Y$ 有多少个不同的公共子序列。
## 输出格式

将计算出的 $X$ 和 $Y$ 的所有不同的公共子序列，或 $X$ 和 $Y$ 有多少个不同的公共子序列输出到文件中。当 $k=1$ 时，先输出 $X$ 和 $Y$ 的所有不同的公共子序列，每行输出一个公共子序列，按字典序从小到大输出。最后输出不同的公共子序列的个数。当 $k=0$ 时，只要输出不同的公共子序列的个数。
## 样例

### 样例输入 #1
```
6 6
GCTACT
GATCCT 1
```
### 样例输出 #1
```
A
AC
ACT
AT 
C  
CC 
CCT
CT 
G  
GA 
GAC
GACT
GAT 
GC  
GCC 
GCCT
GCT 
GT  
GTC 
GTCT
GTT 
T   
TC  
TCT 
TT  
26
```
## 提示

$1 \leq m,n \leq 3010$

答案....很大啦


---

---
title: "[FJOI2016] 建筑师"
layout: "post"
diff: 省选/NOI-
pid: P4609
tag: ['数学', '递推', '2016', '各省省选', '福建', '线性递推']
---
# [FJOI2016] 建筑师
## 题目描述

小 Z 是一个很有名的建筑师，有一天他接到了一个很奇怪的任务：在数轴上建 $n$ 个建筑，每个建筑的高度是 $1$ 到 $n$ 之间的一个整数。

小 Z 有很严重的强迫症，他不喜欢有两个建筑的高度相同。另外小 Z 觉得如果从最左边（所有建筑都在右边）看能看到 $A$ 个建筑，从最右边（所有建筑都在左边）看能看到 $B$ 个建筑，这样的建筑群有着独特的美感。现在，小 Z 想知道满足上述所有条件的建筑方案有多少种？

如果建筑 $i$ 的左(右)边没有任何建造比它高，则建筑 $i$ 可以从左(右)边看到。两种方案不同，当且仅当存在某个建筑在两种方案下的高度不同。
## 输入格式

第一行一个整数 $T$，代表 $T$ 组数据。
接下来 $T$ 行，每行三个整数 $n,A,B$。
## 输出格式

对于每组数据输出一行答案 $\text{mod } 10^9+7$。
## 样例

### 样例输入 #1
```
2
3 2 2
3 1 2
```
### 样例输出 #1
```
2
1
```
## 提示

对于 $10 \%$ 的数据 ： $1 \leq n \leq 10$。

对于 $20 \%$ 的数据 ： $1 \leq n \leq 100$。

对于 $40 \%$ 的数据 ： $1 \leq n \leq 50000, \ 1 \leq T \leq 5$。

对于 $100 \%$ 的数据 ：$1 \leq n \leq 50000, \ 1 \leq A, B \leq 100, \ 1 \leq T \leq 200000$。


---

---
title: "[SDOI2018] 荣誉称号"
layout: "post"
diff: 省选/NOI-
pid: P4620
tag: ['动态规划 DP', '2018', '各省省选', '山东', 'O2优化', '树形 DP']
---
# [SDOI2018] 荣誉称号
## 题目背景

 - Input file: title.in
 - Output file: title.out
 - Time limit: 10 seconds
 - Memory limit: 512 megabytes
## 题目描述

休闲游戏玩家小 $Q$ 不仅在算法竞赛方面取得了优异的成绩，还在一款收集钻石的游戏中排名很高。

这款游戏一共有 $n$ 种不同类别的钻石，编号依次为 $1$ 到 $n$。小 $Q$ 已经玩了这款游戏很久了，对于第
$i$ 种钻石，他已经收集到了 $a_i$ 个。这款游戏最大的亮点就是，钻石只有一种获得途径，那就是从商城中购买。具体来说，第 $i$ 种钻石的单价为 $b_i$ 点券。为了鼓励玩家充值，每种钻石都没有数量上限，只要肯充钱，就可以拥有任意多的钻石。但是这款游戏并没有开发 “丢弃道具” 功能，因此小 $Q$ 不能通过丢弃钻石去完成任务。

最近这款游戏推出了一个限时成就任务，完成任务的玩家可以获得荣誉称号，而完成任务条件则是：
给定正整数 $k$ 和 $m$，对于任意一个整数 $x (x\ge 2^k)$，$a_{x}+a_{\lfloor\frac{x}{2}\rfloor}+a_{\lfloor\frac{x}{4}\rfloor}+a_{\lfloor\frac{x}{8}\rfloor}+...+a_{\lfloor\frac{x}{2^k}\rfloor}$ 都要是 $m$的倍数。

高玩小 $Q$ 当然想完成这个限时成就任务，但是在充钱之前他想知道他究竟需要多少点券才能完成这个任务。请写一个程序帮助小 $Q$ 计算最少需要的点券数量。
## 输入格式

第一行包含一个正整数 $T$，表示测试数据的组数。

每组数据第一行包含 $9$ 个正整数 $n, k, m, p, SA, SB, SC, A, B$，其中 $n$ 表示钻石种类数，$k, m$ 表示任
务条件。

为了在某种程度上减少输入量，$a[]$ 和 $b[]$ 由以下代码生成：
```
unsigned int SA, SB, SC;int p, A, B;
unsigned int rng61(){
	SA ^= SA << 16;
	SA ^= SA >> 5;
	SA ^= SA << 1;
	unsigned int t = SA;
	SA = SB;
	SB = SC;
	SC ^= t ^ SA;
	return SC;
}
void gen(){
	scanf("%d%d%d%d%u%u%u%d%d", &n, &k, &m, &p, &SA, &SB, &SC, &A, &B);
	for(int i = 1; i <= p; i++)scanf("%d%d", &a[i], &b[i]);
	for(int i = p + 1; i <= n; i++){
		a[i] = rng61() % A + 1;
		b[i] = rng61() % B + 1;
	}
}
```
## 输出格式

对于每组数据，输出一行一个整数，即最少需要的点券数量。
## 样例

### 样例输入 #1
```
2
3 1 2 3 11111 22222 33333 1 1
1 5
2 3
3 6
7 2 3 7 11111 22222 33333 1 1
6 9
4 5
3 7
5 2
2 4
1 7
9 6
```
### 样例输出 #1
```
3
14
```
## 提示

 - $1 ≤ T ≤ 10$，
 - $1 ≤ k ≤ 10$ 且 $2^k ≤ n$，
 - $ 1 ≤ p ≤ min(n, 100000)$，$10000 ≤ SA, SB, SC ≤ 1000000$，
 - $ 1 ≤ A, B, ai, bi ≤ 10^7$。

子任务 $1$（$30$ 分）：满足 $1 ≤ n ≤ 1000$ 且 $m = 2$。

子任务 $2$（$40$ 分）：满足 $1 ≤ n ≤ 10^5$ 且 $m ≤ 200$。

子任务 $3$（$30$ 分）：满足 $1 ≤ n ≤ 10^7$ 且 $m ≤ 200$。


---

---
title: "[SHOI2010] 滚动的正四面体"
layout: "post"
diff: 省选/NOI-
pid: P4627
tag: ['2010', '各省省选', '上海']
---
# [SHOI2010] 滚动的正四面体
## 题目描述

正四面体总共有4个面，每个面都是一个正三角形。现在把它的一个面标记上字母A，如图 3中所示，A标记在底面上：

![](https://cdn.luogu.com.cn/upload/pic/19848.png)

一个正四面体的一次滚动显然有3个方向可以选择：向左（L）、向右（R）、向后（B）。如图 4所示：

![](https://cdn.luogu.com.cn/upload/pic/19850.png)

于是，这个正四面体的滚动过程就可以用一个只包含“L”“R”“B”的字符串来描述。

初始时，正四面体的A面朝下，现在SECSA将给这个正四面体一串滚动指令——当然就是一个这样的字符串——让这个正四面体每秒滚动一下。也就是说，第1秒内正四面体A面朝下，第1秒末执行第一条指令，第2秒末执行第2条指令，依次类推，直至将整个指令串执行完毕。

你的任务就是当SECSA询问你的时候告诉他：这个正四面体在第L秒到第R秒内A面有多少秒朝着地面。

当然，SECSA可能因为对这个正四面体的滚动路径不满意，他随时会修改他的某一条指令。因此你的程序应该能执行下面两个操作：

(1)接受SECSA修个第i条指令的信息

(2)回答SECSA的“在第L秒到第R秒内A面有多少秒朝着地面”的询问

例如，假如原指令串为“LLLLB”，那么第1、4、6秒内A面是朝下的。此时，如果SECSA向你询问第3秒到第6秒的情况，你就应该回答“2”。而SECSA将第3条指令修改为“R”的话，指令串就变成了“LLRLB”，那么正四面体就只有在第1、5秒内A面朝下了。如图 5所示：

![](https://cdn.luogu.com.cn/upload/pic/19851.png)


## 输入格式

输入文件的第一行是一个整数n，表示指令串中包含的指令条数。

输入文件的第二行是一个字符串，共包含n个字符，每个字符是“L”“R”“B”之一，表示初始的指令串。

输入文件的第三行是一个整数m，表示你的程序需要处理的操作总数。

接下去m行，每行描述一个操作，为以下两种格式之一：

(1)0 i c：表示把第i个操作改成c，c为“L”“R”“B”之一

(2)1 L R：表示询问第L秒到第R秒内，A面有多少秒朝下

输入文件保证：1<=i<=n，1<=L<=R<=n+1。
## 输出格式

输出文件对于每一个询问操作依次输出你的程序给出的回答，每个回答为一个整数，占一行。
## 样例

### 样例输入 #1
```
5
LLLLB
3
1 3 6
0 3 R
1 3 6
```
### 样例输出 #1
```
2
1
```
### 样例输入 #2
```
8
LLLLBRRR
7
1 1 9
1 4 7
0 2 R
1 1 9
1 2 9
0 7 B
1 3 5
```
### 样例输出 #2
```
4
2
1
0
0
```
## 提示

第1个样例就是问题描述中的例子

在第2个样例中，按照原指令“LLLLBRRR”，则第1、4、6、9秒内A面向下；按照第一次修改后的指令“LRLLBRRR”，则只有第1秒内A面向下；按照第二次修改后的指令“LRLLBRBR”，则第1、9秒内A面向下。

1<=n<=60000

1<=m<=150000


---

---
title: "[SHOI2015] 聚变反应炉"
layout: "post"
diff: 省选/NOI-
pid: P4629
tag: ['2015', '各省省选', '上海']
---
# [SHOI2015] 聚变反应炉
## 题目描述

曾经发明了零件组装机的发明家 SHTSC 又公开了他的新发明：聚变反应炉——一种可以产生大量清洁能量的神秘装置。

众所周知，利用核聚变产生的能量有两个难点：一是控制核聚变反应的反应强度，二是使用较少的能量激发聚变反应。而 SHTSC 已经完美解决了第一个问题。一个聚变反应炉由若干个相连的聚变块组成，为了能够使得聚变反应可控，SHTSC 保证任意两个聚能块都可以通过相互之间的链接到达，并且没有一个聚能块可以不重复经过一个链接回到它自己。

但是第二个问题 SHTSC 还没有完全解决。在他设计的聚变反应炉当中，每个聚变块都需要一定的初始能量 $d_i$ 来进行激发，不过 SHTSC 不需要手动激发所有聚变块，这是因为一旦一个聚变块被激发，则会向与其直接相连的所有还未被激发的聚变块传送 $c_i$ 个单位的能量。这样后被触发的聚变块可以以更低的初始能量来激发，甚至可能不需要额外的外界能量就可自行激发，从而降低了总激发能量的消耗。现在给出了一个聚变反应炉，求至少要多少能量才能激发所有聚变块。
## 输入格式

第一行一个整数 $n$，表示共有 $n$ 个聚能块，由 $1$ 至 $n$ 编号。  

第二行 $n$ 个整数，依次表示 $d_i$。  

第三行 $n$ 个整数，依次表示 $c_i$。  

以下 $n - 1$ 行每行两个整数 $u, v$，表示编号为 $u$ 和 $v$ 的聚能块是相连的。
## 输出格式

一行一个整数，表示至少需要多少个单位的能量才能激发所有聚变块。
## 样例

### 样例输入 #1
```
5
1 1 1 1 1
1 1 1 1 1
1 2
2 3
3 4
4 5
```
### 样例输出 #1
```
1
```
## 提示

| Case # | $\max\{c_i\}$ | $n$ | 附加限制 |
|:---:|:---:|:---:|:---:|
| 1 | $= 1$ | $\leq 10$ | $c_i = 1$ |
| 2 | $= 1$ | $\leq 100$ | $c_i = 1$ |
| 3 | $= 1$ | $\leq 200$ | $c_i = 1$ |
| 4 | $= 0$ | $\leq 10$ | - |
| 5 | $= 1$ | $\leq 200$ | $c_i = 1$ |
| 6 | $= 1$ | $\leq 200$ | - |
| 7 | $= 1$ | $\leq 100000$ | $c_i = 1$ |
| 8 | $= 0$ | $\leq 100000$ | - |
| 9 | $= 1$ | $\leq 100000$ | - |
| 10 | $= 1$ | $\leq 100000$ | - |
| 11 | $\leq 5$ | $\leq 20$ | - |
| 12 | $\leq 5$ | $\leq 20$ | $c_i$ 均相等 |
| 13 | $\leq 5$ | $\leq 200$ | - |
| 14 | $\leq 5$ | $\leq 200$ | $c_i$ 均相等 |
| 15 | $\leq 5$ | $\leq 200$ | - |
| 16 | $\leq 5$ | $\leq 200$ | - |
| 17 | $\leq 5$ | $\leq 2000$ | $c_i$ 均相等 |
| 18 | $\leq 5$ | $\leq 2000$ | - |
| 19 | $\leq 5$ | $\leq 2000$ | - |
| 20 | $\leq 5$ | $\leq 2000$ | - |

对于所有数据，保证 $1 \le d_i, \sum d_i \le {10}^9$。


---

---
title: "[SHOI2011] 改进代码"
layout: "post"
diff: 省选/NOI-
pid: P4635
tag: ['2011', '各省省选', '树状数组', '上海', '差分']
---
# [SHOI2011] 改进代码
## 题目描述

 PP 写了两段对数组进行操作的代码。

对于 Pascal 选手，两段代码分别如下： 

```
procedure operate1(l, r, c : longint);
var
    i : longint;
begin
    for i := l to r do
        a[i] := (a[i] + c) mod p;
end;

procedure operate2(l, r : longint);
var
    i, cnt : longint;
begin
    cnt := 0;
    for i := l to r - 1 do
        if a[i] > a[i + 1]
            then cnt := cnt + 1;
    writeln(cnt);
end;
```

对于 C / C++ 选手，两段代码分别如下：

```cpp
void operate1(int l, int r, int c)
{
    int i;
    for (i = l; i <= r; ++i)
        a[i] = (a[i] + c) % p;
}

void operate2(int l, int r)
{
    int i, cnt = 0;
    for (i = l; i < r; ++i)
        if (a[i] > a[i + 1])
            ++ cnt;
    printf("%d\n", cnt);
}
```

于是，主程序就可以通过调用这两个子程序对数组 $a_i$​​ 进行操作，下面是示例代码。

对于 Pascal 选手，代码如下：

```
begin
    operate1(1, 4, 3);
    operate1(4, 7, 4);
    operate2(1, 7);
end.
```

对于 C / C++ 选手，代码如下：

```
int main()
{
    operate1(1, 4, 3);
    operate1(4, 7, 4);
    operate2(1, 7);
}
```

但是 QQ 觉得 PP 的程序效率太低了，他想请你优化 PP 的代码。即，对于一段只包含 ``operate1`` 、 ``operate2`` 两种语句的主程序以及运行之前数组 $a_i$​​ 的初始值，请你计算出他的输出。
## 输入格式

输入的第一行包含 $3$ 个整数 $n,m,p$ 。其中 $n$ 是操作中 $l,r$ 的上界， $m$ 是主程序中的语句数， $p$ 是程序中的常数 $p$ 的值。

接下去 $n$ 行每行一个整数，依次是 $a_1,a_2,…,a_n$ 的初始化的值。输入保证这些值都在 $0,1,…,p-1$ 之中。

接下去 $m$ 行每行依次描述主程序的一行代码。每一行的格式为下面两者之一：

-    ``1 l r c`` : 表示代码 ``operate1(l, r, c);`` 。

-    ``2 l r`` : 表示代码 ``operate2(l, r);`` 。


## 输出格式

输出即为输入对应的程序的输出。
## 样例

### 样例输入 #1
```
7 3 7
2
5
3
0
3
1
2
1 1 4 3
1 4 7 4
2 1 7
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
5 5 2
1
0
0
1
0
2 1 4
2 1 5
1 3 5 1
2 1 4
2 1 3
```
### 样例输出 #2
```
1
2
2
1
```
## 提示

**数据范围与提示**

测试点 $1$：$n \le 1000,m \le 2000$。

测试点 $2 \sim 3$：$n \le 100000$,$m \le 200000$,$c \le 1$,$a_i \le 100000$,$p>500000$。

测试点 $4$：$n \le 100000,m \le 200000,l=1,r=n$。

测试点 $5 \sim 6$：$n \le 100000,m \le 200000$ 且对于所有 ``operate1`` 的参数都有 $l=1,r=n$。

测试点 $7 \sim 10$：$n \le 100000,m \le 200000$。

保证 $1 \le l \le r \le n,0 \le c \le 10^8,p \le 10^6$​​.


---

---
title: "[SHOI2011] 直线拟合"
layout: "post"
diff: 省选/NOI-
pid: P4636
tag: ['2011', '各省省选', '上海']
---
# [SHOI2011] 直线拟合
## 题目描述

平面上有 $n$ 个点 $v_i(x_i,y_i)$ 。求 $D(l)=\max_{1\le i\le n} dis(v_i,l)$ 的最小可能值，其中变量 $l$ 是平面上的一条直线，函数 $dis(v_i,l)$ 表示直线 $l$ 与点 $v_i$ 之间的距离。
## 输入格式

输入的第一行为一个正整数 $n$ 。接下来 $n$ 行，每行一对整数 $x_i , y_i$​​ ，用一个空格分隔，依次表示这 $n$ 个点的坐标，其中 $|x_i|,|y_i| \le 10^8$ ，且不同的点不会重合。
## 输出格式

输出只有一行，包含一个实数，即 $D(l)$ 的最小值，四舍五入到小数点后两位。
## 样例

### 样例输入 #1
```
6
1 0
2 0
3 0
3 2
4 0
5 0
```
### 样例输出 #1
```
1.00
```
### 样例输入 #2
```
6
-2 -1
-1 2
1 2
2 3
3 3
4 4
```
### 样例输出 #2
```
0.86
```
## 提示

**样例解释 1**

样例 $1$ 中， 取到最小值时的直线 $l$ 为 $y=1$ 。

**样例解释 2**

样例 $2$ 中的 $6$ 个点，以及 $D(l)$ 取到最小值时的直线 $l$ 如图所示。

![1](https://cdn.luogu.com.cn/upload/pic/20067.png)

**数据范围与提示**

测试点 $1$：$n=3$。

测试点 $2 \sim 4$：$3 \le n \le 100$。

测试点 $5 \sim 7$：$100 < n \le 100000$ ，且输入文件如下生成：选定一条线段，每次先在该线段上等概率随机选择一个点，再取离该点最近的整点。

测试点 $8 \sim 10$：$3 < n \le 100000$。


---

---
title: "[SHOI2011] 扫雷机器人"
layout: "post"
diff: 省选/NOI-
pid: P4637
tag: ['2011', '各省省选', '上海', 'Special Judge', '强连通分量', '期望']
---
# [SHOI2011] 扫雷机器人
## 题目描述

扫雷是陆军战场上一项重要的而危险的任务。为此， AL 军工厂专门研制了一种扫雷机器人。这种机器人是专门针对直线形雷阵设计的。所谓直线形雷阵，就是所有的地雷都埋在同一条直线上。例如图中黑点表示的雷阵就是直线形雷阵。

![0](https://cdn.luogu.com.cn/upload/pic/20066.png)

AL 军工厂生产的扫雷机器人的排雷方法只有一种，那就是安全引爆。每次，机器人在所有探测到的地雷中选择一颗引爆。被引爆的地雷会接连引爆不超过他的爆炸威力范围的其它地雷，这些被间接引爆的地雷还能引起进一步的连锁爆炸。例如图中，用一个圆的半径表示地雷的爆炸威力。如果引爆 $2$ 号雷， $1$ 、 $2$ 号雷都会爆炸；如果引爆 $3$ 号雷， $4$ 颗地雷全都会爆炸；而如果引爆 $4$ 号雷，那就只有它一颗爆炸。

虽然是机器人，但引爆也是危险的。所以，扫雷机器人的订购人希望机器人能在实战中采取引爆次数尽可能少的炸毁所有地雷的排雷方案。于是 AL 军工厂想就此方面对机器人进行测试。为了评估机器人的表现， AL 军工厂打算事先计算出：在一个直线形雷阵（即输入的雷阵）中，如果随机进行引爆，完成排雷工作所需要引爆次数的期望；并将这个值与机器人的实际排雷方案相比较，来评估他的表现。

所谓“随机进行引爆”是指，每次在所有没有被引爆的地雷中等概率的随机选择一个进行引爆。当这一次引爆引发的连环爆炸结束后，如果还有地雷没有被引爆，则重复上面的操作，直到所有地雷都被引爆为止。
## 输入格式

输入的第一行是一个正整数 $n$ ，表示地雷的个数。

接下去 $n$ 行，按照地雷的位置顺序，每行描述一颗地雷。其中，第 $i+1$ 行有两个整数 $x_i$ 和 $d_i$ ，分别是地雷的坐标和地雷的爆炸威力。也就是说，第 $i$ 号地雷的爆炸能直接进一步引爆第 $j$ 号地雷的条件是 $|x_i-x_j| \le d$ 。 输入保证： $|x_i| \le 10^8$ ， $1 \le d_i \le 10^8$ 。
## 输出格式

输出只有一行，包含一个实数，即为答案。四舍五入到小数点后四位。
## 样例

### 样例输入 #1
```
4
0 1
2 2
8 7
11 2
```
### 样例输出 #1
```
2.3333
```
### 样例输入 #2
```
3
-10 10
0 1
10 10
```
### 样例输出 #2
```
2.3333
```
### 样例输入 #3
```
2
1 10
2 100
```
### 样例输出 #3
```
1.0000

```
### 样例输入 #4
```
9
1 10
2 10
3 10
4 10
5 10
6 10
7 10
8 10
1000 2000
```
### 样例输出 #4
```
1.8889
```
## 提示

**提示**

本题的试题目录下有 $10$ 个额外的输入样例文件 ``robot20111.in~robot201110.in`` ，以及它们对应的输出样例文件 ``robot20111.out~robot201110.out`` 。这些数据符合本题中关于数据规模的全部约定，但它们不是最终的测试数据。

**[下载地址](https://pan.baidu.com/s/1Q5X52FMH38UYvmrEsVsEkA)**，密码：ypbv。

**评分方式**

在每个测试点，如果您的输出是 $YourAns$ ，而标准答案是 $StdAns$ ，那么：

-    当 $ |YourAns-StdAns| \le 0.0001$ 时，该测试点得 $10$ 分。

-    当 $0.01 \ge |YourAns-StdAns| > 0.0001$ 时，该测试点得 $6$ 分。

-    当 $0.5 \ge |YourAns-StdAns| > 0.01$ 时，该测试点得 $2$ 分。

-    否则得 $0$ 分。

**数据范围**

测试点 $1$：$n \le 20$。

测试点 $2$：$n \le 200$ ，且任意方案都保证引爆次数不超过 $20$。

测试点 $3$：$n \le 200$。

测试点 $4 \sim 5$：$n \le 4000$ ，且任意方案都保证引爆次数不超过 $20$。

测试点 $6 \sim 10$：$n \le 4000$。


---

---
title: "[SHOI2011] 银行家"
layout: "post"
diff: 省选/NOI-
pid: P4638
tag: ['2011', '各省省选', '上海']
---
# [SHOI2011] 银行家
## 题目描述

你在一家银行工作，任务是帮助客户取出他们存放在保险箱里的金币。

银行里有 $m$ 个保险箱，你没有办法打开这些保险箱，因为钥匙都在客户的手里。一个客户可能有很多个保险箱的钥匙，一个保险箱的钥匙也可能被多个客户拥有。今天早上，经理已经告知，你需要按照顺序接待 $n$ 个客户（任何客户都不会同时到场），你也知道，第 $i$ 个客户会要求取走 $c_i$​​ 枚金币。每个客户来到银行的时候，会打开所有他能打开的保险箱，然后从中取走 $c_i$​​ 枚金币（任何金币都没有区别），如果这些保险箱里的金币数量不足 ，他会感到不高兴，在取走尽量多的金币之后，到你的经理那里去投诉你们银行的服务质量太差了。

你当然不希望“上帝”的投诉让你丢了工作，于是想到了个补救的办法：虽然每个客户走的时候都会把保险箱重新关上，但是你可以在他取金币的时候，偷偷地调整被打开的保险箱里的金币数量，譬如说把 $1$ 号保险里多余的 $5$ 枚放到 $2$ 号里，这样说不定下个客户来的时候，就能取到更多的金币了。

尽管有这样的方法，还是可能没法完成所有客户的要求。然而，你希望，尽量帮助客户取走更多的金币，这样才能消除他们的怒气，保住这份来之不易的工作和薪水。 
## 输入格式

第一行有两个正整数： $m$ 和 $n$ ， $m$ 表示保险柜的数量， $n$ 表示客户的数量。

第二行有 $m$ 个非负正数，表示银行在开始营业前，第 $1$ 号保险柜到第 $m$ 号保险柜的金币数量。 接下来有 $n$ 行，按照前来银行的顺序，依次描述了每个客户的情况。每行的开始都是一个非负整数 $k$ ，接着有 $k$ 个 $1$ 到 $m$ 之间的整数 $a_1,a_2,…,a_k$ ，表示这个客户拥有 $a_1$​​ 号、 $a_2$ 号，直到 $a_k$​​ 号保险箱的钥匙。最后还有一个非负整数 $c_i$​​ ，表示他需要的金币数量。 输入保证所有出现在输入数据中的整数都不超过 $10000$ 。
## 输出格式

输出只需要一个整数，表示所有客户可以取走的金币总数的最大值。
输入保证答案不会超过 $100000$ 。 
## 样例

### 样例输入 #1
```
3 3
3 1 10
2 1 2 2
2 1 3 3
1 2 6
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
2 3
2 3
2 1 2 1
1 2 2
1 2 2
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
6 6
6 3 2 0 1 3
2 1 2 0
1 3 3
1 1 1
2 2 3 8
2 4 5 2
2 4 6 6
```
### 样例输出 #3
```
15
```
## 提示

### 数据范围

测试点编号 .|n$\le$ .|m$\le$ .
-|-|-
1|30|100
2|40|50
3|100|400
4|100|400
5|100|400
6|200|500
7|300|500
8|400|1500
9|500|2000
10|600|2500


---

---
title: "[SHOI2011] 编译优化"
layout: "post"
diff: 省选/NOI-
pid: P4639
tag: ['2011', '各省省选', '上海', '提交答案']
---
# [SHOI2011] 编译优化
## 题目背景

 
## 题目描述

就像 PASCAL 语言和 C/C++ 语言一样， SH 语言也是一种编程语言。 SH 语言共有 $26$ 个寄存器，用大写拉丁字母 A, B, … , Z 表示。 SH 语言的程序中，第一行依次是这 $26$ 个寄存器的初始值，用空格分隔。程序的第二行起，每一行都是一条命令。 SH 语言有三种命令，如下表所示（在格式这一列中，用下划线代替实际语言中的一个空格）。

-    ``ADD``命令 格式：``ADD_R1_R2``  功能：将寄存器 R2 的值加到寄存器 R1 上。 限制：无。

-    ``GOTO`` 命令 格式：``IF _R_ < _I1_ GOTO _LINE_ I2`` 功能：如果寄存器 R 的值小于立即数 I1 ，则跳转至第 I2 （ $\ge 2$ ）行，否则继续执行下一行。限制：至多出现一次，且只可能出现在第 I2 行之后。

-    ``PRINT`` 命令 格式：``PRINT_R`` 功能：打印寄存器 R 的值。限制：出现且仅出现在最后一行。

现给定一个 SH 语言的程序，请输出 ``PRINT`` 命令打印的值。
## 输入格式

每个输入文件都是一个 SH 语言的程序。输入文件保证：所有寄存器的初始值以及 ``GOTO`` 命令中出现的立即数，均为不超过 $2^{63}-1$ 的非负整数，但程序执行过程中寄存器的值不限于此。
## 输出格式

每个输出文件只有一行，包含一个整数，即 ``PRINT`` 命令所打印的值。
## 样例

### 样例输入 #1
```
0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
ADD A B
IF A < 220 GOTO LINE 2
PRINT A
```
### 样例输出 #1
```
300
```
## 提示

在每个测试点，如果您的输出与标准答案完全一致，您将能得到该测试点的全部分数；否则，您将在该测试点得 $0$ 分。

本题为提交答案题，所有的 $10$ 个输入文件 ``compiler1.in ~ compiler10.in`` 都已存放在题目背景的下载链接中。对于每个输入文件，您需要分别给出相应的输出文件 ``compiler1.out ~ compiler10.out``。

注意：您只需提交输出文件而无需提交任何程序。


---

---
title: "[ZJOI2007] 粒子运动"
layout: "post"
diff: 省选/NOI-
pid: P4682
tag: ['2007', '各省省选', '浙江']
---
# [ZJOI2007] 粒子运动
## 题目描述

阿Q博士正在观察一个圆形器皿中的粒子运动。不妨建立一个平面直角坐标系，圆形器皿的圆心坐标为$(x_0, y_0)$，半径为$R$。器皿中有若干个粒子，假设第$i$个粒子在时刻$0$的位置为$(x_i, y_i)$，速度为$(v_{x_i},v_{y_i})$（注：这是一个速度向量，若没有发生碰撞，$t$时刻的位置应该是$(x_i + t * v_{x_i}, y_i + t * v_{y_i})$ ）。假设所有粒子的运动**互不干扰**；若某个粒子在某个时刻碰到了器皿壁，将发生完全弹性碰撞，即速度方向按照碰撞点的切线镜面反射，且速度大小不变（如图）。认为碰撞是瞬间完成的。

![particle](https://cdn.luogu.com.cn/upload/pic/22046.png)

尽管碰撞不会影响粒子的速率，但是粒子却会受到一定的伤害，所以若某一个粒子碰撞了$k$次器皿壁，那么在第$k$次碰撞时它便会消亡。

出于研究的需要，阿Q博士希望知道从时刻$0$到所有粒子都消亡这段时间内，所有粒子之间的最近距离是什么。你能帮助他么？
## 输入格式

输入文件particle.in第一行包含三个实数，分别为$x_0, y_0, R$，即圆形器皿的圆心坐标及半径。第二行包含两个正整数$N, k$，分别表示粒子的总数与消亡碰撞次数。接下来$N$行每行四个实数，分别为$x_i, y_i, v_{x_i} , v_{y_i}$，保证$(x_i, y_i)$都在圆内且$(v_{x_i}, v_{y_i})$非零。
## 输出格式

输出文件particle.out仅包含一个实数，即所有粒子的历史最近距离，精确到小数点后三位。
## 样例

### 样例输入 #1
```
0 0 10
2 10
0 -5 0 1
5 0 1 0
```
### 样例输出 #1
```
7.071
```
## 提示

对于所有的数据，$2 \leq N \leq 100$。$1 \leq k \leq 100$。

请注意实数精度问题。


---

---
title: "[HNOI2009] 积木游戏"
layout: "post"
diff: 省选/NOI-
pid: P4729
tag: ['图论', '2009', '线段树', '各省省选', '湖南', '平面图欧拉公式']
---
# [HNOI2009] 积木游戏
## 题目描述

丹丹是一位狂热的俄罗斯方块爱好者，但在把积分刷爆之后她终于开始感到厌倦了。于是她着手思考这样一个俄罗斯方块的简化版游戏：在初始状态地面上是空的。假设所有的积木都是长方形，且积木不能旋转或翻转。丹丹在每个时刻会选择一个位置将一块积木落下，当积木在落下的过程中碰到地面或另一块积木时，它会停留在地面上或那块积木上。落到另—块积木上意味着：上面的积木的下边界与下面的积木的上边界至少有一条线段重合(―个点不算)，如图 1 所示。

![图1](https://cdn.luogu.com.cn/upload/pic/22107.png)

在俄罗斯方块中，如果某个时刻积木之间形成了一个洞，那么看上去就很不优美。于是丹丹想知道，每落下一块积木之后，会形成几个新的洞。一个洞是指由积木的边界或地面组成的一块面积大于 $0$ 的封闭的区域，如图 2（a）和图 2（b）所示。

要注意的是：当出现图 3 所示的情况时，因为积木 1 和积木 2 紧紧地挨在一起，所以当积木 3 落下的时候，不会形成新的洞。

现在丹丹告诉你她依次落下的积木的髙度 $H_i$ 以及落下的位置的左右边界 $L_i$ 与 $R_i$，$1 \leq i \leq n$，而她想知道毎次积木落下时会形成几个新的洞？

![图23](https://cdn.luogu.com.cn/upload/pic/22108.png)
## 输入格式

第一行包含一个正整数 $n$，表示落下的积木的总数。接下来有$n$行，每行有用一个空格隔开的三个整数，分别表示 $L_i$、$R_i$ 和 $H_i$，即积木落下的左右边界和积木的高度。
## 输出格式

包含 $n$ 行，每行只有一个数，第 $i$ 行表示第 $i$ 个积木落下后形成的新的洞的数目。
## 样例

### 样例输入 #1
```
6
1 3 2
4 7 2
2 5 1
3 6 1
8 11 2
6 8 3
```
### 样例输出 #1
```
0
0
1
0
0
2
```
## 提示

**【数据范围】**

输入数据保证 $0 \leq L_i < R_i \leq 100000, H_i \leq 1000$。

$30\%$ 的数据保证 $n \leq 100$。

$100\%$ 的数据保证$n \leq 100000$。

**【样例说明】**

样例执行后的结果如图 4 所示，其中依次落下的积木按顺序编号为从 $1$ 到 $6$ 的一个整数。

![图4](https://cdn.luogu.com.cn/upload/pic/22110.png)


---

---
title: "[AHOI2008] 矩形藏宝地"
layout: "post"
diff: 省选/NOI-
pid: P4793
tag: ['2008', '各省省选', '安徽']
---
# [AHOI2008] 矩形藏宝地
## 题目描述

欢乐岛上最著名的游戏是一个寻宝游戏，小可可来到宝藏的埋藏地，这是一块开阔地，宝藏被分散的埋藏在这块地下，现在要做的是一件件的把宝藏挖出来。为了提示宝藏的埋藏点，游戏的主办方把这块开阔地当作第一象限，将所有可能埋藏宝藏的地方划成一个个矩形的土地，并把这些矩形土地的坐标都告诉了参赛者。挖宝的提示很简单，只要某一个矩阵土地至少被另外一个矩阵土地所包含，那么这个矩阵土地里肯定埋有宝藏。其实这些宝藏都是一些精美的纪念品，如果谁挖出来了纪念品就归谁了，小可可很想为这次旅程画上完美的句号，有你的帮助他信心十足，你只要告诉他：有多少个矩形土地里肯定埋有宝藏就行了。胜利就在眼前，加油吧！
## 输入格式

第一行包含一个整数 $N\leq 200000$，表示矩形的个数。
接下来 $N$ 行，每行用 $4$ 个整数 $x_1,\,y_1,\,x_2,\,y_2$，描述了一个矩形。其中 $(x_1,\,y_1)$ 表示这个矩形左下角的坐标，$(x_2,\,y_2)$ 表示右上角的坐标，一个 $x$ 值或 $y$ 值最多出现一次。 
## 输出格式

只包含一个整数，表示肯定埋有宝藏的矩形土地的个数。 
## 样例

### 样例输入 #1
```
3
0 0 5 5
1 2 3 4
2 1 4 3

```
### 样例输出 #1
```
2

```
## 提示

$30\%$ 的数据中，$N\leq 5000$。

$70\%$ 的数据中，$N\leq 50000$。

$100\%$ 的数据中，$N\leq 200000$。

所有数据中，一个 $x$ 值或 $y$ 值最多出现一次。坐标范围 $2\times 10 ^ 6$。


---

---
title: "[JSOI2014] 学生选课"
layout: "post"
diff: 省选/NOI-
pid: P4835
tag: ['2014', '各省省选', '江苏']
---
# [JSOI2014] 学生选课
## 题目描述

进入大学以后，学生们将面临选课，有 $n$ 个学生需要选课，学校里有三个老师 JYY，YJY，YYJ。

第一年里，每个学生们都选择了其中一位老师。经过了一年的学习，学生之间相互都有一定的印象，每个同学会根据自己的印象给另外 $n-1$ 个学生从好到坏排序。第二年的选课开始了，每个学生需要选择老师，可能是因为被坑多了，每一位同学都想换一个老师。这时需要你来调度同学们选课，使得上同一堂课的学生之间印象最坏的最好。
## 输入格式

第一行一个整数 $n$。

接下来 $n$ 行，每行 $n$ 个正整数，其中第 $i+1$ 行提供第 $i$ 个同学的信息。其中第一个整数 $A_i$，值为 $0,1,2$ 中的一个，表示第一年第 $i$ 个同学选的老师。
接下来 $n-1$ 个数字，是 $1,2,\cdots,i-1,i+1,\cdots,n$ 的一个排列，表示第 $i$ 个同学对其他同学印象从好到坏的排序。
## 输出格式

一行一个整数，为最小的非负整数 $T$，满足：

- 所有同学选择了和第一年不同的老师。

- 所有选择同一个老师的学生间彼此印象都是前 $T$ 好的。
## 样例

### 样例输入 #1
```
6
0 2 3 4 5 6
0 1 3 4 5 6
1 6 5 4 2 1
2 6 5 3 2 1
1 1 2 3 4 6
2 1 2 3 4 5
```
### 样例输出 #1
```
4
```
## 提示

### 样例解释 1

六名同学分别选择老师 $1,2,0,0,2,0$。

此时老师 $0$ 的课中同学 $6$ 对同学 $4$ 的印象为第 $4$ 好，所以答案 $T$ 为 $4$，并且找不到更小的 $T$。

### 数据范围

对于 $100\%$ 的数据，$n\leq 1000$。


---

---
title: "[SNOI2017] 炸弹"
layout: "post"
diff: 省选/NOI-
pid: P5025
tag: ['2017', '线段树', '各省省选', '强连通分量']
---
# [SNOI2017] 炸弹
## 题目描述

在一条直线上有 $n$ 个炸弹，每个炸弹的坐标是 $ x_i $，爆炸半径是 $ r_i $，当一个炸弹爆炸时，如果另一个炸弹所在位置 $ x_j $ 满足： 
$ |x_j-x_i| \le r_i $ ，那么，该炸弹也会被引爆。    
现在，请你帮忙计算一下，先把第 $i$ 个炸弹引爆，将引爆多少个炸弹呢？ 

答案对 $10^9 + 7$ 取模
## 输入格式

第一行，一个数字 $n$ ，表示炸弹个数。 
第 $2 \sim n+1$ 行，每行两个整数，表示 $x_i$，$r_i$，保证 $x_i$ 严格递增。
## 输出格式

一个数字，表示 $\sum \limits_{i=1}^n i\times$ 炸弹 $i$ 能引爆的炸弹个数。
## 样例

### 样例输入 #1
```
4
1 1
5 1
6 5
15 15
```
### 样例输出 #1
```
32
```
## 提示

【数据范围】  
对于  $20\%$ 的数据： $n\leq 100$。

对于  $50\%$ 的数据： $n\leq 1000$。

对于  $80\%$ 的数据： $n\leq 100000$。

对于  $100\%$ 的数据： $1\le n\leq 500000$，$-10^{18}\leq x_{i}\leq 10^{18}$，$0\leq r_{i}\leq 2\times 10^{18}$。


---

---
title: "[SCOI2012] 奇怪的游戏"
layout: "post"
diff: 省选/NOI-
pid: P5038
tag: ['2012', '四川', '各省省选']
---
# [SCOI2012] 奇怪的游戏
## 题目描述

Blinker 最近喜欢上一个奇怪的游戏。 

这个游戏在一个 $N \times M$ 的棋盘上玩，每个格子有一个数。每次 Blinker 会选择两个相邻的格子，并使这两个数都加上 $1$。 

现在 Blinker 想知道最少多少次能使棋盘上的数都变成同一个数，如果永远不能变成同一个数则输出 $-1$。 
## 输入格式

输入的第一行是一个整数 $T$，表示输入数据有 $T$ 轮游戏组成。 

每轮游戏的第一行有两个整数 $N$ 和 $M$，分别代表棋盘的行数和列数。  
接下来有 $N$ 行，每行 $M$ 个数。 
## 输出格式

对于每个游戏输出最少能使游戏结束的次数，如果永远不能变成同一个数则输出 $-1$。
## 样例

### 样例输入 #1
```
2 
2 2 
1 2 
2 3 
3 3 
1 2 3 
2 3 4 
4 3 2 
```
### 样例输出 #1
```
2 
-1 

```
## 提示

对于 $30\%$ 的数据，保证 $ T\le 10,1\le N,M \le 8$。   
对于 $100\%$ 的数据，保证 $T \le 10,1 \le N,M\le 40$，所有数为正整数且小于 $10^9$。 


---

---
title: "[SHOI2010] 最小生成树"
layout: "post"
diff: 省选/NOI-
pid: P5039
tag: ['2010', '各省省选', '上海']
---
# [SHOI2010] 最小生成树
## 题目描述

Secsa最近对最小生成树问题特别感兴趣。他已经知道如果要去求出一个 $ n $ 个点、 $ m $ 条边的无向图的最小生成树有一个Krustal算法和另一个Prim的算法。另外，他还知道，某一个图可能有多种不同的最小生成树。例如，下面图3中所示的都是图2中的无向图的最小生成树：

![](https://cdn.luogu.com.cn/upload/pic/43631.png)

当然啦，这些都不是今天需要你解决的问题。Secsa想知道对于某一条无向图中的边AB，至少需要多少代价可以保证AB边在这个无向图的最小生成树中。为了使得AB边一定在最小生成树中，你可以对这个无向图进行操作，一次单独的操作是指：先选择一条图中的边 P1P2，再把图中除了这条边以外的边，每一条的权值都减少 $ 1 $ 。如图4所示就是一次这样的操作：

![](https://cdn.luogu.com.cn/upload/pic/43632.png)


## 输入格式

输入文件的第一行有3个正整数 $ n,m,Lab $ 分别表示无向图中的点数、边数、必须要在最小生成树中出现的AB边的标号。

接下来 $ m $ 行依次描述标号为 $ 1,2,3 \ldots m $ 的无向边，每行描述一条边。每个描述包含3个整数 $ x,y,d $ ，表示这条边连接着标号为 $ x,y $ 的点，且这条边的权值为 $ d $ 。

输入文件保证 $ 1 \leq x,y \leq N $ ， $ x \neq y $ ，且输入数据保证这个无向图一定是一个连通图。
## 输出格式

输出文件只有一行，这行只有一个整数，即，使得标号为 $ Lab $ 边一定出现最小生成树中的最少操作次数。
## 样例

### 样例输入 #1
```
4 6 1
1 2 2
1 3 2
1 4 3
2 3 2
2 4 4
3 4 5
```
### 样例输出 #1
```
1
```
## 提示

$ 1 \leq N \leq 500,1 \leq M \leq 800,1 \leq d<10^6 $


---

---
title: "[SHOI2014] 神秘金字塔"
layout: "post"
diff: 省选/NOI-
pid: P5215
tag: ['2014', '各省省选', '上海']
---
# [SHOI2014] 神秘金字塔
## 题目背景

SHOI2014 day2t3
## 题目描述

对神经组织的进化生物学研究将历史追溯到了人类社会形成之初、一个叫做 CCM 的神秘部落。

考古学证据表明，CCM 一度具有高度繁华的文明。然而 CCM 的历史却似乎在一夜之间神秘地消失了。考古学家近日在大西洋底发掘出了一处 CCM 文明遗迹,有希望能够揭开 CCM 古文明失落之谜。

CCM 遗迹的中央是一座巨大的石质建筑,被考古学家称之为金字塔。金字塔有这样四条性质:
1. CCM 金字塔由完全相同的 $1 \times 1 \times 1$ 单位的立方体石块构成；
2. CCM 金字塔由若干层组成，每一层的石块从正上方看都在平面上形成一个联通块。高层的石块都有低层的石块在下方作为支撑，不会有石块悬空；
3. CCM 金字塔的每一层严格都满足左右对称和上下对称，并且所有层的对称轴是重合的，从左右/上下对称轴向两端长度/宽度非严格递减；
4. CCM 金字塔的每一层的最大长度和最大宽度都相等，并且都是偶数（因为 CCM 人认为偶数代表了好运而奇数则会带来不幸）。

然而，不幸的是，遗迹中的金字塔由于年代过于久远，已经残缺不全，难以辨认全貌。为了尽可能地还原 CCM 金字塔的实际情况，考古学家们通过其他证据估计出了 CCM 金字塔所使用的石块个数、金字塔的高度以及每一层的宽度，他们想请你帮忙计算符合上述性质的可能的金字塔个数。
## 输入格式

第一行两个整数 $n,h$，表示 CCM 金字塔的总石块数和 CCM 金字塔的高度。  
从第二行开始的 $h$ 行，每行一个整数 $l$，表示从最底层开始的每一层的最大长度(宽度)，保证非严格递减。
## 输出格式

输出一行一个整数，表示可能的金字塔个数。由于方案数可能数量很大，输出答案为模 $10^9+7$ 之后的结果。
## 样例

### 样例输入 #1
```
36 3
6
4
2
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
44 2
6
4

```
### 样例输出 #2
```
3
```
## 提示

对于 10%的数据，$h=1$。

对于 30%的数据，$n\leq 200,l\leq 10, h\leq 5$。

对于 70%的数据，$n\leq 800,l\leq 20, h\leq8$。

对于 100%的数据，$n\leq 1000, 2\leq l\leq 20, 1\leq h\leq 10$。

![](https://cdn.luogu.com.cn/upload/pic/51009.png)


---

---
title: "[SCOI2015] 小凸解密码"
layout: "post"
diff: 省选/NOI-
pid: P5226
tag: ['2015', '四川', '线段树', '各省省选']
---
# [SCOI2015] 小凸解密码
## 题目描述

小凸得到了一个密码盘，密码盘被等分成 $n$ 个扇形，每个扇形上有一个数字 $(0 \sim 9)$，和一个符号 $($ `+` 或 `*` $)$。密码盘解密的方法如下：

首先，选择一个位置开始，顺时针地将数字和符号分别记在数组 $A$ 和数组 $C$ 中。解密的方法如下：

- $B_0 = A_0$
- 当 $x > 0$ 时：
  - 若 $C_x$ 为 `+`，$B_x = (A_x + A_{x - 1}) \% 10$
  - 若 $C_x$ 为 `*`，$B_x = (A_x \times A_{x - 1}) \% 10$

操作完成后，可以得到一个长度为 $n$ 的数组 $B$，然后以 $B_0$ 为起点将 $B$ 数组顺时针写成一个环，解密就完成了，称得到的环为答案环。

现在小凸得到了一份指令表，指令表上有 2 种操作。一种指令是修改操作，即改变原来密码盘上一个位置的数字和符号。另一种指令是询问操作，具体如下：

- 首先从指令给出的位置开始完成解密，得到答案环。
- 答案环上会有一些 $0$ 连在一起，将这些连在一起的 $0$ 称为零区间，找出其中距离 $B_0$ 最远的那个零区间，输出这个距离（零区间和 $B_0$ 的距离定义为：零区间内所有 $0$ 到 $B_0$ 距离中的最小值）。
## 输入格式

第一行包含两个整数 $n, m$，代表密码盘大小和指令个数。

接下来 $n$ 行，每行包含一个整数和一个字符，按顺时针顺序给出了密码盘上的数组和符号。

接下来 $m$ 行，依次给出指令。每行第一个整数代表指令类型：

- 若第一个整数为 `1`，代表本行对应指令为修改操作，之后依次有两个整数 $pos, num$ 和一个字符 $\rm opt$，分别代表修改的位置，以及修改后该位置的数字和字符。
- 若第一个整数为 `2`，代表本行对应指令位询问操作，之后有一个整数 $pos$，代表本次操作中解密的开始位置。

密码盘上的位置标号为 $0$ 到 $n - 1$。

数据保证合法，即数据中 $0 \leq pos < n, 0 \leq num \leq 9$，$\rm opt$ 为 `+` 或 `*`。
## 输出格式

对于每个询问操作 $1$ 行，输出答案，若答案环上没有 $0$，输出 `−1`。
## 样例

### 样例输入 #1
```
5 8
0 *
0 *
0 *
0 *
0 *
2 0
1 0 1 +
1 2 1 +
2 3
1 1 1 +
1 3 1 +
1 4 1 +
2 4

```
### 样例输出 #1
```
0
2
-1

```
## 提示

**样例解释：**

对于第 $1$ 个询问，答案环为 $\{0, 0, 0, 0, 0\}$，仅有 $1$ 个零区间，且 $B_0$ 在其中，所以距离是 $0$。  
对于第 $2$ 个询问，答案环为 $\{0, 0, 1, 0, 1\}$，有 $2$ 个零区间，$[0, 1]$ 和 $B_0$ 距离是 $0$，$[3, 3]$ 和 $B_0$ 距离是 $2$，故答案为 $2$。  
对于第 $3$ 个询问，答案环为 $\{1, 2, 2, 2, 2\}$，没有零区间，答案是 `−1`。

**数据范围：**

对于 $20 \%$ 数据，$5 \leq n \leq 10^5, 5 \leq m \leq 1000$；  
对于 $60 \%$ 数据，$5 \leq n \leq 10^5, 5 \leq m \leq 10^4$；  
对于 $100 \%$ 数据，$5 \leq n, m \leq 10^5$。



---

---
title: "[AHOI2013] 连通图"
layout: "post"
diff: 省选/NOI-
pid: P5227
tag: ['2013', '线段树', '并查集', '各省省选', '安徽', 'O2优化', '动态树 LCT']
---
# [AHOI2013] 连通图
## 题目描述

给定一个无向连通图和若干个小集合，每个小集合包含一些边，对于每个集合，你需要确定将集合中的边删掉后改图是否保持联通。集合间的询问相互独立

定义一个图为联通的当且仅当对于任意的两个顶点，都存在一条路径连接它们
## 输入格式

第一行为两个整数 $n,m$，代表无向图的点数和边数

下面 $m$ 行，包含两个整数 $u,v$，代表该边连接点 $u,v$。第 $i + 1$ 行的边的编号为 $i$。保证不存在重边和自环

下面一行包含一个整数 $k$，表示集合个数

下面 $k$ 行每行描述一个集合，每行的第一个数为集合中边的个数 $c$，后面 $c$ 个数代表集合内的边
## 输出格式

对于每个集合，输出一行代表去掉该集合中的边后图是否联通，如果联通输出 ``Connected``，否则输出 ``Disconnected``
## 样例

### 样例输入 #1
```
4 5
1 2
2 3
3 4
4 1
2 4
3
1 5
2 2 3
2 1 2
```
### 样例输出 #1
```
Connected
Disconnected
Connected
```
## 提示

$1~\leq~n,k~\leq~10^5$

$1~\leq~m~\leq~2~\times~10^5$

$1~\leq~c~\leq~4$


---

---
title: "[AHOI2013] 立方体"
layout: "post"
diff: 省选/NOI-
pid: P5229
tag: ['2013', '各省省选', '安徽', 'O2优化']
---
# [AHOI2013] 立方体
## 题目描述

在一个三维空间中有 $N$个立方体，第 $i$ 个立方体占据 $x_{i_1},y_{i_1},z_{i_1}$ —— $x_{i_2}, y_{i_2}, z_{i_2}$的位置。这 $N$ 个立方体可能有相交，也可能重叠。他们构成了一个大的几何图形。现在求这个几何图形的外表面积
## 输入格式

第一行，一个整数 $N$，表示立方体的个数。

第二行至第 $N+1$ 行，每行 $6$ 个用空格隔开的整数，分别表示$x_1$,$y_1$,$z_1$,$x_2$,$y_2$,$z_2$. 
## 输出格式

一行，一个整数，表示外表面积的大小。
## 样例

### 样例输入 #1
```
1
0 0 0 1 1 1
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
2 
0 1 0 3 2 1
1 0 0 2 3 1
```
### 样例输出 #2
```
22
```
## 提示

所有数据 $\in~[0,200]$。

$x_1~\leq~x_2$

$y_1~\leq~y_2$

$z_1~\leq~z_2$



---

---
title: "[AHOI2013] 好方的蛇"
layout: "post"
diff: 省选/NOI-
pid: P5230
tag: ['2013', '各省省选', '安徽', 'O2优化']
---
# [AHOI2013] 好方的蛇
## 题目描述

有一天，可爱的蛇心花怒放，把自己变成了一个正方形！但是她改变的时候
被induce了导致改变出了些问题.... 
 
按照预设，她应该变成一个 $N*N$ 的全黑正方形，但是这个正方形出现了一些白的格子...现在她的身体不幸出了些小反应，定义一个subsnake是一个至少有两格的全黑矩形。 

![qwq](http://images.cnblogs.com/cnblogs_com/yifusuyi/1229574/o_1(1).jpg)

现在蛇想让你帮忙求一下一共有多少对不相交的subsnake，答案模10007。
## 输入格式

第一行一个整数 $N$,   接下来 $N$ 行，每行一个长度为 $N$ 的字符串，如果是 $B$，那么是黑的，如果是 $W$ 那么是白的。 
## 输出格式

一行一个整数，表示答案
## 样例

### 样例输入 #1
```
3 
BBW
BBW 
BWW 
```
### 样例输出 #1
```
5
```
## 提示

$1~\leq~N~\leq~1000$


---

---
title: "[JSOI2012] 玄武密码"
layout: "post"
diff: 省选/NOI-
pid: P5231
tag: ['字符串', '2012', '各省省选', '江苏', '后缀自动机 SAM', 'O2优化', 'AC 自动机', '后缀数组 SA']
---
# [JSOI2012] 玄武密码
## 题目背景

在美丽的玄武湖畔，鸡鸣寺边，鸡笼山前，有一块富饶而秀美的土地，人们唤作进香河。相传一日，一缕紫气从天而至，只一瞬间便消失在了进香河中。老人们说，这是玄武神灵将天书藏匿在此。 

很多年后，人们终于在进香河地区发现了带有玄武密码的文字。更加神奇的是，这份带有玄武密码的文字，与玄武湖南岸台城的结构有微妙的关联。于是，漫长的破译工作开始了。
## 题目描述

 经过分析，我们可以用东南西北四个方向来描述台城城砖的摆放，不妨用一个长度为 $n$ 的序列 $s$ 来描述，序列中的元素分别是 `E`，`S`，`W`，`N`，代表了东南西北四向，我们称之为母串。而神秘的玄武密码是由四象的图案描述而成的 $m$ 段文字。这里的四象，分别是东之青龙，西之白虎，南之朱雀，北之玄武，对东南西北四向相对应。 

现在，考古工作者遇到了一个难题。对于每一段文字 $t$，求出其最长的前缀 $p$，满足 $p$ 是 $s$ 的子串。
## 输入格式

第一行有两个整数，分别表示母串的长度 $n$ 和文字段的个数 $m$。

第二行有一个长度为 $n$ 的字符串，表示母串 $s$。

接下来 $m$ 行，每行一个字符串，表示一段带有玄武密码的文字 $t$。
## 输出格式

对于每段文字，输出一行一个整数，表示最长的 $p$ 的长度。
## 样例

### 样例输入 #1
```
7 3
SNNSSNS
NNSS
NNN
WSEE

```
### 样例输出 #1
```
4
2
0
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $n \leq 100$，$m \leq 50$。
- 对于 $40\%$ 的数据，保证 $n \leq 2 \times 10^4$，$m \leq 2 \times 10^3$。
- 对于 $70\%$ 的数据，保证 $n \leq 10^6$，$m \leq 2 \times 10^4$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 10^7$，$1 \leq m \leq 10^5$，$1 \leq |t| \leq 100$，$s, t$ 中均只含字母 `E` `S` `W` `N`。


---

---
title: "[JSOI2012] 智者的考验"
layout: "post"
diff: 省选/NOI-
pid: P5232
tag: ['2012', '各省省选', '江苏', 'O2优化']
---
# [JSOI2012] 智者的考验
## 题目描述

公元$1371$年，太祖下令在北极阁上大建庙宇，短短几年，鸡笼山上便建成了帝王庙、关公庙、真武庙、功臣庙、蒋王庙、都城隍庙、卞壶庙、忠烈庙、刘越王庙、曹武惠王庙共十座庙宇，统称为“十庙”。 

后来，为了方便人们来鸡笼山进香礼佛，太祖下令疏通了鸡笼山下已淤塞多年的潮沟。于是，便有了“进香河”。 

然而并不是所有人都可以来鸡笼山的，太祖在进香河上修建了一座石桥，中间悬挂了一块高$Rx$宽$Ry$的机关格图（如下图所示）。所有格子都是活动可翻转的，一面是白色，一面是黑色，这里我们用$0$表示白色，用$1$表示黑色。初始情况下，所有格子都是白色面朝前的。有$Rx+Ry$个机关按钮，对应$Rx$行和$Ry$列。一个按钮一旦触发，就会引发对应的一行或一列的格子同时翻转。
 
![](https://cdn.luogu.com.cn/upload/pic/52643.png)

同时，善于识天象的谋臣刘基给出了一种黑白状态，称之为“厄运星”。每一位过往前去鸡笼山的人都需要触发且只触发一个按钮，触发后，如果来访者呈“厄运星”形状，则不允许通过。 

每一天要来鸡笼山的人数$N$是事先就知道的，同时天朝神威浩荡，每一位来者一开始总是有很大概率触发编号为$1$的按钮，我们不妨用数列$A_1$,$A_2$,$\dots$,$A_N$来表示，问题保证了初始时候的$A$数列全为$1$。同时在整个问题中，$A_i$满足$1 \leq A_i \leq Rx+Ry$。太祖很关心那些不允许去鸡笼山的人数。于是他时不时就会询问关于“某一段时间内会有多少人不能通过“厄运星”的考验”。然而那些前来鸡笼山的文人墨客并不愿意如此单一的操作。来访者有可能会突然决定修改自己的触发按钮。更麻烦的情况，结伴而来的连续若干人会突然决定修改触发按钮并且都去触发同一个按钮。 

现在这麻烦的问题交给了你。 
## 输入格式

输入文件第一行有$2$个数字$Rx$和$Ry$表示机关格图的高和宽（如图所示）。之后$Rx$行每一行$Ry$个数字，描述了“厄运星”形状，每一个数字都满足非$0$即$1$。 

之后一行有两个数字，分别为$N$和$M$，表示人数和询问修改的次数。 

之后$M$行，对应$M$次询问或修改。每一行先有一个数字$t$： 

若$t$为$0$：之后有$2$个数字$d$和$x$，表明将$A_d$修改为$x$。
 
若$t$为$1$：之后有$2$个数字$l$和$r$，表明询问第$l$个人到第$r$个人中有多少人触发按钮后会出现“厄运星”形状，从而无法通过。

若$t$为$2$：之后有$3$个数字$l$,$r$和$x$，表明将$A_l$,$A_{l+1}$,$\dots$,$A_{r-1}$,$A_r$都修改为$x$。 
## 输出格式

对于每一次询问(即$t$为$1$的情况)，输出单独一行，一个整数描述了在区间$[l,r]$中满足要求的人数。
## 样例

### 样例输入 #1
```
2 3 
0 0 1 
1 1 0 
7 4 
1 1 7 
0 2 3 
0 3 4	
1 1 7
```
### 样例输出 #1
```
0
3
```
## 提示

对于$40\%$的数据，$N \leq 5000$,$M \leq 10000$。

存在$70\%$的数据，$N \leq 130000$,$M \leq 30000$。

对于$100\%$的数据，$N \leq 1000000$，$M \leq 120000$，$Rx \leq 2$，$Ry \leq 3$。


---

---
title: "[JSOI2012] 爱之项链"
layout: "post"
diff: 省选/NOI-
pid: P5233
tag: ['2012', '各省省选', '江苏', 'O2优化']
---
# [JSOI2012] 爱之项链
## 题目描述

在进香河，流传着这样一段美丽的故事。$zyg$与$kzn$是两个生活在进香河的孩子，一天，他们两人闹矛盾了，于是$zyg$送给了$kzn$一条精美的爱之项链。从此他们幸福生活在一起。

这则故事的真实性到今天已经没有意义了，然而我们关注的是那一条精美的爱之项链。这是一条由$N$个精致的戒指与一块特殊纪念品相连而成的环形，如下图中的爱心符号正是一种特殊纪念品。(据说是$2012$年情人节时$zyg$特意托人订制的)上面的每一枚戒指又是由$M$个带磁性的特殊彩色球状物组成的环形。也许你会认为，这所谓的戒指，更像是一条条小项链。

下图给出了一种可行的方案，其中左边描述的是单一的一枚戒指，右图描述的是项链。

![](https://cdn.luogu.com.cn/upload/pic/52648.png) 

这里，所有带磁性的特殊彩色球状物的颜色只有$R$种，这里我们用$1$到$R$来表示。如果一枚戒指可以通过顺时针或逆时针的旋转后与另外一枚戒指相同，则认为这是两枚相同的戒指。 

对于一条爱之项链，要求满足任何相邻两枚戒指必须是不相同的。同时，特殊纪念品左右两枚戒指也必须是不同的。 

现在给定$N$，$M$和$R$，问究竟有多少种不同的爱之项链。 

注意： 

$1$、特殊纪念品的插入位置不同，也许会得到不同的爱之项链。
 
$2$、这里我们只考虑旋转后是否相同，不考虑翻转操作，这一点不论是对于每一枚戒指，还是对于整条项链，都是这样的。
## 输入格式

一行，三个正整数，分别是$N$，$M$和$R$。
## 输出格式

一行，表示有多少种不同的爱之项链。你只需要将答案模$3214567$。
## 样例

### 样例输入 #1
```
10 5 4
```
### 样例输出 #1
```
1398595
```
## 提示

对于$30\%$的数据，$N \leq 10^3$，$M \leq 3 \times 10^2$，$R \leq 10^2$。

对于$60\%$的数据，$N \leq 3 \times 10^4$，$M \leq 2 \times 10^3$，$R \leq 10^5$。

对于$80\%$的数据，$N \leq 10^7$，$M \leq 10^6$，$R \leq 10^6$。

对于$100\%$的数据，$N \leq 10^{15}$，$M \leq 10^9$，$R \leq 10^6$。


---

---
title: "[JSOI2012] 越狱老虎桥"
layout: "post"
diff: 省选/NOI-
pid: P5234
tag: ['2012', '各省省选', '江苏', 'O2优化']
---
# [JSOI2012] 越狱老虎桥
## 题目背景

这里，是美丽的南京；这里，是秀美的进香河；这里是安逸的老虎桥。 

如果说进香河的美，美在其秀美的风光，倒不如说是美在了那惬意的南京古典小巷式生活。如果说进香河的迷人，在其淳朴的民风，倒不如说是那被历史掩埋了的秘密吸引着人们好奇的心。 

也许很多人都还记得，老虎桥监狱，北洋时期江南最大的监狱，在近一个世纪中，面对满清、北洋、民国、新中国几朝兴衰，名称屡次更替，沧桑尽显其中。 

现在的人们，恐怕很难相信，到底有多少惊心动魄的事情曾经就在这里上演。 
## 题目描述

那是$1948$年的冬天，南京地下组织的一支小分队决定偷袭老虎桥监狱，救出被困的数百名人员。那时的老虎桥监狱，被$N$层电网围了起来，由内而外，依次编号为$1$,$2$,$\dots$,$N$。第$1$层电网接有高压电。有$M$条高压线，连接了所有电网，其中第$i$条高压线连接了第$a_i$和$b_i$层电网，如果要破坏第$i$条高压线，需要至少动用$T_i$位特工。面对这么多层电网，偷袭小分队犯愁了。至少需要破坏一层电网，否则是无法偷袭成功的。
 
然而，狡猾的间谍却知道了这件事情，为了破坏偷袭计划，敌人秘密地又增加了一条高压线，不让偷袭小分队的成员发现。 

为了能够偷袭成功，不论新增的这一条秘密高压线是连接哪两层电网的，小分队都必须要破坏且仅破坏一条高压线，使得至少有一层电网不通电。注意，对于新增的高压线，我们并不知道需要多少位特工才能成功破坏。现在的问题是，偷袭小分队至少需要多少名特工呢？
 
决战就在今夜！
## 输入格式

第一行有$2$个整数，$N$和$M$，分别表示电网层数和高压线个数。 
之后$M$行，每行$3$个整数，分别是$a_i$,$b_i$和$T_i$。
## 输出格式

输出只有一行，包含一个整数，表示最少需要动用的特工人数。 
如果计划必然失败，则输出$-1$。
## 样例

### 样例输入 #1
```
3 2
1 2 1
2 3 2
```
### 样例输出 #1
```
-1
```
### 样例输入 #2
```
4 3
1 2 1
1 3 2
1 4 3
```
### 样例输出 #2
```
3
```
## 提示

对于$30\%$的数据，$N \leq 200$，$M \leq 250$。

对于$70\%$的数据，$N \leq 50000$，$M \leq 100000$。

对于$100\%$的数据，$N \leq 500000$，$M \leq 1000000$，$T \leq 100000$。

对于第二组样例，新增的高压线只有可能出现在$2$和$3$，$2$和$4$或$3$和$4$之间。

如果出现在了$2$和$3$之间，则只能破坏$1$和$4$之间的高压线；如果出现在$2$和$4$之间，则只能破坏$1$和$3$之间的高压线；如果出现在$3$和$4$之间，则只能破坏$1$和$2$之间的高压线。

所以，至少需要出动$3$位特工，才能应付所有可能情况。


---

---
title: "[JSOI2013] 游戏中的学问"
layout: "post"
diff: 省选/NOI-
pid: P5259
tag: ['2013', '各省省选', '江苏', 'O2优化']
---
# [JSOI2013] 游戏中的学问
## 题目描述

大家应该都见过很多人手拉手围着篝火跳舞的场景吧？一般情况下，大家手拉手跳舞总是会围成一个大圈，每个人的左手拉着旁边朋友的右手，右手拉着另
一侧朋友的左手。

不过，如果每一个人都随机的拉住两个不同人的手，然后再慢慢散开，事情
就变得有趣多了——此时大家依旧会形成圈，不过却可能会形成多个独立的圈。
当然这里我们依然要求一个人的右手只能拉另一个人的左手，反之亦然。

班里一共有 $N$ 个同学，由 $1$ 到 $N$ 编号。Will想知道，究竟有多少种本质不
同的拉手方案，使得最终大家散开后恰好形成 $k$ 个圈呢？

给定两种方案，若存在一个人和他的一只手，满足在这两种方案中，拉着这
只手的人的编号不同，则这两种方案本质不同。
## 输入格式

输入一行包含三个正整数$N,~k,~P$
## 输出格式

输出文件的包含一行一个整数，表示本质不同的方案数对p的余数。保证p
一定是一个质数。
## 样例

### 样例输入 #1
```
3 1 1000000009 
```
### 样例输出 #1
```
2
```
## 提示

$3~\leq~3k~\leq~N~\leq~3000$

$10^4~\leq~p~\leq~2~\times~10^9$


---

---
title: "[JSOI2013] 数字理论"
layout: "post"
diff: 省选/NOI-
pid: P5261
tag: ['2013', '各省省选', '江苏', 'O2优化']
---
# [JSOI2013] 数字理论
## 题目描述

给定 $4$ 个正整数 $K,~S,~P,~D$，要求在十进制数中，寻找一个最小的 $K$ 位自然数 $x$，满足 $x$ 的各个数位之和为 $S$，并且 $x$ 乘以 $D$ 之后各个数位之和为 $P$。
## 输入格式

输入数据中包含一行四个整数，分别为 $K,~S,~P,~D$。

## 输出格式

输出一行一个整数，表示满足条件的最小自然数 $x$。如果不存在则输出$-1$。
## 样例

### 样例输入 #1
```
2 9 9 5
```
### 样例输出 #1
```
18
```
## 提示

$1~\leq~K~\leq~100,~1~\leq~S,~P~\leq~1000,~1~\leq~D~\leq~9$


---

---
title: "[JSOI2013] 打地鼠"
layout: "post"
diff: 省选/NOI-
pid: P5263
tag: ['2013', '各省省选', '网络流', '江苏', 'O2优化']
---
# [JSOI2013] 打地鼠
## 题目背景

JYY 特别喜欢到游戏厅玩打地鼠游戏——拿起两个锤子用力敲打不断冒出
来的地鼠。

打到不同的地鼠有不同的得分，JYY想知道怎样才能得到最高的分
数。
## 题目描述

游戏里一共会冒出来 $N$ 个地鼠，这些地鼠冒出来的位置都分布在一条直线
上。第 $i$ 个地鼠会在 $T_i$ 时刻在 $X_i$ 位置冒出来，打到第 $i$ 个地鼠的得分是 $P_i$。

当游戏开始时（也就是 0 时刻），JYY 左手的位置为 XLEFT，右手的位置为
XRIGHT。JYY的手的最大移动速度是 $V$（每单位时刻最多移动的距离为 V） 。

地鼠会在瞬间冒出来然后消失。如果在对应的时刻 JYY 的一只手恰好也在地鼠冒出来的位置，那么 JYY 就可以在瞬间完成击打动作并得到对应的分数,否则，JYY就只能错过这只地鼠了。

JYY两只手都拿着锤子，所以两只手是可以同时打地鼠的。

然而， 如果在游戏过程中 JYY的两只手交叉的话， JYY会感到很不舒服 （这
个动作确实很别扭，而且两只手可能会互相阻碍而影响移动速度） ，所以 JYY希
望在整个游戏过程中左手的位置 XLEFT永远严格小于右手的位置XRIGHT。JYY想知道，他最多能得多少分呢？
## 输入格式

第一行包含四个整数$N,~V,~XLEFT,~XRIGHT$；
接下来 $N$ 行，分别描述 $N$ 个可能出现的地鼠；
其中第 $i$ 行包含三个整数 $X_i$，$T_i$，$P_i$。
数据保证在同一个时刻不会有两个地鼠出现在同样的位置。
## 输出格式

输出一行一个整数，表示JYY最多能够得到的分数。
## 样例

### 样例输入 #1
```
3 10 150 250
100 20 123
201 10 67
202 10 45
```
### 样例输出 #1
```
190
```
## 提示

$1~\leq~N~\leq~3000,~1~\leq~XLEFT~<~XRIGHT~\leq~10^5,~1~\leq~T_i~\leq~10^5$

$1~\leq~P_i~\leq~10^5,~1~\leq~X_i~\leq~10^5,~1~\leq~V~\leq~10^4$


---

---
title: "[ZJOI2019] 线段树"
layout: "post"
diff: 省选/NOI-
pid: P5280
tag: ['2019', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2019] 线段树
## 题目描述

九条可怜是一个喜欢数据结构的女孩子，在常见的数据结构中，可怜最喜欢的就是线段树。

线段树的核心是懒标记，下面是一个带懒标记的线段树的伪代码，其中 $tag$ 数组为懒标记：

![](https://cdn.luogu.com.cn/upload/pic/55648.png)

其中函数 $\operatorname{Lson}(Node)$ 表示 $Node$ 的左儿子，$\operatorname{Rson}(Node)$ 表示 $Node$ 的右儿子。

现在可怜手上有一棵 $[1,n]$ 上的线段树，编号为 $1$。这棵线段树上的所有节点的 $tag$ 均为$0$。接下来可怜进行了 $m$ 次操作，操作有两种：

- $1\ l\ r$，假设可怜当前手上有 $t$ 棵线段树，可怜会把每棵线段树复制两份（$tag$ 数组也一起复制），原先编号为 $i$ 的线段树复制得到的两棵编号为 $2i-1$ 与 $2i$，在复制结束后，可怜手上一共有 $2t$ 棵线段树。接着，可怜会对所有编号为奇数的线段树进行一次 $\operatorname{Modify}(root,1,n,l,r)$。

- $2$，可怜定义一棵线段树的权值为它上面有多少个节点 $tag$ 为 $1$。可怜想要知道她手上所有线段树的权值和是多少。
## 输入格式

第一行输入两个整数 $n,m$ 表示初始区间长度和操作个数。

接下来 $m$ 行每行描述一个操作，输入保证 $1 \le l \le r \le n$。
## 输出格式

对于每次询问，输出一行一个整数表示答案，答案可能很大，对 $998244353$ 取模后输出即可。
## 样例

### 样例输入 #1
```
5 5
2
1 1 3
2
1 3 5
2
```
### 样例输出 #1
```
0
1
6
```
## 提示

[1,5] 上的线段树如下图所示：

![](https://cdn.luogu.com.cn/upload/pic/55649.png)

在第一次询问时，可怜手上有一棵线段树，它所有点上都没有标记，因此答案为 $0$。

在第二次询问时，可怜手上有两棵线段树，按照编号，它们的标记情况为：

1. 点 $[1,3]$ 上有标记，权值为 $1$。
2. 没有点有标记，权值为 $0$。

因此答案为 $1$。

在第三次询问时，可怜手上有四棵线段树，按照编号，它们的标记情况为：

1. 点 $[1,2],[3,3],[4,5]$ 上有标记，权值为 $3$。
2. 点 $[1,3]$ 上有标记，权值为 $1$。
3. 点 $[3,3],[4,5]$ 上有标记，权值为 $2$。
4. 没有点有标记，权值为 $0$。

因此答案为 $6$。

![](https://cdn.luogu.com.cn/upload/pic/55650.png)


---

---
title: "[十二省联考 2019] 异或粽子"
layout: "post"
diff: 省选/NOI-
pid: P5283
tag: ['2019', '各省省选', '堆', '字典树 Trie']
---
# [十二省联考 2019] 异或粽子
## 题目描述

小粽是一个喜欢吃粽子的好孩子。今天她在家里自己做起了粽子。

小粽面前有 $n$ 种互不相同的粽子馅儿，小粽将它们摆放为了一排，并从左至右编号为 $1$ 到 $n$。第 $i$ 种馅儿具有一个非负整数的属性值 $a_i$。每种馅儿的数量都足够多，即小粽不会因为缺少原料而做不出想要的粽子。小粽准备用这些馅儿来做出 $k$ 个粽子。

小粽的做法是：选两个整数数 $l$,  $r$，满足 $1 \leqslant l \leqslant r \leqslant n$，将编号在 $[l, r]$ 范围内的所有馅儿混合做成一个粽子，所得的粽子的美味度为这些粽子的属性值的**异或和**。（异或就是我们常说的 xor 运算，即 C/C++ 中的 `ˆ` 运算符或 Pascal 中的 `xor` 运算符）

小粽想品尝不同口味的粽子，因此它不希望用同样的馅儿的集合做出一个以上的
粽子。

小粽希望她做出的所有粽子的美味度之和最大。请你帮她求出这个值吧！
## 输入格式

第一行两个正整数 $n$, $k$，表示馅儿的数量，以及小粽打算做出的粽子的数量。

接下来一行为 $n$ 个非负整数，第 $i$ 个数为 $a_i$，表示第 $i$ 个粽子的属性值。
对于所有的输入数据都满足：$1 \leqslant n \leqslant 5 \times 10^5$,  $1 \leqslant k \leqslant \min\left\{\frac{n(n-1)}{2},2 \times 10^{5}\right\}$,  $0 \leqslant a_i \leqslant 4 294 967 295$。

## 输出格式

输出一行一个整数，表示小粽可以做出的粽子的美味度之和的最大值。
## 样例

### 样例输入 #1
```
3 2
1 2 3
```
### 样例输出 #1
```
6
```
## 提示

| 测试点 | $n$ | $k$ |
| :---------- | :---------- | :---------- |
| $1$, $2$, $3$, $4$, $5$, $6$, $7$, $8$ | $\leqslant 10^3$ | $\leqslant 10^3$ |
| $9$, $10$, $11$, $12$ | $\leqslant 5 \times 10^5$ | $\leqslant 10^3$ |
| $13$, $14$, $15$, $16$ | $\leqslant 10^3$ | $\leqslant 2 \times 10^5$ |
| $17$, $18$, $19$, $20$ | $\leqslant 5 \times 10^5$ | $\leqslant 2 \times 10^5$ |



---

---
title: "[十二省联考 2019] 春节十二响"
layout: "post"
diff: 省选/NOI-
pid: P5290
tag: ['2019', '各省省选', 'O2优化']
---
# [十二省联考 2019] 春节十二响
## 题目背景

“清明时节雨纷纷，路上行人欲断魂。”

$2075$ 年的清明没有春雨。在漫天飞雪的笼罩下，穿行在冰原间的，只有载着人类微薄希望的雪地车。

遥遥 $4.22$ 光年的征途，对于地球这孤独的旅人而言，恐怕也是无比寂寞吧。
## 题目描述

距离苏拉威西只有一百公里了，车内的空气比窗外更加冰冷。四双眼睛紧盯着艾莉
芬面前的屏幕，那是控制行星发动机的关键程序：春节十二响。他需要将其部署到电力控制系统的一个芯片中。

“春节十二响”由 $n$ 个子程序构成，第 $i$ 个子程序所需的内存空间是 $M_i$。这 $n$ 个子程序之间的调用关系构成了一棵以第 $1$ 个子程序为根的树，其中第 $i$ 个子程序在调用树上的父亲是第 $f_i$ 个子程序。

由于内存紧张，电力控制芯片上提供了一种内存分段机制。你可以将内存分为若干
个段 $S_1$, $S_2$, ..., $S_k$，并将每个程序预先分配到一个固定的段。如果两个子程序没有直接或间接的调用关系，则他们可以被分配到同一个段中，反之则不能。换言之，当且仅当 $a$ 和 $b$ 在调用树上**不是祖先—后代关系**，$a$ 和 $b$ 可以被分配到同一个段中。

一个段的大小应当是所有分配到这个段的子程序所需内存大小的最大值，所有段
大小的和不能超过系统的内存大小。

现在艾莉芬想要知道，电力控制芯片至少要有多少内存，才能保证春节十二响的正
确运行。即：最少需要多大的内存，才能通过先**将内存分成若干个段**，再**把每个子程序分配到一个段中，使得每个段中分配的所有子程序之间不存在祖先—后代关系**。
## 输入格式

第一行包含一个正整数 $n$ 表示子程序的个数，其中 $n \leqslant 2 \times 10^5$。

第二行有 $n$ 个用空格隔开的正整数 $M_1$, $M_2$, ..., $M_n$，$M_i$ 表示第 $i$ 个子程序所需的内存空间。

第三行有 $n - 1$ 个用空格隔开的正整数 $f_2$, $f_3$, ..., $f_n$，满足 $f_i < i$，表示第 $i$ 个子程序在调用树上的父亲是第 $f_i$ 个子程序。
## 输出格式

仅一个整数，表示最小的内存需求。
## 样例

### 样例输入 #1
```
5
10 20 20 30 30
1 1 2 2
```
### 样例输出 #1
```
60
```
### 样例输入 #2
```
10
2 1 1 1 1 2 1 1 1 2
1 1 1 4 5 3 3 4 3
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
15
10 1 10 10 2 6 9 6 8 6 3 4 4 5 5
1 2 2 1 5 4 4 1 2 10 1 9 6 1
```
### 样例输出 #3
```
31
```
## 提示

#### 样例 $1$ 解释
在最优方案中，内存被划分为大小为 $10$，$20$，$30$ 的三个段，其中第 $1$ 个子程序被分配在第 $1$ 个段中，第 $2$、$3$ 个子程序被分配在第 $2$ 个段中，第 $4$、$5$ 个子程序被分配在第 $3$ 个段中。可以证明，不存在更优的方案。

#### 子任务
![img](https://s2.ax1x.com/2019/04/07/AhSGzd.png)

注意：在第 $10$、$11$、$12$ 号测试点中，$1$ 号子程序**不一定**是链的一个端点。

其中 $M$ 是所有子内存需求的最大值，即 $\max\left\{M_i\right\}$。

对于全部数据，$1 \leqslant n \leqslant2 \times 10^5$，$1 \leqslant M \leqslant 10^9$。

艾莉芬经过仔细阅读题面、认真分析数据范围后，开始编写程序求解这个问题。

$\texttt{\$ login Elephant}$

$\texttt{password: ********}$

艾莉芬，高级程序员。豫阳市第三工程组提醒您：

- 做题千万条，读题第一条；

- 编程不规范，爆零两行泪。

$\texttt{\$ cd spring}$

$\texttt{\$ ac spring}$

$\texttt{Spring Accepted. Score: 100/100.}$



---

---
title: "[GXOI/GZOI2019] 与或和"
layout: "post"
diff: 省选/NOI-
pid: P5300
tag: ['2019', '各省省选', '贵州', '广西']
---
# [GXOI/GZOI2019] 与或和
## 题目描述

Freda 学习了位运算和矩阵以后，决定对这种简洁而优美的运算，以及蕴含深邃空间的结构进行更加深入的研究。

对于一个由非负整数构成的矩阵，她定义矩阵的 $\texttt{AND}$ 值为矩阵中所有数二进制 $\texttt{AND(\&)}$ 的运算结果；定义矩阵的 $\texttt{OR}$ 值为矩阵中所有数二进制 $\texttt{OR(|)}$ 的运算结果。

给定一个 $N \times N$ 的矩阵，她希望求出：
1. 该矩阵的所有子矩阵的 $\texttt{AND}$ 值之和（所有子矩阵 $\texttt{AND}$ 值相加的结果）。
2. 该矩阵的所有子矩阵的 $\texttt{OR}$ 值之和（所有子矩阵 $\texttt{OR}$ 值相加的结果）。

接下来的剧情你应该已经猜到——Freda 并不想花费时间解决如此简单的问题，所以这个问题就交给你了。

由于答案可能非常的大，你只需要输出答案对 $1,000,000,007 (10^9 + 7)$ 取模后的结果。
## 输入格式

输入文件的第一行是一个正整数 $N$，表示矩阵的尺寸。

接下来 $N$ 行，每行 $N$ 个自然数，代表矩阵的一行。相邻两个自然数之间由一个或多个空格隔开。
## 输出格式

输出只有一行，包含两个用空格隔开的整数，第一个应为所有子矩阵 $\texttt{AND}$ 值之和除以 $10^9 + 7$ 的余数，第二个应为所有子矩阵 $\texttt{OR}$ 值之和除以 $10^9 + 7$ 的余数。
## 样例

### 样例输入 #1
```
3
1 0 0
0 0 0
0 0 0
```
### 样例输出 #1
```
1 9
```
### 样例输入 #2
```
3
1 2 3
4 5 6
7 8 9
```
### 样例输出 #2
```
73 314
```
## 提示

### 样例1解释

该 $3 \times 3$ 矩阵共有 $9$ 个 $1 \times 1$ 子矩阵、$6$ 个 $1 \times 2$ 子矩阵、$6$ 个 $2 \times 1$ 子矩阵、$4$ 个 $2 \times 2$ 子矩阵、3 个 $1 \times 3$ 子矩阵、$3$ 个 $3 \times 1$ 子矩阵、$2$ 个 $2 \times 3$ 子矩阵、$2$ 个 $3 \times 2$ 子矩阵和 $1$ 个 $3 \times 3$ 子矩阵。  
只有一个子矩阵（仅由第一行第一列的那个元素构成的 $1 \times 1$ 矩阵）$\texttt{AND}$ 值为 $1$，其余子矩阵的 $\texttt{AND}$ 值均为 $0$，总和为 $1$。  
包含第一行第一列那个元素的子矩阵有 $9$ 个，它们的 $\texttt{OR}$ 值为 $1$，其余子矩阵的 $\texttt{OR}$ 值为 $0$，总和为 $9$。

### 数据范围

|测试点编号|$n$ 的规模|矩阵中的自然数|
|:-:|:-:|:-:|
|$1$|$1 \le n \le 10$|$\le 100$|
|$2$|$1 \le n \le 10$|$\le 100$|
|$3$|$1 \le n \le 100$|$\le 100$|
|$4$|$1 \le n \le 100$|$\le 100$|
|$5$|$1 \le n \le 100$|$\le 100$|
|$6$|$1 \le n \le 1,000$|$\le 2^{31} - 1$|
|$7$|$1 \le n \le 1,000$|$\le 2^{31} - 1$|
|$8$|$1 \le n \le 1,000$|$\le 2^{31} - 1$|
|$9$|$1 \le n \le 1,000$|$\le 2^{31} - 1$|
|$10$|$1 \le n \le 1,000$|$\le 2^{31} - 1$|

另外有一组不计分的 hack 数据，放在 subtask 1 中，数据范围与测试点 $6 \sim 10$ 一致。


---

---
title: "[GXOI/GZOI2019] 宝牌一大堆"
layout: "post"
diff: 省选/NOI-
pid: P5301
tag: ['2019', '各省省选', '贵州', '广西']
---
# [GXOI/GZOI2019] 宝牌一大堆
## 题目描述

麻将是一种传统的博弈游戏，由 $4$ 名玩家参与，轮流摸牌、打牌。在竞技比赛中主要有国标麻将（中国）和立直麻将（日本）两大规则。本题采用一种特别的规则——「宝牌一大堆」规则。

#### 牌型
一副麻将由 $136$ 张牌组成，其中包含 $34$ 种不同的牌，每种各有 $4$ 张。这 $34$ 种牌分别是：  
一万到九万、一索到九索、一筒到九筒、东、南、西、北、中、白、发。

![doraippai1.png](https://cdn.luogu.com.cn/upload/pic/56677.png)

它们可以组合成不同的牌型：
- 顺子：$3$ 张数字连续的万，或 $3$ 张数字连续的索，或 $3$ 张数字连续的筒。
- 刻子：$3$ 张完全一样的牌。
- 杠子：$4$ 张完全一样的牌。
- 雀头：$2$ 张完全一样的牌。

其中顺子和刻子统称为面子。

#### 和牌
手牌（一名玩家持有的牌）宣告胜利的状况称为「和牌」。
- 当玩家持有 $14$ 张牌，并且满足以下三个条件之一时，判定为「和牌」：
  1. 存在一种方案，使得这 $14$ 张牌可以分成 $4$ 组面子、$1$ 组雀头，简记为「$3 \times 4 + 2$」。
  2. 存在一种方案，使得这 $14$ 张牌可以分成 $7$ 组**不同的**雀头，称为「七对子」。
  3. 这 $14$ 张牌**仅由**一万、九万、一索、九索、一筒、九筒、东、南、西、北、中、白、发这 $13$ 种牌组成，并且这 $13$ 种牌**每种至少有 $1$ 张**，称为「国士无双」。
- 当玩家持有 $15$ 张牌，并且存在一种方案，使得这 $15$ 张牌可以分成 $1$ 组杠子、$3$ 组面子、$1$ 组雀头，判定为和牌。
- 当玩家持有 $16$ 张牌，并且存在一种方案，使得这 $16$ 张牌可以分成 $2$ 组杠子、$2$ 组面子、$1$ 组雀头，判定为和牌。
- 当玩家持有 $17$ 张牌，并且存在一种方案，使得这 $17$ 张牌可以分成 $3$ 组杠子、$1$ 组面子、$1$ 组雀头，判定为和牌。
- 当玩家持有 $18$ 张牌，并且存在一种方案，使得这 $18$ 张牌可以分成 $4$ 组杠子、$1$ 组雀头，判定为和牌。

#### 宝牌
每局游戏还会指定若干张「宝牌」，和牌时，手牌中的每张宝牌会使收益翻一番（会在接下来详细介绍）。

#### 达成分数
由于可以「和牌」的手牌很多，可以给每种判定为「和牌」的手牌定义一个「达成分数」，这个分数等于从所有尚未打出的牌中选出若干张，能够组成该手牌的方法数，再乘上手牌中 $2$ 的「宝牌数」次方。  
该分数综合考虑了和牌几率与和牌收益，理论上以分数较高的手牌为目标较好。

例如下图手牌显然是可以「和牌」的，如果目前场上还剩 $3$ 张一万、$4$ 张九万，以及二到八万各 $2$ 张没有打出，宝牌为九万，那么下图手牌的「达成分数」就是 $C_3^3 C_4^3 C_2^2 (C_2^1)^6 2^3 = 2048$，其中 $C$ 表示组合数。

![doraippai2.png](https://cdn.luogu.com.cn/upload/pic/56678.png)

特别地，「七对子」和牌的手牌，达成分数额外乘 $7$。「国士无双」和牌的手牌，达成分数额外乘 $13$。

有一天，小 L，小 Y，小 I 和小 W 正在打麻将，路过的雪野和看到了所有已经打出的牌，但不知道任何一名玩家的手牌。也许你已经猜到了下面的剧情—
—雪野和想知道在所有尚未打出的牌中，「达成分数」最高的可以「和牌」的手牌有多少分，但是她还要观看麻将比赛，所以这个问题就交给你了。
## 输入格式

每个测试点包含多组数据，第一行是一个整数 $T$，表示数据组数。注意各组数据之间是互相独立的。

每组数据包含两行，第一行给出场上已经打出的牌，第二行给出该局的所有宝牌。

规定用 $\texttt{1m},\texttt{2m},\dots,\texttt{9m}$ 代表万，$\texttt{1p},\texttt{2p},\dots,\texttt{9p}$ 代表筒，$\texttt{1s},\texttt{2s},\dots,\texttt{9s}$ 代表索，$\texttt E,\texttt S,\texttt W,\texttt N$ 代表东、南、西、北，$\texttt Z,\texttt B,\texttt F$ 代表中、白、发，相邻两张牌之间用一个空格隔开，每行的末尾有一个单独的 $0$ 代表结束。
## 输出格式

输出文件应包含 $T$ 行，对于每组数据，输出一个整数表示最高分数。
## 样例

### 样例输入 #1
```
2
0
0
7m 4p 2s 7s 6p 8s 7p 5s 9s 9s 1p 5m 9m 5s 4p 5s E 1p 6s 5p B 4m 6m W 6p 6s E 9s 5p 2s 8s 8p 4m 3s 9m 5p 3s 2s 6s 8s 8p 6p 5m 4s 3m 4s 5s 4s 6m 9s 6p N 5m 7s 4m 2m 2s 6s 3m 7p B B N 1m 3m B 8p F 7p 0
W 4p N 3m 2m B 9m 3p 1p 6p S 4s 5p 8s 4m 5s 2s 3s 0
```
### 样例输出 #1
```
1308622848
127401984
```
## 提示

### 样例解释

在第一组数据中，没有打出过任何牌，没有宝牌，和「国士无双」分数最高，为 $13 \times 6 \times 4^{12}$。  
和「$3 \times 4 + 2$」和「七对子」的分数为 $100663296$ 和 $1959552$。

在第二组数据中，和「$3 \times 4 + 2$」分数最高，为 $127401984$，可以得到该分数的手牌之一为「$\texttt{1m2m3m 7m8m9m 1p2p3p 3p4p5p SS}$」。  
和「七对子」的分数为 $125411328$，不存在和「国士无双」的可能。

### 数据范围

保证已经打出的牌必定是合法的牌，且每种不超过 $4$ 张。宝牌不会重复给出。

|测试点编号|$T$ 的规模|已经打出的牌|宝牌数|
|:-:|:-:|:-:|:-:|
|$1$|$T = 10$|无特殊限制|$\le 20$ 张|
|$2$|$T = 100$|至少包括所有数字为三到七的牌|$\le 20$ 张|
|$3$|$T = 500$|每种至少 $2$ 张|$\le 20$ 张|
|$4$|$T = 500$|每种至少 $3$ 张|$\le 20$ 张|
|$5$|$T = 500$|无特殊限制|$0$ 张|
|$6$|$T = 1,000$|无特殊限制|$0$ 张|
|$7$|$T = 1,000$|无特殊限制|$\le 20$ 张|
|$8$|$T = 1,500$|无特殊限制|$\le 20$ 张|
|$9$|$T = 2,000$|无特殊限制|$\le 20$ 张|
|$10$|$T = 2,500$|无特殊限制|$\le 20$ 张|


---

---
title: "[GXOI/GZOI2019] 逼死强迫症"
layout: "post"
diff: 省选/NOI-
pid: P5303
tag: ['2019', '各省省选', '贵州', '广西']
---
# [GXOI/GZOI2019] 逼死强迫症
## 题目描述

ITX351 要铺一条 $2 \times N$ 的路，为此他购买了 $N$ 块 $2 \times 1$ 的方砖。可是其中一块砖在运送的过程中从中间裂开了，变成了两块 $1 \times 1$ 的砖块！  
ITX351 由此产生了一个邪恶的想法：他想要在这条路上故意把两块 $1 \times 1$ 的砖块分开铺，**不让两块砖有相邻的边**，其他砖块可以随意铺，直到整条路铺满。这样一定可以逼死自身强迫症 sea5！

也许下面的剧情你已经猜到了——他为此兴奋不已，以至于无法敲键盘。于是，他请你帮忙计算一下，有多少种方案可以让自己的阴谋得逞。
## 输入格式

每个测试点包含多组数据，输入文件的第一行是一个正整数 $T$，表示数据的组数。注意各组数据之间是独立无关的。

接下来 $T$ 行，每行包含一个正整数 $N$，代表一组数据中路的长度。
## 输出格式

输出应包含 $T$ 行，对于每组数据，输出一个正整数，表示满足条件的方案数。

由于答案可能非常的大，你只需要输出答案对 $1000000007 (10^9 + 7)$ 取模后的结果。
## 样例

### 样例输入 #1
```
3
1
2
4
```
### 样例输出 #1
```
0
0
6
```
## 提示

样例中 $ N=4 $ 解释见下图：

![](https://cdn.luogu.com.cn/upload/pic/56734.png)

### 数据范围

|测试点编号|$N$ 的规模|$T$ 的规模|
|:-:|:-:|:-:|
|$1$|$N \le 10$|$T \le 10$|
|$2$|$N \le 10$|$T \le 10$|
|$3$|$N \le 10^5$|$T \le 50$|
|$4$|$N \le 10^5$|$T \le 50$|
|$5$|$N \le 10^5$|$T \le 50$|
|$6$|$N \le 2 \times 10^9$|$T \le 50$|
|$7$|$N \le 2 \times 10^9$|$T \le 50$|
|$8$|$N \le 2 \times 10^9$|$T \le 50$|
|$9$|$N \le 2 \times 10^9$|$T \le 500$|
|$10$|$N \le 2 \times 10^9$|$T \le 500$|


---

---
title: "[GXOI/GZOI2019] 旧词"
layout: "post"
diff: 省选/NOI-
pid: P5305
tag: ['2019', '各省省选', '贵州', '广西']
---
# [GXOI/GZOI2019] 旧词
## 题目描述

> 浮生有梦三千场  
> 穷尽千里诗酒荒  
> 徒把理想倾倒  
> 不如早还乡
>
> 温一壶风尘的酒  
> 独饮往事迢迢  
> 举杯轻思量  
> 泪如潮青丝留他方
>
> ——乌糟兽/愚青《旧词》

你已经解决了五个问题，不妨在这大树之下，吟唱旧词一首抒怀。最后的问题就是关于这棵树的，它的描述很简单。

给定一棵 $n$ 个点的有根树，节点标号 $1 \sim n$，$1$ 号节点为根。  
给定常数 $k$。  
给定 $Q$ 个询问，每次询问给定 $x,y$。  
求：

$$\sum\limits_{i \le x} \text{depth}(\text{lca}(i,y))^k$$

$\text{lca}(x,y)$ 表示节点 $x$ 与节点 $y$ 在有根树上的最近公共祖先。  
$\text{depth}(x)$ 表示节点 $x$ 的深度，根节点的深度为 $1$。  
由于答案可能很大，你只需要输出答案模 $998244353$ 的结果。

## 输入格式

输入包含 $n+Q$ 行。

第 $1$ 行，三个正整数 $n,Q,k$。

第 $i = 2 \sim n$ 行，每行有一个正整数 $f_i(1 \le f_i \le n)$，表示编号为 $i$ 的节点的父亲节点的编号。

接下来 $Q$ 行，每行两个正整数 $x,y(1 \le x,y \le n)$，表示一次询问。
## 输出格式

输出包含 $Q$ 行，每行一个整数，表示答案模 $998244353$ 的结果。
## 样例

### 样例输入 #1
```
5 5 2
1
4
1
2
4 3
5 4
2 5
1 2
3 2
```
### 样例输出 #1
```
15
11
5
1
6
```
## 提示

### 样例解释

输入的树：

![poetry.png](https://cdn.luogu.com.cn/upload/pic/56737.png)

每个点的深度分别为 $1,2,3,2,3$。

第一个询问 $x = 4,y = 3$，容易求出：  

$$\text{lca}(1, 3) = 1,\text{lca}(2, 3) = 1,\text{lca}(3, 3) = 3,\text{lca}(4, 3) = 4$$

于是 $\text{depth}(1)^2+\text{depth}(1)^2+\text{depth}(3)^2+\text{depth}(4)^2 = 1+1+9+4 = 15$。

### 数据范围

|测试点编号|$n$ 的规模|$Q$ 的规模|$k$ 的规模|约定|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$n \le 2,000$|$Q \le 2,000$|$1 \le k \le 10^9$|无|
|$2$|$n \le 2,000$|$Q \le 2,000$|$1 \le k \le 10^9$|无|
|$3$|$n \le 2,000$|$Q \le 2,000$|$1 \le k \le 10^9$|无|
|$4$|$n \le 2,000$|$Q \le 2,000$|$1 \le k \le 10^9$|无|
|$5$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|存在某个点，其深度为 $n$|
|$6$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|存在某个点，其深度为 $n$|
|$7$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|存在某个点，其深度为 $n$|
|$8$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|存在某个点，其深度为 $n$|
|$9$|$n \le 50,000$|$Q = n$|$1 \le k \le 10^9$|对于第 $i$ 个询问，有 $x = i$|
|$10$|$n \le 50,000$|$Q = n$|$1 \le k \le 10^9$|对于第 $i$ 个询问，有 $x = i$|
|$11$|$n \le 50,000$|$Q \le 50,000$|$k = 1$|无|
|$12$|$n \le 50,000$|$Q \le 50,000$|$k = 1$|无|
|$13$|$n \le 50,000$|$Q \le 50,000$|$k = 2$|无|
|$14$|$n \le 50,000$|$Q \le 50,000$|$k = 2$|无|
|$15$|$n \le 50,000$|$Q \le 50,000$|$k = 3$|无|
|$16$|$n \le 50,000$|$Q \le 50,000$|$k = 3$|无|
|$17$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|无|
|$18$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|无|
|$19$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|无|
|$20$|$n \le 50,000$|$Q \le 50,000$|$1 \le k \le 10^9$|无|


---

---
title: "[BJOI2019] 奥术神杖"
layout: "post"
diff: 省选/NOI-
pid: P5319
tag: ['2019', '各省省选', '北京', 'Special Judge', 'AC 自动机']
---
# [BJOI2019] 奥术神杖
## 题目描述

Bezorath 大陆抵抗地灾军团入侵的战争进入了僵持的阶段，世世代代生活在 Bezorath 这片大陆的精灵们开始寻找远古时代诸神遗留的神器，试图借助神器的神秘力量帮助她们战胜地灾军团。

在付出了惨痛的代价后，精灵们从步步凶险的远古战场取回了一件保存尚完好的神杖。但在经历过那场所有史书都视为禁忌的“诸神黄昏之战”后，神杖上镶嵌的奥术宝石已经残缺，神力也几乎消耗殆尽。精灵高层在至高会议中决定以举国之力收集残存至今的奥术宝石，并重金悬赏天下能工巧匠修复这件神杖。

你作为神术一脉第五百零一位传人，接受了这个艰巨而神圣的使命。
神杖上从左到右镶嵌了 $n$ 颗奥术宝石，奥术宝石一共有 $10$ 种，用数字 "`0123456789`" 表示。有些位置的宝石已经残缺，用 "`.`" 表示，你需要用完好的奥术宝石填补每一处残缺的部分（每种奥术宝石个数不限，且不能够更换未残缺的宝石）。古老的魔法书上记载了 $m$ 种咒语 $(S_i,V_i)$ ，其中 $S_i$ 是一个非空数字串，$V_i$ 是这种组合能够激发的神力。

神杖的初始神力值 $Magic = 1$，每当神杖中出现了连续一段宝石与 $S_i$ 相等时，神力值 $Magic$ 就会乘以 $V_i$。但神杖如果包含了太多咒语就不再纯净导致神力降低：设 $c$ 为神杖包含的咒语个数（若咒语类别相同但出现位置不同视为多次），神杖最终的神力值为 $ \sqrt[c]{Magic}$。（若 $c = 0$ 则神杖最终神力值为 $1$ ）

例如有两种咒语 $(01,3)$ 、$(10,4)$ ，那么神杖 “`0101`” 的神力值为 $\sqrt[3]{ 3 \times 4 \times 3}$

你需要使修复好的神杖的最终的神力值最大，输出任何一个解即可。
## 输入格式

第一行两个正整数 $n$ 、$m$ ，表示宝石数和咒语数。

第二行为一个长度为 $n$ 的字符串 $T$ ，表示初始的神杖。

接下来 $m$ 行每行一个非空数字串 $S_i$ 和一个正整数 $V_i$ ，表示每种咒语。
## 输出格式

输出最终神杖上从左到右镶嵌的宝石，多解时任意输出一个即可。
## 样例

### 样例输入 #1
```
4 3
....
1 2
2 2
3 1
```
### 样例输出 #1
```
2019
```
### 样例输入 #2
```
5 4
..0..
0 2
00 2
01 4
10 3
```
### 样例输出 #2
```
11012
```
### 样例输入 #3
```
18 6
...2.1.0.1..1.0..1
011 6
111 4
010 12
121 7
101 5
10 3
```
### 样例输出 #3
```
121211203112120121
```
## 提示

样例 1 ：法杖最终神力值为 $2$ 。

样例 2 ：法杖最终神力值为 $\sqrt[3]{2 \times 3 \times 4}$

设 $s = \sum_{i=1}^{m} |S_i|$ ，即所有咒语的串长之和。
![](https://cdn.luogu.com.cn/upload/pic/57052.png)


---

---
title: "[BJOI2019] 光线"
layout: "post"
diff: 省选/NOI-
pid: P5323
tag: ['数学', '2019', '各省省选', '北京', 'O2优化']
---
# [BJOI2019] 光线
## 题目描述

当一束光打到一层玻璃上时，有一定比例的光会穿过这层玻璃，一定比例的光会被反射回去，剩下的光被玻璃吸收。  

设对于任意 $x$，有 $x \times a_i\%$ 单位的光会穿过它，有 $x \times b_i\%$ 的会被反射回去。  
现在 $n$ 层玻璃叠在一起，有 $1$ 单位的光打到第 $1$ 层玻璃上，那么有多少单位的光能穿过**所有** $n$ 层玻璃呢？

## 输入格式

第一行一个正整数 $n$，表示玻璃层数。  
接下来 $n$ 行，每行两个非负整数 $a_i,b_i$，表示第 $i$ 层玻璃的透光率和反射率。
## 输出格式

输出一行一个整数，表示穿透所有玻璃的光对 $10^9 + 7$ 取模的结果。  
可以证明，答案一定为有理数。设答案为 $a/b$ ( $a$ 和 $b$ 是互质的正整数)，你输出的答案为 $x$，你需要保证 $a\equiv bx \space (\text{mod }10^9 + 7)$。
## 样例

### 样例输入 #1
```
2
50 20
80 5
```
### 样例输出 #1
```
858585865
```
### 样例输入 #2
```
3
1 2
3 4
5 6
```
### 样例输出 #2
```
843334849
```
## 提示

**样例1解释：**  
![](https://cdn.luogu.com.cn/upload/pic/57125.png)   
如图，光线从左上角打进来，有 $0.5$ 单位的光穿过第 $1$ 层玻璃，有 $0.2$ 单位的光被反射回去。这 $0.5$ 单位的光有 $0.4$ 单位穿过第 $2$ 层玻璃，有 $0.025$ 单位的光被反射回去。这 $0.025$ 单位的光有 $0.0125$ 单位穿过第 $1$ 层玻璃，有 $0.005$ 单位的光被反射回去。这 $0.005$ 单位的光有 $0.004$ 单位穿过第 $2$ 层玻璃……于是，穿过两层玻璃的光一共有$0.40404... = 40/99$ 单位。在模 $10^9+7$ 意义下等于 $858585865$。 

**数据范围：**  
对于 $5\%$ 的数据，$n=1$；    
对于 $20\%$ 的数据，$n\le 2$；    
对于 $30\%$ 的数据，$n\le 3$；    
对于 $50\%$ 的数据，$n\le 100$；    
对于 $70\%$ 的数据，$n\le 3000$；    
对于 $100\%$ 的数据，$n\le 5\times 10^5$，$1\le a_i \le 100$，$0\le b_i \le 99$，$1\le a_i+b_i \le 100$。  

每组 $a_i$ 和 $b_i$ 在满足上述限制的整数中随机生成。


---

---
title: "[BJOI2019] 删数"
layout: "post"
diff: 省选/NOI-
pid: P5324
tag: ['2019', '线段树', '各省省选', '北京', 'O2优化']
---
# [BJOI2019] 删数
## 题目描述

对于任意一个数列，如果能在有限次进行下列删数操作后将其删为空数列，则称这个数列可以删空。一次删数操作定义如下：  
>记当前数列长度为 $k$ ，则删掉数列中所有等于 $k$ 的数。  

现有一个长度为 $n$ 的数列 $a$，有 $m$ 次修改操作，第 $i$ 次修改后你要回答：  
经过 $i$ 次修改后的数列 $a$，至少还需要修改几个数才可删空？  

每次修改操作为单点修改或数列整体加一或数列整体减一。
## 输入格式

第一行两个正整数 $n,m$，分别表示数列长度、修改次数。  
第二行有 $n$ 个正整数，表示数列 $a$，即输入的第 $i$ 个数表示数列 $a$ 的第 $i$ 个数 $a_i$。   

接下来 $m$ 行，每行两个整数 $p,x$，表示一次修改操作。  
当 $1\le p \le n$ 时，该操作为单点修改，将数列中第 $p$ 个数 $a_p$ 修改为 $x$  
当 $p=0$ 时，该操作为数列整体加 $x$。

## 输出格式

输出 $m$ 行，每行一个整数，第 $i$ 行表示前 $i$ 次修改后的答案。
## 样例

### 样例输入 #1
```
3 9
1 2 3
1 1
0 1
0 1
0 1
2 2
3 2
0 -1
0 -1
0 -1
```
### 样例输出 #1
```
0
1
2
3
2
1
1
2
2
```
## 提示

**样例解释(局部)：**     
第一次修改后，数列为$1$ $2$ $3$，无需修改即可删空。   
第四次修改后，数列为$4$ $5$ $6$，需要将三个数都改掉才可能删空。   
第六次修改后，数列为$4$ $2$ $2$，将第一个数改成$3$即可删空。   
第九次修改后，数列为$1$ $-1$ $-1$，可以将第二个数改成$2$、第三个数改成$3$来删空。   

**数据范围：**   
对于 $100\%$ 的数据：      
$1\le n,m \le 150000$  
$1\le a_i \le n$  
$0\le p\le n$  
$p>0$时，$1\le x \le n$  
$p=0$时，$x=-1$ 或 $1$    
![](https://cdn.luogu.com.cn/upload/pic/57129.png) 


---

---
title: "[SNOI2019] 数论"
layout: "post"
diff: 省选/NOI-
pid: P5330
tag: ['2019', '各省省选', '陕西']
---
# [SNOI2019] 数论
## 题目描述

给出正整数 $P,Q,T$ ，大小为 $n$ 的整数集 $A$ 和大小为 $m$ 的整数集 $B$ ，请你求出：

$$
\sum_{i=0}^{T-1}[(i\bmod P) \in A \land (i\bmod Q) \in B]
$$


换言之，就是问有多少个小于 $T$ 的非负整数 $x$ 满足：$x$ 除以 $P$ 的余数属于 $A$ 且 $x$ 除以 $Q$ 的余数属于 $B$。
## 输入格式

第一行 $5$ 个用空格隔开的整数 $P,Q,n,m,T$。

第二行 $n$ 个用空格隔开的整数，表示集合 $A=\{A_1,A_2,\cdots,A_n\}$。保证 $A_i$ 两两不同，且 $0 \leq A_i<P$。

第三行 $m$ 个用空格隔开的整数，表示集合 $B=\{B_1,B_2,\cdots,B_m\}$。保证 $B_i$ 两两不同，且 $0 \leq B_i<Q$。

## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 6 3 3 14
0 1 3
2 4 5
```
### 样例输出 #1
```
4
```
## 提示

对于所有数据，$1 \leq n,m \leq 10^6 , 1 \leq P,Q \leq 10^6 , 1 \leq T \leq 10^{18}$。

对于10%的数据，$T \leq 10^6$。

对于另外20%的数据，$P,Q \leq 1000$。

对于另外10%的数据，$T$是$P,Q$的公倍数。

对于另外10%的数据，$P,Q$互质，且$P,Q \leq 10^5$。

对于另外10%的数据，$P,Q$互质。

对于另外10%的数据，$P,Q \leq 10^5$。

对于余下30%的数据，无特殊限制。

- 2023.11.17 添加三组 hack 数据。


---

---
title: "[TJOI2019] 甲苯先生的滚榜"
layout: "post"
diff: 省选/NOI-
pid: P5338
tag: ['2019', '各省省选', '天津']
---
# [TJOI2019] 甲苯先生的滚榜
## 题目描述

甲苯先生在制作一个 Online Judge，他发现做比赛的人们很关心自己的排名（显而易见）。

在 ACM 赛制的比赛中，如果通过题目数量不相等，则通过题目数量多的人排名更靠前；  
如果通过题目数量相等，则罚时更少的人排名更高。

甲苯先生想让大家帮忙设计一个程序，每次有人通过之后，就告诉他排名在他的前面有多少人。  
（不包括和他罚时题数都相同的同学）
## 输入格式

第一行输入一个整数 $T$ 表示测试样例的个数。

对于每一个样例，输入三个整数 $m, n, \text{seed}$。  
$m$ 表示参赛总人数（编号 $1 \sim m$），$n$ 表示一共有 $n$ 次 AC（假设 AC 已经去重，即不存在相同人的相同题目提交）。  
$\text{seed}$ 表示生成数据的种子。

接下来要求同学们使用之下的函数生成数据：
```cpp
typedef unsigned int ui ;
ui randNum( ui& seed , ui last , const ui m){ 
    seed = seed * 17 + last ; return seed % m + 1; 
}
```
（$\texttt{last}$ 为上一次输出的结果，在没有输出结果时 $\texttt{last} = 7$，多组数据时 $\texttt{last}$ 不需要重新赋值）  
要求每次生成两个数据 $\texttt{Ria}, \texttt{Rib}$，表示第 $\texttt{Ria}$ 个人 AC 了一道题目，他的罚时为 $\texttt{Rib}$。  
（也就是说 $\texttt{Ria}$ 的题目数量 $+1$，罚时长度 $+\texttt{Rib}$）。

要求一共生成 $n$ 组数据，代表一共有 $n$ 次提交。

对于所有数据，保证罚时总和不超过 $1.5\times 10^6$。
## 输出格式

每次提交输出一行整数，表示在第 $\texttt{Ria}$ 个人 AC 后，比 $\texttt{Ria}$ 成绩高的有多少个选手。
## 样例

### 样例输入 #1
```
1
7 3 1

```
### 样例输出 #1
```
0
1
0

```
## 提示

| 测试点# | 1, 2 | 3, 4 | 5 |6, 7, 8 | 9, 10 |
| :-: | :-: | :-: | :-: | :-: |:-:|
| $T$ | $\le10$ | $\le5$ | $\le15$ | $\le5$ | $\le5$ |
| $m$ | $\le1000$ | $\le10000$ | $\le10^5$ | $\le10^4$ |$\le10^5$|
| $n$ | $\le1000$ | $\le10000$ | $\le10^5$ | $\le10^6$ |$\le10^6$|



---

---
title: "[TJOI2019] 唱、跳、rap和篮球"
layout: "post"
diff: 省选/NOI-
pid: P5339
tag: ['2019', '各省省选', '组合数学', '天津']
---
# [TJOI2019] 唱、跳、rap和篮球
## 题目背景

TJOI2019 D1T3

源文件名：queue.*

时间限制: 4s 内存限制: 128M
## 题目描述

大中锋的学院要组织学生参观博物馆，要求学生们在博物馆中排成一队进行参观。他的同学可以分为四类：一部分最喜欢唱、一部分最喜欢跳、一部分最喜欢rap，还有一部分最喜欢篮球。如果队列中$k$,$k + 1$,$k + 2$,$k + 3$位置上的同学依次，最喜欢唱、最喜欢跳、最喜欢rap、最喜欢篮球，那么他们就会聚在一起讨论蔡徐坤。大中锋不希望这种事情发生，因为这会使得队伍显得很乱。大中锋想知道有多少种排队的方法，不会有学生聚在一起讨论蔡徐坤。两个学生队伍被认为是不同的，当且仅当两个队伍中至少有一个位置上的学生的喜好不同。由于合法的队伍可能会有很多种，种类数对$998244353$取模。
## 输入格式

输入数据只有一行。每行$5$个整数，第一个整数$n$，代表大中锋的学院要组织多少人去参观博物馆。接下来四个整数$a$、$b$、$c$、$d$，分别代表学生中最喜欢唱的人数、最喜欢跳的人数、最喜欢rap的人数和最喜欢篮球的人数。保证$a+b+c+d \ge n$。
## 输出格式

每组数据输出一个整数，代表你可以安排出多少种不同的学生队伍，使得队伍中没有学生聚在一起讨论蔡徐坤。结果对$998244353$取模。

## 样例

### 样例输入 #1
```
4 4 3 2 1

```
### 样例输出 #1
```
174

```
### 样例输入 #2
```
996 208 221 132 442

```
### 样例输出 #2
```
442572391

```
## 提示

对于20%的数据，有$n=a=b=c=d\le500$

对于100%的数据，有$n \le 1000$ ， $a, b, c, d \le 500$


---

---
title: "[TJOI2019] 甲苯先生和大中锋的字符串"
layout: "post"
diff: 省选/NOI-
pid: P5341
tag: ['2019', '各省省选', '天津']
---
# [TJOI2019] 甲苯先生和大中锋的字符串
## 题目背景

TJOI2019 D2T2

源文件名：substring.*

时间限制: 1s 内存限制: 128M
## 题目描述

大中锋有一个长度为 $n$ 的字符串，他只知道其中的一个子串是祖上传下来的宝藏的密码。但是由于字符串很长，大中锋很难将这些子串一一尝试。

这天大中锋找到甲苯先生算命，但是甲苯先生说：“天机不可泄漏”。

在大中锋的苦苦哀求下，甲苯先生告诉大中锋：“密码是在字符串中恰好出现了 $k$ 次的子串”。

但是大中锋不知道该怎么做，在大中锋再三的恳求下，甲苯先生看其真诚，又告诉他：“在恰好出现了 $k$ 次的子串中，你去按照字串的长度分类，密码就在数量最多的那一类里”。

大中锋为了尝试这个密码，想让你帮忙找出子串长度出现次数最多的长度数（如果有多个输出最长长度）。
## 输入格式

第一行一个正整数 $T$ ，表示有 $T$ 组测试数据。

接下来 $T$ 行每行包含一个字符串和一个正整数 $k$ 。
## 输出格式

一共输出 $T$ 行，每行一个整数表示在出现 $k$ 次的子串中出现次数的最多的长度。如果不存在子串出现 $k$ 次，则输出 $-1$ 。
## 样例

### 样例输入 #1
```
6
aab 1
abc 1
aaaa 2
abab 2
ababacc 2
abab 4
```
### 样例输出 #1
```
2
1
3
1
2
-1
```
## 提示

### 数据说明 ###

对于第一个数据：其中子串 $b, aa, ab, aab$ 均只出现一次，其中长度为 $1$ 的子串出现了 $1$ 次，长度为 $2$ 的子串出现了 $2$ 次，长度为 $3$ 的子串出现了 $1$ 次。所以答案为 $2$ 。

对于第二个数据：其中子串 $a, b, c, ab, bc, abc$ 均只出现一次，其中长度为 $1$ 的子串出现了 $3$ 次，长度为 $2$ 的子串出现了 $2$ 次，长度为 $3$ 的子串出现了 $1$ 次。所以答案为 $1$ 。

对于第三个数据：其中子串 $aaa$ 出现二次，长度为 $3$ 的子串出现了 $1$ 次，其他长度均没有。所以答案为 $3$ 。

对于第四个数据：其中子串 $a, b, ab$ 出现二次，其中长度为 $1$ 的子串出现了 $2$ 次，长度为 $2$ 的子串出现了 $1$ 次。所以答案为 $1$ 。

对于第五个数据：其中子串 $b, c, ab, ba$ 出现二次，其中长度为 $1$ 的子串出现了 $2$ 次，长度为 $2$ 的子串出现了 $2$ 次。所以答案为 $2$ 。

对于第六个数据：其中子串没有出现四次。所以本题的本题的答案为 $-1$ 。

### 数据范围 ###

对于 $20\%$ 的数据， $1\leq k\leq n\leq 10$

对于 $100\%$ 的数据， $1\leq n\leq 10^5,1 \leq T \leq 100,\sum n \leq 3 * 10^6$ ，输入的字符串中仅包含小写英文字母。


---

---
title: "[SDOI2019] 热闹的聚会与尴尬的聚会"
layout: "post"
diff: 省选/NOI-
pid: P5361
tag: ['2019', '各省省选', '山东', 'Special Judge', 'O2优化']
---
# [SDOI2019] 热闹的聚会与尴尬的聚会
## 题目背景

小 Q 的生日快到了，他决定周末邀请一些朋友到他的新房子一起聚会！
## 题目描述

他的联系薄上有 $n$ 位好友，他们两两之间或者互相认识，或者互相不认识。小 Q 希望在周六办一个热闹的聚会，再在周日办一个尴尬的聚会。

- 一场热闹度为 $p$ 的聚会请来了任意多位好友，对于每一位到场的好友来说都有至少 $p$ 位他认识的好友也参加了聚会，且至少对于一位到场的好友来说现场恰好有 $p$ 位他认识的好友；
- 一场尴尬度为 $q$ 的聚会请来了恰好 $q$ 位好友，且他们两两互不认识。

两场聚会可能有重复的参与者，联系薄上也有可能有某些好友同时缺席了两场聚会。

小 Q 喜欢周六聚会的热闹度 $p$ 与周日聚会的尴尬度 $q$ 之间满足：$\left\lfloor \frac{n}{p+1} \right\rfloor\! \le q$ 且 $\left\lfloor \frac{n}{q+1} \right\rfloor\! \le p$。

请帮助小 Q 找出一个可行的邀请方案。
## 输入格式

**输入含有多组测试数据**，并在第一行给定一个整数 $T$，表示总共有多少组测试数据。之后依次给出每一组数据。

每一组测试数据第一行给定两个整数 $n$ 和 $m$，依次表示联系薄中好友的总数，以及有多少对互相认识的好友。

之后 $m$ 行每行给定两个正整数 $u$ 和 $v$，满足 $1\le u\neq v\le n$ ，表示第 $u$ 个好友与第 $v$ 个好友互相认识。
## 输出格式

对于每一组数据输出两行，依次描述周六热闹的聚会的参加人员，与周日尴尬的聚会的参加人员列表：

第一行先输出一个正整数表示总共邀请来了多少位好友参加周六的聚会，再之后输出若干个不同的整数，按照任意顺序描述被邀请的是哪些好友。

第二行先输出一个正整数表示总共邀请来了多少位好友参加周日的聚会，再之后以任意顺序输出若干个不同的整数，同样描述了周日被邀请的好友。

如果有多组方案，你可以输出其中任何一组。
## 样例

### 样例输入 #1
```
2
6 15
1 2
1 3
1 4
1 5
1 6
2 3
2 4
2 5
2 6
3 4
3 5
3 6
4 5
4 6
5 6
8 11
1 2
2 3
1 4
3 7
4 5
5 2
2 6
6 7
5 6
5 8
6 8
```
### 样例输出 #1
```
6 1 2 3 4 5 6
1 4
8 1 2 3 4 5 6 7 8
4 8 4 7 2
```
## 提示

#### 数据规模与约定

- 子任务 $1$（$10$ 分）：$1\le n\le 500$；  
- 子任务 $2$（$10$ 分）：$1\le n\le 700$；  
- 子任务 $3$（$10$ 分）：$1\le n\le 900$；  
- 子任务 $4$（$10$ 分）：$1\le n\le 1.1 \times {10}^3$；  
- 子任务 $5$（$10$ 分）：$1\le n\le 2 \times {10}^3$；  
- 子任务 $6$（$10$ 分）：$1\le n\le 3 \times {10}^3$；  
- 子任务 $7$（$10$ 分）：$1\le n\le 4.5 \times {10}^3$；  
- 子任务 $8$（$10$ 分）：$1\le n\le 6 \times {10}^3$；  
- 子任务 $9$（$10$ 分）：$1\le n\le 8 \times {10}^3$；  
- 子任务 $10$（$10$ 分）：$1\le n\le {10}^4$。

对于全部的测试点，满足 $1\le T\le 32$ 且 $1\le m\le 10^5$。

---

#### 提示

本题读入量很大，请注意自己代码在读入上的所需时间。

---
#### 说明

感谢 @[81179332\_](/user/53994) 提供 spj！


---

---
title: "[SDOI2019] 移动金币"
layout: "post"
diff: 省选/NOI-
pid: P5363
tag: ['2019', '各省省选', '山东', 'O2优化']
---
# [SDOI2019] 移动金币
## 题目描述

Alice和Bob将要进行如下的一场游戏。二人轮流操作，且Alice先行。
当轮到一个玩家的时候，他可以选择一枚金币，并将其向左移动任意多格，且至少移动一格。
金币不能被移出棋盘，也不能越过其它金币。

一个 $1\times n$ 的棋盘上最初摆放有 $m$ 枚金币。其中每一枚金币占据了一个独立的格子，任意一个格子内最多只有一枚金币。

如果轮到一个玩家的时候他已经无法做出任何有效操作了（显然这个时候$m$枚金币恰好落在最左侧的$m$个格子中），则被判定为输家。已经知道Alice和Bob都是极致聪明的人，他们在任何局面下总能做出最优的操作。那么有多少初始状态能保证Alice必胜呢？
## 输入格式

输入仅有一行并包含两个正整数，依次为$n$和$m$，如题目所述。
## 输出格式

输出一个整数，表示有多少初始状态可以保证Alice作为先手方能先手必胜。由于答案可能很大，请输出关于$10^9+9$取模后的值。
## 样例

### 样例输入 #1
```
10 3
```
### 样例输出 #1
```
100
```
### 样例输入 #2
```
199 43
```
### 样例输出 #2
```
981535230
```
### 样例输入 #3
```
99999 47
```
### 样例输出 #3
```
39178973
```
## 提示

子任务$1$：（$50$分）$1\le n\le 250$且$1\le m\le 50$。

子任务$2$：（$50$分）$1\le n\le 150000$且$1\le m\le 50$。


---

---
title: "[SNOI2017] 礼物"
layout: "post"
diff: 省选/NOI-
pid: P5364
tag: ['2017', '各省省选']
---
# [SNOI2017] 礼物
## 题目描述

热情好客的**小猴子**请森林中的朋友们吃饭，他的朋友被编号为 $1\sim N$，每个到来的朋友都会带给他一些礼物：**大香蕉**。其中，第一个朋友会带给他 $1$ 个**大香蕉**，之后，每一个朋友到来以后，都会带给他之前所有人带来的礼物个数再加他的编号的 $K$ 次方那么多个。所以，假设 $K=2$，前几位朋友带来的礼物个数分别是：

$1,5,15,37,83,\ldots$

假设 $K=3$，前几位朋友带来的礼物个数分别是：

$1,9,37,111,\ldots$

现在，**小猴子**好奇自己到底能收到第 $N$ 个朋友多少礼物，因此拜托于你了。

已知 $N,K$，请输出第 $N$ 个朋友送的礼物个数对 $10^9+7$ 取模的结果。
## 输入格式

第一行，两个整数 $N,K$。
## 输出格式

一个整数，表示第 $N$ 个朋友送的礼物个数对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
4 2
```
### 样例输出 #1
```
37
```
### 样例输入 #2
```
2333333 2
```
### 样例输出 #2
```
514898185
```
### 样例输入 #3
```
1234567890000 3
```
### 样例输出 #3
```
891659731
```
### 样例输入 #4
```
66666666 10
```
### 样例输出 #4
```
32306309
```
## 提示

- $20\%$ 的数据：$N \le 10^6$；
- 另外 $10\%$ 的数据：$K=1$；
- 另外 $20\%$ 的数据：$K=2$；
- 另外 $20\%$ 的数据：$K=3$；
- $100\%$ 的数据：$N \le 10^{18}$，$K \le 10$。


---

---
title: "[SNOI2019] 纸牌"
layout: "post"
diff: 省选/NOI-
pid: P5371
tag: ['2019', '各省省选']
---
# [SNOI2019] 纸牌
## 题目描述

有一副纸牌。牌一共有 $n$ 种，分别标有 $1,2,...,n$ ，每种有 $C$ 张。故这副牌总共有 $nC$ 张。

三张连号的牌 $(i,i+1,i+2)$ 或三张相同的牌 $(i,i,i)$ 可以组成一**叠**。如果一组牌可以分成若干（包括零）**叠**，就称其为一组**王牌**。

你从牌堆中摸了一些初始牌。现在你想挑出一些牌组成一组王牌，请问有多少种可能组成的王牌呢？答案对 $998244353$ 取模。

两组牌相同当且仅当它们含有的每一种牌数量都相同。
## 输入格式

第 $1$ 行两个整数 $n,C$ 表示牌的种类数和每种的张数；

第 $2$ 行一个整数 $X$ 表示初始牌的种类数；

接下来 $X$ 行每行两个整数 $k_i,a_i$ ，表示初始牌中有 $a_i$ 张 $k_i$ 号牌。每行的 $k_i$ 依次递增。
## 输出格式

输出 $1$ 行 $1$ 个自然数表示答案，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
3 3
0
```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
9 4
9
1 3
2 1
3 1
4 1
5 1
6 1
7 1
8 1
9 3
```
### 样例输出 #2
```
3521
```
## 提示

### 样例解释1

所有方案如下：

1. $\{\}$ （不选任何牌）
2. $\{1,1,1\}$
3. $\{2,2,2\}$
4. $\{3,3,3\}$
5. $\{1,2,3\}$
6. $\{1,1,1,2,2,2\}$
7. $\{1,1,1,3,3,3\}$
8. $\{2,2,2,3,3,3\}$
9. $\{1,1,2,2,3,3\}$
10. $\{1,1,1,2,2,2,3,3,3\}$

### 数据范围

对于所有数据， $1\leq n\leq 10^{18},0\leq a_i\leq C\leq 1000,0\leq X\leq 1000$ 。注意 $a_i$ 和 $C$ 可能为 $0$ 。

- 对于 $20\%$ 的数据， $n=9,C=4$ 。
- 对于另外 $15\%$ 的数据， $n\leq 10^5,C=2$ 。
- 对于另外 $15\%$ 的数据， $X\leq 5,C\leq 10$ 。
- 对于另外 $10\%$ 的数据， $X=0$ 。
- 对于另外 $20\%$ 的数据， $n\leq 10^5$ 。
- 对于余下 $20\%$ 的数据，无特殊限制。


---

---
title: "[SNOI2019] 积木"
layout: "post"
diff: 省选/NOI-
pid: P5372
tag: ['2019', '各省省选', 'Special Judge']
---
# [SNOI2019] 积木
## 题目描述

有一块 $n$ 行 $m$ 列的网格板， $n,m$ 都是奇数。网格上平铺着一些 $1\times 2$ 的积木。积木可以旋转，不能重叠。这些积木共有 $\frac{nm-1}{2}$ 块，也就是说，网格板上只有一格的空位。

你可以做两种操作：

1. 将一块与空白格相邻（指有公共边）的积木旋转 $90^\circ$ 到空白格中；
2. 将一块与空白格积木相邻的积木平移至空白格中。

如图所示（被移动的积木颜色较浅）：

![](https://cdn.luogu.com.cn/upload/pic/58669.png)

请你用以上两种操作将给定的网格板变换为指定的状态。
## 输入格式

第一行两个正奇数 $n,m$ ，分别表示网格的行数和列数。

接下来 $n$ 行，每行 $m$ 个字符，描述网格板的初始状态：

- `<`表示这个格子是一块积木的左半部分；
- `>`表示这个格子是一块积木的右半部分；
- `n`表示这个格子是一块积木的上半部分；
- `u`表示这个格子是一块积木的下半部分；
- `o`表示这个格子是空的。

接下来另外 $n$ 行，每行 $m$ 个字符，描述你需要将网格板变成的目标状态，格式同上。


## 输出格式

你需要输出一个字符串，按顺序表示你的操作：

- `L`表示你移动了空白格左侧的积木；
- `R`表示你移动了空白格右侧的积木；
- `U`表示你移动了空白格上方的积木；
- `D`表示你移动了空白格下方的积木。

当然，没有操作的话输出空串就好了。


## 样例

### 样例输入 #1
```
3 3
nnn
uuu
o<>
<>n
<>u
<>o
```
### 样例输出 #1
```
URLR
```
### 样例输入 #2
```
5 5
n<><>
un<>n
nuonu
u<>un
<><>u
<><>o
<><>n
<><>u
<><>n
<><>u
```
### 样例输出 #2
```
RLLRLRR
```
## 提示

#### 数据范围与说明

你输出的操作序列长度不能超过 $8\times 10^6$ 。

对于所有数据， $1\leq n,m\leq 2000$ 。

- 对于 $10\%$ 的数据， $n,m\leq 3$ ；
- 对于另外 $10\%$ 的数据， $n,m\leq 5$ ；
- 对于另外 $20\%$ 的数据， $m=3$ ；
- 对于另外 $20\%$ 的数据， $n,m\leq 50$ ；
- 对于另外 $20\%$ 的数据， $n,m\leq 200$ ；
- 对于余下 $20\%$ 的数据，无特殊限制。

#### SPJ 说明

参考 https://www.luogu.org/discuss/show/114298 ，感谢 @M_sea 的贡献。


---

---
title: "[YNOI2019] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P5415
tag: ['数学', '2019', '各省省选', '云南', '概率论']
---
# [YNOI2019] 游戏
## 题目描述

在经历了漫长的烧脑之旅后，相信同学们的思维已经充分地活跃起来了。最后，让我们玩一个游戏来结束这次充满乐趣和挑战的冒险之旅！

有 $n$ 个人在玩游戏，游戏规则如下：

在游戏开始之前，将这 $n$ 个人按照 $1\sim n$ 的顺序唯一编号。游戏开始后，每一轮只允许 $4$ 个人进入游戏，其他人按照各自的编号组成等待队列，等待参加游戏。

游戏中每个人赢得比赛的机会是同等的，游戏举办多轮，每一轮的获胜者可以继续参加下一轮的比赛，输家将根据本轮比赛开始之前的顺序排在等待队列的末尾（如果本轮的输家中有人之前赢得过比赛，那么他将在等待队列中排在本轮所有输家的前面）。

例如，在某一轮比赛开始之前小明排在小红和小刚前面，如果在该轮比赛中小明、小红和小刚都没有赢，那么小明、小红和小刚将退出比赛排在等待队列的末尾，但是小明将会继续按照比赛开始之前的顺序排在小红和小刚前面。存在的特殊情况是，如果小刚在这轮比赛之前赢得过比赛，那么小刚将在等待序列中排在小明和小红的前面。

比赛中，如果有人连续赢了 $m$ 次，那么他就是这个游戏最后的赢家。你的任务是，预测第 $k$ 个人成为最终赢家的可能。
## 输入格式

**输入包含多组数据。**

第一行，包含一个正整数 $T$，代表该输入文件中所含的数据组数。

接下来是 $T$ 组数据，每组数据的格式如下：

每组数据仅一行，包含三个整数 $n,m,k$。
## 输出格式

输出包含 $T$ 行，分别对应 $T$ 组数据的答案，即第 $k$ 个人成为最终赢家的可能（结果保留 $6$ 位小数）。
## 样例

### 样例输入 #1
```
3
4 1 1
5 1 5
5 2 1

```
### 样例输出 #1
```
0.250000
0.000000
0.217626
```
## 提示

#### 数据规模与约定
- 对于 $30\%$ 的数据：保证 $ n \le 5$，$m \le 5$。
- 对于 $60\%$ 的数据：保证 $n \le 8$，$m \le 8$。
- 对于100%的数据：保证 $4 \le n \le 10$，$0 < m \le 10$，$1\le k \le n$，$T=1$。


---

---
title: "[BJOI2016] 水晶"
layout: "post"
diff: 省选/NOI-
pid: P5458
tag: ['图论', '2016', '各省省选', '网络流', '北京', 'O2优化']
---
# [BJOI2016] 水晶
## 题目背景

不用惊慌，今天的题都不是小强出的。  

——融入了无数心血的作品，现在却不得不亲手毁掉，难以体会他的心情啊。

——那也是没有办法的事情，能量共振不消除的话…… 

望着已经被装上炸药的水晶，02放下了望远镜，看向了手中的共振分析报告。  

还是会有一些水晶，幸存下来的…… 也许吧。
## 题目描述

地图由密铺的六边形单元组成，每个单元与其他六个单元相邻。  

为了方便起见，我们用坐标 $(x,y,z)$ 描述一个单元的位置，表示从原点开始按如图所示的 $x,y,z$ 方向各走若干步之后到达的地方。  

有可能有两个坐标描述同一个单元，比如 $(1,1,1)$ 和 $(0,0,0)$ 描述的都是原点。

![](https://cdn.luogu.com.cn/upload/image_hosting/dd1hb5vv.png)

显然 $(x,y,z)$ 单元和 $(x+1,y,z)$，$(x-1,y,z)$ ，$(x,y+1,z)$，$(x,y-1,z)$，$(x,y,z+1)$，$(x,y,z-1)$ 相邻。  

有 $N$ 块水晶位于地图的单元内，第 $i$ 块水晶位于坐标 $(x_i, y_i, z_i)$ 所表示的单元中，并拥有 $c_i$ 的价值，每个单元内部可能会有多块水晶。  

地图中，有一些单元安装有能量源。如下图，任何满足 $x+y+z$ 是 $3$ 的整数倍的坐标所描述的单元内都安装有能量源。  

![](https://cdn.luogu.com.cn/upload/image_hosting/9x4o6dhs.png)

有能量源的单元中的水晶价值将会额外增加 $10\%$。如果三块水晶所在的单元满足特定排列，那么它们将会引发共振。 

共振分两种，$a$ 共振和 $b$ 共振。  

$a$ 共振：如果三块水晶所在的单元两两相邻地排成一个三角形，那么会引起 $a$ 共振。   

![](https://cdn.luogu.com.cn/upload/image_hosting/48uc3ey4.png)

图中每一个三角形表示这三个单元各有一块水晶将会发生一个 $a$ 共振。  

$b$ 共振：如果三块水晶所在的单元依次相邻地排成一条长度为 $2$ 的直线段，且正中间的单元恰好有能量源，那么会引起b共振。  

![](https://cdn.luogu.com.cn/upload/image_hosting/2b47zl09.png)

图中粉红色线段表示这三个单元各有一块水晶将会发生一个 $b$ 共振，黑色线段表示即使这三个单元有水晶也不会发生 $b$ 共振。  

现在你要炸掉一部分水晶，使得任何共振都不会发生的前提下，剩余水晶的价值总和最大。
## 输入格式

第一行一个正整数 $N$，表示水晶数量。  
接下来 $N$ 行，每行四个整数用空格分开的整数 $x_i,y_i,z_i,c_i$，表示一个水晶的位置和价值。  
有可能有水晶的位置重合。  
## 输出格式

一行一个实数，表示剩余水晶的价值总和，四舍五入保留 $1$ 位小数。
## 样例

### 样例输入 #1
```
4
0 0 0 11
1 0 0 5
0 1 0 7
0 0 -1 13
```
### 样例输出 #1
```
25.1
```
## 提示

【样例 $1$ 说明】   

四块水晶排成一个菱形，没有 $b$ 共振，有 $2$ 处 $a$ 共振，分别是 $1,2,4$ 号水晶和 $1,3,4$ 号水晶形成的三角形。 
因此，为了消除两处 $a$ 共振，有如下 $3$ 种方案：

1. 炸掉 $1$ 号水晶，留下 $2,3,4$ 号水晶，总剩余价值 $5+7+13=25$
2. 炸掉 $4$ 号水晶，留下 $1,2,3$ 号水晶，总剩余价值 $11 \times(1+10\%)+5+7=24.1$   
3. 炸掉 $2,3$ 号水晶，留下$1,4$ 号水晶，总剩余价值 $11 \times (1+10\%)+13=25.1$  

因此我们采用第三种方案，最大总剩余价值为$25.1$。    

【数据范围】  

$1\le N \le 50000$    
$1\le c_i \le 1000$   
$-1000 \le x_i,y_i,z_i \le 1000$   


---

---
title: "[BJOI2016] IP地址"
layout: "post"
diff: 省选/NOI-
pid: P5460
tag: ['字符串', '2016', '各省省选', '北京', 'O2优化', '字典树 Trie']
---
# [BJOI2016] IP地址
## 题目描述

路由表中每一项对应了一个形如 1011101????????????????????????? 的规则，会匹配指定的前缀为给定形式的 $\texttt{ip}$。  

当有多个规则匹配时，前缀最长的生效。同一时刻不会有多个匹配的规则的前缀一样长。每一个时刻，会有一条规则被加入，或者之前被加入的某条规则会过期。   

给一系列 $\texttt{ip}$，问每一个 $\texttt{ip}$ 在一个给定的时间区间内匹配到的生效规则变了几次？  
   
例如，有一系列事件：    
 
$\texttt{Add}$ $110$   
$\texttt{Add}$ $11$   
$\texttt{Del}$ $110$   
$\texttt{Del}$ $11$   
$\texttt{Add}$ $110$     

那么，$\texttt{ip}$ 地址 11011101001001010101011101000010 在这五个时刻之后匹配到的生效规则分别是：  

$110$ (第一条)，   
$110$ (第一条)，   
$11$ (第二条)，   
空，   
$110$ (第三条)。     

其中，在第二个事件后到第五个事件后的这段过程中，一共变了 $3$ 次。
## 输入格式

第一行两个正整数 $n,q$，表示事件数有询问数。  
接下来 $n$ 行，每行描述一个事件，格式为：  

$\texttt{Add}$ $s$ 表示新建一个规则，匹配前缀为 $s$ 的所有 $\texttt{ip}$。  
$\texttt{Del}$ $s$ 表示把当前前缀 $s$ 对应的规则删掉(过期)。保证之前有这样的一条规则还没被删。     

接下来 $q$ 行，每行一个 $\texttt{ip}$ 与两个正整数 $a,b$，表示查询在第 $a$ 个事件后到第 $b$ 个事件的这段时间里，这个 $\texttt{ip}$ 匹配到的生效规则变化的次数。 $\texttt{ip}$ 用01字符串来表示。
## 输出格式

对于每次查询，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 1
Add 110
Add 11
Del 110
Del 11
Add 110
11011101001001010101011101000010 2 5
```
### 样例输出 #1
```
3
```
## 提示

【数据范围】  

$1\le n,q \le 10^5$


---

---
title: "[BJOI2015] 骑士的旅行"
layout: "post"
diff: 省选/NOI-
pid: P5478
tag: ['2015', '各省省选', '北京', 'O2优化']
---
# [BJOI2015] 骑士的旅行
## 题目背景

在一片古老的土地上，有一个繁荣的文明。

这片大地几乎被森林覆盖，有N座城坐落其中。巧合的是，这N座城由恰好N-1条双向道路连接起来，使得任意两座城都是连通的。也就是说，这些城形成了树的结构，任意两座城之间有且仅有一条简单路径。

在这个文明中，骑士是尤其受到尊崇的职业。任何一名骑士，都是其家族乃至家乡的荣耀。Henry从小就渴望成为一名能守护家乡、驱逐敌人的骑士。勤奋训练许多年后，Henry终于满18岁了。他决定离开家乡，向那些成名已久的骑士们发起挑战！

## 题目描述

根据Henry的调查，大陆上一共有 $M$ 名受封骑士，不妨编号为 $1$ 到 $M$。第 $i$ 个骑士居住在城 $P_i$，武力值为 $F_i$。

Henry计划进行若干次旅行，每次从某座城出发沿着唯一的简单路径前往另一座城，同时会挑战路线上武力值最高的 $K$ 个骑士（Henry的体力有限，为了提高水平，当然要挑战最强的骑士）。如果路线上的骑士不足 $K$ 人，Henry会挑战遇到的所有人。

每次旅行前，可能会有某些骑士的武力值或定居地发生变化，Henry自然会打听消息，并对计划做出调整。

为了在每次旅行时做好充分准备，Henry希望你能帮忙在每次旅行前计算出这条路线上他将挑战哪些对手。
## 输入格式

第一行，一个整数 $N$ ，表示有 $N$ 座城，编号为 $1 \sim N$。

接下来 $N-1$ 行，每行两个整数 $u_i$ 和 $v_i$，表示城 $u_i$ 和城 $v_i$ 之间有一条道路相连。

第 $N+1$ 行，一个整数 $M$，表示有 $M$ 个骑士。

接下来M行，每行两个整数 $F_i$ 和 $P_i$ 。按顺序依次表示编号为 $1 \sim M$ 的每名骑士的武力值和居住地。

第 $N+M+2$ 行，两个整数 $Q,~K$，分别表示操作次数和每次旅行挑战的骑士数目上限。

接下来 $Q$ 行，每行三个整数 $T_i,~X_i,~Y_i$ 。$T_i$ 取值范围为 $\{1,~2,~3\}$，表示操作类型。

一共有以下三种类型的操作：

$T_i=1$ 时表示一次旅行，Henry将从城 $X_i$ 出发前往城市 $Y_i$；

$T_i=2$ 时表示编号为 $X_i$ 的骑士的居住地搬到城 $Y_i$；

$T_i=3$ 时表示编号为 $X_i$ 的骑士的武力值修正为 $Y_i$。
## 输出格式

输出若干行，依次为每个旅行的答案。

对每个 $T_i=1$ 的询问，输出一行，按从大到小的顺序输出Henry在这次旅行中挑战的

所有骑士的武力值。如果路线上没有骑士，输出一行，为一个整数 $-1$。
## 样例

### 样例输入 #1
```
5  
1 2  
1 3  
2 4  
2 5  
4  
10 1  
6 1  
14 5  
7 3  
5 3  
1 2 3  
1 5 3  
1 4 4  
2 1 4  
1 2 3
```
### 样例输出 #1
```
10 7 6  
14 10 7  
-1  
7 6
```
## 提示

100%的数据中，$1 \leq N,~M \leq 40,000,~1 \leq Ui,~Vi,~Pi \leq N,~1\leq Q \leq 80,000,~1 \leq K \leq 20$，旅行次数不超过 40,000 次，武力值为不超过1,000的正整数。


---

---
title: "[BJOI2015] 隐身术"
layout: "post"
diff: 省选/NOI-
pid: P5479
tag: ['2015', '各省省选', '北京']
---
# [BJOI2015] 隐身术
## 题目描述

给定两个串$A$、$B$。请问$~B~$中有多少个非空子串和$~A~$的编辑距离不超过$K$？

所谓“子串”，指的是$~B~$中连续的一段。不同位置的内容相同的子串算作多个。两个串之间的“编辑距离”指的是把一个串变成另一个串需要的最小的操作次数，每次操作可以插入、删除或者替换一个字符。
## 输入格式

第一行一个非负整数$K$。接下来两行，每行一个由大写字母组成的字符
串，分别表示$~A~$和$~B~$。
## 输出格式

输出一行一个整数，表示所求答案。
## 样例

### 样例输入 #1
```
1
AAA
AABBAAB
```
### 样例输出 #1
```
5
```
## 提示

对$100\%$的数据，$K\leq5$，两个字符串均非空，长度和小于$10^5$。


---

---
title: "[BJOI2015] 糖果"
layout: "post"
diff: 省选/NOI-
pid: P5481
tag: ['2015', '各省省选', '北京', 'O2优化', '组合数学']
---
# [BJOI2015] 糖果
## 题目背景

Alice 正在教她的弟弟 Bob 学数学。 
## 题目描述

每天，Alice 画一个 $n$ 行 $m$ 列的表格，要求 Bob 在格子里填数。 

Bob已经学会了自然数 $1$ 到 $k$ 的写法。因此他在每个格子里填 $1 \sim k$ 之间的整数。 

Alice 告诉 Bob，如果 Bob 填写完表格的 $n \times m$ 个数以后，每行的数从第 $1$ 列到第 $m$ 列单调不减，并且任意两行至少有一列的数不同，而且以前 Bob 没有填写过相同的表格，那么 Alice 就给 Bob 吃一颗糖果。 

Bob想知道，如果每天填写一遍表格，最多能吃到多少颗糖果。 

答案对 $p$ 取模。

## 输入格式

输入只有一行四个整数，分别代表 $n, m, k, p$。
## 输出格式

输出一行，一个整数，表示答案模 $p$ 后的结果。 
## 样例

### 样例输入 #1
```
1 3 3 10
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
2 2 2 10
```
### 样例输出 #2
```
6
```
## 提示

#### 样例输入输出 1 解释

共有 $10$ 种方案，取模后为 $0$。

---

#### 数据规模与约定

- 对于 $100\%$ 的数据，保证 $1 \leq n, m \leq 10^5$，$1 \leq k,p \leq 2 \times 10^9$。


---

---
title: "[JSOI2016] 灯塔"
layout: "post"
diff: 省选/NOI-
pid: P5503
tag: ['动态规划 DP', '2016', '各省省选', '江苏']
---
# [JSOI2016] 灯塔
## 题目描述

`JSOI`的国境线上有$N$座连续的山峰,其中第$i$座的高度是$h_i$.为了简单起见,我们认为这$N$座山峰排成了连续一条直线.如果在第$i$座山峰上建立一座高度为$p(p≥0)$的灯塔,`JYY`发现,这座灯塔能够照亮第$j$座山峰,当且仅当满足如下不等式:

$$h_j \le h_i+p-\sqrt {|i-j|}$$

`JSOI`国王希望对于每一座山峰,`JYY`都能提供建造一座能够照亮全部其他山峰的灯塔所需要的最小高度.你能帮助`JYY`么?

## 输入格式

输入一行包含一个正整数$N$。

接下来$N$行，第$i$行包含一个正整数$h_i$，表示第$i$座山峰的高度。
## 输出格式

第$i$行包含一个非负整数，表示在第$i$座山峰上修建灯塔所需要的最小高度$p_i$
## 样例

### 样例输入 #1
```
6
5
3
2
4
2
4
```
### 样例输出 #1
```
2
3
5
3
5
4
```
## 提示

对于$100\%$的数据，$1< N \le  10^5,0 < h_i \le  10^9$


---

---
title: "[JSOI2016] 炸弹攻击1"
layout: "post"
diff: 省选/NOI-
pid: P5544
tag: ['2016', '各省省选', '江苏', '模拟退火']
---
# [JSOI2016] 炸弹攻击1
## 题目背景

JYY 最近迷上了一款塔防游戏，在游戏中，JYY 除了建设建筑，还可以使用炸弹对屏幕上的敌人进行范围杀伤。
## 题目描述

游戏地图可以简单认为是一个二维平面。JYY 建造了 $N$ 个建筑，每个建筑都是一个圆，其中第 $i$ 个建筑的圆心位于 $(x_i,y_i)$ 且半径为 $r_i$。地图上一共有 $M$ 个敌人，一个敌人可以近似看成一个平面上的点，其中第 $i$ 个敌人位于$ (p_i,q_i)$。JYY 可以使用一枚可以设置半径的炸弹，可以设置一个不超过 $R$ 的范围，然后选择平面上的一个点引爆，范围内的所有敌人全部消灭。

当然，由于炸弹威力巨大，如果爆炸范围接触到 JYY 的建筑，那么 JYY 的建筑也会受到损伤。（注：如果炸弹的爆炸范围仅接触到了 JYY 建筑的边界，则不会对 JYY 的建筑造成损伤；如果敌人出现在了爆炸范围的边界，则该敌人被消灭）JYY 可以自由控制炸弹的爆炸地点和爆炸半径。作为一个保守的玩家，他希望在保证自己建筑毫发无损的情况下，消灭尽量多的敌人。
## 输入格式

第一行包含三个非负整数，分别为 $N,M,R$；

接下来 $N$ 行，每行三个整数，其中第 $i$ 行为 $x_i,y_i,r_i$，表示第 $i$ 个建筑的位置和半径。数据保证所有建筑不相交（但是有可能边界接触）；

接下来 $M$ 行，每行两个整数，其中第 $i$ 行为 $p_i,q_i$，表示第 $i$ 个敌人的位置。
## 输出格式

输出一行一个整数，表示 JYY 最多可以消灭的敌人数量。
## 样例

### 样例输入 #1
```
1 5 3
0 0 1
3 3
-3 3
3 -3
3 0
0 3 
```
### 样例输出 #1
```
3
```
## 提示

- 对于 $20\%$ 的数据，满足 $M = 2$；
- 对于另外 $20\%$ 的数据，满足 $N = 0$；
- 对于另外 $20\%$ 的数据，满足 $M \leq 50$；
- 对于 $100\%$ 的数据，满足：
  - $0 \leq N \leq 10$；
  - $0 < M \leq 10^3$；
  - $1 \leq R, r_i \leq 2 \times 10^4$；
  - $|p_i|, |q_i|, |x_i|, |y_i| \leq 2 \times 10^4$。



---

---
title: "[JSOI2016] 炸弹攻击2"
layout: "post"
diff: 省选/NOI-
pid: P5545
tag: ['计算几何', '2016', '各省省选', '江苏']
---
# [JSOI2016] 炸弹攻击2
## 题目背景

还记得那款题为炸弹攻击的塔防游戏吗？这款游戏出了续作，炸弹的威力大大加强了。
## 题目描述

游戏的地图是一个二维平面。JYY 的阵地位于$x$轴下方，而所有的敌人目前都位于$x$轴上方。

在 JYY 的阵地中有建有$T$个激光塔和$S$个发射源。其中第$i$个防御塔$T_i$的坐标为$(tx_i,ty_i)$，第$i$个发射源$S_i$的坐标为$(sx_i,sy_i)$。

地图上有$D$个敌人，第$i$个敌人$D_i$的坐标为$(dx_i,dy_i)$。

两座激光塔可以相互连接形成能量墙。发射源朝向敌人发出的能量如果穿过了能量墙，可以得到巨大的加强而变为超级射线并瞬间消灭敌人。

JYY 想知道他有多少种可以可以发出超级射线的攻击方案。

具体来说，一个可以发出超级射线的攻击方案为一个由四个点组成的集合：{$T_i,T_j,S_k,D_l$}，满足$1$$\leq$$i$$<$$j$$\leq$$T$$,$$1$$\leq$$k$$\leq$$S$$,$$1$$\leq$$l$$\leq$$D$，并且线段$T_iT_j$和线段$S_kD_l$相交。

游戏设定保证在这$T$$+$$D$$+$$S$个点中，不存在重点也不存在三点共线。
## 输入格式

第一行包含一个正整数$D$；

接下来$D$行，每行包含两个整数$dx_i,dy_i$，表示一个敌人的坐标；

第$D$$+$$1$行包含一个整数$S$；

接下来$S$行，每行包含两个整数$sx_i,sy_i$，表示一个发射源的坐标；

第$D$$+$$S$$+$$1$行包含一个整数$T$；

接下来$T$行，每行包含两个整数$(tx_i,ty_i)$，表示一个激光塔的坐标。
## 输出格式

输出一行一个整数，可以发出超级射线的攻击方案个数。
## 样例

### 样例输入 #1
```
3
1 12
10 30
30 10
1
10 -10
4
2 -11
9 -1
11 -1
15 -14
```
### 样例输出 #1
```
7
```
## 提示

对于$20$%的数据，满足$D,S,T$$\leq$$30$；

对于$50$%的数据，满足$D,S,T$$\leq$$150$；

对于$100$%的数据，满足$1$$\leq$$D,S,T$$\leq$$800$$,$$dy_i$$>$$0$$,$$sy_i$$,$$ty_i$$<$$0$，所有坐标绝对值不超过$10^9$。


---

---
title: "[SDOI2008] 石子合并"
layout: "post"
diff: 省选/NOI-
pid: P5569
tag: ['贪心', '2008', '各省省选', '山东']
---
# [SDOI2008] 石子合并
## 题目描述

在一个操场上摆放着一排 $N$ 堆石子。现要将石子有次序地合并成一堆。规定每次只能选相邻的 $2$ 堆石子合并成新的一堆，并将新的一堆石子数记为该次合并的得分。

试设计一个算法，计算出将 $N$ 堆石子合并成一堆的最小得分。
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行，第 $i$ 行一个整数 $a_i$，代表第 $i$ 堆石子的石子数。
## 输出格式

输出将所有石子合并为一堆的最小得分。
## 样例

### 样例输入 #1
```
4
1
1
1
1
```
### 样例输出 #1
```
8
```
## 提示

$ N \leq 40000, a_i \leq 200$

**请注意 $N$ 的范围（来自上传者的提示）**


---

---
title: "[SDOI2015] 道路修建"
layout: "post"
diff: 省选/NOI-
pid: P5618
tag: ['2015', '各省省选']
---
# [SDOI2015] 道路修建
## 题目描述

某国有 $2N$ 个城市，这 $2N$ 个城市构成了一个 $2$ 行 $N$ 列的方格网。现在该国政府有一个旅游发展计划，这个计划需要选定 $L$、$R$ 两列 $(L \leq  R)$，修建若干条专用道路，使得这两列之间（包括这两列）的所有 $2(R-L+1)$ 个城市中每个城市可以只通过专用道路就可以到达这 $2(R-L+1)$ 个城市中的任何一个城市。这种专用道路只能在同一行相邻两列的城市或者同一列的两个城市之间修建，且修建需要花费一定的费用。

由于该国政府决定尽量缩减开支，因此政府决定，选定 $L$、$R$ 后，只修建 $2(R-L+1)-1$ 条专用道路，使得这些专用道路构成一个树结构。现在你需要帮助该国政府写一个程序，完成这个任务。具体地，该任务包含 $M$ 个操作，每个操作的格式如下：

1. ``C x0 y0 x1 y1 w``：由于重新对第 $x_0$ 行第 $y_0$ 列的城市和第 $x_1$ 行第 $y_1$ 列的城市之间的情况进行了考察，它们之间修建一条专用道路的花费变成了 $w$；

2. ``Q L R``：若政府选定的两列分别为 $L$、$R$，询问政府的最小开支。
## 输入格式

第一行，两个整数 $N$、$M$。  

第二行，$N-1$ 个整数，其中第 $i$ 个整数表示初始时第 $1$ 行第 $i$ 列的城市和第 $1$ 行第 $i+1$ 列的城市之间修建一条专用道路的费用。  

第三行，$N-1$ 个整数，其中第 $i$ 个整数表示初始时第 $2$ 行第 $i$ 列的城市和第 $2$ 行第 $i+1$ 列的城市之间修建一条专用道路的费用。  

第四行，$N$ 个整数，其中第 $i$个整数表示初始时第 $1$ 行第 $i$ 列的城市和第 $2$ 行第 $i$ 列的城市之间修建一条专用道路的费用。  
接下来的 $M$ 行，每行一个操作。
## 输出格式

对于每个询问操作，输出一行，表示你计算出的政府的最小开支。
## 样例

### 样例输入 #1
```
3 3
1 2
2 1
3 1 2
Q 1 3
C 1 2 2 2 3
Q 2 3
```
### 样例输出 #1
```
7
5
```
## 提示

对于全部的数据，$1 \leq N, M \leq 60000$，任何时刻任何一条专用道路的修建费用不超过 $10^4$。


---

---
title: "[SDOI2018] 原题识别-改"
layout: "post"
diff: 省选/NOI-
pid: P5669
tag: ['2018', '各省省选', '山东']
---
# [SDOI2018] 原题识别-改
## 题目背景

蒟蒻$\color{grey}{\text{suwakow}}$花了三天时间，研究出了[这道题](https://www.luogu.org/problem/P4618)的**线性空间**，且不依赖输入的随机性的一种优（du）秀（liu）做法。于是她决定拿出来毒瘤一下大家。
## 题目描述

有一棵$n$个点的有根树，根节点编号为$1$，且编号为$i$的节点有颜色$a_i$。你需要支持$m$次询问。询问有以下两种格式：

- $1~x~y$：询问树上编号为$x$的节点到编号为$y$的节点的最短路径中，不同的颜色有多少种。

- $2~a~b$：在节点$a$到根节点的路径中随机选择一个点$x$，在节点$b$到根节点的路径中随机选择一个点$y$，求询问 $1~x~y$ 的答案期望。（路径包含$a$, $b$和根节点）

对于询问$2$，设答案为$\mathrm{ans}$，$a$到根节点的路径经过的点数为$\mathrm{cnt_a}$，$b$到根节点的路径经过的点数为$\mathrm{cnt_b}$，你只需要输出$\mathrm{ans}\cdot \mathrm{cnt_a}\cdot \mathrm{cnt_b}$。

## 输入格式

**注意：输入格式与原题不同**

每个测试点仅包含一组数据。

输入数据的第一行包含两个非负整数$n$, $m$，表示节点个数和询问次数。

接下来一行包含$n$个正整数，第$i$个正整数为$a_i$，表示节点$i$的颜色。

接下来$n-1$行，每行包含两个整数$u$, $v$，表示编号为$u$的节点和编号为$v$的节点之间存在一条边。保证输入的边构成一棵树。

接下来$m$行，每行包含一个询问。询问的格式和意义见题目描述。
## 输出格式

输出$m$行，第$i$行包含一个非负整数，表示第$i$次询问的答案。
## 样例

### 样例输入 #1
```
5 3
1 4 4 5 4
1 2
2 3
3 4
2 5
1 2 3
2 1 3
1 3 2

```
### 样例输出 #1
```
1
5
1
```
### 样例输入 #2
```
10 5
3 4 3 8 9 3 2 8 5 7
1 2
2 3
3 4
4 5
5 6
4 7
4 8
8 9
8 10
1 1 10
2 3 5
2 7 5
2 5 4
1 8 6
```
### 样例输出 #2
```
4
34
61
45
3
```
## 提示

对于所有数据，保证$1\leq a_1, a_2, \ldots, a_n\leq n\leq 10^5$, $1\leq m\leq 2\times 10^5$。保证输入的边构成一棵树。

子任务$1$（$30$分）：保证不存在询问$2$。

子任务$2$（$30$分）：保证对于每一条边都有$v=u+1$。

子任务$3$（$40$分）：没有任何附加的限制。



---

---
title: "[GZOI2017] 河神"
layout: "post"
diff: 省选/NOI-
pid: P5678
tag: ['数学', '2017', '各省省选', 'O2优化', '贵州', '矩阵乘法']
---
# [GZOI2017] 河神
## 题目背景

GZOI2017 D2T1

终于忍受不了苦 X 的搬砖生活, Shlw 把手里的板砖扔进了河里.

不出意料地, 河神冒了出来.

Shlw 说: “我掉了金砖, 快给我金砖!”

“!!! 你已经知道套路了吗,”河神说道, “但是你要金砖的话, 我就不给你2017 彩虹小马大电影的资源了哦. 如果你说实话的话, 我还可以考虑一下.”

Shlw 发现事情并不简单, 在金钱和信仰面前, 难以抉择.

突然, Shlw 不理会河神, 自顾自的地跑走了.

“唉, 现在的年轻人啊... 真不知道在想什么.”Pinkie Pie 感叹, 卸下了河神伪装.
## 题目描述

Shlw 从河神给的选择中, 获得了一道当年挂掉的代数题的灵感.

但现在他希望你来帮忙解答, 因为他自己忙着去搜小马资源去了.

给出数列 $\{a_n\}$ 和 $\{b_n\}$ 以及 $\{A_n\}$ 的递推关系, 试求出数列 $\{A_n\}$ 第 $N$ 项.

递推关系为:

$$A_n=\begin{cases}a_n  &  0 \le n < K \\ \bigoplus (A_{n-K+t} \otimes b_t) & n \ge K \end{cases}$$

其中，$\otimes$ 表示与操作，$\oplus$ 表示或操作。
## 输入格式

第一行两个正整数 $N$ 和 $K$ 。

第二行 $K$ 个空格隔开的非负整数, 表示 $\{a_n\}$。

第三行 $K$ 个空格隔开的非负整数, 表示 $\{b_n\}$。
## 输出格式

一行, 一个整数, 表示$\{A_n\}$。
## 样例

### 样例输入 #1
```
10 5
2 3 5 7 12
23 45 2 4 8
```
### 样例输出 #1
```
15
```
## 提示

【样例解释】

从 $A_0$ 至 $A_{10}$ 分别为: $2, 3, 5, 7, 12, 15, 15, 13, 15, 15, 15$

【数据约束】

![](https://cdn.luogu.com.cn/upload/image_hosting/16mwbo3z.png)

【后记】

后来, Pinkie Pie 偷偷来到 Shlw 家里, 她把这题拿回去考 Apple Jack, 于是 Apple Jack就有了狂吃苹果来畅游多重宇宙的本领.


---

---
title: "[GZOI2017] 共享单车"
layout: "post"
diff: 省选/NOI-
pid: P5680
tag: ['动态规划 DP', '2017', '各省省选', '树形 DP', '贵州', '虚树']
---
# [GZOI2017] 共享单车
## 题目背景

GZOI2017 D2T3
## 题目描述

某校校内有 A 公司与 B 公司两家共享单车公司相互竞争。A 公司为了尽可能提升自己在校园内的占有率，会设法阻碍 B 公司的回收行动。

整个校园由 $N$ 个区域和 $M$ 条道路组成，每条道路连接两个区域。校园有一个区域 $K$ 是 B 公司的大本营，所有的单车回收行动从该区域 **出发**。B 公司为了减少成本，回收时从区域 $K$ 到任何一个区域 $X$ 都选择长度 **最短** 的路径，如果有多条到某一个区域的最短路径，则选择所有最短路径中该区域的前一区域 **编号最小** 的一条路径，称这条路径为 $K$ 到 $X$ 的 **回收路线**。所有的 **回收路线** 组成一棵树状结构，称之为 **回收路线树**。如下图中，绿色的边构成的就是一棵 **回收路线树**。

![](https://cdn.luogu.com.cn/upload/image_hosting/x0cksrjz.png)

B 公司每次会回收若干个区域的单车，称这些区域为 **回收区域**。B 公司还将某些区域设为 **投放区域**，称其余区域为 **非投放区域**。在 **回收路线树** 上，标记出区域 $K$，标记出所有的 **回收区域**，以及标记出任意两个 **回收区域** 在 **回收路线树** 上的最近公共祖先。

如下图，假设 $4$ 与 $6$ 号区域是 **投放区域**，$4, 5, 6$ 号区域是**回收区域**，则被标记的区域有 $1, 4, 5, 6$。

![](https://cdn.luogu.com.cn/upload/image_hosting/mdwo6dcn.png)

A 公司对 B 公司的回收行动造成了阻碍，**当且仅当** 对任意一个 $K$ 以外的被标记的 **投放区域** $X$，从区域 $K$ 到 $X$ 的 **回收路线上** 都存在两个被标记的区域，它们之间 **所有道路**（回收路线树上两点路径）被阻碍。

阻碍一条道路的代价为该道路的长度。上图中 A 公司选择阻碍 $1 \rightsquigarrow  4$，$5 \rightsquigarrow 6$ 两条路径，代价为 $3+4+3=10$。

你的任务是帮助 A 公司计算如何以最小的代价，阻碍 B 公司的回收行动。
## 输入格式

第一行四个整数 $N, M, K, Q$ 分别表示 X 校校园内区域数量、道路数量以及 B 公司大本营的编号 $K$ 和操作数量。

第二到第 $M + 1$ 行描述道路，每行三个整数 $S,T,Len$ 表示有一条从 $S$ 出发 $T$ 结束的长度为 $Len$ 双向道路。

接下来第 $M + 2$ 行到第 $M + Q + 1$ 行，每行第一个整数表示操作类型，$0$ 表示 B 公司会改变**投放区域**，$1$ 表示 B 公司的一次回收行动。

操作类型为 $0$时，后接一个整数 $num$，表示 B 公司改变的区域数目，紧接着 $num$ 个数字分别表示区域编号。对于一个被改变的区域，如果它是 **投放区域**，把它改为 **非投放区域**；如果它是 **非投放区域**，把它改为 **投放区域**；

操作类型为 $1$ 时，后接一个整数 $num$ 表示 **回收区域** 数目，紧接着 $num$ 个整数表示 B 公司的 **回收区域** 编号。每次需要在 **回收路线树** 上重新标记。
## 输出格式

对于每一次回收行动，输出一行表示 A 公司对 B 公司造成阻碍的最小代价。注意，如果没有被标记的 **投放区域**，输出 $-1$。
## 样例

### 样例输入 #1
```
6 6 1 4
1 2 3
2 3 2
2 4 4
3 6 4
1 5 5
5 6 3
0 3 3 4 6
1 3 4 5 6
0 1 3
1 4 3 4 5 6
```
### 样例输出 #1
```
10
6
```
### 样例输入 #2
```
12 11 4 5
4 1 32
4 6 42
1 3 29
7 1 17
7 10 23
9 7 21
5 6 16
2 6 28
5 8 14
8 11 11
8 12 17
1 11 1 2 3 5 6 7 8 9 10 11 12
0 4 3 11 5 2
1 4 10 9 6 11
0 4 7 8 12 11
1 4 11 2 9 10
```
### 样例输出 #2
```
-1
41
77
```
## 提示

【数据约束】

对于 $30\%$ 的数据，$N\le 200$，$Q\le 200$；

对于 $60\%$ 的数据，保证每次 **回收区域** 数量恒为 $N-1$；

对于 $80\%$ 的数据，$N\le 20000$，$M=N-1$，$Q\le 1000$，$num\le 200$；

对于 $100\%$ 的数据，$N\le 50000$，$M\le 100000$，$Q\le 1500$，$num\le 500$。

所有数据保证道路无自环，所有道路长度小于 $2000$，且区域 $K$ 任意时刻均非**投放区域**。


---

---
title: "[JSOI2013] 快乐的 JYY"
layout: "post"
diff: 省选/NOI-
pid: P5685
tag: ['字符串', '2013', '各省省选', '江苏', '后缀自动机 SAM', '回文自动机 PAM']
---
# [JSOI2013] 快乐的 JYY
## 题目背景

JYY 在 JSOI 有很多很多的好朋友，比如 PUPPY，KFC 还有 PUPPUP 。因为
有了这么多的好朋友，所以 JYY 每天都很快乐。某天，JYY 发现好朋友之间关
系的好坏和名字有很大的关系，比如 PUPPY 和 PUPPUP 的关系就特别好，但是和 KFC 的关系就很一般。JYY 苦思冥想终于发现了其中的规律，现在 JYY 想知道两个朋友之间关系的好坏，你能帮助 JYY 么？
## 题目描述

给定两个字符串 $A$ 和 $B$，表示 JYY 的两个朋友的名字。我们用 $A(i,\,j)$ 表示 $A$ 
字符串中从第 $i$ 个字母到第 $j$ 个字母所组成的子串。同样的，我们也可以定义 $B(x,\,y)$ 。

JYY 发现两个朋友关系的紧密程度，等于同时满足如下条件的四元组 $(i,\,j,\,x,\,y)$
的个数：
1. $1\leq i\leq j\leq |A|$
2. $1\leq x\leq y\leq |B|$
3. $A(i,\,j)=B(x,\,y)$
4. $A(i,\,j)$ 是回文串

$|A|$ 表示字符串 $A$ 的长度。

JYY 希望你帮助他计算出这两个朋友之间关系的紧密程度。
## 输入格式

数据包行两行由大写字母组成的字符串 $A$ 和 $B$ 。

## 输出格式

包含一行一个整数，表示紧密程度，也就是满足要求的 $4$ 元组个数
## 样例

### 样例输入 #1
```
PUPPY
PUPPUP

```
### 样例输出 #1
```
17
```
## 提示

$1\leq |A|,\,|B|\leq 50000$


---

---
title: "[CQOI2016] 路由表"
layout: "post"
diff: 省选/NOI-
pid: P5768
tag: ['2016', '重庆', '各省省选']
---
# [CQOI2016] 路由表
## 题目描述

路由表查找是路由器在转发 IP 报文时的重要环节。通常路由表中的表项由目的地址、掩码、下一跳（Next Hop）地址和其他辅助信息组成。例如：
| 目的地址 | 掩码长度 | 下一跳 |
| :----------: | :----------: | :----------: |
| 0.0.0.0 | /1 | 192.168.1.1 |
| 128.0.0.0 | /1 | 192.168.1.1 |
| 8.8.8.0 | /24 | 192.168.1.1 |
| 8.8.8.8 | /32 | 192.168.1.253 |


当路由器收到一个 IP 报文时，会将报文中的目的 IP 地址与路由表中的表项逐条进行比较，选择匹配且**最明确**的表项，将报文转发给该表项中指定的下一跳。

匹配的过程是将报文中的目的地址和表项中的目的地址分别转为二进制串，再查看表项中的掩码长度，若掩码长度为 $x$ ，则将两个二进制串的前 $x$ 位进行比较，如果相同则认为匹配。

所谓**最明确**是指在有多个表项匹配时，掩码长度最大的表项。也可以理解为匹配的二进制位最多的项。

IP 地址转为二进制串的操作是把地址中 $4$ 个整数（一定在 $0$ 到 $255$ 的范围内）分别转为 $8$ 位二进制数，再顺序拼接起来，得到一个  位的二进制串。例如，$192.168.1.253$ 转为二进制串后为 $11000000 $ $10101000$ $00000001$ $11111101$。

我们以报文的目的地址为 $8.8.8.8$ 为例，说明其在上述路由表的匹配过程。


| 8.8.8.8 | 00001000 00001000 00001000 00001000 |
| :----------: | :----------: |
| 0.0.0.0/1 | $\color{red}{0}$0000000 00000000 00000000 00000000 |
| 128.0.0.0/1 | $\color{red}{1}$0000000 00000000 00000000 00000000 |
| 8.8.8.0/24 | $\color{red}{00001000}$ $\color{red}{00001000 }$ $\color{red}{00001000}$ 00000000 |
| 8.8.8.8/32 | $\color{red}{00001000}$ $\color{red}{00001000 }$ $\color{red}{00001000}$ $\color{red}{00001000}$  |


上表将地址均转为二进制串，并用红色标记出待比较的位（由掩码长度决定）。将红色部分与报文中的目的地址比较，可知 $0.0.0.0/1$、$8.8.8.0/24$、$8.8.8.8/32$ 均能够匹配。路由器从中选取掩码长度最长（/32）的表项 $8.8.8.8/32$，将报文转发给其对应的下一跳地址 $192.168.1.253$。

在实际的核心路由器中，路由表通常较大（现在互联网的全局路由表已经接近 $60$
 万条记录），并且会随着新接入设备不断扩张。为了分析路由表变化对转发产生的影响，网络工程师想要知道一段时间内某个 IP 地址的路由表项选择发生了多少次变化（变化是指由于最明确匹配等因素选择了不同的表项，不考虑下一跳地址）。
## 输入格式

第一行为整数 $M$，表示共有 $M$ 次操作。接下来 $M$ 行，每行描述一次操作。操作有两种：

`A <D>/<L>`

其中 $D$ 为一个 IP 地址，$L$ 为整数 ($1 \le L \le 32 $)。添加一条表项至路由表，其目的地址为 $D$，掩码长度为 $L$。下一跳地址由于没有用到，故省略。

`Q <D> <a> <b>`

其中 $D$ 为一个 IP 地址，$a,b$ 为正整数($a \le b$) 。查询从第 $a$ 次至第 $b$ 次添加表项期间（含 $a,b$），目的地址 $D$ 的路由表项选择发生了多少次变化。保证查询时表中至少有 $b$ 个表项。
## 输出格式

包含若干行，每行仅有一个整数，依次对应每个查询操作。
## 样例

### 样例输入 #1
```
47
A 128.0.0.0/1
A 128.0.0.0/4
A 100.200.20.0/23
A 241.170.96.0/20
A 74.128.0.0/17
A 193.24.0.0/14
A 128.0.0.0/19
A 128.0.0.0/13
A 128.0.0.0/5
A 128.0.0.0/11
A 128.0.0.0/12
A 192.0.0.0/7
Q 192.0.0.13 1 8
A 128.0.0.0/8
Q 128.0.0.15 1 8
A 74.0.0.0/8
A 96.0.0.0/4
A 193.24.0.0/23
A 100.192.0.0/11
A 128.0.0.0/18
A 128.0.0.0/20
Q 128.0.0.4 1 13
A 192.0.0.0/8
A 192.0.0.0/22
Q 128.0.0.7 1 14
A 128.0.0.0/23
A 74.128.0.0/14
A 128.0.0.0/14
A 128.0.0.0/25
A 74.128.0.0/12
Q 128.0.0.9 2 17
A 96.0.0.0/11
A 64.0.0.0/2
A 74.0.0.0/26
A 100.192.0.0/18
A 128.0.0.0/27
A 193.24.0.0/18
Q 128.0.0.3 4 21
Q 74.128.0.12 3 24
A 128.0.0.0/9
A 193.24.0.0/22
Q 128.0.0.7 4 24
A 192.0.0.0/10
Q 128.0.0.3 2 23
A 100.192.0.0/10
Q 241.170.96.2 1 26
Q 100.192.0.4 4 24

```
### 样例输出 #1
```
1
3
3
3
2
2
1
3
4
2
2

```
## 提示

对于一次查询的一种理解方式是：无视其它所有查询操作，只看添加操作。先清空路由表，然后执行第 $1$ 到 $a-1$ 次添加操作。之后再统计第 $a$ 到 $b$ 次添加操作过程中匹配改变的次数。

--------

对于 $30\%$ 的数据，$M \le 10^3$；

对于 $100\%$ 的数据，$M \le 10^6$。

设一条表项的掩码长度为 $L$，数据保证将目的地址转为二进制串后，末尾的 $32-L$ 位均为 $0$。另外，保证不会重复添加目的地址和掩码长度都相同的表项。


---

---
title: "[JSOI2016] 位运算"
layout: "post"
diff: 省选/NOI-
pid: P5772
tag: ['2016', '各省省选', '江苏']
---
# [JSOI2016] 位运算
## 题目描述

JYY 最近在研究位运算。他发现位运算中最有趣的就是异或 (xor) 运算。对于两个数的异或运算，JYY 发现了一个结论：两个数的异或值为 $0$ 当且仅当他们相等。于是 JYY 又开始思考，对于 $N$ 个数的异或值会有什么性质呢？

JYY 想知道，如果在 $0$ 到 $R-1$ 的范围内，选出 $N$ 个不同的整数，并使得这 $N$ 个整数的异或值为 $0$，那么一共有多少种选择的方法呢？（选择的不同次序并不作重复统计，请参见样例）

JYY 是一个计算机科学家，所以他脑海里的 $R$ 非常非常大。为了能够方便的表达，如果我们将 $R$ 写成一个 $01$ 串，那么 $R$ 是由一个较短的 $01$ 串 $S$ 重复 $K$ 次得到的。比如，若 $S=101$，$K=2$，那么 $R$ 的二进制表示则为 $101101$。由于计算的结果会非常大，JYY 只需要你告诉他选择的总数对 $10^9+7$ 取模的结果即可。
## 输入格式

第一行包含两个正整数 $N$ 和 $K$；

接下来一行包含一个由 $0$ 和 $1$ 组成的字符串 $S$；

我们保证 $S$ 的第一个字符一定为 $1$。
## 输出格式

一行一个整数，表示选择的方案数对 $10^9+7$ 取模的值。
## 样例

### 样例输入 #1
```
3 1
100
```
### 样例输出 #1
```
1
```
## 提示

**样例说明**

唯一的一种选择方法是选择 $\{1,2,3\}$。

------

**数据范围**

对于 $100\%$ 的数据，$3 \le N \le 7$，$1 \le k \le 10^5$，$1 \le |S| \le 50$。


---

---
title: "[JSOI2016] 轻重路径"
layout: "post"
diff: 省选/NOI-
pid: P5773
tag: ['2016', '各省省选', '江苏', '树链剖分']
---
# [JSOI2016] 轻重路径
## 题目描述

JYY 最近学习了一种处理树形结构的高级技巧，叫「轻重路径剖分」。这种技术会将树中的边划分成轻边和重边。相连的重边会形成一些树上相离的路径。「轻重路径剖分」可以使得从树上任意一点走到根，都至多只会经过 $(\log N)$ 条不同的重路径。

如果你不了解轻重路径剖分，JYY 在这里简单介绍一下：对于一棵有根树中的任意一个点 $u$，我们用 $size(u)$ 表示其为根的子树中的点的数量。对于 $u$ 的所有孩子中，我们选出 $size$ 值最大的孩子 $v$，并将边 $(u,v)$ 设置成重边，$u$ 和其他孩子之间的边我们均设置为轻边。

为了简化问题，这里 JYY 仅考虑一棵 $N$ 个点的有根二叉树。这 $N$ 个点由 $1$ 到 $N$ 编号。并且如果 $u$ 存在两个 $size$ 值一样的孩子，则我们默认 $u$ 和其左孩子的连边为重边。

现在 JYY 希望执行额外 $Q$ 次删点操作，每次 JYY 会随机删掉一个当前二叉树的叶子节点，而你则需要动态的维护这棵树的轻重路径剖分。

为了方便输出，你只需要在每次操作后输出所有重边指向的点的编号之和即可。

如果删除一个点之后，存在一个点 $u$ 拥有两个 $size$ 值一样的孩子，则我们保持 $u$ 在该操作执行之前的重边划分。
## 输入格式

第一行包含一个整数 $N$；

接下来 $N$ 行，第 $i$ 行包含两个整数 $L_i,R_i$，表示编号为 $i$ 的点的左孩子编号和右孩子编号，$L_i=0$表示点 $i$ 没有左孩子， $R_i=0$表示点 $i$ 没有右孩子；

第 $N+2$ 行包含一个整数 $Q$，表示 JYY 进行的删点操作；

第 $N+3$ 行包含 $Q$ 个空格分开的正整数，表示 JYY 删去的叶子的编号。

输入数据保证每次删除操作均删除了一个叶子。
## 输出格式

输出 $Q+1$ 行，每行包含一个整数，表示在轻重路径剖分中所有重边指向的点的编号的和。其中第一行对应初始的路径剖分，之后的 $Q$ 行对应进行了相应删点操作之后路径划分。
## 样例

### 样例输入 #1
```
8
2 3
4 5
0 0
6 7
0 8
0 0
0 0
0 0
7
6 7 8 5 4 2 3

```
### 样例输出 #1
```
20
21
15
7
6
2
3
0

```
## 提示

对于 $30\%$ 的数据，满足 $N \le 1000$；

对于 $50\%$ 的数据，满足 $N \le 5 \times 10^4$；

对于全部数据，满足 $N \le 2 \times 10^5$。


---

---
title: "[SNOI2013] Quare"
layout: "post"
diff: 省选/NOI-
pid: P5776
tag: ['动态规划 DP', '图论', '2013', '各省省选']
---
# [SNOI2013] Quare
## 题目描述

4.20 四川芦山地震发生后，抗震救灾委员会接到一个紧急任务，四川省给该委员会发了一份地图，这份地图给出了该省一些城市的情况：任两个城市是用一条或多条公路连接起来的，也可以没有公路连接，但是每个城市都可以直接或间接地到达另外的城市，注意这些公路是可以双向行驶的。由于最近余震、暴雨造成泥石流倾泻，使得车辆在这些公路上行驶很不安全，于是四川省决定尽快对部分公路进行抢修，以保障救援车辆行车安全。
    
该省对所有的公路情况都进行了勘察，分析估计了抢修某段公路所需要花费的时间，并记录在地图中。现在该省希望抗震救灾委员会能找到一个方案，该方案决定出哪些公路需要抢修，使得抢修后的公路仍能保证任意两个城市之间都能直接或间接地相连，同时为了安全起见，即使某一条抢修的公路被泥石流阻断了，任意两城市仍能保持这个性质。由于时间紧迫，抗震救灾委员会还需保证找到的这个方案总抢修时间最短。
## 输入格式

第一行为一个整数 $T$，为数据总数，接下来按顺序给出每个数据的描述。

首先是两个整数 $n, m$ 分别表示城市数量和公路数量，下面 $m$ 行每行三个整数 $x, y, c$ 描述了一条公路的情况：$x$ 城市与 $y$ 城市之间的一条公路，抢修该公路需要 $c$ 个单位时间。

注意上面所说的两城市间可能有多条公路。
## 输出格式

按顺序输出每个数据的结果，如果找不到一条合适的方案，则输出一行 `impossible`，否则输出一个整数，为抢修的最优方案所需要的总时间。
## 样例

### 样例输入 #1
```
2
4 6
1 2 1
1 3 2
1 3 3
2 4 2
3 4 1
2 3 1
2 1
1 2 3

```
### 样例输出 #1
```
6
impossible

```
## 提示

对于 $100\%$ 的数据，$1 \leq n \leq 12$，$1 \leq m \leq 40$，$1\le c\le 5\times 10^4$。


---

---
title: "[SDOI2012] 任务安排"
layout: "post"
diff: 省选/NOI-
pid: P5785
tag: ['动态规划 DP', '2012', '二分', '各省省选', '单调队列', '山东', '斜率优化']
---
# [SDOI2012] 任务安排
## 题目描述

机器上有 $n$ 个需要处理的任务，它们构成了一个序列。这些任务被标号为 $1$ 到 $n$，因此序列的排列为 $1 , 2 , 3 \cdots n$。这 $n$ 个任务被分成若干批，每批包含相邻的若干任务。从时刻 $0$ 开始，这些任务被分批加工，第 $i$ 个任务单独完成所需的时间是 $T_i$。在每批任务开始前，机器需要启动时间 $s$，而完成这批任务所需的时间是各个任务需要时间的总和。

**注意，同一批任务将在同一时刻完成**。每个任务的费用是它的完成时刻乘以一个费用系数 $C_i$。

请确定一个分组方案，使得总费用最小。
## 输入格式

第一行一个整数 $n$。
第二行一个整数 $s$。

接下来 $n$ 行，每行有一对整数，分别为 $T_i$ 和 $C_i$，表示第 $i$ 个任务单独完成所需的时间是 $T_i$ 及其费用系数 $C_i$。
## 输出格式

一行，一个整数，表示最小的总费用。
## 样例

### 样例输入 #1
```
5
1
1 3
3 2
4 3
2 3
1 4

```
### 样例输出 #1
```
153

```
## 提示

对于 $100\%$ 数据，$1 \le n \le 3 \times 10^5$，$1 \le s \le 2^8$，$ \left| T_i \right| \le 2^8$，$0 \le C_i \le 2^8$。


---

---
title: "[CQOI2008] 传感器网络"
layout: "post"
diff: 省选/NOI-
pid: P5786
tag: ['2008', '重庆', '各省省选']
---
# [CQOI2008] 传感器网络
## 题目描述

一个无线传感器网络由若干独立采集数据的设备和一个控制中心组成。每个设备必须把采集到的数据传到控制中心处理，但由于设备限制，并不是每台设备都可以与控制中心直接相连。为了解决这一问题，你将传感器网络设计成树状结构。树根为控制中心，而每台设备恰好有一个父亲节点（要么为控制中心，要么为另一台设备）。一台设备的儿子设备个数称为它的负载级别。所有设备（注意，控制中心不是设备）的负载级别的最大值称为网络的负载级别。

　　你的任务是让整个网络的负载级别尽量小。
## 输入格式

第一行包含一个整数 $N$，即设备的个数。第二行包含 $N$ 个字符，表示每台设备是否能直接连接到控制中心。以下 $N$ 行每行 $N$ 个字符，其中第 $i$ 行第 $j$ 个字符为 `Y` 当且仅当设备 $i$ 可以作为设备 $j$ 的儿子。如果设备 $i$ 可以作为设备 $j$ 的儿子，那么在任何合法的网络中，设备 $j$ 一定不会是设备 $i$ 的后代。换句话说，如果把这 $N$ 行看作一个有向图的邻接矩阵，该图不存在有向环。
## 输出格式

仅一行，包含 $N$ 个整数，即每个设备的父亲。设备按照输入顺序编号为 $0$ 至 $N-1$，控制中心用 $N$ 表示。如果有多组解，输出字典序最小解。
## 样例

### 样例输入 #1
```
5
YNNYN
NNNNN
YNNNY
NNNYN
NNNNN
YNNYN
```
### 样例输出 #1
```
5 4 3 5 0
```
## 提示

对于 $50\%$ 的数据，$2\le N\le 6$；对于另外 $50\%$ 的数据，$N=50$。



---

---
title: "[CQOI2006] 移动棋子"
layout: "post"
diff: 省选/NOI-
pid: P5796
tag: ['2006', '重庆', '各省省选']
---
# [CQOI2006] 移动棋子
## 题目描述

在一个 $n\times n$ 的棋盘上有 $n$ 枚棋子。每次可以把一枚棋子往上、下、左、右方向之一移动一格，最后排成一行、一列或者主、副对角线上（因此一共有 $2n+2$ 条可能的目标状态），要求移动次数最小。

棋盘上有一些位置是障碍，棋子在任何时候都不能经过。棋子的初始位置保证不在障碍物上。任两枚棋子不能在同时到达同一个格子。
　　　　　　
## 输入格式

第一行包含两个整数 $n$，$m$，表示棋子的个数（它也是棋盘的边长）和障碍的个数。

以下 $n$ 行，每行两个整数 $x$ 和 $y$，表示第 $i$ 个棋子的坐标。（$1\le x,y\le n$）

以下 $m$ 行，每行给出一个障碍物的坐标。保证这 $n+m$ 个坐标两两不重合。
## 输出格式

输出仅包含一个整数，表示最小移动步数。如果无解，输出`-1`。
## 样例

### 样例输入 #1
```
5 1
1 2
2 4
3 4
5 1
5 3
1 1
```
### 样例输出 #1
```
6

```
## 提示

【样例解释】

![](https://cdn.luogu.com.cn/upload/image_hosting/qs93n3f7.png)

【数据范围】

对于 $50\%$ 的数据，$n\le 15$，$m=0$；

对于 $100\%$ 的数据，$2\le n\le 50$，$0\le m\le 100$。


---

---
title: "[CQOI2010] 内部白点"
layout: "post"
diff: 省选/NOI-
pid: P5816
tag: ['2010', '重庆', '各省省选']
---
# [CQOI2010] 内部白点
## 题目描述

无限大正方形网格里有 $n$ 个黑色的顶点，所有其他顶点都是白色的（网格的顶点即坐标为整数的点，又称整点）。每秒钟，所有内部白点同时变黑，直到不存在内部白点为止。你的任务是统计最后网格中的黑点个数。

内部白点的定义：一个白色的整点 $P(x,y)$ 是内部白点当且仅当 $P$ 在水平线的左边和右边各至少有一个黑点（即存在$x_1 < x < x_2$ 使得 $(x_1,y)$ 和 $(x_2,y)$ 都是黑点），且在竖直线的上边和下边各至少有一个黑点（即存在 $y_1 < y < y_2$ 使得 $(x,y_1)$ 和 $(x,y_2)$ 都是黑点）。
## 输入格式

输入第一行包含一个整数 $n$，即初始黑点个数。

以下 $n$ 行每行包含两个整数 $x$，$y$，即一个黑点的坐标。没有两个黑点的坐标相同，坐标的绝对值均不超过 $10^9$。
## 输出格式

输出仅一行，包含黑点的最终数目。

如果变色过程永不终止，输出`-1`。

## 样例

### 样例输入 #1
```
4
0 2
2 0
-2 0
0 -2

```
### 样例输出 #1
```
5

```
## 提示

**数据范围**

对于 $36\%$ 的数据，$n \le 500$。

对于 $64\%$ 的数据，$n \le 3 \times 10^4$。

对于 $100\%$ 的数据，$n \le 10^5$。


---

---
title: "[SCOI2012] Blinker 的噩梦"
layout: "post"
diff: 省选/NOI-
pid: P5843
tag: ['2012', '四川', '各省省选']
---
# [SCOI2012] Blinker 的噩梦
## 题目描述

一天 Blinker 醒来，发现自己成为了一个二维世界的点，而且被标记上了一个奇怪的值。

这个世界是由 $N$ 个边界互不相交（且不相切）的图形组成，这里图形仅包括圆和凸多边形。每个图形还有一个权值。每次 Blinker 走进或走出某个图形时（相切时经过不算），Blinker 的标记值就会被异或上那个值。

现在，我们记录了 Blinker 在这个世界的 $M$ 天的信息。每天可能发生两种事情，一种是某个图形的权值更改为某个值；另一种是 Blinker 从某个点走到另一个点。 

我们假设 Blinker 首次出发前的标记值为 $0$，我们希望知道他每次到达目的地后的标记值。
## 输入格式

输入的第一行包含 $2$ 个数，$N$ 和 $M$，分别表示这个世界的图形数和记录的天数。 

接下来有 $N$ 行，每行表示一个图形。 

如果一行以字符 `C` 开头，表示这个图形是一个圆，后面紧跟着三个实数 $x$, $y$, $r$ 和一个整数 $v$，分别表示圆的 $x$ 坐标，$y$ 坐标和圆的半径以及该图形对应的值。 

如果一行以字符 `P` 开头，表示这个图形是凸多边形，后面紧跟着一个整数 $L$，表示凸多边形的点数，然后后面有 $L$ 对实数 $x_0$,$y_0$,$x_1$,$y_1$ $\cdots$，表示 $L$ 个点的坐标，这一行最后一个数是一个整数 $v$，表示这个图形对应的值，保证凸多边形上的点按照顺时针给出。 

接下来有 $M$ 行，每行表示一天的记录信息。

如果一行以字符 `Q` 开头，表示这一天 Blinker 出行了，接下来有 $x_0,y_0,x_1,y_1$ 四个实数，分别表示出发点的坐标和目的地的坐标。

如果一行以字符 `C` 开头，表示这一天某个图形的值改变了，接下来有两个 $i$ 和 $v$，表示输入中第 $i$ 个出现的图形的值变成 $v$。
## 输出格式

对于 Blinker 的每个出行输出他到达目的地后的标记值，很显然这个值与 Blinker 的路径无关。
## 样例

### 样例输入 #1
```
2 4
C 0 0 2 1
P 4 -1 -1 -1 1 1 1 1 -1 2
Q -2 -2 2 2
Q -1.5 0 0.0 0.0
C 1 1005
Q -1.5 0 0.0 0.0
```
### 样例输出 #1
```
0
2
0
```
## 提示

**样例解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/mj50qefg.png)

样例的世界形如上图：

第一天 Binker 的初始标记值为 $0$，可能从 $A$ 沿直线走到 $B$，或者他绕过圆走到 $B$，他的标记值最终都保持不变为 $0$（假设沿直线从 $A$ 走到 $B$，共穿过 $4$ 次边界，Binker 的标记值变化过程为 $1,3,1,0$）;

第二天 Binker 的初始标记值为 $0$，他通过某种不经过图形边界的方法到达了 $C$ 点（即 Binker 瞬间移动或闪烁），然后从 $C$ 沿某种路径走到 $D$，这时他的标记值变为 $2$；

第三天圆的权值变为 $1005$；

第四天 Binker 的初始标记值为 $2$，他再次回到 $C$，并再次从 $C$ 走到 $D$，这时他的标记值又变为 $0$。

**数据范围**
- 对于 $30\%$ 的数据，$1 \le M \le 10.00$，凸多边形的点数加上圆的个数小于等于 $1000$；
- 对于 $100\%$ 的数据，$1 \le N \le 10^5$，$1 \le M \le 10^5$，单个凸多边形的点数小于等于 $34$。图形互不相交，且 Binker 的出发点和目的地不在图形的边界。


---

---
title: "[SDOI2012] 走迷宫"
layout: "post"
diff: 省选/NOI-
pid: P6030
tag: ['2012', '各省省选', '山东', '期望']
---
# [SDOI2012] 走迷宫
## 题目描述

Morenan 被困在了一个迷宫里。迷宫可以视为 $n$ 个点 $m$ 条边的有向图，其中 Morenan 处于起点 $s$，迷宫的终点设为 $t$。可惜的是，Morenan 非常的脑小，他只会从一个点出发随机沿着一条从该点出发的有向边，到达另一个点。这样，Morenan 走的步数可能很长，也可能是无限，更可能到不了终点。若到不了终点，则步数视为无穷大。但你必须想方设法求出 Morenan 所走步数的期望值。
## 输入格式

第一行四个整数，$n,m,s,t$。

接下来 $m$ 行，每行两个整数 $u, v$ ，表示有一条从 $u$ 到 $v$ 的边。
## 输出格式

一个浮点数，保留小数点后 $3$ 位，为步数的期望值。若期望值为无穷大，则输出`INF`。
## 样例

### 样例输入 #1
```
6 6 1 6
1 2
1 3
2 4
3 5
4 6
5 6
```
### 样例输出 #1
```
3.000
```
### 样例输入 #2
```
9 12 1 9
1 2
2 3
3 1
3 4
3 7
4 5
5 6
6 4
6 7
7 8
8 9
9 7
```
### 样例输出 #2
```
9.500
```
### 样例输入 #3
```
2 0 1 2
```
### 样例输出 #3
```
INF
```
## 提示

| 测试点 | $n\leq$ | $m\leq$ |
| :----------: | :----------: | :----------: |
| $1\sim 6$ | $10$ | $100$ |
| $7\sim 12$ | $200$ | $10^4$ |
| $13\sim 20$ | $10^4$ | $10^6$ |

另外，均匀分布着 $40\%$ 的数据，图中没有环，也没有自环。

对于 $100\%$ 的数据，$1\leq n\leq 10^4$，$0\leq m \leq 10^6$，**保证强连通分量的大小不超过** $\boldsymbol{100}$。


---

---
title: "[JSOI2015] isomorphism"
layout: "post"
diff: 省选/NOI-
pid: P6084
tag: ['2015', '各省省选', '江苏', '哈希 hashing']
---
# [JSOI2015] isomorphism
## 题目描述

一个无向树的度数为 $2$ 的结点称为假结点，其它结点称为真结点。一个无向树的简化树其结点由原树的全体真结点组成，两个真结点之间有边当且仅当它们在原树中有边，或者在原树中有一条联结这两个结点的路，其中间节点全是假结点。两个无向树各自的简化树如果同构，即存在结点之间的一一对应，使得在一个树中的任意两个结点之间有边当且仅当它们的对应结点在另一个树中有边，则称原来的两个无向树实质同构。

给定若干个无向树，将相互实质同构的无向树只保留一个其余删除。统计剩下的相互不实质同构的无向树个数，并将它们的简化树结点个数从小到大输出。
## 输入格式

第一行只有一个正整数 $m$。

后面依次输入 $m$ 棵无向树，每棵无向树先用一行输入结点个数 $n$，结点就用 $1$ 到 $n$ 表示，然后用 $n-1$ 行输入 $n-1$ 条无向边，每行有两个 $1$ 到 $n$  之间的不同的正整数，用一个空格隔开，代表这两个结点之间有无向边。两棵树之间无空行。

## 输出格式

第一行输出一个正整数，即输入中不计实质同构包含无向树的个数 $m_0\ (1\leq m_0\leq m)$。

第二行包含不严格递增的 $m_0$ 个正整数，表示这 $m_0$ 棵无向树的简化树结点个数。相邻两数用一个空格隔开。
## 样例

### 样例输入 #1
```
2
4
1 4
2 4
3 4
5
1 3
2 3
3 4
4 5
```
### 样例输出 #1
```
1
4
```
## 提示

#### 数据范围

对于 $100\%$ 的数据，$2\leq m\leq 20, 2\leq n\leq 10^4$。


---

---
title: "[JSOI2013] 吃货 JYY"
layout: "post"
diff: 省选/NOI-
pid: P6085
tag: ['2013', '各省省选', '江苏']
---
# [JSOI2013] 吃货 JYY
## 题目背景

作为 JSOI 的著名吃货，JYY 的理想之一就是吃遍全世界的美食。要走遍全世界当然需要不断的坐飞机了。而不同的航班上所提供的餐食是很不一样的：比如中国的航班会提供中餐，英国的航班有奶茶和蛋糕，澳大利亚的航班有海鲜，新加坡的航班会有冰激凌……

JYY 选出了一些他特别希望品尝餐食的航班，希望制定一个花费最少的旅游计划，能够从南京出发，乘坐所有这些航班并最后回到南京。
## 题目描述

世界上一共有 $N$ 个 JYY 愿意去的城市，分别从 $1$ 编号到 $N$。JYY 选出了 $K$ 个他一定要乘坐的航班。除此之外，还有 $M$ 个 JYY 没有特别的偏好，可以乘坐也可以不乘坐的航班。

一个航班我们用一个三元组 $(x,y,z)$ 来表示，意义是这趟航班连接城市 $x$ 和 $y$，并且机票费用是 $z$。每个航班都是往返的，所以 JYY 花费 $z$ 的钱，既可以选择从 $x$ 飞往 $y$，也可以选择从 $y$ 飞往 $x$。

南京的编号是 $1$，现在 JYY 打算从南京出发，乘坐所有 K 个航班，并且最后回到南京，请你帮他求出最小的花费。

## 输入格式

输入数据的第一行包含两个整数 $N$ 和 $K$。

接下来 $K$ 行，每行三个整数 $x,y,z$ 描述必须乘坐的航班的信息，数据保证在这 $K$ 个航班中，不会有两个不同的航班在同一对城市之间执飞。

第 $K+2$ 行包含一个整数 $M$，接下来 $M$ 行，每行三个整数 $x,y,z$ 描述可以乘坐也可以不乘坐的航班信息。
## 输出格式

输出一行一个整数，表示最少的花费。数据保证一定存在满足 JYY 要求的旅行方案。
## 样例

### 样例输入 #1
```
6 3
1 2 1000
2 3 1000
4 5 500
2
1 4 300
3 5 300
```
### 样例输出 #1
```
3100
```
## 提示

### 样例解释

一个可行的最佳方案为 $1\rightarrow 2\rightarrow 3\rightarrow 5\rightarrow 4\rightarrow 1$。

机票所需的费用为 $1000+1000+300+500+300=3100$。

### 数据范围

对于 $100\%$ 的数据，$2\leq N\leq 13,0\leq K\leq 78,2\leq M\leq 200,1\leq x,y\leq N,1\leq z\leq 10^4$。


---

---
title: "[JSOI2015] 送礼物"
layout: "post"
diff: 省选/NOI-
pid: P6087
tag: ['2015', '二分', '各省省选', '单调队列', '江苏', '分数规划']
---
# [JSOI2015] 送礼物
## 题目背景

JYY 和 CX 的结婚纪念日即将到来，JYY 来到萌萌开的礼品店选购纪念礼物。

萌萌的礼品店很神奇，所有出售的礼物都按照特定的顺序都排成一列，而且相邻
的礼物之间有一种神秘的美感。于是，JYY 决定从中挑选连续的一些礼物，但究
竟选哪些呢？
## 题目描述

假设礼品店一共有 $N$ 件礼物排成一列，每件礼物都有它的美观度。排在第 $i\ (1\leq i\leq N)$ 个位置的礼物美观度为正整数 $A_i$。JYY 决定选出其中连续的一段，即编号为 $i,i+1,\cdots,j-1,j$ 的礼物。选出这些礼物的美观程度定义为

$$\frac{M(i,j)-m(i,j)}{j-i+K}$$

其中 $M(i,j)$ 表示 $\max\{A_i,A_{i+1},\cdots,A_j\}$，$m(i,j)$ 表示 $\min\{A_i,A_{i+1},\cdots,A_j\}$，$K$ 为给定的正整数。
由于不能显得太小气，所以 JYY 所选礼物的件数最少为 $L$ 件；同时，选得太多也不好拿，因此礼物最多选 $R$ 件。JYY 应该如何选择，才能得到最大的美观程度？由于礼物实在太多挑花眼，JYY 打算把这个问题交给会编程的你。


## 输入格式

**本题每个测试点有多组数据。**

输入第一行包含一个正整数 $T$，表示有 $T$ 组数据。

每组数据包含两行。第一行四个非负整数 $N,K,L,R$。第二行包含 $N$ 个正整数，依次表示 $A_1,A_2,\cdots,A_n$。
## 输出格式

输出 $T$ 行，每行一个非负实数，依次对应每组数据的答案，数据保证答案不
会超过 $10^3$。输出四舍五入保留 $4$ 位小数。
## 样例

### 样例输入 #1
```
1
5 1 2 4
1 2 3 4 5
```
### 样例输出 #1
```
0.7500
```
## 提示

对于 $100\%$ 的数据，$T\leq 10$，$N,K\leq 5\times 10^4$，$1\leq A_i\leq 10^8$，$2\leq L,R\leq N$。


---

---
title: "[JSOI2015] 圈地"
layout: "post"
diff: 省选/NOI-
pid: P6094
tag: ['2015', '各省省选', '网络流', '江苏']
---
# [JSOI2015] 圈地
## 题目背景

JYY 在火星买了一大块矩形的地皮做房地产开发。由于地皮实在是太大了，JYY 把这块地皮划分成了 $N$ 行 $M$ 列的小方格，并在每一格中建造一栋房子。历时若干年，开发终于宣告结束，JYY 也可以把这些房子挂牌出售了。现在他找到了两位非同寻常的土豪买家：南南和强强。

麻烦的是，南南和强强是水火不容的。为了保证他们俩不发生矛盾，JYY 需要把卖给他们俩的房子用墙隔开。不过造墙是需要钱的，JYY 作为倒卖地皮的专家，自然想挣尽可能多的钱，因此他邀请到你帮他设计最优的出售方案。
## 题目描述

JYY 把这块地皮划分成了 $N$ 行 $M$ 列的矩形，且矩形的每一格中建造一栋房子。现在，南南和强强已经将他们的购买意见提交给了 JYY。对于每一栋房子，南南和强强已经给定了他们的出价（不想购买，或愿意以一定价格购买），并且由于他们已经协商好了各自的势力范围，因此不存在两个人同时想买一栋房子的情况。JYY 可以选择每一栋房子是否出售（因为不存在两个人同时想买一栋房子的情况，若 JYY 选择出售一栋房子，它的买家就是确定的）。房子卖给强强和南南以后，JYY 就能获得卖出房子出价的总和。

不过，作为售后服务，JYY 需要通过造墙（将两栋相邻的房子用一堵墙隔开）把两个人的房子完全隔开。所谓完全隔开，就是指造出的墙以及四周的边界将整个区域划分成若干个不连通的部分，每个部分里面只有一个人的房子。当然，造墙也是需要钱的，而且价格不菲。不过 JYY 当初在宣传时声称造墙完全免费，所以这部分钱只好由 JYY 自己出了。

JYY 请你为他规划每幢房子是否要卖出以及建造哪些围墙，才能使得卖房子的收益减去造围墙的花费最大。另外一个好消息是整个地皮的四周已经建好了墙，因此 JYY 可以利用这些建好的墙达到目的。下图就是用墙将区域划分成 $3$ 个不连通的部分的例子。格子中的数字代表出价（数字的含义参考输入格式），边上的数值代表造墙的价格。四周的墙（边界）本来就有，不需要 JYY 花额外的代价去建造。

![](https://cdn.luogu.com.cn/upload/image_hosting/t57031da.png)
## 输入格式

输入第一行包含两个用空格隔开的自然数 $N$ 和 $M$。

接下来 $N$ 行，每行 $M$ 个整数，第 $i$ 行第 $j$ 列的整数 $a$ 描述了位于 $(i,j)$ 房子的出售信息。如果 $a=0$，说明强强和南南都不想买这个位置上的房子；如果 $a>0$，说明强强想以价格 $a$ 买这个位置上的房子。如果 $a<0$，说明南南想以价格 $-a$ 买这个位置上的房子。

接下来 $N-1$ 行，每行 $M$ 个整数。第 $i$ 行第 $j$ 列的数表示第 $i$ 行第 $j$ 列的房子与第 $i+1$ 行第 $j$ 列的房子之间的墙的造价。

接下来 $N$ 行，每行 $M-1$ 个整数。第 $i$ 行第 $j$ 列的数表示第 $i$ 行第 $j$ 列的房子与第 $i$ 行第 $j+1$ 列的房子之间的墙的造价。

## 输出格式

输出仅有一行包含一个整数，表示 JYY 的最大收益。


## 样例

### 样例输入 #1
```
5 5
-3 7 0 0 0
8 0 7 -10 0
0 7 0 1 0
0 0 0 0 0
-8 0 0 2 10
4 50 50 1 50
50 50 1 9 50
50 50 1 1 50
2 50 50 50 50
2 50 50 50
50 50 1 1
50 1 8 1
50 50 50 50
1 50 50 50
```
### 样例输出 #1
```
48
```
## 提示

对于 $100\%$ 的数据，$1\leq N,M\leq 200$，任何价格都不超过 $1000$。


---

---
title: "[JSOI2015] 串分割"
layout: "post"
diff: 省选/NOI-
pid: P6095
tag: ['2015', '二分', '各省省选', '江苏', '后缀数组 SA']
---
# [JSOI2015] 串分割
## 题目背景

JYY 每天都会在地铁上度过很长的时间。

为了打发时间，JYY 随手写下了一个很长的环形的数字字符串，并且陷入了沉思。
## 题目描述

JYY 写下了一个长度为 $N$ 的，仅包含 `1`，`2`，……，`9` 这 $9$ 种不同字符的环形字符串 $S$。JYY 希望把 $S$ 进行 $K$ 次切割，并分成 $K$ 个非空的子串。对于每一个子串，由于其仅包含数字，我们可以将其看成一个十进制数——因此
经过 $K$ 次切割，JYY 可以得到 $K$ 个不同的十进制数。JYY 希望他得到的这 $K$ 个数中，最大的那一个尽量小。
## 输入格式

第一行包含两个整数 $N$ 和 $K$。

第二行包含一个长度为 $N$ 的字符串 $S$。
## 输出格式

输出一行包含一个正整数，表示最佳分割方案中，JYY 所得到的那 $K$ 个数中，最大的那一个。


## 样例

### 样例输入 #1
```
4 2
4321
```
### 样例输出 #1
```
32
```
## 提示

对于 $100\%$ 的数据，$3\leq N\leq 2\times 10^5$，$2\leq K\leq N$。


---

---
title: "[JSOI2012] 始祖鸟"
layout: "post"
diff: 省选/NOI-
pid: P6126
tag: ['2012', '各省省选', '江苏', 'Special Judge', '高斯消元']
---
# [JSOI2012] 始祖鸟
## 题目描述

最近，进香河地带出现了一家“始祖鸟专卖店”，然而这并不只是一时的心血来潮。         
                         
早在远古时期，进香河地带就以其秀美的环境和适宜的温度吸引了成群的始祖鸟。始祖鸟是一种团结的鸟类，它们总是通过各种方式来增强种群内部的交流，聚会则是其中之一。因为聚会不但可以增强朋友之间的友谊，而且可以认识新的朋友。        
                             
现在有 $N$ 只始祖鸟，我们从 $1$ 开始编号。对于第 $i$ 只始祖鸟，有 $M_i$ 个认识的朋友，它们的编号分别是 $F_{i,1}，F_{i,2}，…，F_{i,M_i}$。朋友的认识关系是单向的，也就是说如果第$s$只始祖鸟认识第 $t$ 只始祖鸟，那么第 $t$ 只始祖鸟不一定认识第 $s$ 只始祖鸟。        
   
聚会的地点分为两处，一处在上游，一处在下游。对于每一处聚会场所，都必须满足对于在这个聚会场所中的始祖鸟，有恰好有偶数个自己认识的朋友与之在同一个聚会场所中。当然，每一只始祖鸟都必须在两处聚会场所之一。         
       
现在需要你给出一种安排方式。你只需要给出在上游的始祖鸟编号，如果有多组解，请输出任何一组解。 
## 输入格式

输入数据包含 $N+1$ 行，第一行是数字 $N$，代表始祖鸟的个数。       
接下来 $N$ 行，第 $i+1$ 行的第一个数字是 $M_i$，表示第 $i$ 只鸟的朋友个数。之后有 $M_i$ 个数字依次为 $F_{i,1},F_{i,2},…,F_{i,M_i}$ 表示第$i$只始祖鸟朋友的标号。 
## 输出格式

输出数据包含 $2$ 行，第一行有一个非负整数 $k$，表示在上游参加聚会的始祖鸟个数。第二行有 $k$ 个正整数，表示在这个 $k$ 只始祖鸟的编号，你可以以任意顺序输出这些编号。如果无法满足要求，只输出一行`Impossible`。 
## 样例

### 样例输入 #1
```
5
3 2 3 4
2 1 3
4 2 1 4 5
2 1 3
1 3
```
### 样例输出 #1
```
3
1 2 3
```
## 提示

#### 数据规模与约定

- 对于$100\%$的数据，$1 \le N \le 2000$。


---

---
title: "[JSOI2012] 幼儿园的游戏"
layout: "post"
diff: 省选/NOI-
pid: P6128
tag: ['2012', '各省省选', '江苏']
---
# [JSOI2012] 幼儿园的游戏
## 题目描述

公元 $1770$ 年，纪昀先生途经进香河，与百姓谈说人世，谈说友善。他所告诉人们的为友之道，流传至今，深深影响着当地的人们，甚至是幼儿园的孩童。                 
一天，多诺达新幼儿园的孩子们与老师们排排坐，形成了一个 $n \times m$ 的矩形队列，一共有 $k$ 个老师，他们融入在了这个矩形队列之中，与小朋友们欢乐地唱着歌。“手拉手，我们永远都是好朋友！”于是老师要求每一位小朋友都和四周(即上下左右四个方向)的任意两个小朋友牵手。                 
作为幼儿园里最聪明的小朋友，你马上意识到这并不是单纯的游戏，而是一个非常有意义的问题。你非常希望知道一共有多少种不同的牵手方案，满足每一位小朋友都可以和四周恰好两位小朋友牵手。当然，每一位小朋友都只能和小朋友牵手，不能去和老师牵手。任何一位小朋友都不允许自己和自己牵手(即左手拉右手)。 
你所需要知道的只是方案个数，因为答案可能太大，所以需要对 $1000000007$ 取模。 
## 输入格式

第一行有三个整数，分别是 $n$,$m$ 和 $k$。如题。            
接下来 $k$ 行，每一行有 $2$ 个整数 $x$ 和 $y$，描述了一位老师的位置。 
## 输出格式

你只需要输出一个整数，表示答案关于 $10^9+7$ 取模后的结果。 
## 样例

### 样例输入 #1
```
3 6 2
2 2
2 5 
```
### 样例输出 #1
```
3
```
## 提示

对于 $100\%$ 的数据， $1 \le n \le 8,1 \le m \le 2^{31}-1$，$1 \le k \le 100$。


---

---
title: "[JSOI2015] 最小表示"
layout: "post"
diff: 省选/NOI-
pid: P6134
tag: ['2015', '各省省选', '江苏']
---
# [JSOI2015] 最小表示
## 题目背景

还记得去年 JYY 所研究的强连通分量的问题吗？去年的题目里，JYY 研究了对于有向图的“加边”问题。对于图论有着强烈兴趣的 JYY，今年又琢磨起了“删边”的问题。
## 题目描述

对于一个 $N$ 个点（每个点从 $1$ 到 $N$ 编号），$M$ 条边的有向图，JYY 发现，如果从图中删去一些边，那么原图的连通性会发生改变；而也有一些边，删去之后图的连通性并不会发生改变。

JYY 想知道，如果想要使得原图任意两点的连通性保持不变，我们最多能删掉多少条边呢？


为了简化一下大家的工作量，这次 JYY 保证他给定的有向图一定是一个有向无环图（JYY：大家经过去年的问题，都知道对于给任意有向图的问题，最后都能转化为有向无环图上的问题，所以今年 JYY 就干脆简化一下大家的工作）。
## 输入格式

第一行包含两个正整数 $N$ 和 $M$。

接下来 $M$ 行，每行包含两个 $1$ 到 $N$ 之间的正整数 $x_i$ 和 $y_i$，表示图中存在一条从 $x_i$ 到 $y_i$ 的有向边。

输入数据保证，任意两点间只会有至多一条边存在。
## 输出格式

输出一行包含一个整数，表示JYY最多可以删掉的边数。
## 样例

### 样例输入 #1
```
5 6
1 2
2 3
3 5
4 5
1 5
1 3
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

一种合法方案为删去 $1\rightarrow 5$ 和 $1\rightarrow 3$。容易证明没有比 $2$ 更优的答案。

### 数据范围

对于 $100\%$ 的数据，$1 \leq N\leq 3\times 10^4$，$0 \leq M\leq 10^5$。


---

---
title: "[JSOI2013] 公交系统"
layout: "post"
diff: 省选/NOI-
pid: P6231
tag: ['2013', '各省省选', '江苏', 'O2优化']
---
# [JSOI2013] 公交系统
## 题目背景

几年前南京因为修地铁的缘故，很多公交车线路都被迫改变了。

JYY 为此很苦恼：试想一下，当你坐上一辆公交车，却发现这辆公交车驶向了与你记忆完全不同的方向。

于是 JYY 打算开发一套可以利用手机进行实时更新的公交信息应用， 所有安装了这款应用的手机都可以向数据库发送最新的公交线路更改情况，同时也可以通过应用向数据库查询自己所需要的信息。
## 题目描述

南京一共有 $n$ 个公交站点，分别从 $1$ 到 $n$ 编号。两个不同的站点 $x$ 和 $y$ 之间可能会有公交车直接运营（不经过别的站点直接从 $x$ 开到 $y$） ，我们将这种关系看作一条无向边（公交线路显然是双向的，我们既可以从 $x$ 坐公交车到 $y$，也可以从 $y$ 坐车到 $x$）。

任意时刻任何公交站点都至多只会连有 $2$ 条边，并且所有这些边是不会形成
环的（公交车很少会出现环线，所以这些公交线路应该形成一些不相交的链，链
的两端分别对应两个终点站）。

JYY 的 IOS 应用按照时间顺序一共收到了 $q$ 条交互信息，每一条交互信息
都是下列五种信息之一：

- `add x y z`，表示当前时刻，站点 $x$ 到站点 $y$ 之间有新增了一班公交车直接运营，并且在当前路况下，公交车所需要的运营时间为 $z$。
- `del x y`，表示由于某种原因，原本在站点 $x$ 和站点 $y$ 之间直接运营的公交车停运了。
- `change x y z`，表示由于路况情况改变，站点 $x$ 到站点 $y$ 之间直接运营的公交车当前的运营时间为 $z$。
- `reach x y`，表示某个用户询问从站点 $x$ 坐车能不能坐到站点 $y$。
- `dest x y`，表示某个用户从站点 $x$ 上车，坐上了当前正开往站点 $y$ 的公交车。该用户想知道，他到达 $y$ 后继续乘坐可乘坐的线路(已经乘坐过的线路不能重复乘坐)，最终能够到达的终点站是哪一站？从站点 $x$ 开始需要多久才能
开到终点站？

**在收到第一条信息之前，没有任何公交车在运营**。

由于用户难免会提交错误的信息，所以 JYY 希望他的软件对于错误的信息也
要能够做出合理的反应：

- 对于 `add` 信息，如果加入边 $(x,y)$ 之后，任何站点连接的边数均不超过 $2$ 并且图中没有环，JYY 则认为这个信息是正确的，并根据这个信息更新
数据库中的公交线路数据，否则JYY会无视这个错误信息。
- 对于 `del` 和 `change` 信息，如果站点 $x$ 和站点 $y$ 之间有公交车直接运营， JYY 则认为这条信息是正确的，并更新数据库，否则 JYY 则会无视这个错误
信息。
- 对于 `dest` 信息，如果站点 $x$ 不能到达站点 $y$，JYY 也会认为这一条询问信
息是错误的。

JYY 希望你能够帮助他完成这一个公交信息应用。
## 输入格式

输入数据的第一行包含两个整数，分别代表站点数 $n$ 和交互信息条数 $q$。

接下来 $q$ 行，每行对应一个 JYY 需要处理的信息，其格式见【题目描述】。

## 输出格式

输出 $q$ 行，每行都对应一个输入文件中的信息，具体内容如下：

- 如果输入的信息是错误的，输出 `ERROR`。
- 对于一个正确的 `add`，`del`，`change` 信息，输出 `OK`。
- 对于一个正确的 `dest` 信息，输出一行两个整数，分别为终点站的编号和开到终点站所需要的时间.
- 对于 `reach` 信息，如果用户询问的两个公交站点相互可达，输出 `YES`，否则输出 `NO`。
## 样例

### 样例输入 #1
```
6 10
add 1 2 1
add 2 1 1
add 3 2 1
add 4 5 2
reach 4 6
dest 1 5
del 5 6
add 1 4 2
dest 2 3
dest 3 2
```
### 样例输出 #1
```
OK
ERROR
OK
OK
NO
ERROR
ERROR
OK
3 1
5 6
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证：

- $2 \leq n \leq 10^5$，$2 \leq q \leq2×10^5$。
- $1 \leq x, y \leq n$，$x \neq y$，$1\leq z \leq10^4$。

---

#### 提示

请注意数据读入对程序效率造成的影响。


---

---
title: "[JXOI2012] 奇怪的道路"
layout: "post"
diff: 省选/NOI-
pid: P6239
tag: ['2012', '各省省选', 'O2优化', '状压 DP']
---
# [JXOI2012] 奇怪的道路
## 题目描述

小宇从历史书上了解到一个古老的文明。这个文明在各个方面高度发达，交通方面也不例外。考古学家已经知道，这个文明在全盛时期有 $n$ 座城市，编号为 $1,2,...,n$。$m$ 条道路连接在这些城市之间，每条道路将两个城市连接起来，使得两地的居民可以方便地来往。一对城市之间可能存在多条道路。

据史料记载，这个文明的交通网络满足两个奇怪的特征。

1. 这个文明崇拜数字 $k$，对于任何一条道路，设它连接的两个城市分别为 $u$ 和 $v$，则必定满足 $1 \le \left\vert {u-v}\right\vert \le k$。
2. 任何一个城市都与恰好偶数条道路相连（ $0$ 也被认为是偶数）。

不过，由于时间过于久远，具体的交通网络我们已经无法得知了。小宇很好奇这 $n$ 个城市之间究竟有多少种可能的连接方法，于是她向你求助。

两种可能的连接方法不同当且仅当存在一对城市，它们间的道路数在两种方法中不同。

在交通网络中，有可能存在两个城市无法互相到达。

方法数可能很大，你只需要输出方法数模 $10^9 + 7$ 后的结果。
## 输入格式

输入共一行，有三个整数 $n,m,k$。
## 输出格式

输出一个整数，表示方案数模 $10^9 + 7$ 后的结果。
## 样例

### 样例输入 #1
```
3 4 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4 3 3
```
### 样例输出 #2
```
4
```
## 提示

#### 数据规模与约定

- 对于 $100\%$ 的数据，满足 $1 \le n,m \le 30$，$1 \le k \le 8$。


---

---
title: "[SDOI2012] 最近最远点对"
layout: "post"
diff: 省选/NOI-
pid: P6247
tag: ['2012', '各省省选', '山东', 'Special Judge', '分治', '凸包', 'K-D Tree']
---
# [SDOI2012] 最近最远点对
## 题目描述

给定平面直角坐标系上的 $n$ 个点，分别求出距离最近的两个点的距离和距离最远的两个点的距离。注意，距离为直线距离。
## 输入格式

第一行一个整数，$n$。
接下来 $n$ 行每行两个非负浮点数，$x_i$,$y_i$，表示第 $i$ 个点的 X 坐标与 Y 坐标。
## 输出格式

总共一行，两个浮点数，为最短距离与最长距离。误差不超过 $0.01$ 视为正确。
## 样例

### 样例输入 #1
```
4
0.0 0.0
0.0 1.0
1.0 0.0
1.0 1.0
```
### 样例输出 #1
```
1.00 1.41
```
## 提示

- 对于 $30\%$ 的数据，$n\leq 2000$；
- 对于 $70\%$ 的数据，$n\leq 20000$；
- 对于 $100\%$ 的数据，$0 \lt n\leq 10^5$，输入数据中所有数均为不超过 $10^9$ 的非负数。


---

---
title: "[SDOI2012] 棋盘覆盖"
layout: "post"
diff: 省选/NOI-
pid: P6407
tag: ['2012', '各省省选', '山东', 'O2优化']
---
# [SDOI2012] 棋盘覆盖
## 题目描述

在一个 $n\times m$ 的棋盘内，有 $K$ 个方格被称为特殊方格。我们要使用一组俄罗斯方块来覆盖这个棋盘，保证特殊方格不能被覆盖，非特殊方格只能被一个俄罗斯方块覆盖，求最多能容纳的俄罗斯方块的数量。

已知有以下三组俄罗斯方块，一个棋盘可能用其中的某一组。

![](https://cdn.luogu.com.cn/upload/image_hosting/8ck63qab.png)
## 输入格式

第一行三个整数 $n,m,K$ 和一个字符 `type` 为所用的俄罗斯方块组。

接下来 $K$ 行每行两个整数 $x,y$ 表示第 $x$ 行第 $y$ 列为特殊方格。
## 输出格式

一个整数，为所求的答案。
## 样例

### 样例输入 #1
```
8 8 0 A
```
### 样例输出 #1
```
32
```
### 样例输入 #2
```
7 6 6 C
3 1
3 6
5 3
5 4
5 7
6 7
```
### 样例输出 #2
```
12
```
## 提示

对于测试点 $1\sim 6$，$1\le n,m\le 100$，$0\le K\le nm$，`type` 为 `A`；

对于测试点 $7\sim 12$，$2\le n=m\le 2^{2\times 10^5}$，$n,m$ 为 $2$ 的整数次幂，$K=1$，`type` 为 `B`；

对于测试点 $13\sim 21$，$1\le n,m\le 11$，$0\le K\le nm$，`type` 为 `C`。


---

---
title: "[省选联考 2020 A/B 卷] 冰火战士"
layout: "post"
diff: 省选/NOI-
pid: P6619
tag: ['2020', '线段树', '二分', '各省省选', '树状数组', '离散化']
---
# [省选联考 2020 A/B 卷] 冰火战士
## 题目背景

A 卷 D1T1，B 卷 D1T3。

时限 3s，内存 512MB。
## 题目描述

一场比赛即将开始。

每位战士有两个属性：温度和能量，有两派战士：冰系战士的技能会对周围造成降温冰冻伤害，因而要求场地温度不低于他的自身温度才能参赛；火系战士的技能会对周围造成升温灼烧伤害，因而要求场地温度不高于他的自身温度才能参赛。

当场地温度确定时，双方能够参赛的战士分别排成一队。冰系战士按自身温度从低到高排序，火系战士按自身温度从高到低排序，温度相同时能量大的战士排在前面。首先，双方的第一位战士之间展开战斗，两位战士消耗相同的能量，能量少的战士将耗尽能量退出比赛，而能量有剩余的战士将继续和对方的下一位战士战斗（能量都耗尽则双方下一位战士之间展开战斗）。如此循环，直至某方战士队列为空，比赛结束。

你需要寻找最佳场地温度：使冰火双方消耗总能量最高的温度的最高值。

现在，比赛还处于报名阶段，目前还没有任何战士报名，接下来你将不断地收到报名信息和撤回信息。其中，报名信息包含报名战士的派系和两个属性，撤回信息包含要撤回的报名信息的序号。每当报名情况发生变化（即收到一条信息）时，你需要立即报出当前局面下的最佳场地温度，以及该场地温度下双方消耗的总能量之和是多少。若当前局面下无论何种温度都无法开展比赛（某一方没有战士能参赛），则只要输出 `Peace`。
## 输入格式

第一行一个数 $Q$，表示信息的数量。

接下来 $Q$ 行，每行为 `1 t x y` $(t \in \{0, 1\}$，$x$ 和 $y$ 都是正整数 $)$ 或 `2 k`（$k$ 是正整数）：

`1 t x y` 表示一条报名信息，$t = 0$ 时报名战士是冰系，$t = 1$ 时报名战士是火系，$x$ 表示战士的自身温度，$y$ 表示战士的能量。

`2 k` 表示一条撤回信息，撤回的是第 $k$ 条信息。被撤回的信息一定是报名信息，已被撤回的信息不会再次被撤回。
## 输出格式

共 $Q$ 行，每行有两个用空格隔开的正整数，分别表示当前局面下的最佳温度和该温度下冰火双方消耗的总能量之和。
## 样例

### 样例输入 #1
```
8
1 1 103 150
1 0 100 100
1 1 102 150
1 0 103 300
2 1
1 1 101 100
1 1 104 350
1 0 100 400
```
### 样例输出 #1
```
Peace
103 200
103 200
103 300
102 200
102 200
104 700
102 1000
```
## 提示

#### 样例 1 解释
为说明方便，约定：若第 $k$ 条信息是报名信息，则该条报名信息对应战士 $k$。样例中含有战士 $1,2,3,4,6,7,8$，由于第 $5$ 条是撤回信息，所以没有战士 $5$。

下面逐个解释每个输出：

1. 只有火系战士：战士 $1$，无法比赛，输出 `Peace`。
2. 温度为 $100 \sim 103$ 都能消耗最多的能量 $200$：战士 $1$ 对阵战士 $2$ 消耗能量 $200$，最佳温度为 $103$。
3. 温度为 $100 \sim 103$ 都能消耗最多的能量 $200$：战士 $1$ 对阵战士 $2$ 消耗能量 $200$，最佳温度为 $103$。
4. 温度 $103$ 能消耗最多的能量 $300$：首先，战士 $1$ 对阵战士 $2$ 消耗能量 $200$；然后，战士 $1$ 对阵战士 $4$ 消耗能量 $100$，最佳温度为 $103$。
5. 从现在起战士 $1$ 不再存在。温度 $100 \sim 102$ 能消耗最多的能量 $200$：战士 $2$ 对阵战士 $3$ 消耗能量 $200$，最佳温度为 $102$。

#### 样例 2

见附加文件中 `icefire2.in` 与 `icefire2.ans`。

#### 数据范围

$10\%$ 的数据：$Q \leq 100$，$x \leq 10^3$。

另有 $20\%$ 的数据：$Q \leq 10^4$，$x \leq 5000$，不存在撤回信息，且输入的 $x$ 按顺序不降。

$60\%$ 的数据（包含上述 $20\%$，下同）：$Q \leq 2 \times 10^5$，$x \leq 2 \times 10^5$。

$90\%$ 的数据：$Q \leq 2 \times 10^6$，$x \leq 2 \times 10^6$。

$100\%$ 的数据：$1 \leq Q \leq 2 \times 10^6$，$1 \leq x \leq 2 \times 10^9$，所有 $y$ 之和不超过 $2 \times 10^9$，保证不存在 $t, x, y$ 完全相同的两个战士。


---

---
title: "[省选联考 2020 A 卷] 组合数问题"
layout: "post"
diff: 省选/NOI-
pid: P6620
tag: ['2020', '各省省选', '组合数学', 'Stirling 数']
---
# [省选联考 2020 A 卷] 组合数问题
## 题目背景

1s 512M
## 题目描述

众所周知，小葱同学擅长计算，尤其擅长计算组合数。小葱现在希望你计算 
$$\left(\sum_{k=0}^{n}f(k)\times x^k\times \binom{n}{k}\right)\bmod p$$ 
的值。其中 $n$, $x$, $p$ 为给定的整数，$f(k)$ 为给定的一个 $m$ 次多项式 $f(k) = a_0 + a_1k + a_2k^2 + \cdots + a_mk^m$。$\binom{n}{k}$ 为组合数，其值为 $\binom{n}{k} = \frac{n!}{k!(n-k)!}$。
## 输入格式

第一行四个非负整数 $n$, $x$, $p$, $m$。

第二行 $m + 1$ 个整数，分别代表 $a_0$, $a_1$, $\cdots$, $a_m$。
## 输出格式

仅一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 1 10007 2
0 0 1
```
### 样例输出 #1
```
240
```
### 样例输入 #2
```
996 233 998244353 5
5 4 13 16 20 15
```
### 样例输出 #2
```
869469289
```
## 提示

#### 样例 1 解释

$f(0) = 0，f(1) = 1，f(2) = 4，f(3) = 9，f(4) = 16，f(5) = 25$。

$x = 1$，故 $x^k$ 恒为 $1$，乘积中的该项可以忽略。

$\binom 5 0 = 1, \binom 5 1 = 5, \binom 5 2 = 10, \binom 5 3 = 10, \binom 5 4 = 5, \binom 5 5 = 1$。

#### 样例 3

见附加文件中 `problem3.in` 与 `problem3.ans`。

#### 数据范围与提示

对于所有测试数据：$1\le n, x, p \le 10^9, 0\le a_i\le 10^9, 0\le m \le \min(n,1000)$。

每个测试点的具体限制见下表：

| 测试点编号  | $n\le $ | $m\le $ | 其他特殊限制 |
| :---------: | :-----: | :-----: | :----------: |
|  $1\sim 3$  | $1000$  | $1000$  |              |
|  $4\sim 6$  | $10^5$  |   $0$   |  $p$ 是质数  |
|  $7\sim 8$  | $10^9$  |   $0$   |              |
| $9\sim 12$  | $10^9$  |   $5$   |              |
| $13\sim 16$ | $10^9$  | $1000$  |    $x=1$     |
| $17\sim 20$ | $10^9$  | $1000$  |              |


---

---
title: "[省选联考 2020 A/B 卷] 信号传递"
layout: "post"
diff: 省选/NOI-
pid: P6622
tag: ['2020', '各省省选', '状压 DP']
---
# [省选联考 2020 A/B 卷] 信号传递
## 题目描述

一条道路上从左至右排列着 $m$ 个信号站，初始时从左至右依次编号为 $1,2,\dots,m$，相邻信号站之间相隔 $1$ 单位长度。每个信号站只能往它右侧的任意信号站传输信号（称为普通传递），每单位长度距离需要消耗 $1$ 单位时间。道路的最左侧有一个控制塔，它在最左侧信号站的左侧，与其相隔 $1$ 单位长度。控制塔能与任意信号站进行双向信号传递（称为特殊传递），但每单位长度距离需要消耗 $k$ 个单位时间。对于给定的长度为 $n$ 的信号传递序列 $S$，传递规则如下：

1. 共 $n-1$ 次信号传递，第 $i$ 次信号传递将把信号从 $S_i$ 号信号站传递给 $S_{i+1}$ 号。
2. 若 $S_{i+1}$ 号信号站在 $S_i$ 号右侧，则将使用普通传递方式，从 $S_i$ 号直接传递给 $S_{i+1}$ 号。
3. 若 $S_{i+1}$ 号信号站在 $S_i$ 号左侧，则将使用特殊传递方式，信号将从 $S_i$ 号传递给控制塔，再由控制塔传递给 $S_{i+1}$ 号。
4. 若 $S_i=S_{i+1}$，则信号无须传递。

阿基作为大工程师，他能够任意多次交换任意两个信号站的位置，即他能够重排信号站的顺序，这样会使得 $S$ 消耗的传递时间改变。现在阿基想知道，在他重排信号站顺序后，$S$ 所消耗的传递时间最小能是多少。
## 输入格式

第一行三个整数 $n,m,k$，分别代表信号传递序列 $S$ 的长度，信号站个数，特殊传递单位长度距离的时间消耗。

第二行 $n$ 个整数，第 $i$ 个整数表示 $S_i$。
## 输出格式

仅一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3 1
1 2 3
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
4 3 1
1 2 3 1
```
### 样例输出 #2
```
6
```
## 提示

【样例解释 $1$】

信号站顺序保持不变，两次使用普通传递方式，时间消耗为 $1+1=2$。

【样例解释 $2$】

对于排列 $1,2,3$，传递时间为 $1+1+(3\times 1+1\times 1)=6$。

对于排列 $1,3,2$，传递时间为 $2+(3\times 1+2\times 1)+(2\times 1+1\times 1)=10$。

对于排列 $2,1,3$，传递时间为 $(2\times 1+1\times 1)+2+(3\times 1+2\times 1)=10$。

对于排列 $2,3,1$，传递时间为 $(3\times 1+1\times 1)+1+1=6$。

对于排列 $3,1,2$，传递时间为 $1+(3\times 1+1\times 1)+1=6$。

对于排列 $3,2,1$，传递时间为 $(3\times 1+2\times 1)+(2\times 1+1\times 1)+2=10$。

【数据范围】

$30\%$ 的数据：$m\leq 8, n\leq 100$。

$60\%$ 的数据：$m\leq 20$。

$70\%$ 的数据：$m\leq 21$。

$80\%$ 的数据：$m\leq 22$。

$100\%$ 的数据：$2\leq m\leq 23$，$2\leq n\leq 10^5$，$1\leq k\leq 100$，$1\leq S_i\leq m$。


---

---
title: "[省选联考 2020 A 卷] 树"
layout: "post"
diff: 省选/NOI-
pid: P6623
tag: ['2020', '倍增', '各省省选', '字典树 Trie', '位运算']
---
# [省选联考 2020 A 卷] 树
## 题目描述

给定一棵 $n$ 个结点的有根树 $T$，结点从 $1$ 开始编号，根结点为 $1$ 号结点，每个结点有一个正整数权值 $v_i$。

设 $x$ 号结点的子树内（包含 $x$ 自身）的所有结点编号为 $c_1,c_2,\dots,c_k$，定义 $x$ 的价值为：

$
val(x)=(v_{c_1}+d(c_1,x)) \oplus (v_{c_2}+d(c_2,x)) \oplus \cdots \oplus (v_{c_k}+d(c_k, x))
$

其中 $d(x,y)$ 表示树上 $x$ 号结点与 $y$ 号结点间唯一简单路径所包含的边数，$d(x, x) = 0$。$\oplus$ 表示异或运算。

请你求出 $\sum\limits_{i=1}^n val(i)$ 的结果。

## 输入格式

第一行一个正整数 $n$ 表示树的大小。

第二行 $n$ 个正整数表示 $v_i$。

接下来一行 $n-1$ 个正整数，依次表示 $2$ 号结点到 $n$ 号结点，每个结点的父亲编号 $p_i$。

## 输出格式

仅一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
5 4 1 2 3
1 1 2 2
```
### 样例输出 #1
```
12
```
## 提示

【样例解释 $1$】

$val(1)=(5+0)\oplus(4+1)\oplus(1+1)\oplus(2+2)\oplus(3+2)=3$。

$val(2)=(4+0)\oplus(2+1)\oplus(3+1) = 3$。

$val(3)=(1+0)=1$。

$val(4)=(2+0)=2$。

$val(5)=(3+0)=3$。

和为 $12$。

【数据范围】

对于 $10\%$ 的数据：$1\leq n\leq 2501$；

对于 $40\%$ 的数据：$1\leq n\leq 152501$；

另有 $20\%$ 的数据：所有 $p_i=i-1$（$2\leq i\leq n$）；

另有 $20\%$ 的数据：所有 $v_i=1$（$1\leq i\leq n$）；

对于 $100\%$ 的数据：$1\leq n,v_i \leq 525010$，$1\leq p_i\leq n$。


---

---
title: "[省选联考 2020 A 卷] 作业题"
layout: "post"
diff: 省选/NOI-
pid: P6624
tag: ['数学', '2020', '各省省选', '矩阵树定理', '最大公约数 gcd']
---
# [省选联考 2020 A 卷] 作业题
## 题目描述

小 W 刚刚在离散数学课学习了生成树的知识：一个无向图 $G=(V,E)$ 的生成树 $T$ 为边集 $E$ 的一个大小为 $|V|-1$ 的子集，且保证 $T$ 的生成子图在 $G$ 中连通。

小 W 在做今天的作业时被这样一道题目难住了：

给定一个 $n$ 个顶点 $m$ 条边（点和边都从 $1$ 开始编号）的无向图 $G$，保证图中无重边和无自环。每一条边有一个正整数边权 $w_i$，对于一棵 $G$ 的生成树 $T$，定义 $T$ 的价值为：$T$ 所包含的边的边权的最大公约数乘以边权之和，即：

$$
val(T)=\left(\sum\limits_{i=1}^{n-1} w_{e_i}\right) \times \gcd(w_{e_1},w_{e_2},\dots,w_{e_{n-1}})
$$

其中 $e_1,e_2,\dots,e_{n-1}$ 为 $T$ 包含的边的编号。

小 W 需要求出 $G$ 的所有生成树 $T$ 的价值之和，他做了很久也没做出来，请你帮帮他。由于答案可能很大，你只需要给出答案对 $998244353$ 取模后的结果。
## 输入格式

第一行两个正整数 $n,m$，表示 $G$ 的点数和边数。

接下来 $m$ 行，每行三个正整数 $u_i,v_i,w_i$，第 $i$ 行表示一条无向边连接 $u_i$ 号点和 $v_i$ 号点，权值为 $w_i$。

## 输出格式

仅一行一个整数，表示答案对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
3 3
1 2 4
2 3 6
1 3 12
```
### 样例输出 #1
```
192
```
## 提示

【样例解释 $1$】

$G$ 共有三棵生成树：

$T_1=\{(1,2),(2,3)\}$，价值为 $10\times 2=20$。

$T_2=\{(1,2),(1,3)\}$，价值为 $16\times 4=64$。

$T_3=\{(1,3),(2,3)\}$，价值为 $18\times 6=108$。

总和为 $192$。

【数据规模】

$10\%$ 的数据满足：$m\leq 15$。

另有 $20\%$ 的数据满足：$m \leq n$。

另有 $20\%$ 的数据满足：$w_i$ 均相同。

另有 $20\%$ 的数据满足：$w_i$ 均为质数。

$100\%$ 的数据满足：$1\leq n\leq 30, 1\leq m \leq \frac {n(n-1)}{2}, 1\leq w_i \leq 152501$。


---

---
title: "[省选联考 2020 B 卷] 消息传递"
layout: "post"
diff: 省选/NOI-
pid: P6626
tag: ['2020', '各省省选', '点分治']
---
# [省选联考 2020 B 卷] 消息传递
## 题目描述

给定一个包含 $n$ 个人（从 $1$ 到 $n$ 编号）的树形社交网络。如果一个人在某天收到了一条消息，则下一天他会将消息传递给所有与他有直接社交关系的人。

现在有 $m$ 次询问，每次询问假定第 $0$ 天 $x$ 号人收到了一条消息，请你计算第 $k$ 天时新收到此条消息的人数（即第 $k$ 天前收到过此条消息的人不计入其中）。不同询问间互不影响。
## 输入格式

**本题包含多组测试数据。**

第一行一个整数 $T$，为测试数据组数。

对于每组测试数据：

第一行两个数 $n,m$ 分别表示树形社交网络的人数和询问的数量。

接下来 $n - 1$ 行，每行两个数 $a, b$，表示 $a$ 号人和 $b$ 号人之间有直接社交关系。保证输入的是树形社交网络。

接下来 $m$ 行，每行两个数 $x, k$，意义见题目描述。

## 输出格式

对于每组测试数据：输出 $m$ 行，每行一个数表示询问的答案。

## 样例

### 样例输入 #1
```
1
4 2
1 2
2 3
3 4
1 1
2 2
```
### 样例输出 #1
```
1
1
```
## 提示

**样例解释**

第一个询问，第一天新收到消息的人只有 $2$ 号。
第二个询问，第一天新收到消息的人有 $1$、$3$ 号，第二天新收到消息的人有 $4$ 号。

**数据范围与约定**

对于测试点 $1$：$1\le n, m\le 10$。  
对于测试点 $2$：$1\le n, m\le 100$。  
对于测试点 $3$：$1\le n, m\le 1000$。  
对于测试点 $4\sim6$：$1\le n, m\le 10^5, k\le 20$。  
对于测试点 $7\sim10$：$1\le n, m\le 10^5$。  
对于所有测试点：$1\le T\le 5, 1\le x\le n, 0\le k < n$。


---

---
title: "[省选联考 2020 B 卷] 丁香之路"
layout: "post"
diff: 省选/NOI-
pid: P6628
tag: ['贪心', '2020', '并查集', '各省省选', '生成树', '欧拉回路']
---
# [省选联考 2020 B 卷] 丁香之路
## 题目描述

春暖花开，万物复苏，随着疫情的逐渐过去，Yazid 带着他的 $n$ 个好朋友来到 T 大校园参观游览。方便起见，我们将他们从 $1$ 至 $n$ 编号。

T 大校园的版图可以抽象成一张 $n$ 个顶点的无向图（顶点编号从 $1$ 至 $n$）。且对于任意两个不同顶点，设它们的编号分别为 $i, j(i\neq j)$，则它们之间有一条需要花费 $|i - j|$ 单位时间通过的无向边。

丁香花是 T 大的校花之一。时下正值丁香花盛开之际，校园内的 $m$ 条道路上都开有丁香花。Yazid 的朋友们对丁香花十分感兴趣，因此他们都希望遍历**所有**开有丁香花的 $m$ 条道路。

Yazid 的朋友们从顶点 $s$ 出发。其中，第 $i$ 个朋友希望以顶点 $i$ 为终点终止他的参观。与此同时，如上面所述，每个朋友都必须经过开着丁香花的 $m$ 条道路各至少一次。

Yazid 的朋友不想太过疲累，因此他们希望花尽可能少的时间来完成他们的目标。

请你计算 Yazid 的朋友们分别需要花费多少单位时间完成他们的目标。
## 输入格式

第一行 $3$ 个非负整数 $n, m, s$。保证 $1\le s\le n$；保证 $m\le \frac {n(n-1)}2$。

第 $2$ 行至第 $m+1$ 行，每行 $2$ 个整数 $u, v$，描述一条开有丁香花的，连接顶点 $u, v$ 的无向边。保证 $1\le u, v\le n$ 且 $u\neq v$；保证每条无向边至多被描述一次。

对于输入的所有行，用单个空格将行内的多个整数隔开。
## 输出格式

输出一行 $n$ 个用单个空格隔开的整数，其中第 $i$ 个整数描述 Yazid 的第 $i$ 个朋友完成目标所需花费的最少时间。

## 样例

### 样例输入 #1
```
4 3 1
1 2
4 2
3 1
```
### 样例输出 #1
```
6 7 8 7
```
### 样例输入 #2
```
6 0 2
```
### 样例输出 #2
```
1 0 1 2 3 4
```
### 样例输入 #3
```
5 4 1
1 2
3 4
4 5
3 5
```
### 样例输出 #3
```
8 7 6 7 8
```
## 提示

**样例解释 1**

第 $1$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $2, 4, 3$，最终回到 $1$，消耗 $|1-2|+|2-4|+|4-3|+|3-1| = 6$ 单位时间。

第 $2$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $2, 4, 3, 1$，最终来到 $2$，消耗 $7$ 单位时间。

第 $3$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $2, 4, 1$，最终来到 $3$，消耗 $8$ 单位时间。

第 $4$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $3, 1, 2$，最终来到 $4$，消耗 $7$ 单位时间。

**样例解释 2**

由于 $m = 0$，没有必经之路，因此每个朋友直接通过一条边直达目的地即可。


**数据范围与约定**

| 测试点编号  |  $n=$  | 其他特殊限制 |
| --------- | ---- | ---------- |
|  $1\sim 3$  |  $50$  |    $m=9$     |
|  $4\sim 6$  |  $50$  |    $m=15$    |
|  $7\sim 8$  |  $50$  |              |
| $9\sim 10$  | $300$  |              |
|    $11$     | $1600$ |    $m=0$     |
| $12\sim 14$ | $1600$ |    $m=1$     |
| $15\sim 17$ | $1600$ |              |
| $18\sim 20$ | $2500$ |              |


---

---
title: "[ZJOI2020] 传统艺能"
layout: "post"
diff: 省选/NOI-
pid: P6630
tag: ['2020', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2020] 传统艺能
## 题目背景

4s，512MB
## 题目描述

Bob 喜欢线段树。

众所周知，ZJOI 的第二题有很多线段树。

Bob 有一棵根为 $[1, n]$ 的广义线段树。Bob 需要在这个线段树上执行 $k$ 次区间懒标记操作，每次操作会等概率地从 $[1, n]$ 的所有 $\dfrac{n(n+1)}{2}$ 个子区间中随机选择一个。对于所有在该次操作中被访问到的非叶子节点，Bob 会将这个点上的标记下推；而对于所有叶子节点（即没有继续递归的节点），Bob 会给这个点打上标记。

Bob 想知道，$k$ 次操作之后，有标记的节点的期望数量是多少。

【具体定义】

线段树：线段树是一棵每个节点上都记录了一个线段的二叉树。根节点记录的线段是 $[1, n]$。对于每个节点，若它记录的线段是 $[l, r]$ 且 $l \neq r$，取 $m = \lfloor \dfrac{l+r}{2} \rfloor$，则它的左右儿子节点记录的线段分别是 $[l, m]$ 和 $[m + 1, r]$；若 $l = r$，则它是叶子节点。

广义线段树：在广义的线段树中，$m$ 不要求恰好等于区间的中点，但是 $m$ 还是必须满足 $l \leq m < r$ 的。不难发现在广义的线段树中，树的深度可以达到 $O(n)$ 级别。

线段树的核心是懒标记，下面是一个带懒标记的广义线段树的伪代码，其中 `tag` 数组为懒标记：

![](https://cdn.luogu.com.cn/upload/image_hosting/3230chjw.png)

注意，在处理叶子节点时，一旦他获得了一个标记，那么这个标记会一直存在。

你也可以这么理解题意：有一棵广义线段树，每个节点有一个 $m$ 值。一开始 `tag` 数组均为 $0$，Bob 会执行 $k$ 次操作，每次操作等概率随机选择区间 $[l, r]$ 并执行 `MODIFY(root,1,n,l,r);`。
最后所有 `Node` 中满足 `tag[Node]=1` 的期望数量就是需要求的值。

## 输入格式

第一行输入两个整数 $n, k$。

接下来输入一行包含 $n - 1$ 个整数 $a_i$：按照先序遍历的顺序，给出广义线段树上所有非叶子节点的划分位置 $m$。你也可以理解为从只有 $[1, n]$ 根节点开始，每次读入一个整数后，就将当前包含这个整数的节点做一次拆分，最后获得一棵有 $2n - 1$ 个节点的广义线段树。

保证给定的 $n - 1$ 个整数是一个排列，不难发现通过这些信息就能唯一确定一棵 $[1, n]$ 上的广义线段树。

## 输出格式

输出一行一个整数，代表期望数量对 $p = 998244353$ 取模后的结果。即，如果期望数量的最简分数表示为 $\dfrac{a}{b}$，你需要输出一个整数 $c$ 满足 $c \times b \equiv a \pmod p$。
## 样例

### 样例输入 #1
```
3 1
1 2

```
### 样例输出 #1
```
166374060

```
### 样例输入 #2
```
5 4
2 1 3 4
```
### 样例输出 #2
```
320443836
```
## 提示

样例输入输出 $3$ 见下发文件。

样例解释 $1$

输入的线段树为 $[1, 3], [1, 1], [2, 3], [2, 2], [3, 3]$。

若操作为 $[1, 1]/[2, 2]/[3, 3]/[2, 3]/[1, 3]$，标记个数为 $1$。若操作为 $[1, 2]$，标记个数为 $2$。故答案为 $\dfrac{7}{6}$。

| 测试点 | $n$ | $k$ | 其他约定 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $\leq 10$ | $\leq 4$ | 无 |
| $2$ | $\leq 10$ | $\leq 100$ | 无 |
| $3$ | $\leq 5$ | 无 | 无 |
| $4$ | 无 | $=1$ | 无 |
| $5$ | $=32$ | 无 | 输入的线段树为完全二叉树 |
| $6$ | $=64$ | 无 | 输入的线段树为完全二叉树 |
| $7$ | $=4096$ | 无 | 输入的线段树为完全二叉树 |
| $8$ | $\leq 5000$ | 无 | 每个 $m$ 均在 $[l, r - 1]$ 内均匀随机 |
| $9$ | $\leq 100000$ | 无 | 无 |
| $10$ | 无 | 无 | 无 |

对于 $100\%$ 的数据，$1 \leq n \leq 200000, 1 \leq k \leq 10^9$。


---

---
title: "[BJOI2020] 封印"
layout: "post"
diff: 省选/NOI-
pid: P6640
tag: ['2020', '各省省选', '北京']
---
# [BJOI2020] 封印
## 题目背景

注：NOI 2020 北京队选拔赛因不可抗力因素取消，改为按前一年 CSP-S 第二轮成绩选出省队。因为出现同分，为决定最终 A 队名单，举办了加试。本题即为加试题。
## 题目描述

给出只包含小写字母 $a,b$ 的两个字符串 $s, t$，$q$ 次询问，每次询问 $s[l \dots r]$ 和 $t$ 的最长公共子串长度。
## 输入格式

输入共 $q+3$ 行。

第一行一个字符串 $s$。

第二行一个字符串 $t$。

第三行一个整数 $q$。

接下来的 $q$ 行，每行两个整数 $l_i, r_i(1\le l_i \le r_i \le |s|)$，表示一次询问。
## 输出格式

输出共 $q$ 行。

第 $i$ 行表示 $s[l_i \dots r_i]$ 和 $t$ 的最长公共子串长度。
## 样例

### 样例输入 #1
```
aaba
aaaabbbaa
3
1 4
1 3
2 4
```
### 样例输出 #1
```
3
3
2
```
## 提示

| 测试点编号 | $\vert s\vert , \vert t\vert \le $ |     $q\le$     |
| :--------: | :------------: | :------------: |
|    $1$     |      $50$      |      $50$      |
|   $2,3$    | $2\times 10^3$ | $2\times 10^3$ |
|   $4,5$    | $2\times 10^5$ |      $10$      |
| $6\sim 10$ | $2\times 10^5$ | $2\times 10^5$ |


---

---
title: "[SNOI2020] 字符串"
layout: "post"
diff: 省选/NOI-
pid: P6793
tag: ['字符串', '2020', '各省省选', '后缀自动机 SAM', '树形 DP', '后缀数组 SA']
---
# [SNOI2020] 字符串
## 题目描述

有两个长度为 $n$ 的由小写字母组成的字符串 $a,b$，取出他们所有长为 $k$ 的子串（各有 $n-k+1$ 个），这些子串分别组成集合 $A,B$。现在要修改 $A$ 中的串，使得 $A$ 和 $B$ 完全相同。可以任意次选择修改 $A$ 中一个串的一段后缀，花费为这段后缀的长度。总花费为每次修改花费之和，求总花费的最小值。
## 输入格式

第一行两个整数 $n,k$ 表示字符串长度和子串长度；   
第二行一个小写字母字符串 $a$；   
第三行一个小写字母字符串 $b$。
## 输出格式

输出一行一个整数表示总花费的最小值。
## 样例

### 样例输入 #1
```
5 3
aabaa
ababa
```
### 样例输出 #1
```
3
```
## 提示

#### 样例说明

对于样例 $1$，所有子串为：$A = \{aab,aba,baa\}, B = \{aba, bab, aba\}$。可以看出有一对 $aba$ 是相同的，另外要把 $aab$ 改成 $aba$（花费 $2$），$baa$ 改成 $bab$（花费 $1$），总花费为 $3$。

#### 数据规模与约定

对于所有数据，$1\le k\le n\le 1.5\times 10^5$。

- 对于 $10\%$ 的数据，$n \le 11$；
- 对于另外 $20\%$ 的数据，$n \le 200$；
- 对于另外 $20\%$ 的数据，$n \le 2000$；
- 对于另外 $10\%$ 的数据，字符串的每一位在小写字母中均匀随机；
- 对于余下 $40\%$ 的数据，无特殊限制。


---

---
title: "[JSOI2010] 蔬菜庆典"
layout: "post"
diff: 省选/NOI-
pid: P7221
tag: ['2010', '各省省选', '江苏']
---
# [JSOI2010] 蔬菜庆典
## 题目描述

JYY 在火星上找到一片埋有宝藏的岛，并且带走了一些宝藏。之后 JYY 被火星人发现偷宝藏，抓了起来。火星人打算吃掉 JYY，除非 JYY 能在火星年度蔬菜庆典的游戏中赢得足够多的火星币来支付他带走宝藏的费用。

游戏在蔬菜广场上进行。首先放进广场的是一个巨大的转基因南瓜，接着各种其他巨大的蔬菜被陆续拖进广场，连同大南瓜一共 $n$ 个，第 $i$ 个放入的蔬菜会用一根绳子和先前放入的某个蔬菜连接起来。按照火星人的说法，蔬菜 $i$ 是蔬菜 $p_i$ 的 Dlihc，蔬菜 $p_i$ 是蔬菜 $i$ 的 Tnerap。JYY 立即看出，一开始的大南瓜没有 Tnerap，后来的每个蔬菜都恰好有一个 Tnerap；每个蔬菜可能有一个或多个的 Dlihc，也可能没有。$n$ 个蔬菜全部在广场上安置好后，火星人在每个蔬菜上贴一张纸条，蔬菜 $i$ 的纸条上写着一个整数 $v_i$，表示这个蔬菜的价钱。

游戏一个接一个地进行着。在整个晚会将要结束时，JYY 终于等到了适合自己的那一个。（你不能指望有恐高症的 JYY 会在蔬菜间玩走钢丝，尽管那样能有丰厚的报酬）。游戏规则是：游戏者（也就是 JYY）每次可以选择任意一个既有 Dlihc 又有 Tnerap 的蔬菜 $i$，将它的价钱 $v_i$ 改成 $v_p+v_c-v_i$，其中 $p$ 代表蔬菜 $i$ 的 Tnerap 的编号，$c$ 代表蔬菜 $i$ 的任意一个 Dlihc 的编号。火星人给的时间比较宽裕，足够 JYY 进行任意多次操作。当 JYY 决定不再操作时，游戏结束。之后所有巨型蔬菜将被火星政府按蔬菜上的标价收购。买菜所得的钱归 JYY 所有，用以支付他的债务。

JYY 想知道，他最多能把这些蔬菜卖出多少钱，或者他能通过一系列操作使得蔬菜的总价无限制地增大。请你帮助 JYY 解决这个问题。
## 输入格式

输入文件有多组数据，每组数据的格式为：

第一行一个整数 $n$ 表示广场上蔬菜的个数。

接下来 $n$ 行，每行两个整数 $p_i,v_i$，第 $i$ 行中的整数代表蔬菜 $i$ 的 Tnerap 的编号和蔬菜 $i$ 的价格。

当 $n=0$ 时表示输入结束。
## 输出格式

对于每组数据，输出一行。若蔬菜的总价能无限制增大，输出 `+inf`。否则输出一个整数，表示所有蔬菜的最大总价。
## 样例

### 样例输入 #1
```
5
-1 3
1 2
1 1
3 2
3 2
5
-1 3
1 2
1 1
3 2
3 3
0
```
### 样例输出 #1
```
13
+inf

```
## 提示

### 样例解释 1

共有两组数据。

对于第一组数据，我们只能对蔬菜 $3$ 进行操作，它的值只能是 $1$ 或 $4$，所以答案为 $3+2+4+2+2=13$。

对于第二组数据，可以按照如下方法使得所有蔬菜的价钱无限制地增大：

$$\begin{matrix}1\to 3+3-1=5\\5\to 3+2-5=0\\0\to 3+3-0=6\\6\to 3+2-6=-1\\-1\to 3+3-(-1)=7\\\cdots\end{matrix}$$

### 数据范围

对于 $100\%$ 的数据，$n\leq 2\times 10^5,-10^7\leq v_i\leq 10^7$。


---

---
title: "[省选联考 2021 A 卷] 矩阵游戏"
layout: "post"
diff: 省选/NOI-
pid: P7515
tag: ['各省省选', '2021', 'Special Judge', 'O2优化']
---
# [省选联考 2021 A 卷] 矩阵游戏
## 题目描述

Alice 有一个 $n \times m$ 的矩阵 $a_{i, j}$（$1 \le i \le n$，$1 \le j \le m$），其每个元素为大小不超过 ${10}^6$ 的非负整数。

Bob 根据该矩阵生成了一个 $(n - 1) \times (m - 1)$ 的矩阵 $b_{i, j}$（$1 \le i \le n - 1$，$1 \le j \le m - 1$），每个元素的生成公式为

$$ b_{i, j} = a_{i, j} + a_{i, j + 1} + a_{i + 1, j} + a_{i + 1, j + 1} $$

现在 Alice 忘记了矩阵 $a_{i, j}$，请你根据 Bob 给出的矩阵 $b_{i, j}$ 还原出 $a_{i, j}$。
## 输入格式

**本题有多组数据。**

第一行，一个整数 $T$，表示数据组数。对于每组数据：

第一行，两个正整数 $n, m$，表示矩阵 $a_{i, j}$ 的大小。  
接下来 $n - 1$ 行，每行 $m - 1$ 个非负整数，表示 $b_{i, j}$。
## 输出格式

对于每组数据：

1. 若矩阵 $b_{i, j}$ 无法被生成，则输出一行一个字符串 `NO`。
2. 若矩阵 $b_{i, j}$ 可被生成，则先输出一行一个字符串 `YES`，接下来输出 $n$ 行每行 $m$ 个（用单个空格分隔的）大小不超过 ${10}^6$ 的非负整数表示 $a_{i, j}$。

若有多个矩阵 $a_{i, j}$ 可生成给出的 $b_{i, j}$，输出其中任意一个即可。
## 样例

### 样例输入 #1
```
3
3 3
28 25
24 25
3 3
15 14
14 12
3 3
0 3000005
0 0

```
### 样例输出 #1
```
YES
7 8 8
8 5 4
4 7 9
YES
4 2 2
5 4 6
5 0 2
NO

```
## 提示

**【数据范围】**

对于所有测试数据：$1 \le T \le 10$，$2 \le n, m \le 300$，$0 \le b_{i, j} \le 4 \times {10}^6$。

每个测试点的具体限制见下表：

| 测试点编号 | $n, m \le$ | 特殊限制 |
|:-:|:-:|:-:|
| $1 \sim 4$ | $3$ | 无 |
| $5 \sim 7$ | $10$ | $m = 2$ |
| $8 \sim 10$ | $100$ | $m = 2$ |
| $11 \sim 15$ | $300$ | $0 \le b_{i, j} \le 1$ |
| $16 \sim 20$ | $300$ | 无 |


---

---
title: "[省选联考 2021 A/B 卷] 图函数"
layout: "post"
diff: 省选/NOI-
pid: P7516
tag: ['各省省选', '2021', 'O2优化']
---
# [省选联考 2021 A/B 卷] 图函数
## 题目描述

对于一张 $n$ 个点 $m$ 条边的有向图 $G$（顶点从 $1 \sim n$ 编号），定义函数 $f(u, G)$：

1. 初始化返回值 $cnt = 0$，图 $G' = G$。
2. 从 $1$ 至 $n$ 按顺序枚举顶点 $v$，如果当前的图 $G'$ 中，从 $u$ 到 $v$ 与从 $v$ 到 $u$ 的路径都存在，则将 $cnt + 1$，并在图 $G'$ 中删去顶点 $v$ 以及与它相关的边。
3. 第 $2$ 步结束后，返回值 $cnt$ 即为函数值。

现在给定一张有向图 $G$，请你求出 $h(G) = f(1, G) + f(2, G) + \cdots + f(n, G)$ 的值。

更进一步地，记删除（按输入顺序给出的）第 $1$ 到 $i$ 条边后的图为 $G_i$（$1 \le i \le m$），请你求出所有 $h(G_i)$ 的值。
## 输入格式

第一行，两个整数 $n,m$，表示图的点数与边数。  
接下来 $m$ 行，每行两个整数，第 $i$ 行的两个整数 $x_i, y_i$ 表示一条有向边 $x_i \to y_i$。

数据保证 $x_i \neq y_i$ 且同一条边不会给出多次。
## 输出格式

输出一行 $m + 1$ 个整数，其中第一个数表示给出的完整图 $G$ 的 $h(G)$ 值。第 $i$（$2 \le i \le m + 1$）个整数表示 $h(G_{i-1})$。
## 样例

### 样例输入 #1
```
4 6
2 3
3 2
4 1
1 4
2 1
3 1

```
### 样例输出 #1
```
6 5 5 4 4 4 4

```
### 样例输入 #2
```
见附件中的 graph/graph2.in。
```
### 样例输出 #2
```
见附件中的 graph/graph2.ans。
```
## 提示

**【样例 #1 解释】**

对于给出的完整图 $G$：

1. $f(1, G) = 1$，过程中删除了顶点 $1$。
2. $f(2, G) = 1$，过程中删除了顶点 $2$。
3. $f(3, G) = 2$，过程中删除了顶点 $2, 3$。
4. $f(4, G) = 2$，过程中删除了顶点 $1, 4$。

---

**【数据范围】**

对于所有测试数据：$2 \le n \le {10}^3$，$1 \le m \le 2 \times {10}^5$，$1 \le x_i, y_i \le n$。

每个测试点的具体限制见下表：

| 测试点编号 | $n \le$ | $m\le$ |
|:-:|:-:|:-:|
| $1 \sim 4$ | $10$ | $10$ |
| $5 \sim 11$ | $100$ | $2 \times {10}^3$ |
| $12 \sim 20$ | ${10}^3$ | $5 \times {10}^3$ |
| $21 \sim 25$ | ${10}^3$ | $2 \times {10}^5$ |


---

---
title: "[省选联考 2021 A/B 卷]  宝石"
layout: "post"
diff: 省选/NOI-
pid: P7518
tag: ['倍增', '二分', '各省省选', '2021', '数据结构', 'O2优化', '可持久化线段树']
---
# [省选联考 2021 A/B 卷]  宝石
## 题目背景

**链的部分分官方数据有误。这里已经修改，如仍有误请反馈。**
## 题目描述

欧艾大陆上有 $n$ 座城市，城市从 $1 \sim n$ 编号，所有城市经由 $n - 1$ 条无向道路互相连通，即 $n$ 座城市与 $n - 1$ 条道路构成了一棵树。

每座城市的集市上都会出售宝石，总共有 $m$ 种不同的宝石，用 $1 \sim m$ 编号。$i$ 号城市的集市出售的是第 $w_i$ 种宝石，一种宝石可能会在多座城市的集市出售。

K 神有一个宝石收集器。这个宝石收集器能按照顺序收集至多 $c$ 颗宝石，其收集宝石的顺序为：$P_1, P_2, \ldots , P_c$。更具体地，收集器需要先放入第 $P_1$ 种宝石，然后才能再放入第 $P_2$ 种宝石，之后再能放入第 $P_3$ 种宝石，以此类推。其中 $P_1, P_2, \ldots , P_c$ 互不相等。

K 神到达一个城市后，如果该城市的集市上出售的宝石种类和当前收集器中需要放入的种类相同，则他可以在该城市的集市上购买一颗宝石并放入宝石收集器中；否则他只会路过该城市什么都不做。

现在 K 神给了你 $q$ 次询问，每次给出起点 $s_i$ 与终点 $t_i$，他想知道如果从 $s_i$ 号城市出发，沿最短路线走到 $t_i$ 号城市后，他的收集器中最多能收集到几个宝石？（在每次询问中，收集器内初始时没有任何宝石。起点与终点城市集市上的宝石可以尝试被收集）
## 输入格式

第一行，包含三个正整数 $n, m, c$，分别表示城市数，宝石种类数，收集器的容量。  
第二行，包含 $c$ 个正整数 $P_i$。数据保证 $1 \le P_i \le m$ 且这些数互不相等。  
第三行，包含 $n$ 个正整数 $w_i$，表示每个城市集市上出售的宝石种类。  
接下来 $n - 1$ 行，每行两个正整数 $u_i, v_i$，表示一条连接 $u_i$ 和 $v_i$ 号城市的道路。  
接下来一行，包含一个正整数 $q$，表示询问次数。  
接下来 $q$ 行，每行两个正整数 $s_i, t_i$，表示该次询问的起点与终点。
## 输出格式

按输入顺序输出 $q$ 行，每行一个整数，表示询问的答案。
## 样例

### 样例输入 #1
```
7 3 3
2 3 1
2 1 3 3 2 1 3
1 2
2 3
1 4
4 5
4 6
6 7
5
3 5
1 3
7 3
5 7
7 5

```
### 样例输出 #1
```
2
2
2
3
1

```
### 样例输入 #2
```
见附件中的 gem/gem2.in
```
### 样例输出 #2
```
见附件中的 gem/gem2.ans
```
### 样例输入 #3
```
见附件中的 gem/gem3.in
```
### 样例输出 #3
```
见附件中的 gem/gem3.ans
```
## 提示

**【数据范围】**

对于所有测试数据：$1 \le n, q \le 2 \times {10}^5$，$1 \le c \le m \le 5 \times {10}^4$，$1 \le w_i \le m$。

每个测试点的具体限制见下表：

| 测试点编号 | $n, q \le$ | 特殊限制 |
|:-:|:-:|:-:|
| $1 \sim 2$ | $10$ | 无 |
| $3 \sim 5$ | $1000$ | 无 |
| $6 \sim 10$ | $2 \times {10}^5$ | $m \le 300$ |
| $11 \sim 14$ | $2 \times {10}^5$ | $u_i = i$，$v_i = i + 1$ |
| $15 \sim 20$ | $2 \times {10}^5$ | 无 |


---

---
title: "[省选联考 2021 A/B 卷] 滚榜"
layout: "post"
diff: 省选/NOI-
pid: P7519
tag: ['各省省选', '2021', 'O2优化']
---
# [省选联考 2021 A/B 卷] 滚榜
## 题目描述

封榜是 ICPC 系列竞赛中的一个特色机制。ICPC 竞赛是实时反馈提交结果的程序设计竞赛，参赛选手与场外观众可以通过排行榜实时查看每个参赛队伍的过题数与排名。竞赛的最后一小时会进行“封榜”，即排行榜上将隐藏最后一小时内的提交的结果。赛后通过滚榜环节将最后一小时的结果（即每只队伍最后一小时的过题数）公布。

Alice 围观了一场 ICPC 竞赛的滚榜环节。本次竞赛共有 $n$ 支队伍参赛，队伍从 $1 \sim n$ 编号，$i$ 号队伍在封榜前通过的题数为 $a_i$。排行榜上队伍按照过题数从大到小进行排名，若两支队伍过题数相同，则编号小的队伍排名靠前。

滚榜时主办方以 $b_i$ 不降的顺序依次公布了每支队伍在封榜后的过题数 $b_i$（最终该队伍总过题数为 $a_i + b_i$），并且每公布一支队伍的结果，排行榜上就会实时更新排名。Alice 并不记得队伍被公布的顺序，也不记得最终排行榜上的排名情况，只记得每次公布后，本次被公布结果的队伍都成为了新排行榜上的第一名，以及所有队伍在封榜后一共通过了 $m$ 道题（即 $\sum_{i = 1}^{n} b_i = m$）。

现在 Alice 想请你帮她算算，最终排行榜上队伍的排名情况可能有多少种。
## 输入格式

第一行，包含两个正整数 $n, m$，表示队伍数量与它们封榜后的总过题数。  
第二行，包含 $n$ 个正整数，表示 $a_i$。
## 输出格式

仅一行，一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 6
1 2 1

```
### 样例输出 #1
```
5

```
### 样例输入 #2
```
6 50
4 7 9 3 0 3

```
### 样例输出 #2
```
96
```
### 样例输入 #3
```
11 300
6 8 8 12 0 11 6 1 0 15 5

```
### 样例输出 #3
```
30140983

```
## 提示

**【样例 #1 解释】**

1. 最终排名：$1, 3, 2$，滚榜情况（按公布顺序，下同）：$b_2 = 0$，$b_3 = 2$，$b_1 = 4$。

2. 最终排名：$2, 1, 3$，滚榜情况：$b_3 = 2$，$b_1 = 2$，$b_2 = 2$。

3. 最终排名：$2, 3, 1$，滚榜情况：$b_1 = 1$，$b_3 = 2$，$b_2 = 3$。

4. 最终排名：$3, 1, 2$，滚榜情况：$b_2 = 0$，$b_1 = 2$，$b_3 = 4$。

5. 最终排名：$3, 2, 1$，滚榜情况：$b_1 = 1$，$b_2 = 1$，$b_3 = 4$。

---

**【数据范围】**

对于所有测试数据：$1 \le n \le 13$，$1 \le m \le 500$，$0 \le a_i \le {10}^4$。

每个测试点的具体限制见下表：

| 测试点编号 | $n \le$ | $m \le$ |
|:-:|:-:|:-:|
| $1 \sim 2$ | $2$ | $10$ |
| $3 \sim 5$ | $3$ | $10$ |
| $6 \sim 8$ | $8$ | $100$ |
| $9 \sim 12$ | $10$ | $200$ |
| $13 \sim 16$ | $12$ | $300$ |
| $17 \sim 20$ | $13$ | $500$ |


---

---
title: "[省选联考 2021 A 卷] 支配"
layout: "post"
diff: 省选/NOI-
pid: P7520
tag: ['各省省选', '2021', 'O2优化']
---
# [省选联考 2021 A 卷] 支配
## 题目描述

给定一张 $n$ 个点 $m$ 条边的有向图 $G$，其顶点从 $1$ 到 $n$ 编号。

对于任意两个点 $u, v$，若从顶点 $1$ 出发到达顶点 $v$ 的所有路径都需要经过顶点 $u$，则称顶点 $u$ 支配顶点 $v$。特别地，每个顶点支配其自身。

对于任意一个点 $v$，我们将图中支配顶点 $v$ 的顶点集合称为 $v$ 的受支配集 $D_v$。

现在有 $q$ 次互相独立的询问，每次询问给出一条有向边，请你回答在图 $G$ 中加入该条边后，有多少个顶点的受支配集发生了变化。
## 输入格式

第一行，三个整数 $n, m, q$，分别表示图中的顶点数、边数，以及询问数。  
接下来 $m$ 行，每行两个整数 $x_i,y_i$，表示一条有向边从 $x_i$ 到 $y_i$。  
接下来 $q$ 行，每行两个整数 $s_i,t_i$，表示每次询问加入的边从 $s_i$ 到 $t_i$。

数据保证给出的图 $G$ 中，从 $1$ 号点出发能到达所有其他点，并且图中不包含重边与自环。
## 输出格式

对于每个询问，输出一行，一个整数，表示答案。
## 样例

### 样例输入 #1
```
6 6 3
1 2
1 3
3 4
4 5
2 6
4 1
5 6
3 2
2 4

```
### 样例输出 #1
```
1
0
2

```
### 样例输入 #2
```
见附件中的 dominator/dominator2.in。
```
### 样例输出 #2
```
见附件中的 dominator/dominator2.ans。
```
### 样例输入 #3
```
见附件中的 dominator/dominator3.in。
```
### 样例输出 #3
```
见附件中的 dominator/dominator3.ans。
```
## 提示

**【样例 #1 解释】**

对于原图，六个点的受支配集分别为：$D_1 = \{ 1 \}$，$D_2 = \{ 1, 2 \}$，$D_3 = \{ 1, 3 \}$，$D_4 =\{ 1, 3, 4 \}$，$D_5 = \{ 1, 3, 4, 5 \}$，$D_6 = \{ 1, 2, 6 \}$。

加入 $5 \to 6$ 后，$D_6 = \{ 1, 6 \}$，其他点受支配集不变。

加入 $3 \to 2$ 后没有点受支配集改变。

加入 $2 \to 4$ 后，$D_4 = \{ 1, 4 \}$，$D_5 = \{ 1, 4, 5 \}$，其他点受支配集不变。

---

**【数据范围】**

对于所有测试数据：$1 \le n \le 3 \times {10}^3$，$1 \le m \le 2 \times n$，$1 \le q \le 2 \times {10}^4$。

每个测试点的具体限制见下表：

| 测试点编号 | $n \le$ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 2$ | $10$ | 无 |
| $3 \sim 6$ | $100$ | $q \le 100$ |
| $7 \sim 9$ | $1000$ | $m = n - 1$ |
| $10 \sim 15$ | $1000$ | $q \le 2000$ |
| $16 \sim 20$ | $3000$ | 无 |


---

---
title: "[省选联考 2022] 填树"
layout: "post"
diff: 省选/NOI-
pid: P8290
tag: ['数学', '各省省选', '2022', 'Special Judge', 'O2优化', '树形 DP', '拉格朗日插值法']
---
# [省选联考 2022] 填树
## 题目背景

原题时限为 2s。
## 题目描述

有一棵 $n$ 个节点的无根树，刚开始树上每个节点的权值均为 $0$。KK 想对这棵树进行一些修改，他会任选一个节点作为初始的当前节点，然后重复以下动作：

1. 将当前节点 $i$ 的权值修改为一个**正整数** $x$，需满足 $l_i \leq x \leq r_i$。其中 $l_i, r_i$ 是输入中给出的两个正整数。
2. 结束修改过程，或移动到一个与当前节点相邻的权值为 $0$ 的节点（如果不存在这样的节点，则必须结束修改过程）。

现在 KK 有两个问题：

1. 在修改结束后，可以得到多少棵不同的树，满足树上**非零权值**的最大值和最小值的差小于等于 $K$？其中 $K$ 是输入中给出的一个正整数。

2. 这些满足条件的树的权值之和为多少？（树的权值定义为这棵树上所有节点的权值之和）

你需要输出这两个问题的答案模 $10^9 + 7$。我们认为两棵树不同当且仅当至少存在一个节点的权值不同。

温馨提示：

1. KK 至少会修改一个节点（初始节点）。
2. 实质上 KK 会修改树上的任意一条路径，最后需要满足这条路径上的点的权值最大值和最小值之差小于等于 $K$。
## 输入格式

第一行两个正整数 $n, K$，表示节点数和权值差的最大值。

接下来 $n$ 行，每行两个正整数 $l_i, r_i$，表示第 $i$ 个节点修改后权值的最小值和最大值。

接下来 $n - 1$ 行，每行两个正整数 $u_i, v_i$，表示节点 $u_i$ 和 $v_i$ 之间有一条边。数据保证形成一棵树。
## 输出格式

输出两行，每行一个整数，分别表示第一问和第二问的答案模 $10^9 + 7$ 的值。注意，如果你不打算回答第二问，请在第二行任意输出一个整数。如果输出文件只有一行，则可能会因格式不符合要求被判 $0$ 分。
## 样例

### 样例输入 #1
```
3 1
2 3
3 5
4 6
1 2
1 3

```
### 样例输出 #1
```
14
78

```
### 样例输入 #2
```
见附件中的 tree/tree2.in
```
### 样例输出 #2
```
见附件中的 tree/tree2.ans
```
### 样例输入 #3
```
见附件中的 tree/tree3.in
```
### 样例输出 #3
```
见附件中的 tree/tree3.ans
```
## 提示

**【样例解释 #1】**

| | $1$ | $2$ | $3$ | $4$ | $5$ | $6$ | $7$ | $8$ | $9$ | $10$ | $11$ | $12$ | $13$ | $14$ |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| 节点 $1$ | $2$ | $3$ | $2$ | $3$ | $3$ | $3$ | $3$ | $3$ | $0$ | $0$ | $0$ | $0$ | $0$ | $0$ |
| 节点 $2$ | $0$ | $0$ | $3$ | $3$ | $4$ | $0$ | $4$ | $3$ | $3$ | $4$ | $5$ | $0$ | $0$ | $0$ |
| 节点 $3$ | $0$ | $0$ | $0$ | $0$ | $0$ | $4$ | $4$ | $4$ | $0$ | $0$ | $0$ | $4$ | $5$ | $6$ |

表格中列出了全部 $14$ 棵满足条件的树，将这些树的权值加起来为 $78$。

**【数据范围】**

对于 $100\%$ 的数据，$1 \leq n \leq 200$，$1 \leq l_i \leq r_i \leq {10}^9$，$1 \leq K \leq {10}^9$。

| 测试点 | $n \leq $ | $r_i, K \leq$ | 其他限制 |
|:-:|:-:|:-:|:-:|
| $1$ | $5$ | $10$ | 无 |
| $2$ | $30$ | $10^9$ | 无 |
| $3$ | $30$ | $10^9$ | 无 |
| $4$ | $30$ | $500$ | 无 |
| $5$ | $200$ | $200000$ | 无 |
| $6$ | $200$ | $200000$ | 无 |
| $7$ | $200$ | $10^9$ | A |
| $8$ | $200$ | $10^9$ | A |
| $9$ | $200$ | $10^9$ | 无 |
| $10$ | $200$ | $10^9$ | 无 |

特殊限制 A：所有点构成一条链, 编号为 $i$ 的点和编号为 $i + 1$ 的点之间有连边

**【评分方式】**

本题共 $10$ 个测试点，每个测试点 $10$ 分。其中回答正确第一问可得 $7$ 分，回答正确第二问可得 $3$ 分。


---

---
title: "[省选联考 2022] 卡牌"
layout: "post"
diff: 省选/NOI-
pid: P8292
tag: ['各省省选', '2022', 'O2优化', '容斥原理', '快速沃尔什变换 FWT']
---
# [省选联考 2022] 卡牌
## 题目描述

小 A 有 $n$ 张卡牌，编号为 $1, 2, \ldots, n$。每张卡牌上写着一个正整数，第 $i$ 张卡牌上的正整数为 $s_i$。

现在有 $m$ 轮游戏，第 $i$ 轮游戏会给出 $c_i$ 个质数，小 A 需要选择任意多张卡牌，使得这些卡牌上面的正整数的乘积能被该轮游戏给出的每个质数整除。

这当然难不倒小 A，于是他开始思考一个更难的问题，对于每一轮游戏，他有多少种卡牌的选法。

这给小 A 整不会了，于是他只能来求助你，你只需要告诉他答案模 $998244353$ 的值即可。两种选法 A 和 B 互不相同当且仅当存在一张卡牌在 A 中被选择但在 B 中未被选择或者存在一张卡牌在 B 中被选择但在 A 中未被选择。注意：牌面上的数字相同但编号不相同的两张卡牌被视为不同的卡牌。
## 输入格式

第一行一个正整数 $n$，表示卡牌数量。

第二行 $n$ 个正整数 $s_i$，表示每张卡牌上写的数字。

第三行一个正整数 $m$，表示游戏轮数。

接下来 $m$ 行，每行第一个正整数 $c_i$，表示该轮游戏给出的质数个数，接下来 $c_i$ 个质数 $p_{i, j}$，表示该轮游戏给出的所有质数。数据保证 $\sum_i c_i \le 18000$，即所有 $c_i$ 之和不超过 $18000$。
## 输出格式

输出 $m$ 行，每行一个整数，第 $i$ 行表示第 $i$ 轮游戏的方案数模 $998244353$ 的值。
## 样例

### 样例输入 #1
```
5
10 2 10 5 46
4
2 2 5
2 2 23
1 3
1 23
```
### 样例输出 #1
```
27
16
0
16
```
### 样例输入 #2
```
见附件中的 card/card2.in
```
### 样例输出 #2
```
见附件中的 card/card2.ans
```
## 提示

**【样例解释 #1】**

第一轮游戏：除了以下 $5$ 种方案外其它方案都可行：什么都不选、选 $2$、选 $5$、选 $46$、选 $2$ 和 $46$。所以答案为 $2^5 - 5 = 27$。

第二轮游戏：只要选了 $46$，其它卡牌选不选均可，所以答案为 $2^4 = 16$。

**【数据范围】**

对于 $100 \%$ 的数据，$1 \le n \le {10}^6$，$1 \le s_i \le 2000$，$1 \le m \le 1500$，$1 \le c_i, \sum_i c_i \le 18000$，$2 \le p_{i, j} \le 2000$。

| 测试点 | $n \le$ | $m \le$ | $\sum_i c_i \le$ | 其他限制 |
|:-:|:-:|:-:|:-:|:-:|
| $1 \sim 2$ | $10$ | $10$ | $20$ | $s_i \le 30$ |
| $3 \sim 5$ | $10$ | $20$ | $50$ | 无 |
| $6 \sim 8$ | ${10}^6$ | $1500$ | $10000$ | $s_i \le 30$ |
| $9 \sim 11$ | $10000$ | $1000$ | $5000$ | $s_i \le 500$ |
| $12 \sim 13$ | $1000$ | $100$ | $1000$ | 无 |
| $14 \sim 17$ | $5000$ | $600$ | $7000$ | 无 |
| $18 \sim 20$ | ${10}^6$ | $1500$ | $18000$ | 无 |


---

---
title: "[CQOI2016] 伪光滑数 加强版"
layout: "post"
diff: 省选/NOI-
pid: P8316
tag: ['动态规划 DP', '2016', '重庆', '各省省选', '优先队列', '可并堆', '可持久化', '素数判断,质数,筛法']
---
# [CQOI2016] 伪光滑数 加强版
## 题目背景

原题链接：[P4359 [CQOI2016] 伪光滑数](https://www.luogu.com.cn/problem/P4359)
## 题目描述

若一个大于 $1$ 的整数 $m$ 的**不去重**质因数分解有 $k$ 项，其最大的质因子为 $a_k$，并且满足 $a_{k}^{k} \leq n$，$a_k \leq 397$，我们就称整数 $m$ 为 $n$ - 伪光滑数。

给定整数 $n$，求出第 $k$ 大的 $n$ - 伪光滑数。
## 输入格式

一行，两个整数 $n, k$。
## 输出格式

一行，一个整数，表示所求的值。
## 样例

### 样例输入 #1
```
12345 20
```
### 样例输出 #1
```
9167
```
## 提示

对于 $100\%$ 的数据，$1 < n \leq 10^{11}$，$k \geq 1$，保证至少有 $k$ 个满足要求的数。


---

---
title: "[ZJOI2022] 众数"
layout: "post"
diff: 省选/NOI-
pid: P8330
tag: ['各省省选', '2022', '浙江', 'O2优化', '分块', '根号分治']
---
# [ZJOI2022] 众数
## 题目描述

九条可怜是一个有超能力的女孩子，但她的超能力只能作用于一些奇怪的事情上。

有一天，可怜得到了一个序列 $a_1, a_2, \ldots, a_n$，她可以对这个序列使用一次超能力: 选择一个区
间 $[l, r]$（$1 \le l \le r \le n$）和一个整数 $k \in [-{10}^9, {10}^9]$，将区间内的所有数 $a_l, a_{l + 1}, \ldots, a_r$ 加上 $k$。

九条可怜很喜欢长得比较一致的序列，因此她希望最终的序列众数的出现次数尽可能多。给出序列 $a$，你需要输出最终序列的众数出现次数的最大值，并输出这个众数的所有可能取值。注意对于一个序列，众数的取值可能不止一个。
## 输入格式

输入包含多组数据，第一行输入数据组数 $T$。

对于接下来的每组数据，第一行输入序列长度 $n$，第二行包含 $n$ 个整数 $a_1, a_2, \ldots, a_n$。
## 输出格式

对于每组数据，第一行输出最终序列众数的出现次数的最大值。

假设这个众数有 $k$ 种不同的可能取值，则接下来 $k$ 行，从小到大输出这些取值。
## 样例

### 样例输入 #1
```
4
5
1 2 3 2 1
5
1 1 3 1 1
6
2 4 2 4 8 8
5
1 2 3 4 5

```
### 样例输出 #1
```
4
1
5
1
4
2
4
8
2
1
2
3
4
5

```
### 样例输入 #2
```
见附件中的 mode/mode_ex2.in
```
### 样例输出 #2
```
见附件中的 mode/mode_ex2.ans
```
## 提示

对于所有测试点：$1 \le T \le 20$，$2 \le n \le 2 \times {10}^5$，$1 \le a_i \le {10}^9$，保证 $\sum n \le 5 \times {10}^5$，且 $a_i$ 不全相等。

每个测试点的具体限制见下表：

| 测试点编号 | $\sum n \le$ | $n \le$ | 特殊限制 |
|:-:|:-:|:-:|:-:|
| $1 \sim 4$ | $3000$ | $300$ | 无 |
| $5 \sim 8$ | $5 \times {10}^5$ | $2 \times {10}^5$ | $a_i$ 只有 $5$ 种取值 |
| $9 \sim 10$ | $2 \times {10}^5$ | $50000$ | 无 |
| $11 \sim 20$ | $5 \times {10}^5$ | $2 \times {10}^5$ | 无 |


---

---
title: "[AHOI2022] 排列"
layout: "post"
diff: 省选/NOI-
pid: P8338
tag: ['数学', '暴力数据结构', '各省省选', '平衡树', '2022', '安徽', 'O2优化', '优先队列', '素数判断,质数,筛法']
---
# [AHOI2022] 排列
## 题目描述

对于一个长度为 $n$ 的排列 $P = (p_1, p_2, \ldots, p_n)$ 和整数 $k \ge 0$，定义 $P$ 的 $k$ 次幂

$$P^{(k)} = \left( p^{(k)}_1, p^{(k)}_2, \ldots, p^{(k)}_n \right),$$

该排列的第 $i$ 项为

$$p^{(k)}_i = \begin{cases} i, & k = 0, \\ p^{(k - 1)}_{p_i}, & k > 0. \end{cases}$$

容易证明任意排列的任意次幂都是一个排列。

定义排列 $P$ 的**循环值** $v(P)$ 为最小的**正整数** $k$ 使得 $P^{(k + 1)} = P$。

给出一个长度为 $n$ 的排列 $A = (a_1, a_2, \ldots, a_n)$，对于整数 $1 \le i, j \le n$，定义 $f(i, j)$：若存在 $k \ge 0$ 使得 $a^{(k)}_i = j$，则 $f(i, j) = 0$，否则设排列 $A_{i j}$ 为将排列 $A$ 的第 $i$ 项 $a_i$ 和第 $j$ 项 $a_j$ 交换后得到的排列，则 $f(i, j) = v(A_{i j})$。

求 $\sum_{i = 1}^{n} \sum_{j = 1}^{n} f(i, j)$ 的值。答案可能很大，你只需要输出其对 $({10}^9 + 7)$ 取模的结果。
## 输入格式

**本题有多组测试数据**。输入数据的第一行为一个整数 $T$，表示测试数据组数。

对于每组测试数据，第一行一个正整数 $n$ 表示排列的长度，接下来一行 $n$ 个整数 $a_1, a_2, \ldots, a_n$，描述输入的排列。
## 输出格式

对于每组数据输出一行一个整数，表示题目所求的答案对 $({10}^9 + 7)$ 取模的结果。
## 样例

### 样例输入 #1
```
2
3
1 2 3
3
2 3 1

```
### 样例输出 #1
```
12
0

```
## 提示

**【样例解释 #1】**

对于第一组测试数据，$f(1, 2) = f(2, 1) = f(2, 3) = f(3, 2) = f(1, 3) = f(3, 1) = 2$，其余的 $f(i, j)$ 均为 $0$。

对于第二组测试数据，所有的 $f(i, j)$ 均为 $0$。

**【样例 #2】**

见附件中的 `perm/perm2.in` 与 `perm/perm2.ans`。

该组样例中，第一个测试数据满足 $n \le 35$，前四个测试数据满足 $n \le 200$，所有测试数据满足 $n \le 2500$。

**【样例 #3】**

见附件中的 `perm/perm3.in` 与 `perm/perm3.ans`。

该组样例中，第一个测试数据满足特殊性质 A，第二个测试数据满足特殊性质 B，第三个测试数据满足特殊性质 C，前四个测试数据满足 $n \le {10}^5$，第五个测试数据满足 $n \le 5 \times {10}^5$。

特殊性质的具体内容参见数据范围部分。

**【数据范围】**

对于 $100 \%$ 的测试数据，$1 \le T \le 5$，$1 \le n \le 5 \times {10}^5$，$1 \le a_i \le n$。

| 测试点编号 | $n \le$ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 2$ | ${10}^5$ | A |
| $3$ | $35$ | 无 |
| $4$ | $200$ | 无 |
| $5$ | $2500$ | 无 |
| $6$ | ${10}^5$ | B |
| $7$ | ${10}^5$ | C |
| $8$ | ${10}^5$ | 无 |
| $9 \sim 10$ | $5 \times {10}^5$ | 无 |

特殊性质 A：$a_i = (i \bmod n) + 1$。  
特殊性质 B：对于任意 $1 \le i \le n$，存在 $1 \le k \le 20$，$a^{(k)}_i = i$。  
特殊性质 C：存在大小不超过 $10$ 的集合 $S$，使得对于任意 $1 \le i \le n$，存在 $x \in S, k \ge 0$，$a^{(k)}_x = i$。

**【提示】**

输入数据规模较大，请使用较为快速的输入方式。


---

---
title: "[AHOI2022] 钥匙"
layout: "post"
diff: 省选/NOI-
pid: P8339
tag: ['各省省选', '2022', '安徽', 'O2优化']
---
# [AHOI2022] 钥匙
## 题目描述

有 $n$ 座城市，编号为 $1, 2, \ldots, n$。这些城市由 $n - 1$ 条无向道路相连，每条无向道路连接两座城市，保证任意两个城市连通。即这 $n$ 座城市构成一棵树。

每座城市都有一件宝物。宝物分为两种：钥匙和宝箱。在一座城市里，要么有一把钥匙，要么有一个宝箱。钥匙和宝箱有不同的颜色，颜色为 $i$ 的钥匙只能打开颜色为 $i$ 的宝箱，打开宝箱后可以获得一枚金币，同时这把钥匙会损坏。

**由于某种特殊的原因，同一种的钥匙最多只有 $\bm{5}$ 把（同一种颜色的宝箱数量不限）。**

现在小 R 规划了 $m$ 次旅行，第 $i$ 次旅行的起点为 $s_i$，终点为 $e_i$。小 R 从 $s_i$ 沿最短路径走到 $e_i$。当他走到一座有钥匙的城市时，他可以将钥匙放入背包。当他走到一座有宝箱的城市时，如果他有相应颜色的钥匙，那么他就会打开这个宝箱并获得一个金币；如果他没有相应颜色的钥匙，那么他什么都不做（宝箱不能带走）。问每次旅行能获得多少枚金币。

**注意：旅行相互独立，即一次旅行完之后所有的钥匙和宝箱都会恢复到初始状态。**
## 输入格式

第一行两个正整数 $n, m$，表示城市数量和旅行数量。

接下来 $n$ 行，每行两个正整数 $t_i, c_i$，$t_i=1$ 表示第 $i$ 个城市里有一把钥匙，$t_i=2$ 表示有一个宝箱。$c_i$ 表示第 $i$ 座城市里钥匙或宝箱的颜色。数据保证每种颜色的钥匙都不超过 $5$ 把。

接下来 $n - 1$ 行，每行两个正整数 $u_i, v_i$，表示有一条连接 $u_i$ 和 $v_i$ 的无向道路。

接下来 $m$ 行，每行两个正整数 $s_i, e_i$ 表示一次旅行的起点和终点。
## 输出格式

输出 $m$ 行，每行一个整数，表示第 $i$ 次旅行能获得的金币数量。
## 样例

### 样例输入 #1
```
5 3
1 2
2 2
1 3
2 3
2 2
1 2
1 3
3 4
3 5
2 4
2 5
4 2

```
### 样例输出 #1
```
1
1
1

```
### 样例输入 #2
```
见附件中的 keys/keys2.in
```
### 样例输出 #2
```
见附件中的 keys/keys2.ans
```
### 样例输入 #3
```
见附件中的 keys/keys3.in
```
### 样例输出 #3
```
见附件中的 keys/keys3.ans
```
## 提示

**【样例 \#4】**

见附件中的 `keys/keys4.in` 与 `keys/keys4.ans`。

该组样例满足 $n, m \le {10}^5$ 和特殊性质 A。

**【数据范围】**

对于 $100 \%$ 的数据，$1 \le n \le 5 \times {10}^5$，$1 \le m \le {10}^6$，$1 \le t_i \le 2$，$1 \le c_i, u_i, v_i, s_i, e_i \le n$，每种颜色的钥匙都不超过 $5$ 把。

| 测试点编号 | $n \le$ | $m \le$ | 特殊性质 |
|:-:|:-:|:-:|:-:|
| $1$ | $100$ | $100$ | 无 |
| $2 \sim 3$ | $5000$ | $5000$ | 无 |
| $4 \sim 5$ | ${10}^5$ | ${10}^5$ | 无 |
| $6 \sim 8$ | $5 \times {10}^5$ | ${10}^6$ | A |
| $9 \sim 10$ | $5 \times {10}^5$ | ${10}^6$ | 无 |

特殊性质 A：对于每种出现过的颜色，恰有一把钥匙和一个宝箱对应该颜色。

**【提示】**

输入输出数据较大，请使用较为快速的输入输出方式。


---

---
title: "[SDOI/SXOI2022] 整数序列"
layout: "post"
diff: 省选/NOI-
pid: P8349
tag: ['各省省选', '2022', '山东', 'O2优化', '山西']
---
# [SDOI/SXOI2022] 整数序列
## 题目描述

小 D 三岁就学会了出题。

小 D 有一个正整数序列 $a_1, a_2, \dots a_n$ 和一个整数序列 $b_1, b_2, \dots ,b_n$。

小 D 有 $q$ 次查询，每次给出 $x, y$，构造一个新的序列 $c_1,c_2,\dots ,c_n$，其中 $c_i=\begin{cases}1 & a_i=x \\-1 & a_i = y \\ 0 & \text{else}\end{cases}$。

保证 $c_i$ 中至少存在一个 $1$ 与一个 $-1$。他想让你帮他找到一个区间 $[l,r]$，满足 $\sum\limits_{i = l}^r c_i = 0$，并使得 $\sum\limits_{i = l}^r b_i \times [c_i \neq 0]$ 最大，并且区间里的 $c_i$ 不能都为 $0$。你需要输出这个最大值。

注：当条件 $[P]$ 为真时，$[P]=1$，否则 $[P]=0$。
## 输入格式

第一行有两个整数 $n, q$。   
第二行有 $n$ 个整数，第 $i$ 个整数表示 $a_i$。  
第三行有 $n$ 个整数，第 $i$ 个整数表示 $b_i$。  
接下来 $q$ 行，每行两个整数 $x,y$，表示一次询问。
## 输出格式

对于每次询问，输出一行一个整数表示最大的 $\sum\limits_{i = l}^r b_i \times [c_i \neq 0]$。
## 样例

### 样例输入 #1
```
5 3
1 2 3 1 2
-2 3 2 -1 2
1 2
1 3
2 3

```
### 样例输出 #1
```
2
1
5

```
### 样例输入 #2
```
见附加样例文件中的 ex_sequence2.in
```
### 样例输出 #2
```
见附加样例文件中的 ex_sequence2.out
```
## 提示

### 数据规模与约定
本题共 $20$ 个测试点。
- 对于测试点 $1,2,3,4$，保证 $n, q ≤5000$。
- 对于测试点 $5,6$，保证 $a$ 的取值不超过 $500$ 种。
- 对于测试点 $7,8$，保证 $n \le 150000$。$q \le 500000$，$b_i>0$。
- 对于测试点 $9$，保证 $n \le 150000$，$q \le 500000$。
- 对于测试点 $10,11$，保证 $n \le 200000$，$q \le 500000$。
- 对于测试点 $12,13,14$，保证 $b_i=1$。
- 对于测试点 $15,16$，保证 $b_i>0$。

对于所有测试点，$1 \le n \le 300000$，$1 \le q \le 1000000$，$1 \le a_i \le n$，$-10^9<b_i \leq 10^9$，$1 \leq x, y \leq n$，$x \neq y$，保证对于每次查询，$c_i$ 中均至少含有一个 $1$ 与一个 $-1$。




---

---
title: "[SDOI/SXOI2022] 小 N 的独立集"
layout: "post"
diff: 省选/NOI-
pid: P8352
tag: ['各省省选', '2022', '山东', 'O2优化', '山西', 'DP 套 DP']
---
# [SDOI/SXOI2022] 小 N 的独立集
## 题目描述

小 N 喜欢出最大权独立集问题。

有一天，他接到了一系列的出题任务，于是他顺手出了一系列最大权独立集问题。

为了同时给这一系列题目造数据，小 N 生成了一个 $n$ 个点的树，并选定了一个正整数 $k$。这样每生成一组数据时，他只需要对于每个点，随机生成一个在 $1 \sim k$ 之间的整数点权，就可以生成一个新的最大独立集问题。

小 N 把这些题给了他的好朋友，小 Ω。小 Ω 表示，这些题太多太乱了，他打算把所有的 $k^n$ 道题归类处理。一个自然的想法就是按答案（也就是最大权独立集中的点的权值之和）分类，显然这些最大权独立集问题的答案一定在 $1 \sim nk$ 之间，所以小 Ω 只需要将所有题目按照答案分成 $nk$ 类进行管理就行了。

在小 N 正式开始出题之前，小 Ω 先要算出每一类题目具体有多少道。稍加估计之后小 Ω 很快意识到自己并没有《诗云》中描述的那种存储器，于是断然拒绝了小 N 关于“先把所有可能的题目造好再慢慢分类统计数量”的建议，然后悲剧地意识到自己并不会计算这些数字。

他想叫你帮他解决这个问题，还说如果你成功解决了这个问题，那么在小 N 出那些最大权独立集问题的时候，他会帮你提交一份标程代码。
## 输入格式

第一行， $2$ 个正整数 $n$, $k$。

接下来 $n-1$ 行，每行 $2$ 个正整数 $u_i$, $v_i$，描述一条连接点 $u_i$ 和 $v_i$ 的边，保证这些边构成一棵树。
## 输出格式

$nk$ 行，每行一个整数，第 $i$ 个整数表示在所有可能的题目中，最大权独立集大小为 $i$ 的有多少道，答案对 $10^9+7$ 取模。


## 样例

### 样例输入 #1
```
4 2
1 2
2 3
2 4
```
### 样例输出 #1
```
0
0
2
6
6
2
0
0
```
## 提示

**【样例解释】**

符合题意的最大权独立集题目一共有 $2^4=16$ 道。

可以证明，当点 $1$, $3$, $4$ 的权值均为 $1$ 时，最大权独立集为 $3$ ，这样的题目共有 $2$ 道；点 $1$, $3$, $4$ 的权值恰有一个为 $2$ 时，最大权独立集为 $4$ ，这样的题目共有 $6$ 道；对于最大权独立集为 $5$ 或 $6$ 的情况也是类似的。

**【数据范围】**

对于 $15 \%$ 的数据， $n \leq 8$；  
对于 $30 \%$ 的数据， $n \leq 30$；  
对于 $50 \%$ 的数据， $n \leq 100$；  
对于另外 $10 \%$ 的数据， $k=1$；  
对于另外 $15 \%$ 的数据， $k=2$；  
对于 $100 \%$ 的数据， $n \leq 1000$，$k \leq 5$，$u_{i}, v_{i} \leq n$。

**【提示】**

最大权独立集问题是指：选择一个点集，使得任意两个被选择的点都没有边直接相连，并且使得所有被选择的点的点权之和最大。



---

---
title: "[SNOI2022] 军队"
layout: "post"
diff: 省选/NOI-
pid: P8360
tag: ['各省省选', '2022', 'O2优化', '陕西']
---
# [SNOI2022] 军队
## 题目描述

R 国的历史非常悠久。

R 国有 $n$ 个城市，国内有 $C$ 个党派，分别记为 $1,2,\dots,C$。由于 R 国的版图非常长，这 $n$ 个城市的位置可以近似为坐标轴上的 $n$ 个点。在历史的最初，记载了第 $i$ 个城市归属党派 $c_i$，城中有数量为 $a_i$ 的军队。

R 国的历史上，经常发生以下三种事件：

1. 党派 $y$ 进行了一次游说，使城市 $l$ 到城市 $r$ 的所有归属党派 $x$ 的城市全部归属了 $y$。

2. 党派 $x$ 进行了一次征兵，使城市 $l$ 到城市 $r$ 的所有归属党派 $x$ 的城市中的军队数量增加了 $v$。

3. 城市 $l$ 到城市 $r$ 之间的所有城市爆发了战争。这场战争的规模可以描述为两地之间的所有城市中的军队数量之和。注意战争不一定发生在不同党派之间，归属同一个党派的一些城市内部也可能发生内战。由于 R 国的医护系统足够先进，战争不会造成军队数量的减少。

小 N 是一个喜欢历史的女孩子，最近她想整理一下 R 国的战争史，特别是每场战争的规模。但是由于 R 国的历史实在太长了，她用纸和笔进行运算实在力不从心。于是她找到了你，希望你写一个程序，统计出 R 国历史上所有战争的规模。
## 输入格式

输入的第一行是三个正整数 $n,q,C$，分别表示城市的个数，事件的个数，和 R 国国内党派的个数。

接下来一行有 $n$ 个正整数 $a_1,a_2,\dots,a_n$，表示每个城市内初始的军队数。

接下来一行有 $n$ 个正整数 $c_1,c_2,\dots,c_n$，表示每个城市初始归属的党派。

接下来 $q$ 行，每行 $3$ 到 $5$ 个正整数，表示一次事件：

第一个正整数 $\mathit{op}$ 表示事件的类型。$\mathit{op}=1,2,3$ 分别表示【题目描述】中所述的游说，征兵和战争事件。

对于每个游说事件，接下来有 $4$ 个正整数 $l,r,x,y$，意义见【题目描述】。

对于每个征兵事件，接下来有 $4$ 个正整数 $l,r,x,v$，意义见【题目描述】。

对于每个战争事件，接下来有 $2$ 个正整数 $l,r$，意义见【题目描述】。
## 输出格式

对于每个战争事件，输出一行一个整数，表示此次战争的规模。
## 样例

### 样例输入 #1
```
5 7 3
1 2 4 8 16
1 2 3 2 3
2 2 4 2 32
3 1 4
1 1 5 3 1
2 2 5 1 64
3 2 4
2 1 3 3 128
3 3 5

```
### 样例输出 #1
```
79
142
188

```
### 样例输入 #2
```
样例 2 见附件 military2.in
本组数据满足测试点 4 的限制。
```
### 样例输出 #2
```
样例 2 见附件 military2.ans
```
### 样例输入 #3
```
样例 3 见附件 military3.in
本组数据满足测试点 14 的限制。
```
### 样例输出 #3
```
样例 3 见附件 military3.ans
```
### 样例输入 #4
```
样例 4 见附件 military4.in
本组数据满足测试点 18 的限制。
```
### 样例输出 #4
```
样例 4 见附件 military4.ans
```
## 提示

**【样例 1 解释】**

最初，五个城市的军队数量分别为 $1, 2, 4, 8, 16$，归属的党派分别为 $1, 2, 3, 2, 3$。

发生的事件依次为：
- 党派 $2$ 尝试在城市 $2, 3, 4$ 征兵，归属党派 $2$ 的城市 $2, 4$ 各增加了 $32$ 军队。
- 城市 $1$ 和 $4$ 之间的所有城市爆发了战争，规模为 $1 + 34 + 4 + 40 = 79$。
- 党派 $1$ 在城市 $1, 2, 3, 4, 5$ 进行了一次游说，使得原本归属党派 $3$ 的城市 $3, 5$ 归属了党派 $1$。
- 党派 $1$ 尝试在城市 $2, 3, 4, 5$ 征兵，归属党派 $1$ 的城市 $3, 5$ 各增加了 $64$ 军队。
- 城市 $2$ 和 $4$ 之间的所有城市爆发了战争，规模为 $34 + 68 + 40 = 142$。
- 党派 $3$ 尝试在城市 $1, 2, 3$ 征兵，但是党派 $3$ 现在不拥有任何城市，因此并没有成功征兵。
- 城市 $3$ 和 $5$ 之间的所有城市爆发了战争，规模为 $68 + 40 + 80 = 188$。

因此你的程序应该依次输出 $79, 142, 188$。

**【数据规模与约定】**

对于全部数据，$1 \leq n, q\leq 2.5 \times 10^5$，$1 \leq a_i, v \leq 10^8$，$1 \leq c_i, x, y \leq C$。

具体的数据规模与约定见下表。

| 测试点编号 |    $n,q\leq $     |     $C\leq $      |               特殊约定               |
| :--------: | :---------------: | :---------------: | :----------------------------------: |
|    $1$     |       $20$        |       $20$        |                                      |
|    $2$     |       $50$        |       $50$        |                                      |
|    $3$     |       $300$       |       $300$       |                                      |
|    $4$     |      $5000$       |      $5000$       |                                      |
|    $5$     |      $10^5$       |       $10$        |                                      |
|    $6$     | $1.5 \times 10^5$ |       $10$        |                                      |
|    $7$     |  $2 \times 10^5$  |       $10$        |                                      |
|    $8$     | $2.5 \times 10^5$ |       $10$        |                                      |
|    $9$     | $1.5 \times 10^5$ | $1.5 \times 10^5$ |    对于所有操作，保证 $l=1,r=n$。    |
|    $10$    | $2.5 \times 10^5$ | $2.5 \times 10^5$ |    对于所有操作，保证 $l=1,r=n$。    |
|    $11$    | $1.5 \times 10^5$ | $1.5 \times 10^5$ | 对于所有操作 $1,2$，保证 $l=1,r=n$。 |
|    $12$    |  $2 \times 10^5$  |  $2 \times 10^5$  | 对于所有操作 $1,2$，保证 $l=1,r=n$。 |
|    $13$    | $2.5 \times 10^5$ | $2.5 \times 10^5$ | 对于所有操作 $1,2$，保证 $l=1,r=n$。 |
|    $14$    | $1.5 \times 10^5$ | $1.5 \times 10^5$ |         保证不存在操作 $1$。         |
|    $15$    | $2.5 \times 10^5$ | $2.5 \times 10^5$ |         保证不存在操作 $1$。         |
|    $16$    |      $10^5$       |      $10^5$       |                                      |
|    $17$    | $1.5 \times 10^5$ | $1.5 \times 10^5$ |                                      |
|    $18$    |  $2 \times 10^5$  |  $2\times 10^5$   |                                      |
|    $19$    | $2.5 \times 10^5$ | $2.5 \times 10^5$ |                                      |
|    $20$    | $2.5 \times 10^5$ | $2.5 \times 10^5$ |                                      |


---

---
title: "[SNOI2022] 倍增"
layout: "post"
diff: 省选/NOI-
pid: P8361
tag: ['各省省选', '2022', 'Special Judge', 'O2优化', '陕西']
---
# [SNOI2022] 倍增
## 题目描述

小 Z 是一个喜欢编程的女孩子。

这天，她在做一道编程题的时候偶然发现了一个神奇的整数 $142857$。

$142857 \times 2 = 285714$，而 $285714$ 的所有数位恰好是 $142857$ 的一个排列。

她很好奇，有没有更大的满足这种性质的整数。

她写了一个搜索，发现了一些更大的有趣的数：

$26835741 \times 2 = 53671482$

$0987312654 \times 2 = 1974625308$

$\dots$

她不满足于解决十进制下这样的问题，于是她想知道，是否在 $B$ 进制下存在一个 $n$ 位正整数 $x$，满足 $2x$ 的所有数位在 $B$ 进制下是 $x$ 的所有数位的一个排列。

由于她讨厌数字 $0$，因此她还要求对于任意 $1 \leq i \leq n$，$x$ 和 $2x$ 在 $B$ 进制下的第 $i$ 位不能同时为 $0$。
## 输入格式

**输入包含多组数据。**

输入的第一行是一个正整数 $T$，表示数据组数。

接下来 $T$ 行，第 $i$ 行包含两个正整数 $n$ 和 $B$，表示第 $i$ 组数据。
## 输出格式

对于每组数据，输出一行。

若本组数据有解，按照从高位到低位的顺序输出 $n$ 个非负整数，表示你找到的答案在 $B$ 进制下的值。

否则只需要输出一个数 $-1$。
## 样例

### 样例输入 #1
```
3
6 10
3 3
6 7

```
### 样例输出 #1
```
1 4 2 8 5 7
-1
0 3 5 3 1 6
```
### 样例输入 #2
```
样例 2 见附件 double2.in
本组数据满足测试点 3 的限制。
```
### 样例输出 #2
```
样例 2 见附件 double2.ans
```
### 样例输入 #3
```
样例 3 见附件 double3.in
本组数据满足测试点 17 的限制。
```
### 样例输出 #3
```
样例 3 见附件 double3.ans
```
## 提示

**【样例 1 解释】**

- 第一组数据的解释参见【题目描述】。
- 对于第二组数据，可以通过枚举所有的 $n$ 位 $B$ 进制数说明一定不能找到这样的正整数。
- 对于第三组数据，$2x$ 的 $7$ 进制表示为 $103635_{(7)}$，因此这是一个满足题意的答案。

注意此样例的答案文件仅表明了一种可能的合法答案，不表明答案文件恰好对应标准程序的输出。

**【样例 2/3 解释】**

注意此样例的答案文件仅表明了一种可能的合法答案，不表明答案文件恰好对应标准程序的输出。

**【提示】**

由于答案可能不唯一，我们下发了校验器 `checker.cpp` 和库文件 `testlib.h`。

可以使用以下命令编译 `checker.cpp`：

```
g++ -o checker checker.cpp -O2 -std=c++11
```

将 `checker.cpp` 编译得到可执行文件 `checker` 后你可以使用以下方式测试你的答案：

`checker <input> <output> <answer>`：利用选手目录下的 `double/double*.ans` 可以用来检验你的答案在样例测试点 `double/double*.in` 的正确性。

`checker <input> <output> <output>`：会检查你的所有有解输出是否符合题目要求。注意以此种方式测试的时候，输出无解总会被报告为合法，因为在此种运行方式下我们只会检查你报告的所有解。

**请选手注意多组数据之间的清空问题。**

**【数据规模与约定】**

对于全部数据，$1 \leq T \leq 10^4$，$2 \leq \sum B \leq 2 \times 10^5$，$1 \leq \sum n \leq 2 \times 10^5$，$n \geq 1$，$B \geq 2$。

具体的数据规模与约定见下表。

| 测试点编号 |    $n \leq$     |    $ B \leq$    | $T \leq$ | 特殊约定            |
| :--------: | :-------------: | :-------------: | :------: | ------------------- |
|    $1$     |       $8$       |       $8$       |   $10$   |                     |
|    $2$     |       $8$       |       $8$       |  $10^4$  |                     |
|    $3$     | $2 \times 10^5$ |       $8$       |   $10$   |                     |
|    $4$     | $2 \times 10^5$ |       $8$       |  $10^4$  |                     |
|    $5$     | $2 \times 10^5$ |       $8$       |  $10^4$  |                     |
|    $6$     |      $15$       |      $15$       |  $100$   |                     |
|    $7$     |      $40$       |      $40$       |  $100$   |                     |
|    $8$     |      $100$      |      $100$      |  $100$   |                     |
|    $9$     |      $300$      |      $300$      |  $100$   |                     |
|    $10$    |     $1000$      |     $1000$      |  $100$   |                     |
|    $11$    |     $3000$      |     $3000$      |  $100$   |                     |
|    $12$    |     $15000$     |     $15000$     |  $100$   |                     |
|    $13$    |     $50000$     |     $50000$     |  $100$   |                     |
|    $14$    | $2 \times 10^5$ | $2 \times 10^5$ |  $100$   |                     |
|    $15$    |      $200$      |      $200$      |  $10^4$  | $n \geq 100$        |
|    $16$    |     $5000$      |     $5000$      |  $10^4$  | $n \geq 100$        |
|    $17$    | $2 \times 10^5$ | $2 \times 10^5$ |  $10^4$  | $n \geq 100$        |
|    $18$    |      $300$      |      $300$      |  $10^4$  | $B=3k-1,k \in \N^*$ |
|    $19$    | $2 \times 10^5$ | $2 \times 10^5$ |  $10^4$  | $B=3k-1,k \in \N^*$ |
|    $20$    |      $300$      |      $300$      |  $10^4$  | $B=3k,k \in \N^*$   |
|    $21$    | $2 \times 10^5$ | $2 \times 10^5$ |  $10^4$  | $B=3k,k \in \N^*$   |
|    $22$    |      $100$      |      $100$      |  $10^4$  |                     |
|    $23$    |      $500$      |     $5000$      |  $10^4$  |                     |
|    $24$    | $2 \times 10^5$ | $2 \times 10^5$ |  $10^4$  |                     |
|    $25$    | $2 \times 10^5$ | $2 \times 10^5$ |  $10^4$  |                     |



---

---
title: "[省选联考 2023] 城市建造"
layout: "post"
diff: 省选/NOI-
pid: P9167
tag: ['各省省选', '2023', 'O2优化']
---
# [省选联考 2023] 城市建造
## 题目描述

在这个国度里面有 $n$ 座城市，一开始城市之间修有若干条双向道路，导致这些城市形成了 $t \ge 2$ 个连通块，特别的，这些连通块之间两两大小差的绝对值不超过 $0 \le k \le 1$。为了方便城市建设与发展，$n$ 座城市中的某 $t$ 座城市**在这 $t$ 座城市之间**额外修建了至少一条双向道路，使得所有城市连通。

现在已经知道额外修建后的所有道路，你需要算出有哪些双向道路集合 $E'$，满足这些道路有可能是后来额外修建的，请输出答案对 $998,244,353$ 取模的结果。

即给定一张 $n$ 个点 $m$ 条边的**无向连通**图 $G = (V, E)$，询问有多少该图的子图 $G' = (V', E')$，满足 $E' \ne \varnothing$ 且 $G - E'$ 中恰好有 $|V'|$ 个连通块，且任意两个连通块大小之差不超过 $k$，保证 $0 \le k \le 1$，请输出答案对 $998,244,353$ 取模的结果。

## 输入格式

输入的第一行包含三个正整数 $n, m, k$，分别表示城市数、修建后的道路数以及任意两个连通块大小之差的上限。

接下来 $m$ 行每行包含两个正整数 $u, v$，表示城市 $u$ 和 $v$ 之间存在一条双向道路，保证 $u \ne v$。

## 输出格式

输出一个数表示答案对 $998,244,353$ 取模后的结果。

## 样例

### 样例输入 #1
```
4 4 1
1 2
2 3
1 3
3 4

```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
见附件中的 cities/cities2.in
```
### 样例输出 #2
```
见附件中的 cities/cities2.ans
```
### 样例输入 #3
```
见附件中的 cities/cities3.in
```
### 样例输出 #3
```
见附件中的 cities/cities3.ans
```
### 样例输入 #4
```
见附件中的 cities/cities4.in
```
### 样例输出 #4
```
见附件中的 cities/cities4.ans
```
## 提示

**【样例 1 解释】**

有以下两种情况：

- 本来只有 $(3, 4)$ 这一条道路，此时有三个连通块，分别为 $\{1\}, \{2\}, \{3, 4\}$；后来城市 $1, 2, 3$ 决定在它们三座城市中额外修建了 $(1, 2), (2, 3), (1, 3)$ 这三条道路，使得所有城市连通。
- 本来没有任何道路，此时有四个连通块，分别为 $\{1\}, \{2\}, \{3\}, \{4\}$；后来城市 $1, 2, 3, 4$ 决定在它们四座城市中额外修建了 $(1, 2), (2, 3), (1, 3), (3, 4)$ 这四条道路，使得所有城市连通。

**【数据范围】**

对于所有的数据，保证：$3 \le n \le 10^5$，$n - 1 \le m \le 2 \times 10^5$，$0 \le k \le 1$。

|测试点|$n$|$m$|$k$|
|:-:|:-:|:-:|:-:|
|1, 2|$\le 15$|$\le 20$|$= 0$|
|3 ~ 5|$\le 20$|$\le 50$|$= 1$|
|6, 7|$\le 200$|$\le 300$|$= 0$|
|8, 9|$\le 2,000$|$= n - 1$|$= 1$|
|10, 11|$\le 2,000$|$\le 3,000$|$= 0$|
|12, 13|$\le 2,000$|$\le 3,000$|$= 1$|
|14, 15|$\le 10^5$|$= n - 1$|$= 1$|
|16, 17|$\le 10^5$|$\le 2 \times 10^5$|$= 0$|
|18 ~ 20|$\le 10^5$|$\le 2 \times 10^5$|$= 1$|



---

---
title: "[省选联考 2023] 过河卒"
layout: "post"
diff: 省选/NOI-
pid: P9169
tag: ['博弈论', '各省省选', '2023', 'O2优化', '广度优先搜索 BFS', '拓扑排序']
---
# [省选联考 2023] 过河卒
## 题目背景

棋盘上有一个过河卒，需要走到底线。卒行走的规则是可以向左移动一格，向右移动一格或者向前移动一格。同时在棋盘上有两个另一方的棋子，需要拦截这个卒走到底线。这两个棋子的走法和帅一致，可以走到前后左右四个方向上相邻的格子。因此本题可以称为“帅拦过河卒”。
## 题目描述

有一个 $n$ 行 $m$ 列的棋盘。我们用 $(i,j)$ 表示第 $i$ 行第 $j$ 列的位置。棋盘上有一些 障碍，还有一个黑棋子和两个红棋子。

游戏的规则是这样的: 红方先走，黑方后走，双方轮流走棋。红方每次可以选择一个红棋子，向棋盘的相邻一格走一步。具体而言，假设红方选择的这个棋子位置在 $(i,j)$，那么它可以走到 $(i-1,j),(i+1,j),(i,j-1),(i,j+1)$ 中的一个，只要这个目的地在棋盘内且没有障碍且没有红方的另一个棋子。

黑方每次可以将自己的棋子向三个方向之一移动一格。具体地，假设这个黑棋子位置在 $(i,j)$，那么它可以走到 $(i-1,j),(i,j-1),(i,j+1)$ 这三个格子中的一个，只要这个目的地在棋盘内且没有障碍。

在一方行动之前，如果发生以下情况之一，则立即结束游戏，按照如下的规则判断胜负（列在前面的优先）：

- 黑棋子位于第一行。此时黑方胜。

- 黑棋子和其中一个红棋子在同一个位置上。此时进行上一步移动的玩家胜。

- 当前玩家不能进行任何合法操作。此时对方胜。

现在假设双方采用最优策略，不会进行不利于自己的移动。也就是说:

- 若存在必胜策略，则会选择所有必胜策略中，不论对方如何操作，本方后续获胜所需步数最大值最少的操作。
- 若不存在必胜策略，但存在不论对方如何行动，自己都不会落败的策略，则会选择任意一种不败策略。
- 若不存在不败策略，则会选择在所有策略中，不论对方如何操作，对方后续获胜所需步数最小值最大的操作。

如果在 $100^{100^{100}}$ 个回合之后仍不能分出胜负，则认为游戏平局。请求出游戏结束时双方一共移动了多少步，或者判断游戏平局。
## 输入格式

**本题有多组测试数据**。

输入的第一行包含两个整数 $\text{id},T$，分别表示测试点编号和数据组数。特别地，样例的 $\text{id}$ 为 $0$。

接下来包含 $T$ 组数据，每组数据的格式如下：

第一行包含两个正整数 $n,m$，表示棋盘的行数和列数。

接下来 $n$ 行，每行包含一个长度为 $m$ 的字符串，其中第 $i$ 行的第 $j$ 个字符表示棋盘上 $(i,j)$ 这个位置的状态。

在这些字符中：$\texttt{'.'}$ 表示空位；$\texttt{'\#'}$ 表示障碍物；$\texttt{'X'}$ 表示黑棋；$\texttt{'O'}$ 表示红棋。

保证黑棋恰好有一个，红棋恰好有两个，且黑棋不在第一行。
## 输出格式

对于每组数据，输出一行字符串。

如果游戏平局，请输出一行 $\texttt{"Tie"}$。

如果红方胜，请输出一行 $\texttt{"Red t"}$。其中 $\texttt{t}$ 为游戏结束时双方移动的步数之和。显然这应该是一个奇数。

如果黑方胜，请输出一行 $\texttt{"Black t"}$。其中 $\texttt{t}$ 为游戏结束时双方移动的步数之和。显然这应该是一个偶数。

注意，请输出双引号内的字符串，不包含双引号。
## 样例

### 样例输入 #1
```
0 5
4 5
...#O
.#..#
#O#..
.#..X
3 3
#.#
O.O
.X.
3 3
O..
.#X
.O.
5 5
.....
.....
..O..
#..#.
O#.X.
9 9
...######
.#.......
.#######.
.#.#.....
.#O#.####
.#.#.....
.#######.
.#X......
.O.......

```
### 样例输出 #1
```
Black 0
Black 2
Black 2
Tie
Red 75

```
### 样例输入 #2
```
见附件中的 zu/zu2.in
```
### 样例输出 #2
```
见附件中的 zu/zu2.ans
```
## 提示

**【样例 1 解释】**

第一组数据，红方第一步没有可行的移动，所以黑方胜。

第二组数据，无论第一步红方怎么移动，黑方都可以在下一步让黑棋子与红棋子在同一个位置。

第三组数据，无论第一步红方怎么移动，黑方都可以将自己的棋子往上移动一枚来达成胜利。

第四组数据，有一个红棋子不能动。另一个红棋子可以在第三行移动来防止黑棋子进入第一行。黑棋子也可以一直在第五行移动。如果红棋子到达第五行，黑棋子可以选择从另一边逃走。

第五组数据，在最后一行的那个红棋子可以从左边绕一圈抓住黑棋子。注意另一个红棋子可以移动。

**【样例 2 解释】**

这个样例中的每一组数据都满足测试点 $5$ 到 $13$ 中某一个测试点的限制。

**【子任务】**

对于所有的数据，保证：$1 \leq T \leq 10$，$2 \leq n \leq 10$，$1 \leq m \leq 10$，$\text{id}$ 等于测试点编号。

对于每组数据保证：棋盘上的黑棋恰好有一个，红棋恰好有两个，且黑棋不在第一 行。

- 测试点 $1 \sim 4$：保证要么平局，要么红方在开始时无法移动。

- 测试点 $5 \sim 6$：保证 $n \geq 4$ 。保证棋盘上第 $n-1$ 行的每一个格子都是障碍物，且 棋盘上其他行没有障碍物。保证黑棋在前 $n-2$ 行，有一个红棋在前 $n-2$ 行，另一个红棋在第 $n$ 行。

- 测试点 $7 \sim 9$：保证 $m=1$。

- 测试点 $10 \sim 13$：保证要么平局，要么存在策略可以在 $9$ 步之内结束游戏。

- 测试点 $14 \sim 20$：无特殊限制。


---


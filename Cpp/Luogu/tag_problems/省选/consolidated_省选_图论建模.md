---
title: "「CMOI R1」We Want To Run / Nilpotent"
layout: "post"
diff: 省选/NOI-
pid: P11173
tag: ['动态规划 DP', '数学', '2024', '洛谷原创', 'O2优化', '动态规划优化', '图论建模', '线性代数']
---
# 「CMOI R1」We Want To Run / Nilpotent
## 题目背景

![](bilibili:BV1qW4y1Q7Ce)

$\small\color{white}54^{\text{th}}\text{Problem by ArCu}.$
## 题目描述

对于 $n\times n$ 矩阵 $A$，定义 $f(A)$ 为最小的满足 $A^b=O$ 的正整数 $b$，若不存在这样的数则 $f(A)=0$。其中 $O$ 是零矩阵，即所有元素都是 $0$ 的矩阵。

给定 $n,a$，每个元素都是 $[0,a)$ 中整数的 $n\times n$ 矩阵有 $a^{n^2}$ 种。对所有 $a^{n^2}$ 种可能的矩阵 $A$ 求 $f(A)$ 之和。

答案对 $202407031$ 取模。
## 输入格式

一行两个整数 $n,a(1\leq n\leq 600,0<a<2^{64})$。
## 输出格式

一行一个整数，表示你求得的答案。
## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
3 4
```
### 样例输出 #2
```
793
```
### 样例输入 #3
```
5 10
```
### 样例输出 #3
```
59350891
```
### 样例输入 #4
```
18 15932416
```
### 样例输出 #4
```
52138206
```
### 样例输入 #5
```
1 1
```
### 样例输出 #5
```
1
```
## 提示

$\text{Sample 1 Explanation}:$

注意到对于任意正整数 $b$，$\begin{bmatrix}1&0\\1&1\end{bmatrix}^b\neq O$，所以 $f\left(\begin{bmatrix}1&0\\1&1\end{bmatrix}\right)=0$。而 $\begin{bmatrix}0&0\\1&0\end{bmatrix}^2=O$，所以 $f\left(\begin{bmatrix}0&0\\1&0\end{bmatrix}\right)=2$。

一共有 $2^4=16$ 种可能的矩阵。其中 $f(A)$ 不为 $0$ 的只有

$$f\left(\begin{bmatrix}0&0\\0&0\end{bmatrix}\right)=1,f\left(\begin{bmatrix}0&0\\1&0\end{bmatrix}\right)=f\left(\begin{bmatrix}0&1\\0&0\end{bmatrix}\right)=2$$

答案即为 $1+2+2=5$。

$\text{Details of Subtasks}:$

所有数据满足 $1\leq n\leq 600,0<a<2^{64}$。

| $\text{Subtask}$ | $\text{Special Constraints}$ | $\text{Score}$ |
| :----------: | :----------: | :----------: | 
| $1$ | $n\leq 5,a\leq 2$ | $3$ |
| $2$ | $n\leq 5$ | $7$ | 
| $3$ | $n\leq 10$ | $10$ | 
| $4$ | $n\leq 40$ | $20$ | 
| $5$ | $n\leq 200$ | $30$ |
| $6$ |  | $30$ |

$\text{Hint}:202407031=13009\times 15559.$


---

---
title: "[PA 2016] 任务排序 /  Szeregowanie zadań"
layout: "post"
diff: 省选/NOI-
pid: P11614
tag: ['2016', '网络流', '图论建模', 'PA（波兰）']
---
# [PA 2016] 任务排序 /  Szeregowanie zadań
## 题目背景


译自 [Potyczki Algorytmiczne 2016](https://sio2.mimuw.edu.pl/c/pa-2016-1/p/) R5 Szeregowanie zadań [B] (SZE)。
## 题目描述


有 $n$ 个任务，编号 $1\sim n$。任务 $i$ 有三个参数 $p_i,c_i,k_i$，含义为：
- 这个任务必须在时刻 $p_i$（或者 $p_i$ 之后）开始执行；
- 这个任务需要 $c_i$ 单位时间；（意思是，它需要在处理器上运行的总时间为 $c_i$）
- 这个任务必须在时刻 $k_i$（或者 $k_i$ 之前）完成。

有 $m$ 个处理器用来执行任务。

一个处理器同一时间只能处理一个任务，一个任务同一时间只能在一个处理器上被处理。每个任务可以在处理时被中断任意次，可以在任意时刻（不一定是整数时刻）被中断，在中断后可以分配给另一个处理器处理。

是否存在一种策略可以满足所有要求？
## 输入格式


第一行两个正整数 $n,m$。

接下来 $n$ 行，每行三个整数 $p_i,k_i,c_i$，描述一个任务。

## 输出格式

如果存在，输出一行一个 $\texttt{TAK}$；否则输出一行一个 $\texttt{NIE}$。

## 样例

### 样例输入 #1
```
3 2
3 8 3
2 5 2
3 7 3
```
### 样例输出 #1
```
TAK
```
### 样例输入 #2
```
2 1
0 1 1
0 1 1
```
### 样例输出 #2
```
NIE
```
## 提示


- $1\le n,m\le 100$；
- $0\le p_i\lt k_i\le 10^6$；
- $1\le c_i\le k_i-p_i$。


---

---
title: "[PA 2019 Final] 摆棋 / Pionki"
layout: "post"
diff: 省选/NOI-
pid: P11816
tag: ['动态规划 DP', '2019', '图论建模', 'PA（波兰）', '最大流最小割定理']
---
# [PA 2019 Final] 摆棋 / Pionki
## 题目背景

译自 PA 2019 Final。


本题数据为自造。

std：zimpha，validator：Starrykiller，generator：Wuyanru & Starrykiller。
## 题目描述

给定一个 $A\times B\times C$ 的立体棋盘。每个格子可以用三元组 $(i,j,k)$ 描述，其中 $1\le i\le A$，$1\le j\le B$，$1\le k\le C$。

起初，$(i,j,k)$ 上有 $a_{i,j,k}$ 个棋子。

每次操作，可以选择一个格子 $(i,j,k)$，满足 $(i,j,k)$ 上至少有一个棋子，然后将这枚棋子移动到 $(i+1,j,k)$ 或 $(i,j+1,k)$ 或 $(i,j,k+1)$ 中的一个。棋子不能移出棋盘边界。

目标是让 $(i,j,k)$ 上有 $b_{i,j,k}$ 个棋子。判断是否能够达成目标。



## 输入格式

**本题单个测试点内有多组测试数据。**

第一行，一个正整数 $T$，表示测试数据组数。接下来依次描述 $T$ 组数据。

每组数据第一行，三个正整数 $A,B,C$。

接下来 $A$ 块，每块包含 $B$ 行，每行 $C$ 个非负整数。第 $i$ 块第 $j$ 行第 $k$ 个数即为 $a_{i,j,k}$。


接下来 $A$ 块，每块包含 $B$ 行，每行 $C$ 个非负整数。第 $i$ 块第 $j$ 行第 $k$ 个数即为 $b_{i,j,k}$。

对于这 $2A$ 块，每两个块之间由一个空行隔开（所以每组测试数据有 $(2A-1)$ 行空行）。
## 输出格式

对于每组测试数据输出一行：

如果可以达成目标，输出 $\texttt{TAK}$；否则输出 $\texttt{NIE}$。
## 样例

### 样例输入 #1
```
2
2 3 4
2 0 0 1
0 0 1 0
1 0 0 0

0 1 0 0
1 0 0 0
0 0 0 0

0 0 1 0
0 1 0 0
0 0 0 0

1 0 0 0
0 0 0 0
0 0 0 4
2 2 2
2 2
2 1

2 1
1 1

1 1
1 2

1 2
2 2
```
### 样例输出 #1
```
NIE
TAK
```
## 提示

- $1\le T\le 10^4$；
- $1\le A,\sum A\le 10^4$；
- $1\le B,C\le 6$；
- $0\le a_{i,j,k},b_{i,j,k}\le 10^{12}$；
- $\sum a_{i,j,k}=\sum b_{i,j,k}$。




---

---
title: "[蓝桥杯 2025 国 A] 连锁反应【数据强度待检验】"
layout: "post"
diff: 省选/NOI-
pid: P12845
tag: ['图论', '贪心', '线段树', '2025', '图论建模', '强连通分量', '蓝桥杯国赛']
---
# [蓝桥杯 2025 国 A] 连锁反应【数据强度待检验】
## 题目背景

数据强度可能较弱，可能会不定期更新。
## 题目描述

小蓝在数轴上放置了 $n$ 枚炸弹，第 $i$ 枚炸弹的位置为 $p_i$，其爆炸范围为 $[p_i - l_i, p_i + r_i]$。当一枚炸弹爆炸时，其范围内的所有其他未爆炸的炸弹均会被引爆。小蓝希望知道至少需要主动引爆多少枚炸弹，才能使得所有炸弹都爆炸。

## 输入格式

输入的第一行包含一个正整数 $n$。

接下来 $n$ 行，每行包含三个整数 $p_i, l_i, r_i$，相邻整数之间使用一个空格分隔。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
5
3 1 1
1 0 2
6 2 1
9 4 2
10 1 1

```
### 样例输出 #1
```
2
```
## 提示

**【样例说明】**

主动引爆炸弹 $2, 4$，即可引爆所有炸弹。

**【评测用例规模与约定】**

对于 20% 的评测用例，$1 \leq n \leq 2000$；

对于另外 20% 的评测用例，$l_i = 0$；

对于所有评测用例，$1 \leq n \leq 200000$，$0 \leq p_i, l_i, r_i \leq 10^5$。


---

---
title: "麻将 加强加强版"
layout: "post"
diff: 省选/NOI-
pid: P1820
tag: ['动态规划 DP', '图论建模', '有限状态自动机']
---
# 麻将 加强加强版
## 题目背景

此题为 [P4050](/problem/P4050) 与 [P6454](/problem/P6454) 的加强版。

小 A 喜欢打麻将。
## 题目描述

小 A 找到了一副奇怪的麻将牌：只有一种 $1,2,\cdots,n$ 的数牌，且每种牌都有**无穷多张**。

定义「雀头」为两张一样的牌（如 $2,2$，$7,7$），「刻子」为三张一样的牌（如 $1,1,1$，$4,4,4$），「顺子」为三张序数相邻的牌（如 $1,2,3$，$9,10,11$，注意 $1$ 与 $n$ 不相邻）。「顺子」与「刻子」统称「面子」。

假如你能把你的手牌分为若干组「面子」（**可以相同**）以及一组「雀头」，那么你就可以「和牌」。

假如某副手牌加上某张牌后可以「和牌」，则称这副手牌「听」这张牌。

现在小 A 随意摸了 $k$ 张牌，他想知道他「听」哪些牌。
## 输入格式

第一行两个正整数 $n,k$，分别表示牌的范围和小 A 手上牌的张数。

接下来一行 $k$ 个整数 $a_1,a_2,\cdots,a_k$ 给出小 A 的手牌，每个数表示小 Z 手上的一张牌。
## 输出格式

第一行若干个正整数，表示小 A「听」哪些牌。**请按照升序输出。**

特殊地，如果小 A 不「听」任何牌，请输出 `QAQ`。
## 样例

### 样例输入 #1
```
4 4
1 2 3 4
```
### 样例输出 #1
```
1 4
```
### 样例输入 #2
```
9 13
1 1 1 2 3 4 5 6 7 8 9 9 9
```
### 样例输出 #2
```
1 2 3 4 5 6 7 8 9
```
### 样例输入 #3
```
2 2
1 2
```
### 样例输出 #3
```
QAQ
```
## 提示

#### 【样例解释】

- 样例一解释：两种情况，`11/234` 与 `123/44`。
- 样例二解释：此牌型为「纯正九莲宝灯」，可以「听」所有数牌。

#### 【数据范围】

**本题采用捆绑测试。**

- Subtask 1（10 pts）：$1\leq k\leq 16$。
- Subtask 2（10 pts）：$1\leq k\leq 400$。
- Subtask 3（30 pts）：$1\leq k\leq 10^3$。
- Subtask 4（30 pts）：$1\leq k\leq 3\times10^4$。
- Subtask 5（20 pts）：无特殊限制。

对于所有数据，$1\leq a_i\leq n\leq k\leq 2\times10^5$。


---

---
title: "[SCOI2008] 天平"
layout: "post"
diff: 省选/NOI-
pid: P2474
tag: ['2008', '四川', '各省省选', '图论建模', '差分约束']
---
# [SCOI2008] 天平
## 题目描述

你有 $n$ 个砝码，均为 $1$ 克，$2$ 克或者 $3$ 克。你并不清楚每个砝码的重量，但你知道其中一些砝码重量的大小关系。你把其中两个砝码 A 和 B 放在天平的左边，需要另外选出两个砝码放在天平的右边。问：有多少种选法使得天平的左边重($c_1$)、一样重($c_2$)、右边重($c_3$)？（只有结果保证唯一确定的选法才统计在内）

## 输入格式

第一行包含三个正整数 $n$, $A$, $B$（$1\le A,B\le n$, $A\neq B$）。

以下 $n$ 行包含重量关系矩阵，其中第 $i$ 行第 $j$ 个字符为加号 `+` 表示砝码 $i$ 比砝码 $j$ 重，减号 `-` 表示砝码 $i$ 比砝码 $j$ 轻，等号 `=` 表示砝码 $i$ 和砝码 $j$ 一样重，问号 `?` 表示二者的关系未知。

数据保证至少存在一种情况符合该矩阵。
## 输出格式

仅一行，包含三个整数，即 $c_1$，$c_2$ 和 $c_3$。

## 样例

### 样例输入 #1
```
6 2 5

?+????

-?+???

?-????

????+?

???-?+

????-?
```
### 样例输出 #1
```
1 4 1
```
### 样例输入 #2
```
14 8 4

?+???++?????++

-??=?=???????=

??????????=???

?=??+?==??????

???-???-???-??

-=????????????

-??=???=?-+???

???=+?=???????

??????????????

??????+???????

??=???-????-??

????+?????+???

-?????????????

-=????????????
```
### 样例输出 #2
```
18 12 11
```
## 提示

$4\le n\le 50$。



---

---
title: "[ZJOI2010] 网络扩容"
layout: "post"
diff: 省选/NOI-
pid: P2604
tag: ['2010', '各省省选', '网络流', '浙江', '图论建模', '费用流']
---
# [ZJOI2010] 网络扩容
## 题目描述

给定一张有向图，每条边都有一个容量 $c$ 和一个扩容费用 $w$。这里扩容费用是指将容量扩大 $1$ 所需的费用。求： 

1. 在不扩容的情况下，$1$ 到 $n$ 的最大流；

2. 将 $1$ 到 $n$ 的最大流增加 $k$ 所需的最小扩容费用。
## 输入格式

第一行包含三个整数 $n,m,k$，表示有向图的点数、边数以及所需要增加的流量。

接下来的 $M$ 行每行包含四个整数 $u,v,c,w$，表示一条从$u$ 到 $v$，容量为 $c$，扩容费用为 $w$ 的边。
## 输出格式

输出文件一行包含两个整数，分别表示问题 $1$ 和问题 $2$ 的答案。
## 样例

### 样例输入 #1
```
5 8 2
1 2 5 8
2 5 9 9
5 1 6 2
5 1 1 8
1 2 8 7
2 5 4 9
1 2 1 1
1 4 2 1
```
### 样例输出 #1
```
13 19

```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n\le 100$。
- 对于 $100\%$ 的数据，保证 $1\le n\le 10^3$，$1\le m\le 5\times 10^3$，$1\le k\le 10$，$1 \leq u, v \leq n$，$1\le c,w\le 100$。


---

---
title: "[NOI2009] 植物大战僵尸"
layout: "post"
diff: 省选/NOI-
pid: P2805
tag: ['2009', 'NOI', '网络流', '图论建模', '拓扑排序', '最小割']
---
# [NOI2009] 植物大战僵尸
## 题目背景

Plants vs. Zombies（PVZ）是最近十分风靡的一款小游戏。Plants（植物）和 Zombies（僵尸）是游戏的主角，其中 Plants 防守，而 Zombies 进攻。该款游戏包含多种不同的挑战系列，比如 Protect Your Brain、Bowling 等等。其中最为经典的，莫过于玩家通过控制 Plants 来防守 Zombies 的进攻，或者相反地由玩家通过控制 Zombies 对 Plants 发起进攻。


## 题目描述

现在，我们将要考虑的问题是游戏中 Zombies 对 Plants 的进攻，请注意，本题中规则与实际游戏**有所不同**。游戏中有两种角色，Plants 和 Zombies，每个 Plant 有一个攻击位置集合，它可以对这些位置进行保护；而 Zombie 进攻植物的方式是走到植物所在的位置上并将其吃掉。

游戏的地图可以抽象为一个 $N$ 行 $M$ 列的矩阵，行从上到下用 $0$ 到 $N–1$ 编号，列从左到右用 $0$ 到 $M–1$ 编号；在地图的每个位置上都放有一个 $Plant$，为简单起见，我们把位于第 $r$ 行第 $c$ 列的植物记为 $P_{r, c}$。

Plants 分很多种，有「攻击类」「防守类」和「经济类」等等。为了简单的描述每个 Plant，定义 $\operatorname{Score}$ 和 $\operatorname{Attack}$ 如下：

* $\operatorname{Score}(P_{r, c})$ — Zombie 击溃植物 $P_{r, c}$ 可获得的能源。   
若 $\operatorname{Score}(P_{r, c})$ 为非负整数，则表示击溃植物 $P_{r, c}$ 可获得能源 $\operatorname{Score}(P_{r, c})$，若为负数表示击溃 $P_{r, c}$ 需要付出能源 $-\operatorname{Score}(P_{r, c})$。

* $\operatorname{Attack}(P_{r, c})$ — 植物 $P_{r, c}$ 能够对 Zombie 进行攻击的位置集合。

Zombies 必须从地图的右侧进入，且只能沿着水平方向进行移动。Zombies 攻击植物的唯一方式就是走到该植物所在的位置并将植物吃掉。因此 Zombies 的进攻总是从地图的右侧开始。也就是说，对于第 $r$ 行的进攻，Zombies 必须首先攻击 $P_{r, M-1}$；若需要对 $P_{r, c}$（$0 \le c < m - 1$）攻击，必须将 $P_{r,M-1}, P_{r, M-2} \cdots P_{r, c+1}$ 先击溃，并移动到位置 $(r, c)$ 才可进行攻击。

在本题的设定中，Plants 的攻击力是无穷大的，一旦 Zombie 进入某个 Plant 的攻击位置，该 Zombie 会被瞬间消灭，而该 Zombie 没有时间进行任何攻击操作。因此，即便 Zombie 进入了一个 Plant 所在的位置，但该位置属于其他植物的攻击位置集合，则 Zombie 会被瞬间消灭而所在位置的植物则安然无恙（在我们的设定中，Plant 的攻击位置不包含自身所在位置，否则你就不可能击溃它了）。

Zombies 的目标是对 Plants 的阵地发起进攻并获得最大的能源收入。每一次，你可以选择一个可进攻的植物进行攻击。本题的目标为，制定一套 Zombies 的进攻方案，选择进攻哪些植物以及进攻的顺序，从而获得最大的能源收入。
## 输入格式

第一行包含两个正整数 $N$ 和 $M$，分别表示地图的行数和列数。

接下来 $N \times M$ 行描述每个位置上植物的信息。第 $r \times M + c + 1$ 行按照如下格式给出植物 $P_{r, c}$ 的信息：

第一个整数为 $\operatorname{Score}(P_{r,c})$，第二个整数为集合 $\operatorname{Attack}(P_{r,c})$ 中的位置个数 $w$，接下来 $w$ 个位置信息 $(r', c')$，表示 $P_{r, c}$ 可以攻击位置第 $r'$ 行第 $c'$ 列。


## 输出格式

仅包含一个整数，表示可以获得的最大能源收入。注意，你也可以选择不进行任何攻击，这样能源收入为 $0$。
## 样例

### 样例输入 #1
```
3 2
10 0
20 0
-10 0
-5 1 0 0
100 1 2 1
100 0
```
### 样例输出 #1
```
25
```
## 提示

#### 数据规模与约定
- 对于 $20\%$ 的数据，保证 $ N, M \le 5$。
- 对于 $40\%$ 的数据，保证 $ N, M \le 10$。
- 对于 $100\%$ 的数据，保证 $1 \le N \le 20$，$1 \le M \le 30$，$-10^4 ≤ \operatorname{Score} \le 10^4$。

#### 说明
题面由 @syksykCCC 修改。


---

---
title: "[USACO09MAR] Earthquake Damage 2 G"
layout: "post"
diff: 省选/NOI-
pid: P2944
tag: ['2009', 'USACO', '网络流', '图论建模', '最小割']
---
# [USACO09MAR] Earthquake Damage 2 G
## 题目描述

Wisconsin has had an earthquake that has struck Farmer John's farm! The earthquake has damaged some of the pastures so that they are unpassable. Remarkably, none of the cowpaths was damaged.

As usual, the farm is modeled as a set of P (1 <= P <= 3,000) pastures conveniently numbered 1..P which are connected by a set of C (1 <= C <= 20,000) non-directional cowpaths conveniently numbered 1..C. Cowpath i connects pastures a\_i and b\_i (1 <= a\_i <= P; 1 <= b\_i <= P). Cowpaths might connect a\_i to itself or perhaps might connect two pastures more than once.  The barn is located in pasture 1.

A total of N (1 <= N <= P) cows (in different pastures) sequentially contacts Farmer John via moobile phone with an integer message report\_j (2 <= report\_j <= P) that indicates that pasture report\_j is undamaged but that the calling cow is unable to return to the barn from pasture report\_j because she could not find a path that does not go through damaged pastures.

After all the cows report in, determine the minimum number of pastures that are damaged.

地震袭击了威斯康星州，一些牧场被摧毁了。

一共有 $P$ 个牧场。由 $C$ 条双向路连接。两个牧场间可能有多条路。一条路也可能连接相同的牧场。牛棚坐落在牧场 $1$。

$N\ (1 \le N \le P)$ 只奶牛打来了求救电话，说她们的农场没有被摧毁，但是已经无法到达牛棚。求出最少可能有多少牧场被摧毁。

## 输入格式

\* Line 1: Three space-separated integers: P, C, and N

\* Lines 2..C+1: Line i+1 describes cowpath i with two integers: a\_i and b\_i

\* Lines C+2..C+N+1: Line C+1+j contains a single integer: report\_j

## 输出格式

\* Line 1: One number, the minimum number of damaged pastures.

## 样例

### 样例输入 #1
```
5 5 2 
1 2 
2 3 
3 5 
2 4 
4 5 
4 
5 

```
### 样例输出 #1
```
1 

```
## 提示

Only pasture 2 being damaged gives such a scenario.



---

---
title: "[USACO13DEC] The Bessie Shuffle G"
layout: "post"
diff: 省选/NOI-
pid: P3098
tag: ['2013', 'USACO', '并查集', '广度优先搜索 BFS', '图论建模']
---
# [USACO13DEC] The Bessie Shuffle G
## 题目描述

Bessie is practicing her card tricks.  She has already mastered the Bessie- shuffle -- a shuffle on M (2 <= M <= 100,000) cards that reorganizes the cards so the i-th card from the top is now the P[i]-th card from the top.

Now Bessie is practicing shuffles on larger decks.  She has a deck of N cards (M <= N <= 1,000,000,000) conveniently labeled 1 to N.  She shuffles this deck by taking the first M cards and performing the Bessie-shuffle on them, placing the shuffled cards back on top of the deck.  She then removes the top card from the deck and places it face down.  She repeats this process, placing the top cards successively on top of each other, until she is out of cards.  When Bessie has less than M cards left, she no longer performs the Bessie-shuffle, but continues to place the top card on top of the others.

Bessie knows that the deck initially started in sorted order, with 1 on top, 2 next, and N on the bottom.  Given the description of the Bessie-shuffle, help Bessie compute which cards end up located at Q different specified positions (1 <= Q <= N, Q <= 5,000) in the deck.

50% of test cases will have N <= 100,000. 

贝西有一种独门的洗牌方法，称为 A 类洗牌法；

A 类洗牌法的具体过程：将一堆共 $M$（$2 \le M \le 10 ^ 5$）张从上到下编号 $1, 2, \cdots, M$ 的纸牌，从上到下第 $i$ 张牌洗到位置 $p _ i$。

例如，$M=3，p = \{3, 1, 2\}$，则执行一次 A 类洗牌法后，从上到下将变为 $2, 3, 1$，即牌 $1$ 放到位置 $3$，牌 $2$ 放到位置 $1$，牌 $3$ 放到位置 $2$。


贝西现在要练习另外一种洗牌方法，称为 B 类洗牌法。


B 类洗牌法的具体过程： 

有一堆 $N$（$M \le N \le 10 ^ 9$）张编号为 $1, 2, \cdots, N$ 的牌，并按从上到下 $1$ 到 $N$ 的顺序堆放。另有一个牌堆用来辅助洗牌，称为临时堆，开始时为空。

1. 将最上面 $M$ 张牌进行一次 A 类洗牌法；
2. 将最上面的一张牌放到临时堆的最上方；
3. 重复前两个操作，直到原先的堆没有牌为止。


以上过程中，当原先堆的牌不足 $M$ 张的时候，将不进行 A 类洗牌法，而是将最上面的牌依次放到临时堆上。


给定 $N, M$ 和排列 $p$。现在有 $Q$（$1 \le Q \le \min(N, 5000)$）个询问，请求出对其做一次 B 类洗牌法后临时堆中 $q _ i$ 位置上的牌的编号。

$50\%$ 的数据中，$N \le 10 ^ 5$。

## 输入格式

\* Line 1: A single line containing N, M and Q separated by a space.

\* Lines 2..1+M: Line i+1 indicates the position from the top, P[i], of the i-th card in the Bessie-shuffle (1 <= P[i] <= M).

\* Lines 2+M..1+M+Q: Line i+1+M contains a single integer q\_i

describing the i-th query.  You are to compute the label on the card located in position q\_i from the top (1 <= q\_i <= N).

## 输出格式

\* Lines 1..Q: On the i-th line, print a single integer indicating the card at position q\_i from the top.

## 样例

### 样例输入 #1
```
5 3 5 
3 
1 
2 
1 
2 
3 
4 
5 

```
### 样例输出 #1
```
4 
5 
3 
1 
2 

```
## 提示

Bessie has a deck of 5 cards initially ordered as [1, 2, 3, 4, 5].  Her shuffle is on 3 cards and has the effect of moving the top card to the bottom.  There are 5 queries querying each position in the deck.


The shuffle proceeds as:

```plain
[1, 2, 3, 4, 5] -> [2, 3, 1, 4, 5] (put 2 face down) 
[3, 1, 4, 5] -> [1, 4, 3, 5] (put 1 face down) 
[4, 3, 5] -> [3, 5, 4] (put 3 face down) 
[5, 4] (put 5 face down) 
[4] (put 4 face down) 
```
This produces the final order of [4, 5, 3, 1, 2]

贝西的五张牌刚开始顺序为 [1, 2, 3, 4, 5]。她一次洗三张牌，效果是将第一张牌放到底部。以上五个问题询问了每一张牌的位置。


洗牌的顺序是:

```plain
[1, 2, 3, 4, 5] -> [2, 3, 1, 4, 5] (将2正面向下放置)
[3, 1, 4, 5] -> [1, 4, 3, 5] (将1正面向下放置) 
[4, 3, 5] -> [3, 5, 4] (将3正面向下放置) 
[5, 4] (将5正面向下放置) 
[4] (将4正面向下放置) 
```
这就形成了最终的顺序：[4, 5, 3, 1, 2]



---

---
title: "[ZJOI2014] 璀灿光华"
layout: "post"
diff: 省选/NOI-
pid: P3342
tag: ['2014', '浙江', '枚举', '广度优先搜索 BFS', '图论建模']
---
# [ZJOI2014] 璀灿光华
## 题目描述

金先生有一个女朋友没名字。她勤劳勇敢、智慧善良。金先生很喜欢她。为此，金先生用 $a^3$ 块 $1\times 1 \times 1$ 的独特的水晶制作了一个边长为 $a$ 的水晶立方体，他要将这个水晶立方体送给他见过最单纯善良的她。

由于水晶立方体太太，不好运送，金先生还是将它拆开来送出。他相信拼好这个水晶立方难不倒聪明的她。

没名字收到了礼物后果然不一会儿就根据说明将水晶立方体拼好了。没名字发现，有 $n$ 块水晶在漆黑安静的夜晚会随机以等概率向上下左右前后六个方向的一个发出穿透光。被光照到的水晶显得格外好看。没名字给每一块不会发光的水晶定义了一个好看程度。水晶立方体在夜晚中的好看程度就是每块被光照到的水晶的好看程度之和。没名字想知道，水晶立方体在夜晚中的好看程度的最小值和最大值。
## 输入格式

第一行是 $a$，表示水晶立方体的边长。
接下来 $a^3$ 行，每行若干整数。
第一个数 $g_i$ 表示第 $i$ 块水晶的好看程度。如果 $g_i=0$，代表这块水晶会发光。接下来 $3\sim 6$ 个整数，代表与这块水晶有共同面的水晶编号。
## 输出格式

两个整数，代表水晶立方体在夜晚好看程度的最小值与最大值。
## 样例

### 样例输入 #1
```
2
0 7 2 3
0 8 1 4
4 5 4 1
8 6 3 2
16 3 6 7
32 4 5 8
1 1 8 5
2 2 7 6
```
### 样例输出 #1
```
0 12
```
## 提示

对于所有数据，$1<a\leq 70$，$g_i<10^6$，$n\leq 8$。



---

---
title: "[TJOI2010] 电影迷"
layout: "post"
diff: 省选/NOI-
pid: P3872
tag: ['2010', '各省省选', '图论建模', '最小割', '天津']
---
# [TJOI2010] 电影迷
## 题目描述

小A是一个电影迷，他收集了上百部的电影，打算从中挑出若干部在假期看完。他根据自己的口味和网上的介绍，对每部电影X都打了一个分数vX，表示自己喜欢的程度。这个分数的范围在-1000至1000之间，越大表示越喜欢。小A每看一部电影X，他的体验值就会加上vX。

另外，因为某些电影是组成一个系列的，比如著名的《终结者》系列、《黑客帝国》系列等等，如果小A只看了前一部而没有看后一部的话，他就会觉得不是很爽。准确来讲，对于任意两部不同的电影X,Y，他们可能存在一个依赖值dXY，表示如果小A看了X但是没看Y，他的体验值就会减少dXY。（注意与观看的顺序无关，只要两部都看过，就不会减少体验值）

现在他要选出若干电影来看，使得得到的总的体验值最大。如果他无法得到正的体验值，就输出0。

## 输入格式

输入的第一行是两个整数：电影总数N和依赖关系数目M。第二行包含用空格隔开的N个数，表示对每部电影的打分。接下来M行，每行包含三个整数X, Y, dXY，表示一个依赖关系。每个有序对(X,Y)最多出现一次。(1 ≤ X,Y ≤ N)

## 输出格式

输出一个整数，表示小A能得到的最大体验值。

## 样例

### 样例输入 #1
```
2 2
100 -50
1 2 49
2 1 10

```
### 样例输出 #1
```
51
```
## 提示

如果小A只看电影1，体验值为100-49 = 51。如果只看电影2，体验值为-50-10 = -60。如果两部都看，体验值为100+(-50) = 50。所以应该只看电影1。

数据规模与约定

对于20%的数据，1 ≤ N ≤ 15

对于100%的数据，1 ≤ N ≤ 100, -1000 ≤ vX ≤ 1000, 0 < dXY ≤ 1000

每个测试点时限1秒



---

---
title: "[JLOI2008] 将军"
layout: "post"
diff: 省选/NOI-
pid: P3882
tag: ['2008', '各省省选', '吉林', '图论建模', '二分图']
---
# [JLOI2008] 将军
## 题目描述

刘先生最近在学习国际象棋，使用一个叫 jloi-08 的游戏软件。在这个游戏里，不但可以和电脑普通地对弈，还可以学习著名的棋局，还有针对初学者的规则指导等丰富功能。但是…大小却要 1.4G T\_T。

言归正传，在这个软件里，为了让玩家更好地理解和运用各个棋子，有很多趣味的游戏，比如以下就是一个：

给出一个棋盘和一些棋子，让你把这些棋子摆放在棋盘上，使得两两不互相攻击。你的得分由你摆放上去的棋子的个数与种类有关。

这个游戏很复杂，刘先生老是玩不到高分。于是电脑便降低了难度，替刘先生摆上了一些棋子，最后只给你任意多个 bishop（教主）。

现在刘先生便要考一考你，在电脑给出的这张棋盘上，最多能放几个 bishop。

国际象棋中一共有 6 种棋子：

- king（国王）；
- queen（皇后）；
- bishop（教主）；
- knight（骑士）；
- rook（车）；
- pawn（步兵）。

各棋子的攻击范围如下：

- queen 可以攻击与它在同一行，同一列，同一条对角线的棋子；
- knight 的攻击范围如下图所示：

![](https://cdn.luogu.com.cn/upload/pic/2669.png)

- rook 攻击水平和垂直两条线上的所有格子；
- pawn 攻击前方两条斜线方向各一格(“前方”指 $x$ 递增的方向，$x$ 行 $y$ 列）；
- king 攻击周围 8 个方向各 1 格；
- bishop 攻击两条对角线上的所有格子。

除 knight 以外，所有棋子的攻击范围均会被别的棋子所阻挡。

可惜的是这个软件也不是顶优秀，给出的棋盘上的棋子可能互相会攻击，不过你不用理会这些，你只要保证你摆放的 bishop 不与它们以及不互相攻击就可以了。
## 输入格式

第一行是两个整数 $x,y$（$1 \leq x,y \leq 1024$）。

下面的 $x$ 行每行 $y$ 个字符表示棋盘。

其中：`K` – king，`Q` – queen，`B` – bishop，`N` – knight，`R` – rook，`P` – pawn，`.` – blank.
## 输出格式

仅一行一个数，表示最多能够摆放的 bishop 的个数。

## 样例

### 样例输入 #1
```
3 3
..N
...
...

```
### 样例输出 #1
```
2
```
## 提示

```plain
BBN
...
...
```

```plain
BBN
...
B..
```

虽然看上去下面的方法比上面的优秀，但是 N 被第三行的 B 攻击了。也就是说，你需要避免的有 2 种情况： 你摆放的 bishop 之间的互相攻击以及你摆放的 bishop 与预先摆放好的棋子之间的互相攻击；但不用考虑预先摆放好的棋子之间的互相攻击。



---

---
title: "[TJOI2013] 循环格"
layout: "post"
diff: 省选/NOI-
pid: P3965
tag: ['2013', '各省省选', '图论建模', '费用流', '天津']
---
# [TJOI2013] 循环格
## 题目背景

一个循环格就是一个矩阵,其中所有元素为箭头,指向相邻四个格子。每个元素有一个坐标(行,列),其中左上角元素坐标为(0,0)。给定一个起始位(r,c),你可以沿着箭头方向在格子间行走。即:如果(r,c)是一个左箭头，那么走到(r,c-1);如果是一个右箭头,走到(r,c+1);如果是上箭头,走到(r-1,c);如果是下箭头,走到(r+1,c)。每一行和每一列都是循环的,即如果走出边界,你会出现在另一侧。比如在一个5\*5的循环格里,从(3,0)向左走会出现在(3,4)。

## 题目描述

一个完美的循环格是这样定义的:对于任意一个起始位置,你都可以沿着箭头最终回到起始位置。如果一个循环格不满足完美,你可以随意修改任意一个元素的箭头直到完美。例如下图,左边不是一个完美的循环格,因为只有从(1,1),(1,2),(2,0),(2,3)出发才会回到起始位置。通过修改其中两个箭头,可以得到右图,一个完美的循环格。

 ![](https://cdn.luogu.com.cn/upload/pic/10987.png) 

给定一个循环格,你需要计算最少需要修改多少个元素使其完美。

## 输入格式

第一行两个整数R和C,表示循环格的行和列。接下来R行,每一行包含C个字符LRUD表示左右上下

## 输出格式

一个整数,表示最少需要修改多少个元素使得给定的循环格完美。

## 样例

### 样例输入 #1
```
4 4
RRRD
URDD
UULD
ULLL
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
3 4
RRRD
URLL
LRRR
```
### 样例输出 #2
```
2
```
## 提示

### 数据范围

30%的数据，1 ≤ R, C ≤ 7

100%的数据，1 ≤ R, C ≤ 15



---

---
title: "[TJOI2015] 线性代数"
layout: "post"
diff: 省选/NOI-
pid: P3973
tag: ['2015', '各省省选', '图论建模', '最小割', '天津']
---
# [TJOI2015] 线性代数
## 题目描述

为了提高智商，ZJY 开始学习线性代数。

她的小伙伴菠萝给她出了这样一个问题：给定一个 $n \times n$ 的矩阵 $B$ 和一个 $1 \times n$ 的矩阵 $C$。求出一个 $1×n$ 的 01 矩阵 $A$，使得 $D=(A×B-C)×A^{\sf T}$ 最大，其中$A^{\sf T}$为$A$的转置，输出$D$。
## 输入格式

第一行输入一个整数 $n$。接下来 $n$ 行输入 $B$ 矩阵，第 $i$ 行第 $j$ 个数代表 $B$ 接下来一行输入 $n$ 个整数，代表矩阵 $C$。矩阵 $B$ 和矩阵 $C$ 中每个数字都是不过 $1000$ 的非负整数。

## 输出格式

输出一个整数，表示最大的 $D$。
## 样例

### 样例输入 #1
```
3
1 2 1
3 1 0
1 2 3
2 3 7
```
### 样例输出 #1
```
2
```
## 提示

- 对于 $30\%$ 的数据，$n \leq 15$；
- 对于 $100\%$ 的数据，$1 \leq n \leq 500$；
- 另外还有两组不计分的 hack 数据，放在 subtask 2 中，数据范围与上面一致。



---

---
title: "[NOI2008] 志愿者招募"
layout: "post"
diff: 省选/NOI-
pid: P3980
tag: ['2008', 'NOI', '网络流', '图论建模', '线性规划']
---
# [NOI2008] 志愿者招募
## 题目描述

申奥成功后，布布经过不懈努力，终于成为奥组委下属公司人力资源部门的主管。布布刚上任就遇到了一个难题：为即将启动的奥运新项目招募一批短期志愿者。经过估算，这个项目需要 $n$ 天才能完成，其中第 $i$ 天至少需要 $a_i$ 个人。布布通过了解得知，一共有 $m$ 类志愿者可以招募。其中第 $i$ 类可以从第 $s_i$ 天工作到第 $t_i$ 天，招募费用是每人 $c_i$ 元。新官上任三把火，为了出色地完成自己的工作，布布希望用尽量少的费用招募足够的志愿者，但这并不是他的特长！于是布布找到了你，希望你帮他设计一种最优的招募方案。
## 输入格式

第一行包含两个整数 $n,m$，表示完成项目的天数和可以招募的志愿者的种类。接下来的一行中包含 $n$ 个非负整数，表示每天至少需要的志愿者人数。 接下来的 $m$ 行中每行包含三个整数 $s_i, t_i, c_i$，含义如上文所述。为了方便起见，我们可以认为每类志愿者的数量都是无限多的。保证存在可行的招募方案。
## 输出格式

仅包含一个整数，表示你所设计的最优方案的总费用。

## 样例

### 样例输入 #1
```
3 3
2 3 4
1 2 2
2 3 5
3 3 2
```
### 样例输出 #1
```
14
```
## 提示

$1\leq n\leq 1000$，$1\leq m\leq 10000$，题目中其他所涉及的数据均不超过 $2^{31}-1$。


---

---
title: "深海机器人问题"
layout: "post"
diff: 省选/NOI-
pid: P4012
tag: ['图论建模', '费用流', '网络流与线性规划 24 题']
---
# 深海机器人问题
## 题目描述

深海资源考察探险队的潜艇将到达深海的海底进行科学考察。


潜艇内有多个深海机器人。潜艇到达深海海底后，深海机器人将离开潜艇向预定目标移动。


深海机器人在移动中还必须沿途采集海底生物标本。沿途生物标本由最先遇到它的深海机器人完成采集。


每条预定路径上的生物标本的价值是已知的，而且生物标本只能被采集一次。


本题限定深海机器人只能从其出发位置沿着向北或向东的方向移动，而且多个深海机器人可以在同一时间占据同一位置。


用一个 $P\times Q$ 网格表示深海机器人的可移动位置。西南角的坐标为 $(0,0)$，东北角的坐标为 $(Q,P)$ 。



 ![](https://cdn.luogu.com.cn/upload/pic/12215.png) 

给定每个深海机器人的出发位置和目标位置，以及每条网格边上生物标本的价值。


计算深海机器人的最优移动方案， 使深海机器人到达目的地后，采集到的生物标本的总价值最高。


## 输入格式

文件的第 $1$ 行为深海机器人的出发位置数 $a$,和目的地数 $b$ 。


第 $2$ 行为 $P$ 和 $Q$ 的值。


接下来的 $P+1$ 行,每行有 $Q$ 个正整数,表示向东移动路径上生物标本的价值,行数据依从南到北方向排列。


再接下来的 $Q+1$ 行,每行有 $P$ 个正整数,表示向北移动路径上生物标本的价值,行数据依从西到东方向排列。


接下来的 $a$ 行，每行有三个正整数 $k,x,y$,表示有 $k$ 个深海机器人从 $(y,x)$ 位置坐标出发。


再接下来的 $b$ 行，每行有三个正整数 $r,x,y$ ,表示有 $r$ 个深海机器人可选择 $(y,x)$ 位置坐标作为目的地。

## 输出格式

输出采集到的生物标本的最高总价值.

## 样例

### 样例输入 #1
```
1 1
2 2
1 2
3 4
5 6
7 2
8 10
9 3
2 0 0
2 2 2
```
### 样例输出 #1
```
42
```
## 提示

$1\leq P,Q\leq15$


$1\leq a\leq 4$


$1\leq b\leq 6$



---

---
title: "数字梯形问题"
layout: "post"
diff: 省选/NOI-
pid: P4013
tag: ['O2优化', '图论建模', '费用流', '网络流与线性规划 24 题']
---
# 数字梯形问题
## 题目描述

给定一个由 $n$ 行数字组成的数字梯形如下图所示。



 ![](https://cdn.luogu.com.cn/upload/pic/12216.png) 

梯形的第一行有 $m$ 个数字。从梯形的顶部的 $m$ 个数字开始，在每个数字处可以沿左下或右下方向移动，形成一条从梯形的顶至底的路径。


分别遵守以下规则：


1. 从梯形的顶至底的 $m$ 条路径互不相交；

1. 从梯形的顶至底的 $m$ 条路径仅在数字结点处相交；

1. 从梯形的顶至底的 $m$  条路径允许在数字结点相交或边相交。

## 输入格式

第 $1$ 行中有 $2$ 个正整数 $m$ 和 $n$，分别表示数字梯形的第一行有 $m$ 个数字，共有 $n$ 行。接下来的 $n$ 行是数字梯形中各行的数字。

第 $1$ 行有 $m$ 个数字，第 $2$ 行有 $m+1$ 个数字，以此类推。

## 输出格式

将按照规则 $1$，规则 $2$，和规则 $3$ 计算出的最大数字总和并输出，每行一个最大总和。

## 样例

### 样例输入 #1
```
2 5
2 3
3 4 5
9 10 9 1
1 1 10 1 1
1 1 10 12 1 1
```
### 样例输出 #1
```
66
75
77
```
## 提示

$1\leq m,n \leq 20$



---

---
title: "[Code+#2] 白金元首与独舞"
layout: "post"
diff: 省选/NOI-
pid: P4033
tag: ['搜索', '图论建模', '生成树', 'Code+']
---
# [Code+#2] 白金元首与独舞
## 题目背景

```cpp
到河北省 见斯大林 / 在月光下 你的背影 / 让我们一起跳舞吧
```
うそだよ~ 河北省怎么可能有 Stalin。


可是…… 可是如果 Stalin 把自己当作炸弹扔到地堡花园里来了呢？


怀揣着这份小小的希望，元首 Adolf 独自走进了花园。终有一天会重逢的吧，Stalin。或许是在此处，或许是在遥远的彼方。


无论如何，在此之前，好好装点一番花园，编排一段优美的舞步吧！

## 题目描述

元首把花园分为 $n$ 行 $m$ 列的网格。每个格子中都可以放置一个标识，指向上、下、左、右四个方向中的任意一个。元首位于一个格子时，会按照其中标识所指的方向进入周围的格子，或者走出花园（即目的格子不在网格之内）。举个例子 —— 对于下面的放置方式，元首从第 $3$ 行第 $2$ 列的格子开始，会沿着以红色标出的路径走出花园；从第 $2$ 行第 22 列的格子开始，则会在以蓝色标出的环路内不断地行走。

 ![](https://cdn.luogu.com.cn/upload/pic/12659.png) 

元首已经设计好了大部分格子的标识。元首用字符 L、R、U、D 分别表示指向左、右、上、下四个方向的标识，用字符 . 表示未决定的格子。现在，元首希望将每个 . 替换为 L、R、U、D 中任意一种，使得从花园中的任意一个格子出发，按照上述规则行走，都可以最终走出花园。


你需要编写程序帮助元首计算替换的不同方案数。两个方案不同当且仅当存在一个格子，使得两个方案中该格子内的标识不同。当然，由于答案可能很大，只需给出方案数除以 $10^9 + 7$所得的余数即可。

## 输入格式

从标准输入读入数据。


输入的第一行包含一个正整数 $T$ —— 测试数据的组数。接下来包含 $T$ 组测试数据，格式如下，测试数据间没有空行。


第 $1$ 行：两个空格分隔的正整数 $n$、$m$ —— 依次表示花园被分成的行数和列数。

接下来 $n$ 行：每行一个长度为 $m$ 的由字符 L、R、U、D 和 . 组成的字符串 —— 表示花园内已经确定的格子状态。

## 输出格式

输出到标准输出。


对于每组测试数据输出一行 —— 满足条件的方案数除以 $10^9 + 7 $所得的余数。

## 样例

### 样例输入 #1
```
5
3 9
LLRRUDUUU
LLR.UDUUU
LLRRUDUUU
4 4
LLRR
L.LL
RR.R
LLRR
4 3
LRD
LUL
DLU
RDL
1 2
LR
2 2
..
..
```
### 样例输出 #1
```
3
8
0
1
192
```
## 提示

**样例解释**

第 $1$ 组数据中，将惟一的 . 替换成 R、U 或 D 均满足要求。


第 $2$ 组数据中，将左上方和右下方的两个 . 分别替换成 LR、LU、LD、UR、UU、UD、DR 或 DD 均满足要求。


第 $3$ 组数据中，没有待决定的格子，原本的安排会使得元首陷入无尽的环路，故答案为 $0$。该组数据与**题目描述**中的例子相同。


第 $4$ 组数据中，也没有待决定的格子，但原本的安排已经满足要求，故答案为 $1$。


令 $k$ 表示标记未确定（即包含 “.”）的格子总数。


对于所有数据，有 $1 \leq T \leq 10$，$1 \leq n, m \leq 200$，$0 \leq k \leq \min(nm, 300)$。

 ![](https://cdn.luogu.com.cn/upload/pic/12660.png) 

“... wie Stalin!”


题面与史实无关。


来自 CodePlus 2017 12 月赛，清华大学计算机科学与技术系学生算法与竞赛协会 荣誉出品。

Credit：idea/吕时清 命题/吕时清 验题/王聿中，杨景钦

Git Repo：https://git.thusaac.org/publish/CodePlus201712

感谢腾讯公司对此次比赛的支持。



---

---
title: "[JSOI2007] 合金"
layout: "post"
diff: 省选/NOI-
pid: P4049
tag: ['2007', '各省省选', '江苏', '图论建模', '最短路', '凸包']
---
# [JSOI2007] 合金
## 题目描述

某公司加工一种由铁、铝、锡组成的合金。他们的工作很简单。首先进口一些铁铝锡合金原材料，不同种类的原材料中铁铝锡的比重不同。然后，将每种原材料取出一定量，经过融解、混合，得到新的合金。新的合金的铁铝锡比重为用户所需要的比重。 

现在，用户给出了 $n$ 种他们需要的合金，以及每种合金中铁铝锡的比重。公司希望能够订购最少种类的原材料，并且使用这些原材料可以加工出用户需要的所有种类的合金。
## 输入格式

第一行两个整数 $m$ 和 $n$，分别表示原材料种数和用户需要的合金种数。

第 $2$ 到 $m+1$ 行，每行三个实数 $a_i, b_i, c_i$，分别表示铁铝锡在一种原材料中所占的比重。

第 $m+2$ 到 $m+n+1$ 行，每行三个实数 $d_i, e_i, f_i$，分别表示铁铝锡在一种用户需要的合金中所占的比重。
## 输出格式

一个整数，表示最少需要的原材料种数。若无解，则输出 `–1`。
## 样例

### 样例输入 #1
```
10 10
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0
```
### 样例输出 #1
```
5
```
## 提示

#### 数据规模与约定

对于全部的测试点，满足 $1\le m,n\le 500$，$0 \leq a_i,b_i,c_i,d_i,e_i,f_i \leq 1$，且 $a_i+b_i+c_i=1$，$d_i+e_i+f_i=1$，小数点后最多有六位数字。


---

---
title: "[USACO17DEC] A Pie for a Pie G"
layout: "post"
diff: 省选/NOI-
pid: P4083
tag: ['2017', '二分', 'USACO', '并查集', '图论建模', '最短路']
---
# [USACO17DEC] A Pie for a Pie G
## 题目描述

Bessie and Elsie have each baked $N$ pies ($1 \leq N \leq 10^5$). Each of the $2N$ pies has a tastiness value according to Bessie and a (possibly different) tastiness value according to Elsie.

Bessie is thinking about giving one of her pies to Elsie. If Elsie receives a pie from Bessie, she will feel obligated to give one of her pies to Bessie. So as to not appear stingy nor flamboyant, Elsie will try to pick a pie that is at least as tasty (in Elsie's eyes) as the pie she received, but no more than $D$ units tastier ($0 \leq D \leq 10^9$). Such a pie may not exist, in which case Elsie will adopt a pseudonym and exile herself to Japan.


But if Elsie does give Bessie a pie in return, Bessie will similarly try to give Elsie a pie which is at least as tasty but no more than $D$ units tastier (in Bessie's eyes) as the pie Elsie just gave her. Should this be impossible, Bessie too will exile herself. Otherwise she will give her chosen pie to Elsie. This cycle will continue until one of the cows is exiled, an unhappy outcome, or one of the cows receives a pie which she accords a tastiness value of $0$, in which case the gift exchange will end and both cows will be happy.


Note that a pie may not be gifted twice, nor can either cow return a pie gifted to her.


For each of the $N$ pies Bessie could select as her initial gift to Elsie, determine the minimum number of pies that could possibly be gifted in the resulting exchange before the cows are happy.

## 输入格式

The first line contains the two integers $N$ and $D$.

The next $2N$ lines contain two space-separated integers each, respectively denoting the value of a particular pie according to Bessie, and the value of that pie according to Elsie.


The first $N$ lines refer to Bessie's pies, and the remaining $N$ lines refer to Elsie's pies.


It is guaranteed that all tastiness values are in the range $[0,10^9]$.

## 输出格式

There should be $N$ lines in the output. Line $i$ should contain a single integer: the minimum number of pies that could be gifted in a happy gift exchange started with Bessie's pie $i$. If no gift exchange starting with pie $i$ is happy, then line $i$ should contain the single integer $-1$ instead.

## 样例

### 样例输入 #1
```
2 1
1 1
5 0
4 2
1 4
```
### 样例输出 #1
```
3
1

```
## 题目翻译

### 题目描述

Bessie 和 Elsie 各自烤了 $N$ 个派（$1 \leq N \leq 10^5$）。这 $2N$ 个派中的每一个都有一个由 Bessie 评定的美味值和一个（可能不同的）由 Elsie 评定的美味值。

Bessie 正在考虑将她的一只派送给 Elsie。如果 Elsie 收到了 Bessie 的派，她会觉得有义务回赠 Bessie 一只派。为了既不显得吝啬也不显得炫耀，Elsie 会尝试选择一只在她看来至少与收到的派一样美味，但不超过 $D$ 单位更美味的派（$0 \leq D \leq 10^9$）。如果这样的派不存在，Elsie 将采用一个化名并自我流放到日本。

但如果 Elsie 确实回赠了 Bessie 一只派，Bessie 也会类似地尝试送给 Elsie 一只在她看来至少与 Elsie 刚送给她的派一样美味，但不超过 $D$ 单位更美味的派。如果这不可能，Bessie 也会自我流放。否则，她会将她选择的派送给 Elsie。这个循环将继续，直到其中一头奶牛被流放（一个不愉快的结果），或者其中一头奶牛收到一只她评定美味值为 $0$ 的派，在这种情况下，礼物交换将结束，两头奶牛都会感到高兴。

请注意，一只派不能被赠送两次，任何一头奶牛也不能回赠她收到的派。

对于 Bessie 可以选择作为初始礼物送给 Elsie 的每一只派，确定在奶牛们感到高兴之前，可能被赠送的派的最小数量。

### 输入格式

第一行包含两个整数 $N$ 和 $D$。

接下来的 $2N$ 行每行包含两个用空格分隔的整数，分别表示某只派由 Bessie 评定的美味值和由 Elsie 评定的美味值。

前 $N$ 行描述 Bessie 的派，剩下的 $N$ 行描述 Elsie 的派。

保证所有美味值都在 $[0,10^9]$ 范围内。

### 输出格式

输出应包含 $N$ 行。第 $i$ 行应包含一个整数：如果以 Bessie 的第 $i$ 只派开始的礼物交换是高兴的，则输出可能被赠送的派的最小数量；否则输出 $-1$。


---

---
title: "洞穴遇险"
layout: "post"
diff: 省选/NOI-
pid: P4142
tag: ['图论建模', '构造']
---
# 洞穴遇险
## 题目背景

**ZRQ**在洞穴中准备采集矿物的时候遇险了！洞穴**要塌了**！

题目来源：[zhoutb2333](https://www.luogu.org/space/show?uid=31564)

## 题目描述

整个洞穴是一个$N*N$的方格图，每个格子形如$(X,Y),1 \le X,Y \le N$。其中$X$表示从上到下的行数，$Y$表示从左到右的列数。$(1,1)$在左上角,$(1,N)$在右上角，$(N,1)$在左下角，$(N,N)$在右下角。


满足$X+Y$为奇数格子的有一个不稳定度$V_{X,Y},X+Y$为偶数的格子的不稳定度为$0$。


**ZRQ**现在手里恰巧有$M$个可以支撑洞穴的柱子，柱子的力量可以认为是无穷大。


只要支撑住了一个格子那么这个格子的不稳定度将降为$0$。


每个柱子是$L$型的，它除了要占据当前的格子外，还需要占据两个相邻的格子（这三个格子形成$L$型,可以选择任意方向放置，一共有$4$个方向）。



 ![](https://cdn.luogu.com.cn/upload/pic/13049.png) 

**柱子占据相邻的格子不会降低其不稳定度（换句话说就是柱子只有在拐角处有力量）**。


有些格子的顶已经塌下来了，无法在其位置放置柱子了，这些格子也不能被占据了。这样已经塌了的格子有$K$个（他们的不稳定度都为$0$,**即使$X+Y$为奇数，塌下来的格子的不稳定度也会为$0$**）。


**ZRQ**想问你，在放置一些柱子后 ，最小的不稳定度之和为多少（可以不将$M$个柱子都放完）。

## 输入格式

第一行三个整数$N,M,K$


接下来$N$行每行$N$个整数，表示每个格子的不稳定度，**保证$X+Y$为偶数的格子和已经塌下的格子的不稳定度为$0$**。


接下来$K$行每行$2$个整数$X,Y$，表示已经塌下的格子的坐标。

## 输出格式

一行一个整数，表示最小的不稳定度的和。

## 样例

### 样例输入 #1
```
3 3 1
0 1 0
2 0 1
0 1 0
1 3
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3 3 4
0 2 0
0 0 4
0 3 0
1 3
2 1
2 2
3 1
```
### 样例输出 #2
```
9
```
## 提示

共$10$个测试点，每个点$10$分，计$100$分。


对于测试点$1$~$3$，有$1 \le N \le 6$


对于测试点$4$~$7$，有$1 \le N \le 11$


对于测试点$8$~$10$，有$1 \le N \le 50$


对于所有测试点，$0 \le M \le \frac{N^2}{3}, 0 \le K \le N^2, 0 \le V_{X,Y} \le 10^6$


**样例#1解释：**

显然无法让任意两个不稳定的格子都被拐角覆盖，于是将$(2,1)$用拐角覆盖住即可。这样剩余的不稳定度为$V_{1,2}+V_{2,3}+V_{3,2}=1+1+1=3$。

**样例#2解释：**

一个都放不下，这样剩余的不稳定度为$V_{1,2}+V_{2,3}+V_{3,2}=2+4+3=9$。



---

---
title: "[WC2016] 挑战NPC"
layout: "post"
diff: 省选/NOI-
pid: P4258
tag: ['2016', 'Special Judge', '图论建模', '一般图的最大匹配', 'WC']
---
# [WC2016] 挑战NPC
## 题目描述

小 N 最近在研究 NP 完全问题，小 O 看小 N 研究得热火朝天，便给他出了一道这样的题目：

有 $n$ 个球，用整数 $1$ 到 $n$ 编号。还有 $m$ 个筐子，用整数 $1$ 到 $m$ 编号。每个筐子最多能装 $3$ 个球。

每个球只能放进特定的筐子中。 具体有 $e$ 个条件，第 $i$ 个条件用两个整数
$v_i$ 和 $u_i$ 描述，表示编号为 $v_i$ 的球可以放进编号为 $u_i$ 的筐子中。

每个球都必须放进一个筐子中。如果一个筐子内有不超过 $1$ 个球，那么我们称这样的筐子为半空的。

求半空的筐子最多有多少个，以及在最优方案中， 每个球分别放在哪个筐子中。

小 N 看到题目后瞬间没了思路，站在旁边看热闹的小 I 嘿嘿一笑：“水题！”
然后三言两语道出了一个多项式算法。

小 N 瞬间就惊呆了，三秒钟后他回过神来一拍桌子：“不对！这个问题显然是 NP 完全问题，你算法肯定有错！”

小 I 浅笑：“所以，等我领图灵奖吧！”

小 O 只会出题不会做题，所以找到了你——请你对这个问题进行探究，并写一个程序解决此题。
## 输入格式

输入文件 $\tt{npc.in}$ 第一行包含 $1$ 个正整数 $T$， 表示有 $T$ 组数据。

对于每组数据，第一行包含 $3$ 个正整数 $n, m, e$， 表示球的个数，筐子的个数和条件的个数。

接下来 $e$ 行，每行包含 $2$ 个整数 $v_i, u_i$， 表示编号为 $v_i$ 的球可以放进编号为 $u_i$ 的筐子。
## 输出格式

输出文件为 $\tt{npc.out}$。

对于每组数据，先输出一行，包含一个整数，表示半空的筐子最多有多少个。

然后再输出一行，包含 $n$ 个整数 $p_1, p_2, ... , p_n$，相邻整数之间用空格隔开，表示一种最优解。其中 $p_i$ 表示编号为 $i$ 的球放进了编号为 $p_i$ 的筐子。 如果有多种最优解，可以输出其中任何一种。
## 样例

### 样例输入 #1
```
1
4 3 6
1 1
2 1
2 2
3 2
3 3
4 3
```
### 样例输出 #1
```
2
1 2 3 3
```
## 提示

对于所有数据， $T \leq 5, 1 \leq n \leq 3m$。 保证 $1 \leq v_i \leq n, 1 \leq u_i \leq m$，且不会出现重复的条件。

保证至少有一种合法方案，使得每个球都放进了筐子，且每个筐子内球的个
数不超过 $3$。

各测试点满足以下约定：
![](https://cdn.luogu.com.cn/upload/image_hosting/wi7sdxbz.png)


---

---
title: "[JSOI2009] 球队收益 / 球队预算"
layout: "post"
diff: 省选/NOI-
pid: P4307
tag: ['2009', '各省省选', '江苏', '图论建模', '费用流']
---
# [JSOI2009] 球队收益 / 球队预算
## 题目描述

在一个篮球联赛里，有$n$支球队，球队的支出是和他们的胜负场次有关系的，具体来说，第i支球队的赛季总支出是$C_i\times x^2+D_i \times y^2,D_i \le C_i$。(赢得多，给球员的奖金就多嘛)
其中$x,y$分别表示这只球队本赛季的胜负场次。现在赛季进行到了一半，每只球队分别取得了$a_i$场胜利和$b_i$场失利。而接下来还有$m$场比赛要进行。问联盟球队的最小总支出是多少。
## 输入格式

第一行$n$，$m$

接下来$n$行每行$4$个整数$a_i,b_i,C_i,D_i$

再接下来$m$行每行两个整数$s$，$t$表示第$s$支队伍和第$t$支队伍之间将有一场比赛，注意两只队间可能有多场比赛。
## 输出格式

一个整数代表总支出的最小值。
## 样例

### 样例输入 #1
```
3 3
1 0 2 1
1 1 10 1
0 1 3 3
1 2
2 3
3 1
```
### 样例输出 #1
```
43
```
## 提示

对于20%的数据$2 \le n \le 10,0 \le m \le 20$；  
对于100%的数据$2 \le n \le 5000,0 \le m \le 1000,0 \le D_i \le C_i \le 10,0 \le a_i,b_i \le 50$。


---

---
title: "文理分科"
layout: "post"
diff: 省选/NOI-
pid: P4313
tag: ['网络流', '图论建模', '最小割']
---
# 文理分科
## 题目描述

文理分科是一件很纠结的事情！（虽然看到这个题目的人肯定都没有纠结过）

小 P 所在的班级要进行文理分科。他的班级可以用一个 $n\times m$ 的矩阵进行描述，每个格子代表一个同学的座位。每位同学必须从文科和理科中选择一科。同学们在选择科目的时候会获得一个满意值。满意值按如下的方式得到：

- 如果第 $i$ 行第 $j$ 列的同学选择了文科，则他将获得 $art_{i,j}$ 的满意值，如果选择理科，将得到 $science_{i,j}$ 的满意值。

- 如果第 $i$ 行第 $j$ 列的同学选择了文科，并且他相邻（两个格子相邻当且仅当它们拥有一条相同的边）的同学全部选择了文科，则他会更开心，所以会增加 $same\text{\underline{ }}art_{i,j}$ 的满意值。

- 如果第 $i$ 行第 $j$ 列的同学选择了理科，并且他相邻的同学全部选择了理科，则增加 $same\text{\underline{ }}science_{i,j}$ 的满意值。

小 P 想知道，大家应该如何选择，才能使所有人的满意值之和最大。请告诉他这个最大值。
## 输入格式

输入第一行为两个正整数 $n,m$。  
接下来 $n$ 行 $m$ 个整数，第 $i$ 行第 $j$ 个整数表示 $art_{i,j}$；  
接下来 $n$ 行 $m$ 个整数，第 $i$ 行第 $j$ 个整数表示 $science_{i,j}$；  
接下来 $n$ 行 $m$ 个整数，第 $i$ 行第 $j$ 个整数表示 $same\text{\underline{ }}art_{i,j}$；  
接下来 $n$ 行 $m$ 个整数，第 $i$ 行第 $j$ 个整数表示 $same\text{\underline{ }}science_{i,j}$。
## 输出格式

输出为一个整数，表示最大的满意值之和。
## 样例

### 样例输入 #1
```
3 4
13 2 4 13
7 13 8 12
18 17 0 5
8 13 15 4
11 3 8 11
11 18 6 5
1 2 3 4 
4 2 3 2
3 1 0 4
3 2 3 2
0 2 2 1
0 2 4 4 
```
### 样例输出 #1
```
152
```
## 提示

### 样例说明

1 表示选择文科，0 表示选择理科，方案如下：

1  0  0  1

0  1  0  0

1  0  0  0

### 数据范围

$n,m\leq 100$，读入数据均 $\leq 500$。                                                                                                                                                              


---

---
title: "[中山市选] 杀人游戏"
layout: "post"
diff: 省选/NOI-
pid: P4819
tag: ['图论建模', '强连通分量']
---
# [中山市选] 杀人游戏
## 题目描述

一位冷血的杀手潜入Na-wiat，并假装成平民。警察希望能在$N$个人里面，查出谁是杀手。警察能够对每一个人进行查证，假如查证的对象是平民，他会告诉警察，他认识的人，谁是杀手，谁是平民。假如查证的对象是杀手，杀手将会把警察干掉。现在警察掌握了每一个人认识谁。每一个人都有可能是杀手，可看作他们是杀手的概率是相同的。

问：根据最优的情况，保证警察自身安全并知道谁是杀手的概率最大是多少？
## 输入格式

第一行有两个整数 $N,M$。 
接下来有 $M$ 行，每行两个整数 $x,y$，表示 $x$ 认识 $y$（$y$ 不一定认识 $x$ ,例如President同志） 。  

注：原文zz敏感内容已替换
## 输出格式

仅包含一行一个实数，保留小数点后面 $6$ 位，表示最大概率。
## 样例

### 样例输入 #1
```
5 4 
1 2 
1 3 
1 4 
1 5 
```
### 样例输出 #1
```
0.800000
```
## 提示

警察只需要查证$1$。假如$1$是杀手，警察就会被杀。假如$1$不是杀手，他会告诉警察$2,3,4,5$谁是杀手。而$1$是杀手的概率是$0.2$，所以能知道谁是杀手但没被杀的概率是$0.8$。

对于$100\%$的数据有$1≤N≤100000,0≤M≤300000$。


---

---
title: "T'ill It's Over"
layout: "post"
diff: 省选/NOI-
pid: P5029
tag: ['线段树', '网络流', '图论建模']
---
# T'ill It's Over
## 题目背景

小正方形被黑暗之主碾成了粉末。

一切，就这么结束了吗？

就当大家都以为再无翻盘的希望时，

已经被净化的两个世界之树的部分，微微闪烁……
## 题目描述

小正方形被三角的力量复活了，它即将与黑暗之主展开最后的战斗。

小正方形最后的目标，就是净化黑暗之主。

黑暗之主的蜈蚣长度为 $n$，一开始每一节的光明程度为 $1$

当一节蜈蚣的光明程度达到一个指定的值 ($k$)，我们就视作这节蜈蚣被净化。

为了净化黑暗之主，小正方形准备了 $m$ 种方案，这些方案按本质上的不同大约可分为四种：

1. 将一节光明程度为 $a$ 的蜈蚣的光明程度 变为 $b$。（注意，$b$ 可能 $<=a$）

2. 将一节光明程度在 $a1$ 到 $a2$ 区间的蜈蚣的光明程度变为 $b1$

3. 将一节光明程度为 $a1$ 的蜈蚣的光明程度变为 $b1$ 到 $b2$ 区间的任意值。

4. 将一节光明程度在 $a1$ 到 $a2$ 区间的蜈蚣的光明程度变为 $b1$ 到 $b2$ 区间的任意值。

由于小正方形使用每种方案需要消耗一定程度的属性能量，因此每种方案都有一个独立的使用次数的上限，在一种方案中我们用 $l$ 来表示这个上限。

小正方形想要知道，自己最多能够净化几节黑暗之主的蜈蚣。
## 输入格式

第一行为三个正整数 $n$，$m$，$k$，表示黑暗之主蜈蚣身体的长度，小正方形的方案总数与上文所述的 $k$。

接下来 $m$行，每行开头为两个正整数 $op$,$l$，表示方案的种类与使用次数的上限，方案的输入方式如下：

若 $op = 1$，则接下来两个整数 $a$，$b$，意义如上文所述。

若 $op = 2$，则接下来三个整数 $a1$,$a2$,$b1$，意义如上文所述。

若 $op = 3$，则接下来三个整数 $a1$,$b1$,$b2$，意义如上文所述。

若 $op = 4$，则接下来四个整数 $a1$,$a2$,$b1$,$b2$，意义如上文所述。

数据保证，所有 $1 <= a,b,a1,b1,a2,b2 <= k$
## 输出格式

一行一个整数，表示最多能净化的节数。
## 样例

### 样例输入 #1
```
5 4 5
1 3 1 3
1 3 3 2
1 3 2 5
4 1 1 1 4 5
```
### 样例输出 #1
```
4
```
## 提示

首先使用方案1，2，3，将三节光明程度变为 $3$，接着再变为 $2$，再变为 $5$

然后使用方案 4，将一节的光明程度变为 $5$

对于 $10\%$ 的数据，$n = 1,op = 1$

对于另外 $10\%$ 的数据，$n = 1,op <= 3$

对于另外 $10\%$ 的数据，$n <= 10,op = 1$

对于另外 $20\%$ 的数据，$n <= 100,m <= 100,op = 1$

对于 $70\%$ 的数据，$n  <= 1000,m <= 1000,op <= 3,k <= 20000$

**对于前 $70\%$ 的数据，时限为 $500$ ms**

对于 $100\%$ 的数据，$n <= 10^7,m <= 20000,1 <= k <= 100000,1 <= l <= 10^5$

**对于后 $30\%$ 的数据，时限为 $8000$ ms**

**数据保证，操作为随机生成**


---

---
title: "[USACO18DEC] The Cow Gathering P"
layout: "post"
diff: 省选/NOI-
pid: P5157
tag: ['图论', '2018', 'USACO', '图论建模', '拓扑排序']
---
# [USACO18DEC] The Cow Gathering P
## 题目描述

奶牛们从世界各地聚集起来参加一场大型聚会。总共有 $ N $ 头奶牛， $ N-1 $ 对奶牛互为朋友。每头奶牛都可以通过一些朋友关系认识其他每头奶牛。

她们玩得很开心，但是现在到了她们应当离开的时间了，她们会一个接一个地离开。她们想要以某种顺序离开，使得只要至少还有两头奶牛尚未离开，所有尚未离开的奶牛都还有没有离开的朋友。此外，由于行李寄存的因素，有 $ M $ 对奶牛 $ (a_i,b_i) $ 必须满足奶牛 $ a_i $ 要比奶牛 $ b_i $ 先离开。注意奶牛 $ a_i $ 和奶牛 $ b_i $ 可能是朋友，也可能不是朋友。

帮助奶牛们求出，对于每一头奶牛，她是否可以成为最后一头离开的奶牛。可能会发生不存在满足上述要求的奶牛离开顺序的情况。
## 输入格式

输入的第 $ 1 $ 行包含两个空格分隔的整数 $ N $ 和 $ M $ 。

输入的第 $ 2 \leq i \leq N $ 行，每行包含两个整数 $ x_i $ 和 $ y_i $ ，满足 $ 1 \leq x_i $ ， $ y_i \leq N,xi \neq yi $ ，表示奶牛 $ x_i $ 和奶牛 $ y_i $ 是朋友关系。

输入的第 $ N+1 \leq i \leq N+M $ 行，每行包含两个整数 $ a_i $ 和 $ b_i $ ，满足 $ 1 \leq a_i,b_i \leq N $ ， $ a_i \neq b_i $ ，表示奶牛 $ a_i $ 必须比奶牛 $ b_i $ 先离开聚会。

输入保证 $ 1 \leq N,M \leq 10^5 $ 。对于占总分 $ 20\% $ 的测试数据，保证 $ N,M \leq 3000 $ 。
## 输出格式

输出 $ N $ 行，每行包含一个整数 $ d_i $ ，如果奶牛 $ i $ 可以成为最后一头离开的奶牛，则 $ d_i=1 $ ，否则 $ d_i=0 $ 。
## 样例

### 样例输入 #1
```
5 1
1 2
2 3
3 4
4 5
2 4

```
### 样例输出 #1
```
0
0
1
1
1

```


---

---
title: "[THUPC 2017] 机场"
layout: "post"
diff: 省选/NOI-
pid: P7425
tag: ['2017', '图论建模', '费用流', 'THUPC']
---
# [THUPC 2017] 机场
## 题目描述

飞机场有 $a+b$ 个停机位，其中 $a$ 个停机位有登机桥连接飞机和候机厅，乘客可以通过登机桥直接由候机厅登上飞机；另外 $b$ 个停机位没有登机桥和候机厅相连，所以乘客登机需要先搭乘摆渡车再登机。

毫无疑问，搭乘摆渡车的体验是非常差的，所以每位搭乘摆渡车的乘客都会产生不愉快度。

现在，给定每架飞机的乘客数量，登机时间和起飞时间；飞机需要在登机时间点选择一个空闲的停机位，在这个时间点内所有乘客会完成登机，然后飞机会一直停在该停机位，直到起飞时间；

若某飞机在时刻 $x$ 起飞，则在时刻 $x$ 该飞机所在的停机位是空闲的。

飞机场的管理层希望能够尽量减少乘客的不愉快度，为此飞机在登机时间到起飞时间之间，可以切换停机位；

假设某飞机从 $x$ 时间开始由停机位 A 切换到停机位 B，那么停机位 A 在 $x+1$ 时间是空闲的。能进行这样的切换当且仅当停机位 B 在 $x+1$ 时间是空闲的。
## 输入格式

输入有多组数据，第一行一个正整数 $T$ 表示数据组数；对于每组数据：

第一行输入三个非负整数 $n,a,b$，分别表示飞机数量、有登机桥的停机位数量、没有登机桥的停机位数量；

第二行一个浮点数 $p$，输入最多保留小数点后两位；

接下来 $n$ 行，每行三个正整数 $x,s,t$，描述一架飞机的乘客数量、登机时间和起飞时间。
## 输出格式

对于每组数据，输出一行一个整数，表示最小的不愉快度。

如果无法安排一个合理的方案使得所有飞机都完成登机，则输出 `impossible`。
## 样例

### 样例输入 #1
```
2
3 1 1
0.5
1 1 5
1 1 5
1 1 5
6 2 2
0.5
4 1 4
4 2 7
8 4 8
8 4 8
10 5 9
1 7 9
```
### 样例输出 #1
```
impossible
7
```
## 提示

题目中貌似没有给出明确的不愉快度的计算方法，据样例解释推测是不愉快度=所有乘坐摆渡车的人数$+p\times$ 每次切换停机位的飞机上的人数向下取整。
#### 数据范围
$1\le T\le 8,1\le n\le 200,0\le p\le1,1\le x\le 10^5,1\le s\le t\le10^9$
#### 样例解释
飞机从 $1$ 开始编号

在时刻 $1$，$1$ 号飞机安排到登机桥 A，乘客开始登机；目前 $1$ 号飞机在登机桥 A。

在时刻 $2$，$2$ 号飞机安排到登机桥 B，乘客开始登机；目前 $1$ 号飞机在登机桥 A，$2$ 号飞机在登机桥 B。

在时刻 $3$，$2$ 号飞机切换到摆渡车 A，此时登机桥 B 尚不可用。

在时刻 $4$，$1$ 号飞机起飞，$2$ 号飞机到达摆渡车 A， 号飞机安排到登机桥 A，$3$ 号飞机安排到登机桥 B，$4$ 号和 $3$ 号的乘客开始登机，登机完成之后 $4$ 号飞机切换到摆渡车 B，此时登机桥 A 和登机桥 B 都不空闲。

在时刻 $5$，$3$ 号飞机到达摆渡车 B，登机桥 A 变为可用，$5$ 号飞机安排到登机桥 A，开始登机；目前 $5$ 号——登机桥 A，$4$ 号——登机桥 B，$3$ 号——摆渡车 B，$2$ 号——摆渡车 A。

在时刻 $7$，$2$ 号飞机起飞，$6$ 号飞机安排到摆渡车 A。

不愉快度为 $7=1$（$6$ 号飞机乘客乘摆渡车）$+4\times 0.5$（$2$ 号飞机切换停机位）$+8\times 0.5$（$3$ 号飞机切换停机位）
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "「C.E.L.U-02」划分可重集"
layout: "post"
diff: 省选/NOI-
pid: P7477
tag: ['O2优化', '图论建模', '2-SAT', '可持久化线段树']
---
# 「C.E.L.U-02」划分可重集
## 题目描述

给你一个长度为 $n$ 的数列 $v$，请你将其划分成两个可重集 $a$ 和 $b$。你将从左至右开始划分，每个数必须至少被划分进一个可重集中。  
一个数 $v_i$ 可以被划分进 $a$ 当且仅当 $j<i \ and\ v_j\le v_i-k$ 的 $v_j$ 都没有被划分进当前的 $a$。一个数 $v_i$ 可以被划分进 $b$ 当且仅当 $j<i\ and\ v_j\ge v_i+k$ 的 $v_j$ 都没有被划分进当前的 $b$。  
同时给出了 $m$ 组关系，每组关系代表 $u$ 和 $v$ 不能划分进同一个可重集里。求能使划分成功的最小的 $k$。如果不存在合法划分，请输出 `-1`。
## 输入格式

第一行两个数 $n,m$，意义在题目描述中。 	   
接下来一行共 $n$ 个数，代表 $v$。   
下面 $m$ 行每行两个数，表示一组关系。
## 输出格式

仅一个数，答案。
## 样例

### 样例输入 #1
```
6 0
6 2 8 5 7 3
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
10 3
1 3 4 3 8 2 3 4 5 6
2 3
6 7
1 9

```
### 样例输出 #2
```
5
```
## 提示

### 样例解释

**样例解释一**

以下是一组合法的划分：  
|6|2|8|5|7|3|
|:---:|:---:|:---:|:---:|:---:|:---:|
|a|b|b|a|b|a|

**样例解释二**

以下是一组合法的划分：  
|1|3|4|3|8|2|3|4|5|6|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|b|b|a|b|a|b|a|a|a|b|

### 数据范围 
|数据编号|$n$|$m$|
|:---:|:---:|:---:|
|$1\sim2$|$\le10^3$|$0$|
|$3\sim4$|$\le10^3$|$\le10^3$|
|$5\sim6$|$\le2\times10^4$|$0$|
|$7\sim10$|$\le2\times10^4$|$\le2\times10^4$|

对于 $100\%$ 的数据，$n,m\le2\times10^4,v_i\le10^9$，保证 $u<v\le n$，没有一对相同的 $u,v$。


---

---
title: "[AHOI2021初中组] 地铁"
layout: "post"
diff: 省选/NOI-
pid: P7624
tag: ['二分', '2021', '安徽', '图论建模', '负权环', '差分约束']
---
# [AHOI2021初中组] 地铁
## 题目背景

AHOI2021 初中组 T4

**你可以选择跳过背景部分。**

小可可发现自己所学算法在生活中其实无大用，感觉十分沮丧。小雪见状还是嘀咕了几句“应该还是有用的吧”。

“不过没用又怎么样呢？算法只不过是一块名牌大学的敲门砖罢了。”

“你这话我就不同意了。跳蚤国王曾经和我说过，以后科研或者工作中我们还会和信息学竞赛中的某些东西重逢，虽然可能不会再有信息学竞赛这么难。

“除开功利的因素之外，搞信息学竞赛还是能享受到很多思考的乐趣的。”

“你说的也对。每次我在考场上不会做质疑这题是不是有问题的时候，考后看题解总是懊恼又快乐——这么自然的思路我怎么想不到呢！”

一颗理论计算机科学家的种子悄悄萌芽。

沙尘暴突然神奇般的散去了。实在坐不下去的两人决定出门坐地铁瞎逛，随性下车。即使没有刻意为之，小雪在地铁上却想出了一个有意思的问题，你能解决吗？
## 题目描述

B 市的地铁历史悠久，小雪和小可可乘坐的 X 号线是环形路线，上面分布着 $n$ 个车站，**相邻两个车站之间的铁路长度为正整数**。现在小雪进行了一些观察，得到了 $m$ 条信息，第 $i$ 条信息是如下形式之一：

1. 环上顺时针由 $S_i$ 到 $T_i$ 的一段距离不小于一个给定的值 $L_i$（$S_i$ 和 $T_i$ 是两个车站）；
2. 环上顺时针由 $S_i$ 到 $T_i$ 的一段距离不大于一个给定的值 $L_i$。

小雪想要你计算最后 X 线地铁的总长度有多少种不同的合法取值。
## 输入格式

第一行两个空格隔开的正整数 $n$ 和 $m$。

下面 $m$ 行，第 $i$ 行四个空格隔开的正整数 $type_i,S_i,T_i,L_i$，其中 $type_i \in \{1,2\}$ 表示信息的类型。车站顺时针编号为从 1 开始的连续整数。保证 $1 \le S_i,T_i \le n$ 且 $S_i \ne T_i$。
## 输出格式

仅一行一个整数，表示所求答案。如果有无穷种取值，请输出 `-1`。

**保证答案不为 0，即至少有一种可能的方案。**
## 样例

### 样例输入 #1
```
4 6
1 1 3 3
2 2 4 5
1 2 4 4
1 3 1 4
2 4 2 5
1 4 2 3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
3 2
2 1 2 1
2 2 3 1
```
### 样例输出 #2
```
-1
```
### 样例输入 #3
```
见附加文件的 subway3.in。 
```
### 样例输出 #3
```
见附加文件的 subway3.ans。
```
## 提示

【样例 1 解释】

定义数组 $d[1..4]$，其中 $d[i]$ 表示 $i$ 号车站顺时针到 $i+1$ 号车站的铁路长度。

1. $d=[1,2,2,2]$，总长度为 $7$；
2. $d=[1,2,2,3]$，总长度为 $8$；
3. $d=[1,2,2,4]$，总长度为 $9$；
4. $d=[1,2,3,4]$，总长度为 $10$。

可以证明，不存在其他的可能长度，于是答案为 $4$。

【样例 2 解释】

$3$ 号车站顺时针到 $1$ 号车站的铁路长度可以为任意正整数。

【数据范围与提示】

- 对于 $30\%$ 的数据，保证 $n,m \le 9$，$L_i \le 5$；
- 对于另外 $15\%$ 的数据，保证 $T_i$ 是 $S_i$ 顺时针方向后第一个车站；
- 对于另外 $20\%$ 的数据，保证 $T_i$ 是 $S_i$ 顺时针方向后第二个车站；
- 对于另外 $25\%$ 的数据，保证 $n,m \le 50$；
- 对于 $100\%$ 的数据，保证 $3 \le n \le 500$，$1 \le m \le 500$，$1 \le L_i \le 10^9$。


---

---
title: "「EVOI-RD1」飞鸟和蝉"
layout: "post"
diff: 省选/NOI-
pid: P7863
tag: ['图论建模', '二分图', '费用流']
---
# 「EVOI-RD1」飞鸟和蝉
## 题目背景

你骄傲地飞远，我栖息的叶片。  
听不见的宣言，重复过很多年。  
沧海月的想念羽化我昨天，  
在我成熟的笑脸，  
你却未看过一眼。
## 题目描述

蝉 Charlie 要去寻找他的好朋友飞鸟了。 

具体来说，Charlie 和他的好朋友生活的地方可以看作一个 $n \times m$ 的网格，左上角为 $(1,1)$，右下角为 $(n,m)$。每个格子 $(i,j)$ 有一个海拔高度 $h_{i,j}$。Charlie 的目标是从他的家 $(x_0,y_0)$ 出发，不重不漏地经过网格中的每个格子**恰好一次**，**最终回到自己的家** $(x_0,y_0)$。Charlie 有两种移动方式：

1. 跳跃。用这种方式，Charlie 可以到达上下左右 $4$ 个相邻格子中**海拔严格低于当前格子**的一个格子。注意跳跃不消耗体力。  
2. 飞行。用这种方式，Charlie 可以从当前格子 $(x,y)$ 到达网格中**任意一个**格子 $(x',y')$，并消耗 $h_{x',y'}-h_{x,y}$ 个单位的体力。**注意飞行所消耗的体力值可以是负数**。  

Charlie 希望用尽量少的飞行次数完成目标，**在此前提下**再令消耗的体力最少。由于网格实在太大了，Charlie 希望你能帮助他。
## 输入格式

第一行四个整数，分别代表 $n,m,x_0,y_0$，含义如上所述。  
接下来 $n$ 行，每行 $m$ 个整数，第 $i$ 行第 $j$ 个数代表格子 $(i,j)$ 的海拔 $h_{i,j}$。
## 输出格式

一行两个整数，分别代表“飞行的最少次数”与“飞行次数最少的前提下消耗的最少体力值”。
## 样例

### 样例输入 #1
```
3 3 1 1
1 2 3
8 9 4
7 6 5
```
### 样例输出 #1
```
1 8
```
### 样例输入 #2
```
3 3 2 3
1 2 3
2 2 4
1 2 2
```
### 样例输出 #2
```
5 4
```
### 样例输入 #3
```
4 4 2 3
5 9 6 2
4 2 3 6
7 2 5 2
4 2 3 9
```
### 样例输出 #3
```
7 25
```
### 样例输入 #4
```
10 10 3 3
9 13 7 7 3 8 6 5 12 8
1 4 10 11 9 10 13 6 2 18
3 3 19 6 14 2 19 10 2 16
3 1 11 14 14 18 8 8 16 14
13 5 7 4 11 17 3 16 10 20
10 16 12 19 14 12 11 20 15 10
10 15 5 1 16 2 7 5 14 5
3 19 12 19 8 13 17 7 10 13
2 10 17 6 8 11 8 7 1 4
3 7 8 1 3 5 4 11 9 17
```
### 样例输出 #4
```
36 254
```
## 提示

**本题采用捆绑测试**

样例 1 解释：从 $(1,1)$ 飞到 $(2,2)$，再绕一圈即可。

样例 2 解释：一种最佳方案为：$(2,3)-(1,3)-(1,2)-(1,1)=(2,1)-(3,1)=(2,2)=(3,2)=(3,3)=(2,3)$，其中 $=$ 代表飞行。  

- Subtask 1 (10 pts)：满足 $1 \leq n,m \leq 3$。
- Subtask 2 (20 pts)：满足 $1 \leq n,m \leq 5$。
- Subtask 3 (20 pts)：保证至多有两种不同的海拔高度。 
- Subtask 4 (50 pts)：无特殊限制。

对于 $100\%$ 的数据：
- $1 \leq n,m \leq 50$。

- $1 \leq x_0 \leq n,1 \leq y_0 \leq m,1 \leq h_{i,j} \leq 10^9$。  

出题人：[冷月葬T魂](https://www.luogu.com.cn/user/340903)


---

---
title: "「SWTR-7」Spider Solitaire"
layout: "post"
diff: 省选/NOI-
pid: P7877
tag: ['模拟', 'Special Judge', 'O2优化', '图论建模', '拓扑排序', '洛谷月赛']
---
# 「SWTR-7」Spider Solitaire
## 题目背景

#### 题目描述下方有简化题意。

![](https://cdn.luogu.com.cn/upload/image_hosting/7tdo8cdf.png)

---

小 A 在玩蜘蛛纸牌。  
为了方便你理解蜘蛛纸牌，小 A 给出了简化后的游戏规则：

- 一副牌有 $n$ 张，从小到大分别为 $1,2,\cdots,n$。
- 现有 $m$ 个牌堆，$1$ 副牌。每个牌堆中有 $0$ 张或多张牌。
- 定义「龙」$a_1,a_2,\cdots,a_d$ 为满足 $a_i-1=a_{i+1}\ (1\leq i<d)$ 的任意多张连续的牌。**一张牌也是一个「龙」。**
- 一组连续的牌可以移动，当且仅当这组牌形成了一个「龙」，且「龙」在牌堆的**最右边**。
- 一组连续的牌只能移动到一个**非空**牌堆的最右边，**且必须满足可以与该非空牌堆最右边的「龙」构成一条更大的「龙」**。
- 游戏胜利，当且仅当所有的 $n$ 张牌形成了一个「龙」。

---

例如当 $m=3$，$n=9$，局面为

```plain
9 8 4 3 2 1
7 5
6
```

时，第一个牌堆最右边的 `4 3 2 1` 形成了一个「龙」，所以 `4 3 2 1` 可以移动。将 `4 3 2 1` 移动到第二个牌堆的最右边，此时局面为

```plain
9 8
7 5 4 3 2 1
6
```

接下来将第二个牌堆右边的 `5 4 3 2 1` 移动到第三个牌堆的最右边，此时局面为

```plain
9 8
7
6 5 4 3 2 1
```

接下来将第三个牌堆的 `6 5 4 3 2 1` 移动到第二个牌堆的最右边，此时局面为

```plain
9 8
7 6 5 4 3 2 1
\
```

接下来将第二个牌堆的 `7 6 5 4 3 2 1` 移动到第一个牌堆的最右边，此时牌堆为

```plain
9 8 7 6 5 4 3 2 1
\
\
```

因为所有 $9$ 张牌形成了一个「龙」，所以游戏胜利。
## 题目描述

给定一个蜘蛛纸牌初始局面，小 A 想知道能否获得胜利。若能，请输出 $\texttt{YES}$ 以及**获胜所需的最小步数**。否则输出 $\texttt{NO}$。

小 A 还想知道，对于每张牌 $i$，如果要移动 $i$ 至少需要多少步，**包括移动 $i$ 的这一步**。如果无法移动输出 `-1`。

---

#### 「简化题意」

有 $m$ 个**横向**的数堆，数堆里共有 $n$ 个数，每个数堆里有 $0$ 或多个数。所有数堆里的数组成了 $1\sim n$ 中的所有数。

你可以将一个数堆**最右边递减且公差为 $-1$ 的**连续若干个数 $a_1,a_2,\cdots,a_c$ **按照原来的顺序移到另外一个非空数堆的最右边**，当且仅当该非空数堆最右边的一个数 $b=a_1+1$。

求将所有的 $n$ 个数都移动到同一个数堆且满足从左往右依次递减的最小步数。如果无解输出 $\texttt{NO}$。

**此外，你还需要对于每个数 $i$，输出如果要移动 $i$ 至少需要多少步。**
## 输入格式

第一行一个整数 $T$，表示子任务编号。  
第二行两个整数 $n,m$，分别表示一副牌的张数和牌堆的个数。  
接下来 $m$ 行，每行首先一个整数 $c$ 表示该牌堆中牌的个数，接下来 $c$ 个整数 $b_1,b_2,\cdots,b_c$ **从左到右**描述这个牌堆。
## 输出格式

如果能够获胜，在第一行输出 $\texttt{YES}$，**第二行输出最少步数**。否则输出一行 $\texttt{NO}$。

无论是否能够获胜，你还需输出 $n$ 行，第 $i$ 行一个**介于 $-1$ 与 $n$ 之间的整数**，表示移动 $i$ 至少需要多少步。
## 样例

### 样例输入 #1
```
0
9 3
6 9 8 4 3 2 1
2 7 5
1 6

```
### 样例输出 #1
```
YES
4
1
1
1
1
1
2
3
-1
-1

```
### 样例输入 #2
```
0
13 4
4 13 10 1 7
3 11 4 8
4 6 5 3 2
2 12 9

```
### 样例输出 #2
```
YES
10
2
2
2
3
3
3
1
1
3
6
7
8
-1

```
### 样例输入 #3
```
0
5 1
5 5 4 3 2 1

```
### 样例输出 #3
```
YES
0
-1
-1
-1
-1
-1

```
### 样例输入 #4
```
0
17 10
2 12 14
1 3
3 1 13 15
0
2 9 8
1 5
3 16 7 6
2 11 2
1 4
2 17 10

```
### 样例输出 #4
```
YES
14
4
1
1
1
1
1
1
1
1
2
3
4
3
1
2
4
-1
```
### 样例输入 #5
```
0
13 4
4 10 1 13 7
4 11 12 4 8
4 6 5 3 2
1 9

```
### 样例输出 #5
```
NO
-1
2
2
3
3
3
1
1
-1
-1
6
5
-1

```
## 提示

**「样例 1 说明」**

因为 1,2,3,4,5 可以直接移动，所以至少需要 1 步即可移动。  
因为需要先将 5 移至 6 右侧，6 才能移动，所以至少需要 2 步即可移动。  
因为需要先将 5 移至 6 右侧，再将 4,3,2,1 移至 5 右侧，7 才能移动，所以至少需要 3 步即可移动。  
显然 8,9 无法移动。

**「Special Judge」**

本题使用 Special Judge，请**严格遵守输出格式**：

- 如果你正确输出对能否获胜的判定，且如果能够获胜，你正确输出最小步数，你将获得该测试点**至少** $40\%$ 的分数。
- **在上一部分的基础上**，如果你正确输出移动每张牌的最小步数，你将获得该测试点**剩下** $60\%$ 的分数。也就是说，如果你上一部分输出错误，你在这一部分也不会获得任何分数。
- **如果你的输出格式错误，你将获得该测试点 $0\%$ 的分数**，包括但不限于**只输出对能否获胜的判定**。
- 需要特别注意的是，如果你不能正确求出移动每张牌的最小步数，请**随机输出 $[-1,n]$ 之间的任意整数**，否则你将获得该测试点 $0\%$ 的分数。
- 每行结束后你都需要输出换行符，**包括最后一行**。

checker 将在题目最后给出。

**「数据范围与约定」**

**本题采用捆绑测试。**

- Subtask #0（0 points）：是样例。
- Subtask #1（15 points）：$n\leq 3\times 10^3$，$m=2$。
- Subtask #2（15 points）：$b_i>b_{i+1}\ (1\leq i<c)$，$n\leq 3\times 10^3$。
- Subtask #3（25 points）：$n\leq 14$，$m=3$。
- Subtask #4（30 points）：$n\leq 3\times 10^3$。
- Subtask #5（15 points）：无特殊限制。

对于 $100\%$ 的数据，$1\leq n,m\leq 5\times 10^4$。时间限制 1s，空间限制 512MB。

**「题目来源」**

[Sweet Round 07](https://www.luogu.com.cn/contest/51773) D。  
idea & solution & data：[Alex_Wei](https://www.luogu.com.cn/user/123294)；验题：[chenxia25](https://www.luogu.com.cn/user/138400)。

---

以下是 checker，你需要有 testlib.h 才能成功编译。

```cpp
#include "testlib.h"
#include <bits/stdc++.h>

using namespace std;

#define ll long long
#define pii pair <int,int>
#define fi first
#define se second
#define pb emplace_back
#define mp make_pair 
#define vint vector <int>
#define vpii vector <pii>
#define all(x) x.begin(),x.end()
#define sor(x) sort(all(x))
#define rev(x) reverse(all(x))
#define mem(x,v) memset(x,v,sizeof(x))

#define rint inf.readInt
#define reof inf.readEof()
#define reoln inf.readEoln()
#define rspace inf.readSpace()

// wrong answer : quitf(_wa,"The answer is wrong")
// accepted :  quitf(_ok,"The answer is correct")
// partly correct : quitp(0.5,"The answer is partly correct")

int main(int argc,char* argv[]){
	registerTestlibCmd(argc,argv);
	
	string jans=ans.readToken();
	string pans=ouf.readToken(jans);
	int sub=rint(),n=rint(),diff=0;
	
	if(jans=="YES"){
		int jstep=ans.readInt();
		int pstep=ouf.readInt();
		if(jstep!=pstep)quitf(_wa,"The answer is wrong");
	}
	
	for(int i=1;i<=n;i++){
		int jans=ans.readInt();
		int pans=ouf.readInt();
		if(jans!=pans)diff=1;
	}
	
	while(!ouf.seekEof())ouf.readToken();
	while(!inf.seekEof())inf.readToken();
	while(!ans.seekEof())ans.readToken();
	if(diff)quitp(0.4,"The answer is partially correct");
	else quitf(_ok,"OK, you AK IOI");
	
	return 0;
}
```


---

---
title: "[USACO21DEC]  Tickets P"
layout: "post"
diff: 省选/NOI-
pid: P7984
tag: ['动态规划 DP', '线段树', 'USACO', '2021', '图论建模', '最短路']
---
# [USACO21DEC]  Tickets P
## 题目描述

Bessie 正在参加远足旅行！她当前正在旅行的路线由编号为 $1\ldots N$（$1\le N\le 10^5$）的 $N$ 个检查点组成。

有 $K$（$1\le K\le 10^5$）张票可供购买。第 $i$ 张票可以在检查站 $c_i$（$1\le c_i\le N$）以 $p_i$（$1\le p_i\le 10^9$）的价格购得，并且可以用其进入所有检查站 $[a_i,b_i]$（$1\le a_i\le b_i\le N$）。在进入任何检查站之前，Bessie 必须已购买一张允许其进入该检查站的票。一旦 Bessie 可以前往某一检查站，她就可以在未来的任何时候回到该检查站。

对于每一个 $i\in [1,N]$，如果 Bessie 最初只能进入检查点 $i$，输出使得可以进入检查点 $1$ 和 $N$ 所需的最低总价。如果无法这样做，输出 $-1$。

## 输入格式

输入的第一行包含 $N$ 和 $K$。

以下 $K$ 行，对于每一个 $1\le i\le K$，第 $i$ 行包含四个整数 $c_i$，$p_i$，$a_i$ 和 $b_i$。
## 输出格式

输出 $N$ 行，每行输出一个检查点的答案。
## 样例

### 样例输入 #1
```
7 6
4 1 2 3
4 10 5 6
2 100 7 7
6 1000 1 1
5 10000 1 4
6 100000 5 6
```
### 样例输出 #1
```
-1
-1
-1
1111
10100
110100
-1
```
## 提示

【样例解释】

如果 Bessie 从检查点 $i=4$ 开始，那么一种购得进入检查点 $1$ 和 $N$ 的方法如下：

在检查点 $4$ 购买第一张票，使 Bessie 可以进入检查点 $2$ 和 $3$。

在检查点 $2$ 购买第三张票，使 Bessie 可以进入检查点 $7$。

回到检查点 $4$ 购买第二张票，使 Bessie 可以进入检查点 $5$ 和 $6$。

在检查点 $6$ 购买第四张票，使 Bessie 可以进入检查点 $1$。

【数据范围】

- 测试点 1-7 满足 $N,K\le 1000$。
- 测试点 8-19 没有额外限制。



---

---
title: "[ONTAK2015] Bajtman i Okrągły Robin"
layout: "post"
diff: 省选/NOI-
pid: P8021
tag: ['2015', '线段树', '图论建模', '费用流']
---
# [ONTAK2015] Bajtman i Okrągły Robin
## 题目背景

**警告：滥用本题评测将被封号！**
## 题目描述

有 $n$ 个强盗，其中第 $i$ 个强盗会在 $[a_i, a_i + 1], [a_i + 1, a_i + 2], \cdots, [b_i - 1, b_i]$ 这么多段长度为 $1$ 的时间中选出一个时间进行抢劫，并计划抢走 $c_i$ 元。作为保安，你在每一段长度为 $1$ 的时间内最多只能制止一个强盗，那么你最多可以挽回多少损失呢？
## 输入格式

第一行，一个整数 $n$；

接下来 $n$ 行，每行三个整数 $a_i, b_i, c_i$。
## 输出格式

一行，一个整数，表示所求的值。
## 样例

### 样例输入 #1
```
4
1 4 40
2 4 10
2 3 30
1 3 20
```
### 样例输出 #1
```
90
```
## 提示

对于 $100\%$ 的数据，$1 \leq n \leq 5 \times 10^3$，$1 \leq a_i < b_i \leq 5 \times 10^3$，$1 \leq c_i \leq 10^4$。


---

---
title: "[GDCPC 2023] Canvas"
layout: "post"
diff: 省选/NOI-
pid: P9697
tag: ['图论', '2023', '广东', 'Special Judge', 'O2优化', '图论建模', '强连通分量', 'XCPC']
---
# [GDCPC 2023] Canvas
## 题目描述

There is a sequence of length $n$. At the beginning, all elements in the sequence equal to $0$. There are also $m$ operations, where the $i$-th operation will change the value of the $l_i$-th element in the sequence to $x_i$, and also change the value of the $r_i$-th element in the sequence to $y_i$. Each operation must be performed exactly once.

Find the optimal order to perform the operations, so that after all operations, the sum of all elements in the sequence is maximized.
## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$ indicating the number of test cases. For each test case:

The first line contains two integers $n$ and $m$ ($2 \leq n, m \leq 5 \times 10^5$) indicating the length of the sequence and the number of operations.

For the following $m$ lines, the $i$-th line contains four integers $l_i$, $x_i$, $r_i$ and $y_i$ ($1 \leq l_i<r_i \leq n$, $1 \leq x_i,y_i \leq 2$) indicating the $i$-th operation.

It's guaranteed that neither the sum of $n$ nor the sum of $m$ of all test cases will exceed $5 \times 10^5$.
## 输出格式

For each test case, first output one line containing one integer, indicating the maximum sum of all elements in the sequence after all operations. Then output another line containing $m$ integers $a_1, a_2, \cdots, a_m$ separated by a space, indicating the optimal order to perform the operations, where $a_i$ is the index of the $i$-th operation to be performed. Each integer from $1$ to $m$ (both inclusive) must appear exactly once. If there are multiple valid answers, you can output any of them.
## 样例

### 样例输入 #1
```
2
4 4
1 1 2 2
3 2 4 1
1 2 3 2
2 1 4 1
4 2
3 2 4 1
1 2 3 1
```
### 样例输出 #1
```
7
4 1 3 2
5
2 1
```
## 提示

For the first sample test case, after performing operations $4, 1, 3, 2$ in order, the sequence becomes $\{2, 2, 2, 1\}$. The sum of all elements is $7$.

For the second sample test case, after performing operations $2, 1$ in order, the sequence becomes $\{2, 0, 2, 1\}$. The sum of all elements is $5$.
## 题目翻译

**【题目描述】**

有一个长度为 $n$ 的序列，一开始序列中的所有元素均为 $0$。另外还有 $m$ 个操作，其中第 $i$ 个操作会将序列中第 $l_i$ 个元素的值改为 $x_i$，以及将序列中第 $r_i$ 个元素的值改为 $y_i$。每个操作必须恰好执行一次。

求执行操作的最优顺序，使得所有操作执行完成后，序列中所有元素之和最大。

**【输入格式】**

有多组测试数据。第一行输入一个整数 $T$ 表示测试数据组数。对于每组测试数据：

第一行输入两个整数 $n$ 和 $m$（$2 \leq n, m \leq 5 \times 10^5$）表示序列的长度和操作的个数。

对于接下来 $m$ 行，第 $i$ 行输入四个整数 $l_i$，$x_i$，$r_i$ 和 $y_i$（$1 \leq l_i<r_i \leq n$，$1 \leq x_i,y_i \leq 2$）表示第 $i$ 个操作。

保证所有数据 $n$ 之和与 $m$ 之和均不超过 $5 \times 10^5$。

**【输出格式】**

每组数据首先输出一行一个整数，表示执行操作后，所有元素的最大和。接下来输出一行 $m$ 个由单个空格分隔的整数 $a_1, a_2, \cdots, a_m$ 表示执行操作的最优顺序，其中 $a_i$ 表示第 $i$ 次执行的操作的编号。从 $1$ 到 $m$ 的每个整数（含两端）必须恰好出现一次。若有多种合法答案，您可以输出任意一种。

**【样例解释】**

对于第一组样例数据，按 $4, 1, 3, 2$ 的顺序执行操作后，序列变为 $\{2, 2, 2, 1\}$，元素之和为 $7$。

对于第二组样例数据，按 $2, 1$ 的顺序执行操作后，序列变为 $\{2, 0, 2, 1\}$，元素之和为 $5$。


---

---
title: "汪了个汪"
layout: "post"
diff: 省选/NOI-
pid: P9837
tag: ['图论', '洛谷原创', 'Special Judge', 'O2优化', '图论建模', '构造', '洛谷月赛', 'Ad-hoc']
---
# 汪了个汪
## 题目背景

你说得对，但是小 P 在 [[NOIP2022] 喵了个喵](https://www.luogu.com.cn/problem/P8866) 中没有输出操作次数，获得了 $0$ 分的好成绩。
## 题目描述

小 P 喜欢上了一款叫做《汪了个汪》的游戏。这个游戏有一个牌堆和一个金字塔形的棋盘，总共有 $3$ 关。具体地，如图所示，棋盘的边长为 $n$，第 $i$ 行有 $i$ 个格子，共 $\dfrac{n(n+1)}{2}$ 个格子。

牌堆中有 $1, 2 \dots n$ 的数字卡片 **各无穷多张**。你需要将这些数字卡片放到对应的棋盘格子中，每个格子恰好放一张数字卡片，要求满足棋盘的每一行的第一个元素 **互不相同**。

小 P 发现，这个游戏的难度会随着关卡编号而增加：

- 在第 $0$ 关中，你不必满足其他条件。
- 在第 $1$ 关中，你需要保证一行内相邻的两个数互不相同，且所有由任意一行内相邻两个数组成的 **无序二元组** 互不相同。
- 在第 $2$ 关中，你需要满足第 $1$ 关的限制，并且一行内的 **所有数** 必须互不相同。

例如，下面是 $n=5$ 时可以通过第 $2$ 关的摆放方式：

![](https://cdn.luogu.com.cn/upload/image_hosting/zdln26tg.png)

现在给定 $n$ 与关卡编号，请你帮小 P 找出一种合适的摆放方式来通过这一关。可以证明在游戏限制下一定存在一种过关方式。
## 输入格式

从标准输入中读入数据。

仅一行，包含两个整数 $n, t$，其中 $t$ 表示关卡编号。
## 输出格式

输出到标准输出。

输出 $n$ 行，第 $i$ 行包含 $i$ 个正整数（以空格分隔），表示棋盘第 $i$ 行从左到右所有的数。

如果有多种合法的解，你可以输出任何一种。
## 样例

### 样例输入 #1
```
2 1
```
### 样例输出 #1
```
1
2 1
```
### 样例输入 #2
```
5 2
```
### 样例输出 #2
```
1
2 3
4 2 5
3 5 1 4
5 4 3 1 2
```
## 提示

**【说明与提示】**

本题下发校验器（`checker.cpp`）。将 `checker.cpp` 编译成可执行文件 `checker` 后，在当前目录执行 `checker woof.in woof.out woof.ans` 即可校验你的答案是否符合规范。其中 `woof.in` 可以替换为对应输入文件名称，`woof.out` 可以替换为对应输出文件名称，也即构造结果。`woof.ans` 可以为任意文件。

返回结果说明：

- `The numbers are not in the valid range.`：说明你的输出不满足每个数字都在 $1\sim n$ 的范围内。
- `The first column does not satisfice.`：说明你的输出不满足每行开头的数互不相同。
- `The pairs of numbers are not distinct.`：说明你的输出不满足所有由任意一行内相邻两个数组成的无序二元组互不相同。
- `The adjacent numbers are not distinct.`：说明当前关卡编号 $\ge1$ 且你的输出不满足关卡 $1$ 的条件。
- `The numbers in a row are not distinct.`：说明当前关卡编号 $\ge2$ 且你的输出不满足关卡 $2$ 的条件。
- `Well done.`：说明你的构造满足要求。

---

#### 【数据范围】

| 测试点编号 | $n \leq$ | $t =$ | 特殊性质 |
| :--------: | :------: | :---: | :------: |
| $1$ | $6$ | $0$ | 无 |
| $2$ | $6$ | $2$ | 无 |
| $3 \sim 4$ | $4000$ | $2$ | A |
| $5 \sim 7$ | $500$ | $1$ | 无 |
| $8 \sim 13$ | $500$ | $2$ | 无 |
| $14 \sim 16$ | $4000$ | $1$ | 无 |
| $17 \sim 20$ | $4000$ | $2$ | 无 |

+ 特殊性质 A：保证 $n + 1$ 或 $n + 2$ 为质数。

对于 $100 \%$ 的数据，保证 $1 \leq n \leq 4000$，$t \in \{0, 1, 2\}$。


---


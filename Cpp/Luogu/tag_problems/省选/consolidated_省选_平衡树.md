---
title: "[USACO24OPEN] Splitting Haybales P"
layout: "post"
diff: 省选/NOI-
pid: P10284
tag: ['USACO', '平衡树', '2024', '均摊分析']
---
# [USACO24OPEN] Splitting Haybales P
## 题目描述

Farmer John 想要将干草堆公平地分配给他最喜欢的两头奶牛 Bessie 和 Elsie。他有 $N$（$1\le N\le 2\cdot 10^5$）个降序排序的干草堆，其中第 $i$ 个干草堆有 $a_i$ 单位干草（$2\cdot 10^5\ge a_1\ge a_2\ge \cdots \ge a_N\ge 1$）。

Farmer John 正在考虑将一个连续区间的干草堆 $a_l,\ldots,a_r$ 分配给 Bessie 和 Elsie。他决定按从 $l$ 到 $r$ 的顺序处理干草堆，当处理第 $i$ 个干草堆时他会将其交给当前干草较少的奶牛（如果并列，他会将其交给 Bessie）。

给定 $Q$（$1\le Q\le 2\cdot 10^5$）个询问，每个询问包含三个整数 $l,r,x$（$1\le l\le r\le N$，$|x|\le 10^9$）。对于每个询问，输出如果 Bessie 初始时比 Elsie 多 $x$ 单位干草，在处理干草堆 $l$ 到 $r$ 后 Bessie 将比 Elsie 多多少单位的干草。注意如果 Elsie 最终获得的干草多于 Bessie 则该值为负。
## 输入格式

输入的第一行包含 $N$。

第二行包含 $a_1\ldots a_N$。

第三行包含 $Q$。

以下 $Q$ 行包含 $l,r,x$。 
## 输出格式

输出 $Q$ 行，包含每个询问的答案。
## 样例

### 样例输入 #1
```
2
3 1
15
1 1 -2
1 1 -1
1 1 0
1 1 1
1 1 2
1 2 -2
1 2 -1
1 2 0
1 2 1
1 2 2
2 2 -2
2 2 -1
2 2 0
2 2 1
2 2 2
```
### 样例输出 #1
```
1
2
3
-2
-1
0
1
2
-1
0
-1
0
1
0
1
```
### 样例输入 #2
```
5
4 4 3 1 1
7
1 1 20
1 2 20
1 5 20
1 1 0
1 5 0
1 4 0
3 5 2
```
### 样例输出 #2
```
16
12
7
4
1
2
1
```
## 提示

### 样例解释 1

对于第 1 个询问，Elsie 初始时比 Bessie 多 2 单位干草。然后，在处理干草堆 1 后，Bessie 将收到 3 单位干草，从而 Bessie 将比 Elsie 多 1 单位干草。

对于第 3 个询问，Elsie 和 Bessie 初始时有相同的干草数量。在处理干草堆 1 后，Bessie 将收到 3 单位干草，从而 Bessie 将比 Elsie 多 3 
单位干草。

对于第 9 个询问，Bessie 初始时比 Elsie 多 1 单位干草，然后在处理第 1 个干草堆后，比 Elsie 少 2 单位干草，处理第 2 个干草堆后，比 Elsie 少 1 单位干草。

### 样例解释 2

对于第 5 个询问，有 5 个干草堆需要处理。Bessie 收到 4 单位干草，然后 Elsie 收到 4 单位干草，然后 Bessie 收到 3 单位干草，然后 Elsie 收到 1 单位干草，然后 Elsie 收到 1 单位干草。

### 测试点性质

- 测试点 $3$：$Q\le 100$。
- 测试点 $4-6$：至多存在 $100$ 个不同的 $a_i$。
- 测试点 $7-22$：没有额外限制。


---

---
title: "BZOJ4317 Atm 的树"
layout: "post"
diff: 省选/NOI-
pid: P10604
tag: ['平衡树', 'O2优化', '动态树分治']
---
# BZOJ4317 Atm 的树
## 题目背景

题目来自原 BZOJ，我们承认题面及原数据的版权均属于原 BZOJ 或将题目授权给 BZOJ 使用的出题人。如果您是版权所有者且认为我们侵犯了您的权益，可联系我们。

---

Atm 有一段时间在虐 qtree 的题目，于是，他满脑子都是 tree，tree，tree……
## 题目描述

于是，一天晚上他梦到自己被关在了一个有根树中，每条路径都有边权，一个神秘的声音告诉他，每个点到其他的点有一个距离，他需要对于每个点回答：从这个点出发的第 $k$ 小距离是多少；

如果 atm 不能回答出来，那么明天 4019 的闹钟将不会响，4019 全寝可能就迟到了，所以 atm 希望你帮帮他。
## 输入格式

第一行两个整数 $n,k$，表述询问的树的结点个数，以及题目中的 $k$。

接下来 $n-1$ 行，每行三个正整数 $u,v,w$，表示从结点 $u$ 到 $v$ 有一条边权为 $w$ 的边。
## 输出格式

共 $n$ 行，第 $i$ 行表示从结点 $i$ 出发的第 $k$ 小距离为多少。
## 样例

### 样例输入 #1
```
5 2
1 5 2
1 2 4
2 3 6
2 4 5
```
### 样例输出 #1
```
4
5
10
9
6
```
## 提示

对于所有数据，$1\leq n\leq 15000$，$1\leq k\leq 5000$，$1\leq w\leq 10$。树的根为结点 $1$。


---

---
title: "[BalticOI 2024] Tiles"
layout: "post"
diff: 省选/NOI-
pid: P10763
tag: ['线段树', '平衡树', '2024', '扫描线', 'BalticOI（波罗的海）']
---
# [BalticOI 2024] Tiles
## 题目背景

翻译自 [BalticOI 2024 Day2 T2](https://boi2024.lmio.lt/tasks/d2-tiles-statement.pdf)。
## 题目描述

有一个存在 $N$ 个顶点的大教堂，顶点坐标依次为 $(x_i,y_i)$，对于每个 $1 \leq i < N$，存在一条 $i$ 与 $i+1$ 之间的边，此外，还存在一条 $N$ 到 $1$ 的边。

大教堂每条边都与 $x$ 轴或 $y$ 轴平行。此外，大教堂是一个简单多边形，即：

- 每个顶点恰好由两条边相交
- 任何一对边只能在顶点处相交

你有无数块 $2 \times 2$ 的瓷砖，你希望用这些瓷砖覆盖大教堂的大部分区域，具体来说，你想选择一条垂直线，并覆盖该线左侧的大教堂部分。对于任何整数 $k$，设 $L_k$ 为包含 $x$ 坐标等于 $k$ 的点的垂直线。对 $L_k$ 左侧大教堂部分的覆盖，是指在平面上放置一定数量的瓷砖，使得：

- 多边形内部且 $x$ 坐标小于 $k$ 的每个点都被某块瓷砖覆盖
- 多边形外部或 $x$ 坐标大于 $k$ 的点都不被任何瓷砖覆盖
- 瓷砖的内部不重叠

大教堂中任何顶点的最小 $x$ 坐标为 $0$。我们设 $M$ 为大教堂中任何顶点的最大 $x$ 坐标。

请你求出最大的满足条件的 $k\ (0 \leq k \leq M)$，根据定义，一定存在答案为 $0$。
## 输入格式

第一行两个整数 $N,M$。

接下来 $N$ 行，每行两个整数 $(x_i,y_i)$。这些顶点按照顺时针或逆时针顺序给出。
## 输出格式

输出一个答案 $k$。
## 样例

### 样例输入 #1
```
14 6
0 1
0 3
2 3
2 4
0 4
0 6
3 6
3 7
4 7
6 7
6 5
3 5
3 2
3 1

```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
4 3
0 0
0 3
3 3
3 0
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
18 9
0 2
2 2
2 1
4 1
4 0
9 0
9 2
4 2
4 4
7 4
7 3
9 3
9 6
4 6
4 5
2 5
2 4
0 4
```
### 样例输出 #3
```
6
```
## 提示

| 子任务编号 | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: |
| $1$ | $N=4$ | $4$ |
| $2$ | $N \leq 6$ | $9$ |
| $3$ | $x_N=0,y_N=0$，对于 $1 \leq i \leq N-2$，$x_i \leq x_{i+1},y_i \geq y_{i+1}$ | $11$ |
| $4$ | $M \leq 1000$ 且 $y_i \leq 1000$ | $19$ |
| $5$ | $y_i$ 都为偶数 | $22$ |
| $6$ | $x_i$ 都为偶数 | $25$ |
| $7$ | 无特殊性质 | $10$ |

对于所有数据，$4 \leq N \leq 2 \times 10^5$，$1 \leq M \leq 10^9$，$0 \leq y_i \leq 10^9$，$\min(\{x_i\}) = 0,\max(\{x_i\}) = M$。

对于样例一，下面是对于 $k=2$ 的覆盖。

![](https://cdn.luogu.com.cn/upload/image_hosting/q9qi2e3b.png)

可以发现这是最大的情况了。

对于样例二，没有正值 $k$，使得 $L_k$ 左侧的教堂部分可以用瓷砖覆盖。

对于样例三，图示如下。

![](https://cdn.luogu.com.cn/upload/image_hosting/6kpbkvbn.png)


---

---
title: "[PA 2016] 雨后的蘑菇 2 / Grzyby po deszczu 2"
layout: "post"
diff: 省选/NOI-
pid: P11608
tag: ['动态规划 DP', '贪心', '2016', '平衡树', 'PA（波兰）']
---
# [PA 2016] 雨后的蘑菇 2 / Grzyby po deszczu 2
## 题目背景


译自 [Potyczki Algorytmiczne 2016](https://sio2.mimuw.edu.pl/c/pa-2016-1/p/) R3 Grzyby po deszczu 2 [A] (GRZ)。

## 题目描述


给定长度为 $n$ 的整数数列 $a_1,\ldots,a_n$ 和 $b_1,\ldots,b_n$。

第 $1$ 天早上，第 $i$ 块地上有 $b_i$ 个蘑菇。每天的晚上，第 $i$ 块地上都会长出 $a_i$ 个蘑菇。

采蘑菇只能在早上进行，一次只能在一块地上采集，一次采集的数量没有限制。

对于 $k=1,2,\cdots,n$，求出：如果在前 $k$ 天**每天早上**选择一块地（可以重复选择同一块地）采蘑菇，最多能采多少个蘑菇？
## 输入格式


第一行，一个正整数 $n$。

接下来 $n$ 行，每行两个非负整数 $a_i,b_i$。

## 输出格式

输出 $n$ 行，第 $i$ 行一个整数，表示 $k=i$ 时的答案。

## 样例

### 样例输入 #1
```
3
5 10
16 0
5 10
```
### 样例输出 #1
```
10
26
57
```
## 提示


- $1\le n\le 10^6$；
- $0\le a_i\le 10^6$；
- $0\le b_i\le 10^{12}$。



---

---
title: "[迷宫寻路 Round 3] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P11627
tag: ['贪心', '线段树', '平衡树', '树状数组', 'O2优化', '树的遍历']
---
# [迷宫寻路 Round 3] 游戏
## 题目描述

小 L 正在玩游戏，游戏地图是一颗 $n$ 个节点的树，定义一条树上路径的长度为路径上所有边的边权之和，路径可以重复经过点和边。特别的，若路径不包含任何边，则其长度为 $0$。

小 L 会选择一个点作为必经点 $t$，接着，小 L 会设置每条边的边权，使得边的边权构成一个 $1$ 到 $n-1$ 的**排列**。

定义：小 L 的得分为 $\sum_{1 \leq u,v \leq n} \operatorname{dist}(u,v)$，其中 $\operatorname{dist}(u,v)$ 为在经过必经点 $t$ 的前提下，长度**最小的**从 $u$ 到 $v$ 的路径的长度。

小 L 希望最大化自己的得分，请你解答以下问题：

第一问：求他得分的**最大值**对 $998244353$ 取模的值。

第二问：求若要最大化他的得分，小 L 应该选择的必经点 $t$ 和小 L 每条边应设置的边权。

## 输入格式

一行一个整数 $n$，表示节点数。

接下来 $n-1$ 行，每行两个整数 $u,v$ 表示树上一条连接点 $u$ 和点 $v$ 的边。
## 输出格式

输出共三行。

第一行一个整数，表示【小 L 得分的最大值】对 $998244353$ 取模的值。

第二行一个整数，表示小 L 应该选择的必经点 $t$，如有多种 $t$ 符合题意，请输出最小的 $t$。

第三行 $n-1$ 个整数，**按边的输入顺序**依次给出小 L 每条边应设置的边权。如有多种答案，请输出边权的字典序最小的答案。

注意：在小 L 得分最大的前提下，请首先最小化 $t$，其次最小化边权的字典序。

这里“边权的字典序”是指按边的输入顺序将边的边权看作一个排列，这个排列的字典序。
## 样例

### 样例输入 #1
```
5
1 2
1 3
2 4
2 5
```
### 样例输出 #1
```
280
3
3 4 1 2
```
### 样例输入 #2
```
7
5 1
1 7
6 2
2 1
4 5
3 2
```
### 样例输出 #2
```
1106
4
5 1 2 4 6 3
```
### 样例输入 #3
```
10
3 6
7 3
8 10
5 9
9 1
4 8
1 8
2 3
6 10
```
### 样例输出 #3
```
5240
5
4 1 6 9 8 2 7 3 5
```
### 样例输入 #4
```
10
1 2
1 3
3 4
3 5
2 6
6 7
7 8
8 9
9 10
```
### 样例输出 #4
```
5660
10
4 3 1 2 5 6 7 8 9
```
### 样例输入 #5
```
20
5 18
16 11
6 15
7 14
8 7
10 20
3 4
14 6
9 8
18 11
17 4
11 10
4 11
2 13
13 12
12 15
15 20
19 9
1 8
```
### 样例输出 #5
```
79480
19
1 2 14 16 17 12 3 15 18 7 4 11 9 5 8 10 13 19 6
```
### 样例输入 #6
```
10
7 8
3 2
6 7
2 10
8 3
4 1
9 2
1 3
5 7

```
### 样例输出 #6
```
4340
5
8 6 1 2 7 3 4 5 9 
```
### 样例输入 #7
```
见附件
```
### 样例输出 #7
```
见附件
```
## 提示

**本题采用捆绑测试。**

对于所有数据，$1\le n\le 10^5$。

| 子任务编号 | $n\leq$ | 特殊性质 1 | 特殊性质 2 | 分数 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $50$ | 否 | 否 | $10$ |
| $1$ | $1000$ | 否 | 否 | $20$ |
| $2$ | $10^5$ | 是 | 否 | $10$ |
| $3$ | $10^5$ | 否 | 是 | $10$ |
| $4$ | $10^5$ | 否 | 否 | $50$ |

特殊性质 1：存在一个对点重标号的方案，使得第 $i$ 条边为 $(1,i+1)$。

特殊性质 2：存在一个对点重标号的方案，使得第 $i$ 条边为 $(i,i+1)$。



---

---
title: "[集训队互测 2015] 胡策的数列"
layout: "post"
diff: 省选/NOI-
pid: P11735
tag: ['2015', '平衡树', '集训队互测']
---
# [集训队互测 2015] 胡策的数列
## 题目描述

在 OI 界，有一个无人不知无人不晓，OI 水平前无古人后无来者的胡策，江湖人称一眼秒题胡大爷！

今天胡策正在研究一个远古传下来的数列：$a_0, a_1, a_2, \dots$，数列的第 $k$ 项为 $a_k$。这个数列有特别的性质，对于 $i > 1$ 有：$25 a_i + 20 a_{i - 1} = 12 a_{i - 2}$。因为流传的时间太过久远，$a_0$ 和 $a_1$ 的值都已经看不清了，但是在最后还记载着，这个数列有一个特别的性质：对于任意的 $i \geq 0$，都有  $a_i \geq 0$。

然而胡策已经看穿了一切：对于任意一个正数 $t$，满足 $a_0 = t$ 的数列 $a$ 是唯一的！但是，他想拿这个问题考一考拜胡策为师的你。

具体来说，胡策会给你一个长度为 $n$ 的表格，一开始每个格子都写着 $0$。有时他会让你将 $a_0 = t$ 时的数列 $a$ 从第 $p$ 项到第 $p + r - l$ 项的值分别写入表格中第 $l$ 到第 $r$ 格（覆盖原有的值），有时他会询问表格中某一段连续的格子中的数的和。

当然，作为胡策的弟子，你必须在胡策提出一个询问的时候马上作出回应。

因为这是一个远古的问题，胡策只给了你一台远古的计算机，它只有 64MB 的内存。
## 输入格式

第一行两个正整数 $n,m$。分别表示表格的长度和操作个数。

接下来 $m$ 行，每行描述一个操作。每行的第一个整数 $\mathrm{type}$ 描述了操作的类型，$\mathrm{type} = 1$ 表示是修改操作，$\mathrm{type} = 2$ 表示是询问操作。

如果是修改操作，接下来有四个整数 $l,r,t,p$，意义如上所述。

如果是询问操作，接下来有两个整数 $l,r$，意义如上所述。

由于胡策需要确定你是在线回答他的问题，输入中的 $l, r$ 是加密了的。于是你需要把输入中的 $l, r$ 分别异或 $\mathrm{lastans}$ 来得到实际的 $l, r$。$\mathrm{lastans}$ 表示上一次询问操作的答案，初始为 $0$。保证实际的 $l, r$ 满足 $1 \leq l \leq r \leq n$。
## 输出格式

对每个询问操作输出一行，表示询问的答案。

答案一定能写成 $\frac{v}{u}$ 的形式，其中 $v, u$ 是互质的整数，且 $u > 0$。为了避免分数，你只用输出一个介于 $0$ 到 $10^9 + 8$ 之间的整数 $x$ 满足 $ux \equiv v \pmod{10^9 + 9}$ 来表示答案。显然在本题中，这样的 $x$ 是唯一的。
## 样例

### 样例输入 #1
```
3 3
1 1 3 2 3
1 2 2 4 5
2 1 3
```
### 样例输出 #1
```
867840008
```
### 样例输入 #2
```
1000000000 3
1 1 12450 6666666 23333333
1 6666 99999 2333 44444
2 1 1000000000
```
### 样例输出 #2
```
431287288
```
## 提示

### 数据范围

- 对于 20% 的数据，$n,m \leq 1000$。
- 对于 50% 的数据，$n,m \leq 30000$。
- 对于 100% 的数据，$1 \leq n \leq 10^9$，$1 \leq m \leq 10^5$，$1 \leq t \leq 10^9$，$1 \leq p \leq 10^9$。


---

---
title: "[集训队互测 2024] 长野原龙势流星群"
layout: "post"
diff: 省选/NOI-
pid: P12479
tag: ['二分', '平衡树', '集训队互测', '2024', 'Special Judge', '树形 DP', '凸包']
---
# [集训队互测 2024] 长野原龙势流星群
## 题目描述

Naganohara Yoimiya 给了你一棵 $n$ 个节点的有根树，$1$ 号节点是根节点，每个点有点权 $w_i$。

你需要对每个点 $u$ 找到一个以 $u$ 为根的非空连通块，并最大化这个连通块内所有点的点权的平均值。

对每个点 $u$ 输出这个最大的平均值。
## 输入格式

第一行一个正整数 $n$。

接下来一行 $n-1$ 个正整数 $p_2,p_3,\cdots,p_n$，$p_i$ 表示 $i$ 的父节点的编号，保证 $p_i< i$。

接下来一行 $n$ 个正整数 $w_1,w_2,\cdots,w_n$。
## 输出格式

输出 $n$ 行，第 $i$ 行输出一个实数表示以节点 $i$ 为根的连通块内点权平均值的最大值。

如果你的答案和标准答案的相对误差或绝对误差不超过 $10^{-6}$ 则视为正确。
## 样例

### 样例输入 #1
```
6
1 2 2 1 4
3 1 5 6 6 7
```
### 样例输出 #1
```
4.6666666667
4.7500000000
5.0000000000
6.5000000000
6.0000000000
7.0000000000
```
## 提示

### 测试点约束

对于所有数据，$1\le n\le 2\times 10^5,1\le w_i\le 10^9$。

- Subtask 1（$10$ 分）：$1\le n\le 2000$。
- Subtask 2（$10$ 分）：$p_i=\lfloor i/2\rfloor$。
- Subtask 3（$40$ 分）：$1\le n\le 50000$。
- Subtask 4（$40$ 分）：无特殊限制。


---

---
title: "[POI 2020/2021 R2] 收拾背包 / Pakowanie plecaka"
layout: "post"
diff: 省选/NOI-
pid: P12912
tag: ['动态规划 DP', '线段树', '平衡树', '堆', 'POI（波兰）', '2021']
---
# [POI 2020/2021 R2] 收拾背包 / Pakowanie plecaka
## 题目背景

翻译来自于 [LibreOJ](https://loj.ac/p/4829)。
## 题目描述

**题目译自 [XXVIII Olimpiada Informatyczna – II etap](https://sio2.mimuw.edu.pl/c/oi28-2/dashboard/) [Pakowanie plecaka](https://szkopul.edu.pl/problemset/problem/tFYVKjavLmyczkxMH7WFewXe/statement/)**

Bajtazar 准备骑自行车去 Bajtocji 旅游。他现在在考虑要带什么有用的东西在背包里。可惜的是，他没有多少时间，所以他把可能需要的装备按照重要性从高到低排列了一下。他的做法很简单：按顺序检查每个物品，只要不超过背包的承重（当然，要算上之前放进去的物品），就带上它。

还有一个关键的问题：要带什么样的背包呢？Bajtazar 觉得只要带上至少 $k$ 个物品，他就能在旅途中应付得来。可是他还不确定 $k$ 到底是多少。那么，他的背包的承重至少应该是多少，才能保证他带上至少 $k$ 个物品呢？
## 输入格式

输入的第一行包含一个整数 $n\ (1 \leq n \leq 5\cdot 10^5)$，表示 Bajtazar 考虑带上的物品的数量。输入的第二行包含 $n$ 个用空格分隔的整数 $w_{1}, w_{2}, \ldots, w_{n}\ (1 \leq w_{i} \leq 10^{9})$，表示物品的重量，按照 Bajtazar 检查的顺序排列。
## 输出格式

输出一行 $n$ 个用空格分隔的整数，第 $k$ 个数表示能保证 Bajtazar 带上至少 $k$ 个物品时背包的最小承重。
## 样例

### 样例输入 #1
```
6
10 8 3 30 5 10
```
### 样例输出 #1
```
3 13 21 26 36 66
```
## 提示

**样例 1 解释**

输出的第二个数是 $13$。如果背包的承重是 $13$，那么 Bajtazar 会带上第一个物品（重量为 $10$），不会带上第二个物品（因为他只剩下 $3$ 的承重，而物品重量为 $8$），然后会带上重量为 $3$ 的物品。总共他会带上正好需要的两个物品。

**附加样例**
1. 该样例满足 $n=20$，奇数位置的物品重量为 $10^{8}$，偶数位置的物品重量为 $10^{9}$。
2. 该样例满足 $n=200, w_{i}=(i \bmod 47)+1$。
3. 该样例满足 $n=5000$，物品的重量是从区间 $\left[1,10^{9}\right]$ 随机选取的。
4. 该样例满足 $n=5\cdot 10^5, w_{i}=\left\lfloor\frac{(i \bmod 200)}{100}\right\rfloor+1$。
5. 该样例满足 $n=5\cdot 10^5, w_{i}=\left(F_{i} \bmod 100\right)+1$，其中 $F_{0}=0, F_{1}=1, F_{i+2}=F_{i}+F_{i+1}$。
6. 该样例满足 $n=5\cdot 10^5$，物品的重量是从区间 $[1,10^{9}]$ 随机选取的。

详细子任务附加限制及分值如下表所示。

| 子任务 | 附加限制 | 分值 |
| :---: | :--: | :---: |
| $1$ | $n \leq 20$ | $8$ |
| $2$ | $n \leq 200$ | $10$ |
| $3$ | $n \leq 5000$ | $20$ |
| $4$ | $w_{i} \leq 2$ | $8$ |
| $5$ | $w_{i} \leq 100$ | $20$ |
| $6$ | 无附加限制 | $34$ |


---

---
title: "[NWRRC 2023] Loops"
layout: "post"
diff: 省选/NOI-
pid: P13592
tag: ['平衡树', '2023', 'Special Judge', '排序', '构造', 'ICPC', 'Ad-hoc', 'NWRRC']
---
# [NWRRC 2023] Loops
## 题目描述

Consider four integers $A$, $B$, $C$, and $D$, such that $A < B < C < D$. Let's put them in the corners of a square in some order and draw a loop $A - B - C - D - A$. Depending on the arrangement of the integers, we can get different loop shapes, but some arrangements produce the same shape:

![](https://cdn.luogu.com.cn/upload/image_hosting/8hyu6a9v.png)

There are three possible loop shapes we can get:

![](https://cdn.luogu.com.cn/upload/image_hosting/ikan9lhl.png)

Now consider an $n\times m$ matrix filled with distinct integers from $1$ to $nm$, inclusive. Each $2\times 2$ square in this matrix can be seen as a square with integers in its corners. Let's build a loop for each of these squares like we did before:

![](https://cdn.luogu.com.cn/upload/image_hosting/y3rml1pm.png)

Your task is to perform the inverse operation. You are given the shape types for all $(n-1)(m-1)$ loops, and you need to build an $n\times m$ matrix filled with distinct integers from $1$ to $nm$, inclusive, that produces these shapes.
## 输入格式

The first line contains two integers $n$ and $m$ ($2\le n, m\le 500$).

Each of the next $n-1$ lines contains a string of $m-1$ characters without spaces. Each character is a digit from $1$ to $3$, denoting the type of the shape of the corresponding loop.
## 输出格式

Print an $n\times m$ matrix filled with distinct integers from $1$ to $nm$, inclusive, that produces the shapes of the loops in the input.

It can be shown that such a matrix always exists. If there are multiple answers, print any of them.
## 样例

### 样例输入 #1
```
3 4
113
231
```
### 样例输出 #1
```
9 11 7 12
4 6 1 8
2 10 5 3
```


---

---
title: "杏酥桐"
layout: "post"
diff: 省选/NOI-
pid: P13840
tag: ['线段树', '平衡树', 'Ad-hoc']
---
# 杏酥桐
## 题目描述

Yuki 有一棵仅包含根结点 $1$ 的有根树 $T$ 和一个变量 $n$，初始时 $n=1$。

给定 $q$ 次操作。操作有以下 $2$ 种：

- $1\ u_i\ x_i$：在 $u_i$ 的第 $x_i$ 个儿子后插入结点 $n+1$；特殊地，若 $x_i=0$，则表示将结点 $n+1$ 作为 $u_i$ 的第 $1$ 个儿子插入。$u_i$ 的其余儿子的相对顺序不变。设 $u_i$ 的儿子个数为 $s_{u_i}$，则保证 $1 \le u_i \le n$ 且 $0 \le x_i \le s_{u_i}$。在执行此操作后 $n$ 的值变为 $n+1$。

- $2\ v_i\ k_i$：查询对树 $T$ 进行 $k_i$ 次左儿子右兄弟变换后结点 $v_i$ 的父亲结点。其中，左儿子右兄弟变换指：对于树 $T$ 上的结点 $u$，将结点 $u$ 在原树中的第一个儿子作为结点 $u$ 在新树上的左儿子，将结点 $u$ 在原树中的下一个兄弟作为结点 $u$ 在新树上的右儿子。保证 $2 \le v_i \le n$ 且 $1 \le k_i \le 10^9$。**注意，此操作不会真的对树 $\boldsymbol T$ 进行 $\boldsymbol{k_i}$ 次左儿子右兄弟变换，也就是说在执行此操作后树形态不变。**

你需要对于每个 $2$ 操作求出答案。
## 输入格式

**本题有多组测试数据。**

输入的第一行包含两个正整数 $c,T$，分别表示测试点编号和测试数据组数。样例满足 $c=0$。

接下来依次输入每组测试数据。对于每组测试数据：

- 第一行一个正整数 $q$。
- 接下来 $q$ 行，第 $i$ 行三个整数 $o_i,u_i,x_i$ 或 $o_i,v_i,k_i$，格式同题目描述。
## 输出格式

对于每组测试数据中的每个 $2$ 操作，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
0 2
8
1 1 0
1 2 0
2 3 1
1 3 0
1 1 0
1 4 0
1 4 1
2 7 1
8
1 1 0
2 2 2
2 2 2
1 2 0
2 3 1
1 3 0
1 4 0
2 4 3
```
### 样例输出 #1
```
2
6
1
1
2
3
```
## 提示

### 样例 1 解释

该样例包含两组测试数据，对于第一组测试数据：

- 第 $1$ 次操作插入结点 $2$ 作为结点 $1$ 的儿子结点。

- 第 $2$ 次操作插入结点 $3$ 作为结点 $2$ 的儿子结点。

- 此时树包含 $2$ 条边 $(1, 2), (2, 3)$，经过 $1$ 次左儿子右兄弟变换后，树仍为 $(1, 2), (2, 3)$，$3$ 的父亲结点为 $2$。

- 接下来进行 $4$ 次结点插入操作，操作结束后的树形如：

  ![](https://cdn.luogu.com.cn/upload/image_hosting/52ogqvhl.png)
  
- 经过 $1$ 次左儿子有兄弟变换后，树形如：

  ![](https://cdn.luogu.com.cn/upload/image_hosting/ck7oyglw.png)

  此时结点 $7$ 的父亲结点为 $6$。

### 数据范围

对于所有测试数据，保证：

- $1 \le T \le 3$；
- $1 \le q \le 10^6$；
- $o_i \in \{1,2\}$，$1 \le u_i \le n$，$0 \le x_i \le s_{u_i}$，$2 \le v_i \le n$，$1 \le k_i \le 10^9$。

| 测试点编号 |     $q \le$     |   $k_i$   | 特殊性质 |
| :--------: | :-------------: | :-------: | :------: |
|  $1\sim3$  |     $10^2$      | $\le10^2$ |    无    |
|   $4,5$    | $3 \times 10^3$ |   $=1$    |    无    |
|   $6,7$    | $3 \times 10^3$ |  $=10^9$  |    无    |
| $8\sim10$  | $3 \times 10^3$ | $\le10^9$ |    无    |
|  $11,12$   | $5 \times 10^5$ |   $=1$    |    无    |
|  $13,14$   | $5 \times 10^5$ |  $=10^9$  |    无    |
|    $15$    | $5 \times 10^5$ | $\le10^9$ |    A     |
|  $16,17$   | $5 \times 10^5$ | $\le10^9$ |    B     |
|  $18,19$   | $5 \times 10^5$ | $\le10^9$ |    C     |
| $20\sim22$ | $5 \times 10^5$ | $\le10^9$ |    无    |
| $23\sim25$ |     $10^6$      | $\le10^9$ |    无    |

- 特殊性质 A：对于所有 $1$ 操作，均有 $u_i=1$。
- 特殊性质 B：对于所有满足 $1\le i \lt j \le q$ 的正整数 $i,j$，均有 $op_i \le op_j$。
- 特殊性质 C：对于所有 $1$ 操作，均有 $x_i=cnt_{u_i}$。


---

---
title: "[APIO2012] 派遣"
layout: "post"
diff: 省选/NOI-
pid: P1552
tag: ['动态规划 DP', '2012', '平衡树', 'APIO', '可并堆', '栈']
---
# [APIO2012] 派遣
## 题目背景

在一个忍者的帮派里，一些忍者们被选中派遣给顾客，然后依据自己的工作获取报偿。

## 题目描述

在这个帮派里，有一名忍者被称之为 Master。除了 Master 以外，每名忍者都有且仅有一个上级。为保密，同时增强忍者们的领导力，所有与他们工作相关的指令总是由上级发送给他的直接下属，而不允许通过其他的方式发送。

现在你要招募一批忍者，并把它们派遣给顾客。你需要为每个被派遣的忍者支付一定的薪水，同时使得支付的薪水总额不超过你的预算。另外，为了发送指令，你需要选择一名忍者作为管理者，要求这个管理者可以向所有被派遣的忍者发送指令，在发送指令时，任何忍者（不管是否被派遣）都可以作为消息的传递人。管理者自己可以被派遣，也可以不被派遣。当然，如果管理者没有被排遣，你就不需要支付管理者的薪水。

   
你的目标是在预算内使顾客的满意度最大。这里定义顾客的满意度为派遣的忍者总数乘以管理者的领导力水平，其中每个忍者的领导力水平也是一定的。

   
写一个程序，给定每一个忍者 $i$ 的上级 $B_i$，薪水 $C_i$，领导力 $L_i$，以及支付给忍者们的薪水总预算 $M$，输出在预算内满足上述要求时顾客满意度的最大值。

## 输入格式

第一行包含两个整数 $N$ 和 $M$，其中 $N$ 表示忍者的个数，$M$表示薪水的总预算。

 
接下来 $N$ 行描述忍者们的上级、薪水以及领导力。其中的第i行包含三个整数 $B_i,C_i,L_i$ 分别表示第 $i$ 个忍者的上级，薪水以及领导力。Master 满足 $B_i=0$，并且每一个忍者的老板的编号一定小于自己的编号 $B_i\lt i$。

## 输出格式

一行一个整数，表示在预算内顾客的满意度的最大值。

## 样例

### 样例输入 #1
```
5 4
0 3 3
1 3 5
2 2 2
1 2 4
2 3 1

```
### 样例输出 #1
```
6

```
## 提示

$1 \le N \le 10^5$，$1 \le M \le 10^9$，$0 \le B_i \lt i$，$1 \le C_i \le M$，$1 \le L_i \le 10^9$。

对于 $30\%$ 的数据，$N \le 3000$。



---

---
title: "[USACO12OPEN] Bookshelf G"
layout: "post"
diff: 省选/NOI-
pid: P1848
tag: ['2012', '线段树', '二分', 'USACO', '平衡树']
---
# [USACO12OPEN] Bookshelf G
## 题目描述

When Farmer John isn't milking cows, stacking haybales, lining up his cows, or building fences, he enjoys sitting down with a good book.  Over the years, he has collected N books (1 <= N <= 100,000), and he wants to build a new set of bookshelves to hold them all.

Each book i has a width W(i) and height H(i).  The books need to be added to a set of shelves in order; for example, the first shelf should contain books 1...k for some k, the second shelf should start with book k+1, and so on.  Each shelf can have a total width of at most L (1 <= L <= 1,000,000,000).  The height of a shelf is equal to the height of the tallest book on that shelf, and the height of the entire set of bookshelves is the sum of the heights of all the individual shelves, since they are all stacked vertically.

Please help FJ compute the minimum possible height for the entire set of bookshelves.
## 输入格式

第一行：两个数 $N$ 和 $L$ 。

接下来 $N$ 行每行两个数 $H_i$ 和 $W_i$ 。
## 输出格式

一个数，书架高度的最小值。
## 样例

### 样例输入 #1
```
5 10
5 7
9 2
8 5
13 2
3 8
```
### 样例输出 #1
```
21
```
## 题目翻译

当农夫约翰闲的没事干的时候，他喜欢坐下来看书。多年过去，他已经收集了 $N$ 本书 $(1 \le N \le 100,000)$ ， 他想造一个新的书架来装所有书。

每本书 $i$ 都有宽度 $W_i$ 和高度 $H_i$ 。书需要按顺序添加到一组书架上；比如说，第一层架子应该包含书籍 $1  ... k$ ，第二层架子应该以第 $k + 1$ 本书开始，以下如此。每层架子的总宽度最大为 $L(1 \le L \le 1,000,000,000)$ 。每层的高度等于该层上最高的书的高度，并且整个书架的高度是所有层的高度的总和，因为它们都垂直堆叠。

请帮助农夫约翰计算整个书架的最小可能高度。

有 $N(1 \le N \le 100,000)$ 本书，每本书有一个宽度 $W_i$ ，高度 $H_i$ ，$(1 \le H_i \le 1,000,000; 1 \le W_i \le L)$ 。

现在有足够多的书架，书架宽度最多是 $L (1 \le L \le 1,000,000,000)$ ，把书按顺序 $($先放 $1$ ，再放 $2.....)$ 放入书架。某个书架的高度是该书架中所放的最高的书的高度。

将所有书放入书架后，求所有书架的高度和的最小值。


---

---
title: "[NOI2005] 维护数列"
layout: "post"
diff: 省选/NOI-
pid: P2042
tag: ['模拟', '2005', '平衡树', 'NOI']
---
# [NOI2005] 维护数列
## 题目描述


请写一个程序，要求维护一个数列，支持以下 $6$ 种操作：

| 编号 | 名称 | 格式 | 说明 |
| :-----------: | :-----------: | :-----------: | :----------- |
| 1 | 插入 | $\operatorname{INSERT}\ posi \ tot \ c_1 \ c_2 \cdots c_{tot}$ | 在当前数列的第 $posi$ 个数字后插入 $tot$ 个数字：$c_1, c_2 \cdots c_{tot}$；若在数列首插入，则 $posi$ 为 $0$ |
| 2 | 删除 | $\operatorname{DELETE} \ posi \ tot$ | 从当前数列的第 $posi$ 个数字开始连续删除 $tot$ 个数字 |
| 3 | 修改 | $\operatorname{MAKE-SAME} \ posi \ tot \ c$ | 从当前数列的第 $posi$ 个数字开始的连续 $tot$ 个数字统一修改为 $c$ |
| 4 | 翻转 | $\operatorname{REVERSE} \ posi \ tot$ | 取出从当前数列的第 $posi$ 个数字开始的 $tot$ 个数字，翻转后放入原来的位置 |
| 5 | 求和 | $\operatorname{GET-SUM} \ posi \ tot$ | 计算从当前数列的第 $posi$ 个数字开始的 $tot$ 个数字的和并输出 |
| 6 | 求最大子列和 | $\operatorname{MAX-SUM}$ | 求出当前数列中和最大的一段子列，并输出最大和 |
## 输入格式

第一行包含两个整数 $N$ 和 $M$，$N$ 表示初始时数列中数的个数，$M$ 表示要进行的操作数目。

第二行包含 $N$ 个数字，描述初始时的数列。以下 $M$ 行，每行一条命令，格式参见问题描述中的表格。
## 输出格式

对于输入数据中的 $\operatorname{GET-SUM}$ 和 $\operatorname{MAX-SUM}$ 操作，向输出文件依次打印结果，每个答案（数字）占一行。
## 样例

### 样例输入 #1
```
9 8 
2 -6 3 5 1 -5 -3 6 3 
GET-SUM 5 4
MAX-SUM
INSERT 8 3 -5 7 2
DELETE 12 1
MAKE-SAME 3 3 2
REVERSE 3 6
GET-SUM 5 4
MAX-SUM
```
### 样例输出 #1
```
-1
10
1
10
```
## 提示

#### 数据规模与约定

- 你可以认为在任何时刻，数列中至少有 $1$ 个数。
- 输入数据一定是正确的，即指定位置的数在数列中一定存在。
- 对于 $50\%$ 的数据，任何时刻数列中最多含有 $3 \times 10^4$ 个数。
- 对于 $100\%$ 的数据，任何时刻数列中最多含有 $5 \times 10^5$ 个数，任何时刻数列中任何一个数字均在 $[-10^3, 10^3]$ 内，$1 \le M \le 2 \times 10^4$，插入的数字总数不超过 $4 \times 10^6$。

题面由 @syksykCCC 提供。


---

---
title: "GTY的人类基因组计划2"
layout: "post"
diff: 省选/NOI-
pid: P2087
tag: ['线段树', '平衡树']
---
# GTY的人类基因组计划2
## 题目背景

GTY 决心改变人类基因！！
## 题目描述

GTY 召唤了 $n$ 个人来做实验，GTY 家的房子很大，有 $m$ 个房间一开始所有人都在 $1$ 号房间里，GTY 会命令某人去某个房间等待做实验，或者命令一段区间的房间开始实验，实验会获得一些实验信息点数，点数为房间里的人数，如果一个房间里的一群人已经做过实验了那么这些人将不会增加实验信息点数（不会增加是针对这一群人的，不是对这群人中的每个人，即 $1,2,3$ 做了实验，$1,2$ 再做实验还会增加 $2$ 点实验点数）。

## 输入格式

第一行两个整数 $n,m,q (n,m,q \leq 10^5)$ 表示人数，房间数和操作数

接下来 $q$ 行每行一个操作 `C i j` 表示让第 $i$ 个人去房间 $j$，`W l r` 表示让区间 $[l,r]$ 的房间做实验。

## 输出格式

对于每一个 $W$ 操作，输出一个数，表示此次操作所获得的实验点数。

## 样例

### 样例输入 #1
```
3 5 7

C 1 2

C 2 2

W 1 2

C 3 2

W 1 2

C 3 3

W 1 3
```
### 样例输出 #1
```
3

3

0
```
## 提示

善用 STL。



---

---
title: "Gty的妹子树"
layout: "post"
diff: 省选/NOI-
pid: P2137
tag: ['平衡树']
---
# Gty的妹子树
## 题目背景

我曾在弦歌之中听过你，


檀板声碎，半出折子戏。


舞榭歌台被风吹去，


岁月深处尚有余音一缕……



Gty 神(xian)犇(chong)从来不缺妹子……


他来到了一棵妹子树下，发现每个妹子有一个美丽度……


由于Gty很哲♂学，他只对美丽度大于某个值的妹子感兴趣。


他想知道某个子树中美丽度大于 $k$ 的妹子个数。


某个妹子的美丽度可能发生变化……


树上可能会出现一只新的妹子……

## 题目描述

维护一棵初始有 $n$ 个节点的有根树（根节点为 $1$），树上节点编号为 $1 \sim n$，每个点有一个权值 $w_i$。


支持以下操作：

- `0 u x` 询问以 $u$ 为根的子树中，严格大于 $x$ 的值的个数。

- `1 u x`  把 $u$ 节点的权值改成 $x$。

- `2 u x`  添加一个编号为“当前树中节点数+1”的节点，其父节点为 $u$，其权值为 $x$。

**本题强制在线。**   
所有输入的 $u,x$ 都需要异或 $\text{last}$ 才是真正的输入。   
其中 $\text{last}$ 为上一次询问的答案，定义初始 $\text{last} = 0$。
## 输入格式

第一行一个正整数 $n$，表示初始节点数。 

接下来 $n-1$ 行，每行两个整数 $u,v$，为树上的一条无向边。

接下来一行 $n$ 个整数 $w_i$，表示初始时每个节点的权值。

接着一行一个正整数 $m$，表示操作个数。

接下来 $m$ 行，每行三个整数 $\text{op},u,x$，表示一次操作。

## 输出格式

对每个 $\text{op}=0$ 的操作，输出一行，包括一个整数，意义见题目描述。

## 样例

### 样例输入 #1
```
2
1 2
10 20
1
0 1 5

```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
2
1 2
10 20
1
0 1 10

```
### 样例输出 #2
```
1

```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,m \le 30000$，$1\le u \le n$，$0 \le w_i,x < 2^{31}$。



---

---
title: "[SDOI2008] 洞穴勘测"
layout: "post"
diff: 省选/NOI-
pid: P2147
tag: ['2008', '各省省选', '平衡树', '山东', '动态树 LCT']
---
# [SDOI2008] 洞穴勘测
## 题目描述

辉辉热衷于洞穴勘测。

某天，他按照地图来到了一片被标记为JSZX的洞穴群地区。经过初步勘测，辉辉发现这片区域由n个洞穴（分别编号为1到n）以及若干通道组成，并且每条通道连接了恰好两个洞穴。假如两个洞穴可以通过一条或者多条通道按一定顺序连接起来，那么这两个洞穴就是连通的，按顺序连接在一起的这些通道则被称之为这两个洞穴之间的一条路径。 洞穴都十分坚固无法破坏，然而通道不太稳定，时常因为外界影响而发生改变，比如，根据有关仪器的监测结果，123号洞穴和127号洞穴之间有时会出现一条通道，有时这条通道又会因为某种稀奇古怪的原因被毁。

辉辉有一台监测仪器可以实时将通道的每一次改变状况在辉辉手边的终端机上显示：

如果监测到洞穴u和洞穴v之间出现了一条通道，终端机上会显示一条指令 `Connect u v`

如果监测到洞穴u和洞穴v之间的通道被毁，终端机上会显示一条指令 `Destroy u v`

经过长期的艰苦卓绝的手工推算，辉辉发现一个奇怪的现象：无论通道怎么改变，任意时刻任意两个洞穴之间至多只有一条路径。

因而，辉辉坚信这是由于某种本质规律的支配导致的。因而，辉辉更加夜以继日地坚守在终端机之前，试图通过通道的改变情况来研究这条本质规律。 然而，终于有一天，辉辉在堆积成山的演算纸中崩溃了……他把终端机往地面一砸（终端机也足够坚固无法破坏），转而求助于你，说道：“你老兄把这程序写写吧”。

辉辉希望能随时通过终端机发出指令 `Query u v`，向监测仪询问此时洞穴u和洞穴v是否连通。现在你要为他编写程序回答每一次询问。 已知在第一条指令显示之前，JSZX洞穴群中没有任何通道存在。

## 输入格式

第一行为两个正整数n和m，分别表示洞穴的个数和终端机上出现过的指令的个数。 以下m行，依次表示终端机上出现的各条指令。每行开头是一个表示指令种类的字符串s（"Connect”、”Destroy”或者”Query”，区分大小写），之后有两个整数u和v (1≤u, v≤n) 分别表示两个洞穴的编号。

## 输出格式

对每个Query指令，输出洞穴u和洞穴v是否互相连通：是输出”Yes”，否则输出”No”。（不含双引号）

## 样例

### 样例输入 #1
```
200 5
Query 123 127
Connect 123 127
Query 123 127
Destroy 127 123
Query 123 127
```
### 样例输出 #1
```
No
Yes
No

```
### 样例输入 #2
```
3 5
Connect 1 2
Connect 3 1
Query 2 3
Destroy 1 3
Query 2 3
```
### 样例输出 #2
```
Yes
No
```
## 提示

数据说明


10%的数据满足n≤1000, m≤20000

20%的数据满足n≤2000, m≤40000

30%的数据满足n≤3000, m≤60000

40%的数据满足n≤4000, m≤80000

50%的数据满足n≤5000, m≤100000

60%的数据满足n≤6000, m≤120000

70%的数据满足n≤7000, m≤140000

80%的数据满足n≤8000, m≤160000

90%的数据满足n≤9000, m≤180000

100%的数据满足n≤10000, m≤200000


保证所有Destroy指令将摧毁的是一条存在的通道

本题输入、输出规模比较大，建议c\c++选手使用scanf和printf进行I\O操作以免超时

---

@namespace_std 于 2019.12.1 添加一组 Hack 数据


---

---
title: "Gty的超级妹子树【数据疑似有误】"
layout: "post"
diff: 省选/NOI-
pid: P2166
tag: ['平衡树']
---
# Gty的超级妹子树【数据疑似有误】
## 题目背景

我曾在青山之中遇过你，  
新竹做杖，鬓插紫茱萸。  
跣足踏过无边丝雨，  
又拾起燕川雪片片落如席……

Gty神(xian)犇(chong)从来不缺妹子……

他又来到了一棵妹子树下，发现每个妹子有一个美丽度……


由于Gty很 哲♂学 也很 机♂智，他只对美丽度大于某个值的妹子感兴趣。  
他想知道某个子树中美丽度大于 $x$ 的妹子个数。

某个妹子的美丽度可能发生变化……

树上可能会出现一只新的妹子……

但是……树枝可能会断裂，于是，Gty 惊讶地发现，他的面前变成了一片妹子树组成的森林……


## 题目描述

维护一棵初始有 $n$ 个节点的有根树（根节点为 $1$），树上节点编号为 $1 \sim n$，每个点有一个权值 $w_i$，它可能会变成森林。


支持以下操作：

- `0 u x` 询问以 $u$ 为根的子树中，严格大于 $x$ 的值的个数。
- `1 u x`  把 $u$ 节点的权值改成 $x$。
- `2 u x`  添加一个编号为“当前树中节点数+1”的节点，其父节点为 $u$，其权值为 $x$。
- `3 u` 删除 $u$ 与其父亲的边，并使 $u$ 变为其所在连通块的根。

**本题强制在线。**

所有输入的 $u,x$ 都需要异或 $\text{last}$ 才是真正的输入。其中 $\text{last}$ 为上一次询问的答案，定义初始 $\text{last} = 0$。
## 输入格式

第一行一个正整数 $n$，表示初始节点数。 

接下来 $n-1$ 行，每行两个整数 $u,v$，为树上的一条无向边。

接下来一行 $n$ 个整数 $w_i$，表示初始时每个节点的权值。

接着一行一个正整数 $m$，表示操作个数。

接下来 $m$ 行，每行若干个整数，表示一次操作。

## 输出格式

对每个 $\text{op}=0$ 的操作，输出一行，包括一个整数，意义见题目描述。

## 样例

### 样例输入 #1
```
2
1 2
10 20
1
0 1 5

```
### 样例输出 #1
```
2

```
## 提示

### 数据范围及约定

对于 $100\%$ 的数据，$1\le n,m \le 10^5$，$1\le u \le n$，$0 \le w_i,x < 2^{31}$。



---

---
title: "[ZJOI2012] 网络"
layout: "post"
diff: 省选/NOI-
pid: P2173
tag: ['2012', '各省省选', '平衡树', '浙江', '动态树 LCT']
---
# [ZJOI2012] 网络
## 题目描述

有一个无向图 $G$，每个点有个权值，每条边有一个颜色。这个无向图满足以下两个条件：

1、 对于任意节点连出去的边中，相同颜色的边不超过两条。

2、图中不存在同色的环，同色的环指相同颜色的边构成的环。

在这个图上，你要支持以下三种操作：

- `0 x y` 表示把节点 $x$ 的权值改为 $y$

- `1 u v w` 表示将边 $(u,v)$ 的颜色改为 $w$。  

- `2 c u v` 表示查询由颜色 $c$ 的边构成的图中，所有可能在 $u \to v$ 之间的简单路径上的节点的权值的最大值。

## 输入格式

第一行四个正整数 $n,m,C,k$，分别表示节点数、边数、颜色数和操作数。

接下来 $n$ 行，每行一个正整数 $v_i$，为节点 $i$ 的权值。

之后 $m$ 行，每行三个正整数 $u,v,w$，为一条连接 $u,v$ 节点的边，颜色为$w$。

最后 $k$ 行，每行若干个正整数，表示一次操作。
## 输出格式

输出若干行，每行输出一个对应的信息。

1、 对于修改节点权值操作，不需要输出信息。

2、对于修改边的颜色操作，按以下几类输出：

- 若不存在连接节点 $u$ 和节点 $v$ 的边，输出 `No such edge.`。

- 若修改后不满足条件 $1$，不修改边的颜色，并输出 `Error 1.`。

- 若修改后不满足条件 $2$，不修改边的颜色，并输出 `Error 2.`。

- 其他情况，成功修改边的颜色，并输出 `Success.`。

输出满足条件的第一条信息即可，即若同时不满足条件 $1,2$ ，则只需要输出`Error 1.`。

3、 对于查询操作，输出一个整数表示答案。若 $u,v$ 之间没有颜色 $c$ 构成的路径，则输出 $-1$。

## 样例

### 样例输入 #1
```
4 5 2 7
1
2
3
4
1 2 0
1 3 1
2 3 0
2 4 1
3 4 0
2 0 1 4
1 1 2 1
1 4 3 1
2 0 1 4
1 2 3 1
0 2 5
2 1 1 4
```
### 样例输出 #1
```
4
Success.
Error 2.
-1
Error 1.
5
```
## 提示

 ![](https://cdn.luogu.com.cn/upload/pic/1714.png) 

颜色 $0$ 为实线的边，颜色 $1$ 为虚线的边，

由颜色 $0$ 构成的从节点 $1$ 到节点 $4$ 的路径有 $1 \to 2 \to 4$，故$\max\{v_1, v_2, v_4\} = \max\{ 1, 2, 4 \} = 4$。

将连接节点 $1$ 和节点 $2$ 的边修改为颜色 $1$，修改成功，输出 `Success.`

将连接节点 $4$ 和节点 $3$ 的边修改为颜色 $1$，由于修改后会使得存在由颜色 $1$ 构成的环( $1 – 2 – 4 – 3 – 1$ )，不满足条件 $2$，故不修改，并输`Error 2`。

不存在颜色 $0$ 构成的从节点 $1$ 到节点 $4$ 的边，输出 `-1`。

将连接节点 $2$ 和节点 $3$ 的边修改为颜色 $1$，由于修改后节点 $2$ 的连出去的颜色为 $1$ 的边有 $3$ 条，故不满足条件 $1$，故不修改，并输出`Error 1.` 。

将节点 $2$ 的权值修改为 $5$。

由颜色 $1$ 构成的从节点 $1$ 到节点 $4$ 的路径有 $1 \to 2 \to 4$，故$\max\{v_1, v_2, v_4\} = \max\{ 1, 5, 4 \} = 5$。

【数据范围】

对于 $30\%$ 的数据：$n ≤ 1000$，$m ≤ 10^4$，$k ≤ 1000$；   
另有 $20\%$ 的数据：$n ≤ 10^4$，$m ≤ 10^5$，$C = 1$，$k ≤ 10^5$；   
对于 $100\%$ 的数据：$n ≤ 10^4$，$m ≤ 10^5$，$C ≤ 10$，$k ≤ 10^5$。  

$1\le u,v,x \le n$，$0 \le c < C$，保证图中没有重边和自环。



---

---
title: "[SDOI2012] 基站建设"
layout: "post"
diff: 省选/NOI-
pid: P2497
tag: ['动态规划 DP', '2012', '线段树', '各省省选', '平衡树', '山东', 'cdq 分治', '斜率优化']
---
# [SDOI2012] 基站建设
## 题目描述

up 主家终于买电脑了，但是接下来有各种问题要处理。首要解决的问题就是网络问题。他要从移动公司开始，通过一些基站来传递网络到他家。

为了简化问题，我们假设移动公司，所有的基站、up 主家位于同一条直线上，他们都位于这一条直线上的某一点 $x$，这些点**可能**会重合。每个基站发射和接收的范围都是一个切于地面的圆，发射的半径 $r$ 是固定的，接收半径 $r'$ 是可调的的。如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/nh8yxjx5.png)

一个点 $i$ 如果能从另一个点 $j$ 接收到信号（当且仅当 $x_j<x_i$），必须满足 $i$ 的接收范围与 $j$ 的发射范围相切，并且需要付 $\sqrt{r'_i}$ 的额外费用。同时启动每一个点 $i$ 都需要费用 $v_i$。

当然一个点如果能够发射的 up 主家只需要这个点的发射范围与 up 主家所在的竖线相切或相交即可，如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/5t4v8687.png)

当然费用越少就越好咯，于是 up 主想要请你帮他的忙。
## 输入格式

第一行两个整数 $n, m$。表示基站个数（包括移动公司），up 主家的坐标。（保证大于等于所有基站的坐标）

记下来 $n$ 行，每行三个整数 $x_i$，$r_i$，$v_i$，表示每个基站的坐标，发射范围以及费用。

$x_i$ 是按照坐标从小到大输入的，移动公司位于最小的那个坐标。

$r$ 为 $1\dots n$ 的排列。
## 输出格式

一个实数，保留小数点后三位。
## 样例

### 样例输入 #1
```
10 33
5 4 660
10 2 2040
11 6 3207
14 5 2006
18 3 6130
19 9 3363
22 1 1265
25 8 2836
27 10 7961
29 7 9075
```
### 样例输出 #1
```
3501.000
```
## 提示

对于 $100\%$ 的数据 $n\le5\times 10^5$，$x_i,m \le 10^{12}$，$v_i \le 10000$


---

---
title: "[HAOI2011] 防线修建"
layout: "post"
diff: 省选/NOI-
pid: P2521
tag: ['2011', '河南', '各省省选', '平衡树', '凸包']
---
# [HAOI2011] 防线修建
## 题目描述

近来A国和B国的矛盾激化，为了预防不测，A 国准备修建一条长长的防线，当然修建防线的话，肯定要把需要保护的城市修在防线内部了。  

可是A国上层现在还犹豫不决，到底该把哪些城市作为保护对象呢？又由于 A 国的经费有限，所以希望你能帮忙完成如下的一个任务：

1、给出你所有的 A 国城市坐标

2、A国上层经过讨论，考虑到经济问题，决定取消对 $u$ 城市的保护，也就是说 $u$ 城市不需要在防线内了

3、A国上层询问对于剩下要保护的城市，修建防线的总经费最少是多少

你需要对每次询问作出回答。注意单位长度的防线花费为 $1$。

A 国的地形是这样的，形如下图，$x$ 轴是一条河流，相当于一条天然防线，不需要你再修建。

![](https://cdn.luogu.com.cn/upload/image_hosting/rkaw5kay.png)

A 国总是有两个城市在河边，一个点是 $(0,0)$，一个点是 $(n,0)$，其余所有点的横坐标均在 $(0,n)$ 范围内，纵坐标均大于0。  
A国有一个不在 $(0,0)$ 和 $(n,0)$ 的首都。$(0,0),(n,0)$ 和首都这三个城市是一定需要保护的。

上图中，A,B,C,D,E 点为 A 国城市，且目前都要保护，那么修建的防线就会是 A-B-C-D，花费也就是线段 AB 的长度+线段 BC 的长度+线段 CD 的长度,如果，这个时候撤销 B 点的保护，那么防线变成下图

![](https://cdn.luogu.com.cn/upload/image_hosting/cd7dpmcj.png)

## 输入格式

第一行三个整数 $n,x,y$ 分别表示河边城市和首都是 $(0,0),(n,0),(x,y)$。

第二行一个整数 $m$。

接下来 $m$ 行，每行两个整数 $a,b$ 表示 A 国的一个非首都非河边城市的坐标为 $(a,b)$。

再接下来一个整数 $q$，表示修改和询问总数。


接下来 $q$ 行每行要么形如 `1 u`，要么形如 `2`，分别表示撤销第 $u$ 个城市的保护和询问。

## 输出格式

对于每个询问输出一行一个实数 $v$，表示修建防线的花费，保留两位小数。

## 样例

### 样例输入 #1
```
4 2 1                                
2                                 
1 2                               
3 2                               
5                                 
2
1 1
2
1 2
2
```
### 样例输出 #1
```
6.47
5.84
4.47
```
## 提示

【数据范围】   
对于 $30\%$ 的数据，$1\le m,q \le 1000$；   
对于 $100\%$ 的数据，$1\le m \le 10^5$，$1\le q \le 2 \times 10^5$，$1 < n \le 10^4$。

所有点的坐标范围均在 $10^4$ 以内, 数据保证没有重点。

---

~~$\text{upd 2022.7.21}$：新增加一组 Hack 数据。~~ 该数据有误，已经被移除。


---

---
title: "[ZJOI2006] GameZ游戏排名系统"
layout: "post"
diff: 省选/NOI-
pid: P2584
tag: ['2006', '平衡树', '浙江', 'O2优化', '哈希 hashing']
---
# [ZJOI2006] GameZ游戏排名系统
## 题目描述

GameZ为他们最新推出的游戏开通了一个网站。世界各地的玩家都可以将自己的游戏得分上传到网站上。这样就可以看到自己在世界上的排名。得分越高，排名就越靠前。当两个玩家的名次相同时，先上传记录者优先。由于新游戏的火爆，网站服务器已经难堪重负。为此GameZ雇用了你来帮他们重新开发一套新的核心。

排名系统通常要应付三种请求：上传一条新的得分记录、查询某个玩家的当前排名以及返回某个区段内的排名记录。当某个玩家上传自己最新的得分记录时，他原有的得分记录会被删除。为了减轻服务器负担，在返回某个区段内的排名记录时，最多返回 $10$ 条记录。

## 输入格式

输入文件的第一行是一个整数 $n$ $( n \ge 10 )$ 表示请求总数目。接下来n行每行包含了一个请求。请求的具体格式如下：

``+Name Score`` 上传最新得分记录。``Name`` 表示玩家名字，由大写英文字母组成，不超过 $10$ 个字符。``Score`` 为最多 $10$ 位的正整数。

``?Name`` 查询玩家排名。该玩家的得分记录必定已经在前面上传。

``?Index`` 返回自第 ``Index`` 名开始的最多 $10$ 名玩家名字。``Index`` 必定合法，即不小于 $1$，也不大于当前有记录的玩家总数。



## 输出格式

对于每条查询请求，在文件中输出相应结果。

对于 ``?Name`` 格式的请求，应输出一个整数表示该玩家当前的排名。

对于 ``?Index`` 格式的请求，应在一行中依次输出从第 ``Index`` 名开始的最多 $10$ 名玩家姓名，用一个空格分隔。

## 样例

### 样例输入 #1
```
20
+ADAM 1000000
+BOB 1000000 
+TOM 2000000
+CATHY 10000000
?TOM 
?1
+DAM 100000 
+BOB 1200000
+ADAM 900000 
+FRANK 12340000 
+LEO 9000000
+KAINE 9000000 
+GRACE 8000000 
+WALT 9000000 
+SANDY 8000000 
+MICK 9000000 
+JACK 7320000 
?2 
?5  
?KAINE
```
### 样例输出 #1
```
2
CATHY TOM ADAM BOB
CATHY LEO KAINE WALT MICK GRACE SANDY JACK TOM BOB
WALT MICK GRACE SANDY JACK TOM BOB ADAM DAM
4

```
## 提示

20
+ADAM 1000000     加入ADAM的得分记录

+BOB 1000000       加入BOB的得分记录

+TOM 2000000       加入TOM的得分记录

+CATHY 10000000    加入CATHY的得分记录

?TOM               输出TOM目前排名

?1                  目前有记录的玩家总数为4，因此应输出第1名到第4名。

+DAM 100000        加入DAM的得分记录

+BOB 1200000       更新BOB的得分记录

+ADAM 900000      更新ADAM的得分记录（即使比原来的差）

+FRANK 12340000   加入FRANK的得分记录

+LEO 9000000       加入LEO的得分记录

+KAINE 9000000     加入KAINE的得分记录

+GRACE 8000000    加入GRACE的得分记录

+WALT 9000000      加入WALT的得分记录

+SANDY 8000000    加入SANDY的得分记录

+MICK 9000000      加入MICK的得分记录

+JACK 7320000      加入JACK的得分记录

?2                  目前有记录的玩家总数为12，因此应输出第2名到第11名。

?5                  输出第5名到第13名。

?KAINE             输出KAINE的排名

输入文件总大小不超过 2M。

NOTE：用 C++ 的 fstream 读大规模数据的效率较低


---

---
title: "[ZJOI2006] 书架"
layout: "post"
diff: 省选/NOI-
pid: P2596
tag: ['2006', '各省省选', '平衡树', '浙江']
---
# [ZJOI2006] 书架
## 题目描述

小 T 有一个很大的书柜。这个书柜的构造有些独特，即书柜里的书是从上至下堆放成一列。她用 $1$ 到 $n$ 的正整数给每本书都编了号。

小 T 在看书的时候，每次取出一本书，看完后放回书柜然后再拿下一本。由于这些书太有吸引力了，所以她看完后常常会忘记原来是放在书柜的什么位置。不过小 T 的记忆力是非常好的，所以每次放书的时候至少能够将那本书放在拿出来时的位置附近，比如说她拿的时候这本书上面有 $x$ 本书，那么放回去时这本书上面就只可能有 $x-1$、$x$ 或 $x+1$ 本书。

当然也有特殊情况，比如在看书的时候突然电话响了或者有朋友来访。这时候粗心的小 T 会随手把书放在书柜里所有书的最上面或者最下面，然后转身离开。

久而久之，小 T 的书柜里的书的顺序就会越来越乱，找到特定的编号的书就变得越来越困难。于是她想请你帮她编写一个图书管理程序，处理她看书时的一些操作，以及回答她的两个提问：
- 编号为 $x$ 的书在书柜的什么位置。
- 从上到下第 $i$ 本书的编号是多少。

## 输入格式

第一行有两个整数，分别表示书的个数 $n$ 以及命令条数 $m$。

第二行有 $n$ 个整数，第 $i$ 个整数表示初始时从上向下书第 $i$ 本书的编号 $p_i$。

接下来 $m$ 行，每行表示一个操作。每行初始时有一个字符串  $op$。

- 若 $op$ 为 `Top`，则后有一个整数 $s$，表示把编号为 $s$ 的书放在最上面。
- 若 $op$ 为 `Bottom`，则后有一个整数 $s$，表示把编号为 $s$ 的书放在最下面。
- 若 $op$ 为 `Insert`，则后有两个整数 $s, t$，表示若编号为 $s$ 的书上面有 $x$ 本书，则放回这本书时他的上面有 $x + t$ 本书。
- 若 $op$ 为 `Ask`，则后面有一个整数 $s$，表示询问编号为 $s$ 的书上面有几本书。
- 若 $op$ 为 `Query`，则后面有一个整数 $s$，询问从上面起第 $s$ 本书的编号。
## 输出格式

对于每次查询，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
10 10
1 3 2 7 5 8 10 4 9 6
Query 3
Top 5
Ask 6
Bottom 3
Ask 3
Top 6
Insert 4 -1
Query 5
Query 2
Ask 2

```
### 样例输出 #1
```
2
9
9
7
5
3
```
## 提示

### 数据规模与约定

对于 $100\%$ 的数据，保证：
- $3 \leq n, m \leq 8 \times 10^4$。
- $p_i$ 是一个 $1 \sim n$ 的排列。
- $1 \leq s \leq n$，$-1 \leq t \leq 1$，$op$ 只可能是输入的五种字符串之一。
- 当编号为 $s$ 的书上面没有书的时候，不会对它进行 `Insert s -1` 操作。
- 当编号为 $s$ 的书下面没有书的时候，不会对它进行 `Insert s 1` 操作。


---

---
title: "[ZJOI2012] 小蓝的好友"
layout: "post"
diff: 省选/NOI-
pid: P2611
tag: ['2012', '各省省选', '平衡树', '浙江', '深度优先搜索 DFS', '栈']
---
# [ZJOI2012] 小蓝的好友
## 题目背景

终于到达了这次选拔赛的最后一题，想必你已经厌倦了小蓝和小白的故事。

为了回馈各位比赛选手，此题的主角是贯穿这次比赛的关键人物——小蓝的好友。

在帮小蓝确定了旅游路线后，小蓝的好友也不会浪费这个难得的暑假。

与小蓝不同，小蓝的好友并不想将时间花在旅游上，而是盯上了最近发行的即时战略游戏——SangoCraft。

但在前往通关之路的道路上，一个小游戏挡住了小蓝的好友的步伐。
## 题目描述


“国家的战争其本质是抢夺资源的战争”是整款游戏的核心理念，这个小游戏也不例外。

简单来说，用户需要在一块 $R\times C$ 的长方形土地上选出一块子矩形。

而系统随机生成了 $N$ 个资源点，第 $i$ 个资源点的坐标为 $(x_i,y_i)$。

位于用户所选的长方形土地上的资源点越多，给予用户的奖励也越多。

悲剧的是，小蓝的好友虽然拥有着极其优秀的能力，但同时也有着极差的 RP，小蓝的好友所选的区域总是没有一个资源点。

终于有一天，小蓝的好友决定投诉这款游戏的制造厂商，为了搜集证据，小蓝的好友想算出至少包含一个资源点的区域的数量。

具体的说，你需要计算有多少个四元组 $(LB,DB,RB,UB)$ 满足 $1\le LB\le RB\le R,1\le DB\le UB\le C$ ，且存在一个 $i$ 使得 $LB\le x_i\le RB,DB\le y_i\le UB$ 均成立。

作为小蓝的好友，这自然是你分内之事。
## 输入格式

第一行三个正整数 $R,C,N$。

接下来有 $N$ 行，每行包含两个整数 $x_i,y_i$，表示第 $i$ 个资源点的坐标。
## 输出格式

一行一个整数，表示至少包含一个资源点的区域的数量。
## 样例

### 样例输入 #1
```
5 5 4
1 2
2 3
3 5
4 1

```
### 样例输出 #1
```
139
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，$N\le 50$。
- 对于 $40\%$ 的数据，$N\le 2\times 10^3$。
- 对于 $100\%$ 的数据，$1\le R,C\le 4\times 10^4$，$1\le N\le 10^5$，题目保证资源点的位置两两不同，且位置为随机生成。


---

---
title: "数列"
layout: "post"
diff: 省选/NOI-
pid: P2710
tag: ['平衡树']
---
# 数列
## 题目描述

维护一个数列,共 $7$ 种操作:

I. `INSERT x n a1 a2 .. an` 在第 $x$ 个数后插入 $n$ 个数分别为 $a_1\dots a_n$。

II. `DELETE x n` 删除第 $x$ 个数开始的 $n$ 个数。

III. `REVERSE x n` 翻转第 $x$ 个数开始的 $n$ 个数的区间。

IV. `MAKE-SAME x n t` 将第 $x$ 个数开始的 $n$ 个数统一改为 $t$。

V. `GET-SUM x n` 输出第 $x$ 个数开始的 $n$ 个数的和。

VI. `GET x` 输出第 $x$ 个数的值。

VII. `MAX-SUM x n` 输出第 $x$ 个数开始的 $n$ 个数的最大连续子序列和。
## 输入格式

第一行为 $N$，$M$，$N$ 表示初始序列中数的个数，$M$ 表示操作的个数。

第二行为 $N$ 个数 $A_1\dots A_n$，表示初始序列。

第三行到第 $M+2 $行，每行一个操作。
## 输出格式

输出每个`GET-SUM`，`GET`，`MAX-SUM`操作的结果。
## 样例

### 样例输入 #1
```
9 8
2 -6 3 5 1 -5 -3 6 3
GET-SUM 5 4
MAX-SUM 1 9
INSERT 8 3 -5 7 2
DELETE 12 1
MAKE-SAME 3 3 2
REVERSE 3 6
GET 5
MAX-SUM 1 11
```
### 样例输出 #1
```
-1
10
-5
10
```
## 提示

共 $20$ 组数据，每组数据随机生成，  
保证每个时刻数列里的数不超过 $200000$ 个，  
任何一个输入的数字均在 $-1000\sim1000$之间，结果不超过 $2^{30}$。

第 $1\sim2$ 组 $\quad1\le N\le 5$，$1\le M\le 10$。

第 $3\sim4$ 组 $\quad1\le N\le 10$，$1\le M\le 20$。

第 $5\sim6$ 组 $\quad1\le N \le 20$，$1\le M\le 50$。

第 $7\sim8$ 组 $\quad1\le N\le 50$，$1\le M\le 100$。

第 $9\sim10$ 组 $\quad1\le N\le 100$，$1\le M\le 500$。

第 $11\sim12$ 组 $\quad 1\le N\le 1000$，$1\le M\le 1000$。

第 $13\sim14$ 组 $\quad1\le N\le 5000$，$1\le M\le 2000$。

第 $15\sim16$ 组 $\quad1\le N\le 10^4$，$1\le M\le 5000$。

第 $17\sim18$ 组 $\quad1\le N\le 10^5$，$1\le M\le 10^4$。

第 $19\sim20$ 组 $\quad1\le N\le 2\times 10^5$，$1\le M\le 2\times 10^4$。


---

---
title: "[USACO08OPEN] Cow Neighborhoods G"
layout: "post"
diff: 省选/NOI-
pid: P2906
tag: ['2008', 'USACO', '并查集', '平衡树', '生成树']
---
# [USACO08OPEN] Cow Neighborhoods G
## 题目描述

了解奶牛的人都知道奶牛是如何组成「奶牛社区」的。他们观察了 Farmer John 的 $N$ 头奶牛（编号为 $1 \sim N$），它们在 $X$ 和 $Y$ 坐标范围为 $1$ 的牧场上放牧，每头奶牛都在自己唯一的整数直线坐标上。

如果满足以下两个标准中的至少一个，则两头奶牛是邻居：

1. 两只奶牛的曼哈顿距离不超过 $C$，即 $|X_i - x_i| + |Y_i - y_i| \leq C$；
2. 两只奶牛有共同的邻居。即存在一只奶牛 $k$，使 $i$ 与 $k$，$j$ 与 $k$ 均同属一个群。

给定奶牛的位置和距离 $C$，确定「奶牛社区」的数量和最大的「奶牛社区」中的奶牛数量。

例如，考虑下面的牧场。 当 $C = 4$ 时，这个牧场有四个社区：左边的一个大社区，两个大小为 1 的社区，右边有一个巨大的社区，里面有 $60$ 头不同的奶牛。

```text
.....................................*.................
....*...*..*.......................***.................
......*...........................****.................
..*....*..*.......................*...*.******.*.*.....
........................*.............***...***...*....
*..*..*...*..........................*..*...*..*...*...
.....................................*..*...*..*.......
.....................................*..*...*..*.......
...*................*..................................
.*..*............................*.*.*.*.*.*.*.*.*.*.*.
.*.....*..........................*.*.*.*.*.*.*.*.*.*.*
....*..................................................
```
## 输入格式

第 $1$ 行包含两个用空格分隔的整数 $N, C$。

第 $2$ 到第 $N + 1$ 行每行包含两个用空格分隔的整数 $X_i, Y_i$，表示一头牛的坐标。

## 输出格式


共一行，为两个用空格分隔的整数，为「奶牛社区」的数量和最大的「奶牛社区」内牛的数量。
## 样例

### 样例输入 #1
```
4 2 
1 1 
3 3 
2 2 
10 10 

```
### 样例输出 #1
```
2 3 

```
## 提示

### 样例说明 #1

样例中有 $2$ 个社区，一个由前三头奶牛组成，另一个是最后一头奶牛。因此，最大的社区大小为 $3$。

### 数据范围与约定

对于 $100\%$ 的数据，$1 \leq N \leq 10^5$，$1 \leq C \leq 10^9$，$1 \leq X_i, Y_i \leq 10^9$，$X_i, Y_i$ 均为整数。


---

---
title: "[USACO14FEB] Airplane Boarding G"
layout: "post"
diff: 省选/NOI-
pid: P3103
tag: ['2014', 'USACO', '平衡树']
---
# [USACO14FEB] Airplane Boarding G
## 题目描述

FJ's cows have decided to take a vacation, and have miraculously managed to find an airline willing to sell them tickets.  When they arrive at the airport and start boarding their plane, they face an interesting problem, however.

The airplane has N seats, which we model as the points x=1 through x=N on the number line.  All N cows (1 <= N <= 200,000) are standing in line waiting to get to their seats.  Cow N is at position x=0, Cow N-1 is at position x=-1, and so on.  Cow i has been assigned to Seat S\_i, where S\_1,...,S\_N is a permutation of 1,...,N.

At each time step, each cow takes a step to the right if she can. When cow i reaches her seat S\_i, she will stop to put her baggage in the overhead bin, which takes T\_i seconds, and then sit down. For those T\_i steps, the cow behind her (if there is one) is blocked from moving forward.  If there is a line of cows behind her, the line is effectively blocked as well.

How long will it take for all the cows to sit down? 

The sum of T\_i for all cows will be less than 1,000,000,000. 

想象一下飞机有N个座位，N个座位相当于数轴上的1至N共N个整点，第1个座位在整点1处，第2个座位在整点2处，……第N个座位在整点N处。


有N个奶牛排好队，要登陆坐飞机，第N头奶牛在数轴的整点0处，第N−1头奶牛在数轴的整点−1处，……第1头奶牛在数轴的整点−N+1处。第i头奶牛的座位号是Si。注意：每头奶牛都有唯一的一个座位，不会出现多头奶牛有相同的座位号。


在每一秒钟，奶牛会向右移动一步到达下一个整点，前提是没有奶牛挡住它。 当第i头奶牛到达它的座位Si时，它需要花费Ti秒去把行李放到头顶的行李架上，然后坐到自己的位置上，在此过程中，由于飞机通道很窄，所以在第i头奶牛坐到自己座位之前，在它左边的所有奶牛都不能动，要等奶牛i放好行李坐好后才能动。


现在的问题是，至少要多少秒之后，所有的奶牛都能做到自己的座位上？

## 输入格式

\* Line 1: A single integer, N.

\* Lines 2..N+1: Two space-separated integers, S\_i and T\_i.

## 输出格式

\* Line 1: A single line indicating the amount of time it takes to seat all cows.

## 样例

### 样例输入 #1
```
3 
2 5 
3 10 
1 5 

```
### 样例输出 #1
```
19 

```
## 提示

Initially, the cows are situated like this:

cows -> 123

123 <- seats 

with cow 1 trying to get to seat 2, cow 2 trying to get to seat 3, and cow 3 trying to get to seat 1.


After one step, they will all move 1 to the right and cow 3 will reach her seat:

123
123
Cow 3 takes 5 seconds to sit down, at which point she effectively disappears.

12
123
It takes 3 more seconds for cows 1 and 2 to reach their desired seats:

12
123
It takes 5 seconds for cow 1 to sit down and 10 seconds for cow 2 to sit down, so that's 10 seconds total.

In total this took 1 + 5 + 3 + 10 = 19 seconds. 




---

---
title: "[CQOI2014] 排序机械臂"
layout: "post"
diff: 省选/NOI-
pid: P3165
tag: ['2014', '重庆', '各省省选', '平衡树']
---
# [CQOI2014] 排序机械臂
## 题目描述

为了把工厂中高低不等的物品按从低到高排好序，工程师发明了一种排序机械臂。它遵循一个简单的排序规则，第一次操作找到高度最低的物品的位置 $P_1$ ，并把左起第一个物品至 $P_1$  间的物品 (即区间 $[1,P_1]$  间的物品) 反序；第二次找到第二低的物品的位置 $P_2$ ，并把左起第二个至 $P_2$  间的物品 (即区间 $[2,P_2]$  间的物品) 反序……最终所有的物品都会被排好序。

![样例说明](https://cdn.luogu.com.cn/upload/pic/15642.png)

上图给出有六个物品的示例，第一次操作前，高度最低的物品在位置 $4$ ，于是把第一至第四的物品反序；第二次操作前，第二低的物品在位罝六，于是把第二至六的物品反序……

你的任务便是编写一个程序，确定一个操作序列，即每次操作前第 $i$ 低的物品所在位置 $P_i$ ，以便机械臂工作。需要注意的是，如果有高度相同的物品，必须保证排序后它们的相对位置关系与初始时相同。

## 输入格式

第一行包含正整数n,表示需要排序的物品数星。

第二行包含n个空格分隔的整数$P_i$,表示每个物品的高度。

## 输出格式

输出一行包含n个空格分隔的整数Pi。

## 样例

### 样例输入 #1
```
6
3 4 5 1 6 2
```
### 样例输出 #1
```
4 6 4 5 6 6
```
## 提示

$N \le 100000$

$P_i \le 10^7$



---

---
title: "[HNOI2009] 梦幻布丁"
layout: "post"
diff: 省选/NOI-
pid: P3201
tag: ['2009', '线段树', '各省省选', '平衡树', '湖南', '枚举']
---
# [HNOI2009] 梦幻布丁
## 题目描述

$n$ 个布丁摆成一行，进行 $m$ 次操作。每次将某个颜色的布丁全部变成另一种颜色的，然后再询问当前一共有多少段颜色。

例如，颜色分别为 $1,2,2,1$ 的四个布丁一共有 $3$ 段颜色.
## 输入格式

第一行是两个整数，分别表示布丁个数 $n$ 和操作次数 $m$。  
第二行有 $n$ 个整数，第 $i$ 个整数表示第 $i$ 个布丁的颜色 $a_i$。  
接下来 $m$ 行，每行描述一次操作。每行首先有一个整数 $op$ 表示操作类型：
- 若 $op = 1$，则后有两个整数 $x, y$，表示将颜色 $x$ 的布丁全部变成颜色 $y$。
- 若 $op = 2$，则表示一次询问。
## 输出格式

对于每次询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 3
1 2 2 1
2
1 2 1
2

```
### 样例输出 #1
```
3
1
```
## 提示

### 样例 1 解释
初始时布丁颜色依次为 $1, 2, 2, 1$，三段颜色分别为 $[1, 1], [2, 3], [4, 4]$。  
一次操作后，布丁的颜色变为 $1, 1, 1, 1$，只有 $[1, 4]$ 一段颜色。

### 数据规模与约定

对于全部的测试点，保证 $1 \leq n, m \leq 10^5$，$1 \leq a_i ,x, y \leq 10^6$。

### 提示

请注意，**不保证**颜色的编号不大于 $n$，也**不保证** $x \neq y$，$m$ **不是**颜色的编号上限。


---

---
title: "[HNOI2011] 括号修复 / [JSOI2011] 括号序列"
layout: "post"
diff: 省选/NOI-
pid: P3215
tag: ['字符串', '2011', '各省省选', '平衡树', '湖南']
---
# [HNOI2011] 括号修复 / [JSOI2011] 括号序列
## 题目描述

一个合法的括号序列是这样定义的：

1.    空串是合法的。
2.    如果字符串 `S` 是合法的，则`(S)`也是合法的。
3.    如果字符串 `A` 和 `B` 是合法的，则 `AB` 也是合法的。

现在给你一个长度为 $n$ 的由`(`和`)`组成的字符串，位置标号从 $1$ 到 $n$。对这个字符串有下列四种操作：


-  `Replace a b c`：将 $[a,b]$ 之间的所有括号改成 $c$。假设原来的字符串为：`))())())(`，那么执行操作 `Replace 2 7 (`  后原来的字符串变为：`)(((((()(`。

-  `Swap a b`：将 $[a,b]$ 之间的字符串翻转。假设原来的字符串为：`))())())(`，那么执行操作 `Swap 3 5` 后原来的字符串变为：`))))(())(`。

-  `Invert a b`：将 $[a,b]$ 之间的 `(` 变成 `)` ，`)` 变成 `(`。假设原来的字符串为：`))())())(`，那么执行操作 `Invert 4 8` 后原来的字符串变为：`))((()(((`。

-  `Query a b`：询问 $[a,b]$ 之间的字符串至少要改变多少位才能变成合法的括号序列。改变某位是指将该位的 `(` 变成 `)` 或 `)` 变成 `(`。注意执行操作 `Query` 并不改变当前的括号序列。假设原来的字符串为：`))())())(`，那么执行操作 `Query 3 6` 的结果为 $2$，因为要将位置 $5$ 的`)`变成`(`并将位置 $6$ 的`(`变成`)`。

## 输入格式

输入文件的第一行是用空格隔开的两个正整数 $n,q$，分别表示字符串的长度和将执行的操作个数。  

第二行是长度为 $n$ 的初始字符串 $S$。接下来的 $q$ 行是将依次执行的$q$个操作，其中操作名与操作数之间以及相邻操作数之间均用空格隔开。

## 输出格式

对于每个 `Query` 操作，输出一行一个整数表示答案。输入数据保证有解。
## 样例

### 样例输入 #1
```
4 5
((((
Replace 1 2 )
Query 1 2
Swap 2 3
Invert 3 4
Query 1 4
```
### 样例输出 #1
```
1
2

```
## 提示

### 样例解释

输入中有 $2$ 个 `Query` 操作，所以输出有 $2$ 行。   
执行第一个 `Query` 操作时的括号序列为 `))((`，因改变第 $1$ 位可使 $[1,2]$ 之间的字符串变成合法的括号序列，故输出的第一行为 `1`。  

执行第二个 `Query` 操作时的括号序列为 `)(()`，因要改变第 $1$ 位和第 $2$ 位才能使 $[1,4]$ 之间的字符串变成合法的括号序列，故输出的第二行为 `2`。

### 数据范围

对于 $30\%$ 的数据，$1\le n,q \le 3000$；   
对于 $100\%$ 的数据，$1\le n,q \le 10^5$。


---

---
title: "[HNOI2012] 永无乡"
layout: "post"
diff: 省选/NOI-
pid: P3224
tag: ['2012', '线段树', '各省省选', '平衡树', '湖南']
---
# [HNOI2012] 永无乡
## 题目描述

永无乡包含 $n$ 座岛，编号从 $1$ 到 $n$ ，每座岛都有自己的独一无二的重要度，按照重要度可以将这 $n$ 座岛排名，名次用 $1$  到 $n$ 来表示。某些岛之间由巨大的桥连接，通过桥可以从一个岛到达另一个岛。如果从岛 $a$ 出发经过若干座（含 $0$ 座）桥可以 到达岛 $b$ ，则称岛 $a$ 和岛 $b$ 是连通的。

现在有两种操作：

`B x y` 表示在岛 $x$ 与岛 $y$ 之间修建一座新桥。

`Q x k` 表示询问当前与岛 $x$ 连通的所有岛中第 $k$ 重要的是哪座岛，即所有与岛 $x$ 连通的岛中重要度排名第 $k$ 小的岛是哪座，请你输出那个岛的编号。
## 输入格式

第一行是用空格隔开的两个整数，分别表示岛的个数 $n$ 以及一开始存在的桥数 $m$。

第二行有 $n$ 个整数，第 $i$ 个整数表示编号为 $i$ 的岛屿的排名 $p_i$。

接下来 $m$ 行，每行两个整数 $u, v$，表示一开始存在一座连接编号为 $u$ 的岛屿和编号为 $v$ 的岛屿的桥。

接下来一行有一个整数，表示操作个数 $q$。

接下来 $q$ 行，每行描述一个操作。每行首先有一个字符 $op$，表示操作类型，然后有两个整数 $x, y$。
- 若 $op$ 为 `Q`，则表示询问所有与岛 $x$ 连通的岛中重要度排名第 $y$ 小的岛是哪座，请你输出那个岛的编号。
- 若 $op$ 为 `B`，则表示在岛 $x$ 与岛 $y$ 之间修建一座新桥。

## 输出格式

对于每个询问操作都要依次输出一行一个整数，表示所询问岛屿的编号。如果该岛屿不存在，则输出 $-1$ 。
## 样例

### 样例输入 #1
```
5 1
4 3 2 5 1
1 2
7
Q 3 2
Q 2 1
B 2 3
B 1 5
Q 2 1
Q 2 4
Q 2 3

```
### 样例输出 #1
```
-1
2
5
1
2
```
## 提示

### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $n \leq 10^3$, $q \leq 10^3$。
- 对于 $100\%$ 的数据，保证 $1 \leq m \leq n \leq 10^5$, $1 \leq q \leq 3 \times 10^5$，$p$ 为一个 $1 \sim n$ 的排列，$op \in \{\texttt Q, \texttt B\}$，$1 \leq u, v, x, y \leq n$。


---

---
title: "[SCOI2014] 方伯伯的OJ"
layout: "post"
diff: 省选/NOI-
pid: P3285
tag: ['2014', '四川', '线段树', '平衡树']
---
# [SCOI2014] 方伯伯的OJ
## 题目描述

方伯伯正在做他的 OJ。现在他在处理 OJ 上的用户排名问题。OJ 上注册了 $n$ 个用户，编号为 $1\sim n$，一开始他们按照编号排名。

方伯伯会按照心情对这些用户做以下四种操作，修改用户的排名和编号：

1. 操作格式为 $1\ \ x\ \ y$，意味着将编号为 $x$ 的用户编号改为 $y$，而排名不变，执行完该操作后需要输出该用户在队列中的位置，数据保证 $x$ 必然出现在队列中，同时，$y$ 是一个当前不在排名中的编号。
2. 操作格式为 $2\ \ x$，意味着将编号为 $x$ 的用户的排名提升到第一位，执行完该操作后需要输出执行该操作前编号为 $x$ 用户的排名。
3. 操作格式为 $3\ \ x$，意味着将编号为 $x$ 的用户的排名降到最后一位，执行完该操作后需要输出执行该操作前编号为 $x$ 用户的排名。
4. 操作格式为 $4\ \ k$，意味着查询当前排名为 $k$ 的用户编号，执行完该操作后需要输出当前操作用户的编号。

但同时为了防止别人监听自己的工作，方伯伯对他的操作进行了加密，即将四种操作的格式分别改为了：

- $1\ \ x+a\ \ y+a$；
- $2\ \ x+a$；
- $3\ \ x+a$；
- $4\ \ k+a$；
- 其中 $a$ 为上一次操作得到的输出，一开始 $a=0$。

例如：上一次操作得到的输出是 $5$，这一次操作的输入为：$1\ \ 13\ \ 15$ 因为这个输入是经过加密后的，所以你应该处理的操作是 $1\ \ 8\ \ 10$。

现在你截获了方伯伯的所有操作，希望你能给出结果。
## 输入格式

输入的第 $1$ 行包含 $2$ 个用空格分隔的整数 $n$ 和 $m$，表示初始用户数和操作数。此后有 $m$ 行，每行是一个询问，询问格式如上所示。
## 输出格式

输出包含 $m$ 行。每行包含一个整数，其中第 $i$ 行的整数表示第 $i$ 个操作的输出。
## 样例

### 样例输入 #1
```
10 10
1 2 11
3 13
2 5
3 7
2 8
2 10
2 11
3 14
2 18
4 9
```
### 样例输出 #1
```
2
2
2
4
3
5
5
7
8
11
```
## 提示

对于 $100\%$ 的数据，$1 \le n \le 10^8$，$1 \le m \le 10^5$。

输入保证对于所有的操作 $1,2,3$，$x$ 必然已经出现在队列中，同时对于所有操作 $1$，$1 \le y \le 2\times 10^8$，并且 $y$ 没有出现在队列中。

对于所有操作 $4$，保证 $1 \le k \le n$。


---

---
title: "【模板】树套树"
layout: "post"
diff: 省选/NOI-
pid: P3380
tag: ['线段树', '平衡树', '树套树']
---
# 【模板】树套树
## 题目描述

您需要写一种数据结构（可参考题目标题），来维护一个有序数列，其中需要提供以下操作：

1. 查询 $k$ 在区间内的排名

2. 查询区间内排名为 $k$ 的值

3. 修改某一位置上的数值

4. 查询 $k$ 在区间内的前驱（前驱定义为严格小于 $x$，且最大的数，**若不存在输出 `-2147483647`**）

5. 查询 $k$ 在区间内的后继（后继定义为严格大于 $x$，且最小的数，**若不存在输出 `2147483647`**）
## 输入格式

第一行两个数 $n,m$，表示长度为 $n$ 的有序序列和 $m$ 个操作。

第二行有 $n$ 个数，表示有序序列。

下面有 $m$ 行，$opt$ 表示操作标号。

若 $opt=1$，则为操作 $1$，之后有三个数 $l~r~k$，表示查询 $k$ 在区间 $[l,r]$ 的排名。

若 $opt=2$，则为操作 $2$，之后有三个数 $l~r~k$，表示查询区间 $[l,r]$ 内排名为    $k$ 的数。

若 $opt=3$，则为操作 $3$，之后有两个数 $pos~k$，表示将 $pos$ 位置的数修改为 $k$。

若 $opt=4$，则为操作 $4$，之后有三个数 $l~r~k$，表示查询区间 $[l,r]$ 内 $k$ 的前驱。

若 $opt=5$，则为操作 $5$，之后有三个数 $l~r~k$，表示查询区间 $[l,r]$ 内 $k$ 的后继。
## 输出格式

对于操作 $1,2,4,5$，各输出一行，表示查询结果。
## 样例

### 样例输入 #1
```
9 6
4 2 2 1 9 4 0 1 1
2 1 4 3
3 4 10
2 1 4 3
1 2 5 9
4 3 9 5
5 2 8 5
```
### 样例输出 #1
```
2
4
3
4
9
```
## 提示

$1\le n,m\le5\times 10^4$，序列中的值在任何时刻 $\in[0,10^8]$。

题目来源：bzoj3196 / Tyvj1730，在此鸣谢。

此数据为洛谷原创。**（特别提醒：此数据不保证操作 4、5 一定存在，故请务必考虑不存在的情况。）**


---

---
title: "[POI 2005] SZA-Template"
layout: "post"
diff: 省选/NOI-
pid: P3426
tag: ['树形数据结构', '2005', '平衡树', 'POI（波兰）', 'KMP 算法']
---
# [POI 2005] SZA-Template
## 题目描述

你打算在纸上印一串字母。

为了完成这项工作，你决定刻一个印章。印章每使用一次，就会将印章上的**所有**字母印到纸上。

同一个位置的相同字符可以印多次。例如：用 `aba` 这个印章可以完成印制 `ababa` 的工作（中间的 `a` 被印了两次）。但是，因为印上去的东西不能被抹掉，在同一位置上印不同字符是不允许的。例如：用 `aba` 这个印章不可以完成印制 `abcba` 的工作。

因为刻印章是一个不太容易的工作，你希望印章的字符串长度尽可能小。
## 输入格式

输入一个长度不超过 $5 \times 10^5$ 的非空字符串（只包含小写字母），代表要在纸上印的字符。
## 输出格式

输出一个整数，代表印章上字符串长度的最小值。
## 样例

### 样例输入 #1
```
ababbababbabababbabababbababbaba
```
### 样例输出 #1
```
8
```
## 提示

印章为 `ababbaba`。

印制过程如下：

```plain
ababbababbabababbabababbababbaba
ababbaba
     ababbaba
            ababbaba
                   ababbaba
                        ababbaba
```


---

---
title: "[POI 2008] POC-Trains"
layout: "post"
diff: 省选/NOI-
pid: P3471
tag: ['2008', '平衡树', 'POI（波兰）', '离散化', '哈希 hashing']
---
# [POI 2008] POC-Trains
## 题目描述

The Trains of Colour Parade begins tomorrow in Byteotia.

Intense preparations are already in progress at the station's auxiliary tracks. There are $n$ parallel tracks at the station, numbered from $1$ to $n$. The train no. $i$ occupies the $i^{th}$ track.

Every train consists of $l$ cars and each car is painted with one of 26 colours (denoted by non-capital letters of the English alphabet).

We say that two trains look the same, if their corresponding cars are painted the same colour.

Throughout the parade a crane will switch places of certain pairs of cars. The real parade, however, will take place tomorrow.

Today the train dispatcher, Byteasar, watched the general rehearsal    closely. He even wrote down the sequence of car swaps.

Byteasar particularly dislikes many trains looking the same.

For each train $p$ he would like to calculate the maximum number    of trains that at some moment look the same as the train $p$ at the very same moment.

## Task

Write a programme that:

- reads descriptions of the trains occupying tracks and the sequence of car swaps,

- for each train determines the maximum number of trains that look the same as it at certain moment,

- writes out the result.


给出n个字符串，长度均为len；

有m次操作，每次将两个字符交换；

求每个字符串在任何时点上，与相同的它最多的字符串个数；

## 输入格式

The first line of the input contains three integers $n$, $l$ and $m$ ($2 \le n \le 1000$, $1 \le l \le 100$, $0 \le m \le 100\ 000$), denoting respectively the number of trains, their common length and the number of car swaps. The following $n$ lines contain descriptions of the trains on successive tracks. The

$k^{th}$ line consists of $l$ small letters of the English alphabet denoting the colours of successive cars of the $k^{th}$ train. Then $m$ lines describing the car swaps follow, in the order of the swaps. The $r^{th}$ line contains four integers $p_1$, $w_1$, $p_2$, $w_2$ ($1 \le p_1, p_2, \le n$, $1 \le w_1, w_2 \le l$, $p_1 \ne p_2$ or $w_1 \ne w_2$) denoting the $r^{th}$ car swap-the car no. $w_1$ of the train no. $p_1$ is swapped with the car no. $w_2$ of the train no. $p_2$.

## 输出格式

Your programme should write out exactly $n$ lines. The $k^[th}$ line should contain one integer-the number of trains looking the same as the train no. $k$ at certain moment.

## 样例

### 样例输入 #1
```
5 6 7
ababbd
abbbbd
aaabad
caabbd
cabaad
2 3 5 4
5 3 5 5
3 5 2 2
1 2 4 3
2 2 5 1
1 1 3 3
4 1 5 6

```
### 样例输出 #1
```
3
3
3
2
3

```
## 提示

The figure presents the successive car swaps:

```cpp
track 1:  ababbd    ababbd    ababbd    ababbd    aaabbd    aaabbd    aaabbd    aaabbd
track 2:  abbbbd    ababbd    ababbd    aaabbd    aaabbd    acabbd    acabbd    acabbd
track 3:  aaabad -> aaabad -> aaabad -> aaabbd -> aaabbd -> aaabbd -> aaabbd -> aaabbd
track 4:  caabbd    caabbd    caabbd    caabbd    cabbbd    cabbbd    cabbbd    dabbbd
track 5:  cabaad    cabbad    caabbd    caabbd    caabbd    aaabbd    aaabbd    aaabbc
           (0)       (1)       (2)       (3)       (4)       (5)       (6)       (7)
```

The number of trains looking the same as either of the trains no. 1, 2 or 3 was maximal at time (4) (when all three looked the same). The number of trains looking the same as the train no. 5 was maximal at time (5) and (6). The number of trains looking the same as the train no. 4 was maximal at time (2).



---

---
title: "方方方的数据结构"
layout: "post"
diff: 省选/NOI-
pid: P3710
tag: ['线段树', '平衡树', '洛谷原创', 'O2优化', '枚举', '分块', '洛谷月赛']
---
# 方方方的数据结构
## 题目描述

在很久很久以前，有一个长度为 $n$ 的数列，一开始数列全是 $0$。

方方方觉得这个数列太单调了，打算对它进行 $m$ 次操作，每次操作为区间加法或者区间乘法。

方方方进行一些操作之后，还可能会对某个数进行询问。

但是进行过一些操作之后，方方方可能会发现之前某次操作失误了，需要撤销这次操作，其它操作和其它操作的前后顺序保持不变。

方方方想好这些操作之后，马上想到了一个优秀的数据结构可以维护这些东西，可是他懒得写标程了，就生成了 $10$ 个**随机数据**，就把这道题扔给了你。

**数据全是随机的，生成方式见最下方的提示。**

## 输入格式

第一行两个数 $n,m$，表示数列的长度和操作个数。

接下来 $m$ 行每行 $2$ 或 $4$ 个数。

1. 如果第一个数为 $1$，接下来跟三个数 $l,r,d$，表示把区间 $[l,r]$ 中的数加上 $d$。
2. 如果第一个数为 $2$，接下来跟三个数 $l,r,d$，表示把区间 $[l,r]$ 中的数乘上 $d$。
3. 如果第一个数为 $3$，接下来跟一个数 $p$，表示询问 $p$ 位置的数 $\bmod\ 998244353$。
4. 如果第一个数为 $4$，接下来跟一个数 $p$，表示将第 $p$ 行输入的操作撤销（保证为加或者乘操作，一个操作不会被撤销两次）。

## 输出格式

对于每个 $3$ 操作输出一行表示答案。

## 样例

### 样例输入 #1
```
6 14
1 1 5 1
2 2 4 3
1 2 6 5
3 2
4 1
3 3
2 1 3 4
3 3
1 2 2 3
3 2
4 7
3 1
3 2
3 3
```
### 样例输出 #1
```
8
5
20
23
0
8
5
```
## 提示

对于 $20\%$ 的数据，$n,m \leq 500$，时限 1s。

对于 $50\%$ 的数据，$n,m \leq 30000$，时限 1s。

对于 $100\%$ 的数据，$1 \leq n,m \leq 150000$，$1 \le l \le r \le n$，$3$ 操作的 $p$ 满足 $1 \le p \le n$，$4$ 操作的 $p$ 满足 $1 \le p \le m$，$0 \leq d \leq 1073741823$（原因见数据生成器），时限 4.5s。


数据生成器：

```cpp
#include <bits/stdc++.h>
using namespace std;
int rand_() {return rand()&32767;} 
int br() {return rand_()*32768+rand_();}
vector<int> cs;
int main()
{
    srand(...); //这里要填一个种子 
    int n=...,m=...; //这里要填n、m
    cout<<n<<" "<<m<<"\n";
    for(int i=1;i<=m;i++)
    {
        int o=rand()%4+1;
        if(o<=2)
        {
            cout<<o<<" ";
            int l=br()%n+1,r=br()%n+1;
            if(l>r) swap(l,r); cs.push_back(i);
            cout<<l<<" "<<r<<" "<<br()<<"\n";
        }
        else if(o==3) cout<<o<<" "<<br()%n+1<<"\n";
        else
        {
            if(!cs.size()) {--i; continue;}
            int s=br()%cs.size(),g=cs[s];
            cs.erase(cs.begin()+s);
            cout<<o<<" "<<g<<"\n";
        }
    }
}
```


---

---
title: "总统选举"
layout: "post"
diff: 省选/NOI-
pid: P3765
tag: ['线段树', '平衡树', '洛谷原创', 'O2优化', '枚举', '构造', '洛谷月赛']
---
# 总统选举
## 题目背景

黑恶势力的反攻计划被小 C 成功摧毁，黑恶势力只好投降。秋之国的人民解放了，举国欢庆。此时，原秋之国总统因没能守护好国土，申请辞职，并请秋之国人民的大救星小 C 钦定下一任。

作为一名民主人士，小 C 决定举行全民大选来决定下一任。为了使最后成为总统的人得到绝大多数人认同，小 C 认为，一个人必须获得超过全部人总数的一半的票数才能成为总统。如果不存在符合条件的候选人，小 C 只好自己来当临时大总统。为了尽可能避免这种情况，小 C 决定先进行几次小规模预选，根据预选的情况，选民可以重新决定自己选票的去向。

由于秋之国人数较多，统计投票结果和选票变更也成为了麻烦的事情，小 C 找到了你，让你帮他解决这个问题。
## 题目描述

秋之国共有 $n$ 个人，分别编号为 $1,2,…,n$，一开始每个人都投了一票，范围 $1 \sim n$，表示支持对应编号的人当总统。

共有 $m$ 次预选，每次选取编号 $[l_i,r_i]$ 内的选民展开小规模预选，在该区间内获得超过区间大小一半的票的人获胜。如果没有人获胜，则由小 C 钦定一位候选者获得此次预选的胜利（获胜者可以不在该区间内），每次预选的结果需要公布出来，并且每次会有 $k_i$ 个人决定将票改投向该次预选的获胜者。

全部预选结束后，公布最后成为总统的候选人。
## 输入格式

第一行两个整数 $n,m$，表示秋之国人数和预选次数。

第二行 $n$ 个整数，分别表示编号 $1 \sim n$ 的选民投的票。

接下来 $m$ 行，每行先有四个整数，分别表示 $l_i,r_i,s_i,k_i$，$s_i$ 表示若此次预选无人胜选，视作编号为 $s_i$ 的人获得胜利，接下来 $k_i$ 个整数，分别表示决定改投的选民。
## 输出格式

共 $m+1$ 行，前 $m$ 行表示各次预选的结果，最后一行表示最后成为总统的候选人，若最后仍无人胜选，输出 $-1$。
## 样例

### 样例输入 #1
```
5 4
1 2 3 4 5
1 2 1 1 3
5 5 1 2 2 4
2 4 2 0
3 4 2 1 4
```
### 样例输出 #1
```
1
5
5
2
-1
```
## 提示

对于前 $20 \%$ 的数据，$1 \leq n,m \leq 5000$。

对于前 $40 \%$ 的数据，$1 \leq n,m \leq 50000$，$\sum k_i \leq 50000$。

对于前 $50 \%$ 的数据，$1 \leq n,m \leq {10}^5$，$\sum k_i \leq 2 \times {10}^5$。

对于数据点 6~7，保证所有选票始终在 $1 \sim 10$ 之间。

对于 $100 \%$ 的数据，$1 \leq n,m \leq 5 \times {10}^5$，$\sum k_i \leq 10^6$，$1 \leq l_i \leq r_i \leq n$，$1 \leq s_i \leq n$。


---

---
title: "[CH弱省胡策R2] TATT"
layout: "post"
diff: 省选/NOI-
pid: P3769
tag: ['线段树', '平衡树', '分治', '排序', 'K-D Tree']
---
# [CH弱省胡策R2] TATT
## 题目描述

四维空间真是美妙。现在有 $n$ 个四维空间中的点，请求出一条最长的路径，满足任意一维坐标都是单调不降的。

注意路径起点是任意选择的，并且路径与输入顺序无关（路径顺序不一定要满足在输入中是升序）。

**路径的长度是经过的点的数量，任意点只能经过一次。**
## 输入格式

第一行一个整数 $n$。接下来 $n$ 行，每行四个整数 $a_i,b_i,c_i,d_i$。表示四维坐标。
## 输出格式

一行一个整数，表示最长路径的长度。
## 样例

### 样例输入 #1
```
4
2 3 33 2333
2 3 33 2333
2 3 33 2333
2 3 33 2333

```
### 样例输出 #1
```
4

```
## 提示

记 $m_i=\max(|a_i|,|b_i|,|c_i|,|d_i|),m=\max(m_i)$
|  测试点编号| $n\le$ | $m\le$ | 特殊说明 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $2000$ | $10^9$ |  |
| $2$ |$5\times 10^4$  | $8$ |  |
| $3\sim 4$ | $5\times 10^4$ | $10^5$ |  所有点的第三，四维坐标相同|
| $5\sim 6$| $5\times 10^4$ | $10^5$ |  所有点的第四维坐标相同 |
| $7\sim 8$ | $5\times 10^4$ |$100$  |  |
|  $9\sim 10$| $5\times 10^4$ | $10^9$ |  |


---

---
title: "【模板】可持久化平衡树"
layout: "post"
diff: 省选/NOI-
pid: P3835
tag: ['线段树', '平衡树', '深度优先搜索 DFS', '可持久化']
---
# 【模板】可持久化平衡树
## 题目背景

本题为题目 **普通平衡树** 的可持久化加强版。

**数据已经经过强化**

**感谢@Kelin 提供的一组hack数据**

## 题目描述

您需要写一种数据结构（可参考题目标题），来维护一个可重整数集合，其中需要提供以下操作（ **对于各个以往的历史版本** ）：


1、 插入 $x$

2、 删除 $x$（若有多个相同的数，应只删除一个，**如果没有请忽略该操作**）


3、 查询 $x$ 的排名（排名定义为比当前数小的数的个数 $+1$）


4、查询排名为 $x$ 的数


5、 求 $x$ 的前驱（前驱定义为小于 $x$，且最大的数，**如不存在输出** $-2^{31}+1$ ）


6、求 $x$ 的后继（后继定义为大于 $x$，且最小的数，**如不存在输出** $2^{31}-1$ ）


**和原本平衡树不同的一点是，每一次的任何操作都是基于某一个历史版本，同时生成一个新的版本。（操作3, 4, 5, 6即保持原版本无变化）**

每个版本的编号即为操作的序号（版本0即为初始状态，空树）

## 输入格式

第一行包含一个正整数 $n$ ，表示操作的总数。

接下来 $n$ 行，每行包含三个整数，第 $i$ 行记为 $v_i, \text{opt}_i, x_i$。

$v_i$ 表示基于的过去版本号，$\text{opt}_i$ 表示操作的序号， $x_i$ 表示参与操作的数值

## 输出格式

每行包含一个整数，依次为各个 $3,4,5,6$ 操作所对应的答案

## 样例

### 样例输入 #1
```
10
0 1 9
1 1 3
1 1 10
2 4 2
3 3 9
3 1 2
6 4 1
6 2 9
8 6 3
4 5 8
```
### 样例输出 #1
```
9
1
2
10
3
```
## 提示

【数据范围】   
对于 $28\%$ 的数据，$ 1 \leq n \leq 10 $；   
对于 $44\%$ 的数据，$ 1 \leq n \leq 2\times {10}^2 $；   
对于 $60\%$ 的数据， $ 1 \leq n \leq 3\times {10}^3 $；   
对于 $84\%$ 的数据， $ 1 \leq n \leq {10}^5 $；   
对于 $92\%$ 的数据， $ 1 \leq n \leq 2\times {10}^5 $；   
对于 $100\%$ 的数据， $ 1 \leq n \leq 5 \times  10^5 $ , $|x_i| \leq {10}^9$，$0 \le v_i < i$，$1\le \text{opt} \le 6$。

**经实测，正常常数的可持久化平衡树均可通过，请各位放心**



样例说明：

共 $10$ 次操作，$11$ 个版本，各版本的状况依次是：

0.  $[]$

1.  $[9]$

2.  $[3, 9]$

3.  $[9, 10]$

4.  $[3, 9]$

5.  $[9, 10]$

6.  $[2, 9, 10]$

7.  $[2, 9, 10]$

8.  $[2, 10]$

9.  $[2, 10]$

10.  $[3, 9]$



---

---
title: "[TJOI2007] 书架"
layout: "post"
diff: 省选/NOI-
pid: P3850
tag: ['2007', '各省省选', '平衡树', '枚举', '天津']
---
# [TJOI2007] 书架
## 题目描述

Knuth 先生家里有个精致的书架，书架上有 $N$ 本书，如今他想学到更多的知识，于是又买来了 $M$ 本不同的新书。现在他要把新买的书依次插入到书架中，他已经把每本书要插入的位置标记好了，并且相应的将它们放好。由于 Knuth 年龄已大，过几天他已经记不清某些位置上放的到底是什么书了，请问你能帮助他吗？

## 输入格式

输入文件的第一行为整数 $N$，接下来 $N$ 行分别是书架上依次放着的 N 本书的书名（书名由不含空格的字符串构成，长度不超过 $10$）。下一行将要输入一个整数 $M$，接下来的 $M$ 行分别为这本书的书名和要插入的位置。下一行将要输入一个整数 $Q$，接下来共有 $Q$ 次询问，每行都是一个整数表示询问的位置。（书架上位置的编号从 $0$ 开始）

## 输出格式

输出 $Q$ 行，每行对应着相应查询位置的书名。

## 样例

### 样例输入 #1
```
3
Math
Algorithm
Program
2
Picture 2
System 1
3
0
1
3
```
### 样例输出 #1
```
Math
System
Picture
```
## 提示

原来有三本书 Math、Algorithm、Program，后来又买了两本书，分别插入到 $2$ 和 $1$ 的位置，每次插入时其他书都要向后挪一个位置，最后书架上书的序列为：

```plain
0  Math
1  System
2  Algorithm
3  Picture
4  Program
```
$Q$ 次询问依次为 $0$, $1$, $3$ 位置的书，所以答案为：Math、System、Picture


对于 $30\%$ 的数据，$1 \leqslant N \leqslant 100$, $1 \leqslant M \leqslant 10^3$, $1 \leqslant Q \leqslant 10^3$

对于 $100\%$ 的数据，$1 \leqslant N \leqslant 200$, $1 \leqslant M \leqslant 10^5$, $1 \leqslant Q \leqslant 10^4$

对于 $100\%$ 的数据都符合题目中所描述的限制关系，数据保证每次插入的位置均不超过当时书架上书的数量，而且保证 $Q$ 次查询中的每个位置上一定有书。


---

---
title: "[NOIP 2017 提高组] 列队"
layout: "post"
diff: 省选/NOI-
pid: P3960
tag: ['2017', '线段树', '平衡树', '树状数组', 'NOIP 提高组']
---
# [NOIP 2017 提高组] 列队
## 题目背景

NOIP2017 D2T3
## 题目描述

`Sylvia` 是一个热爱学习的女孩子。

前段时间，`Sylvia` 参加了学校的军训。众所周知，军训的时候需要站方阵。

Sylvia 所在的方阵中有 $n \times m$ 名学生，方阵的行数为 $n$，列数为 $m$。

为了便于管理，教官在训练开始时，按照从前到后，从左到右的顺序给方阵中 的学生从 $1$ 到 $n \times m$ 编上了号码（参见后面的样例）。即：初始时，第 $i$ 行第 $j$ 列 的学生的编号是 $(i-1)\times m + j$。

然而在练习方阵的时候，经常会有学生因为各种各样的事情需要离队。在一天 中，一共发生了 $q$ 件这样的离队事件。每一次离队事件可以用数对 $(x,y) (1 \le x \le n, 1 \le y \le m)$ 描述，表示第 $x$ 行第 $y$ 列的学生离队。

在有学生离队后，队伍中出现了一个空位。为了队伍的整齐，教官会依次下达 这样的两条指令：


1. 向左看齐。这时第一列保持不动，所有学生向左填补空缺。不难发现在这条 指令之后，空位在第 $x$ 行第 $m$ 列。
2. 向前看齐。这时第一行保持不动，所有学生向前填补空缺。不难发现在这条 指令之后，空位在第 $n$ 行第 $m$ 列。


教官规定不能有两个或更多学生同时离队。即在前一个离队的学生归队之后， 下一个学生才能离队。因此在每一个离队的学生要归队时，队伍中有且仅有第 $n$ 行 第 $m$ 列一个空位，这时这个学生会自然地填补到这个位置。

因为站方阵真的很无聊，所以 `Sylvia` 想要计算每一次离队事件中，离队的同学 的编号是多少。

注意：每一个同学的编号不会随着离队事件的发生而改变，在发生离队事件后 方阵中同学的编号可能是乱序的。

## 输入格式

输入共 $q+1$ 行。

第一行包含 $3$ 个用空格分隔的正整数 $n, m, q$，表示方阵大小是 $n$ 行 $m$ 列，一共发 生了 $q$ 次事件。

接下来 $q$ 行按照事件发生顺序描述了 $q$ 件事件。每一行是两个整数 $x, y$，用一个空 格分隔，表示这个离队事件中离队的学生当时排在第 $x$ 行第 $y$ 列。

## 输出格式

按照事件输入的顺序，每一个事件输出一行一个整数，表示这个离队事件中离队学生的编号。

## 样例

### 样例输入 #1
```
2 2 3 
1 1 
2 2 
1 2 
```
### 样例输出 #1
```
1
1
4

```
## 提示

【输入输出样例 $1$ 说明】

$$\begin{matrix}
\begin{bmatrix}
1 & 2 \\
3 & 4 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
 & 2 \\
3 & 4 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 &  \\
3 & 4 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix} \\[1em]
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix}\\[1em]
\begin{bmatrix}
2 & 4 \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 &  \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 &  \\
3 & 1 \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 1 \\
3 &  \\
\end{bmatrix} & \Rightarrow & 
\begin{bmatrix}
2 & 1 \\
3 & 4 \\
\end{bmatrix}
\end{matrix}$$


列队的过程如上图所示，每一行描述了一个事件。 在第一个事件中，编号为 $1$ 的同学离队，这时空位在第一行第一列。接着所有同学 向左标齐，这时编号为 $2$ 的同学向左移动一步，空位移动到第一行第二列。然后所有同 学向上标齐，这时编号为 $4$ 的同学向上一步，这时空位移动到第二行第二列。最后编号为 $1$ 的同学返回填补到空位中。

【数据规模与约定】

| 测试点编号 | $n$ | $m$ | $q$ | 其他约定 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim 6$ | $\le 10^3$ | $\le 10^3$ | $\le 500$ | 无 |
| $7\sim 10$ | $\le 5\times 10^4$ | $\le 5\times 10^4$ | $\le 500$ | 无 |
| $11\sim 12$ | $=1$ | $\le 10^5$ | $\le 10^5$ | 所有事件 $x=1$ |
| $13\sim 14$ | $=1$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | 所有事件 $x=1$ |
| $15\sim 16$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | 所有事件 $x=1$ |
| $17\sim 18$ | $\le 10^5$ | $\le 10^5$ | $\le 10^5$ | 无 |
| $19\sim 20$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | $\le 3\times 10^5$ | 无 |

数据保证每一个事件满足 $1 \le x \le n,1 \le y \le m$。



---

---
title: "[TJOI2014] 电源插排"
layout: "post"
diff: 省选/NOI-
pid: P3968
tag: ['2014', '线段树', '各省省选', '平衡树', '天津']
---
# [TJOI2014] 电源插排
## 题目描述

小 M 的实验室有很多电源插排。这些插排的编号从 $1$ 到 $n$，由左向右排成一排。

每天早晨，这些插排都是没有被使用的。每当一个学生来到实验室，他就将自己的笔记本电源插到某一个未被使用的插排上。

实验室的同学们都很奇怪，他们完成这个过程是这样的：首先，他们找到还没有被使用的插排的最长区间。

如果有多个区间长度相同，他们就选择最靠右的那个。然后将自己的电源插到该区间的中间。

如果区间长度是偶数，他们同样选择靠右的那个。当一个同学离开实验室时,他会将自己的电源拔出来。

数据保证每一个同学来到实验室时，至少有一个空的插排。

需要计算在区间 $[l,r]$ 已经有多少个插排被使用了。
## 输入格式

第一行是两个整数 $n$ 和 $q$，表示插排数量和询问数量。

接下来 $q$ 行，每一行以一个整数 $k$ 开头。

> 如果 $k$ 为 $0$，接下来就是两个整数 $l$ 和 $r$，表示一个询问。
>
> 否则 $k$ 表示表示编号为 $k$ 的学生到来或离开。$k$ 的奇数次出现表示到来，偶数次出现表示离开。每个学生的编号都是唯一的。

## 输出格式

对于每一个询问，输出一个整数，表示询问区间内有多少个插排已经被使用。
## 样例

### 样例输入 #1
```
7 10
1
2
3
0 1 2
0 4 7
0 2 5
20
0 6 6
99
0 4 6
```
### 样例输出 #1
```
1
2
2
1
3
```
## 提示

#### 数据规模与约定

对于 $30\%$ 的数据，$n \le 10^5，q \le 10^3$；

对于 $100\%$ 的数据，$1\le n \le 10^9,1\le q \le 10^5,0\le k \le 10^9,1\le l\le r\le n$。


---

---
title: "我永远喜欢珂朵莉~"
layout: "post"
diff: 省选/NOI-
pid: P3987
tag: ['平衡树', '树状数组', '深度优先搜索 DFS', '洛谷月赛']
---
# 我永远喜欢珂朵莉~
## 题目背景

http://sukasuka-anime.com/

戒不掉的珂毒

出不动的分块

 ![](https://cdn.luogu.com.cn/upload/pic/11191.png) 

 ![](https://cdn.luogu.com.cn/upload/pic/11192.png) 

 ![](https://cdn.luogu.com.cn/upload/pic/11193.png) 

哦对了有没有想买BD的珂学家啊？支持一下墨鱼吧~

或者有没有人想来手办众筹啊？

## 题目描述

给珂朵莉一个长为 $n$ 的非负数序列 $a$，支持以下两个操作：

- $\verb!1 l r x!$：把区间 $[l,r]$ 中所有 $x$ 的倍数除以 $x$。
- $\verb!2 l r!$：查询区间 $[l,r]$ 内元素的和。

珂朵莉很可爱，所以你要帮珂朵莉写这个题。

## 输入格式

第一行两个数表示 $n,m$。

第二行 $n$ 个非负整数表示 $a_i$。

之后 $m$ 行每行一个操作：

- $\verb!1 l r x!$：把区间 $[l,r]$ 中所有 $x$ 的倍数除以 $x$。
- $\verb!2 l r!$：查询区间 $[l,r]$ 内元素的和。

## 输出格式

对于每次询问，输出一行一个数表示答案。

## 样例

### 样例输入 #1
```
5 3
1 2 3 4 5
2 1 5
1 1 5 2
2 1 5
```
### 样例输出 #1
```
15
12
```
## 提示

### 数据范围及约定

$1 \le n , m \le 10^5$，$0 \le a_i \le 5\times 10^5$，$1 \le x \le 5\times 10^5$。



---

---
title: "[SHOI2013] 发牌"
layout: "post"
diff: 省选/NOI-
pid: P3988
tag: ['模拟', '2013', '线段树', '各省省选', '平衡树', '树状数组', '上海', '可持久化线段树']
---
# [SHOI2013] 发牌
## 题目描述

在一些扑克游戏里，如德州扑克，发牌是有讲究的。一般称呼专业的发牌手为荷官。荷官在发牌前，先要销牌（burn card）。所谓销牌，就是把当前在牌库顶的那一张牌移动到牌库底，它用来防止玩家猜牌而影响游戏。

假设一开始，荷官拿出了一副新牌，这副牌有 $N$ 张不同的牌，编号依次为 $1$ 到 $N$。由于是新牌，所以牌是按照顺序排好的，从牌库顶开始，依次为 $1,2,\cdots,N$，$N$ 号牌在牌库底。为了发完所有的牌，荷官会进行 $N$ 次发牌操作，在第 $i$ 次发牌之前，他会连续进行 $R_i$ 次销牌操作，$R_i$ 由输入给定。请问最后玩家拿到这副牌的顺序是什么样的？

举个例子，假设 $N=4$，则一开始的时候，牌库中牌的构成顺序为 $1,2,3,4$。

- 假设 $R_1=2$，则荷官应该连销两次牌，将 $1$ 和 $2$ 放入牌库底，再将 $3$ 发给玩家。目前牌库中的牌顺序为 $4,1,2$。
- 假设 $R_2=0$，荷官不需要销牌，直接将 $4$ 发给玩家，目前牌库中的牌顺序为 $1,2$。
- 假设 $R_3=3$，则荷官依次销去了 $1,2,1$，再将 $2$ 发给了玩家。目前牌库仅剩下一张牌 $1$。
- 假设 $R_4=2$，荷官在重复销去两次 $1$ 之后，还是将 $1$ 发给了玩家，这是因为 $1$ 是牌库中唯一的一张牌。
## 输入格式

第一行，一个整数 $N$，表示牌的数量。

第二行到第 $N+1$ 行，在第 $i+1$ 行，有一个整数 $R_i$。

## 输出格式

共 $N$ 行，第 $i$ 行有一个整数，表示玩家收到的第 $i$ 张牌的编号。
## 样例

### 样例输入 #1
```
4
2
0
3
2
```
### 样例输出 #1
```
3
4
2
1
```
## 提示

#### 数据规模与约定

对于 $100 \%$ 的数据，$0 \le R_i < N$。  

| 测试点编号 | $N=$ | 测试点编号 | $N=$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $5\times 10^3$ | $6$ | $3\times 10^5$ |
| $2$ | $10^4$ |  $7$ | $4\times 10^5$ |
| $3$ | $5\times 10^4$ | $8$ | $5\times 10^5$ |
| $4$ | $10^5$ | $9$ | $6\times 10^5$ |
| $5$ | $2\times 10^5$ | $10$ | $7\times 10^5$ |


---

---
title: "[BJOI2017] 喷式水战改"
layout: "post"
diff: 省选/NOI-
pid: P3991
tag: ['动态规划 DP', '2017', '各省省选', '平衡树', '北京', 'O2优化', '分治']
---
# [BJOI2017] 喷式水战改
## 题目背景

拿到了飞机的驾照(?)，这样补给就不愁了

XXXX年XX月XX日

拿到了喷气机(??)的驾照，这样就飞得更快了

XXXX年XX月XX日

拿到了攻击机(???)的驾照（不存在的）

XXXX年XX月XX日

用铅版做夹层的话，机身可是会变重的呢

XXXX年XX月XX日

幸酱的特制快递，精确投递到了目标地点

-------------------------------------

又是核平的一天。

天音正在给喷气机做保养，并充填燃料。

这种喷气机是某姬(?????)特别制作的，发动机拥有三种工作状态

1、通常型（Original）：在高空平飞或隐蔽飞行时进行的低功耗高效率工作状态

2、后期型（Extended）：为在俯冲时最大化能量利用率而特别改造过的工作状态

3、增强型（Enhanced）：在俯冲攻击结束后为产生极限扭力抬高高度的工作状态

在一次攻击中，喷气机将会经历"通常-后期-增强-通常"的工作流程

不同工作状态中，燃料的利用效率是不同的

现在天音正在调整喷气机燃料装填序列

你需要做的就是求出燃料能产生的最大总能量

为什么是你？

和平还是核平，选一个吧

## 题目描述

初始燃料序列为空。每次操作会向序列中的 $p _ i$ 位置添加 $x _ i$ 单位的同种燃料，该燃料每一单位在三种工作状态下能产生的能量分别为 $a _ i, b _ i, c _ i$。

添加的位置 $p _ i$ 是指，在添加后，加入的第一个单位燃料前面有 $p _ i$ 个单位的原燃料。

全部的 $x _ i$ 单位燃料依次放置，然后原来在 $p _ i$ 位置的燃料（如果有的话）依次向后排列。

对于一个确定的燃料序列，其能产生的最大总能量为：将序列依次分成"通常-后期-增强-通常"四段（每段可以为空），每一段在对应工作状态下产生的能量之和的最大值。

对于每次添加操作，你需要给出该次操作使得最大总能量增加了多少。

如果对于这种计算方式没有直观的感受，可以查看样例说明。

## 输入格式

第一行一个数 $n$，表示操作个数。

接下来 $n$ 行，每行 $5$ 个数 $p _ i, a _ i, b _ i, c _ i, x _ i$，空格分隔，表示向序列中的 $p _ i$ 位置添加 $x _ i$ 单位的同种燃料

这种燃料每单位在通常、后期、增强工作状态下产生的能量分别为 $a _ i, b _ i, c _ i$。


## 输出格式

$n$ 行，每行一个数，表示该次操作后能量序列所能产生的最大总能量增加了多少。

## 样例

### 样例输入 #1
```
5
0 25 37 46 2
1 32 14 16 3
3 99 77 88 4
2 43 68 57 5
14 72 36 18 6

```
### 样例输出 #1
```
92
75
396
319
432
```
## 提示

第一次操作后，燃料序列为[1 1]，最大能量发生方式为[En1 En1]，共46+46=92。

第二次操作后，燃料序列为[1 2 2 2 1]，最大能量发生方式为[Or1 Or2 Or2 Or2 En1]，共25+32+32+32+46=167，增加了167-92=75。

第三次操作后，燃料序列为[1 2 2 3 3 3 2 1]，最大能量发生方式为[Or1 Or2 Or2 Or3 Or3 Or3 Or3 Or2 En1]，增加了99\*4=396。

第四次操作后，燃料序列为[1 2 4 4 4 4 4 2 3 3 3 2 1]

最大能量发生方式为[Or1 Or2 Ex4 Ex4 Ex4 Ex4 Ex4 Or2 Or3 Or3 Or3 Or3 Or2 Or1]。

第五次操作后，燃料序列为[1 2 4 4 4 4 4 2 3 3 3 2 1 5 5 5 5 5 5]

最大能量发生方式为[Or1 Or2 Ex4 Ex4 Ex4 Ex4 Ex4 Or2 Or3 Or3 Or3 Or3 Or2 Or1 Or5 Or5 Or5 Or5 Or5 Or5]。


对于 $100\%$ 的数据，$1 \leq n \leq 10^5$, $1 \leq a_i, b_i, c_i \leq 10^4$， $1 \leq x_i \leq 10^9$。

对于 $100\%$ 的数据，保证插入时序列中至少已有 $p _ i$ 单位的燃料。

后 $50\%$ 数据有梯度。



---

---
title: "[NOI2003] 文本编辑器"
layout: "post"
diff: 省选/NOI-
pid: P4008
tag: ['字符串', '2003', '平衡树', '递归', 'NOI', '分块']
---
# [NOI2003] 文本编辑器
## 题目描述

很久很久以前，$DOS3.x$ 的程序员们开始对 $EDLIN$ 感到厌倦。于是，人们开始纷纷改用自己写的文本编辑器⋯⋯

多年之后，出于偶然的机会，小明找到了当时的一个编辑软件。进行了一些简单的测试后，小明惊奇地发现：那个软件每秒能够进行上万次编辑操作（当然，你不能手工进行这样的测试） ！于是，小明废寝忘食地想做一个同样的东西出来。你能帮助他吗？

为了明确目标，小明对“文本编辑器”做了一个抽象的定义:

文本：由 $0$ 个或多个 ASCII 码在闭区间 [$32$, $126$] 内的字符构成的序列。

光标：在一段文本中用于指示位置的标记，可以位于文本首部，文本尾部或文本的某两个字符之间。


文本编辑器：由一段文本和该文本中的一个光标组成的，支持如下操作的数据结构。如果这段文本为空，我们就说这个文本编辑器是空的。

| 操作名称  | 输入文件中的格式  | 功能  |
| :------------ | :------------ | :------------ |
| $\text{Move}(k)$  | Move k  |  将光标移动到第 $k$ 个字符之后，如果 $k=0$，将光标移到文本开头 |
| $\text{Insert}(n,s)$  | Insert n s  | 在光标处插入长度为 $n$ 的字符串 $s$，光标位置不变$n\geq1$|
| $\text{Delete}(n)$  | Delete n  | 删除光标后的 $n$ 个字符，光标位置不变，$n \geq 1$  |
| $\text{Get}(n)$  | Get n  |输出光标后的 $n$ 个字符，光标位置不变，$n \geq 1$   |
| $\text{Prev}()$  | Prev  | 光标前移一个字符  |
| $\text{Next}()$  | Next |  光标后移一个字符 |


你的任务是：

- 建立一个空的文本编辑器。

- 从输入文件中读入一些操作并执行。

- 对所有执行过的 `GET` 操作，将指定的内容写入输出文件。

## 输入格式

输入文件 `editor.in` 的第一行是指令条数 $t$，以下是需要执行的 $t$ 个操作。其中：

为了使输入文件便于阅读， `Insert` 操作的字符串中可能会插入一些回车符， 请忽略掉它们（如果难以理解这句话，可以参照样例） 。

除了回车符之外，输入文件的所有字符的 ASCII 码都在闭区间 [$32$, $126$] 内。且

行尾没有空格。

这里我们有如下假定：

-  `MOVE` 操作不超过 $50000$ 个， `INSERT` 和 `DELETE` 操作的总个数不超过 $4000$，`PREV` 和 `NEXT` 操作的总个数不超过 $200000$。

-  所有 `INSERT` 插入的字符数之和不超过 $2M$（$1M=1024\times 1024$ 字节） ，正确的输出文件长度不超过 $3M$ 字节。

-  `DELETE` 操作和 `GET` 操作执行时光标后必然有足够的字符。 `MOVE` 、 `PREV` 、 `NEXT` 操作必然不会试图把光标移动到非法位置。

-  输入文件没有错误。

对 C++ 选手的提示：经测试，最大的测试数据使用 `fstream` 进行输入有可能会比使用 `stdio` 慢约 $1$ 秒。
## 输出格式

输出文件 editor.out 的每行依次对应输入文件中每条 `Get` 指令的输出。

## 样例

### 样例输入 #1
```
15
Insert 26
abcdefghijklmnop
qrstuv wxy
Move 15
Delete 11
Move 5
Insert 1
^
Next
Insert 1
_
Next
Next
Insert 4
.\/.
Get 4
Prev
Insert 1
^
Move 0
Get 22


```
### 样例输出 #1
```
.\/.
abcde^_^f.\/.ghijklmno

```


---

---
title: "[JSOI2008] 火星人"
layout: "post"
diff: 省选/NOI-
pid: P4036
tag: ['字符串', '2008', '各省省选', '平衡树', '江苏', '哈希 hashing']
---
# [JSOI2008] 火星人
## 题目描述

火星人最近研究了一种操作：求一个字串两个后缀的公共前缀。

比方说，有这样一个字符串：madamimadam，我们将这个字符串的各个字符予以标号：
```
序号 1 2 3 4 5 6 7 8 9 10 11 
字符 m a d a m i m a d a m
```
现在，火星人定义了一个函数 $LCQ(x, y)$，表示：该字符串中第 $x$ 个字符开始的字串，与该字符串中第 $y$ 个字符开始的字串，两个字串的公共前缀的长度。比方说，$LCQ(1, 7) = 5, LCQ(2, 10) = 1, LCQ(4, 7) = 0$

在研究 $LCQ$ 函数的过程中，火星人发现了这样的一个关联：如果把该字符串的所有后缀排好序，就可以很快地求出 $LCQ$ 函数的值；同样，如果求出了 $LCQ$ 函数的值，也可以很快地将该字符串的后缀排好序。

尽管火星人聪明地找到了求取 $LCQ$ 函数的快速算法，但不甘心认输的地球人又给火星人出了个难题：在求取 $LCQ$ 函数的同时，还可以改变字符串本身。具体地说，可以更改字符串中某一个字符的值，也可以在字符串中的某一个位置插入一个字符。地球人想考验一下，在如此复杂的问题中，火星人是否还能够做到很快地求取 $LCQ$ 函数的值。
## 输入格式

第一行给出初始的字符串。第二行是一个非负整数 $M$ ，表示操作的个数。接下来的M行，每行描述一个操作。操作有 $3$ 种，如下所示

1. 询问。语法：$Q$ $x$ $y$ ，$x$ ,$y$ 均为正整数。功能：计算 $LCQ(x,y)$ 限制：$1$ $\leq$ $x$ , $y$ $\leq$ 当前字符串长度 。
2. 修改。语法：$R$ $x$ $d$，$x$ 是正整数，$d$ 是字符。功能：将字符串中第 $x$ 个数修改为字符 $d$ 。限制：$x$ 不超过当前字符串长度。
3. 插入：语法：$I$ $x$ $d$ ，$x$ 是非负整数，$d$ 是字符。功能：在字符串第 $x$ 个字符之后插入字符 $d$ ，如果 $x=0$，则在字符串开头插入。限制：$x$ 不超过当前字符串长度
## 输出格式

对于输入文件中每一个询问操作，你都应该输出对应的答案。一个答案一行。
## 样例

### 样例输入 #1
```
madamimadam
7
Q 1 7
Q 4 8
Q 10 11
R 3 a
Q 1 7
I 10 a
Q 2 11
```
### 样例输出 #1
```
5
1
0
2
1
```
## 提示

1. 所有字符串自始至终都只有小写字母构成。
2. $M\leq150,000$
3. 字符串长度L自始至终都满足$L\leq100,000$
4. 询问操作的个数不超过 $10,000$ 个。

对于第 $1$，$2$ 个数据，字符串长度自始至终都不超过 $1,000$
对于第 $3$，$4$，$5$ 个数据，没有插入操作。

2024/07/40 更新一组 hack。


---

---
title: "[SDOI2016] 生成魔咒"
layout: "post"
diff: 省选/NOI-
pid: P4070
tag: ['字符串', '2016', '各省省选', '平衡树', '山东', '后缀自动机 SAM', '后缀数组 SA']
---
# [SDOI2016] 生成魔咒
## 题目描述

魔咒串由许多魔咒字符组成，魔咒字符可以用数字表示。例如可以将魔咒字符 $1,2$ 拼凑起来形成一个魔咒串 $[1,2]$。

一个魔咒串 $S$ 的非空字串被称为魔咒串 $S$ 的生成魔咒。

例如 $S=[1,2,1]$ 时，它的生成魔咒有 $[1],[2],[1,2],[2,1],[1,2,1]$ 五种。$S=[1,1,1]$ 时，它的生成魔咒有 $[1],[1,1],[1,1,1]$ 三种，最初 S 为空串。  

共进行 $n$ 次操作，每次操作是在 $S$ 的结尾加入一个魔咒字符。每次操作后都需要求出，当前的魔咒串 $S$ 共有多少种生成魔咒。

## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个数，第 $i$ 个数表示第 $i$ 次操作加入的魔咒字符 $x_i$。

## 输出格式

输出 $n$ 行，每行一个数。  
第 $i$ 行的数表示第 $i$ 次操作后 $S$ 的生成魔咒数量。

## 样例

### 样例输入 #1
```
7
1 2 3 3 3 1 2
```
### 样例输出 #1
```
1
3
6
9
12
17
22
```
## 提示

#### 数据规模与约定   
对于 $10\%$ 的数据，保证 $1 \le n \le 10$；  
对于 $30\%$ 的数据，保证 $1 \le n \le 100$；  
对于 $60\%$ 的数据，保证 $1 \le n \le 10^3$；   
对于 $100\%$ 的数据，保证 $1 \le n \le 10^5$，$1 \leq x_i \leq 10^9$。



---

---
title: "序列终结者"
layout: "post"
diff: 省选/NOI-
pid: P4146
tag: ['模拟', '线段树', '平衡树']
---
# 序列终结者
## 题目背景

网上有许多题，就是给定一个序列，要你支持几种操作：A、B、C、D。一看另一道题，又是一个序列要支持几种操作：D、C、B、A。尤其是我们这里的某人，出模拟试题，居然还出了一道这样的，真是没技术含量……

这样我也出一道题，我出这一道的目的是为了让大家以后做这种题目有一个“库”可以依靠，没有什么其他的意思。

这道题目就叫序列终结者吧。

## 题目描述

给定一个长度为N的序列，每个序列的元素是一个整数（废话）。要支持以下三种操作：

1. 将$[L,R]$这个区间内的所有数加上$V$。
2. 将$[L,R]$这个区间翻转，比如`1 2 3 4`变成`4 3 2 1`。
3. 求$[L,R]$这个区间中的最大值。

最开始所有元素都是$0$。

## 输入格式

第一行两个整数`N，M`。`M`为操作个数。

以下$M$行，每行最多四个整数，依次为`K，L，R，V`。`K`表示是第几种操作，如果不是第1种操作则`K`后面只有两个数。

## 输出格式

对于每个第3种操作，给出正确的回答。


## 样例

### 样例输入 #1
```
4 4
1 1 3 2
1 2 4 -1
2 1 3
3 2 4
```
### 样例输出 #1
```
2
```
## 提示

$N \le 50000,M \le 100000$。



---

---
title: "[WC2006] 水管局长"
layout: "post"
diff: 省选/NOI-
pid: P4172
tag: ['图论', '2006', '平衡树', 'O2优化', '生成树', '最近公共祖先 LCA', '动态树 LCT', 'WC']
---
# [WC2006] 水管局长
## 题目背景

SC 省 MY 市有着庞大的地下水管网络，嘟嘟是 MY 市的水管局长（就是管水管的啦）。
## 题目描述

每天供水公司可能要将一定量的水从 $u$ 处送往 $v$ 处，嘟嘟需要为供水公司找到一条从 $u$ 至 $v$ 的水管的路径，接着通过信息化的控制中心通知路径上的水管进入准备送水状态，等到路径上每一条水管都准备好了，供水公司就可以开始送水了。嘟嘟一次只能处理一项送水任务，等到当前的送水任务完成了，才能处理下一项。

在处理每项送水任务之前，路径上的水管都要进行一系列的准备操作，如清洗、消毒等等。嘟嘟在控制中心一声令下，这些水管的准备操作同时开始，但由于各条管道的长度、内径不同，进行准备操作需要的时间可能不同。

供水公司总是希望嘟嘟能找到这样一条送水路径，路径上的所有管道全都准备就绪所需要的时间尽量短。嘟嘟希望你能帮助他完成这样的一个选择路径的系统，以满足供水公司的要求。另外，由于 MY 市的水管年代久远，一些水管会不时出现故障导致不能使用，你的程序必须考虑到这一点。

不妨将 MY 市的水管网络看作一幅简单无向图（即没有自环或重边）：水管是图中的边，水管的连接处为图中的结点。整张图共有 $n$ 个节点和 $m$ 条边，节点从 $1$ 至 $n$ 编号。

## 输入格式

第一行有三个整数，分别表示管道连接处（结点）的数目 $n$，目前水管（无向边）的数目 $m$，以及你的程序需要处理的任务数目（包括寻找一条满足要求的路径和接受某条水管坏掉的事实）$q$。

以下 $m$ 行，每行三个整数 $u, v, t$，表示存在一条连接 $(u, v)$ 的水管，准备时间为 $t$。

以下 $q$ 行，每行三个整数 $k, u, v$，描述一项任务。其中 $k$ 表示任务类型：

- 若 $k = 1$，则表示你需要为供水公司寻找一条满足要求的从 $u$ 到 $v$ 的水管路径，满足准备时间最短；
- 若 $k = 2$，则表示直接连接 $u$ 和 $v$ 的水管宣布报废。

## 输出格式

对于每个 $k = 1$ 的任务，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 4 3
1 2 2
2 3 3
3 4 2
1 4 2
1 1 4
2 1 4
1 1 4

```
### 样例输出 #1
```
2
3
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 10^3$，$1 \leq m, q \leq 10^5$。
- $1 \leq k \leq 2$，$1 \leq u, v \leq n$，$1 \leq t \leq 10^9$。
- 给出的图无重边无自环，保证在宣布一条水管报废之前，该水管一定存在于图上且没有报废，
- 宣布报废的水管不超过 $5 \times 10^3$ 条，且在任意时刻，图一定是联通的。





---

---
title: "[CTSC2008] 网络管理"
layout: "post"
diff: 省选/NOI-
pid: P4175
tag: ['2008', '线段树', '平衡树', '树状数组', '树链剖分', '可持久化线段树', 'CTSC/CTS']
---
# [CTSC2008] 网络管理
## 题目描述

M 公司是一个非常庞大的跨国公司，在许多国家都设有它的下属分支机构或部门。为了让分布在世界各地的 $n$ 个部门之间协同工作，公司搭建了一个连接整个公司的通信网络。  

该网络的结构由 $n$ 个路由器和 $n-1$ 条高速光缆组成。每个部门都有一个专属的路由器，部门局域网内的所有机器都联向这个路由器，然后再通过这个通信子网与其他部门进行通信联络。该网络结构保证网络中的任意两个路由器之间都存在一条直接或间接路径以进行通信。   

高速光缆的数据传输速度非常快，以至于利用光缆传输的延迟时间可以忽略。但是由于路由器老化，在这些路由器上进行数据交换会带来很大的延迟。而两个路由器之间的通信延迟时间则与这两个路由器通信路径上所有路由器中最大的交换延迟时间有关。  

作为 M 公司网络部门的一名实习员工，现在要求你编写一个简单的程序来监视公司的网络状况。该程序能够随时更新网络状况的变化信息（路由器数据交换延迟时间的变化），并且根据询问给出两个路由器通信路径上延迟第 $k$ 大的路由器的延迟时间。
****
【任务】   
你的程序从输入文件中读入 $n$ 个路由器和 $n-1$ 条光缆的连接信息，每个路由器初始的数据交换延迟时间 $t_i$，以及 $q$ 条询问（或状态改变）的信息。并依次处理这 $q$ 条询问信息，它们可能是：

1. 由于更新了设备，或者设备出现新的故障，使得某个路由器的数据交换延迟时间发生了变化。

2. 查询某两个路由器 $a$ 和 $v$ 之间的路径上延迟第 $k$ 大的路由器的延迟时间。

## 输入格式

第一行为两个整数 $n$ 和 $q$，分别表示路由器总数和询问的总数。

第二行有 $n$ 个整数，第 $i$ 个数表示编号为i的路由器初始的数据延迟时间 $t_i$。

紧接着 $n-1$ 行，每行包含两个整数 $x$ 和 $y$。表示有一条光缆连接路由器 $x$ 和路由器 $y$。

紧接着是 $q$ 行，每行三个整数 $k,a,b$。

如果 $k=0$，则表示路由器 $a$ 的状态发生了变化，它的数据交换延迟时间由 $t_a$ 变为 $b$。

如果 $k>0$，则表示询问 $a$ 到 $b$ 的路径上所经过的所有路由器（包括 $a$ 和 $b$）中延迟第 $k$ 大的路由器的延迟时间。注意 $a$ 可以等于 $b$，此时路径上只有一个路由器。

## 输出格式

对于每一个第二种询问（即 $k>0$ ），输出一行。  
包含一个整数为相应的延迟时间。如果路径上的路由器不足 $k$ 个，则输出信息 `invalid request!`。

## 样例

### 样例输入 #1
```
5 5
5 1 2 3 4
3 1
2 1
4 3
5 3
2 4 5
0 1 2
2 2 3
2 1 4
3 3 5
```
### 样例输出 #1
```
3
2
2
invalid request!
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,q \le 80000$，$0 \le k \le n$，任意一个路由器在任何时刻都满足延迟时间小于 $10^8$。




---

---
title: "千山鸟飞绝"
layout: "post"
diff: 省选/NOI-
pid: P4200
tag: ['平衡树']
---
# 千山鸟飞绝
## 题目描述

话说有一天 doyouloveme 和 vfleaking 到山里玩。谁知 doyouloveme 刚刚进山，所有的鸟儿竟被他的神犇气场给惊得全部飞走了。vfleaking 顿时膜拜不已。

这时鸟王用鸟语说道：「!@#\$%…?」，安抚了一下众鸟的情绪。鸟王生性好斗，作出了一个决定：要排鸟布阵把刚才吓到它们的人类赶出山去。

每只鸟都有一个编号，都有一个威武值。每秒钟鸟王都会发一个命令，编号为 $v$ 的鸟飞到 $(x,y)$ 去（坐标系原点是山顶，坐标单位为鸟爪）。鸟飞得很快，一秒之内就飞到了，可以看作是瞬间移动。如果编号为 $v$ 的鸟和编号为 $u$ 的鸟某一时刻处在同一位置，它们就会互相鼓励，增加各自的士气值和团结值。一只鸟的士气值等于此刻与它处在同一位置的鸟中的威武值的最大值，团结值等于此刻与它处在同一位置的鸟的只数。如果每一时刻都没有鸟与它处在同一位置，则士气值和团结值都为 $0$。要注意自己不能鼓励自己，计算士气值和团结值时不能算上自己。

$t$ 秒钟后，doyouloveme 目测出了现在每只鸟的战斗力，于是感叹了一句：「不妙，我们得走了。」

正所谓团结的鸟儿一个顶俩，所以 doyouloveme 这样描述战斗力：一只鸟战斗力值等于它在 $0$ 到 $t$ 秒中士气值的最大值与团结值的最大值的乘积。注意不是乘积的最大值，而是最大值的乘积。

vfleaking 很想知道现在每只鸟的战斗力，但是他当然不会啦，于是他把这个任务交给了你来完成。

## 输入格式

第一行一个整数 $n$，代表鸟的只数。（鸟王那家伙你可以完全忽视掉）

接下来 $n$ 行，每行三个整数 $w,x,y$ 描述每只鸟的威武值和初始坐标。第 $i+1$ 行描述编号为i的鸟。

接下来一行有一个整数 $t$，代表经过时间 $t$ 秒。

接下来 $t$ 行，每行三个整数 $v,x,y$ 描述鸟王每秒的命令。

## 输出格式

一共 $n$ 行，每行一个数，代表每只鸟的战斗力。
## 样例

### 样例输入 #1
```
5
1 1 1
3 1 2
4 4 4
2 0 1
2 2 3
5
1 1 2
2 4 4
2 4 3
3 0 1
5 0 1
```
### 样例输出 #1
```
3
4
6
8
8
```
### 样例输入 #2
```
5
1803632939 1051911108 963670239
296082233 384714041 782958792
1706221977 1051911108 963670239
1890039364 -1429456864 794782986
1152753107 1932597483 1442217530
10
3 -1429456864 794782986
2 -1429456864 794782986
4 -1429456864 794782986
4 2062723523 -411953943
5 -1429456864 794782986
4 1051911108 963670239
4 1051911108 963670239
1 1051911108 963670239
1 1051911108 963670239
5 -1429456864 794782986
```
### 样例输出 #2
```
1890039364
3780078728
3780078728
3607265878
3412443954
```
## 提示

对于 $100\%$ 的数据，$1≤n≤30000$，$0≤t≤300000$，坐标为整数，均在 $[-2^{31},2^{31})$ 内。

威武值为不超过 $2^{31}-1$ 的非负整数。


---

---
title: "[SCOI2015] 情报传递"
layout: "post"
diff: 省选/NOI-
pid: P4216
tag: ['2015', '四川', '线段树', '各省省选', '平衡树', '树链剖分', '可持久化线段树']
---
# [SCOI2015] 情报传递
## 题目描述

奈特公司是一个巨大的情报公司，它有着庞大的情报网络。情报网络中共有 $n$ 名情报员。每名情报员可能有若干名 (可能没有) 下线，除 $1$ 名大头目外其余 $n-1$ 名情报员有且仅有 $1$ 名上线。奈特公司纪律森严，每名情报员只能与自己的上、下线联系，同时，情报网络中任意两名情报员一定能够通过情报网络传递情报。

奈特公司每天会派发以下两种任务中的一个任务：

1. 搜集情报：指派 $T$ 号情报员搜集情报；
2. 传递情报：将一条情报从 $X$ 号情报员传递给 $Y$ 号情报员。

情报员最初处于潜伏阶段，他们是相对安全的，我们认为此时所有情报员的危险值为 $0$；一旦某个情报员开始搜集情报，他的危险值就会持续增加，每天增加 $1$ 点危险值 (开始搜集情报的当天危险值仍为 $0$，第 $2$ 天危险值为 $1$，第 $3$ 天危险值为 $2$，以此类推)。传递情报并不会使情报员的危险值增加。

为了保证传递情报的过程相对安全，每条情报都有一个风险控制值 $C$。奈特公司认为，参与传递这条情报的所有情报员中，危险值大于 $C$ 的情报员将对该条情报构成威胁。现在，奈特公司希望知道，对于每个传递情报任务，参与传递的情报员有多少个，其中对该条情报构成威胁的情报员有多少个。
## 输入格式

第一行包含一个正整数 $n$，表示情报员个数。
笫二行包含 $n$ 个非负整数，其中第 $i$ 个整数 $P_i$ 表示 $i$ 号情报员上线的编号。特别地，若 $P_i=0$，表示 $i$ 号情报员是大头目。
第三行包含一个正整数 $q$，表示奈特公司将派发 $q$ 个任务 (每天一个)。

随后 $q$ 行，依次描述 $q$ 个任务。每行首先有一个正整数 $k$。

- 若 $k=1$，表示任务是传递情报，随后有三个正整数 $X_i$、$Y_i$、$C_i$，依次表示传递情报的起点、终点和风险控制值。
- 若 $k=2$，表示任务是搜集情报，随后有 $1$ 个正整数 $T_i$，表示搜集情报的情报员编号。
## 输出格式

对于每个传递情报任务输出一行，包含两个整数，分别是参与传递情报的情报员个数和对该条情报构成威胁的情报员个数。
## 样例

### 样例输入 #1
```
7
0 1 1 2 2 3 3 
6
1 4 7 0
2 1
2 4
2 7
1 4 7 1
1 4 7 3
```
### 样例输出 #1
```
5 0
5 2
5 1
```
## 提示

样例解释：

对于 $3$ 个传递情报任务，都是经过 $5$ 名情报员，分别是 $4$ 号、$2$ 号、$1$ 号、$3$ 号和 $7$ 号。

- 第 $1$ 个任务，所有情报员 (危险值为 $0$) 都不对情报构成威胁；
- 第 $2$ 个任务，有 $2$ 名情报员对情报构成威胁，分别是 $1$ 号情报员 (危险值为 $3$) 和 $4$ 号情报员 (危险值为 $2$)，$7$ 号情报员 (危险值为 $1$) 并不构成威胁；
- 第 $3$ 个任务，只有 $1$ 名情报员对情报构成威胁。

数据范围：

$n\leqslant 2\times 10^5,Q\leqslant 2\times 10^5,0<P_i,C_i\leqslant N,1\leqslant T_i,X_i,Y_i\leqslant n$。


---

---
title: "[HAOI2008] 排名系统"
layout: "post"
diff: 省选/NOI-
pid: P4291
tag: ['模拟', '字符串', '2008', '河南', '各省省选', '平衡树']
---
# [HAOI2008] 排名系统
## 题目描述

排名系统通常要应付三种请求：上传一条新的得分记录、查询某个玩家的当前排名以及返回某个区段内的排名记录。当某个玩家上传自己最新的得分记录时，他原有的得分记录会被删除。为了减轻服务器负担，在返回某个区段内的排名记录时，最多返回10条记录。
## 输入格式

第一行是一个整数n（10<=n<=250000）表示请求总数目。接下来n行,每行包含了一个请求。请求的具体格式如下：

+Name Score 上传最新得分记录。Name表示玩家名字，由大写英文字母组成，不超过10个字符。Score为最多8位的正整数。

?Name 查询玩家排名。该玩家的得分记录必定已经在前面上传。如果两个玩家的得分相同，则先得到该得分的玩家排在前面。

?Index 返回自第Index名开始的最多10名玩家名字。Index必定合法，即不小于1，也不大于当前有记录的玩家总数。
## 输出格式

对于?Name格式的请求，应输出一个整数表示该玩家当前的排名。

对于?Index格式的请求，应在一行中依次输出从第Index名开始的最多10名玩家姓名，用一个空格分隔。
## 样例

### 样例输入 #1
```
20
+ADAM 1000000
+BOB 1000000
+TOM 2000000
+CATHY 10000000
?TOM
?1
+DAM 100000
+BOB 1200000
+ADAM 900000
+FRANK 12340000
+LEO 9000000
+KAINE 9000000
+GRACE 8000000
+WALT 9000000
+SANDY 8000000
+MICK 9000000
+JACK 7320000
?2
?5
?KAINE
```
### 样例输出 #1
```
2
CATHY TOM ADAM BOB
CATHY LEO KAINE WALT MICK GRACE SANDY JACK TOM BOB
WALT MICK GRACE SANDY JACK TOM BOB ADAM DAM
4
```
## 提示

20%数据满足N<=100

100%数据满足N<=250000


---

---
title: "[TJOI2013] 最长上升子序列"
layout: "post"
diff: 省选/NOI-
pid: P4309
tag: ['2013', '线段树', '各省省选', '平衡树', '树状数组', '天津']
---
# [TJOI2013] 最长上升子序列
## 题目描述

给定一个序列，初始为空。现在我们将 $1$ 到 $N$ 的数字插入到序列中，每次将一个数字插入到一个特定的位置。每插入一个数字，我们都想知道此时最长上升子序列长度是多少？
## 输入格式

第一行一个整数 $N$，表示我们要将 $1$ 到 $N$ 插入序列中。

接下是 $N$ 个数字，第 $k$ 个数字 $X_k$，表示我们将 $k$ 插入到位置 $X_k(0\le X_k\le k-1,1\le k\le N)$

## 输出格式

$N$ 行，第 $i$ 行表示 $i$ 插入 $X_i$ 位置后序列的最长上升子序列的长度是多少。
## 样例

### 样例输入 #1
```
3
0 0 2
```
### 样例输出 #1
```
1
1
2
```
## 提示

$100\%$ 的数据 $n\le10^5$。


---

---
title: "[AHOI2006] 文本编辑器"
layout: "post"
diff: 省选/NOI-
pid: P4567
tag: ['2006', '各省省选', '平衡树', '安徽']
---
# [AHOI2006] 文本编辑器
## 题目描述

这些日子，可可不和卡卡一起玩了，原来可可正废寝忘食的想做一个简单而高效的文本编辑器。你能帮助他吗？为了明确任务目标，可可对“文本编辑器”做了一个抽象的定义： 

- `Move k`：将光标移动到第 $k$ 个字符之后，如果 $k=0$，将光标移到文本第一个字符之前。
- `Insert n (换行) S`：在光标后插入长度为 $n$ 的字符串 $S$，光标位置不变，$n \ge 1$。
- `Delete n`：删除光标后的 $n$ 个字符，光标位置不变，$n \ge 1$。
- `Rotate n`：反转光标后的 $n$ 个字符，光标位置不变，$n \ge 1$。
- `Get`：输出光标后的一个字符，光标位置不变。
- `Prev`：光标前移一个字符。
- `Next`：光标后移一个字符。


下面是几个定义：

- 文本：由 $0$ 个或多个字符构成的序列。这些字符的 ASCII 码在闭区间 $[32, 126]$ 内，也就是说，这些字符均为可见字符或空格。
- 光标：在一段文本中用于指示位置的标记，可以位于文本的第一个字符之前，文本的最后一个字符之后或文本的某两个相邻字符之间。
- 文本编辑器：为一个可以对一段文本和该文本中的一个光标进行如下七条操作的程序。如果这段文本为空，我们就说这个文本编辑器是空的。 

编写一个程序：
1. 建立一个空的文本编辑器。
2. 从输入文件中读入一些操作指令并执行。
3. 对所有执行过的 `GET` 操作，将指定的内容写入输出文件。
## 输入格式

输入文件中第一行是指令条数 $N$，以下是需要执行的 $N$ 个操作。除了回车符之外，输入文件的所有字符的 ASCII 码都在闭区间 $[32, 126]$ 内。且行尾没有空格。
## 输出格式

依次对应输入文件中每条 `GET` 指令的输出，不得有任何多余的字符。
## 样例

### 样例输入 #1
```
10
Insert 13
Balanced eert
Move 2
Delete 5
Next
Insert 7
 editor
Move 0
Get
Move 11
Rotate 4
Get
```
### 样例输出 #1
```
B
t
```
## 提示

对输入数据我们有如下假定：
1. `MOVE` 操作不超过 $5\times 10^4$ 个，`INSERT`, `DELETE` 和 `ROTATE` 操作作的总个数不超过 $6\times 10^3$，`GET` 操作不超过 $2\times 10^4$ 个，`PREV` 和 `NEXT` 操作的总个数不超过 $2\times 10^4$。
2.  所有 `INSERT` 插入的字符数之和不超过 $2M$（$1M=2^{20}$)。
3. `DELETE` 操作、`ROTATE` 操作和 `GET` 操作执行时光标后必然有足够的字符。`MOVE`、`PREV`、`NEXT` 操作不会把光标移动到非法位置。
4. 输入文件没有错误。


---

---
title: "[BalticOI 2011] Growing Trees (Day1)"
layout: "post"
diff: 省选/NOI-
pid: P4666
tag: ['2011', '线段树', '平衡树', 'BalticOI（波罗的海）']
---
# [BalticOI 2011] Growing Trees (Day1)
## 题目描述

For fertilizing the trees he has several bottles of MegaBoostFertilizer, which, when treated on trees, causes them to grow one centimeter up instantly. Every bottle has a limited capacity $c_i$​​ , which determines the number of trees it can be applied to. Moreover, for each bottle there is a minimal height $h_i$ of trees, which can be treated with it. Since Egon wants to have all his trees as big as possible, he always applies the fertilizer to the $c_i$​​ smallest trees chosen from the trees that are at least $h_i$​​ centimeters high.

When Egon computes statistics about trees he has to determine the number of trees whose height is in some given interval. Egon is quite busy working in the garden, so he asked you to write a program, that given the list of his tasks, computes the statistics for him. 
## 输入格式

The first line of the standard input contains two integers $N$ and $M$ denoting the number of trees in Egon’s garden and the number of his tasks. The second line contains a sequence of $N$ integers fromthe range $[1,N]$ describing the initial heights of the trees in centimeters. The following $M$ lines describe the tasks in chronological order. Each of those lines begins with a character $t_i$ $(t_i=F \ or \ C)$, which describes the type of the task.

If $t_i=F$ then two integers $c_i$​​ and $h_i$ follow. Such a line means that Egon applies a bottle of MegaBoostFertilizer to the $c_i$ smallest trees among those trees that are at least $h_i$​​ centimeters high. When there are less than $c_i$​​ trees of sufficient height, he applies the fertilizer to all such trees and discards the bottle with some fertilizer remaining.

If $t_i=C$ then two integers $\min_i$​​ and $\max_i$​​ follow. They denote that Egon has to compute the number of trees whose height $H$ is between $\min_i$ and $\max_i$​​ centimeters $(\min_i \le H \le \max_i)$. 
## 输出格式

For every task of type C, output one line containing the number of apple trees that have the required height. The order of the results should conform to the order of type C tasks in the input.
## 样例

### 样例输入 #1
```
5 7
1 3 2 5 2
F 2 1
C 3 6
F 2 3
C 6 8
F 2 1
F 2 2
C 3 5
```
### 样例输出 #1
```
3
0
5
```
## 提示

$1 \le N,M \le 10^5,1 \le c \le N,0 \le h \le 10^9,1 \le min \le max \le 10^9$。
## 题目翻译

给出一个长度为 $N$ 的数组 $a$，数组中每个数的取值范围均为 $[1,N]$（没说互不相同）。
接下来有 $M$ 组操作，操作分为两种：
1. $\texttt{F}\:\:c\:\:h$  
将满足 $a[i] \ge h$ 的所有 $a[i]$ 中最小的 $c$ 个数都 $+1$；
2. $\texttt{C}\:\:max\:\:min$  
输出满足 $min \le a[i] \le max$ 的 $a[i]$ 的个数。

### 输入格式

第一行有两个整数 $N$ 和 $M$。    
第二行有 $N$ 个整数，表示数组 $a$。  
在接下来的 $M$ 行中，每行有一组操作。

### 输出格式

对于每组 $\texttt{C}\:\:max\:\:min$ 操作输出一行，每行一个整数，表示满足 $min \le a[i] \le max$ 的 $a[i]$ 的个数。


翻译提供者：Planet6174


---

---
title: "[Wind Festival] Energy Center"
layout: "post"
diff: 省选/NOI-
pid: P4743
tag: ['平衡树', '树状数组', 'O2优化', '枚举']
---
# [Wind Festival] Energy Center
## 题目背景

$[Noon - 12:13$ $P.M.]$

$Curtis$ $Nishikino$看到大家为晚会准备地如此认真，~~可爱的~~她也做起了志愿者！
## 题目描述

$Curtis$ $Nishikino$来到了风筝节的能源中心，大家正在为晚会做准备. 这里共有 $N$ 台设备. 当然，由于计划的调整，可能会随时发生增删设备的操作. 但设备的总数不会超过$10^4$. 随时记录设备的数量也是志愿者的工作之一.

每台设备都有一些属性，比如设备$i$, 对于她拥有的每个属性, 比如属性$j$, 都会有一个给定的值, 记为$value_{ij}$.但属性是共有的, 这意味着即便一台设备没有某个属性, 也只会使她这个属性的值为$0$. 属性的数量是$M$. 注意属性的编号是从$0$到$M-1$.

现在志愿者们正尝试将一部分相邻设备联系在一起，效果如下：

- 对于从$j$到$k$的设备, 最终效果$i$的值为 $\sum_{p=j}^{k}value_{pi}$.

志愿者需要$Curtis$帮忙，但做计算太麻烦了，$Curtis$ $Nishikino$也希望你能帮帮她.
## 输入格式

第一行两个整数 $n$ 和 $m$.

接下来 $n$ 行, 第一个整数 $k_i$,这意味着设备 $i$ 有 $k_i$ 个属性. 后面是 $2\times k$ 个整数, $x_j$ 和 $y_j$, 这意味着 $value_{ix_j}=y_j$.

下面是一个整数 $q$, 即 $q$ 个操作. 每项操作都是如下之一:

$I$ $x$ :在设备 $x$ 后插入一台设备, 下面有一行描述信息，像初始化一样.

$D$ $x$:丢弃第 $x$ 台设备.

$QA$ :询问设备总数.

$QS$ $l$ $r$: 询问连接设备 $l$ 到 $r$ 的效果.

输入数据保证合法.
## 输出格式

对于每个 $QA$, 输出一行一个整数.

对于每个 $QS$, 输出一行 $m$ 个整数, 如果属性 $i$ 的值是 $0$, 在那个位置输出 $0$ 即可.

###### 注意！

请在完成所有操作后输出一行额外的 "end" (不包含双引号).
## 样例

### 样例输入 #1
```
4 4
4 0 1 1 2 2 2 3 1
2 0 1 2 1
0
2 1 2 3 1
5
QA
I 2 
2 1 1 3 2
QS 2 4
QA
QS 1 1
```
### 样例输出 #1
```
4
1 1 1 2
5
1 2 2 1
end
```
## 提示

对于 $15\%$ 的数据, $0 < N \le 10^3\ , \ 0<M \le 10\ , \ 0 < q \le 10^3$.

对于额外的 $5\%$ 数据, $0<N \le 10^4\ , \ 0<M \le 200\ , \ 0 < q \le 10^4$, 保证没有 $QS$ 操作.

对于 $100\%$ 的数据, $0<N \le 10^4\ ,\ 0<M \le 200\ , \ 0<q\le10^4$.


---

---
title: "银河英雄传说V2"
layout: "post"
diff: 省选/NOI-
pid: P4847
tag: ['平衡树', '动态树 LCT']
---
# 银河英雄传说V2
## 题目背景

小H昨天看到了luogu P1196这一题，触发了他内心中对英雄的感慨/雾。可是无奈他不会这一题，只好去请教小W。在讲完那一题之后，小W灵机一动——不如改一下这道题吧。

于是，一个很水的签到题出现了。
## 题目描述

某dalao：把题目说简单一点，方便让我一分钟A掉！

于是小W只好把题意简化一下：

给定n个长度为1的序列，第i个序列中有一个元素，值为ai，接下来有三种操作：

1. `M x y`，表示把x所在的序列放到y所在的序列之后。如果x,y已经在同一个序列，则不进行操作。
2. `D x`，表示把x所在的序列中从x处断开，也就是把x及x之后的元素单独取出来作为一个序列。
3. `Q x y`，表示查询x到y之间（包括x和y）所有元素的值之和。如果x和y不在同一个序列之中，输出-1.
## 输入格式

第一行为两个数n,m，分别代表元素个数和操作次数。第二行有n个数，为ai。
接下来m行，每行包括三种情况：M x y，D x或Q x y，与题目描述对应。
## 输出格式

对于每一个Q x y，输出一个数，表示所有元素的值之和。
## 样例

### 样例输入 #1
```
5 10
57770 55352 18768 21847 79100 
M 1 4
M 3 2
Q 5 2
M 3 4
M 3 5
M 4 4
M 3 1
D 1
Q 2 2
Q 2 1

```
### 样例输出 #1
```
-1
55352
113122

```
### 样例输入 #2
```
30 100
2193 75245 24438 95450 96514 84854 15292 9488 37488 940 52991 15190 64052 17398 80379 77861 88717 34751 16783 88345 27612 21748 79776 43058 35590 49064 45012 37206 70870 30643 
M 18 26
M 28 27
M 25 4
M 12 22
M 26 15
M 3 1
M 20 20
M 7 21
M 18 29
M 21 26
M 29 10
M 27 23
M 30 28
M 22 10
M 13 21
M 1 23
M 25 9
M 29 27
M 23 25
M 11 12
M 1 4
M 26 14
M 26 9
D 4
M 16 8
M 16 20
M 4 27
M 9 20
M 11 1
M 19 8
Q 12 7
M 5 10
D 20
Q 29 2
Q 9 15
M 29 21
D 5
M 23 8
M 6 6
D 23
D 6
Q 4 8
D 21
Q 29 23
Q 19 4
M 21 21
M 20 25
M 27 29
D 2
Q 7 2
M 7 15
Q 11 18
D 26
Q 21 18
M 22 11
M 12 12
M 20 15
M 22 4
D 20
M 4 5
M 12 2
Q 27 20
M 30 2
M 28 9
M 20 11
M 10 21
M 12 24
Q 14 14
M 6 29
Q 13 18
Q 10 3
Q 23 3
D 4
M 27 13
M 6 23
M 7 14
Q 12 17
M 18 25
Q 2 19
D 3
D 9
Q 2 16
Q 3 8
Q 4 10
D 24
M 21 4
Q 17 15
Q 19 7
Q 1 24
Q 9 18
D 12
M 4 16
M 27 21
D 26
M 5 14
M 15 19
M 21 26
M 18 27
Q 21 8
Q 18 13

```
### 样例输出 #2
```
52230
-1
-1
254468
291078
112233
-1
231636
62363
-1
17398
178645
25378
219268
-1
419122
347453
-1
-1
-1
274542
-1
269126
-1
178645

```
## 提示

（出题人非常良心地给了一个大一点的样例！）

样例1解释：

首先有5个序列（一个横排为一个序列），排列如下：
```
1
2
3
4
5
```

第一个操作将1放到4的后面，变成
```
2
3
4,1
5
```

第二个操作将3放到2后面，变成
```
2,3
4,1
5
````

然后查询第5个元素到第2个元素之间的和，由于不存在，输出-1；

将3所在的序列加到4所在的序列后面，变成
```
4,1,2,3
5
```

接下来变成了5,4,1,2,3，也就是所有元素都在1个序列了，因此接下来的两个合
并操作没有用了，然后把1之后的数字删除，变成：

```
1,2,3
5,4
```

查询2到2，输出2的值，也就是55352；

查询2到1，输出2+1的值，也就是113122.


![Luogu](https://cdn.luogu.com.cn/upload/pic/30577.png)

~~为了避免某些乱搞（可能避免不了）~~，**前5个点按照传统方式计分，每个测试点10分；后五个点为subtask，必须全部通过才能得分，否则不得分。**

对于所有数据，1<=x,y<=n，1<=ai<=10^9


---

---
title: "mzf的考验"
layout: "post"
diff: 省选/NOI-
pid: P4883
tag: ['平衡树', '进制']
---
# mzf的考验
## 题目背景

$mzf$立志要成为一个豪杰，当然，他也是一个$OIer$。
他希望自己除了会$OI$之外还会各种东西，比如心理学、吉他、把妹等等。
为了让自己有更大的魅力，他不驼背，不熬夜，整天锻炼，双目炯炯有神，是我们机房最不像$OIer$的人。
然而，在与我们格格不入若干天并且将《易经》研究透彻之后，承受不住我们对他另类的言论，他爆发了。
机房在那一刹那仿佛天塌地陷，世界末日。
## 题目描述

八卦有乾、坤、震、巽、坎、离、艮、兑；
两两组合，一上一下，形成了六十四卦，每卦六爻，一共三百八十四爻。
爻分阴阳，阳爻性属阳刚，阴爻性属阴柔。天下之大，无奇不有。千奇百怪，皆出此处。
$mzf$研究透彻了易经之后，画出了$n$个奇怪的图案。他说那是他改进出来的更强大的卜卦体系。
每一个图案有二十行，每一行要么是阴爻$(0)$，要么是阳爻$(1)$，作为一个$OIer$，我们可以将卦象看成一个个二进制串；
他将$n$个图案画在了符纸上，然后进行$m$次操作：

操作1：翻转区间$[l,r]$的图案，比如$(3,1,2,5)$变成$(5,2,1,3)$；

操作2：$mzf$画地为卦，将$[l,r]$之间的卦象都异或上新画的那个卦象；

操作3：$mzf$会询问机房里的其他人$[l,r]$之间卦象代表的二进制数权值和。

如果不能正确回答每个操作$3$，那么机房风水格局将会改变，我们都将...！

由于$mzf$疯狂之下将我们都捆♂绑♂了起来，所以只能求求你来帮我们解决这个问题。
## 输入格式

第一行两个正整数：$n$，$m$（$n$为序列长度，$m$为操作个数）

第二行$n$个正整数：$a[i]$ (用$10$进制数表示每个卦象)$(1<=i<=n)$

接下来$m$行：每行首先一个正整数$opt$表示操作类型

1. $opt=1$：两个正整数：$l,r$。请翻转区间 $[l,r]$；
2. $opt=2$：三个正整数：$l,r,d$。请将区间$[l,r]$中的所有卦象都异或卦象$d$。（$0\le d\lt 2^{20}$）
3. $opt=3$：两个正整数：$l,r$。请查询区间 $[l,r]$ 的卦象权值和。
## 输出格式

对于每个 $opt=3$ 的情况，输出一行答案。
## 样例

### 样例输入 #1
```
8 9
4 6 2 1 7 9 10 2
1 1 4
3 1 6
2 4 5 2
3 1 6
2 1 5 8
3 1 6
2 5 7 10
3 4 7
3 1 8

```
### 样例输出 #1
```
29
29
69
24
59
```
## 提示

对于 $20\%$ 的数据，$n\le1000$，$m\le 1000$。

对于另外 $20\%$ 的数据，不存在操作 $1$。

对于另外 $20\%$ 的数据，保证 $n$ 为 $2$ 的次幂，且在操作 $1$ 中，保证 $l=i\times(2^j)+1$，$r=(i+1)\times(2^j)$，其中 $i,j$ 为任意值。

对于 $100\%$ 的数据，$n\le 10^5$，$m\le 5\times 10^4$，$1\le l\le r\le n$，$0\le d<2^{20}$。


---

---
title: "【模板】可持久化文艺平衡树"
layout: "post"
diff: 省选/NOI-
pid: P5055
tag: ['平衡树', '可持久化']
---
# 【模板】可持久化文艺平衡树
## 题目背景

这是一道模板题。
## 题目描述

您需要写一种数据结构，来维护一个序列，其中需要提供以下操作（**对于各个以往的历史版本**）：

1. 在第 $p$ 个数后插入数 $x$。
2. 删除第 $p$ 个数。
3. 翻转区间 $[l,r]$，例如原序列是 $\{5,4,3,2,1\}$，翻转区间 $[2,4]$ 后，结果是 $\{5,2,3,4,1\}$。
4. 查询区间 $[l,r]$ 中所有数的和。

**和原本平衡树不同的一点是，每一次的任何操作都是基于某一个历史版本，同时生成一个新的版本（操作 $4$ 即保持原版本无变化），新版本即编号为此次操作的序号。**

**本题强制在线。**
## 输入格式

第一行包含一个整数 $n$，表示操作的总数。

接下来 $n$ 行，每行前两个整数 $v_i, \mathrm{opt}_i$，$v_i$ 表示基于的过去版本号（$0 \le v_i < i$），$\mathrm{opt}_i$ 表示操作的序号（$1 \le \mathrm{opt}_i \le 4$）。

若 $\mathrm{opt}_i=1$，则接下来两个整数 $p_i, x_i$，表示操作为在第 $p_i$ 个数后插入数 $x$ 。  
若 $\mathrm{opt}_i=2$，则接下来一个整数 $p_i$，表示操作为删除第 $p_i$ 个数。  
若 $\mathrm{opt}_i=3$，则接下来两个整数 $l_i, r_i$，表示操作为翻转区间 $[l_i, r_i]$。  
若 $\mathrm{opt}_i=4$，则接下来两个整数 $l_i, r_i$，表示操作为查询区间 $[l_i, r_i]$ 的和。

**强制在线规则：**  
**令当前操作之前的最后一次 $4$ 操作的答案为 $lastans$（如果之前没有 $4$ 操作，则 $lastans=0$）。**  
**则此次操作的 $p_i,x_i$ 或 $l_i,r_i$ 均按位异或上 $lastans$ 即可得到真实的 $p_i,x_i$ 或 $l_i,r_i$。**
## 输出格式

对于每个序号为 $4$ 的查询操作，输出一行一个数表示区间的和。
## 样例

### 样例输入 #1
```
10
0 1 0 1
1 1 1 2
2 4 1 2
3 1 2 0
4 4 2 1
5 3 5 7
6 4 5 6
4 1 7 1
8 3 4 6
9 4 4 1
```
### 样例输出 #1
```
3
4
5
10
```
## 提示

**强制在线：以下针对 $p_i, x_i, l_i, r_i$ 的限制均是按位异或 $lastans$ 后的限制。**

- 对于 $6$ 个测试点，$n \le 5000$。
- 对于另外 $6$ 个测试点，$v_i = i - 1$。
- 欢迎用户加强数据，可联系管理员或出题人。

对于 $100\%$ 的数据，$1 \le n \le 2 \times {10}^5$，$|x_i| < {10}^6$。

假设基于的历史版本的序列长度为 $len \ge 1$，有：  
若 $\mathrm{opt}_i=1$，则 $0 \le p_i \le len$。  
若 $\mathrm{opt}_i=2$，则 $1 \le p_i \le len$。  
若 $\mathrm{opt}_i=3$，则 $1 \le l_i \le r_i \le len$。  
若 $\mathrm{opt}_i=4$，则 $1 \le l_i \le r_i \le len$。

假设基于的历史版本的序列长度为 $0$，有：  
$\mathrm{opt}_i=1$，$p_i=0$。


---

---
title: "SubString"
layout: "post"
diff: 省选/NOI-
pid: P5212
tag: ['平衡树', '后缀自动机 SAM', 'O2优化', '动态树 LCT']
---
# SubString
## 题目描述

给定一个字符串 `init`，要求支持两个操作：

- 在当前字符串的后面插入一个字符串。

- 询问字符串 $s$ 在当前字符串中出现了几次。(作为连续子串)

强制在线。
## 输入格式

第一行一个整数 $Q$ 表示操作个数。

第二行一个字符串表示初始字符串 `init`。

接下来 $Q$ 行，每行 $2$ 个字符串 `Type`,`Str`。

- `Type` 是 `ADD`，表示在后面插入字符串。

- `Type` 是 `QUERY`，表示询问某字符串在当前字符串中出现了几次。

为了体现在线操作，你需要维护一个变量 `mask`，初始值为 $0$。

```cpp
String decodeWithMask(String s, int mask) {
	char[] chars = s.toCharArray();
	for (int j = 0; j < chars.length; j++) {
		mask = (mask * 131 + j) % chars.length;
		
		char t = chars[j];
		chars[j] = chars[mask];
		chars[mask] = t;
	}
	
	return new String(chars);
}
```

读入串 `Str` 之后，使用这个过程将之解码成真正询问的串 `TrueStr`。

询问的时候，对 `TrueStr` 询问后输出一行答案 `Result`。

然后 $mask=mask \bigoplus Result$。

插入的时候，将`TrueStr`插到当前字符串后面即可。

**注意：`ADD` 和 `QUERY` 操作的字符串都需要解压。**


## 输出格式

对于每一个 `QUERY` 操作，输出询问的字符串在当前字符串中出现了几次。
## 样例

### 样例输入 #1
```
2
A
QUERY B
ADD BBABBBBAAB
```
### 样例输出 #1
```
0
```
## 提示

$|\mathrm{init}| \leq 6 \times 10^5$，$Q \leq 6\times 10^5$，询问总长度 $\leq 3 \times 10^6$。

保证字符串中只会出现 `A` 和 `B`。

为防止评测过慢，对于测试点 $2,3,5,6,8,11$ 时限为 3s，其余为 1s。

原题：BZOJ 2555


---

---
title: "贫穷"
layout: "post"
diff: 省选/NOI-
pid: P5217
tag: ['平衡树', '状压 DP']
---
# 贫穷
## 题目背景

LHF 最大的特点就是贫穷。  
LHF 最大的爱好就是看购物节目。

这天他又在看购物节目了。  
他在节目里看到一款新型文本编辑器，~~除了价钱以外~~非常适合他这样的穷人使用。

因为……它能够计算打印成本！  
（这里的打印成本是与出现过的字母的种类数相关的）

他十分心动，要求你实现这个功能。
## 题目描述

这个文本编辑器支持以下操作：
 - $\texttt{I x c}$，在第 $x$ 个字母后面插入一个 $c$。
 - $\texttt{D x}$，删除第 $x$ 个字母。
 - $\texttt{R x y}$，反转当前文本中的区间 $[x,y]$。
 - $\texttt{P x}$，输出初始文本中第 $x$ 个字母在当前文本中的位置。特别地，若不存在，输出 $0$。
 - $\texttt{T x}$，输出当前文本中第 $x$ 个字母。
 - $\texttt{Q x y}$，输出当前文本中区间 $[x,y]$ 内出现过的字母的种类数。
## 输入格式

第一行，两个整数 $n,m$，分别表示初始文本长度和操作个数。  
第二行，一个长度为 $n$ 的字符串，表示初始文本。  
以下 $m$ 行，每行表示一个操作。
## 输出格式

对于所有需要输出的操作，输出结果。
## 样例

### 样例输入 #1
```
12 6
kimiwakawaii
R 2 4
P 4
D 1
I 0 w
T 3
Q 3 10
```
### 样例输出 #1
```
2
m
5

```
## 提示

**数据范围：**

对于 $20\%$ 的数据，$n \le 100$。  
对于 $50\%$ 的数据，$n \le 10000$。  
对于 $100\%$ 的数据，$1 \le n,m \le 10^5$，文本涉及的字母仅包含小写字母。

**样例解释：**

 1. 文本不变，但初始文本中第 $2$ 个字母与第 $4$ 个字母的位置交换。
 2. 当前第 $2$ 个字母是初始文本的第 $4$ 个字母。
 3. 文本变为 $\texttt{imiwakawaii}$。
 4. 文本变为 $\texttt{wimiwakawaii}$。
 5. 这个字母为 $\texttt{m}$。 
 6. 这段文本为 $\texttt{miwakawa}$，包含的字符种类的集合为 $\{\texttt{a},\texttt{i},\texttt{k},\texttt{m},\texttt{w}\}$，元素个数为 $5$。


---

---
title: "[THUPC 2019] 不等式"
layout: "post"
diff: 省选/NOI-
pid: P5381
tag: ['2019', '平衡树', 'Special Judge', 'THUPC']
---
# [THUPC 2019] 不等式
## 题目描述

> 时光回到 2017 年 6 月 7 日。午后，阳光正好。
>
> 现在的你，在考场中笔耕不辍。在刷刷声中，你填写着交给从前和未来的自己的答卷。
> 
> 像无数次训练过的那样，你直接跳到了这张数学试卷的最后一道大题，二选一的题目直接选择了后者。快速地掠过了题目描述，紧缩的眉头渐渐放松。
> 
> 「稳了。」
>
> 你一刻也不敢停留，又向你的梦想靠近了一小步。

已知两个 $n$ 维实向量 $\vec{a}=(a_1,a_2,\dots,a_n),\vec{b}=(b_1,b_2,\dots,b_n)$，定义 $n$ 个定义域为 $\mathbb{R}$ 函数 $f_1,f_2,\dots,f_n$：

$$f_k(x)=\sum_{i=1}^{k} \lvert a_ix+b_i\rvert \quad (k=1,2,\dots,n)$$

现在，对于每个 $k=1,2,\dots,n$，试求 $f_k$ 在 $\mathbb{R}$ 上的最小值。可以证明最小值一定存在。
## 输入格式

第一行一个整数 $n$，表示向量的长度及函数的个数。

接下来两行，每行 $n$ 个整数，分别描述向量 $\vec{a},\vec{b}$ 的各个分量，以空格隔开。

对于所有的输入数据，都满足 $1\le n\le 5\times 10^5,\lvert a_i\rvert ,\lvert b_i\rvert <10^5$。
## 输出格式

输出 $n$ 行，第 $i$（$i=1,2,\dots,n$） 行为一个实数，表示 $f_i$ 在 $\mathbb{R}$ 上的最小值。

输出与标准答案的绝对误差或相对误差小于 $10^{-6}$ 就会被算作正确。
## 样例

### 样例输入 #1
```
2
1 1
1 2
```
### 样例输出 #1
```
0.00000
1.00000
```
## 提示

### 样例解释

$f_1(x)=\lvert x+1\rvert$，显然在 $x=-1$ 处取到最小值 $0$；

$f_2(x)=\lvert x+1\rvert +\lvert x+2\rvert$，可以证明其在 $[-2,-1]$ 中任意位置取到最小值 $1$。

##### 后记

后来，全国三卷的考生们又回想起了被参数方程支配的恐惧。

##### 版权信息

来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2019。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2019> 查看。


---

---
title: "【模板】线段树分裂"
layout: "post"
diff: 省选/NOI-
pid: P5494
tag: ['线段树', '平衡树']
---
# 【模板】线段树分裂
## 题目描述

给出一个可重集 $a$（编号为 $1$），它支持以下操作：

`0 p x y`：将可重集 $p$ 中大于等于 $x$ 且小于等于 $y$ 的值移动到一个新的可重集中（新可重集编号为从 $2$ 开始的正整数，是上一次产生的新可重集的编号+1）。

`1 p t`：将可重集 $t$ 中的数放入可重集 $p$，且清空可重集 $t$（数据保证在此后的操作中不会出现可重集 $t$）。

`2 p x q`：在 $p$ 这个可重集中加入 $x$ 个数字 $q$。

`3 p x y`：查询可重集 $p$ 中大于等于 $x$ 且小于等于 $y$ 的值的个数。

`4 p k`：查询在 $p$ 这个可重集中第 $k$ 小的数，不存在时输出 `-1`。
## 输入格式

第一行两个整数 $n,m$，表示可重集中的数在 $1\sim n$ 的范围内，有 $m$ 个操作。

接下来一行 $n$ 个整数，表示 $1 \sim n$ 这些数在 $a$ 中出现的次数 $(a_{i} \leq m)$。

接下来的 $m$ 行每行若干个整数，第一个数为操作的编号 $opt$（$0 \leq opt \leq 4$），以**题目描述**为准。
## 输出格式

依次输出每个查询操作的答案。
## 样例

### 样例输入 #1
```
5 12
0 0 0 0 0
2 1 1 1
2 1 1 2
2 1 1 3
3 1 1 3
4 1 2
2 1 1 4
2 1 1 5
0 1 2 4
2 2 1 4
3 2 2 4
1 1 2
4 1 3
```
### 样例输出 #1
```
3
2
4
3

```
## 提示

对于 $30\%$ 的数据，$1\leq n \leq {10}^3$，$1 \le m \le {10}^3$；  
对于 $100\%$ 的数据，$1 \le n \le 2 \times {10}^5$，$1 \le x, y, q \le m \le 2 \times {10}^5$。保证数据合法。

不开 `long long` 见祖宗！！

---

题面 by @[Limit](https://www.luogu.com.cn/user/86625)

std by @[Limit](https://www.luogu.com.cn/user/86625)（线段树分裂）

验题 by @[Froggy](https://www.luogu.com.cn/user/100285)（平衡树，不过合并的复杂度假掉了，倒数第二个测试点就是 hack 数据）

数据 by @[Froggy](https://www.luogu.com.cn/user/100285)


---

---
title: "[P5350] 序列 (加强版)"
layout: "post"
diff: 省选/NOI-
pid: P5586
tag: ['平衡树', '洛谷原创', 'O2优化', '可持久化']
---
# [P5350] 序列 (加强版)
## 题目背景

本题为 [P5350](https://www.luogu.org/problem/P5350) 的加强版。  
本题很良心，不卡空间！  

## 题目描述

有一个序列 $a_n$ 和 $q$ 次操作。

- `1 l r` 求区间 $[l,r]$ 的和  
- `2 l r k` 区间 $[l,r]$ 赋值为 $k$  
- `3 l r k` 区间 $[l,r]$ 加上 $k$  
- `4 l1 r1 l1 r2` 将区间 $[l_1,r_1]$ 复制到 $[l_2,r_2]$ 处  
- `5 l1 r1 l2 r2` 将区间 $[l_1,r_1]$ 与 $[l_2,r_2]$ 交换  
- `6 l r` 翻转区间 $[l,r]$

最后还要输出整个序列，所有输出都要对 $10^9+7$ 取模。

为了卡掉某些乱搞做法，**本题强制在线**。  

每次操作中，除了输入第一个数，其它所有数都需要异或 $\text{last}$ 才是实际的操作。  
$\text{last}$ 为上一次 $1$ 操作的答案 $\pmod{10^9 +7}$，定义初始 $\text{last} = 0$。  

## 输入格式

第一行两个正整数 $n,q$，表示序列长度与操作个数。  
第二行 $n$ 个正整数，表示序列 $a$  
接下来 $q$ 行，每行表示一次操作。
## 输出格式

对于每次操作，输出一行一个整数表示答案。  
最后一行输出 $n$ 个整数，表示最终的序列 $a$。
## 样例

### 样例输入 #1
```
10 10
7 1 3 2 2 4 0 1 2 2 
4 10 10 3 3
3 4 10 5
6 6 7
6 9 10
1 10 10
5 14 13 1 0
2 15 13 7
5 3 3 2 2
5 5 3 15 13
3 4 14 7
```
### 样例输出 #1
```
7
7 0 0 0 7 7 7 1 2 7
```
## 提示

【数据范围】   
$1\le n,q \le 3\times 10^5$  
$0\le a_i,k \le 10^9$   
对于 $4,5$ 操作，保证 $r_1-l_1 = r_2-l_2$ 且 $[l_1,r_1] \cap [l_2,r_2] = \varnothing$

**不保证数据随机** 且 **没有梯度**   
想交 ODT 的就算了吧！


---

---
title: "ygg发神威"
layout: "post"
diff: 省选/NOI-
pid: P5647
tag: ['树形数据结构', '线段树', '二分', '平衡树', 'O2优化', '枚举', '排序']
---
# ygg发神威
## 题目背景

ygg 发神威了，机房的萌新们瑟瑟发抖。
## 题目描述

ygg 的机房内共有 $n$ 台电脑且都被使用，为了节省机房内电脑的开销，第 $i$ 台电脑会同时被 $a_i$ 个萌新使用。每台电脑都装有一个「多人在线交流平台」，一台电脑会直接地或间接地通过这个平台与其他所有电脑连接。由于「多人在线交流平台」仍然处于测试阶段，如果一台电脑有多于一种不同的消息传输方式将消息传输到另外的任意一台电脑，就会有各种稀奇古怪的问题产生。两种消息的传输方式被认为是不同的，当且仅当传输消息所经过的直接连接的线路的集合不同，或者传输所经过的电脑的集合不同。当然，消息的传输肯定不会经过一条线路多次。为了避免这种状况，「多人在线交流平台」的线路被特殊地设计了，以使得任意两台电脑之间的传输线路唯一。同时，为了防止一台电脑负荷过大，一台电脑最多会通过「多人在线交流平台」的线路与 $p$ 台电脑相连。

原本两台通过「多人在线交流平台」的线路相连的电脑之间可以相互传输数据，可是 ygg 发现，这会允许使用两台电脑的萌新们互相发送消息，引起大规模~~考试作弊~~膜拜 ygg 的行为。所以他大发神威，切断了所有连接线路的一半。具体地，他将原本通过「多人在线交流平台」的双向线路连接的两台电脑之间的线路变成了单向线路。即，原本通过一条双向线路连接的两台电脑中，只能有一台电脑向另一台电脑发送消息，而另一台电脑不能将任何消息发送回来。

机房内的萌新们在每个时刻都有若干条消息需要传递。如果一台电脑 $i$ 能够直接或间接地通过「多人在线交流平台」的线路连接到电脑 $j$，那么使用电脑 $i$ 的 $a_i$ 个萌新中的任何一个都可以向使用电脑 $j$ 的 $a_j$ 个萌新发送消息。显然，使用同一台电脑的萌新之间的消息只需要在线下传达，不需要使用「多人在线交流平台」，因此不会计入线上发送的消息。

其实机房中的萌新们早已知道了「多人在线交流平台」的管理员密码，所以能够对其线路的连接方向做出修改。可无论他们怎么尝试，都不能恢复最开始时双向连接的状态了。机房中的萌新们当然希望能够尽可能地发送消息，所以他们想要知道，在机房的电脑仅被单向的线路连接时，每一时刻最多能有多少条消息被通过「多人在线交流平台」发送。

为了简化问题，我们假设机房内的所有萌新均能够在同一时刻发送线上消息，并且每一个萌新可以同时向多个人发送消息。

**简要题面：给一棵结点编号** $1\sim n$**，结点权值** $a_i$**，且结点度数最大为** $p$ **的树。求将树的每条边改为有向边后下式的最大值：**

$$\sum_{i=1}^{n}\sum_{j=1}^{n}a_ia_j\left[i\rightarrow j\right]$$

$\left[i\rightarrow j\right]$ **定义为：若编号为** $i$ **的结点能通过有向边到达编号为** $j$ **的结点，则值为** $1$**；否则值为** $0$**，且** $\left[i\rightarrow i\right]=0$**。**
## 输入格式

输入共 $(n+1)$ 行。

第一行两个正整数 $n$ 和 $p$，分别代表机房内的电脑数与所有电脑的负荷的最大值。  
第二行共 $n$ 个正整数，第 $i$ 个整数 $a_i$ 为使用第 $i$ 台电脑的萌新的数量。  
接下来 $(n-1)$ 行，第 $(i+2)$ 行两个整数 $u_i,v_i$ ，表示第 $u_i$ 和 $v_i$ 台电脑之间原本有一条「多人在线交流平台」的双向线路。
## 输出格式

输出一行一个整数，表示在某一时刻能够发送的消息数的最大值。
## 样例

### 样例输入 #1
```
4 2
1 2 3 4
1 2
3 2
4 1

```
### 样例输出 #1
```
35

```
## 提示

### 样例解释

能够发送的消息最多时的消息传递方向如下：

![](https://i.loli.net/2019/10/30/3AsqcyzdY25E8gP.png)

在该连接方式下发送消息最多的时刻，使用 $1$ 号电脑的 $1$ 个萌新向 $5$ 个萌新各发送了一条消息，共 $1\times5=5$ 条消息；  
使用 $2$ 号电脑的 $2$ 个萌新分别向 $3$ 个萌新各发送了一条消息，共 $2\times3=6$ 条消息；  
使用 $3$ 号电脑的 $3$ 个萌新不能向任何萌新发送线上消息，因此没有消息从该电脑发送；  
使用 $4$ 号电脑的 $4$ 个萌新分别向 $6$ 个萌新各发送了一条消息，共 $4\times6=24$ 条消息。  
因此，在某一时刻，最多可以有 $5+6+24=35$ 条线上消息被发送。   
可以使用枚举法验证，不存在一种单向的连接方式，使得在某一时刻发送的线上消息的数量能够达到 $36$ 条或更多。

### 数据范围及约定

对于 $10\%$ 的数据，$n\le10$；  
对于另外 $10\%$ 的数据，$n=p+1$；  
对于另外 $10\%$ 的数据，$p=2$；  
对于另外 $10\%$ 的数据，$p\le20$；  
对于另外 $10\%$ 的数据，$p\le40$；  

对于所有数据，$2\le n\le10^5$，$2\le p\le50$，$1\le a_i\le100$，$1\le u_i,v_i\le n$。保证给出的双向连接线路能够使任意两台电脑之间的消息传输线路唯一。保证至少有一台电脑原本通过「多人在线交流平台」连接的线路数恰好为 $p$，且没有电脑原本连接的线路数大于 $p$。


---

---
title: "『JROI-1』 关系树"
layout: "post"
diff: 省选/NOI-
pid: P6589
tag: ['2020', '二分', '点分治', '平衡树', 'O2优化']
---
# 『JROI-1』 关系树
## 题目背景

小 L 有许多喜欢的游戏角色，他把这些游戏角色按照一定的关系联系起来。这些游戏角色和他们之间的关系构成了一棵树，小 L 把这棵树称之为「关系树」。
## 题目描述

关系树是由 $n$ 个点和 $n-1$ 条无向边组成的一棵树。

对于一张给定的图 $G$，定义图 $G$ 对于点集 $E$ 的 **顶点导出子图** 为点集 $E$ 和所有的 **两个端点都属于 $E$** 且属于原图 $G$ 的边组成的图。

定义一张图是 **整洁的**，当且仅当图中任意两点 $u,v$，$u$ 和 $v$ **不连通** 或 **距离不超过** $k$。

小 L 想要知道对于一组 $l,r(l \leq r)$，有多少对 $(a,b)$，满足 $l\leq a\leq b\leq r$，且所有序号在 $a$ 和 $b$ 之间（包括 $a,b$）的点组成的顶点导出子图是 **整洁的**。不仅如此，他还想问你所有的区间长度（即 $b-a+1$）之和。

因为小 L 喜欢问问题，所以你一共需要回答 $q$ 组询问。
## 输入格式

第一行有三个整数 $n$，$q$，$k$，意义如上。

接下来 $n-1$ 行，每行两个整数 $u$，$v$，描述一条边。

接下来 $q$ 行，每行两个整数 $l$，$r$，表示一组询问。
## 输出格式

$q$ 行，每行两个整数，依次为满足的 $(a,b)$ 组数和所有的区间长度之和。
## 样例

### 样例输入 #1
```
5 3 2
1 2
1 5
4 5
3 5
1 3
2 5
1 5
```
### 样例输出 #1
```
6 10
10 20
14 30
```
## 提示

#### 样例 1 解释

形成的关系树如图

![](https://cdn.luogu.com.cn/upload/image_hosting/zb12y5mq.png)

满足的 $(a,b)$ 有 $(1,1),(1,2),(1,3),(1,4),(2,2),(2,3),(2,4),(2,5),(3,3),(3,4),(3,5),(4,4),(4,5),(5,5)$。

三组询问的答案依次为 $6,10$，$10,20$，$14,30$。

--------------------------------

#### 数据规模与约定

**本题采用捆绑测试**。

+ Subtask 1 ( $10\%$ )：$n\leq 2000$。
+ Subtask 2 ( $30\%$ )：$n\leq 2\times 10^4$，形成的关系树为一条链。
+ Subtask 3 ( $60\%$ )：$n\leq 2\times 10^4$。
+ Subtask 4 ( 加强版数据，时限 $4.5s$ )：无特殊限制。

对于 $100\%$ 的测试点，保证 $1\leq n \leq 8\times 10^4$，$1\leq q \leq 10^5$，$0\leq k <n$，$1\leq u,v,l,r \leq n$。


---

---
title: "查找 Search"
layout: "post"
diff: 省选/NOI-
pid: P6617
tag: ['线段树', '平衡树', 'O2优化']
---
# 查找 Search
## 题目背景

>   也许，同学间最好的结局就是朋友吧。

$\mu ry$ 是一个可爱的女孩子。

在她所住的小区里有排成一排的 $n$ 个垃圾桶，从左至右第 $i$ 个垃圾桶里都装着编号为 $a_i$ 的垃圾。

$\mu ry$ 不喜欢无序，于是就想把社区里编号和为 $w$ 的垃圾都清在一起。

但是调皮的 $\text{LeverImmy}$ 可能会把某个垃圾桶里的垃圾偷换成另一种。

生气的 $\mu ry$ 想考考 $\text{LeverImmy}$ 一个区间 $[l, r]$ 内是否存在编号和为 $w$ 的垃圾。

但 $\text{LeverImmy}$ 也不会解决这个问题，于是他找到了聪明的你。

## 题目描述

给定 $n$ 个垃圾桶，你需要维护一个数据结构，支持以下操作：

-   `1 pos val` 表示将 第 $pos$ 个垃圾桶里的垃圾的编号换成 $val$；

-   `2 l r` 询问在 $[l\oplus cnt, r\oplus cnt]$ 内是否存在垃圾编号和为 $w$ 的 **两个** 垃圾桶。

其中 $\oplus$ 表示异或运算，$cnt$ 表示在 **此次询问之前**，答案为 `Yes` 的个数。

对于每个操作 2，若存在请输出 `Yes`，不存在请输出 `No`。

值得注意的是，对于所有询问， $w$ 为 **同一个数**。

## 输入格式

第一行共三个整数 $n, m, w$，表示序列长度、接下来的操作个数与 $w$。

第二行共 $n$ 个整数 $a_1, a_2, \cdots, a_n$ 描述了这个每个垃圾桶内垃圾的编号 $a$。

接下来的 $m$ 行，每行三个整数，格式为 `opt x y`。

## 输出格式

令操作 2 的次数为 $t$，输出数据共 $t$ 行。

第 $i$ 行表示第 $i$ 个操作 2 的结果，即 `Yes` 或 `No`。

## 样例

### 样例输入 #1
```
6 4 6
1 3 2 5 5 6
2 1 4
1 4 1
2 0 5
2 3 7
```
### 样例输出 #1
```
Yes
No
Yes
```
### 样例输入 #2
```
10 20 10
9 3 6 3 3 3 3 1 4 9
1 3 9
1 6 9
2 3 10
1 3 9
2 4 4
1 1 7
1 1 3
1 5 6
1 3 9
2 4 7
1 2 7
2 6 8
1 6 10
2 2 9
1 7 9
2 3 1
1 3 5
1 5 6
1 9 10
1 3 6
```
### 样例输出 #2
```
Yes
No
No
No
Yes
Yes

```
## 提示

本题采用 **捆绑测试**，开启 **O2优化**。

$\text{Subtask 1 (7 pts)}:$ 保证 $1 \le n, m, w \le 2\cdot10^3$，**时限 $1\text{s}$**；

$\text{Subtask 2 (20 pts)}:$ 保证 $1 \le n, m, w \le 1\cdot10^5$，$opt = 2$，**时限 $2\text{s}$**；

$\text{Subtask 3 (30 pts)}:$ 保证 $1 \le n, m, w \le 1\cdot10^5$，**时限 $2\text{s}$**；

$\text{Subtask 4 (43 pts)}:$ 没有特殊限制，**时限 $4\text{s}$**；

对于所有数据， $1 \le n, m, w \le 5\cdot10^5$，$0 \le a_i \le w$。

数据保证对于每个操作，$1 \le pos \le n$，$0 \le val \le w$，$1 \le l \le r \le n$。

由于输入输出量较大，建议使用更快的输入输出方式。

---

#### 输入 #1 解释

第一次操作，询问区间 $[1, 4]$ 中是否有两个数加起来为 $6$，显然有$a_1 + a_4 = 6$，因此输出 `Yes`；

第二次操作，修改 $a_4$ 为 $1$，则序列变为 $[1, 3, 2, 1, 5, 6]$；

第三次操作，询问区间 $[1, 4]$ 中是否有 **两个** 数加起来为 $6$，无，因此输出 `No`。

第四次操作，询问区间 $[2, 6]$ 中是否有两个数加起来为 $6$，显然有 $a_4 + a_5 = 6$，因此输出 `Yes`。



---

---
title: "「C.E.L.U-02」简易输入法"
layout: "post"
diff: 省选/NOI-
pid: P7475
tag: ['平衡树', 'O2优化', '树套树', '字典树 Trie']
---
# 「C.E.L.U-02」简易输入法
## 题目背景

YQH 有一个伟大的梦想，他想成为全世界最强的男人。为了实现这一个目标，他准备从一个简易的输入法入手开始征程。
## 题目描述

这个简易输入法原先有一个词典 $\text{U}$，用户输入时，输入法从用户处读入一个字符串 $s$ ，以及一个整数 $x$ 对于这个字符串有以下几种情形：  
设$s_i \in \text{U} $ 且 $s$ 为 $s_i$ 的前缀的个数为 $a$。  

当 $a\ge x$ 时，请输出按照以输出次数从大到小为第一关键字，以字典序为第二关键字排序后的第 $x$ 个 $s_i$，并将其输出次数加 $1$。    

当 $x>a>0$ 时，请输出按照以输出次数从大到小为第一关键字，以字典序为第二关键字排序后的最后一个 $s_i$，并将其输出次数加 $1$。  

当 $a=0$ 时，输出 `404Error`。  
## 输入格式

第$1$行输入一个整数 $n$，代表 $\text{U}$ 中原有 $n$ 个单词，每个原始存在的单词一开始输入次数都是 $0$。  

第 $2$ 至 $n+1$ 行，每行输入一个字符串 $str$，代表一个词典中原来出现的单词。  

第 $n+2$ 行输入一个整数 $m$，代表用户进行了 $m$ 次操作。  

第 $n+3$ 至 $n+m+2$ 行，输入一个字符串 $s$ 和一个整数 $x$ ，含义在题目描述中已经说了。 
## 输出格式

对于每一个用户的 $1$ 操作，输出一个字符串。
## 样例

### 样例输入 #1
```
3
fan
fantasy
father
6
fat 1
fa 1
fan 1
fan 1
fa 1
fant 1
```
### 样例输出 #1
```
father
father
fan
fan
fan
fantasy
```
### 样例输入 #2
```
5
uva
usaco
usa
usssu
konjac
11
u 2
u 2
kkk 1
uv 2
us 3
u 4
u 1
u 2
k 1
u 3
usa 1
```
### 样例输出 #2
```
usaco
usa
404Error
uva
usssu
uva
uva
usa
konjac
usaco
usa
```
## 提示

### 样例解释 

**样例解释一**

`fat` 为前缀只有 $1$ 个，故输出 `father`，并将其输出次数加 $1$。  
`fa` 为前缀中输出次数最多是 `father`，故输出它，并将其输出次数加 $1$。  
`fan` 为前缀中输出次数都是 $0$，但 `fan` 字典序最小，故输出它，并将其输出次数加 $1$。  
`fan` 为前缀 `fan` 输出次数最多，故输出 `fan`，并将其输出次数加 $1$。  
`fa` 为前缀中输出次数最多是 `fan`，故输出它，并将其输出次数加 $1$。  
`fant` 为前缀只有一个单词 `fantasy`，故输出它，并将其输出次数加 $1$。

 ### 数据范围

| 数据编号 | $n$ | $m$ | $x$ | $\sum str$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim 2$ | $\le100$ | $\le100$ | $=1$ | $\le10^3$ |
| $3\sim 4$ | $\le100$ | $\le100$ | $\diagdown$ | $10^3$ |
| $5\sim 8$ | $\le5\times10^4$ | $\le10^5$ | $=1$ | $\le5\times10^5$ |
| $9\sim 14$ | $\le10^4$ | $\le10^5$ | $\diagdown$ | $\le10^5$ |
| $15\sim 20$ | $\le5\times10^4$ | $\le10^5$ | $\diagdown$ | $\le5\times10^5$ |

对于$100\%$的数据，$|s|,|str|\le10,1\leq x\le10^4$，所有字母都是小写字母。


---

---
title: "[AHOI2022] 排列"
layout: "post"
diff: 省选/NOI-
pid: P8338
tag: ['数学', '暴力数据结构', '各省省选', '平衡树', '2022', '安徽', 'O2优化', '优先队列', '素数判断,质数,筛法']
---
# [AHOI2022] 排列
## 题目描述

对于一个长度为 $n$ 的排列 $P = (p_1, p_2, \ldots, p_n)$ 和整数 $k \ge 0$，定义 $P$ 的 $k$ 次幂

$$P^{(k)} = \left( p^{(k)}_1, p^{(k)}_2, \ldots, p^{(k)}_n \right),$$

该排列的第 $i$ 项为

$$p^{(k)}_i = \begin{cases} i, & k = 0, \\ p^{(k - 1)}_{p_i}, & k > 0. \end{cases}$$

容易证明任意排列的任意次幂都是一个排列。

定义排列 $P$ 的**循环值** $v(P)$ 为最小的**正整数** $k$ 使得 $P^{(k + 1)} = P$。

给出一个长度为 $n$ 的排列 $A = (a_1, a_2, \ldots, a_n)$，对于整数 $1 \le i, j \le n$，定义 $f(i, j)$：若存在 $k \ge 0$ 使得 $a^{(k)}_i = j$，则 $f(i, j) = 0$，否则设排列 $A_{i j}$ 为将排列 $A$ 的第 $i$ 项 $a_i$ 和第 $j$ 项 $a_j$ 交换后得到的排列，则 $f(i, j) = v(A_{i j})$。

求 $\sum_{i = 1}^{n} \sum_{j = 1}^{n} f(i, j)$ 的值。答案可能很大，你只需要输出其对 $({10}^9 + 7)$ 取模的结果。
## 输入格式

**本题有多组测试数据**。输入数据的第一行为一个整数 $T$，表示测试数据组数。

对于每组测试数据，第一行一个正整数 $n$ 表示排列的长度，接下来一行 $n$ 个整数 $a_1, a_2, \ldots, a_n$，描述输入的排列。
## 输出格式

对于每组数据输出一行一个整数，表示题目所求的答案对 $({10}^9 + 7)$ 取模的结果。
## 样例

### 样例输入 #1
```
2
3
1 2 3
3
2 3 1

```
### 样例输出 #1
```
12
0

```
## 提示

**【样例解释 #1】**

对于第一组测试数据，$f(1, 2) = f(2, 1) = f(2, 3) = f(3, 2) = f(1, 3) = f(3, 1) = 2$，其余的 $f(i, j)$ 均为 $0$。

对于第二组测试数据，所有的 $f(i, j)$ 均为 $0$。

**【样例 #2】**

见附件中的 `perm/perm2.in` 与 `perm/perm2.ans`。

该组样例中，第一个测试数据满足 $n \le 35$，前四个测试数据满足 $n \le 200$，所有测试数据满足 $n \le 2500$。

**【样例 #3】**

见附件中的 `perm/perm3.in` 与 `perm/perm3.ans`。

该组样例中，第一个测试数据满足特殊性质 A，第二个测试数据满足特殊性质 B，第三个测试数据满足特殊性质 C，前四个测试数据满足 $n \le {10}^5$，第五个测试数据满足 $n \le 5 \times {10}^5$。

特殊性质的具体内容参见数据范围部分。

**【数据范围】**

对于 $100 \%$ 的测试数据，$1 \le T \le 5$，$1 \le n \le 5 \times {10}^5$，$1 \le a_i \le n$。

| 测试点编号 | $n \le$ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 2$ | ${10}^5$ | A |
| $3$ | $35$ | 无 |
| $4$ | $200$ | 无 |
| $5$ | $2500$ | 无 |
| $6$ | ${10}^5$ | B |
| $7$ | ${10}^5$ | C |
| $8$ | ${10}^5$ | 无 |
| $9 \sim 10$ | $5 \times {10}^5$ | 无 |

特殊性质 A：$a_i = (i \bmod n) + 1$。  
特殊性质 B：对于任意 $1 \le i \le n$，存在 $1 \le k \le 20$，$a^{(k)}_i = i$。  
特殊性质 C：存在大小不超过 $10$ 的集合 $S$，使得对于任意 $1 \le i \le n$，存在 $x \in S, k \ge 0$，$a^{(k)}_x = i$。

**【提示】**

输入数据规模较大，请使用较为快速的输入方式。


---

---
title: "[蓝桥杯 2016 国 A] 圆圈舞"
layout: "post"
diff: 省选/NOI-
pid: P8640
tag: ['2016', '平衡树', '蓝桥杯国赛']
---
# [蓝桥杯 2016 国 A] 圆圈舞
## 题目描述

春天温暖的阳光照耀着大地，正是草原上的小动物们最快乐的时候。小动物们在草原上开了一个舞会，欢度这美好的时光。

舞会上最重要的一个环节就是跳圆舞曲，$n$ 只小动物手拉手围成一大圈，随着音乐跳起来。在跳的过程中，小动物们可能会变换队形。它们的变换方式是动物 A 松开自己右手，动物 B 松开自己的左手，动物 A 和 B 手拉到一起，而它们对应的松开的手（如果有的话）也拉到一起。

例如，假设有 $10$ 只小动物，按顺序围成一圈，动物 $1$ 的右手拉着动物 $2$ 的左手，动物 $2$ 的右手拉着动物 $3$ 的左手，依次类推，最后动物 $10$ 的右手拉着动物 $1$ 的左手。如果通过动物 $2$ 和 $8$ 变换队形，则动物 $2$ 的右手拉着动物 $8$ 的左手，而对应的动物 $3$ 的左手拉着动物 $7$ 的右手，这样形成了 `1-2-8-9-10` 和 `3-4-5-6-7` 两个圈。如果此时通过动物 $2$ 和 $6$ 变换队形，则将形成 `1-2-6-7-3-4-5-8-9-10` 一个大圈。注意，如果此时通过动物 $1$ 和 $2$ 变换队形，那么队形不会改变，因为动物 $1$ 的右手和动物 $2$ 的左手松开后又拉到一起了。

在跳舞的过程中，每个动物 $i$ 都有一个欢乐值 $H_i$ 和一个感动值 $F_i$。

如果两个动物在一个圈中，欢乐值会彼此影响，产生欢乐能量。如果两个动物 $i, j(i\neq j)$ 在同一个大小为 $t$ 的圈中，而动物 $i$ 在动物 $j$ 右手的第 $p$ 个位置（动物 $j$ 右手的第 $1$ 个位置就是动物 $j$ 右手所拉着的动物，而第 $2$ 个位置就是右手第 $1$ 个位置的动物右手拉着的动物，依次类推），则产生的欢乐能量为 $(t-p)\times H_j\times F_i$。在跳舞的过程中，动物们的欢乐值和感动值有可能发生变化。

圆舞曲开始的时候，所有的动物按编号顺序围成一个圈，动物 $n$ 右手的第 $i$ 个位置正好是动物 $i$。现在已知小动物们变换队形的过程和欢乐值、感动值变化的过程，求每次变换后所有动物所产生的欢迎能量之和。
## 输入格式

输入的第一行包含一个整数 $n$，表示动物的数量。

接下来 $n$ 行，每行两个用空格分隔的整数 $H_i$，$F_i$，按编号顺序给出每只动物的欢乐值和感动值。
接下来一行包含一个整数 $m$，表示队形、欢乐值、感动值的变化次数。

接下来 $m$ 行，每行三个用空格分隔的整数 $k$，$p$，$q$，当 $k=1$ 时，表示小动物们通过动物 $p$ 和动物 $q$ 变换了队形，当 $k=2$ 时，表示动物 $p$ 的欢乐值变为 $q$，当 $k=3$ 时，表示动物 $p$ 的感动值变为了 $q$。
## 输出格式

输出 $m$ 行，每行一个整数，表示每次变化后所有动物产生的能量之和。

答案可能很大，你需要计算答案除以 $1000000007$（即 $10^9+7$） 的余数。

## 样例

### 样例输入 #1
```
10
1 1
1 1
1 1
1 1
1 1
1 1
1 1
1 1
1 1
1 1
9
1 2 8
1 2 6
2 8 10
3 5 10
1 1 2
1 2 1
2 5 5
1 4 8
1 4 5
```
### 样例输出 #1
```
100
450
855
1341
1341
811
923
338
923
```
## 提示

对于 $20\%$ 的数据，$2\le n,m\le100$。

对于 $30\%$ 的数据，$2\le n,m\le1000$。

另有 $20\%$ 的数据，只有 $k=1$ 的操作且 $H_i$，$F_i$ 均为 $1$。

另有 $20\%$ 的数据，只有 $k=1$ 或 $2$ 的操作且 $F_i$ 均为 $1$。

对于 $100\%$ 的数据，$2\le n,m\le10^5$，$0\le H_i,F_i\le10^9$，$1\le k\le3$，$k=1$ 时 $1\le p,q\le n$ 且 $p\neq q$，$k=2$ 或 $3$ 时 $1\le p\le n$ 且 $0\le q\le10^9$。


---

---
title: "[PA 2021] Wystawa"
layout: "post"
diff: 省选/NOI-
pid: P9051
tag: ['动态规划 DP', '贪心', '二分', '平衡树', '2021', 'Special Judge', 'PA（波兰）']
---
# [PA 2021] Wystawa
## 题目描述

给定长度为 $n$ 的序列 $a, b$。

你需要构造一个序列 $c$，构造方法为：

- 选择 $k$ 个 $i$，令 $c_i \leftarrow a_i$。
- 对于其他 $i$，令 $c_i \leftarrow b_i$。

求序列 $c$ 的最大子段和的最小值，并给出一种方案。
## 输入格式

第一行，两个整数 $n, k$；

第二行，$n$ 个整数 $a_1, a_2, \cdots, a_n$；

第三行，$n$ 个整数 $b_1, b_2, \cdots, b_n$。
## 输出格式

第一行，一个整数，表示序列 $c$ 的最大子段和的最小值；

第二行，一个长为 $n$ 的字符串 $s$，若令 $c_i \leftarrow a_i$，$s_i = \text{A}$；否则，$s_i = \text{B}$。

**如有多解，输出任意一组均可。**
## 样例

### 样例输入 #1
```
6 2
-1 7 0 2 -5 0
3 1 4 -3 -3 12
```
### 样例输出 #1
```
4
BBABBA
```
### 样例输入 #2
```
3 2
-1 -4 -1
-4 -2 -1
```
### 样例输出 #2
```
0
AAB
```
## 提示

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$，$0 \leq k \leq n$，$-10^9 \leq a_i, b_i \leq 10^9$。


---

---
title: "[ICPC 2022 Xi'an R] Bridge"
layout: "post"
diff: 省选/NOI-
pid: P9358
tag: ['平衡树', '2022', 'O2优化', '动态树 LCT', 'ICPC']
---
# [ICPC 2022 Xi'an R] Bridge
## 题目描述

There are $n$ countries numbered from $1$ to $n$ in Erathia. Each country can be regarded as a chain with $m+1$ nodes numbered from $1$ to $m+1$. Initially, node $(a, b)$ is connected with node $(a, b + 1)$ by a street where node $(a, b)$ denotes the $b$-th node of the $a$-th country. There are no bridges between any two countries at first. 

You need to process $q$ queries of the following two types.

- $1\ a\ b$ ($1\leq a < n, 1\leq b\leq m$). Build a bridge between node $(a, b)$ and node $(a + 1, b)$. It is guranteed that at any time, **each node is connected with at most one bridge**.
- $2\ a$ ($1\leq a\leq n$). A hero will walk through Erathia. This hero starts from $(a, 1)$. If the hero is at $(x, y)$ and there is a unvisited bridge connected to him, he passes it, or he goes to $(x, y + 1)$. Once he arrived the $(m+1)$-th node of any conutry, he stops. Please note that 'unvisited bridge' is **independently** judged for each query. 

Your task is to print which country the hero is in at last for the second kind of query. It can be proved that the hero's route is always unique under these constraints.

## 输入格式

The first line contains three integers $n$, $m$ and $q$ ($1 \leq n, m, q \leq 10 ^ 5$).

Each of the following $q$ lines represents a query with format described above.
## 输出格式

For each query of type $2$, output a line with an integer representing the answer.

## 样例

### 样例输入 #1
```
3 4 13
2 2
1 1 3
2 1
2 2
2 3
1 2 4
2 1
2 2
2 3
1 2 1
2 1
2 2
2 3

```
### 样例输出 #1
```
2
2
1
3
3
1
2
3
2
1

```
## 提示

**Source**: The 2022 ICPC Asia Xi'an Regional Contest Problem A.

**Author**: MonkeyKing.
## 题目翻译

### 题目描述

Erathia 大陆上有 $n$ 个国家，从 $1$ 到 $n$ 编号。每个国家可以看成由 $m + 1$ 个结点组成的链，结点从 $1$ 到 $m + 1$ 编号。结点 $(a, b)$ 和 $(a, b + 1)$ 由一条街道连接，其中 $(a, b)$ 表示国家 $a$ 的第 $b$ 个结点。一开始，国家之间没有桥。

你需要处理 $q$ 个操作：

- $1\ a\ b$（$1\leq a < n$，$1\leq b\leq m$）：在 $(a, b)$ 和 $(a + 1, b)$ 之间建造一座桥。**保证每个结点最多和一座桥相连**。
- $2\ a$（$1\leq a\leq n$）：一名英雄走过 Erathia 大陆。他从 $(a, 1)$ 出发。如果这名英雄当前在结点 $(x, y)$ 且有一座未被访问过的桥与之连接，那么他会走过这个桥到达桥的另一端，否则他会走到 $(x, y + 1)$。一旦他到达某个国家的第 $m + 1$ 个结点，他就会停下来。注意两个询问之间的 “未被访问过的桥” 是独立的。

你的任务是对每个操作 $2$ 求出英雄最终所在的国家。

$1\leq n, m, q\leq 10 ^ 5$。

### 输入格式

第一行三个整数 $n, m, q$。

接下来 $q$ 行，每行若干个整数表示一组询问。格式见题目描述。

### 输出格式

对于每个操作 $2$，输出一行一个整数表示答案。




---

---
title: "「SFCOI-3」进行一个走的行"
layout: "post"
diff: 省选/NOI-
pid: P9494
tag: ['倍增', '平衡树', '2023', '洛谷原创', 'O2优化', '差分']
---
# 「SFCOI-3」进行一个走的行
## 题目背景

**公告：注意存在 $l_i > r_i$ 的情况，此时操作无效。**

------------

小 L 热衷于行走。
## 题目描述

小 L 来到了一处景点，他想要在这里的主干道上行走。

主干道上有若干关键点，他可以将其抽象为一个长为 $n$ 的序列 $a$，每个 $a_i$ 都是一个三元组，可以表示为 $(l_i, r_i, v_i)$，其具体含义形如：

- 若 $r_i = -1$，表示一个需要买票进入的景点，票价为 $l_i$ 代币，游览完成后他会得到 $v_i$ 的愉悦值。
- 若 $r_i \neq -1$，表示一个礼品派发点，若他持有的代币面值之和 $x$ 满足 $l_i \leq x \leq r_i$，他可以领取一份礼品，并会得到 $v_i$ 的愉悦值。

他打算在这条主干道上行走 $m$ 次，每次他给出了行走起点 $l$ 和终点 $r$，一开始他持有的代币面值之和为 $x$，初始愉悦值为 $0$。

他将从 $l$ 开始向右依次经过 $i \in [l, r]$，他会做如下操作：

- 若 $r_i = -1$，如果他持有的代币在支付完当前景点门票费用后还有剩余，他会游览这个景点。
- 若 $r_i \neq -1$，如果可以，他会领取一份礼品。

请你帮他快速求出每次行走结束后他的愉悦值。
## 输入格式

第一行，两个整数 $n, m$；

接下来 $n$ 行，其中第 $i$ 行有三个整数 $l_i, r_i, v_i$；

接下来 $m$ 行，每行三个整数 $l, r, x$，表示一个询问。
## 输出格式

$m$ 行，每行一个整数，表示行走结束后他的愉悦值。
## 样例

### 样例输入 #1
```
4 10
1 1 4
5 -1 4
1 9 19
8 -1 10
1 1 11
2 2 4
3 3 5
4 4 14
1 2 1
2 3 9
3 4 1
1 3 9
2 4 8
1 4 10
```
### 样例输出 #1
```
0
0
19
10
4
23
19
23
23
23
```
## 提示

**本题开启捆绑测试。**

- Subtask 1（10 pts）：$1 \leq n, m \leq 5 \times 10^3$。
- Subtask 2（10 pts）：$r_i \neq -1$。
- Subtask 3（20 pts）：$r_i = -1$。
- Subtask 4（10 pts）：$1 \leq n, m \leq 7.5 \times 10^4$，性质 A。
- Subtask 5（20 pts）：$1 \leq n, m \leq 7.5 \times 10^4$。
- Subtask 6（10 pts）：数据在范围内随机生成，性质 B。
- Subtask 7（20 pts）：无特殊限制。

性质 A：$1 \leq l_i \leq 7.5 \times 10^4$，$r_i = -1$ 或 $1 \leq r_i \leq 7.5 \times 10^4$，$1 \leq x \leq 7.5 \times 10^4$。

性质 B：$r_i = -1$ 时 $1 \leq l_i \leq 2 \times 10^5$。

对于 $100\%$ 的数据：

- $1 \leq n, m \leq 2 \times 10^5$。
- $1 \leq l_i \leq 10^9$，$r_i = -1$ 或 $1 \leq r_i \leq 10^9$。
- $1 \leq v_i \leq 10^9$。
- $1 \leq l \leq r \leq n$，$1 \leq x \leq 10^9$。


---


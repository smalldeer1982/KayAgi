---
title: "[PA 2015] 精确打击 / Kontrmanifestacja"
layout: "post"
diff: 省选/NOI-
pid: P11812
tag: ['图论', '2015', '强连通分量', 'PA（波兰）']
---
# [PA 2015] 精确打击 / Kontrmanifestacja
## 题目背景


译自 [PA 2015](https://sio2.mimuw.edu.pl/c/pa-2015-1/p/) R5.

## 题目描述

给定一张 $n$ 个点 $m$ 条边的**有向图**。有向图无重边自环。

对于这张图的经过边数量 $\ge 1$ 的回路，求回路上点集的交。

## 输入格式

第一行两个正整数 $n,m$。

接下来 $m$ 行，每行两个整数 $u,v$，表示一条有向边 $u\to v$。
## 输出格式

如果不存在经过边数 $\ge 1$ 的回路，输出一行一个 $\texttt{NIE}$。

否则第一行输出一个非负整数 $k$，表示点集交的大小。

第二行**升序**输出交中的节点。特别地，若 $k=0$，应输出一行空行。

## 样例

### 样例输入 #1
```
4 5
1 2
2 3
3 1
3 4
4 2
```
### 样例输出 #1
```
2
2 3
```
### 样例输入 #2
```
3 2
1 2
2 3
```
### 样例输出 #2
```
NIE
```
## 提示

- $2\le n\le 5\times 10^5$；
- $1\le m\le 10^6$；
- 图无重边自环。


---

---
title: "[NHSPC 2023] C. 與自動輔助駕駛暢遊世界"
layout: "post"
diff: 省选/NOI-
pid: P11904
tag: ['动态规划 DP', '2023', 'O2优化', '强连通分量', '台湾']
---
# [NHSPC 2023] C. 與自動輔助駕駛暢遊世界
## 题目描述

知名汽車公司 EWM 在自家的汽車上加裝了最新的自動輔助駕駛 (auto co-pilot) 技術，讓汽車在駕駛人沒有給出明確指令的情況下，也能依據 AI 做出的決策前進。身為車主的小明，自然開始計畫使用這款具備自動輔助駕駛技術的汽車以暢遊世界。

這個世界可以看作一張有向圖 (directed graph) $G$，其中 $G$ 上的點 $s$ 為小明目前的位置，點 $t$ 為小明欲到達的終點。為了兼顧行車安全，EWM 的汽車在 $G$ 上的行進期間，必須遵循有向邊 (directed edge) 的方向前進，不能逆向行駛；在此前提下，無論所在的位置為何，AI 都會從所有可以前進的方向中，均勻隨機地 (uniformly random) 選擇一個方向前進。舉例來說，若汽車目前在點 $a$，而點 $a$ 有三條向外的邊，分別連到點 $b, c, d$，此時 AI 輔助駕駛會從點 $b, c, d$ 中，以機率各為 $1/3$ 的方式選出一個前進。

為了讓駕駛人能控制汽車往他/她希望的方向前進，EWM 公司提供了以下的機制：在 AI 做出決策前，駕駛人可以支付 $1$ 枚 EWM 公司發行的代幣，讓 AI 選擇駕駛人希望的方向。以上一個例子為例，若小明在點 $a$ 時不希望 AI 做隨機選擇，而是直接選擇某個點（例如點 $b$）前進，那麼他可以支付 $1$ 枚代幣，控制 AI 直接選擇走向點 $b$。請注意一次代幣支付僅限使用於一次選擇，亦即若汽車重新回到了同一個支付過代幣的點，AI 並不會直接往上一次支付代幣時指定的方向前進，而是會重新均勻隨機地做出選擇；如果駕駛人仍想指定汽車的前進方向，必須再次支付 $1$ 枚代幣。

小明想要知道，他最少需要準備多少枚代幣，才能保證在抵達終點 $t$ 前的任何時刻都存在一條從他的所在地抵達終點 $t$ 的路徑。
## 样例

### 样例输入 #1
```
5 5
1 2
2 3
3 1
2 4
3 5
1 5
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
5 6
1 2
2 3
3 1
4 2
4 5
5 4
1 5
```
### 样例输出 #2
```
-1
```
### 样例输入 #3
```
8 11
1 2
2 1
2 3
3 4
3 8
4 1
4 5
5 6
5 7
6 7
6 8
1 8
```
### 样例输出 #3
```
1
```


---

---
title: "[蓝桥杯 2025 国 A] 连锁反应【数据强度待检验】"
layout: "post"
diff: 省选/NOI-
pid: P12845
tag: ['图论', '贪心', '线段树', '2025', '图论建模', '强连通分量', '蓝桥杯国赛']
---
# [蓝桥杯 2025 国 A] 连锁反应【数据强度待检验】
## 题目背景

数据强度可能较弱，可能会不定期更新。
## 题目描述

小蓝在数轴上放置了 $n$ 枚炸弹，第 $i$ 枚炸弹的位置为 $p_i$，其爆炸范围为 $[p_i - l_i, p_i + r_i]$。当一枚炸弹爆炸时，其范围内的所有其他未爆炸的炸弹均会被引爆。小蓝希望知道至少需要主动引爆多少枚炸弹，才能使得所有炸弹都爆炸。

## 输入格式

输入的第一行包含一个正整数 $n$。

接下来 $n$ 行，每行包含三个整数 $p_i, l_i, r_i$，相邻整数之间使用一个空格分隔。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
5
3 1 1
1 0 2
6 2 1
9 4 2
10 1 1

```
### 样例输出 #1
```
2
```
## 提示

**【样例说明】**

主动引爆炸弹 $2, 4$，即可引爆所有炸弹。

**【评测用例规模与约定】**

对于 20% 的评测用例，$1 \leq n \leq 2000$；

对于另外 20% 的评测用例，$l_i = 0$；

对于所有评测用例，$1 \leq n \leq 200000$，$0 \leq p_i, l_i, r_i \leq 10^5$。


---

---
title: "[OOI 2023] 皇家任务"
layout: "post"
diff: 省选/NOI-
pid: P13529
tag: ['动态规划 DP', '2023', '强连通分量', 'Moscow Olympiad']
---
# [OOI 2023] 皇家任务
## 题目描述

不久前，伯利兰新建成了一套公路网络。某些城市对之间有单向道路，第 $i$ 条道路从城市 $u_i$ 通向城市 $v_i$，其长度为 $w_i$。伯利兰有两个主要城市，编号为 $a$ 和 $b$。

伯利兰的国王非常热爱自己的国家，尤其喜欢计算各种有趣的性质。他把一条路径的「美丽度」定义为该路径上所有道路长度的按位异或（即 XOR）。而他把国家的「美丽度」定义为所有从城市 $a$ 到城市 $b$ 的路径的美丽度的按位异或。注意，这些路径可能有无穷多条，而且可以多次经过同一个城市。

国王想知道他的国家的美丽度是多少，所以他请你帮他计算这个值，或者判断无法计算美丽度。

集合中所有数的按位异或指的是集合中所有非零数的按位异或。如果集合中有无穷多个非零数，则无法计算按位异或。

按位异或是一种二元运算，相当于对两个操作数的每一位分别做逻辑异或。如果对应位不同，则该位结果为 $1$；如果相同，则为 $0$。例如，$x = 109_{10} = 1101101_2$，$y = 41_{10} = 101001_2$，则 $x \oplus y = 1000100_2 = 68_{10}$。

在图中，一条路径指的是一系列顶点，其中任意两个相邻顶点之间都有一条边相连。
## 输入格式

每个测试包含若干组数据。第一行一个整数 $t$（$1 \le t \le 40\,000$），表示数据组数。

每组数据的第一行包含两个整数 $n$ 和 $m$（$1 \le n, m \le 200\,000$），分别表示城市数和道路数。

接下来 $m$ 行，每行三个整数 $u_i, v_i, w_i$（$1 \le u_i, v_i \le n$，$0 \le w_i \le 2^{30} - 1$），表示第 $i$ 条道路的起点、终点和长度。

每组数据的最后一行包含两个整数 $a, b$（$1 \le a, b \le n$），表示国王关心的起点和终点。

设 $\sum n$ 表示所有数据组的 $n$ 之和，$\sum m$ 表示所有数据组的 $m$ 之和。保证 $\sum n \le 200\,000$，$\sum m \le 200\,000$。

## 输出格式

对于每组数据，输出一个整数，表示伯利兰的美丽度。如果无法计算美丽度，则输出 $-1$。

## 样例

### 样例输入 #1
```
5
1 1
1 1 0
1 1
3 5
1 2 0
1 2 1
1 2 3
2 3 5
2 3 2
1 3
2 2
1 2 1
2 1 2
1 2
3 3
1 2 7
2 3 0
3 1 7
2 3
4 5
1 1 0
1 2 3
2 2 0
2 3 1
3 4 1
1 4
```
### 样例输出 #1
```
0
7
-1
0
-1
```
## 提示

### 样例解释

- 在第一组数据中，国家只有一条长度为 $0$ 的道路，因此任意路径的美丽度均为 $0$，所有路径的美丽度异或起来也是 $0$。
- 在第二组数据中，从城市 $1$ 到城市 $3$ 的路径共有 $6$ 条，其美丽度分别为 $0 \oplus 5 = 5$、$0 \oplus 2 = 2$、$1 \oplus 5 = 4$、$1 \oplus 2 = 3$、$3 \oplus 5 = 6$、$3 \oplus 2 = 1$。将它们按位异或后，答案为 $5 \oplus 2 \oplus 4 \oplus 3 \oplus 6 \oplus 1 = 7$。
- 在第三组数据中，从城市 $1$ 到城市 $2$ 的路径有美丽度 $1$、$1 \oplus 2 \oplus 1 = 2$、$1 \oplus 2 \oplus 1 \oplus 2 \oplus 1 = 1$、$1 \oplus 2 \oplus 1 \oplus 2 \oplus 1 \oplus 2 \oplus 1 = 2$，依此类推。可以发现，从 $1$ 到 $2$ 存在无穷多条美丽度不为 $0$ 的路径，因此无法计算答案。
- 在第四组数据中，从城市 $2$ 到城市 $3$ 有无穷多条美丽度为 $0$ 的路径，但没有任何美丽度非零的路径，因此最终国家美丽度为 $0$。

### 评分说明

本题测试点分为 6 组。只有通过某一组的所有测试点，且通过部分之前组的所有测试点，才能获得该组分数。有些分组不要求通过样例测试点。“离线评测”表示该组的测试结果只会在比赛结束后公布。

| 组别 | 分值 | $\sum n$ | $\sum m$ | $w_i$ | 必须通过的组 | 备注 |
|:----:|:----:|:--------:|:--------:|:-----:|:------------:|:----:|
| 0    | 0    | --       | --       | --    | --           | 样例测试点 |
| 1    | 16   | --       | --       | --    | --           | $n = m$，$u_i = i, v_i = i+1$ 对 $i < n$，$u_n = n, v_n = 1$ |
| 2    | 17   | --       | --       | $w_i \le 1$ | --    | $u_i < v_i$ |
| 3    | 15   | --       | --       | --    | 2            | $u_i < v_i$ |
| 4    | 19   | $\sum n \le 1000$ | $\sum m \le 1000$ | $w_i \le 2^{10} - 1$ | 0 |  |
| 5    | 14   | --       | --       | $w_i \le 1$ | 2            |  |
| 6    | 19   | --       | --       | --    | 0--5         | **离线评测** |



---

---
title: "[APIO2013] 道路费用"
layout: "post"
diff: 省选/NOI-
pid: P3639
tag: ['2013', 'APIO', '生成树', '连通块', '强连通分量']
---
# [APIO2013] 道路费用
## 题目描述

幸福国度可以用 N 个城镇（用 1 到 N 编号）构成的集合来描述，这些城镇 最开始由 M 条双向道路（用 1 到 M 编号）连接。城镇 1 是中央城镇。保证一个 人从城镇 1 出发，经过这些道路，可以到达其他的任何一个城市。这些道路都是 收费道路，道路 i 的使用者必须向道路的主人支付 ci分钱的费用。已知所有的这 些ci是互不相等的。最近有K条新道路建成，这些道路都属于亿万富豪Mr. Greedy。 Mr. Greedy 可以决定每条新道路的费用（费用可以相同），并且他必须在明天宣 布这些费用。

两周以后，幸福国度将举办一个盛况空前的嘉年华！大量的参与者将沿着这 些道路游行并前往中央城镇。共计 pj个参与者将从城镇 j 出发前往中央城镇。这 些人只会沿着一个选出的道路集合前行，并且这些选出的道路将在这件事的前一 天公布。根据一个古老的习俗，这些道路将由幸福国度中最有钱的人选出，也就 是 Mr. Greedy。同样根据这个习俗，Mr. Greedy 选出的这个道路集合必须使所有 选出道路的费用之和最小，并且仍要保证任何人可以从城镇 j 前往城镇 1（因此， 这些选出的道路来自将费用作为相应边边权的“最小生成树”）。如果有多个这样 的道路集合，Mr. Greedy 可以选其中的任何一个，只要满足费用和是最小的。

Mr. Greedy 很明确地知道，他从 K 条新道路中获得的收入不只是与费用有 关。一条道路的收入等于所有经过这条路的人的花费之和。更准确地讲，如果 p 个人经过道路 i，道路 i 产生的收入为 ci p 的积。注意 Mr. Greedy 只能从新道路 收取费用，因为原来的道路都不属于他。

Mr. Greedy 有一个阴谋。他计划通过操纵费用和道路的选择来最大化他的收 入。他希望指定每条新道路的费用（将在明天公布），并且选择嘉年华用的道路 （将在嘉年华的前一天公布），使得他在 K 条新道路的收入最大。注意 Mr. Greedy 仍然需要遵循选出花费之和最小的道路集合的习俗。

你是一个记者，你想揭露他的计划。为了做成这件事，你必须先写一个程序 来确定 Mr. Greedy 可以通过他的阴谋获取多少收入。

## 输入格式

你的程序必须从标准输入读入。第一行包含三个由空格隔开的整数 N，M 和 K。接下来的 M 行描述最开始的 M 条道路。这 M 行中的第 i 行包含由空格隔开 的整数 ai，bi和 ci，表示有一条在 ai 和 bi之间，费用为 ci 的双向道路。接下来的 K 行描述新建的 K 条道路。这 K 行中的第 i 行包含由空格隔开的整数 xi和 yi，表 示有一条连接城镇 xi 和 yi 新道路。最后一行包含 N 个由空格隔开的整数，其中 的第 j 个为 pj，表示从城镇 j 前往城镇 1 的人数。

输入也满足以下约束条件。 

1 ≤ N ≤ 100000； 

1 ≤ K ≤ 20； 

1 ≤ M ≤ 300000； 

对每个 i 和 j，1 ≤ ci, pj ≤ 10^6；


如果 i ≠ i'，则 ci ≠ ci'； 

在任意两个城市之间，最多只有一条道路（包括新建的道路）。

## 输出格式

你的程序必须输出恰好一个整数到标准输出，表示能获得的最大的收入。

## 样例

### 样例输入 #1
```
5 5 1 
3 5 2 
1 2 3 
2 3 5 
2 4 4 
4 3 6 
1 3 
10 20 30 40 50
```
### 样例输出 #1
```
400
```
## 提示

在样例中，Mr. Greedy 应该将新道路(1,3)的费用设置为 5 分钱。在这个费用 下，他可以选择道路(3,5)，(1,2)，(2,4)和(1,3)来最小化总费用，这个费用为 14。 从城镇 3 出发的 30 个人和从城镇 5 出发的 50 个人将经过新道路前往城镇 1，因 此他可以获得为(30+50)×5=400 分钱的最好收入。

如果我们这样做，将新道路(1,3)的费用设置为 10 分钱。根据传统的限制， Mr. Greedy 必须选择(3,5)，(1,2)，(2,4)和(2,3)，因为这是唯一费用最小的集合。 因此，在嘉年华的过程中道路(1,3)将没有任何收入。


我们将使用以下 5 类测例测试你的程序。

1. （国际 16 分，国内 15 分）N ≤ 10，M ≤ 20 且 K = 1；

2. （国际 18 分，国内 20 分）N ≤ 30，M ≤ 50 且 K ≤ 10；

3. （国际 22 分，国内 20 分）N ≤ 1,000，M ≤ 5,000 且 K ≤ 10；

4. （国际 22 分，国内 20 分）N ≤ 100,000，M ≤ 300,000 且 K ≤ 15；

5. （国际 22 分，国内 25 分）N ≤ 100,000，M ≤ 300,000 且 K ≤ 20。

**update: 2024/07/04 删除了两个测试点，并且改为捆绑。**



---

---
title: "[HAOI2017] 新型城市化"
layout: "post"
diff: 省选/NOI-
pid: P3731
tag: ['2017', '河南', '各省省选', '强连通分量', '二分图']
---
# [HAOI2017] 新型城市化
## 题目描述

Anihc 国有 $n$ 座城市。城市之间存在一些贸易合作关系，如果城市 $x$ 与城市 $y$ 之间存在贸易协定，那么城市 $x$ 和城市 $y$ 则是一对贸易伙伴（注意： $(x,y)$ 和 $(y,x)$ 是同一对城市）。

为了实现新型城市化，实现统筹城乡一体化以及发挥城市群辐射与带动作用，国家决定规划新型城市关系。一些城市能够被称为城市群的条件是：这些城市两两都是贸易伙伴。由于Anihc 国之前也一直很重视城市关系建设，所以可以保证在目前已存在的贸易合作关系的情况下 Anihc 的 $n$ 座城市可以恰好被划分为不超过两个城市群。

为了建设新型城市关系 Anihc 国想要选出两个之前并不是贸易伙伴的城市，使这两个城市成为贸易伙伴，并且要求在这两个城市成为贸易伙伴之后，最大城市群的大小至少比他们成为贸易伙伴之前的最大城市群的大小增加 $1$。

Anihc 国需要在下一次会议上讨论扩大建设新型城市关系的问题，所以要请你求出在哪些城市之间建立贸易伙伴关系可以使得这个条件成立，即建立此关系前后的最大城市群的大小至少相差 $1$。
## 输入格式

第一行 $2$ 个整数 $n,m$，表示城市的个数，目前还没有建立贸易伙伴关系的城市的对数。

接下来 $m$ 行，每行 $2$ 个整数 $x,y$ 表示城市 $x,y$ 之间目前还没有建立贸易伙伴关系。
## 输出格式

第一行 $1$ 个整数 $\text{ans}$，表示符合条件的城市的对数。

接下来 $\text{ans}$ 行，每行两个整数，表示一对可以选择来建立贸易伙伴关系的城市。对于一对城市 $x,y$，请先输出编号更小的那一个。最后城市对与城市对之间顺序请按照字典序从小到大输出。
## 样例

### 样例输入 #1
```
5 3
1 5
2 4
2 5
```
### 样例输出 #1
```
2
1 5
2 4
```
## 提示

数据点 $1$：$n\le 16$；

数据点 $2$：$n\le 16$；

数据点 $3\sim 5$：$n\le 100$；

数据点 $6$：$n\le 500$；

数据点 $7\sim10$：$n\le 10^4$。

对于所有的数据保证： $n \le 10^4,0 \le m \le \min(1.5\times 10^5,\dfrac{n(n-1)}{2})$。保证输入的城市关系中不会出现 $(x,x)$ 这样的关系，同一对城市也不会出现两次（无重边，无自环）。


---

---
title: "[NOI2017] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P3825
tag: ['2017', 'NOI', 'Special Judge', 'O2优化', '拓扑排序', '2-SAT', '强连通分量']
---
# [NOI2017] 游戏
## 题目背景

【本题原题时限 1s】

狂野飙车是小 L 最喜欢的游戏。与其他业余玩家不同的是，小 L 在玩游戏之余，还精于研究游戏的设计，因此他有着与众不同的游戏策略。

## 题目描述

小 L 计划进行 $n$ 场游戏，每场游戏使用一张地图，小 L 会选择一辆车在该地图上完成游戏。

小 L 的赛车有三辆，分别用大写字母 $A$、$B$、$C$ 表示。地图一共有四种，分别用小写字母 $x$、$a$、$b$、$c$ 表示。

其中，赛车 $A$ 不适合在地图 $a$ 上使用，赛车 $B$ 不适合在地图 $b$ 上使用，赛车 $C$ 不适合在地图 $c$ 上使用，而地图 $x$ 则适合所有赛车参加。

适合所有赛车参加的地图并不多见，最多只会有 $d$ 张。

$n$ 场游戏的地图可以用一个小写字母组成的字符串描述。例如：$S=\texttt{xaabxcbc}$ 表示小 L 计划进行 $8$ 场游戏，其中第 $1$ 场和第 $5$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $a$，不适合赛车 $A$，第 $4$ 场和第 $7$ 场的地图是 $b$，不适合赛车 $B$，第 $6$ 场和第 $8$ 场的地图是 $c$，不适合赛车 $C$。

小 L 对游戏有一些特殊的要求，这些要求可以用四元组 $ (i, h_i, j, h_j) $ 来描述，表示若在第 $i$ 场使用型号为 $h_i$ 的车子，则第 $j$ 场游戏要使用型号为 $h_j$ 的车子。

你能帮小 L 选择每场游戏使用的赛车吗？如果有多种方案，输出任意一种方案。

如果无解，输出 `-1`。
## 输入格式

输入第一行包含两个非负整数 $n$, $d$。

输入第二行为一个字符串 $S$。

$n$, $d$, $S$ 的含义见题目描述，其中 $S$ 包含 $n$ 个字符，且其中恰好 $d$ 个为小写字母 $x$。

输入第三行为一个正整数 $m$ ，表示有 $m$ 条用车规则。

接下来 $m$ 行，每行包含一个四元组 $i,h_i,j,h_j$ ，其中 $i,j$ 为整数，$h_i,h_j$ 为字符 $A$ 、$B$ 或 $C$，含义见题目描述。
## 输出格式

输出一行。

若无解输出 `-1`。

若有解，则包含一个长度为 $n$ 的仅包含大写字母 A、B、C 的字符串，表示小 L 在这 $n$ 场游戏中如何安排赛车的使用。如果存在多组解，输出其中任意一组即可。
## 样例

### 样例输入 #1
```
3 1
xcc
1
1 A 2 B
```
### 样例输出 #1
```
ABA
```
## 提示

### 样例 1 解释

小 $L$ 计划进行 $3$ 场游戏，其中第 $1$ 场的地图类型是 $x$，适合所有赛车，第 $2$ 场和第 $3$ 场的地图是 $c$，不适合赛车 $C$。

小 $L$ 希望：若第 $1$ 场游戏使用赛车 $A$，则第 $2$ 场游戏使用赛车 $B$。

那么为这 $3$ 场游戏分别安排赛车 $A$、$B$、$A$ 可以满足所有条件。

若依次为 $3$ 场游戏安排赛车为 $BBB$ 或 $BAA$ 时，也可以满足所有条件，也被视为正确答案。

但依次安排赛车为 $AAB$ 或 $ABC$ 时，因为不能满足所有条件，所以不被视为正确答案。

### 样例 2

详见附加文件。

### 数据范围

| 测试点编号 |        $n$         |   $d$   |    $m$     |        其他性质         |
| :--------: | :----------------: | :-----: | :--------: | :---------------------: |
|    $1$     |      $\le 2$       |   $0$   |  $\le 4$   |           无            |
|    $2$     |      $\le 2$       | $\le n$ |  $\le 4$   |           无            |
|    $3$     |      $\le 5$       |   $0$   |  $\le 10$  |           无            |
|    $4$     |      $\le 5$       | $\le n$ |  $\le 10$  |           无            |
|    $5$     |      $\le 10$      |   $0$   |  $\le 20$  |           无            |
|    $6$     |      $\le 10$      | $\le 8$ |  $\le 20$  |           无            |
|    $7$     |      $\le 20$      |   $0$   |  $\le 40$  |    $S$ 中只包含 $c$     |
|    $8$     |      $\le 20$      |   $0$   |  $\le 40$  |           无            |
|    $9$     |      $\le 20$      | $\le 8$ |  $\le 40$  | $S$ 中只包含 $x$ 或 $c$ |
|    $10$    |      $\le 20$      | $\le 8$ |  $\le 40$  |           无            |
|    $11$    |     $\le 100$      |   $0$   | $\le 200$  |    $S$ 中只包含 $c$     |
|    $12$    |     $\le 100$      |   $0$   | $\le 200$  |           无            |
|    $13$    |     $\le 100$      | $\le 8$ | $\le 200$  | $S$ 中只包含 $x$ 或 $c$ |
|    $14$    |     $\le 100$      | $\le 8$ | $\le 200$  |           无            |
|    $15$    | $\le 5\times 10^3$ |   $0$   | $\le 10^4$ |           无            |
|    $16$    | $\le 5\times 10^3$ | $\le 8$ | $\le 10^4$ | $S$ 中只包含 $x$ 或 $c$ |
|    $17$    | $\le 5\times 10^3$ | $\le 8$ | $\le 10^4$ |           无            |
|    $18$    | $\le 5\times 10^4$ |   $0$   | $\le 10^5$ |           无            |
|    $19$    | $\le 5\times 10^4$ | $\le 8$ | $\le 10^5$ | $S$ 中只包含 $x$ 或 $c$ |
|    $20$    | $\le 5\times 10^4$ | $\le 8$ | $\le 10^5$ |           无            |


---

---
title: "[AHOI2009] 最小割"
layout: "post"
diff: 省选/NOI-
pid: P4126
tag: ['2009', '并查集', '各省省选', '安徽', '强连通分量', '最小割']
---
# [AHOI2009] 最小割
## 题目描述

A,B两个国家正在交战，其中A国的物资运输网中有$N$个中转站，$M$条单向道路。设其中第$i (1≤i≤M)$条道路连接了$v_i,u_i$两个中转站，那么中转站$v_i$可以通过该道路到达$u_i$中转站，如果切断这条道路，需要代价$c_i$。

现在B国想找出一个路径切断方案，使中转站$s$不能到达中转站$t$，并且切断路径的代价之和最小。

小可可一眼就看出，这是一个求最小割的问题。但爱思考的小可可并不局限于此。现在他对每条单向道路提出两个问题：

- 问题一：是否存在一个最小代价路径切断方案，其中该道路被切断？
- 问题二：是否对任何一个最小代价路径切断方案，都有该道路被切断？

现在请你回答这两个问题。

## 输入格式

第一行有$4$个正整数，依次为$N,M,s,t$。

第$2$行到第$(M+1)$行每行$3$个正整数$v,u,c$，表示$v$中转站到$u$中转站之间有单向道路相连，单向道路的起点是$v$， 终点是$u$,切断它的代价是$c(1≤c≤100000)$。

注意:两个中转站之间可能有多条道路直接相连。 同一行相邻两数之间可能有一个或多个空格。

## 输出格式

对每条单向边，按输入顺序，依次输出一行，包含两个非$0$即$1$的整数，分别表示对问题一和问题二的回答(其中输出$1$表示是，输出$0$表示否)。 同一行相邻两数之间用一个空格隔开，每行开头和末尾没有多余空格。

## 样例

### 样例输入 #1
```
6 7 1 6
1 2 3
1 3 2
2 4 4
2 5 1
3 5 5
4 6 2
5 6 3
```
### 样例输出 #1
```
1 0
1 0
0 0
1 0
0 0
1 0
1 0
```
## 提示

设第$(i+1)$行输入的边为$i$号边，那么$\{1,2\},\{6,7\},\{2,4,6\}$是仅有的三个最小代价切割方案。它们的并是$\{1,2,4,6,7\}$，交是 $\{\varnothing \}$ 。

测试数据规模如下表所示

数据编号|N|M|数据编号|N|M
-|-|-|-|-|-
1|10|50|6|1000|20000
2|20|200|7|1000|40000
3|200|2000|8|2000|50000
4|200|2000|9|3000|60000
5|1000|20000|10|4000|60000



---

---
title: "[HNOI/AHOI2018] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P4436
tag: ['2018', '各省省选', '安徽', '湖南', '枚举', '剪枝', '强连通分量', '栈']
---
# [HNOI/AHOI2018] 游戏
## 题目描述

一次小G和小H在玩寻宝游戏，有 $n$ 个房间排成一列，编号为 $1,2,\cdots,n$ ，相邻的房间之间都有一道门。其中一部分门上锁（因此需要有对应的钥匙才能开门），其余的门都能直接打开。现在小G告诉了小H每把锁的钥匙在哪个房间里（**每把锁有且只有一把钥匙与之对应**），并作出 $p$ 次指示：第 $i$ 次让小H从第 $S_i$ 个房间出发到 $T_i$ 个房间里。但是小G有时会故意在指令中放入死路，而小H也不想浪费多余的体力去尝试，于是想事先调查清楚每次的指令是否会存在一条通路。

你是否能为小H作出解答呢？
## 输入格式

第一行三个数字： $n,m,p$ ，代表有 $n$ 个房间， $m$ 道门上了锁，以及 $p$ 个询问。接下来$m$行，每行两个数字 $x,y$ 代表 $x$ 到 $x+1$ 的钥匙在房间 $y$ 。接下来 $p$ 行，其中第$i$行是两个整数 $S_i$，$T_i$，代表一次询问
## 输出格式

输出 $p$ 行，每行一个`YES`或`NO`，分别代表能或不能到达。
## 样例

### 样例输入 #1
```
5 4 5 
1 3
2 2 
3 1
4 4
2 5
3 5
4 5 
2 1
3 1
```
### 样例输出 #1
```
YES
NO
YES
YES
NO
```
### 样例输入 #2
```
7 5 4
2 2
3 3 
4 2 
5 3 
6 6
2 1
3 4
3 7
4 5
```
### 样例输出 #2
```
YES
YES
NO
NO
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/17503.png)

$1\le n,p\le 10^6$ ， $0\le m <n$ ， $1\le x,y,S_i,T_i<n$ 保证 $x$ 不重复


---

---
title: "[SHOI2011] 扫雷机器人"
layout: "post"
diff: 省选/NOI-
pid: P4637
tag: ['2011', '各省省选', '上海', 'Special Judge', '强连通分量', '期望']
---
# [SHOI2011] 扫雷机器人
## 题目描述

扫雷是陆军战场上一项重要的而危险的任务。为此， AL 军工厂专门研制了一种扫雷机器人。这种机器人是专门针对直线形雷阵设计的。所谓直线形雷阵，就是所有的地雷都埋在同一条直线上。例如图中黑点表示的雷阵就是直线形雷阵。

![0](https://cdn.luogu.com.cn/upload/pic/20066.png)

AL 军工厂生产的扫雷机器人的排雷方法只有一种，那就是安全引爆。每次，机器人在所有探测到的地雷中选择一颗引爆。被引爆的地雷会接连引爆不超过他的爆炸威力范围的其它地雷，这些被间接引爆的地雷还能引起进一步的连锁爆炸。例如图中，用一个圆的半径表示地雷的爆炸威力。如果引爆 $2$ 号雷， $1$ 、 $2$ 号雷都会爆炸；如果引爆 $3$ 号雷， $4$ 颗地雷全都会爆炸；而如果引爆 $4$ 号雷，那就只有它一颗爆炸。

虽然是机器人，但引爆也是危险的。所以，扫雷机器人的订购人希望机器人能在实战中采取引爆次数尽可能少的炸毁所有地雷的排雷方案。于是 AL 军工厂想就此方面对机器人进行测试。为了评估机器人的表现， AL 军工厂打算事先计算出：在一个直线形雷阵（即输入的雷阵）中，如果随机进行引爆，完成排雷工作所需要引爆次数的期望；并将这个值与机器人的实际排雷方案相比较，来评估他的表现。

所谓“随机进行引爆”是指，每次在所有没有被引爆的地雷中等概率的随机选择一个进行引爆。当这一次引爆引发的连环爆炸结束后，如果还有地雷没有被引爆，则重复上面的操作，直到所有地雷都被引爆为止。
## 输入格式

输入的第一行是一个正整数 $n$ ，表示地雷的个数。

接下去 $n$ 行，按照地雷的位置顺序，每行描述一颗地雷。其中，第 $i+1$ 行有两个整数 $x_i$ 和 $d_i$ ，分别是地雷的坐标和地雷的爆炸威力。也就是说，第 $i$ 号地雷的爆炸能直接进一步引爆第 $j$ 号地雷的条件是 $|x_i-x_j| \le d$ 。 输入保证： $|x_i| \le 10^8$ ， $1 \le d_i \le 10^8$ 。
## 输出格式

输出只有一行，包含一个实数，即为答案。四舍五入到小数点后四位。
## 样例

### 样例输入 #1
```
4
0 1
2 2
8 7
11 2
```
### 样例输出 #1
```
2.3333
```
### 样例输入 #2
```
3
-10 10
0 1
10 10
```
### 样例输出 #2
```
2.3333
```
### 样例输入 #3
```
2
1 10
2 100
```
### 样例输出 #3
```
1.0000

```
### 样例输入 #4
```
9
1 10
2 10
3 10
4 10
5 10
6 10
7 10
8 10
1000 2000
```
### 样例输出 #4
```
1.8889
```
## 提示

**提示**

本题的试题目录下有 $10$ 个额外的输入样例文件 ``robot20111.in~robot201110.in`` ，以及它们对应的输出样例文件 ``robot20111.out~robot201110.out`` 。这些数据符合本题中关于数据规模的全部约定，但它们不是最终的测试数据。

**[下载地址](https://pan.baidu.com/s/1Q5X52FMH38UYvmrEsVsEkA)**，密码：ypbv。

**评分方式**

在每个测试点，如果您的输出是 $YourAns$ ，而标准答案是 $StdAns$ ，那么：

-    当 $ |YourAns-StdAns| \le 0.0001$ 时，该测试点得 $10$ 分。

-    当 $0.01 \ge |YourAns-StdAns| > 0.0001$ 时，该测试点得 $6$ 分。

-    当 $0.5 \ge |YourAns-StdAns| > 0.01$ 时，该测试点得 $2$ 分。

-    否则得 $0$ 分。

**数据范围**

测试点 $1$：$n \le 20$。

测试点 $2$：$n \le 200$ ，且任意方案都保证引爆次数不超过 $20$。

测试点 $3$：$n \le 200$。

测试点 $4 \sim 5$：$n \le 4000$ ，且任意方案都保证引爆次数不超过 $20$。

测试点 $6 \sim 10$：$n \le 4000$。


---

---
title: "【模板】最小树形图"
layout: "post"
diff: 省选/NOI-
pid: P4716
tag: ['图论', '贪心', '强连通分量']
---
# 【模板】最小树形图
## 题目背景

这是一道模板题。
## 题目描述

给定包含 $n$ 个结点， $m$ 条有向边的一个图。试求一棵以结点 $r$ 为根的最小树形图，并输出最小树形图每条边的权值之和，如果没有以 $r$ 为根的最小树形图，输出 $-1$。
## 输入格式

第一行包含三个整数 $n,m,r$，意义同题目所述。

接下来 $m$ 行，每行包含三个整数 $u,v,w$，表示图中存在一条从 $u$ 指向 $v$ 的权值为 $w$ 的有向边。

## 输出格式

如果原图中存在以 $r$ 为根的最小树形图，就输出最小树形图每条边的权值之和，否则输出 $-1$。
## 样例

### 样例输入 #1
```
4 6 1
1 2 3
1 3 1
4 1 2
4 2 2
3 2 1
3 4 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4 6 3
1 2 3
1 3 1
4 1 2
4 2 2
3 2 1
3 4 1
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
4 6 2
1 2 3
1 3 1
4 1 2
4 2 2
3 2 1
3 4 1
```
### 样例输出 #3
```
-1
```
## 提示

**样例 $1$ 解释**

最小树形图中包含第 $2$， $5$， $6$ 三条边，总权值为 $1 + 1 + 1 = 3$

**样例 $2$ 解释**

最小树形图中包含第 $3$， $5$， $6$ 三条边，总权值为 $2 + 1 + 1 = 4$

**样例 $3$ 解释**

无法构成最小树形图，故输出 $-1$ 。

**数据范围**

对于所有数据，$1 \leq u, v \leq n \leq 100$, $1 \leq m \leq 10^4$​​, $1 \leq w \leq 10^6$​​。


---

---
title: "[中山市选] 杀人游戏"
layout: "post"
diff: 省选/NOI-
pid: P4819
tag: ['图论建模', '强连通分量']
---
# [中山市选] 杀人游戏
## 题目描述

一位冷血的杀手潜入Na-wiat，并假装成平民。警察希望能在$N$个人里面，查出谁是杀手。警察能够对每一个人进行查证，假如查证的对象是平民，他会告诉警察，他认识的人，谁是杀手，谁是平民。假如查证的对象是杀手，杀手将会把警察干掉。现在警察掌握了每一个人认识谁。每一个人都有可能是杀手，可看作他们是杀手的概率是相同的。

问：根据最优的情况，保证警察自身安全并知道谁是杀手的概率最大是多少？
## 输入格式

第一行有两个整数 $N,M$。 
接下来有 $M$ 行，每行两个整数 $x,y$，表示 $x$ 认识 $y$（$y$ 不一定认识 $x$ ,例如President同志） 。  

注：原文zz敏感内容已替换
## 输出格式

仅包含一行一个实数，保留小数点后面 $6$ 位，表示最大概率。
## 样例

### 样例输入 #1
```
5 4 
1 2 
1 3 
1 4 
1 5 
```
### 样例输出 #1
```
0.800000
```
## 提示

警察只需要查证$1$。假如$1$是杀手，警察就会被杀。假如$1$不是杀手，他会告诉警察$2,3,4,5$谁是杀手。而$1$是杀手的概率是$0.2$，所以能知道谁是杀手但没被杀的概率是$0.8$。

对于$100\%$的数据有$1≤N≤100000,0≤M≤300000$。


---

---
title: "[yLOI2018] 锦鲤抄"
layout: "post"
diff: 省选/NOI-
pid: P5008
tag: ['贪心', '2018', 'O2优化', '强连通分量']
---
# [yLOI2018] 锦鲤抄
## 题目背景

> 你在尘世中辗转了千百年，  
> 却只让我看你最后一眼。  
> 火光描摹容颜燃尽了时间，  
> 别留我一人，孑然一身，凋零在梦境里面。

—— 银临 & 云の泣《锦鲤抄》

本题原名《逛庭院》。

这首歌的文案如下：（注：不阅读文案不影响下面的阅读）

> 宁武皇仁光九年锦文轩刻本《异闻录》载：扶桑画师浅溪，居泰安，喜绘鲤。院前一方荷塘，锦鲤游曳，溪常与嬉戏。  
> 其时正武德之乱，藩镇割据，战事频仍，魑魅魍魉，肆逆于道。兵戈逼泰安，街邻皆逃亡，独溪不舍锦鲤，未去。  
> 是夜，院室倏火。有人入火护溪，言其本鲤中妖，欲取溪命，却生情愫，遂不忍为之。翌日天明，火势渐歇，人已不见。  
> 溪始觉如梦，奔塘边，但见池水干涸，莲叶皆枯，塘中鲤亦不知所踪。  
> 自始至终，未辨眉目，只记襟上层迭莲花，其色魅惑，似血着泪。  
> 后有青岩居士闻之，叹曰：魑祟动情，必作灰飞。犹蛾之投火耳，非愚，乃命数也。
## 题目描述

扶苏被画师和锦鲤的故事深深地打动了。为了能让锦鲤和画师继续生活在一起，他决定回到着火的庭院中灭掉大火。

画师的庭院可以抽象成一个有向图，每个点代表着一个着火的位置。为了量化火势的大小，扶苏给每个点一个火力值，火力值越大，代表这个点的火势越强。

风助火势，火借风力，对于每一个着火点，都有可能因为大风使得火扩散到其他点。有向图的每条边 $<u,v>$ 代表大火是从点 $u$ 扩散到点 $v$ 的。需要注意的是一个点可能会扩散到很多点，也可能是由很多点的大火一起扩散成的。

为了不因为灭掉火源让画师发现有人在帮他灭火，在任意时刻，扶苏不能灭掉任何一个不被任何点所扩散的点的火。一个点的火被灭掉后，所代表该点的火扩散的所有边将消失。需要说明的是，虽然边消失了，但是该点扩散到的所有点属性除入度以外都不会改变，更不会消失。

因为穿越的时间有限，扶苏只能灭掉最多 $k$ 个点的火。他想问问你他最多能扑灭多少火力值。

#### 简化版题意：

给你一张有向图，每个点有一个点权。任意时刻你可以任意选择一个**有入度**的点，获得它的点权并把它和它的出边从图上删去。最多能选择 $k$ 个点，求最多能获得多少点权。
## 输入格式

输入的第一行是三个用空格隔开的整数，代表图的点数 $n$ 和边数 $m$ 以及点数的限制 $k$。

输入的第二行是 $n$ 个用空格隔开的整数，第 $i$ 个数 $w_i$ 代表点 $i$ 的火力值（点权）。

第 $3$ 到第 $(m + 2)$ 行，每行两个用空格隔开的整数 $u, v$，代表一条 $u$ 指向 $v$ 的有向边。
## 输出格式

输出一行一个整数，代表最大的火力值。
## 样例

### 样例输入 #1
```
7 7 3
10 2 8 4 9 5 7
1 2
1 3
1 4
2 5
3 6
3 7
4 7
```
### 样例输出 #1
```
24
```
## 提示

### 样例输入输出 1 解释

选择 $3, 5, 7$ 三个节点。

---

### 数据规模与约定

**本题采用多测试点捆绑测试，共有 $5$ 个子任务**。

- Subtask 1（30 points）：$n = 10$，$m = 50$。
- Subtask 2（30 points）：$n = 100001$，$m = 500001$。**保证给出的图是一个有向无环图**。
- Subtask 3（20 points）：$n = 100002$，$m = 500002$。保证给出的图中，没有入度的点有且仅有一个。
- Subtask 4（17 points）：$n = 100003$，$m = 500003$。
- Subtask 5（3 points）：$n = 500004$，$m = 2000004$。

对于全部的测试点，保证 $1 \leq n \leq 5 \times 10^5 + 4$，$1 \leq m \leq 2 \times 10^6 + 4$，$0 \leq w_i \leq 10^3$，$0 \leq k \leq n$。

**不保证**给出的图没有自环。

---

### 提示

- 请注意数据读入对程序效率造成的影响。
- $n$ 的末位数字可以帮助你快速的判断测试点所在的子任务。




---

---
title: "[SNOI2017] 炸弹"
layout: "post"
diff: 省选/NOI-
pid: P5025
tag: ['2017', '线段树', '各省省选', '强连通分量']
---
# [SNOI2017] 炸弹
## 题目描述

在一条直线上有 $n$ 个炸弹，每个炸弹的坐标是 $ x_i $，爆炸半径是 $ r_i $，当一个炸弹爆炸时，如果另一个炸弹所在位置 $ x_j $ 满足： 
$ |x_j-x_i| \le r_i $ ，那么，该炸弹也会被引爆。    
现在，请你帮忙计算一下，先把第 $i$ 个炸弹引爆，将引爆多少个炸弹呢？ 

答案对 $10^9 + 7$ 取模
## 输入格式

第一行，一个数字 $n$ ，表示炸弹个数。 
第 $2 \sim n+1$ 行，每行两个整数，表示 $x_i$，$r_i$，保证 $x_i$ 严格递增。
## 输出格式

一个数字，表示 $\sum \limits_{i=1}^n i\times$ 炸弹 $i$ 能引爆的炸弹个数。
## 样例

### 样例输入 #1
```
4
1 1
5 1
6 5
15 15
```
### 样例输出 #1
```
32
```
## 提示

【数据范围】  
对于  $20\%$ 的数据： $n\leq 100$。

对于  $50\%$ 的数据： $n\leq 1000$。

对于  $80\%$ 的数据： $n\leq 100000$。

对于  $100\%$ 的数据： $1\le n\leq 500000$，$-10^{18}\leq x_{i}\leq 10^{18}$，$0\leq r_{i}\leq 2\times 10^{18}$。


---

---
title: "【模板】静态仙人掌"
layout: "post"
diff: 省选/NOI-
pid: P5236
tag: ['图论', '强连通分量', '仙人掌', '树链剖分']
---
# 【模板】静态仙人掌
## 题目背景

这是一道静态仙人掌(Block Forest Data Structure)的模板题。   
如果您不知道什么是仙人掌，那么此处给出无向仙人掌图的定义：  
>任意一条边至多只出现在一条简单回路的无向连通图称为仙人掌。
## 题目描述

给你一个有 $n$ 个点和 $m$ 条边的仙人掌图，和 $q$ 组询问  
每次询问两个点 $u,v$，求两点之间的最短路。

保证输入数据没有重边。
## 输入格式

第一行三个正整数 $n,m,q$，意义如题目描述。  
接下来 $m$ 行，每行三个正整数 $u,v,w$，表示 $u,v$ 之间有一条权值为 $w$ 的无向边。   
然后 $q$ 行，每行两个正整数 $u,v$，询问 $u$ 到 $v$ 的最短路。
## 输出格式

$q$ 行，每行一个正整数，对应一次询问的结果。
## 样例

### 样例输入 #1
```
9 10 2
1 2 1
1 4 1
3 4 1
2 3 1
3 7 1
7 8 2
7 9 2
1 5 3
1 6 4
5 6 1
1 9
5 7
```
### 样例输出 #1
```
5
6
```
### 样例输入 #2
```
9 10 3
1 2 1
2 3 1
2 4 4
3 4 2
4 5 1
5 6 1
6 7 2
7 8 2
8 9 4
5 9 2
1 9
5 8
3 4
```
### 样例输出 #2
```
7
5
2
```
## 提示

**样例1解释：**  
样例1中的仙人掌是这个样子的：  
![](https://cdn.luogu.com.cn/upload/pic/52854.png)   
询问有两个，分别是询问 $1\rightarrow 9$ 和 $5\rightarrow 7$ 的最短路  
显然答案分别为 $5$ 和 $6$。

**数据范围：**   
$1\le n,q \le 10000$      
$1\le m \le 20000$   
$1\le w \le 10^5$     

保证输入数据没有重边。

请注意时限为 $300\text{ms}$      



---

---
title: "「PMOI-2」城市"
layout: "post"
diff: 省选/NOI-
pid: P7422
tag: ['动态规划 DP', '线段树', 'O2优化', '强连通分量', '虚树']
---
# 「PMOI-2」城市
## 题目描述

P 国有 $N$ 座城市和 $M$ 条无向道路，其中 $1$ 号城市是首都，且任意两座城市都能通过道路互相到达。

现在 P 国要在首都召开 ION。为了建设比赛场地，每个城市都要向首都提供原材料，其中第 $i$ 座城市可以提供类型为 $c_i$ 的原材料。每座城市都会有货车从该城市出发，**沿简单路径**前往首都。如果从城市 $A$ 出发的货车必须经过城市 $B$ ，那么我们称城市 $B$ 在城市 $A$ 到首都的必经之路上。如果对于城市 $A,B,C$，从 $B$ 到 $A$ 的**任意简单路径**与 $C$ 到 $A$ 的**任意简单路径**没有公共边，那么我们称城市 $B$ 和城市 $C$ 关于城市 $A$ 互不影响。

记 $f(A,k)$ 为满足下列所有条件的 $k$ 元集合 $\{B_1,B_2,\cdots B_k\}$ 的个数：

1. 对于任意 $1\leq i \leq k$ 满足 $A\neq B_i$，**城市 $A$ 在城市 $B_i$ 到首都的必经之路上**且城市 $B_i$ 供应的材料与城市 $A$ **不同**。

2. 对于任意 $1\leq i < j \leq k$ 满足 **$B_i$ 与 $B_j$ 关于 $A$ 互不影响**，且 $B_i$ 和 $B_j$ 供应的原材料**相同**。

定义举办 ION 的吸引力为$\sum_{i=1}^N\sum_{k=1}^Kf(i,k)$，其中 $K$ 是给定的常数。

现在，你作为 P 国的首脑，你想要知道这次 ION 的吸引力。

**由于答案可能很大，所以请将答案对 $998244353$ 取模**。
## 输入格式

第一行三个整数 $N,M,K$。

第二行 $N$ 个整数，第 $i$ 个数第 $i$ 座城市供应的原材料类型 $c_i$。

接下来 $M$ 行，每行两个整数 $u,v$ ，表示 $P$ 国的一条道路。保证**没有重边，没有自环**。（$1\leq u, v \leq N, u\neq v$）
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
7 7 2
1 2 3 3 1 1 2
1 2
2 3
2 4
3 4
3 5
3 6
4 7
```
### 样例输出 #1
```
12
```
## 提示

【样例解释】

样例中 P 国的地图如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/vte597p4.png)

下表中，第 $i$ 行第 $j$ 列表示 $f(i,j)$。

| $4$ | $0$ | $0$ | $0$ |
| -----------: | -----------: | -----------: | -----------:
| $4$ | $0$ | $0$ | $0$ |
| $2$ | $1$ | $0$ | $0$ |
| $1$ | $0$ | $0$ | $0$ |

所以吸引力为 $4+4+2+1+1=12$。

【数据范围】

**本题采用捆绑测试**。

- Subtask1（10pts）：$N,K \le 8$；
- Subtask2（10pts）：$K=1$；
- Subtask3（15pts）：$K=2$；
- Subtask4（15pts）：保证图的形态为一棵树；
- Subtask5（15pts）：$N \le 2000$；
- Subtask6（15pts）：$N \le 4\times 10^4$；
- Subtask7（20pts）：无特殊限制。

对于 $100\%$ 的数据满足，$1\leq N\leq 5\times 10^5$， $1\leq M \leq \min(10^6,\frac{N\times(N-1)}{2})$，$1 \le K \le 20$，$1 \le c_i \le 10^9$。

**温馨提示**：输入量较大，请使用较快的读入方式。



---

---
title: "[NOIP2022] 建造军营"
layout: "post"
diff: 省选/NOI-
pid: P8867
tag: ['2022', 'NOIP 提高组', 'O2优化', '树形 DP', '强连通分量', 'Tarjan', '容斥原理']
---
# [NOIP2022] 建造军营
## 题目描述

A 国与 B 国正在激烈交战中，A 国打算在自己的国土上建造一些军营。

A 国的国土由 $n$ 座城市组成，$m$ 条双向道路连接这些城市，使得**任意两座城市均可通过道路直接或间接到达**。A 国打算选择一座或多座城市（**至少一座**），并在这些城市上各建造一座军营。

众所周知，军营之间的联络是十分重要的。然而此时 A 国接到情报，B 国将会于不久后袭击 A 国的一条道路，但具体的袭击目标却无从得知。如果 B 国袭击成功，这条道路将被切断，可能会造成 A 国某两个军营无法互相到达，这是 A 国极力避免的。因此 A 国决定派兵看守若干条道路（**可以是一条或多条，也可以一条也不看守**)，A 国有信心保证被派兵看守的道路能够抵御 B 国的袭击而不被切断。

A 国希望制定一个建造军营和看守道路的方案，使得 B 国袭击的无论是 A 国的哪条道路，都不会造成某两座军营无法互相到达。现在，请你帮 A 国计算一下可能的建造军营和看守道路的方案数共有多少。由于方案数可能会很多，你只需要输出其对 $1,000,000,007\left(10^{9}+7\right)$ 取模的值即可。两个方案被认为是不同的，当且仅当存在至少一 座城市在一个方案中建造了军营而在另一个方案中没有，或者存在至少一条道路在一个 方案中被派兵看守而在另一个方案中没有。

## 输入格式

第一行包含两个正整数 $n,m$，分别表示城市的个数和双向道路的数量。

接下来 $m$ 行，每行包含两个正整数 $u_{i},v_{i}$，描述一条连接 $u_{i}$ 和 $v_{i}$ 的双向道路。保证没有重边和自环。
## 输出格式

输出一行包含一个整数，表示建造军营和看守道路的方案数对 $1,000,000,007\left(10^{9}+ 7\right)$ 取模的结果。
## 样例

### 样例输入 #1
```
2 1
1 2
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4 4
1 2
2 3
3 1
1 4
```
### 样例输出 #2
```
184
```
### 样例输入 #3
```
见附加文件里的 barrack/barrack3.in
```
### 样例输出 #3
```
见附加文件里的 barrack/barrack3.ans
```
### 样例输入 #4
```
见附加文件里的 barrack/barrack4.in
```
### 样例输出 #4
```
见附加文件里的 barrack/barrack4.ans
```
## 提示

### 样例 1 解释

A 国有两座城市，一条道路连接他们。所有可能的方案如下：

- 在城市 $1$ 建军营, 不看守这条道路;
- 在城市 $1$ 建军营, 看守这条道路;
- 在城市 $2$ 建军营, 不看守这条道路;
- 在城市 $2$ 建军营, 看守这条道路;
- 在城市 $1,2$ 建军营, 看守这条道路。

### 数据规模与约定

对所有数据，保证 $1 \leq n \leq 5 \times 10^5$，$n - 1 \leq m \leq 10^6$，$1 \leq u_i, v_i \leq n$，$u_i \neq v_i$。

各测试点的信息如下

|测试点编号 | $n \leq $ | $m \leq $| 特殊条件 |
| :-: | :-: | :-: | :-: |
| $1 \sim 3$ | $8$ | $10$ | 无 |
| $4 \sim 7$ | $16$ | $25$ | 无 |
| $8 \sim 9$ | $3000$ | $5000$ | 无 |
| $10 \sim 11$ | $5 \times 10^5$ | $10^6$ | 特殊性质 $\mathrm{A}$ |
| $12 \sim 14$ | $5 \times 10^5$ | $10^6$ | $m = n - 1$ |
| $15 \sim 16$ |  $5 \times 10^5$ | $10^6$ | $m = n$ |
| $17 \sim 20$ | $5 \times 10^5$ | $10^6$ | 无 |

特殊性质 $\mathrm{A}$：保证 $m=n-1$ 且第 $i$ 条道路连接城市 $i$ 与 $i+1$。 


---

---
title: "邮箱题"
layout: "post"
diff: 省选/NOI-
pid: P9150
tag: ['图论', '洛谷原创', 'O2优化', '强连通分量', '洛谷月赛', '均摊分析']
---
# 邮箱题
## 题目背景

邮箱，一种历史悠久的接信箱子。西方的邮箱以红色为主，东方的邮箱以绿色为主。
## 题目描述

有一张 $n$ 个点和 $m$ 条边构成的**有向**图。每个点内都有一把另一个点的钥匙，$i$ 号点内有 $k_i$ 号点的钥匙。你能进入一个点当且仅当你有该点的钥匙。保证 $k_i$ 构成排列。

只要进入了一个点，就获得了这个点内有的钥匙。一旦获得钥匙就不会被消耗。

现在你拿到了 $i$ 号点的钥匙并到了 $i$ 号点。你需要对每个 $i$ 求出：

1. 有多少点能被你到达。
2. 有多少点能被你到达并返回起点 $i$。

**请注意：给出的边均是有向边！**
## 输入格式

**本题有多组数据。**

第一行，一个正整数 $T$，表示数据的组数。对于每组数据：

第一行，两个整数 $n,m$，表示图的点数和边数。

第二行，$n$ 个整数 $k_1, k_2, \ldots, k_n$，表示 $i$ 号点内有 $k_i$ 号点的钥匙。保证 $k_i$ 构成排列。

接下来 $m$ 行，每行两个整数 $x, y$，表示图上的一条从 $x$ 指向 $y$ 的有向边。保证不含重边或自环。
## 输出格式

对于每组数据，输出 $n$ 行，每行两个整数，第 $i$ 行的整数分别表示从 $i$ 号点出发，能到达的点数和能到达并返回起点的点数。
## 样例

### 样例输入 #1
```
3
4 5
2 3 4 1
1 2
2 3
3 1
1 4
4 3
5 6
2 3 4 5 1
1 2
2 3
3 4
4 5
5 2
4 1
3 2
2 3 1
1 2
1 3

```
### 样例输出 #1
```
4 4
2 1
1 1
1 1
5 5
5 5
3 1
2 1
1 1
2 1
1 1
1 1

```
## 提示

**【样例解释】**

以下是第一组数据的解释：（图中括号内的内容为点上的钥匙编号）

![](https://cdn.luogu.com.cn/upload/image_hosting/hrserkw2.png)

1. $1$ 能到达的结点集合为 $\{1,2,3,4\}$，$1$ 能到达且能返回 $1$ 的结点集合为 $\{1,2,3,4\}$；
2. $2$ 能到达的结点集合为 $\{2,3\}$，$2$ 能到达且能返回 $2$ 的结点集合为 $\{2\}$；
3. $3$ 能到达的结点集合为 $\{3\}$，$3$ 能到达且能返回 $3$ 的结点集合为 $\{3\}$；
4. $4$ 能到达的结点集合为 $\{4\}$，$4$ 能到达且能返回 $4$ 的结点集合为 $\{4\}$。

这是一个合法的遍历过程：从 $1$ 开始，初始钥匙为 $2$，到达结点 $2$ 并获得钥匙 $3$，到达结点 $3$ 并获得钥匙 $4$，回到结点 $1$，到达结点 $4$ 并获得钥匙 $1$，到达结点 $3$，回到结点 $1$。

**【数据范围】**

对于 $100\%$ 的数据，满足 $n \ge 3$，$m\ge 0$，$\sum n\le 1.5\times{10}^6$，$\sum m\le 3\times{10}^6$，$1 \le T\le 2\times{10}^4$，$1 \le x, y \le n$，保证图中不含重边或自环。

**本题采用捆绑测试且开启子任务依赖！**

|子任务|对 $n$ 的约束|对 $m$ 的约束|分值|依赖|
|-|-|-|-|-|
|1|$n\le 6$|$m\le 12$|$20$|\ |
|2|$\sum n^3\le {10}^7$|$\sum m^3\le 2\times {10}^7$|$25$|\ |
|3|$\sum n^2\le {10}^8$|$\sum m^2\le {10}^8$|$25$|子任务 1、2|
|4|||$30$|子任务 1、2、3|


---

---
title: "[GDCPC 2023] Canvas"
layout: "post"
diff: 省选/NOI-
pid: P9697
tag: ['图论', '2023', '广东', 'Special Judge', 'O2优化', '图论建模', '强连通分量', 'XCPC']
---
# [GDCPC 2023] Canvas
## 题目描述

There is a sequence of length $n$. At the beginning, all elements in the sequence equal to $0$. There are also $m$ operations, where the $i$-th operation will change the value of the $l_i$-th element in the sequence to $x_i$, and also change the value of the $r_i$-th element in the sequence to $y_i$. Each operation must be performed exactly once.

Find the optimal order to perform the operations, so that after all operations, the sum of all elements in the sequence is maximized.
## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$ indicating the number of test cases. For each test case:

The first line contains two integers $n$ and $m$ ($2 \leq n, m \leq 5 \times 10^5$) indicating the length of the sequence and the number of operations.

For the following $m$ lines, the $i$-th line contains four integers $l_i$, $x_i$, $r_i$ and $y_i$ ($1 \leq l_i<r_i \leq n$, $1 \leq x_i,y_i \leq 2$) indicating the $i$-th operation.

It's guaranteed that neither the sum of $n$ nor the sum of $m$ of all test cases will exceed $5 \times 10^5$.
## 输出格式

For each test case, first output one line containing one integer, indicating the maximum sum of all elements in the sequence after all operations. Then output another line containing $m$ integers $a_1, a_2, \cdots, a_m$ separated by a space, indicating the optimal order to perform the operations, where $a_i$ is the index of the $i$-th operation to be performed. Each integer from $1$ to $m$ (both inclusive) must appear exactly once. If there are multiple valid answers, you can output any of them.
## 样例

### 样例输入 #1
```
2
4 4
1 1 2 2
3 2 4 1
1 2 3 2
2 1 4 1
4 2
3 2 4 1
1 2 3 1
```
### 样例输出 #1
```
7
4 1 3 2
5
2 1
```
## 提示

For the first sample test case, after performing operations $4, 1, 3, 2$ in order, the sequence becomes $\{2, 2, 2, 1\}$. The sum of all elements is $7$.

For the second sample test case, after performing operations $2, 1$ in order, the sequence becomes $\{2, 0, 2, 1\}$. The sum of all elements is $5$.
## 题目翻译

**【题目描述】**

有一个长度为 $n$ 的序列，一开始序列中的所有元素均为 $0$。另外还有 $m$ 个操作，其中第 $i$ 个操作会将序列中第 $l_i$ 个元素的值改为 $x_i$，以及将序列中第 $r_i$ 个元素的值改为 $y_i$。每个操作必须恰好执行一次。

求执行操作的最优顺序，使得所有操作执行完成后，序列中所有元素之和最大。

**【输入格式】**

有多组测试数据。第一行输入一个整数 $T$ 表示测试数据组数。对于每组测试数据：

第一行输入两个整数 $n$ 和 $m$（$2 \leq n, m \leq 5 \times 10^5$）表示序列的长度和操作的个数。

对于接下来 $m$ 行，第 $i$ 行输入四个整数 $l_i$，$x_i$，$r_i$ 和 $y_i$（$1 \leq l_i<r_i \leq n$，$1 \leq x_i,y_i \leq 2$）表示第 $i$ 个操作。

保证所有数据 $n$ 之和与 $m$ 之和均不超过 $5 \times 10^5$。

**【输出格式】**

每组数据首先输出一行一个整数，表示执行操作后，所有元素的最大和。接下来输出一行 $m$ 个由单个空格分隔的整数 $a_1, a_2, \cdots, a_m$ 表示执行操作的最优顺序，其中 $a_i$ 表示第 $i$ 次执行的操作的编号。从 $1$ 到 $m$ 的每个整数（含两端）必须恰好出现一次。若有多种合法答案，您可以输出任意一种。

**【样例解释】**

对于第一组样例数据，按 $4, 1, 3, 2$ 的顺序执行操作后，序列变为 $\{2, 2, 2, 1\}$，元素之和为 $7$。

对于第二组样例数据，按 $2, 1$ 的顺序执行操作后，序列变为 $\{2, 0, 2, 1\}$，元素之和为 $5$。


---


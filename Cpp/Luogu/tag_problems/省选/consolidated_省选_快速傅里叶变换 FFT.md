---
title: "COUNTARI"
layout: "post"
diff: 省选/NOI-
pid: P10666
tag: ['O2优化', '分块', '快速傅里叶变换 FFT']
---
# COUNTARI
## 题目描述

给定一个长度为 $n$ 的数组 $a$，求有多少对 $i,j,k(1\leq i<j<k\leq n)$，满足 $a_k-a_j=a_j-a_i$。
## 输入格式

第一行一个整数 $n$，第二行 $n$ 个正整数 $a_i$。
## 输出格式

一行一个整数表示所求的结果。
## 样例

### 样例输入 #1
```
10
3 5 3 6 3 4 10 4 5 2
```
### 样例输出 #1
```
9
```
## 提示

数据保证，$1\leq n\leq 10^5$，$1\leq a_i\leq 3\times 10^4$。


---

---
title: "[蓝桥杯 2024 国研究生组] 生成树问题"
layout: "post"
diff: 省选/NOI-
pid: P12321
tag: ['2024', '快速傅里叶变换 FFT', '蓝桥杯国赛']
---
# [蓝桥杯 2024 国研究生组] 生成树问题
## 题目描述

给定 $n$ 个点，编号 $1$ 至 $n$，任意两点 $x, y$ 之间均有且仅有一条边。如果 $x \cdot y$ 为完全平方数（也即存在整数 $z$ 满足 $z^2 = x \cdot y$），那么其边权为 $1$，否则为 $0$。

小蓝想要得到一棵生成树，其除 $1$ 以外的每个点都有一个编号小于自己的点与其相邻。求小蓝想得到的所有生成树中，边权和为 $0$ 至 $n-1$ 的分别各有多少种，请输出答案对 $998244353$ 取模的结果。
## 输入格式

输入一行包含一个整数 $n$。
## 输出格式

输出 $n$ 行，每行包含一个整数，依次表示边权和为 $0 \sim n-1$ 的生成树种数。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
4
2
0
0
```
## 提示

### 评测用例规模与约定

- 对于 $60\%$ 的评测用例，$n \leq 5000$；
- 对于 $85\%$ 的评测用例，$n \leq 10^5$；

对于所有评测用例，$1 \leq n \leq 3 \times 10^5$。


---

---
title: "[NAC 2025] Popping Balloons"
layout: "post"
diff: 省选/NOI-
pid: P12629
tag: ['2025', '多项式', '分治', '快速傅里叶变换 FFT', 'ICPC', 'NAC']
---
# [NAC 2025] Popping Balloons
## 题目描述

The ICPC logo has three colors: blue, yellow, and red. The NAC volunteers have just inflated a huge number of balloons in these
colors and arranged them in a line. They next need to sort the balloons by color before they can give them out to contestants. 

Unfortunately, due to the Orlando heat, the balloons begin to randomly pop: each second, a random remaining balloon
pops (and the volunteers remove the debris from the line). This isn't all bad: maybe if the NAC volunteers wait long enough, the balloons will become sorted by chance? Compute the expected number of seconds until the first time that all blue balloons come before all yellow and red balloons, and all yellow balloons come before all red balloons. (These conditions are satisfied even if they are vacuously true: for example, if there are no blue balloons at all remaining, then it is true that all blue balloons come before all yellow and red balloons.)
## 输入格式

The input has one line: a string $s$ ($1\le |s|\le 2\cdot 10^5$) where each character is one of $\texttt{B}$, $\texttt{Y}$, or $\texttt{R}$ representing blue, yellow, and red respectively ---the colors of the initial balloons in the line.
## 输出格式

Print the expected number of seconds that elapse before the first time that all blue balloons come before all yellow
and red balloons, and all yellow balloons come before all red balloons. Since this number might not be an integer, print
 it modulo $998\, 244\, 353$.

Formally, let $p = 998\,244\,353$. It can be shown that the answer can be expressed as an irreducible fraction $\frac{a}{b}$, where $a$ and $b$ are non-negative integers and $b \not \equiv 0 \pmod{p}$. Print the integer $x$ with $0 \leq x < p$ and $x \equiv a \cdot b^{-1} \bmod p$.
## 样例

### 样例输入 #1
```
RYBB
```
### 样例输出 #1
```
831870297
```
### 样例输入 #2
```
YRBBR
```
### 样例输出 #2
```
598946615
```
## 提示

In Sample Input 1, the expected time until the balloon colors first become sorted in the correct order is $\frac {17}{6} = 2\cdot \frac{1}{6} + 3 \cdot \frac{5}{6}$ seconds:
the only way for the balloon colors to be sorted correctly after $2$ seconds is if the first two balloons to pop are the yellow and red balloon (in either order). The probability that these balloons pop before either blue balloon is $\frac{1}{6}$. Otherwise (with probability $\frac{5}{6}$) the balloon colors will automatically be sorted after $3$ seconds, when there is only one balloon left.
Since $6^{-1} \equiv 166\,374\,059\pmod {p}$, the answer is $17\cdot
166\,374\,059\equiv 831\,870\,297\pmod{p}$.


---

---
title: "【模板】高精度乘法 | A*B Problem 升级版"
layout: "post"
diff: 省选/NOI-
pid: P1919
tag: ['高精度', 'O2优化', '分治', '快速傅里叶变换 FFT']
---
# 【模板】高精度乘法 | A*B Problem 升级版
## 题目背景

本题数据已加强，请使用 FFT 或分治乘法。
## 题目描述

给你两个正整数 $a,b$，求 $a \times b$。
## 输入格式

第一行一个正整数，表示 $a$；  
第二行一个正整数，表示 $b$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
83517934
327830610

```
### 样例输出 #1
```
27379735249159740

```
## 提示

【数据范围】   
$1\le a,b \le 10^{1000000}$

可能需要一定程度的常数优化。  
数据由 NaCly_Fish 重造


---

---
title: "[SDOI2015] 序列统计"
layout: "post"
diff: 省选/NOI-
pid: P3321
tag: ['2015', '山东', '素数判断,质数,筛法', '快速傅里叶变换 FFT']
---
# [SDOI2015] 序列统计
## 题目描述

小C有一个集合 $S$，里面的元素都是小于 $m$ 的非负整数。他用程序编写了一个数列生成器，可以生成一个长度为 $n$ 的数列，数列中的每个数都属于集合 $S$。  

小C用这个生成器生成了许多这样的数列。但是小C有一个问题需要你的帮助：给定整数 $x$，求所有可以生成出的，且满足数列中所有数的乘积 $\bmod \ m$ 的值等于 $x$ 的不同的数列的有多少个。  

小C认为，两个数列 $A$ 和 $B$ 不同，当且仅当 $\exists i \text{ s.t. } A_i \neq B_i$。另外，小C认为这个问题的答案可能很大，因此他只需要你帮助他求出答案对 $1004535809$ 取模的值就可以了。

## 输入格式

一行，四个整数，$n,m,x,|S|$，其中 $|S|$ 为集合 $S$ 中元素个数。  
第二行，$|S|$ 个整数，表示集合 $S$ 中的所有元素。

## 输出格式

一行一个整数表示答案。

## 样例

### 样例输入 #1
```
4 3 1 2
1 2
```
### 样例输出 #1
```
8
```
## 提示

【样例说明】

可以生成的满足要求的不同的数列有(1,1,1,1)、(1,1,2,2)、(1,2,1,2)、(1,2,2,1)、(2,1,1,2)、(2,1,2,1)、(2,2,1,1)、(2,2,2,2)。

【数据规模和约定】

对于 $10\%$ 的数据，$1\le n \le 1000$；   
对于 $30\%$ 的数据，$3 \le m \le 100$；    
对于 $60\%$ 的数据，$3 \le m \le 800$；   
对于 $100\%$ 的数据，$1 \le n \le 10^9$，$3 \le m \le 8000$，$1\le x < m$。   
$m$ 为质数，输入数据保证集合 $S$ 中元素不重复。



---

---
title: "[ZJOI2014] 力"
layout: "post"
diff: 省选/NOI-
pid: P3338
tag: ['数学', '2014', '浙江', 'Special Judge', '快速傅里叶变换 FFT']
---
# [ZJOI2014] 力
## 题目描述

给出 $n$ 个数 $q_1,q_2, \dots q_n$，定义

$$F_j~=~\sum_{i = 1}^{j - 1} \frac{q_i \times q_j}{(i - j)^2}~-~\sum_{i = j + 1}^{n} \frac{q_i \times q_j}{(i - j)^2}$$

$$E_i~=~\frac{F_i}{q_i}$$

对 $1 \leq i \leq n$，求 $E_i$ 的值。

## 输入格式

第一行输入一个整数 $n$。

以下 $n$ 行，每行有一个实数。第 $i+1$ 行的数代表 $q_i$。

## 输出格式

输出 $n$ 行每行一个实数，第 $i$ 行的数字代表 $E_i$。

当你的输出与标准答案相差不超过 $10^{-2}$ 时即被认为正确。
## 样例

### 样例输入 #1
```
5
4006373.885184
15375036.435759
1717456.469144
8514941.004912
1410681.345880
```
### 样例输出 #1
```
-16838672.693
3439.793
7509018.566
4595686.886
10903040.872
```
## 提示

【数据范围】   
对于 $30\%$ 的数据，$n \leq 1000$；   
对于 $50\%$ 的数据，$n \leq 6 \times 10^4$；   
对于 $100\%$ 的数据，$1 \leq n \leq 10^5$，$0 < q_i < 10^9$。


---

---
title: "[AH2017/HNOI2017] 礼物"
layout: "post"
diff: 省选/NOI-
pid: P3723
tag: ['2017', '各省省选', '递归', '安徽', '湖南', '进制', '快速傅里叶变换 FFT']
---
# [AH2017/HNOI2017] 礼物
## 题目描述

我的室友最近喜欢上了一个可爱的小女生。马上就要到她的生日了，他决定买一对情侣手环，一个留给自己，一个送给她。每个手环上各有 $n$ 个装饰物，并且每个装饰物都有一定的亮度。

但是在她生日的前一天，我的室友突然发现他好像拿错了一个手环，而且已经没时间去更换它了！他只能使用一种特殊的方法，将其中一个手环中所有装饰物的亮度增加一个相同的非负整数 $c$。并且由于这个手环是一个圆，可以以任意的角度旋转它，但是由于上面装饰物的方向是固定的，所以手环不能翻转。需要在经过亮度改造和旋转之后，使得两个手环的差异值最小。

在将两个手环旋转且装饰物对齐了之后，从对齐的某个位置开始逆时针方向对装饰物编号 $1 \sim n$，其中 $n$ 为每个手环的装饰物个数， 第 $1$ 个手环的 $i$ 号位置装饰物亮度为 $x_i$，第 $2$ 个手环的 $i$ 号位置装饰物亮度为 $y_i$，两个手环之间的差异值为（参见输入输出样例和样例解释）：

$$\sum_{i=1}^{n} (x_i-y_i)^2$$

麻烦你帮他计算一下，进行调整（亮度改造和旋转），使得两个手环之间的差异值最小，这个最小值是多少呢？

## 输入格式

输入数据的第一行有两个数 $n,m$，代表每条手环的装饰物的数量为 $n$，每个装饰物的初始亮度小于等于 $m$。

接下来两行，每行各有 $n$ 个数，分别代表第一条手环和第二条手环上从某个位置开始逆时针方向上各装饰物的亮度。

## 输出格式

输出一个数，表示两个手环能产生的最小差异值。注意在将手环改造之后，装饰物的亮度可以大于 $m$。

## 样例

### 样例输入 #1
```
5 6
1 2 3 4 5
6 3 3 4 5
```
### 样例输出 #1
```
1
```
## 提示

【样例解释】

需要将第一个手环的亮度增加 $1$，第一个手环的亮度变为：$2,3,4,5,6$

旋转一下第二个手环。对于该样例，是将第二个手环的亮度 $6,3,3,4,5$ 向左循环移动一个位置，使得第二手环的最终的亮度为：$3,3,4,5,6$。

此时两个手环的亮度差异值为 $1$。

【数据范围】

对于 $30\%$ 的数据，$n \le 500$，$m \le 10$；

对于 $70\%$ 的数据，$n \le 5000$；

对于 $100\%$ 的数据，$1 \le n \le 50000$, $1 \le a_i \le m \le 100$。



---

---
title: "[TJOI2017] DNA"
layout: "post"
diff: 省选/NOI-
pid: P3763
tag: ['2017', '各省省选', '后缀数组 SA', '快速傅里叶变换 FFT', '天津']
---
# [TJOI2017] DNA
## 题目描述

加里敦大学的生物研究所，发现了决定人喜不喜欢吃藕的基因序列 $S$,有这个序列的碱基序列就会表现出喜欢吃藕的性状，但是研究人员发现对碱基序列 $S$，任意修改其中不超过 $3$ 个碱基，依然能够表现出吃藕的性状。现在研究人员想知道这个基因在 DNA 链 $S_0$ 上的位置。所以你需要统计在一个表现出吃藕性状的人的 DNA 序列 $S_0$ 上，有多少个连续子串可能是该基因，即有多少个 $S_0$ 的连续子串修改小于等于三个字母能够变成 $S$。

## 输入格式

第一行有一个整数 $T$，表示有几组数据。

每组数据第一行一个长度不超过 $10^5$ 的碱基序列 $S_0$。

每组数据第二行一个长度不超过 $10^5$ 的吃藕基因序列 $S$。

## 输出格式

共 $T$ 行，第 $i$ 行表示第 $i$ 组数据中，在 $S_0$中有多少个与 $S$ 等长的连续子串可能是表现吃藕性状的碱基序列。

## 样例

### 样例输入 #1
```
1
ATCGCCCTA
CTTCA
```
### 样例输出 #1
```
2
```
## 提示

对于 $20\%$ 的数据，$S_0,S$ 的长度不超过 $10^4$。

对于 $100\%$ 的数据，$S_0,S$ 的长度不超过 $10^5$，$0\lt T\leq 10$。

注：DNA 碱基序列只有 ATCG 四种字符。


---

---
title: "【模板】多项式乘法（FFT）"
layout: "post"
diff: 省选/NOI-
pid: P3803
tag: ['递归', 'O2优化', '向量', '快速傅里叶变换 FFT']
---
# 【模板】多项式乘法（FFT）
## 题目背景

这是一道多项式乘法模板题。

注意：本题并不属于中国计算机学会划定的提高组知识点考察范围。


## 题目描述

给定一个 $n$ 次多项式 $F(x)$，和一个 $m$ 次多项式 $G(x)$。

请求出 $F(x)$ 和 $G(x)$ 的卷积。

## 输入格式

第一行两个整数 $n,m$。

接下来一行 $n+1$ 个数字，从低到高表示 $F(x)$ 的系数。

接下来一行 $m+1$ 个数字，从低到高表示 $G(x)$ 的系数。

## 输出格式

一行 $n+m+1$ 个数字，从低到高表示 $F(x) \cdot G(x)$ 的系数。

## 样例

### 样例输入 #1
```
1 2
1 2
1 2 1
```
### 样例输出 #1
```
1 4 5 2
```
## 提示

保证输入中的系数大于等于 $0$ 且小于等于 $9$。

对于 $100\%$ 的数据：$1 \le n, m \leq {10}^6$。


---

---
title: "残缺的字符串"
layout: "post"
diff: 省选/NOI-
pid: P4173
tag: ['字符串', '数学', 'KMP 算法', '快速傅里叶变换 FFT']
---
# 残缺的字符串
## 题目描述

很久很久以前，在你刚刚学习字符串匹配的时候，有两个仅包含小写字母的字符串 $A$ 和 $B$，其中 $A$ 串长度为 $m$，$B$ 串长度为 $n$。可当你现在再次碰到这两个串时，这两个串已经老化了，每个串都有不同程度的残缺。

你想对这两个串重新进行匹配，其中 $A$ 为模板串，那么现在问题来了，请回答，对于 $B$ 的每一个位置 $i$，从这个位置开始连续 $m$ 个字符形成的子串是否可能与 $A$ 串完全匹配？
## 输入格式

第一行包含两个正整数 $m,n$，分别表示 $A$ 串和 $B$ 串的长度。

第二行为一个长度为 $m$ 的字符串 $A$。

第三行为一个长度为 $n$ 的字符串 $B$。

两个串均仅由小写字母和 $\texttt *$ 组成，其中 $\texttt *$ 表示相应位置已经残缺。
## 输出格式

第一行包含一个整数 $k$，表示 $B$ 串中可以完全匹配 $A$ 串的位置个数。

若 $k>0$，则第二行输出 $k$ 个正整数，从小到大依次输出每个可以匹配的开头位置（下标从 $1$ 开始）。
## 样例

### 样例输入 #1
```
3 7
a*b
aebr*ob
```
### 样例输出 #1
```
2
1 5
```
## 提示

$100\%$ 的数据满足 $1 \le m \le n \le 3 \times 10^5$。


---

---
title: "万径人踪灭"
layout: "post"
diff: 省选/NOI-
pid: P4199
tag: ['字符串', '枚举', '快速傅里叶变换 FFT']
---
# 万径人踪灭
## 题目背景

保先生是个好司机，总是开车带学生们上山玩。但是保先生去年开了最后一趟车后，由于一些奇奇怪怪的原因转行了。半年间，再也没有从这条路上山的人了。

当 VFleaKing 再次来到这座山玩的时候，发现已经没有往日的来来往往的游人了。算了，过去保先生还在的时候，来山上玩的人，也不全是来欣赏山上的风景的。
## 题目描述

如果机房马上要关门了，或者你急着要走，请直接跳到第六个自然段。

VFleaKing 注意到了这条上山下山的土路，有些地方能欣赏到美景，有些地方则不能。把上山的道路每 $10$ cm 分为一小段，则对于每一小段，用 `a` 表示能欣赏到美景，用 `b` 表示不能欣赏到美景，就能得到一个只含 `a`、`b` 的字符串 $s$。当然由于下山和上山是一条路，所以下山的道路的字符串就是将上山的道路的字符串反过来。

设上山字符串长度为 $n$，每个字符依次为 $s_1, s_2 .…, s_n$。在上山和下山的路上，VFleaKing 会选择某些小段查看旁边的景色，其他时间低头走路。即 VFleaKing 会选择 $k$ 个小段 $x_1, x_2 …x_k$，且 $k >0$，$1\le x_1<x_2<…<x_k\le n$，VFleaKing 上山和下山的过程中会在这些地方查看景色。

![](https://cdn.luogu.com.cn/upload/image_hosting/t9qpo3f9.png)

VFleaKing 希望，上山下山时看到的美景的情况相同。也就是说，VFleaKing 上山时是否看到了美景的情况是： $s_{x_1},s_{x_2},\cdots,s_{x_k}$ 记为字符序列 $T_1$，下山时是否看到了美景的情况是：$s_{x_k},s_{x_{k-1}},\cdots,s_{x_1}$ 记为字符序列 $T_2$。VFleaKing 希望 $T_1=T_2$。

VFleaKing 还希望，上山下山时查看景色的间隔相等。也就是说，上山时查看景色的间隔为：$x_2-x_1,x_3-x_2,x_k-x_{k-1}$，记为数列 $P_1$。下山时查看景色的间隔为：$x_k-x_{k-1},x_{k-1}-x_{k-2},…,x_2-x_1$，记为数列 $P_2$。VFleaKing 希望 $P_1=P_2$。

VFleaKing 觉得，如果第一次查看景色和最后一次查看景色这段时间里，没有一次低头看路他就会摔倒。也就是说，如果对于所有 $1\le i\le k$ 都有$x_i=x_1+i- 1$，VFleaKing 就会摔倒，VFleaKing不希望发生这样的情况。

就是要在一个只含 `a`、`b` 的字符串中选取一个子序列，使得:

1. 位置和字符都关于某条对称轴对称。
2. 不能是连续的一段。

以 $s = \texttt{"abaaaaabbabbabaa"}$ 为例。如果我们用符号 $[a_1, a_2,…,a_k]$ 表示一个序列，那么 $[1,4]$ 就是一个合法的序列 $x$，$[5,8,10,12,15]$ 也是，$[4,5,8,9,10,11,12,15,16]$ 也是。但是 $[1,2]$ 不满足 VFleaKing 第一个希望和第三个希望，所以不是。$[1,2,4]$ 不满足第二个希望，所以不是。$[9,10,11]$ 不满足第三个希望，所以不是。

![](https://cdn.luogu.com.cn/upload/image_hosting/6849dqla.png)

给你字符串 $s$，现在 VFleaKing 想知道，有多少个合法的 $x$。答案可能很大，VFleaKing 想知道对 $1000000007$ 取模的值。
## 输入格式

一行，一个只包含 `a`、`b` 的两种字符的字符串。
## 输出格式

一行，一个非负整数表示问题的答案。
## 样例

### 样例输入 #1
```
abaabaa
```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
aaabbbaaa
```
### 样例输出 #2
```
44
```
### 样例输入 #3
```
aaaaaaaa
```
### 样例输出 #3
```
53
```
## 提示

## 样例解释

### 样例解释 1

$14$ 个方案分别是：

- $[1,3]$，$[1,4]$，$[2,5]$，$[1,6]$，$[3,6]$，$[4,6]$，$[1,7]$，$[3,7]$，$[4,7]$；
- $[1,4,7]$，$[3,5,7]$；
- $[1,3,4,6]$，$[1,2,5,6]$，$[3,4,6,7]$。

### 样例解释 2

我已经想到了一个绝妙的解释，可惜方案太多，写不下了。

### 样例解释 3

我已经想到了一个绝妙的解释，可惜方案太多，写不下了。

## 数据范围

- 其中 $10\%$ 的数据，字符串仅包含字母 `a` 或字母 `b`。
- 另有 $20\%$ 的数据，$n\le 1000$。
- 另有 $20\%$ 的数据，要么 `a` 的个数不超过 $10$，要么 `a` 的个数不超过 $10$。
- 另有 $10\%$ 的数据，$n\le 10000$。
- 对于 $100\%$ 的数据，$n \le 100000$。

## 来源

- 2013 湖北互测 week1
- bzoj 3160
- 信息学奥赛之数学一本通
- stong9070 整理




---

---
title: "【模板】多项式乘法逆"
layout: "post"
diff: 省选/NOI-
pid: P4238
tag: ['数学', '递推', '倍增', '递归', '逆元', '快速傅里叶变换 FFT']
---
# 【模板】多项式乘法逆
## 题目背景

注意：本题并不属于中国计算机学会划定的提高组知识点考察范围。
## 题目描述

给定一个多项式 $F(x)$ ，请求出一个多项式 $G(x)$， 满足 $F(x) * G(x) \equiv 1 \pmod{x^n}$。系数对 $998244353$ 取模。


## 输入格式

首先输入一个整数 $n$， 表示输入多项式的项数。  
接着输入 $n$ 个整数，第 $i$ 个整数 $a_i$ 代表 $F(x)$ 次数为 $i-1$ 的项的系数。  
## 输出格式

输出 $n$ 个数字，第 $i$ 个整数 $b_i$ 代表 $G(x)$ 次数为 $i-1$ 的项的系数。保证有解。
## 样例

### 样例输入 #1
```
5
1 6 3 4 9
```
### 样例输出 #1
```
1 998244347 33 998244169 1020
```
## 提示

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$，$ 0 \leq a_i \leq 10^9$。


---

---
title: "任意模数多项式乘法逆"
layout: "post"
diff: 省选/NOI-
pid: P4239
tag: ['数学', '快速傅里叶变换 FFT']
---
# 任意模数多项式乘法逆
## 题目描述

给定一个多项式 $F(x)$ ，请求出一个多项式 $G(x)$ ， 满足 $F(x) * G(x) \equiv 1 ( \mathrm{mod\:} x^n )$
 。系数对 $10^9+7$ 取模。
## 输入格式

首先输入一个整数 $n$， 表示输入 $F(x)$ 为 $n-1$ 次。   
接着输入 $n$ 个整数，第 $i$ 个整数 $a_i$ 代表 $F(x)$ 次数为 $i-1$ 项的系数。  
## 输出格式

输出 $n$ 个数字，第 $i$ 个整数 $b_i$ 代表 $G(x)$ 次数为 $i-1$ 的项的系数。  
## 样例

### 样例输入 #1
```
5
1 6 3 4 9
```
### 样例输出 #1
```
1 1000000001 33 999999823 1020
```
## 提示

$1 \leq n \leq 10^5$，$0 \leq a_i \leq 10^9$。


---

---
title: "【模板】任意模数多项式乘法"
layout: "post"
diff: 省选/NOI-
pid: P4245
tag: ['数学', 'O2优化', '素数判断,质数,筛法', '中国剩余定理 CRT', '快速傅里叶变换 FFT']
---
# 【模板】任意模数多项式乘法
## 题目背景

模板题，无背景
## 题目描述

给定 $2$ 个多项式 $F(x), G(x)$ ，请求出 $F(x) * G(x)$。    

**系数对 $p$ 取模**，且**不保证** $p$ 可以分解成 $p = a \cdot 2^k + 1$ 之形式。
## 输入格式

输入共 $3$ 行。   
第一行 $3$ 个整数 $n, m, p$，分别表示 $F(x), G(x)$ 的次数以及模数 $p$ 。   
第二行为 $n+1$ 个整数，第 $i$ 个整数 $a_i$ 表示 $F(x)$ 的 $i-1$ 次项的系数。   
第三行为 $m+1$ 个整数，第 $i$ 个整数 $b_i$ 表示 $G(x)$ 的 $i-1$ 次项的系数。

## 输出格式

输出 $n+m+1$ 个整数， 第 $i$ 个整数 $c_i$ 表示 $F(x) * G(x)$ 的 $i-1$ 次项的系数。
## 样例

### 样例输入 #1
```
5 8 28
19 32 0 182 99 95
77 54 15 3 98 66 21 20 38
```
### 样例输出 #1
```
7 18 25 19 5 13 12 2 9 22 5 27 6 26
```
## 提示

对于 $100 \%$ 的数据，$1 \leq n, m \leq 10^5$，$0 \leq a_i, b_i \leq 10^9$，$2 \leq p \leq 10^9 + 9$。


---

---
title: "付公主的背包"
layout: "post"
diff: 省选/NOI-
pid: P4389
tag: ['数学', 'O2优化', '背包 DP', '生成函数', '快速傅里叶变换 FFT']
---
# 付公主的背包
## 题目背景

付公主有一个可爱的背包qwq


## 题目描述

这个背包最多可以装 $10^5$ 大小的东西

付公主有 $n$ 种商品，她要准备出摊了

每种商品体积为 $v_i$，都有无限件

给定 $m$，对于 $s\in [1,m]$，请你回答用这些商品恰好装 $s$ 体积的方案数

## 输入格式

第一行两个正整数 $n,m$。
第二行 $n$ 个正整数，表示每种商品的体积。

## 输出格式

输出 $m$ 行，第 $i$ 行代表 $s=i$ 时方案数，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
2 4
1 2
```
### 样例输出 #1
```
1
2
2
3
```
## 提示

【数据范围】  
对于 $30\%$ 的数据，$1\le n,m \le 3000$；  
对于 $60\%$ 的数据，纯随机生成；   
对于 $100\%$ 的数据， $1\le n,m \le 10^5$，$1\le v_i \le m$。


---

---
title: "[CQOI2018] 九连环"
layout: "post"
diff: 省选/NOI-
pid: P4461
tag: ['搜索', '2018', '重庆', '各省省选', '快速傅里叶变换 FFT']
---
# [CQOI2018] 九连环
## 题目背景

九连环是一种源于中国的传统智力游戏。如图所示，九个的圆环套在一把“剑”上，并且互相牵连。游戏的目标是把九个圆环全部从“剑”上卸下。

![](https://cdn.luogu.com.cn/upload/pic/17568.png)
## 题目描述

圆环的装卸需要遵守两个规则:

1. 第一个(最右边) 环任何时候都可以任意装上或卸下

2. 如果第k 个环没有被卸下，且第k 个环右边的所有环都被卸下，则第k+1个环(第k 个环左边相邻的环) 可以任意装上或卸下

与魔方的千变万化不同，解九连环的最优策略是唯一的。为简单起见，我们以“四连环”为例，演示这一过程。这里用1表示环在“剑”上，0 表示环已经卸下。

初始状态为1111,每步的操作如下:

1. 1101 (根据规则2,卸下第2 个环)

2. 1100 (根据规则1,卸下第1 个环)

3. 0100 (根据规则2,卸下第4 个环)

4. 0101 (根据规则1,装上第1 个环)

5. 0111 (根据规则2,装上第2 个环)

6. 0110 (根据规则1,卸下第1 个环)

7. 0010 (根据规则2,卸下第3 个环)

8. 0011 (根据规则1,装上第1 个环)

9. 0001 (根据规则2,卸下第2 个环)

10. 0000 (根据规则1,卸下第1 个环)

由此可见，卸下“四连环”至少需要10 步。随着环数增加，需要的步数也会随之增多。例如卸下九连环，就至少需要341步。

请你计算，有n 个环的情况下，按照规则，  全部卸下至少需要多少步。
## 输入格式

输入文件第一行，为一个整数m，表示测试点数目。

接下来m行，每行一个整数n。
## 输出格式

输出文件共m行，对应每个测试点的计算结果。
## 样例

### 样例输入 #1
```
3
3
5
9
```
### 样例输出 #1
```
5
21
341
```
## 提示

对于10%的数据，$1≤n≤10$

对于30%的数据，$1≤n≤30$

对于100%的数据，$1≤n≤10^5,1≤m≤10$


---

---
title: "【模板】分治 FFT"
layout: "post"
diff: 省选/NOI-
pid: P4721
tag: ['分治', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】分治 FFT
## 题目背景

也可用多项式求逆解决。
## 题目描述

给定序列 $g_{1\dots n - 1}$，求序列 $f_{0\dots n - 1}$。

其中 $f_i=\sum_{j=1}^if_{i-j}g_j$，边界为 $f_0=1$。

答案对 $998244353$ 取模。
## 输入格式

第一行一个整数 $n$ 。

第二行 $n-1$ 个整数 $g_{1\dots n - 1}$。
## 输出格式

一行 $n$ 个整数，表示 $f_{0\dots n - 1}$ 对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
4
3 1 2
```
### 样例输出 #1
```
1 3 10 35
```
### 样例输入 #2
```
10
2 456 32 13524543 998244352 0 1231 634544 51
```
### 样例输出 #2
```
1 2 460 1864 13738095 55389979 617768468 234028967 673827961 708520894
```
## 提示

$2\leq n\leq 10^5$，$0\leq g_i<998244353$。


---

---
title: "【模板】多项式对数函数（多项式 ln）"
layout: "post"
diff: 省选/NOI-
pid: P4725
tag: ['数学', '洛谷原创', 'O2优化', '导数', '积分', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式对数函数（多项式 ln）
## 题目描述

给出 $n-1$ 次多项式 $A(x)$，求一个 $\bmod{\:x^n}$ 下的多项式 $B(x)$，满足 $B(x) \equiv \ln A(x)$.

在  $\text{mod } 998244353$  下进行，且 $a_i \in [0, 998244353) \cap \mathbb{Z}$
## 输入格式

第一行一个整数 $n$.

下一行有 $n$ 个整数，依次表示多项式的系数 $a_0, a_1, \cdots, a_{n-1}$.

保证 $a_0 = 1$.
## 输出格式

输出 $n$ 个整数，表示答案多项式中的系数 $a_0, a_1, \cdots, a_{n-1}$.
## 样例

### 样例输入 #1
```
6
1 927384623 878326372 3882 273455637 998233543
```
### 样例输出 #1
```
0 927384623 817976920 427326948 149643566 610586717
```
## 提示

对于 $100\%$ 的数据，$n \le 10^5$.


---

---
title: "【模板】多项式指数函数（多项式 exp）"
layout: "post"
diff: 省选/NOI-
pid: P4726
tag: ['倍增', '递归', 'O2优化', '快速傅里叶变换 FFT', '构造']
---
# 【模板】多项式指数函数（多项式 exp）
## 题目描述

给出 $n-1$ 次多项式 $A(x)$，求一个 $\bmod{\:x^n}$ 下的多项式 $B(x)$，满足 $B(x) \equiv \text e^{A(x)}$。系数对 $998244353$ 取模。
## 输入格式

第一行一个整数 $n$.

下一行有 $n$ 个整数，依次表示多项式的系数 $a_0, a_1, \cdots, a_{n-1}$.

保证 $a_0 = 0$.
## 输出格式

输出 $n$ 个整数，表示答案多项式中的系数 $a_0, a_1, \cdots, a_{n-1}$.
## 样例

### 样例输入 #1
```
6
0 927384623 817976920 427326948 149643566 610586717
```
### 样例输出 #1
```
1 927384623 878326372 3882 273455637 998233543
```
## 提示

对于 $100\%$ 的数据，$n \le 10^5$.


---

---
title: "[集训队作业2013] 城市规划"
layout: "post"
diff: 省选/NOI-
pid: P4841
tag: ['数学', '2013', '集训队互测', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [集训队作业2013] 城市规划
## 题目描述

刚刚解决完电力网络的问题，阿狸又被领导的任务给难住了。

刚才说过，阿狸的国家有 $n$ 个城市，现在国家需要在某些城市对之间建立一些贸易路线，使得整个国家的任意两个城市都直接或间接的连通。

为了省钱, 每两个城市之间最多只能有一条直接的贸易路径。对于两个建立路线的方案，如果存在一个城市对，在两个方案中是否建立路线不一样，那么这两个方案就是不同的，否则就是相同的。现在你需要求出一共有多少不同的方案。

好了，这就是困扰阿狸的问题。换句话说，你需要求出 $n$ 个点的简单 (无重边无自环) 有标号无向连通图数目。

由于这个数字可能非常大, 你只需要输出方案数对 $1004535809$ ( $479 \times 2 ^{21} + 1$ ) 取模即可。
## 输入格式

仅一行一个整数 $n$
## 输出格式

仅一行一个整数，为方案数 $\bmod \space 1004535809$。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
38
```
### 样例输入 #3
```
100000
```
### 样例输出 #3
```
829847355

```
## 提示

【数据范围】   
对于 $20\%$ 的数据，$n \le 10$    
对于 $40\%$ 的数据，$n \le 1000$     
对于 $60\%$ 的数据，$n \le 30000$    
对于 $80\%$ 的数据，$n \le 60000$     
对于 $100\%$ 的数据，$n \le 130000$   

试题来源：$2013$ 中国国家集训队第二次作业


---

---
title: "逃离"
layout: "post"
diff: 省选/NOI-
pid: P4986
tag: ['数学', 'Special Judge', 'O2优化', '导数', '快速傅里叶变换 FFT']
---
# 逃离
## 题目背景

$\ \rm Althen\ $和$\ \rm hdxrie\ $掉入了二维空间。
## 题目描述

其实这个空间并不是无限的，而是半径有限的圆盘。

起初，他们两个都在圆心处，为了找到出口，他们两个决定分开行动，只要找到出口，便会离开。不过，若是其中一个人找到了出口，另一个还在二维空间内，那么这个空间就会因为不平衡而崩塌。所以他们两个只能一起离开。

其中：
- $\rm Althen\ $ 可以拐弯，还会一直拐来拐去，不过只能水平或者竖直移动。
- $\rm hdxrie\ $ 只能沿任意一条直线走，不能拐弯。

$\rm Althen\ $ 全程在水平向右的平均速度可以用函数 $A(x)$ 表示，在竖直向上的平均速度可以用函数 $B(x)$ 表示。$\rm hdxrie\ $ 全程移动的平均速度可以用函数 $C(x)$ 表示。而参数 $x$的取值范围也有讲究，为 $[L,R]$。

现在，他们两个想问你，他们有可能一起离开这个二维空间吗？如果可以，这个参数 $x$ 的值可以是多少？


## 输入格式

输入共四行。

第一行三个整数：$La$，$Lb$，$Lc$，和两个实数：$L$，$R$；
分别代表三个函数的长度和参数 $x$ 的取值范围。

第二行 $\ La+1\ $ 个整数，按升幂表示 $A(x)$ 的系数。  
第二行 $\ Lb+1\ $ 个整数，按升幂表示 $B(x)$ 的系数。  
第二行 $\ Lc+1\ $ 个整数，按升幂表示 $C(x)$ 的系数。

## 输出格式

若有解，输出一行一个实数表示答案；否则输出 `Inconsistent!`。
## 样例

### 样例输入 #1
```
1 1 1 -2.00 0.50 
1 2 
1 3 
4 1 

```
### 样例输出 #1
```
-1.16666667
```
### 样例输入 #2
```
1 1 1 -1.00 0.50 
1 2 
1 3 
4 1 

```
### 样例输出 #2
```
Inconsistent!
```
## 提示

【数据范围】   
对于$10\%$的数据，$L=R$；  
另有$20\%$的数据，$La=Lb=Lc=1$；  
另有$30\%$的数据，$[L,R]$ 内最多只有一个参数 $x$ 合法；  
对于$100\%$的数据，$0≤La,Lb,Lc≤10^5$，$0≤a_i,b_i,c_i≤9$，$L≤R$，$|L|,|R|≤3$；  

答案精确度需要保证带入原来的三个函数，合法误差不超过 $10^{-5}$，误差若是大于 $10^{-5}$ 会判断为错误答案，建议输出 **保留八位以上小数**。

###### $\color{#EEE}{\tt {Notice\ that\ SPEED\ is\ VECTOR.(High\ school\ physics)}}$


---

---
title: "【模板】多项式开根"
layout: "post"
diff: 省选/NOI-
pid: P5205
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式开根
## 题目背景

模板题，无背景
## 题目描述

给定一个 $n-1$ 次多项式 $A(x)$，求一个在 ${} \bmod x^n$ 意义下的多项式 $B(x)$，使得 $B^2(x) \equiv A(x) \pmod{x^n}$。若有多解，请取零次项系数较小的作为答案。

多项式的系数在 ${}\bmod 998244353$ 的意义下进行运算。
## 输入格式

第一行一个正整数 $n$。

接下来 $n$ 个整数，依次表示多项式的系数 $a_0, a_1, \dots, a_{n-1}$。

保证 $a_0 = 1$。
## 输出格式

输出 $n$ 个整数，表示答案多项式的系数 $b_0, b_1, \dots, b_{n-1}$。
## 样例

### 样例输入 #1
```
3
1 2 1

```
### 样例输出 #1
```
1 1 0

```
### 样例输入 #2
```
7
1 8596489 489489 4894 1564 489 35789489  

```
### 样例输出 #2
```
1 503420421 924499237 13354513 217017417 707895465 411020414

```
## 提示

对于 $100 \%$ 的数据：$1 \le n \leq 10^5$，$0 \le a_i < 998244353$。


---

---
title: "【模板】多项式开根（加强版）"
layout: "post"
diff: 省选/NOI-
pid: P5277
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式开根（加强版）
## 题目背景

模板题，无背景
## 题目描述

给定一个 $n-1$ 次多项式 $A(x)$ ，求一个在 $\bmod\ {x^n}$ 意义下的多项式 $B(x)$ ，使得 $B^2(x)\equiv A(x)\pmod {x^n}$。

多项式的系数在 $\bmod\ 998244353$ 的意义下进行运算。
## 输入格式

第一行一个正整数$n$。

接下来$n$个整数，依次表示多项式的系数$a_0,a_1,\cdots ,a_{n-1}$

**不保证$a_0=1$，但保证$a_0$是$\bmod\ 998244353$下的二次剩余。**
## 输出格式

输出 $n$ 个非负整数，表示答案多项式的系数$b_0,b_1\cdots ,b_{n-1}$。如有多解，输出**系数序列**（而非字符序列）字典序最小的。
## 样例

### 样例输入 #1
```
3
1 2 1

```
### 样例输出 #1
```
1 1 0
```
### 样例输入 #2
```
7
1 8596489 489489 4894 1564 489 35789489  

```
### 样例输出 #2
```
1 503420421 924499237 13354513 217017417 707895465 411020414

```
## 提示

对于$25\%$的数据，有$n \leq 1000$

对于$50\%$的数据，有$n \leq 10^4$

对于$75\%$的数据，有$n \leq 5\times 10^4$

对于$100\%$的数据，有$n \leq 10^5,a_i \in [0,998244352] \cap \mathbb{Z}$


---

---
title: "【模板】下降幂多项式乘法"
layout: "post"
diff: 省选/NOI-
pid: P5394
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】下降幂多项式乘法
## 题目背景

模板题，无背景。
## 题目描述

给定一个 $n$ 次下降幂多项式 $A(x)$ 和 $m$ 次下降幂多项式 $B(x)$，你要求出一个 $n+m$ 次下降幂多项式 $F(x)$ 满足 $F(x)=A(x)B(x)$。

由于结果会很大，你输出的多项式的系数应对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$，表示下降幂多项式的次数。

第二行 $n+1$ 个非负整数 $a_0,a_1,a_2,\dots,a_n$，表示 $A(x)$ 的系数。即 $A(x)=a_0+a_1x+a_2x^{\underline 2}+\dots+a_nx^{\underline n}$。

第三行$m+1$个非负整数$b_0,b_1,b_2,\dots,b_m$，表示 $B(x)$ 的系数。即 $B(x)=b_0+b_1x+b_2x^{\underline 2}+\dots+b_mx^{\underline m}$。


## 输出格式

一行，共 $n+m+1$ 个非负整数，表示 $F(x)$ 的各项系数对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
2 3
1 2 3
1 2 3 4

```
### 样例输出 #1
```
1 8 52 148 89 12

```
## 提示

对于 $20\%$的数据，$n,m\leqslant 1000$。

对于 $100\%$ 的数据，$1\leqslant n,m\leqslant 10^5$，$a_i,b_i\in[0,998244353)$，$a_n,b_m \neq 0$。

## 提示

$x^{\underline n}=\left\{\begin{matrix}1 & n=0\\ x\times (x-1)^{\underline{n-1}} & n\geqslant 1 \end{matrix}\right.$

$\sum\limits_{i=0}^n a_ix^{\underline i},a_n\neq 0$ 是 $x$ 的 $n$ 次下降幂多项式。

容易证明 $n$ 次下降幂多项式唯一确定一个 $n$ 次多项式，所以下降幂多项式乘积的定义就是对应的多项式的乘积对应的下降幂多项式。 


---

---
title: "差分与前缀和"
layout: "post"
diff: 省选/NOI-
pid: P5488
tag: ['数学', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 差分与前缀和
## 题目描述

给定一个长为 $n$ 的序列 $a$，求出其 $k$ 阶差分或前缀和。    
结果的每一项都需要对 $1004535809$ 取模。
## 输入格式

第一行三个整数 $n,k,t$，若 $t=0$ 表示求前缀和，$t=1$ 表示求差分。  
第二行 $n$ 个整数，表示序列 $a$。
## 输出格式

输出一行 $n$ 个整数，表示 $a$ 的 $k$ 阶差分或前缀和。
## 样例

### 样例输入 #1
```
8 3 0
1 9 2 6 0 8 1 7
```
### 样例输出 #1
```
1 12 35 76 135 220 332 478 
```
### 样例输入 #2
```
8 3 1
1 9 2 6 0 8 1 7
```
### 样例输出 #2
```
1 6 1004535787 26 1004535788 24 1004535780 28
```
## 提示

【数据范围】  

$1 \le n \le 10^5$  
$0 \le a_i \le 10^9$   
$1\le k \le 10^{2333}, k \not \equiv 0 \pmod{1004535809}$


---

---
title: "【CSGRound2】开拓者的卓识"
layout: "post"
diff: 省选/NOI-
pid: P5641
tag: ['数学', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 【CSGRound2】开拓者的卓识
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/s6ozu5pj.png)

（上图转载于某神仙的题目描述）

小 K 又在做白日梦了。他进入到他的幻想中，发现了一个非常有趣的序列$a$和一个非常有趣的数$k$。
## 题目描述

我们记一个序列 $[l,r]$ 的 $k$ 阶子段和为 $sum_{k,l,r}$，有

$$sum_{k,l,r}=\begin{cases}\sum\limits_{i=l}^{r}a_i&,k=1\\\sum\limits_{i=l}^{r}\sum\limits_{j=i}^{r}sum_{k-1,i,j}&,k\geq 2\end{cases}$$

他现在站在位置 $1$ 上，他每一次往右开拓一个格子就可以增加他 IOI 赛场的 rp，所以他想尽可能的多开拓格子。可是每一次他从 $r$ 开拓到 $r+1$ 需要正确的回答 $sum_{k,1,r}$。小 K 不屑于算，就把任务交给你了。
## 输入格式

两行。第一行 $n,k$，表示 $a$ 的长度和 $k$。

第二行 $n$ 个正整数，表示 $a$。
## 输出格式

一行，第 $i$ 个数为 $sum_{k,1,i}$。由于答案过大，您只需要求出答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 1
1 2 3
```
### 样例输出 #1
```
1 3 6
```
### 样例输入 #2
```
3 2
1 2 3
```
### 样例输出 #2
```
1 6 20
```
### 样例输入 #3
```
3 10
1 2 3
```
### 样例输出 #3
```
1 30 420
```
## 提示

### 样例解释 2

$sum_{2,1,1}=sum_{1,1,1}=1$

$sum_{2,1,2}=sum_{1,1,1}+sum_{1,1,2}+sum_{1,2,2}=1+3+2=6$

$sum_{2,1,3}=sum_{1,1,1}+sum_{1,1,2}+sum_{1,1,3}+sum_{1,2,2}+sum_{1,2,3}+sum_{1,3,3}=1+3+6+2+5+3=20$

### 数据范围

| 测试点编号 |  $n$ 的范围 |  $k$ 的范围 |  $a_i$ 的范围 |
| :-: | :-: | :-: | :-: |
|  $1\sim 2$ |  $\le 10$ |  $\le 10$ |  $\le 10$ |
|  $3\sim 8$ |  $\le 10^3$ |  $\le 10^3$ |  $\le 10^5$ |
|  $9$ |  $\le 10^5$ |  $=1$ |  $\le 998244353$ | 
|  $10$ |  $\le 10^5$ |  $=2$ |  $\le 998244353$ |
|  $11$ |  $\le 10^5$ |  $=3$ |  $\le 998244353$ |
|  $12$ |  $\le 10^5$ |  $\le 10$ |  $\le 998244353$ |
|  $13\sim 17$ |  $\le 10^5$ |  $\le 10^2$ |  $\le 998244353$ |
|  $18$ |  $\le 10^5$ |  $\le 10^5$ |  $\le 998244353$ |
|  $19\sim 25$ |  $\le 10^5$ |  $\le 998244353$ |  $\le 998244353$ |


---

---
title: "拉格朗日插值2"
layout: "post"
diff: 省选/NOI-
pid: P5667
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT', '拉格朗日插值法']
---
# 拉格朗日插值2
## 题目描述

给定一个不超过 $n$ 次的多项式的 $n+1$ 个点值 $f(0),f(1) \dots f(n)$，和一个正整数 $m$，求 $f(m),f(m+1) \dots f(m+n)$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$，意义如题目描述。  
第二行 $n+1$ 个整数，表示 $f(0),f(1) \dots f(n)$。
## 输出格式

输出一行 $n+1$ 个整数，表示 $f(m),f(m+1) \dots f(m+n)$。
## 样例

### 样例输入 #1
```
5 6
1 1 4 5 1 4
```
### 样例输出 #1
```
54 232 673 1579 3232 6007
```
## 提示

【数据范围】     
对于 $100\%$ 的数据：  
$1 \le n \le 160000$，$n < m \le 10^8$，$0 \le f(i) < 998244353$。


---

---
title: "集合划分计数"
layout: "post"
diff: 省选/NOI-
pid: P5748
tag: ['数学', 'Special Judge', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT']
---
# 集合划分计数
## 题目描述

一个有 $n$ 个元素的集合，将其分为任意个非空子集，求方案数。  
注意划分出的集合间是无序的，即 $\{\{1,2\},\{3\}\}$ 和 $\{\{3\},\{2,1\}\}$ 算作一种方案。

由于答案可能会很大，所以要对 $998244353$ 取模。
## 输入格式

第一行一个正整数 $T$，表示数据组数。  
接下来 $T$ 行，每行一个正整数 $n$。
## 输出格式

输出 $T$ 行，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
2
3
7
9
233
```
### 样例输出 #1
```
2
5
877
21147
53753544

```
## 提示

【数据范围】  
$T = 1000$，$1\le n \le 10^5$。

【样例解释】  
对于 $n=3$，有五种方案：$\{\{1,2,3\}\},\{\{1,2\},\{3\}\},\{\{1\},\{2,3\}\},\{\{1\},\{2\},\{3\}\},\{\{1,3\},\{2\}\}$。

本题只有一个测试点，假设你答对了 $x$ 组数据，你将得到 $\lfloor x/(T/100) \rfloor$ 分。   
如果你不能解决所有数据，也请输出 $T$ 个整数。

~~TLE不要怪我，是你常数太大了~~


---

---
title: "排列计数"
layout: "post"
diff: 省选/NOI-
pid: P5825
tag: ['动态规划 DP', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 排列计数
## 题目描述

我们记一个排列 $P$ 的升高为 $k$ 当且仅当存在 $k$ 个位置 $i$ 使得 $P_i<P_{i+1}$。

现在给定排列长度 $n$，对于所有整数 $k\in [0,n]$ 求有多少个排列的升高为 $k$。
## 输入格式

一个整数 $n$。
## 输出格式

一行，$n+1$ 个整数，第 $i$ 个整数表示长度为 $n$ 且升高为 $i-1$ 个排列的个数，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
1 11 11 1 0
```
## 提示

对于 $100\%$ 的数据，$1\leq n\leq 2\times 10^5$。


---

---
title: "[P5087] 数学 加强版"
layout: "post"
diff: 省选/NOI-
pid: P6012
tag: ['数学', '快速傅里叶变换 FFT']
---
# [P5087] 数学 加强版
## 题目背景

[原题链接](https://www.luogu.com.cn/problem/P5087)
## 题目描述

小奔热衷于乘法，他最喜欢做的事情是：从一个有 $n$ 个元素的可重集中选出 $k$ 个数，并把这 $k$ 个数的乘积作为这个组合的分数。

小奔想试遍所有的这些组合，然后算出所有这些组合的分数之和。但是他还要出模拟赛虐爆我们这些蒟蒻，所以他只好把这个任务交给了你。

作为不良心的出题人，这题你还要将答案对 $10^9 + 7$ 取模。

## 输入格式

第一行两个正整数 $n,k$。  
第二行 $n$ 个正整数 $a_i$，表示可重集中的元素。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3
1 1 1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
4 3
1 1 1 2
```
### 样例输出 #2
```
7
```
### 样例输入 #3
```
10 7
11 45 14 19 19 8 10 8 17 23
```
### 样例输出 #3
```
693404716
```
## 提示

【样例二解释】  
有四种选择方案，一种是 $\{1,1,1\}$ 和三种都是 $\{1,1,2\}$，分数之和为 $7$。

【数据范围】  
对于 $100\%$ 的数据，$1\le k \le n \le 1.2\times 10^5$，$1\le a_i \le 10^8$。


---

---
title: "悔改"
layout: "post"
diff: 省选/NOI-
pid: P6300
tag: ['2020', 'O2优化', '枚举', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 悔改
## 题目描述

Daniel13265 有一些同样长的小木棍，他把这些木棍随意砍成两段，使得每段的长都不超过 $m$。

现在他想把小木棍拼接成原来的样子，但是却遗失了部分小木棍，而且忘记了自己开始时有多少根木棍和它们的长度。所以他打算把剩下的小木棍拼接出尽可能多的相同长度的木棍。

给出每段小木棍的长度，求出从剩下的木棍中最多能够拼接出的相同长度的木棍的个数与能拼接出来相同长度的木棍个数最多时木棍的最小可能长度。

## 输入格式

输入共 $2$ 行。
  
第一行包含两个正整数 $n,m$，分别表示剩余木棍个数与剩余木棍的最大可能长度。  
第二行共 $n$ 个用单个空格隔开的正整数，第 $i$ 个数 $a_i$ 表示第 $i$ 个木棍的长度。
## 输出格式

输出一行两个整数，分别表示从剩下的木棍中最多能够拼接出的相同长度的木棍的个数与能拼接出来相同长度的木棍个数最多时木棍的最小可能长度。
## 样例

### 样例输入 #1
```
7 10
1 1 2 4 7 8 9

```
### 样例输出 #1
```
2 9
```
## 提示

### 样例解释

如果要拼接出尽量多的长度为 $11$ 的木棍，可以将长度为 $2$ 和 $9$ 的木棍拼接在一起，将长度为 $4$ 和 $7$ 的木棍拼接在一起。然而如果将长度为 $1$ 和 $8$ 的木棍拼接在一起，将长度为 $2$ 和 $7$ 的木棍拼接在一起，可以拼接出 $2$ 根长度为 $9$ 的木棍。  

可以发现能拼接出来相同长度的木棍个数的最大值就是 $2$，此时木棍的长度可能为 $9,10$ 或 $11$，其中最小的为 $9$。


### 数据范围

**本题采用捆绑测试。你每通过一个子任务的所有数据点，就能得到该子任务的全部分数。**

| 子任务编号 | $n\le$ | $m\le$ | 分值 |
|:-:|:-:|:-:|:-:|
| $1$ | $10$ | $10^5$ | $5$ |
| $2$ | $10^3$ | $10^3$ | $10$ |
| $3$ | $10^3$ | $10^5$ | $10$ |
| $4$ | $10^5$ | $10$ | $5$ |
| $5$ | $10^5$ | $10^3$ | $10$ |
| $6$ | $10^5$ | $10^5$ | $60$ |

对于 $100\%$ 的数据，满足 $2\le n,m\le10^5,1\le a_i\le m$。


---

---
title: "「PMOI-2」简单构造题"
layout: "post"
diff: 省选/NOI-
pid: P7423
tag: ['数学', 'O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「PMOI-2」简单构造题
## 题目描述

某次模拟赛中，NaCly\_Fish 遇见这样一道题：
****
定义一个长度为 $n$ 的序列 $A$ 的权值为：

$$\sum_{l=1}^n\sum_{r=l}^n f_A(l,r)$$
其中 $f_A(l,r)$ 就是在 $A$ 的区间 $[l,r]$ 中，「所有**在该区间内出现过的**元素出现次数的乘积」再乘上「区间内所有元素的乘积」。  

要求构造一个长为 $n$ 的序列，其中每个元素都是 $[1,m]$ 中的整数，最大化其权值。
****
她并不会，只好均匀随机 $n$ 个 $[1,m]$ 中的整数组成一个数列，然后输出其权值。

当然，她的这份程序一分都没拿到；但她想知道，生成出的序列期望权值是多少。

为了防止精度问题，答案需要对 $998244353$ 取模。
## 输入格式

一行两个正整数 $n,m$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 2
```
### 样例输出 #1
```
623902740
```
### 样例输入 #2
```
5 3
```
### 样例输出 #2
```
887328630
```
### 样例输入 #3
```
80 233
```
### 样例输出 #3
```
913763047
```
### 样例输入 #4
```
114514 19260817
```
### 样例输出 #4
```
850727003
```
## 提示

【样例一解释】  

显然有 $8$ 种可能的序列：  
$[1,1,1],[1,1,2],[1,2,1],[1,2,2],[2,1,1],[2,1,2],[2,2,1],[2,2,2]$。

权值分别为 $10,12,12,23,12,17,23,46$，期望值就是 $\frac{155}{8}$。

【样例二解释】

期望值是 $\frac{76842}{243}$。

【数据范围】  

**本题采用捆绑测试**。

- Subtask 1（5 pts）：$1\le n,m \le 8$；  
- Subtask 2（7 pts）：$1\le n,m \le 100$；  
- Subtask 3（11 pts）：$1 \le n,m \le 400$； 
- Subtask 4（13 pts）：$1\le n,m \le 5000$；
- Subtask 5（25 pts）：$1\le n \le 5000$；
- Subtask 6（39 pts）：无特殊限制。

对于 $100\%$ 的数据满足，$1\le n \le 2 \times 10^5$，$1\le m \le 10^8$。




---

---
title: "[THUPC 2017] 小 L 的计算题"
layout: "post"
diff: 省选/NOI-
pid: P7431
tag: ['2017', '分治', '快速傅里叶变换 FFT', '快速数论变换 NTT', 'THUPC']
---
# [THUPC 2017] 小 L 的计算题
## 题目描述

现有一个长度为 $n$ 的非负整数数组 $\{a_i\}$ 。小 L 定义了一种神奇变换：
$$f_k=\left(\sum_{i=1}^na_i^k\right)\bmod 998244353$$
小 L 计划用变换生成的序列 $f$ 做一些有趣的事情，但是他并不擅长算乘法，所以来找你帮忙，希望你能帮他尽快计算出 $f_{1\dots n}$。
## 输入格式

输入包含多组数据。

输入的第一行包含一个整数 $T$ , 表示数据组数。

接下来 $2T$ 行，每两行代表一组测试数据。

每组数据的第一行包含一个整数 $n$，表示数组 $\{a_i\}$ 的长度。接下来一行 $n$ 个整数，描述数组 $\{a_i\}$。

保证输入的 $a_i$ 满足 $0\le a_i\le10^9$。在一个测试文件中，保证有 $\sum n\le 4\times 10^5$。
## 输出格式

我们不想让你输出过多的数。因此，令 $ans=\bigoplus_{i=1}^{n}f_i$，其中 $\bigoplus$ 表示**异或**操作，在 C++ / Java / Python 中，它可以表示为 `^`。

对每组数据，你需要输出一行一个整数，表示 $ans$。
## 样例

### 样例输入 #1
```
2
3
2 3 3
5
1 2 3 4 5
```
### 样例输出 #1
```
32
4675
```
## 提示

对于 $100\%$ 的数据，$0\le a_i\le10^9$，$1\le n\le 2\times 10^5$，$\sum n\le 4\times 10^5$。

#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "简单的排列计数"
layout: "post"
diff: 省选/NOI-
pid: P7435
tag: ['动态规划 DP', '数学', 'O2优化', '动态规划优化', '组合数学', '排列组合', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 简单的排列计数
## 题目描述

设 $\text{inv}_{\pi}$ 表示排列 $\pi$ 的逆序对数。如果 $\pi$ 长度为 $n$ 则有

$$\text{inv}_{\pi}=\sum\limits_{i=1}^{n}\sum\limits_{j=i+1}^{n}[\pi_i>\pi_j]$$

给定两个正整数 $n,k$，和一个排列 $\pi^\prime$，定义一个长度为 $n$ 的排列 $\pi$ 的权值 $\text{val}_{\pi}$ 为

$$\text{val}_{\pi}=\prod\limits_{i=1}^{n}\prod_{j=i+1}^{n}\pi_i^{[\pi_{i}>\pi_j]}$$

对于 $0\leq m\leq k$ 求

$$\sum\limits_{\pi}[\text{inv}_\pi=m]\text{val}_\pi$$

其中 $\pi$ 是长度为 $n$ 的排列。
## 输入格式

第一行两个整数 $n,k$。
## 输出格式

一行 $k+1$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 3
```
### 样例输出 #1
```
1 5 15 18
```
## 提示

### 样例解释 1

$$\text{inv}_{(1,2,3)}=0,\text{inv}_{(1,3,2)}=1,\text{inv}_{(2,1,3)}=1,\text{inv}_{(2,3,1)}=2,\text{inv}_{(3,1,2)}=2,\text{inv}_{(3,2,1)}=3$$

$$\text{val}_{(1,2,3)}=1,\text{val}_{(1,3,2)}=3,\text{val}_{(2,1,3)}=2,\text{val}_{(2,3,1)}=6,\text{val}_{(3,1,2)}=9,\text{val}_{(3,2,1)}=18$$

所以当 $m=0$ 时答案为 $1$，$m=1$ 时为 $5$， $m=2$ 时为 $15$，$m=3$ 时为 $18$。

### 数据范围

| 子任务编号 | 分值 | $n\leq $ | $k\leq $ |
| :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $6$ |  |
| Subtask 2 | $12$ | $40$ |  |
| Subtask 3 | $1$ | $998244352$ | $1$ |
| Subtask 4 | $16$ | $998244352$ | $10$ |
| Subtask 5 | $24$ | $2\times 10^5$ |  |
| Subtask 6 | $46$ | $998244352$ |  |

对于 $100\%$ 的数据，$2\leq n\leq 998244352$，$1\leq k\leq \min(2\times 10^5,\frac{n(n-1)}{2})。$


---

---
title: "「PMOI-5」分力"
layout: "post"
diff: 省选/NOI-
pid: P8158
tag: ['数学', '快速傅里叶变换 FFT']
---
# 「PMOI-5」分力
## 题目描述

平面直角坐标系上有一个半径为 $1$、圆心在 $(0,0)$ 的圆。

这个圆上等距标记了 $n$ 个红点，存在一个点落在 $x$ 正半轴上。

NaCly\_Fish 也站在 $(0,0)$ 上，等概率随机对着一个红点，用 $1 \text N$ 的力去推。

设她的推力在 $x$ 和 $y$ 轴上的分力分别为 $F_x$、$F_y$，她想知道这两个随机变量的 $k$ 阶中心矩分别是多少。

对于随机变量 $x$，其 $k$ 阶中心矩定义为 $E((x-E(x))^k)$，$E(x)$ 为 $x$ 的期望值。

可以证明答案**一定是有理数**，所以将答案要对 $998244353$ 取模。
## 输入格式

输入一行两个正整数 $n,k$。
## 输出格式

输出一行两个整数，分别表示 $F_x$ 和 $F_y$ 的 $k$ 阶中心矩的值。
## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
1 0
```
### 样例输入 #2
```
5 15
```
### 样例输出 #2
```
815216641 0
```
### 样例输入 #3
```
114 514
```
### 样例输出 #3
```
636199406 569855248
```
## 提示

【样例一解释】  
二阶中心矩就是方差。由于只能朝着 $x$ 的正负方向推，$F_y$ 总是零，方差也就是零；$F_x$ 可以是 $\pm 1$，概率相等，方差就是 $1$。 

【数据范围】  

**本题采用捆绑测试。**

- Subtask 1（7 pts）：$2\le n,k \le 20$；  
- Subtask 2（14 pts）：$2\le n \le 100$；  
- Subtask 3（19 pts）：$2\le n \le 10^3$；  
- Subtask 4（23 pts）：$2\le k \le 10^7$；     
- Subtask 5（37 pts）：无特殊限制。

对于 $100\%$ 的数据，$2\le n \le 3 \times 10^4$，$2\le k \le 10^9$。


---

---
title: "[THUPC 2023 初赛] 快速 LCM 变换"
layout: "post"
diff: 省选/NOI-
pid: P9135
tag: ['2023', '数论', 'O2优化', '快速傅里叶变换 FFT', 'THUPC']
---
# [THUPC 2023 初赛] 快速 LCM 变换
## 题目描述

小 I 今天学习了快速最小公倍数变换（Fast Least-Common-Multiple Transform, FLT），于是他想考考你。

给定一个长度为 $n$ 的正整数序列 $r_1,r_2,\cdots,r_n$。你需要做以下操作恰好一次：

- 选择整数 $i,j$ 使得 $1 \le i < j \le n$。在序列末尾加入 $(r_i+r_j)$，并将 $r_i$ 和 $r_j$ 从序列中删除。

可以注意到总共有 $\frac{n(n-1)}{2}$ 种可能的操作，每种操作会得到一个长度为 $n-1$ 的序列。

你需要对所有的这 $\frac{n(n-1)}{2}$ 个序列，求出序列中所有元素的最小公倍数，并给出它们的和模 $998244353$ 的值。
## 输入格式

输入的第一行包含一个正整数 $n$，表示序列的长度。接下来一行 $n$ 个正整数 $r_1,r_2,\cdots,r_n$，描述初始序列。
## 输出格式

输出一行一个整数，表示所有序列的最小公倍数的和模 $998244353$ 的值。
## 样例

### 样例输入 #1
```
3
2 3 4

```
### 样例输出 #1
```
40

```
## 提示

#### 样例解释 1

- $i=1,j=2$ 时，得到的序列为 $\{4,5\}$，最小公倍数为 $20$；
- $i=1,j=3$ 时，得到的序列为 $\{3,6\}$，最小公倍数为 $6$；
- $i=2,j=3$ 时，得到的序列为 $\{2,7\}$，最小公倍数为 $14$。

因此输出为 $20+6+14=40$。

#### 子任务

对于所有测试数据，$2 \le n \le 5 \times 10^5, 1 \le r_1,r_2,\cdots,r_n \le 10^6$。

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。


---

---
title: "[ICPC 2021 Macao R] Pass the Ball!"
layout: "post"
diff: 省选/NOI-
pid: P9660
tag: ['2021', '多项式', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT', 'ICPC', '澳门']
---
# [ICPC 2021 Macao R] Pass the Ball!
## 题目描述

There are $n$ children playing with $n$ balls. Both children and balls are numbered from $1$ to $n$.

Before the game, $n$ integers $p_1, p_2, \cdots, p_n$ are given. In each round of the game, child $i$ will pass the ball he possesses to child $p_i$. It is guaranteed that no child will pass his ball to himself, which means $p_i \neq i$. Moreover, we also know that after each round, each child will hold exactly one ball.

Let $b_i$ be the ball possessed by child $i$. At the beginning of the game, child $i$ ($1 \le i \le n$) will be carrying ball $i$, which means $b_i=i$ initially. You're asked to process $q$ queries. For each query you're given an integer $k$ and you need to compute the value of $\sum\limits_{i=1}^{n} i \times b_i$ after $k$ rounds.
## 输入格式

There is only one test case for each test file.

The first line of the input contains two integers $n$ ($2 \le n \le 10^5$) and $q$ ($1 \le q \le 10^5$), indicating the number of children and the number of queries.

The second line contains $n$ integers $p_1, p_2, \cdots, p_n$ ($1 \le p_i \le n$) indicating how the children pass the balls around.

For the following $q$ lines, the $i$-th line contains one integer $k_i$ ($1 \le k_i \le 10^9$) indicating a query asking for the result after $k_i$ rounds.
## 输出格式

For each query output one line containing one integer indicating the answer.
## 样例

### 样例输入 #1
```
4 4
2 4 1 3
1
2
3
4
```
### 样例输出 #1
```
25
20
25
30
```
## 提示

The sample test case is explained below.

$$
\begin{array}{|c|c|c|c|c|c|} \hline \textbf{Round} & \textbf{b1} & \textbf{b2} & \textbf{b3} & \textbf{b4} & \textbf{Answer} \\\hline 
1 & 3 & 1 & 4 & 2 & 25 \\\hline
2 & 4 & 3 & 2 & 1 & 20 \\\hline
3 & 2 & 4 & 1 & 3 & 25 \\\hline
4 & 1 & 2 & 3 & 4 & 30 \\\hline
\end{array}
$$
## 题目翻译

**【题目描述】**

有 $n$ 个孩子和 $n$ 个球在玩游戏。孩子和球都从 $1$ 编号到 $n$。

游戏开始前，给出了 $n$ 个整数 $p_1, p_2, \cdots, p_n$。在游戏的每一轮中，孩子 $i$ 会把他手里的球传给孩子 $p_i$。保证没有孩子会把他手里的球传给自己，也就是说 $p_i \neq i$。此外，我们还知道在每一轮之后，每个孩子手里都会正好持有一个球。

设 $b_i$ 表示孩子 $i$ 所持有的球。在游戏开始时，孩子 $i$（$1 \le i \le n$）将携带球 $i$，也就是说 $b_i=i$。你需要处理 $q$ 个查询。对于每个查询，你会得到一个整数 $k$，你需要计算在 $k$ 轮后 $\sum\limits_{i=1}^{n} i \times b_i$ 的值。


**【输入格式】**

输入的第一行包含两个整数 $n$（$2 \le n \le 10^5$）和 $q$（$1 \le q \le 10^5$），表示孩子的数量和查询的数量。

第二行包含 $n$ 个整数 $p_1, p_2, \cdots, p_n$（$1 \le p_i \le n$），表示孩子之间传球的方式。

接下来的 $q$ 行中，第 $i$ 行包含一个整数 $k_i$（$1 \le k_i \le 10^9$），表示询问在 $k_i$ 轮后的结果。

**【输出格式】**

对于每个查询，输出一行包含一个整数，表示答案。

**【样例解释】**

示例测试用例解释如下。

$$
\begin{array}{|c|c|c|c|c|c|} \hline \textbf{轮次} & \textbf{b1} & \textbf{b2} & \textbf{b3} & \textbf{b4} & \textbf{答案} \\\hline 
1 & 3 & 1 & 4 & 2 & 25 \\\hline
2 & 4 & 3 & 2 & 1 & 20 \\\hline
3 & 2 & 4 & 1 & 3 & 25 \\\hline
4 & 1 & 2 & 3 & 4 & 30 \\\hline
\end{array}
$$

翻译来自于：[ChatGPT](https://chatgpt.com/)。


---


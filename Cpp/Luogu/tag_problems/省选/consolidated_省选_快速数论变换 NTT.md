---
title: "「FAOI-R5」波特检测"
layout: "post"
diff: 省选/NOI-
pid: P11658
tag: ['动态规划 DP', '2025', '洛谷原创', 'O2优化', '矩阵加速', '组合数学', '快速数论变换 NTT', '洛谷比赛']
---
# 「FAOI-R5」波特检测
## 题目背景

正在验证您是否是真人。这可能需要几秒钟时间。
## 题目描述

小 H 是一个 bot，他内置一个序列 $\{A_n\}$ 和一个长度为 $n$ 的 01 串 $H$。询问他一个区间 $[l,r]$，他可以给出一个**集合** $g(l,r)$:
- 设置序列 $\{B_n\}$，对于 $i=1,2,\ldots,n$，执行以下操作：
  - 如果 $H_i=\tt{0}$，$B_i=A_i$（即小 H 不能修改 $A_i$ 的值）；
  - 如果 $H_i=\tt{1}$，可以任意选择一个非负整数 $v$，令 $B_i=v$（即小 H 可以任意修改 $A_i$ 的值，**修改后的值可以不在 $\boldsymbol{[0,2^k-1]}$ 范围内**）。
- $g(l,r)=\{B_l\operatorname{xor}B_{l+1},B_{l+1}\operatorname{xor}B_{l+2},\cdots,B_{r-1}\operatorname{xor}B_{r}\}$。

喵仔牛奶需要对小 H 进行若干次检测，每次选取 $[l,r],[L,R]$ 两个区间，满足 $r\le L$，并向小 H 询问得出 $g(l,r),g(L,R)$。若 $g(l,r)\cap g(L,R)\neq\varnothing$，则检测失败，小 H 的 bot 身份会被发现。

若小 H 存在一种策略可以回答所有可能的询问并不存在检测失败（也就是对于任意满足 $r\le L$ 区间 $[l,r],[L,R]$ 都不会检测失败），我们就称这个 01 串 $H$ 是「可用的」。

给定 $n,k$，序列 $\{A_n\}$ 的每一项都在 $[0,2^k-1]$ 中均匀随机选取。你需要求出「可用的」01 串 $H$ 的个数的期望值。答案对 $998244353$ 取模。
## 输入格式

一行两个非负整数 $n,k$，表示序列长度与值域大小。
## 输出格式

一行一个非负整数，表示「可用的」01 串 $H$ 的个数的期望值对 $998244353$ 取模后的结果。

如果你不知道如何进行有理数取模：
- 令 $M=998244353$。可以证明，答案可以被表示为最简分数 $\frac{p}{q}$，其中 $p$ 和 $q$ 是正整数且 $q\not\equiv 0\pmod M$。你只需要输出一个非负整数 $x\in[0,M)$ 使得 $x\cdot q\equiv p\pmod M$。
- 如果你不知道如何找出所述的 $x$，可以参考 P2613。
## 样例

### 样例输入 #1
```
1 0
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
2 1
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
3 1
```
### 样例输出 #3
```
499122184
```
### 样例输入 #4
```
5 2
```
### 样例输出 #4
```
655097885
```
### 样例输入 #5
```
10 3
```
### 样例输出 #5
```
972670600
```
### 样例输入 #6
```
114 514
```
### 样例输出 #6
```
802524221
```
## 提示

### 样例 1 解释

唯一一种可能的情况是 $A=[0]$，此时 $H=\tt 0$ 和 $H=\tt 1$ 都是「可用的」，故答案为 $2$。

### 样例 2 解释

有以下 $4$ 种可能的情况：

- $A=[0,0]$。
- $A=[0,1]$。
- $A=[1,0]$。
- $A=[1,1]$。

在不修改的情况下，它们都能通过检测（对应的答案均为 $2^2=4$），故答案为 $2^2=4$。

### 样例 3 解释

有以下 $8$ 种可能的情况：
- $A=[0,0,0]$，$H$ 的个数为 $7$。
- $A=[0,0,1]$，$H$ 的个数为 $8$。
- $A=[0,1,0]$，$H$ 的个数为 $7$。
- $A=[0,1,1]$，$H$ 的个数为 $8$。
- $A=[1,0,0]$，$H$ 的个数为 $8$。
- $A=[1,0,1]$，$H$ 的个数为 $7$。
- $A=[1,1,0]$，$H$ 的个数为 $8$。
- $A=[1,1,1]$，$H$ 的个数为 $7$。

当 $A=[0,1,0]$ 时，$H=\tt{000}$ 不是「可用的」。当询问 $[1,2],[2,3]$ 时：
- 小 H 每次只能原封不动地保留 $A$。
- 当询问 $[1,2]$ 时，$g(1,2)=\{1\}$。
- 当询问 $[2,3]$ 时，$g(2,3)=\{1\}$。
- $g(1,2)\cap g(2,3)=\{1\}$，检测失败。

当 $A=[1,1,1]$ 时，$H=\tt{010}$ 是「可用的」。当询问 $[1,2],[2,3]$ 时：
- 小 H 可以任意修改 $A$ 的值，**并且每次询问时修改的值可以不一样**。
- 当询问 $[1,2]$ 时，小 H 令 $B=[1,2,1]$，$g(1,2)=\{3\}$。
- 当询问 $[2,3]$ 时，小 H 令 $B=[1,1,1]$，$g(2,3)=\{0\}$。
- $g(1,2)\cap g(2,3)=\varnothing$，检测成功。

故答案为 $(7\times 4+8\times 4)\times\dfrac{1}{8}=\dfrac{15}{2}$。

注意到 $2\times 499122184\equiv 15\pmod{998244353}$，答案即为 $499122184$。

### 样例 4 解释

答案为 $\dfrac{907}{32}\equiv655097885\pmod{998244353}$。

### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（10 pts）：$n\leq2$。
- Subtask 2（10 pts）：$n\leq 6$，$k\leq 2$。
- Subtask 3（10 pts）：$n\leq 50$，$k\leq6$。
- Subtask 4（10 pts）：$n\leq 500$，$k\leq 20$。
- Subtask 5（20 pts）：$n\leq 2\times10^3$。
- Subtask 6（20 pts）：$n\leq 5\times10^4$。
- Subtask 7（20 pts）：无特殊限制。

对于所有数据，$1\leq n\leq 10^6$，$0\leq k\leq 10^9$。


---

---
title: "「ZHQOI R1」幂和"
layout: "post"
diff: 省选/NOI-
pid: P11957
tag: ['数学', 'O2优化', '快速数论变换 NTT', '洛谷比赛']
---
# 「ZHQOI R1」幂和
## 题目描述

给定 $n,x,k$，求下列式子的值：
$$
\sum_{i=0}^n (-1)^{\operatorname{popcnt}(i)} (i+x)^k
$$
答案对 $998244353$ 取模。

特殊地，定义 $0^0=1$。

函数 $\operatorname{popcnt}(x)$ 表示 $x$ 在二进制表示下 $1$ 的个数。
## 输入格式

一行，三个整数 $n,x,k$。
## 输出格式

输出一个数表示答案。
## 样例

### 样例输入 #1
```
5 5 2
```
### 样例输出 #1
```
23
```
### 样例输入 #2
```
12345678 1919810 11451
```
### 样例输出 #2
```
69157901
```
### 样例输入 #3
```
999999999999 125432670 1000
```
### 样例输出 #3
```
154496571
```
## 提示

**【数据范围】**

**本题采用捆绑测试。**

对于所有数据：$0\le n\le 10^{12},0\le x\le 10^9,0\le k\le 10^5$。

| 子任务编号 | $n\le $        | $k\le $ | 分数 |
| :----------: | :--------------: | :-------: | :----: |
| 1          | $10^6$         | $10^5$  | $7$  |
| 2          | $10^8$ | $10^5$  | $8$  |
| 3          | $10^{12}$          | $0$     | $5$  |
| 4          | $10^{12}$          | $1$     | $10$ |
| 5          | $10^{12}$          | $2$     | $10$ |
| 6          | $10^{12}$          | $100$   | $10$ |
| 7          | $10^{12}$          | $10^3$  | $15$ |
| 8          | $10^{12}$          | $10^4$  | $15$ |
| 9          | $10^{12}$          | $10^5$  | $20$ |


---

---
title: "回报"
layout: "post"
diff: 省选/NOI-
pid: P12735
tag: ['2025', '洛谷原创', '组合数学', '容斥原理', '快速数论变换 NTT', '洛谷月赛']
---
# 回报
## 题目背景

> 在我看来，得到太多的人明明是我，反倒是我该思考怎么回报才对。\
——浅村悠太
## 题目描述

悠太需要帮沙季找到合适的学习用音乐。

他找到了一个包含 $n$ 首音乐的专辑，其中的音乐编号为从 $1$ 至 $n$，播放每首音乐均需要 $1$ 分钟。沙季有 A 和 B 两门需要学的课程，每次学习 A 和 B 分别需要花 $a,b$ 分钟。为了更好地帮助她，悠太打算将音乐的播放顺序重新排列。具体地，他要选择一个长为 $n$ 的排列 $p_1,\dots,p_n$，使得其中存在两个长度分别为 $a,b$ 的循环 $A,B$，且 $A$ 中的任意一个元素小于 $B$ 中的任意一个元素。

排列中的一个长为 $k$ 的循环 $C$ 是一个由不同整数组成的序列 $c_1,\dots,c_k$，满足 $1\le c_1\le n$，$c_{i+1}=p_{c_i},i=1,\dots,k-1$，且 $p_{c_k}=c_1$。

悠太想要求出有多少满足要求的排列 $p$。由于答案可能很大，你只需要告诉他答案对 $998244353$ 取模的结果。
## 输入格式

输入一行三个整数表示序列长度 $n$ 与 $a,b$。
## 输出格式

输出一行一个整数，表示满足要求的排列的数量取模 $998244353$ 的结果。
## 样例

### 样例输入 #1
```
4 2 1

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
678 12 34

```
### 样例输出 #2
```
951781526

```
### 样例输入 #3
```
1987 654 321

```
### 样例输出 #3
```
27905503

```
### 样例输入 #4
```
1000000 13 20

```
### 样例输出 #4
```
912829543

```
## 提示

#### 样例 1 解释

满足要求的排列有 $(2,1,3,4),(3,2,1,4),(1,3,2,4)$，共 $3$ 个。

#### 数据范围与限制

**本题采用捆绑测试，各 Subtask 的限制与分值如下。**

| Subtask No. | $n\le$ | 特殊性质 | 分值 | 依赖子任务 |
| :-: | :-: | :-: | :-: | :-: |
| $1$ | $10$ | 有 | $7$ |  |
| $2$ | $700$ | 有 | $10$ | $1$ |
| $3$ | $700$ | 无 | $20$ | $1,2$ |
| $4$ | $2000$ | 有 | $10$ | $1,2$ |
| $5$ | $2000$ | 无 | $30$ | $1,2,3,4$ |
| $6$ | $10^6$ | 有 | $20$ | $1,2,4$ |
| $7$ | $10^6$ | 无 | $3$ | $1,2,3,4,5,6$ |

特殊性质：$\min(a,b)=1$。

对于所有数据，$1\le n\le10^6$，$1\le a,b<a+b\le n$。


---

---
title: "[POI 2018 R3] 多项式 Polynomial"
layout: "post"
diff: 省选/NOI-
pid: P12771
tag: ['2018', 'POI（波兰）', 'Special Judge', '快速数论变换 NTT']
---
# [POI 2018 R3] 多项式 Polynomial
## 题目背景

翻译来自于 [LibreOJ](https://loj.ac/p/5079)。
## 题目描述

**题目译自 [XXV Olimpiada Informatyczna — III etap](https://sio2.mimuw.edu.pl/c/oi25-3/dashboard/) [Wielomian](https://szkopul.edu.pl/problemset/problem/9JvSAnyf5d1FlPAEXEdUAtCz/statement/)**

Bajtazar 在数学课上行为不端，作为惩罚，他需计算一个具有 $n$ 个整数系数的长多项式 $W$：

$$
W(x) = a_0 + a_1 x + a_2 x^2 + \ldots + a_{n-2} x^{n-2} + a_{n-1} x^{n-1}
$$

在点 $q^1, q^2, \ldots, q^n$ 处的取值。为便于老师检查，他需先给出这些取值之和除以 $m$ 的余数，再给出各取值除以 $m$ 的余数。

Bajtazar 不仅调皮，还很懒惰，他请你帮忙，自己却跑去派对了。临走前，他提醒你：$n$ 是 $2$ 的幂，且 $q^n$ 除以 $m$ 的余数为 $1$（即 $q^n \bmod m = 1$）。他认为这些性质可大幅减少计算量。
## 输入格式

第一行包含三个整数 $n, m, q$（$n \geq 1$，$n$ 为 $2$ 的幂，$2 \leq m \leq 10^9$，$1 \leq q < m$，$q^n \bmod m = 1$）。

第二行包含 $n$ 个整数 $a_0, a_1, \ldots, a_{n-1}$ $(0 \leq a_i \leq 10^9)$，表示多项式系数。
## 输出格式

第一行输出一个整数，表示多项式 $W$ 在点 $q^1, q^2, \ldots, q^n$ 的取值之和除以 $m$ 的余数。

第二行输出 $n$ 个整数，表示 $W(q^1), W(q^2), \ldots, W(q^n)$ 除以 $m$ 的余数，空格分隔。
## 样例

### 样例输入 #1
```
4 13 5
3 2 2 1
```
### 样例输出 #1
```
12
6 2 9 8
```
## 提示

**样例 1 解释**

多项式为 $W(x) = 3 + 2x + 2x^2 + x^3$，其在各点取值为 $W(5) = 188$，$W(5^2) = 16928$，$W(5^3) = 1984628$，$W(5^4) = 244923128$。第一行输出 $188 + 16928 + 1984628 + 244923128 = 246924872$ 除以 $13$ 的余数，即 $12$。第二行输出各取值除以 $13$ 的余数：$188 \bmod 13 = 6$，$16928 \bmod 13 = 2$，$1984628 \bmod 13 = 9$，$244923128 \bmod 13 = 8$。

**附加样例**

1. $n=8, m=10, q=3$。
2. $n=256, m=10, q=9$。
3. $n=2^{13}, m=17, q=6$。
4. $n=2^{20}, m=1114129, q=2$。

若和正确但某取值错误，程序可获得 $40\%$ 的分数，且第二行需输出 $n$ 个 $[0, m-1]$ 范围的数。

详细子任务附加限制及分值如下表所示。

| 子任务 | 附加限制 | 分值 |
| :---: | :--: | :---: |
| $1$    | $n \leq 2^{10}$          | $17$ |
| $2$    | $n \leq 2^{15}$          | $9$  |
| $3$    | $n \leq 2^{20}$          | $74$ |


---

---
title: "Mivik 写书"
layout: "post"
diff: 省选/NOI-
pid: P1316
tag: ['字符串', '枚举', '容斥原理', '快速数论变换 NTT']
---
# Mivik 写书
## 题目背景

Mivik 想当大作家。
## 题目描述

Mivik 的键盘上有 $m$ 个不同的按键，对应着 $m$ 个不同的字符。由于 Mivik 不会写文章，所以他只好**等概率**随机乱按了 $n$ 个键，打出了一篇文章。

Mivik 定义一篇文章的复杂度是这篇文章所有**非空**本质不同子串的数目。我们认为两个字符串本质不同当且仅当它们的长度不同或者它们有任意一位上的字符不同。例如，文章 `abaa` 的复杂度是 8，因为它一共有 `a`、`b`、`ab`、`ba`、`aa`、`aba`、`baa`、`abaa` 这 8 个非空的本质不同子串。

Mivik 现在想知道，这篇文章期望的复杂度是多少。由于 Mivik 不喜欢奇形怪状的小数，你只需要输出期望的复杂度对 $10^9+7$ 取模后的值。
## 输入格式

一行两个整数 $n$ 和 $m$，意义见题目描述。
## 输出格式

一行一个整数，代表答案对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
500000006
```
### 样例输入 #2
```
3 3
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
3 4
```
### 样例输出 #3
```
250000007
```
## 提示

### 样例解释

样例一：假设键盘上的字符分别为 `a` 和 `b`，那么可能打出来的文章一共有 `aa`、`ab`、`ba`、`bb` 四种，它们的复杂度分别为 2、3、3、2，因此答案为 $\frac{2+3+3+2}{4}=\frac{5}{2}$，对 $10^9+7$ 取模后得到 500000006。

### 数据范围

对于全部数据，有 $1\le n\le 20$，$1\le m\le 5\cdot 10^6$。

Subtask 1 (10 pts)：满足 $1\le n, m\le 7$。

Subtask 2 (20 pts)：满足 $1\le n\le 5$。

Subtask 3 (20 pts)：满足 $1\le n\le 10$。

Subtask 4 (50 pts)：无特殊限制。


---

---
title: "Mivik 的标题"
layout: "post"
diff: 省选/NOI-
pid: P1393
tag: ['字符串', '数学', 'KMP 算法', '快速数论变换 NTT']
---
# Mivik 的标题
## 题目背景

Mivik 现在已经写好了他的书，他现在准备给这本书起个书名去投稿。
## 题目描述

由于 Mivik 写书是乱敲键盘敲出来的，他准备对书名干同样的事情。Mivik 的键盘上有 $m$ 个不同的按键，对应着 $m$ 个不同的字符。Mivik 决定在这个键盘上**等概率**随机敲 $n$ 次敲出标题。但出于某些原因，Mivik 希望书名中要包含有一个人的名字 $S$。于是 Mivik 来问你，他随机敲出的标题有多大的概率包含有这个名字。

同样的，Mivik 并不喜欢奇形怪状的小数，所以你只需要输出这个概率对 $998244353$ 取模后的值。
## 输入格式

第一行三个整数 $n$、$m$、$|S|$，其中 $|S|$ 代表这个名字的长度。

第二行给出 $|S|$ 个整数 $a_i$，代表这个名字。
## 输出格式

一行一个整数，代表概率对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
3 2 2
1 1
```
### 样例输出 #1
```
623902721
```
### 样例输入 #2
```
6 3 4
1 2 3 2
```
### 样例输出 #2
```
480636170
```
## 提示

### 样例解释

样例一：为方便描述，我们定义键盘上两个按键为 `a` 和 `b`。那么长度为 3 的所有字符串共有 `aaa`、`aab`、`aba`、`abb`、`baa`、`bab`、`bba`、`bbb` 这 8 个，其中包含有指定名字 `aa` 的共有 `aaa`、`aab`、`baa` 这三个，则概率为 $\frac{3}{8}$，取模后得到 623902721。

### 数据范围

对于全部数据，有 $1\le |S|\le 10^5$，$|S|\le n\le |S|+10^5$，$1\le m\le 10^8$。

Subtask 1 (5 pts)：满足 $m=1$。

Subtask 2 (20 pts)：满足 $1\le n, m\le 250$。

Subtask 3 (30 pts)：满足 $1\le n, m\le 5000$。

Subtask 3 (45 pts)：无特殊限制。


---

---
title: "[HAOI2018] 染色"
layout: "post"
diff: 省选/NOI-
pid: P4491
tag: ['2018', '河南', '各省省选', 'O2优化', '容斥原理', '生成函数', '快速数论变换 NTT']
---
# [HAOI2018] 染色
## 题目背景

HAOI2018 Round2 第二题
## 题目描述

为了报答小 C 的苹果，小 G 打算送给热爱美术的小 C 一块画布，这块画布可以抽象为一个长度为 $N$ 的序列，每个位置都可以被染成 $M$ 种颜色中的某一种。

然而小 C 只关心序列的 $N$ 个位置中出现次数恰好为 $S$ 的颜色种数，如果恰好出现了 $S$ 次的颜色有 $K$ 种，则小 C 会产生 $W_k$ 的愉悦度。

小 C 希望知道对于所有可能的染色方案，他能获得的愉悦度的和对 $1004535809$
取模的结果是多少。
## 输入格式

从标准输入读入数据。第一行三个整数 $N, M, S$。

接下来一行 $M + 1$ 个整数，第 $i$ 个数表示 $W_{i-1}$。
## 输出格式

输出到标准输出中。输出一个整数表示答案。
## 样例

### 样例输入 #1
```
8 8 3
3999 8477 9694 8454 3308 8961 3018 2255 4910
```
### 样例输出 #1
```
524070430
```
### 样例输入 #2
```
见 sample.zip/data2.in
```
### 样例输出 #2
```
见 sample.zip/data2.ans
```
## 提示

特殊性质: $\forall 1 \le i \le m, W_i = 0$。

对于 $100\%$ 的数据，满足 $1 \le N \le 10 ^ 7$，$1 \le M \le 10 ^ 5$，$1 \le S \le 150$，$0 \le W_i < 1004535809$。

![Data](https://cdn.luogu.com.cn/upload/pic/18057.png)



---

---
title: "【模板】多项式除法"
layout: "post"
diff: 省选/NOI-
pid: P4512
tag: ['快速数论变换 NTT']
---
# 【模板】多项式除法
## 题目描述

给定一个 $n$ 次多项式 $F(x)$ 和一个 $m$ 次多项式  $G(x)$ ，请求出多项式 $Q(x)$, $R(x)$，满足以下条件：

 - $Q(x)$ 次数为 $n-m$，$R(x)$ 次数小于 $m$
 - $F(x) = Q(x) * G(x) + R(x)$

所有的运算在模 $998244353$ 意义下进行。
## 输入格式

第一行两个整数 $n$，$m$，意义如上。  
第二行 $n+1$ 个整数，从低到高表示 $F(x)$ 的各个系数。  
第三行 $m+1$ 个整数，从低到高表示 $G(x)$ 的各个系数。
## 输出格式

第一行 $n-m+1$ 个整数，从低到高表示 $Q(x)$ 的各个系数。    
第二行 $m$ 个整数，从低到高表示 $R(x)$ 的各个系数。    
如果 $R(x)$ 不足 $m-1$ 次，多余的项系数补 $0$。
## 样例

### 样例输入 #1
```
5 1
1 9 2 6 0 8
1 7
```
### 样例输出 #1
```
237340659 335104102 649004347 448191342 855638018
760903695
```
## 提示

对于所有数据，$1 \le m < n \le 10^5$，给出的系数均属于 $[0, 998244353) \cap \mathbb{Z}$。


---

---
title: "【模板】分治 FFT"
layout: "post"
diff: 省选/NOI-
pid: P4721
tag: ['分治', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】分治 FFT
## 题目背景

也可用多项式求逆解决。
## 题目描述

给定序列 $g_{1\dots n - 1}$，求序列 $f_{0\dots n - 1}$。

其中 $f_i=\sum_{j=1}^if_{i-j}g_j$，边界为 $f_0=1$。

答案对 $998244353$ 取模。
## 输入格式

第一行一个整数 $n$ 。

第二行 $n-1$ 个整数 $g_{1\dots n - 1}$。
## 输出格式

一行 $n$ 个整数，表示 $f_{0\dots n - 1}$ 对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
4
3 1 2
```
### 样例输出 #1
```
1 3 10 35
```
### 样例输入 #2
```
10
2 456 32 13524543 998244352 0 1231 634544 51
```
### 样例输出 #2
```
1 2 460 1864 13738095 55389979 617768468 234028967 673827961 708520894
```
## 提示

$2\leq n\leq 10^5$，$0\leq g_i<998244353$。


---

---
title: "【模板】多项式对数函数（多项式 ln）"
layout: "post"
diff: 省选/NOI-
pid: P4725
tag: ['数学', '洛谷原创', 'O2优化', '导数', '积分', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式对数函数（多项式 ln）
## 题目描述

给出 $n-1$ 次多项式 $A(x)$，求一个 $\bmod{\:x^n}$ 下的多项式 $B(x)$，满足 $B(x) \equiv \ln A(x)$.

在  $\text{mod } 998244353$  下进行，且 $a_i \in [0, 998244353) \cap \mathbb{Z}$
## 输入格式

第一行一个整数 $n$.

下一行有 $n$ 个整数，依次表示多项式的系数 $a_0, a_1, \cdots, a_{n-1}$.

保证 $a_0 = 1$.
## 输出格式

输出 $n$ 个整数，表示答案多项式中的系数 $a_0, a_1, \cdots, a_{n-1}$.
## 样例

### 样例输入 #1
```
6
1 927384623 878326372 3882 273455637 998233543
```
### 样例输出 #1
```
0 927384623 817976920 427326948 149643566 610586717
```
## 提示

对于 $100\%$ 的数据，$n \le 10^5$.


---

---
title: "[集训队作业2013] 城市规划"
layout: "post"
diff: 省选/NOI-
pid: P4841
tag: ['数学', '2013', '集训队互测', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [集训队作业2013] 城市规划
## 题目描述

刚刚解决完电力网络的问题，阿狸又被领导的任务给难住了。

刚才说过，阿狸的国家有 $n$ 个城市，现在国家需要在某些城市对之间建立一些贸易路线，使得整个国家的任意两个城市都直接或间接的连通。

为了省钱, 每两个城市之间最多只能有一条直接的贸易路径。对于两个建立路线的方案，如果存在一个城市对，在两个方案中是否建立路线不一样，那么这两个方案就是不同的，否则就是相同的。现在你需要求出一共有多少不同的方案。

好了，这就是困扰阿狸的问题。换句话说，你需要求出 $n$ 个点的简单 (无重边无自环) 有标号无向连通图数目。

由于这个数字可能非常大, 你只需要输出方案数对 $1004535809$ ( $479 \times 2 ^{21} + 1$ ) 取模即可。
## 输入格式

仅一行一个整数 $n$
## 输出格式

仅一行一个整数，为方案数 $\bmod \space 1004535809$。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
38
```
### 样例输入 #3
```
100000
```
### 样例输出 #3
```
829847355

```
## 提示

【数据范围】   
对于 $20\%$ 的数据，$n \le 10$    
对于 $40\%$ 的数据，$n \le 1000$     
对于 $60\%$ 的数据，$n \le 30000$    
对于 $80\%$ 的数据，$n \le 60000$     
对于 $100\%$ 的数据，$n \le 130000$   

试题来源：$2013$ 中国国家集训队第二次作业


---

---
title: "【模板】多项式开根"
layout: "post"
diff: 省选/NOI-
pid: P5205
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式开根
## 题目背景

模板题，无背景
## 题目描述

给定一个 $n-1$ 次多项式 $A(x)$，求一个在 ${} \bmod x^n$ 意义下的多项式 $B(x)$，使得 $B^2(x) \equiv A(x) \pmod{x^n}$。若有多解，请取零次项系数较小的作为答案。

多项式的系数在 ${}\bmod 998244353$ 的意义下进行运算。
## 输入格式

第一行一个正整数 $n$。

接下来 $n$ 个整数，依次表示多项式的系数 $a_0, a_1, \dots, a_{n-1}$。

保证 $a_0 = 1$。
## 输出格式

输出 $n$ 个整数，表示答案多项式的系数 $b_0, b_1, \dots, b_{n-1}$。
## 样例

### 样例输入 #1
```
3
1 2 1

```
### 样例输出 #1
```
1 1 0

```
### 样例输入 #2
```
7
1 8596489 489489 4894 1564 489 35789489  

```
### 样例输出 #2
```
1 503420421 924499237 13354513 217017417 707895465 411020414

```
## 提示

对于 $100 \%$ 的数据：$1 \le n \leq 10^5$，$0 \le a_i < 998244353$。


---

---
title: "多项式三角函数"
layout: "post"
diff: 省选/NOI-
pid: P5264
tag: ['倍增', 'O2优化', '构造', '快速数论变换 NTT']
---
# 多项式三角函数
## 题目描述

给定一个 $n-1$ 次多项式 $A(x)$，求一个 $\bmod{\:x^n}$ 下的多项式 $F(x)$，满足 $F(x)\equiv\sin{A(x)}$ 或 $F(x)\equiv\cos{A(x)}$。

所有运算在 $\bmod\ 998244353$ 意义下进行。
## 输入格式

第一行 **两个** 整数 $n,type$，若 $type=0$ 代表求 $\sin$，若 $type=1$ 代表求 $\cos$；

第二行 $n$ 个整数，依次表示多项式的系数 $a_0,a_1,\cdots,a_{n-1}$。

保证 $a_0=0$。
## 输出格式

输出一行 $n$ 个整数，表示答案多项式中的系数 $f_0,f_1,\cdots,f_{n-1}$。
## 样例

### 样例输入 #1
```
8 0
0 4 2 6 1 5 3 7
```
### 样例输出 #1
```
0 4 2 332748113 998244338 931694687 998244320 72887640
```
### 样例输入 #2
```
8 1
0 4 2 6 1 5 3 7
```
### 样例输出 #2
```
1 0 998244345 998244345 665496220 332748123 44366450 133099314
```
## 提示

对于 $100\%$ 的数据：$n\leq10^5$，$a_i\in[0,998244352]\cap\mathbb{Z}$。

前 $5$ 个点 $type=0$，后 $5$ 个点 $type=1$。


---

---
title: "【模板】多项式幂函数（加强版）"
layout: "post"
diff: 省选/NOI-
pid: P5273
tag: ['数学', '2019', '快速数论变换 NTT']
---
# 【模板】多项式幂函数（加强版）
## 题目背景

[普通版传送门](https://www.luogu.com.cn/problem/P5245)

模板题，无背景。
## 题目描述

给定一个 $n-1$ 次多项式 $A(x)$，求一个在 $\bmod\ x^n$ 意义下的多项式 $B(x)$，使得 $B(x) \equiv (A(x))^k \ (\bmod\ x^n)$。

多项式的系数在 $\bmod\ 998244353$ 的意义下进行运算。
## 输入格式

第一行两个整数 $n,k$。

接下来 $n$ 个整数，依次表示 $A(x)$ 的系数 $a_0, a_1,...,a_{n-1}$。
## 输出格式

输出 $n$ 个整数，依次表示 $B(x)$ 的前 $n$ 项系数 $b_0, b_1,...,b_{n-1}$ 在模 $998244353$ 意义下的最小自然数值。
## 样例

### 样例输入 #1
```
2 2
1 1
```
### 样例输出 #1
```
1 2
```
## 提示

对于 $100\%$ 的数据，$1< n \leq 10^5$，$0 \leq k \leq 10^{10^5}$，$a_i \in [0,998244352]$。

[数据更新时间](https://www.luogu.com.cn/paste/897zk1ia)


---

---
title: "【模板】多项式开根（加强版）"
layout: "post"
diff: 省选/NOI-
pid: P5277
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式开根（加强版）
## 题目背景

模板题，无背景
## 题目描述

给定一个 $n-1$ 次多项式 $A(x)$ ，求一个在 $\bmod\ {x^n}$ 意义下的多项式 $B(x)$ ，使得 $B^2(x)\equiv A(x)\pmod {x^n}$。

多项式的系数在 $\bmod\ 998244353$ 的意义下进行运算。
## 输入格式

第一行一个正整数$n$。

接下来$n$个整数，依次表示多项式的系数$a_0,a_1,\cdots ,a_{n-1}$

**不保证$a_0=1$，但保证$a_0$是$\bmod\ 998244353$下的二次剩余。**
## 输出格式

输出 $n$ 个非负整数，表示答案多项式的系数$b_0,b_1\cdots ,b_{n-1}$。如有多解，输出**系数序列**（而非字符序列）字典序最小的。
## 样例

### 样例输入 #1
```
3
1 2 1

```
### 样例输出 #1
```
1 1 0
```
### 样例输入 #2
```
7
1 8596489 489489 4894 1564 489 35789489  

```
### 样例输出 #2
```
1 503420421 924499237 13354513 217017417 707895465 411020414

```
## 提示

对于$25\%$的数据，有$n \leq 1000$

对于$50\%$的数据，有$n \leq 10^4$

对于$75\%$的数据，有$n \leq 5\times 10^4$

对于$100\%$的数据，有$n \leq 10^5,a_i \in [0,998244352] \cap \mathbb{Z}$


---

---
title: "【模板】下降幂多项式乘法"
layout: "post"
diff: 省选/NOI-
pid: P5394
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】下降幂多项式乘法
## 题目背景

模板题，无背景。
## 题目描述

给定一个 $n$ 次下降幂多项式 $A(x)$ 和 $m$ 次下降幂多项式 $B(x)$，你要求出一个 $n+m$ 次下降幂多项式 $F(x)$ 满足 $F(x)=A(x)B(x)$。

由于结果会很大，你输出的多项式的系数应对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$，表示下降幂多项式的次数。

第二行 $n+1$ 个非负整数 $a_0,a_1,a_2,\dots,a_n$，表示 $A(x)$ 的系数。即 $A(x)=a_0+a_1x+a_2x^{\underline 2}+\dots+a_nx^{\underline n}$。

第三行$m+1$个非负整数$b_0,b_1,b_2,\dots,b_m$，表示 $B(x)$ 的系数。即 $B(x)=b_0+b_1x+b_2x^{\underline 2}+\dots+b_mx^{\underline m}$。


## 输出格式

一行，共 $n+m+1$ 个非负整数，表示 $F(x)$ 的各项系数对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
2 3
1 2 3
1 2 3 4

```
### 样例输出 #1
```
1 8 52 148 89 12

```
## 提示

对于 $20\%$的数据，$n,m\leqslant 1000$。

对于 $100\%$ 的数据，$1\leqslant n,m\leqslant 10^5$，$a_i,b_i\in[0,998244353)$，$a_n,b_m \neq 0$。

## 提示

$x^{\underline n}=\left\{\begin{matrix}1 & n=0\\ x\times (x-1)^{\underline{n-1}} & n\geqslant 1 \end{matrix}\right.$

$\sum\limits_{i=0}^n a_ix^{\underline i},a_n\neq 0$ 是 $x$ 的 $n$ 次下降幂多项式。

容易证明 $n$ 次下降幂多项式唯一确定一个 $n$ 次多项式，所以下降幂多项式乘积的定义就是对应的多项式的乘积对应的下降幂多项式。 


---

---
title: "差分与前缀和"
layout: "post"
diff: 省选/NOI-
pid: P5488
tag: ['数学', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 差分与前缀和
## 题目描述

给定一个长为 $n$ 的序列 $a$，求出其 $k$ 阶差分或前缀和。    
结果的每一项都需要对 $1004535809$ 取模。
## 输入格式

第一行三个整数 $n,k,t$，若 $t=0$ 表示求前缀和，$t=1$ 表示求差分。  
第二行 $n$ 个整数，表示序列 $a$。
## 输出格式

输出一行 $n$ 个整数，表示 $a$ 的 $k$ 阶差分或前缀和。
## 样例

### 样例输入 #1
```
8 3 0
1 9 2 6 0 8 1 7
```
### 样例输出 #1
```
1 12 35 76 135 220 332 478 
```
### 样例输入 #2
```
8 3 1
1 9 2 6 0 8 1 7
```
### 样例输出 #2
```
1 6 1004535787 26 1004535788 24 1004535780 28
```
## 提示

【数据范围】  

$1 \le n \le 10^5$  
$0 \le a_i \le 10^9$   
$1\le k \le 10^{2333}, k \not \equiv 0 \pmod{1004535809}$


---

---
title: "【CSGRound2】开拓者的卓识"
layout: "post"
diff: 省选/NOI-
pid: P5641
tag: ['数学', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 【CSGRound2】开拓者的卓识
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/s6ozu5pj.png)

（上图转载于某神仙的题目描述）

小 K 又在做白日梦了。他进入到他的幻想中，发现了一个非常有趣的序列$a$和一个非常有趣的数$k$。
## 题目描述

我们记一个序列 $[l,r]$ 的 $k$ 阶子段和为 $sum_{k,l,r}$，有

$$sum_{k,l,r}=\begin{cases}\sum\limits_{i=l}^{r}a_i&,k=1\\\sum\limits_{i=l}^{r}\sum\limits_{j=i}^{r}sum_{k-1,i,j}&,k\geq 2\end{cases}$$

他现在站在位置 $1$ 上，他每一次往右开拓一个格子就可以增加他 IOI 赛场的 rp，所以他想尽可能的多开拓格子。可是每一次他从 $r$ 开拓到 $r+1$ 需要正确的回答 $sum_{k,1,r}$。小 K 不屑于算，就把任务交给你了。
## 输入格式

两行。第一行 $n,k$，表示 $a$ 的长度和 $k$。

第二行 $n$ 个正整数，表示 $a$。
## 输出格式

一行，第 $i$ 个数为 $sum_{k,1,i}$。由于答案过大，您只需要求出答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 1
1 2 3
```
### 样例输出 #1
```
1 3 6
```
### 样例输入 #2
```
3 2
1 2 3
```
### 样例输出 #2
```
1 6 20
```
### 样例输入 #3
```
3 10
1 2 3
```
### 样例输出 #3
```
1 30 420
```
## 提示

### 样例解释 2

$sum_{2,1,1}=sum_{1,1,1}=1$

$sum_{2,1,2}=sum_{1,1,1}+sum_{1,1,2}+sum_{1,2,2}=1+3+2=6$

$sum_{2,1,3}=sum_{1,1,1}+sum_{1,1,2}+sum_{1,1,3}+sum_{1,2,2}+sum_{1,2,3}+sum_{1,3,3}=1+3+6+2+5+3=20$

### 数据范围

| 测试点编号 |  $n$ 的范围 |  $k$ 的范围 |  $a_i$ 的范围 |
| :-: | :-: | :-: | :-: |
|  $1\sim 2$ |  $\le 10$ |  $\le 10$ |  $\le 10$ |
|  $3\sim 8$ |  $\le 10^3$ |  $\le 10^3$ |  $\le 10^5$ |
|  $9$ |  $\le 10^5$ |  $=1$ |  $\le 998244353$ | 
|  $10$ |  $\le 10^5$ |  $=2$ |  $\le 998244353$ |
|  $11$ |  $\le 10^5$ |  $=3$ |  $\le 998244353$ |
|  $12$ |  $\le 10^5$ |  $\le 10$ |  $\le 998244353$ |
|  $13\sim 17$ |  $\le 10^5$ |  $\le 10^2$ |  $\le 998244353$ |
|  $18$ |  $\le 10^5$ |  $\le 10^5$ |  $\le 998244353$ |
|  $19\sim 25$ |  $\le 10^5$ |  $\le 998244353$ |  $\le 998244353$ |


---

---
title: "拉格朗日插值2"
layout: "post"
diff: 省选/NOI-
pid: P5667
tag: ['快速傅里叶变换 FFT', '快速数论变换 NTT', '拉格朗日插值法']
---
# 拉格朗日插值2
## 题目描述

给定一个不超过 $n$ 次的多项式的 $n+1$ 个点值 $f(0),f(1) \dots f(n)$，和一个正整数 $m$，求 $f(m),f(m+1) \dots f(m+n)$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$，意义如题目描述。  
第二行 $n+1$ 个整数，表示 $f(0),f(1) \dots f(n)$。
## 输出格式

输出一行 $n+1$ 个整数，表示 $f(m),f(m+1) \dots f(m+n)$。
## 样例

### 样例输入 #1
```
5 6
1 1 4 5 1 4
```
### 样例输出 #1
```
54 232 673 1579 3232 6007
```
## 提示

【数据范围】     
对于 $100\%$ 的数据：  
$1 \le n \le 160000$，$n < m \le 10^8$，$0 \le f(i) < 998244353$。


---

---
title: "排列计数"
layout: "post"
diff: 省选/NOI-
pid: P5825
tag: ['动态规划 DP', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 排列计数
## 题目描述

我们记一个排列 $P$ 的升高为 $k$ 当且仅当存在 $k$ 个位置 $i$ 使得 $P_i<P_{i+1}$。

现在给定排列长度 $n$，对于所有整数 $k\in [0,n]$ 求有多少个排列的升高为 $k$。
## 输入格式

一个整数 $n$。
## 输出格式

一行，$n+1$ 个整数，第 $i$ 个整数表示长度为 $n$ 且升高为 $i-1$ 个排列的个数，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
1 11 11 1 0
```
## 提示

对于 $100\%$ 的数据，$1\leq n\leq 2\times 10^5$。


---

---
title: "悔改"
layout: "post"
diff: 省选/NOI-
pid: P6300
tag: ['2020', 'O2优化', '枚举', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 悔改
## 题目描述

Daniel13265 有一些同样长的小木棍，他把这些木棍随意砍成两段，使得每段的长都不超过 $m$。

现在他想把小木棍拼接成原来的样子，但是却遗失了部分小木棍，而且忘记了自己开始时有多少根木棍和它们的长度。所以他打算把剩下的小木棍拼接出尽可能多的相同长度的木棍。

给出每段小木棍的长度，求出从剩下的木棍中最多能够拼接出的相同长度的木棍的个数与能拼接出来相同长度的木棍个数最多时木棍的最小可能长度。

## 输入格式

输入共 $2$ 行。
  
第一行包含两个正整数 $n,m$，分别表示剩余木棍个数与剩余木棍的最大可能长度。  
第二行共 $n$ 个用单个空格隔开的正整数，第 $i$ 个数 $a_i$ 表示第 $i$ 个木棍的长度。
## 输出格式

输出一行两个整数，分别表示从剩下的木棍中最多能够拼接出的相同长度的木棍的个数与能拼接出来相同长度的木棍个数最多时木棍的最小可能长度。
## 样例

### 样例输入 #1
```
7 10
1 1 2 4 7 8 9

```
### 样例输出 #1
```
2 9
```
## 提示

### 样例解释

如果要拼接出尽量多的长度为 $11$ 的木棍，可以将长度为 $2$ 和 $9$ 的木棍拼接在一起，将长度为 $4$ 和 $7$ 的木棍拼接在一起。然而如果将长度为 $1$ 和 $8$ 的木棍拼接在一起，将长度为 $2$ 和 $7$ 的木棍拼接在一起，可以拼接出 $2$ 根长度为 $9$ 的木棍。  

可以发现能拼接出来相同长度的木棍个数的最大值就是 $2$，此时木棍的长度可能为 $9,10$ 或 $11$，其中最小的为 $9$。


### 数据范围

**本题采用捆绑测试。你每通过一个子任务的所有数据点，就能得到该子任务的全部分数。**

| 子任务编号 | $n\le$ | $m\le$ | 分值 |
|:-:|:-:|:-:|:-:|
| $1$ | $10$ | $10^5$ | $5$ |
| $2$ | $10^3$ | $10^3$ | $10$ |
| $3$ | $10^3$ | $10^5$ | $10$ |
| $4$ | $10^5$ | $10$ | $5$ |
| $5$ | $10^5$ | $10^3$ | $10$ |
| $6$ | $10^5$ | $10^5$ | $60$ |

对于 $100\%$ 的数据，满足 $2\le n,m\le10^5,1\le a_i\le m$。


---

---
title: "强迫症"
layout: "post"
diff: 省选/NOI-
pid: P6694
tag: ['数学', '2020', 'O2优化', '生成函数', '快速数论变换 NTT']
---
# 强迫症
## 题目背景

小 L 是一个严重的强迫症患者。

由于他严重的强迫症，所以他画图时总是要把点画在一个圆上。
## 题目描述

一天，他问了小 H 和小 W 这样一个问题：

如果在一个圆上有 $n$ 个不同的点，依次标号为 $1$ 到 $n$，有多少种方案能把它们连成一棵树？

小 H & 小 W：这不是sb题吗？

小 L：那如果**连边不能相交**呢？

小 H & 小 W：这不是sb题吗？

小 L：那如果把「树」换成「图」呢呢？

小 H & 小 W：这不是sb题吗？

小 L：那如果给每个点一个权值 $a_i$，连接 $(i,j)$ 的边权值为 $a_i\times a_j$，求**满足上面**的图的**期望所有边权值之和**呢？

小 H & 小 W：这不是sb题吗？

小 L 见自己辛苦做了许久都没写出的题目被 dalao 轻松秒杀后十分郁闷。为了安慰他，你需要帮他做出这个问题。

**注意**：
1. 两条边在端点处**不视作相交**。
1. **没有边的图（即只有 $n$ 个点，之间没有边相连）也合法**
1. 点**按顺时针从 $1$ 到 $n$** 编号。
1. 图中**不能有自环和重边**
## 输入格式

第一行一个正整数 $n$，意义如上。

接下来一行 $n$ 个非负整数，第 $i$ 个数为 $a_i$，表示第 $i$ 个点的点权。
## 输出格式

一个正整数，表示结果。答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4
1 1 1 1
```
### 样例输出 #1
```
665496238
```
### 样例输入 #2
```
13
1 1 4 5 1 4 1 9 1 9 8 1 0
```
### 样例输出 #2
```
748867567
```
## 提示

对于样例一，全部 $64$ 张图如下：
![](https://cdn.luogu.com.cn/upload/image_hosting/zfa8hs0v.png)

其中左侧 $48$ 张图合法，右侧 $16$ 张图不合法，所有边的权值均为 $1$。

期望边权和为 $\dfrac{8}{3}$，模 $998244353$ 意义下结果为 $665496238$。

### 数据范围

**本题采用捆绑测试。**

- Subtask 1( $10\%$ )：$n\leq 6$。
- Subtask 2( $30\%$ )：$n\leq 3000$。
- Subtask 3( $60\%$ )：无特殊限制。

对于 $100\%$ 的数据，$2\leq n\leq 10^5,0\leq a_i\leq10^6$。

Subtask 1 和 Subtask 2 时限 $1s$，Subtask 3 时限 $2s$。

------------
如果你不知道如何对一个有理数取模，请自行百度「乘法逆元」


---

---
title: "「PMOI-2」简单构造题"
layout: "post"
diff: 省选/NOI-
pid: P7423
tag: ['数学', 'O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「PMOI-2」简单构造题
## 题目描述

某次模拟赛中，NaCly\_Fish 遇见这样一道题：
****
定义一个长度为 $n$ 的序列 $A$ 的权值为：

$$\sum_{l=1}^n\sum_{r=l}^n f_A(l,r)$$
其中 $f_A(l,r)$ 就是在 $A$ 的区间 $[l,r]$ 中，「所有**在该区间内出现过的**元素出现次数的乘积」再乘上「区间内所有元素的乘积」。  

要求构造一个长为 $n$ 的序列，其中每个元素都是 $[1,m]$ 中的整数，最大化其权值。
****
她并不会，只好均匀随机 $n$ 个 $[1,m]$ 中的整数组成一个数列，然后输出其权值。

当然，她的这份程序一分都没拿到；但她想知道，生成出的序列期望权值是多少。

为了防止精度问题，答案需要对 $998244353$ 取模。
## 输入格式

一行两个正整数 $n,m$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 2
```
### 样例输出 #1
```
623902740
```
### 样例输入 #2
```
5 3
```
### 样例输出 #2
```
887328630
```
### 样例输入 #3
```
80 233
```
### 样例输出 #3
```
913763047
```
### 样例输入 #4
```
114514 19260817
```
### 样例输出 #4
```
850727003
```
## 提示

【样例一解释】  

显然有 $8$ 种可能的序列：  
$[1,1,1],[1,1,2],[1,2,1],[1,2,2],[2,1,1],[2,1,2],[2,2,1],[2,2,2]$。

权值分别为 $10,12,12,23,12,17,23,46$，期望值就是 $\frac{155}{8}$。

【样例二解释】

期望值是 $\frac{76842}{243}$。

【数据范围】  

**本题采用捆绑测试**。

- Subtask 1（5 pts）：$1\le n,m \le 8$；  
- Subtask 2（7 pts）：$1\le n,m \le 100$；  
- Subtask 3（11 pts）：$1 \le n,m \le 400$； 
- Subtask 4（13 pts）：$1\le n,m \le 5000$；
- Subtask 5（25 pts）：$1\le n \le 5000$；
- Subtask 6（39 pts）：无特殊限制。

对于 $100\%$ 的数据满足，$1\le n \le 2 \times 10^5$，$1\le m \le 10^8$。




---

---
title: "[THUPC 2017] 小 L 的计算题"
layout: "post"
diff: 省选/NOI-
pid: P7431
tag: ['2017', '分治', '快速傅里叶变换 FFT', '快速数论变换 NTT', 'THUPC']
---
# [THUPC 2017] 小 L 的计算题
## 题目描述

现有一个长度为 $n$ 的非负整数数组 $\{a_i\}$ 。小 L 定义了一种神奇变换：
$$f_k=\left(\sum_{i=1}^na_i^k\right)\bmod 998244353$$
小 L 计划用变换生成的序列 $f$ 做一些有趣的事情，但是他并不擅长算乘法，所以来找你帮忙，希望你能帮他尽快计算出 $f_{1\dots n}$。
## 输入格式

输入包含多组数据。

输入的第一行包含一个整数 $T$ , 表示数据组数。

接下来 $2T$ 行，每两行代表一组测试数据。

每组数据的第一行包含一个整数 $n$，表示数组 $\{a_i\}$ 的长度。接下来一行 $n$ 个整数，描述数组 $\{a_i\}$。

保证输入的 $a_i$ 满足 $0\le a_i\le10^9$。在一个测试文件中，保证有 $\sum n\le 4\times 10^5$。
## 输出格式

我们不想让你输出过多的数。因此，令 $ans=\bigoplus_{i=1}^{n}f_i$，其中 $\bigoplus$ 表示**异或**操作，在 C++ / Java / Python 中，它可以表示为 `^`。

对每组数据，你需要输出一行一个整数，表示 $ans$。
## 样例

### 样例输入 #1
```
2
3
2 3 3
5
1 2 3 4 5
```
### 样例输出 #1
```
32
4675
```
## 提示

对于 $100\%$ 的数据，$0\le a_i\le10^9$，$1\le n\le 2\times 10^5$，$\sum n\le 4\times 10^5$。

#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "简单的排列计数"
layout: "post"
diff: 省选/NOI-
pid: P7435
tag: ['动态规划 DP', '数学', 'O2优化', '动态规划优化', '组合数学', '排列组合', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 简单的排列计数
## 题目描述

设 $\text{inv}_{\pi}$ 表示排列 $\pi$ 的逆序对数。如果 $\pi$ 长度为 $n$ 则有

$$\text{inv}_{\pi}=\sum\limits_{i=1}^{n}\sum\limits_{j=i+1}^{n}[\pi_i>\pi_j]$$

给定两个正整数 $n,k$，和一个排列 $\pi^\prime$，定义一个长度为 $n$ 的排列 $\pi$ 的权值 $\text{val}_{\pi}$ 为

$$\text{val}_{\pi}=\prod\limits_{i=1}^{n}\prod_{j=i+1}^{n}\pi_i^{[\pi_{i}>\pi_j]}$$

对于 $0\leq m\leq k$ 求

$$\sum\limits_{\pi}[\text{inv}_\pi=m]\text{val}_\pi$$

其中 $\pi$ 是长度为 $n$ 的排列。
## 输入格式

第一行两个整数 $n,k$。
## 输出格式

一行 $k+1$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 3
```
### 样例输出 #1
```
1 5 15 18
```
## 提示

### 样例解释 1

$$\text{inv}_{(1,2,3)}=0,\text{inv}_{(1,3,2)}=1,\text{inv}_{(2,1,3)}=1,\text{inv}_{(2,3,1)}=2,\text{inv}_{(3,1,2)}=2,\text{inv}_{(3,2,1)}=3$$

$$\text{val}_{(1,2,3)}=1,\text{val}_{(1,3,2)}=3,\text{val}_{(2,1,3)}=2,\text{val}_{(2,3,1)}=6,\text{val}_{(3,1,2)}=9,\text{val}_{(3,2,1)}=18$$

所以当 $m=0$ 时答案为 $1$，$m=1$ 时为 $5$， $m=2$ 时为 $15$，$m=3$ 时为 $18$。

### 数据范围

| 子任务编号 | 分值 | $n\leq $ | $k\leq $ |
| :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $6$ |  |
| Subtask 2 | $12$ | $40$ |  |
| Subtask 3 | $1$ | $998244352$ | $1$ |
| Subtask 4 | $16$ | $998244352$ | $10$ |
| Subtask 5 | $24$ | $2\times 10^5$ |  |
| Subtask 6 | $46$ | $998244352$ |  |

对于 $100\%$ 的数据，$2\leq n\leq 998244352$，$1\leq k\leq \min(2\times 10^5,\frac{n(n-1)}{2})。$


---

---
title: "[传智杯 #3 决赛] 旅人1969"
layout: "post"
diff: 省选/NOI-
pid: P7493
tag: ['动态规划 DP', '多项式', 'O2优化', '快速数论变换 NTT', '传智杯']
---
# [传智杯 #3 决赛] 旅人1969
## 题目背景

在被称为未来的二十一世纪里，只残留着不安与少许的幻想。

永远与须臾的罪人啊，二十世纪的诺亚方舟，承载着期待与不安向着天空飞去呢！

而作为希望的你，在这并不永恒的旅途中，会怎样地前行呢？
## 题目描述

一条笔直的公路上有 $n$ 个旅店，第 $i$ 个旅店的坐标是 $i$，每一天早上从旅店出发走最多 $m$ 个距离，同时固定给你一个常数 $k$。

给定 $q$ 组询问，每次给定 $u,v$，求早上从旅店 $u$ 出发到旅店 $v$，途径不超过 $k$ 个旅店（不含起点 $u$）且行走方向不变的方案数。两种方案不同当且仅当存在一个不同的旅店选择，答案对 $998244353$ 取模。

对于所有数据，$n,q\leq 10^5$，$m,k\leq 10^4$，$mk\leq 10^5$，$u,v\leq n$。
## 输入格式

输入共 $q+1$ 行。

第一行输入 $4$ 个正整数 $n,m,k,q$。

接下来 $q$ 行，每行输入 $2$ 个正整数 $u,v$，表示一组询问。
## 输出格式

输出共 $q$ 行，每行输入 $1$ 个整数表示答案。
## 样例

### 样例输入 #1
```
3 2 2 2
1 3
2 3
```
### 样例输出 #1
```
2
1
```
### 样例输入 #2
```
2077 30 200 3
1949 2021
1969 2077
1970 2004

```
### 样例输出 #2
```
360658315
804081653
603979748
```


---

---
title: "「PHOI-1」斗之魂"
layout: "post"
diff: 省选/NOI-
pid: P9551
tag: ['数学', '数论', 'O2优化', '素数判断,质数,筛法', '快速数论变换 NTT']
---
# 「PHOI-1」斗之魂
## 题目背景

**本题数据已加强。**

小 X 忙了一天，于是打起了一款叫斗之魂的游戏。

![](https://cdn.luogu.com.cn/upload/image_hosting/5ha5fx0q.png)
## 题目描述

小 X 要击败 $n$ 个 BOSS，他可以选择以下两种击败 BOSS 的方式：

1. 独自一人击败第 $i$ 个 BOSS 并获得 $k_{i,0}$ 块稀有金属，且保证 $k_{i,0}=k_{i,1}=k_{i,2}$。
2. 和小 Y 一起击败第 $i$ 个 BOSS ，小 X 理应获得 $k_{i,1}$ 块稀有金属，小 Y 理应获得 $k_{i,2}$ 块稀有金属，但是 BOSS 本身实力并没有因为人数的改变而改变，击败难度相对要简单一点，所以系统判定两人实际各获得 $k_{i,0}$ 块稀有金属，其中保证 $\dfrac{1}{k_{i,0}}=\dfrac{1}{k_{i,1}}+\dfrac{1}{k_{i,2}}$。

小 X 已经计划好用第 $b_i$ 种方式击败第 $i$ 个 BOSS，但是考虑到某些因素，小 X 有 $q$ 次询问，每次询问给定一个正整数 $m$，为小 X 击败完所有 BOSS 后获得的稀有金属总数，已知 $k_{i,0},k_{i,1},k_{i,2}$ 均为正整数，求每次询问后所有可能的 $k$ 的值的方案数，两种方案不同当且仅当至少存在一个 $k$ 的值不同，由于这个答案可能很大，你只需要输出它对 $998244353$ 取模后的结果。
## 输入格式

第一行有两个整数 $n$ 和 $q$，分别表示 BOSS 个数和小 X 的询问次数。

第二行有 $n$ 个正整数 $b_i$，表示小 X 用 $b_i$ 种方式击败第 $i$ 个 BOSS。

接下来的 $q$ 行中每行有一个整数 $m$，为该次询问中小 X 击败完所有 BOSS 后获得的稀有金属总数。
## 输出格式

输出共 $q$ 行，第 $i$ 行输出一个答案为当小 X 击败完所有 BOSS 后获得的稀有金属总数为 $m$ 时，所有可能的 $k$ 的值的方案数并对它取模 $998244353$ 后的结果。
## 样例

### 样例输入 #1
```
2 2
2 1
3
4

```
### 样例输出 #1
```
4
7

```
### 样例输入 #2
```
5 5
1 2 1 2 1
4
6
8
10
12

```
### 样例输出 #2
```
0
9
119
630
2210
```
## 提示

**本题采用捆绑测试。**

| Subtask |      $n\le$       |      $m \le$      | $q \le$ |  时限  | 分值 |
| :-----: | :---------------: | :---------------: | :-----: | :----: | :--: |
|   $0$   |       $10$        |       $20$        |   $5$   |  $1s$  | $8$  |
|   $1$   |       $30$        |       $60$        |   $5$   |  $1s$  | $7$  |
|   $2$   |       $40$        |       $100$       | $10^3$  |  $1s$  | $5$  |
|   $3$   |       $150$       |       $500$       | $10^3$  |  $1s$  | $5$  |
|   $4$   |       $200$       |      $5000$       | $10^4$  |  $1s$  | $20$ |
|   $5$   |      $2000$       |  $5 \times 10^4$  | $10^5$  |  $1s$  | $25$ |
|   $6$   | $1.5 \times 10^5$ | $2.5 \times 10^5$ | $10^5$  | $1.8s$ | $30$ |

对于 $100\%$ 的数据，保证 $1 \le n \le 1.5 \times 10^5$，$1 \le m \le 2.5 \times 10^5$，$1 \le b_i \le 2$，$1 \le q \le 10^5$。

### 样例解释 #1：

- 当 $m=3$ 时，所有可能的 $k$ 的值的方案数为 $4$。

    第 $1$ 种：$k_{1,0}=1,k_{1,1}=k_{1,2}=2,k_{2,0}=k_{2,1}=k_{2,2}=2$

    第 $2$ 种：$k_{1,0}=2,k_{1,1}=3,k_{1,2}=6,k_{2,0}=k_{2,1}=k_{2,2}=1$

    第 $3$ 种：$k_{1,0}=2,k_{1,1}=k_{1,2}=4,k_{2,0}=k_{2,1}=k_{2,2}=1$

    第 $4$ 种：$k_{1,0}=2,k_{1,1}=6,k_{1,2}=3,k_{2,0}=k_{2,1}=k_{2,2}=1$

- 当 $m=4$ 时，所有可能的 $k$ 的值的方案数为 $7$。

    第 $1$ 种：$k_{1,0}=1,k_{1,1}=k_{1,2}=2,k_{2,0}=k_{2,1}=k_{2,2}=3$

    第 $2$ 种：$k_{1,0}=2,k_{1,1}=3,k_{1,2}=6,k_{2,0}=k_{2,1}=k_{2,2}=2$

    第 $3$ 种：$k_{1,0}=2,k_{1,1}=k_{1,2}=4,k_{2,0}=k_{2,1}=k_{2,2}=2$

    第 $4$ 种：$k_{1,0}=2,k_{1,1}=6,k_{1,2}=3,k_{2,0}=k_{2,1}=k_{2,2}=2$

    第 $5$ 种：$k_{1,0}=3,k_{1,1}=4,k_{1,2}=12,k_{2,0}=k_{2,1}=k_{2,2}=1$

    第 $6$ 种：$k_{1,0}=3,k_{1,1}=6,k_{1,2}=6,k_{2,0}=k_{2,1}=k_{2,2}=1$

    第 $7$ 种：$k_{1,0}=3,k_{1,1}=12,k_{1,2}=4,k_{2,0}=k_{2,1}=k_{2,2}=1$


---

---
title: "[ICPC 2021 Macao R] Pass the Ball!"
layout: "post"
diff: 省选/NOI-
pid: P9660
tag: ['2021', '多项式', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT', 'ICPC', '澳门']
---
# [ICPC 2021 Macao R] Pass the Ball!
## 题目描述

There are $n$ children playing with $n$ balls. Both children and balls are numbered from $1$ to $n$.

Before the game, $n$ integers $p_1, p_2, \cdots, p_n$ are given. In each round of the game, child $i$ will pass the ball he possesses to child $p_i$. It is guaranteed that no child will pass his ball to himself, which means $p_i \neq i$. Moreover, we also know that after each round, each child will hold exactly one ball.

Let $b_i$ be the ball possessed by child $i$. At the beginning of the game, child $i$ ($1 \le i \le n$) will be carrying ball $i$, which means $b_i=i$ initially. You're asked to process $q$ queries. For each query you're given an integer $k$ and you need to compute the value of $\sum\limits_{i=1}^{n} i \times b_i$ after $k$ rounds.
## 输入格式

There is only one test case for each test file.

The first line of the input contains two integers $n$ ($2 \le n \le 10^5$) and $q$ ($1 \le q \le 10^5$), indicating the number of children and the number of queries.

The second line contains $n$ integers $p_1, p_2, \cdots, p_n$ ($1 \le p_i \le n$) indicating how the children pass the balls around.

For the following $q$ lines, the $i$-th line contains one integer $k_i$ ($1 \le k_i \le 10^9$) indicating a query asking for the result after $k_i$ rounds.
## 输出格式

For each query output one line containing one integer indicating the answer.
## 样例

### 样例输入 #1
```
4 4
2 4 1 3
1
2
3
4
```
### 样例输出 #1
```
25
20
25
30
```
## 提示

The sample test case is explained below.

$$
\begin{array}{|c|c|c|c|c|c|} \hline \textbf{Round} & \textbf{b1} & \textbf{b2} & \textbf{b3} & \textbf{b4} & \textbf{Answer} \\\hline 
1 & 3 & 1 & 4 & 2 & 25 \\\hline
2 & 4 & 3 & 2 & 1 & 20 \\\hline
3 & 2 & 4 & 1 & 3 & 25 \\\hline
4 & 1 & 2 & 3 & 4 & 30 \\\hline
\end{array}
$$
## 题目翻译

**【题目描述】**

有 $n$ 个孩子和 $n$ 个球在玩游戏。孩子和球都从 $1$ 编号到 $n$。

游戏开始前，给出了 $n$ 个整数 $p_1, p_2, \cdots, p_n$。在游戏的每一轮中，孩子 $i$ 会把他手里的球传给孩子 $p_i$。保证没有孩子会把他手里的球传给自己，也就是说 $p_i \neq i$。此外，我们还知道在每一轮之后，每个孩子手里都会正好持有一个球。

设 $b_i$ 表示孩子 $i$ 所持有的球。在游戏开始时，孩子 $i$（$1 \le i \le n$）将携带球 $i$，也就是说 $b_i=i$。你需要处理 $q$ 个查询。对于每个查询，你会得到一个整数 $k$，你需要计算在 $k$ 轮后 $\sum\limits_{i=1}^{n} i \times b_i$ 的值。


**【输入格式】**

输入的第一行包含两个整数 $n$（$2 \le n \le 10^5$）和 $q$（$1 \le q \le 10^5$），表示孩子的数量和查询的数量。

第二行包含 $n$ 个整数 $p_1, p_2, \cdots, p_n$（$1 \le p_i \le n$），表示孩子之间传球的方式。

接下来的 $q$ 行中，第 $i$ 行包含一个整数 $k_i$（$1 \le k_i \le 10^9$），表示询问在 $k_i$ 轮后的结果。

**【输出格式】**

对于每个查询，输出一行包含一个整数，表示答案。

**【样例解释】**

示例测试用例解释如下。

$$
\begin{array}{|c|c|c|c|c|c|} \hline \textbf{轮次} & \textbf{b1} & \textbf{b2} & \textbf{b3} & \textbf{b4} & \textbf{答案} \\\hline 
1 & 3 & 1 & 4 & 2 & 25 \\\hline
2 & 4 & 3 & 2 & 1 & 20 \\\hline
3 & 2 & 4 & 1 & 3 & 25 \\\hline
4 & 1 & 2 & 3 & 4 & 30 \\\hline
\end{array}
$$

翻译来自于：[ChatGPT](https://chatgpt.com/)。


---


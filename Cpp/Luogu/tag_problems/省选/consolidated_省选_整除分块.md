---
title: "「FAOI-R2」霜雪千年"
layout: "post"
diff: 省选/NOI-
pid: P10037
tag: ['动态规划 DP', '数学', '2024', '洛谷原创', 'O2优化', '整除分块']
---
# 「FAOI-R2」霜雪千年
## 题目背景

**注：本题原名梨花开，介于赛时题面有误，且原题面可读性较低，于 2024 年 3 月重写题面并改名。改标题不便赛时选手重新找到该题，但出题人意识到时修改已久，不便改回。在此致歉。**

> 在这老街回眸 烟云中追溯我是谁  
只消暮雨点滴 便足以粉饰这是非  
待这月色涌起 谁人轻叩这门扉  
苔绿青石板街 斑驳了流水般岁月  
小酌三盏两杯 理不清缠绕的情结  
在你淡漠眉间 瞥见离人的喜悲霜雪

洛天依看到了一颗雪中的梨树，梨树的根中有有限的热量，它可以向上需要传递热量到其他节点。但风雪很大，每时每刻每个节点热量都会增加会增加或减少，热量过低的节点会掉落。
## 题目描述

具体来说，这棵梨树可以被抽象为一颗以 $1$ 号结点为根的树，初始时每个点都是白色。每个点有热量 $a_i$，初始时 $1$ 以外所有点的热量都为 $0$，$a_1=k$。我们设一个累计热量 $b$。

我们通过如下操作定义一个序列 $\{v_t\}$ 的权值：
- 从小到大度过 $1,2,3,\dots,t$ 这 $t$ 个时刻。
- 在第 $x$ 个时刻，执行 $b\gets b+v_x$。
- 对于父子 $(u,v)$，设 $u$ 为父亲，可以选定整数 $h\in[0,a_u]$ 执行操作 $a_u\gets a_u-h$，$a_v\gets a_v+h$，之后该时刻内形如 $(v,w)$ 且 $v$ 为父亲的父子不能操作。
- 若一个点 $i$ 满足 $a_i+b<0$，将 $i$ 以及 $i$ 的子树中的点染成黑色。
- 执行最优操作以最大化第 $t$ 时刻后的白点个数，该序列权值即为最大白点个数。

定义一个序列 $\{v_t\}$ 合法当且仅当 $\forall i\in[1,t]$，$\lvert v_i\rvert\in[0,m]$。给定 $t$，求出所有合法序列 $\{v_t\}$ 的权值之和对 $998244353$ 取模后的值。
## 输入格式

第一行四个非负整数 $n,m,t,k$，分别表示树的结点个数，$v_i$ 的取值范围，时刻数，初始时的 $a_1$。

接下来 $n-1$ 行，每行两个正整数 $u,v$，表示 $u$ 号结点与 $v$ 号结点之间有一条边。
## 输出格式

输出所有合法序列的和对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
1 1 1 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3 1 2 2
1 2
1 3
```
### 样例输出 #2
```
22
```
### 样例输入 #3
```
5 2 3 5
1 2
2 3
2 4
4 5
```
### 样例输出 #3
```
407
```
### 样例输入 #4
```
10 5 6 44
1 2
1 3
2 5
2 6
3 4
6 7
6 8
4 9
9 10
```
### 样例输出 #4
```
10465095
```
## 提示

### 样例解释

样例 $3$ 解释：

对于一种 $\{v_3\}=\{1,0,-2\}$ 的情况，一种最优操作如下：
- 第一个时刻，$1$ 号结点传递 $4$ 热量给 $2$ 号结点，操作完毕后 $a=\{1,4,0,0,0\}$，$b=1$。
- 第二个时刻，$2$ 号结点传递 $2$ 热量给 $4$ 号结点，操作完毕后 $a=\{1,2,0,2,0\}$，$b=1$。
- 第三个时刻，$2$ 号结点传递 $1$ 热量给 $3$ 号结点，$4$ 号结点传递 $1$ 热量给 $5$ 号结点，操作完毕后 $a=\{1,1,1,1,1\}$，$b=-1$。
- 所有时刻结束，因为始终没有 $a_i+b<0$ 的点，所以所有结点为白色。

样例 $4$ 解释：

对于一种 $\{v_{6}\}=\{1,2,1,2,1,2\}$ 的情况，一种最优操作如下：
- 第 $1\sim 6$ 个时刻，不进行操作。
- 所有时刻结束，因为始终没有 $a_i+b<0$ 的点，所以所有结点为白色。

### 数据范围与约定

**本题采用捆绑测试。**

| Subtask 编号 | $n \le$ | $m \le$ | $t \le$ | $k \le$ | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $4$ | $4$ | $4$ | $40$ | $20$ | × |
| $1$ | $2 \times 10^5$ | $20$ | $20$ | $1 \times 10^5$ | $10$ | $\checkmark$ |
| $2$ | $2 \times 10^5$ | $20$ | $20$ | $3 \times 10^5$ | $20$ | × |
| $3$ | $2 \times 10^5$ | $50$ | $100$ | $3 \times 10^5$ | $10$ | × |
| $4$ | $2 \times 10^5$ | $50$ | $500$ | $3 \times 10^5$ | $40$ | × |

特殊性质：保证树的形态是菊花。

对于 $100\%$ 的数据，$1\leq n\leq 2\times 10^5$，$1\leq k\leq 3\times 10^5$，$1\leq m\leq 50$，$1\leq t\leq 500$，保证输入构成一棵树。


---

---
title: "报社天狗"
layout: "post"
diff: 省选/NOI-
pid: P11772
tag: ['数论', '洛谷原创', 'O2优化', '分块', '洛谷月赛', '整除分块']
---
# 报社天狗
## 题目背景

因为天依想不到新歌歌词怎么写破防了，所以这题的主人公不是天依。
## 题目描述

新一期《文文。新闻》开售了！

$n$ 只$^\dag$妖怪排队购买《文文。新闻》，将她们依次编号 $1\sim n$，每一只妖怪会购买若干份。然而，她们购买《文文。新闻》并不是为了阅读，而是是为了送给所有编号是自己倍数的的妖怪一份（自己可以不留）。也就是说，对于 $1\sim n$ 的每只妖怪，依次进行：当手上的《文文。新闻》数量足够时，不进行购买，直接赠送；而不够时便会先向文文购买至刚好足够，再进行赠送。

文文为了使收益最大化，为每只妖怪详细制定了价格方案。具体地，第 $i$ 只妖怪在已有 $j$ 份《文文。新闻》时再买一份花费的价钱是 $a_i\times b_{j+1}$，其中 $a,b$ 是两个从 $1$ 开始的长为 $10^6+1$ 的正整数序列。

现在文文需要一个合理的定价方案，她决定从 $a,b$ 全为 $1$ 时开始调整。具体地，有以下三种操作：

- `1 x` 询问以当前的 $a,b$ 数组，$n=x$ 时文文能有多少营业额，因为结果可能很大，你需要求出答案对 $2^{32}$ 取模后的结果。
- `2 x y` 适当地调整 $a$ 数组的值：令 $a_x=y$；
- `3 x y` 适当地调整 $b$ 数组的值：令 $b_x=y$。

$\dag$：经查证，量词为『只』和『个』的情况均有出现，THBwiki 中『一只妖怪』的匹配量显著多于『一个妖怪』，于是本题中采用『只』，并不是出题人的种族歧视。
## 输入格式

第一行一个整数 $T$ 表示操作的数量。

第 $2\sim T+1$ 行，每行 $2$ 或 $3$ 个整数，表示题目中的一次操作。
## 输出格式

每行一个整数，表示每次询问的获利对 $2^{32}$ 取模后的结果。
## 样例

### 样例输入 #1
```
5
1 5
2 2 5
3 1 3
1 5
1 6
```
### 样例输出 #1
```
4
6
12
```
## 提示

### 样例解释

第一个询问中，$n=5$，两个序列中所有的元素均为 $1$。$1$ 号妖怪买了 $4$ 份报纸，每份报纸的收益都是 $1$，其他的妖怪都没有买报纸，总收益为 $4$。

第二个询问中，有 $n=5,a_2=3,b_1=5$，序列中其他元素均为 $1$。$1$ 号妖怪买了 $4$ 份报纸，其中第 $1$ 份报纸的收益是 $3$，第 $2$ 份到第 $4$ 份报纸的收益都是 $1$，其他的妖怪都没有买报纸，总收益为 $6$。

第三个询问中，有 $n=6,a_2=3,b_1=5$，序列中其他元素均为 $1$。让我们具体来看看这次询问中的过程：

+ $1$ 号妖怪需要送其他每个妖怪各一份报纸，但是她没有报纸。于是她需要买 $5$ 份报纸。其中第一份报纸的收益是 $a_1\times b_1=3$，第 $2$ 份到第 $5$ 份报纸的收益都是 $1$。然后她给了其他每个妖怪各一份报纸。

+ $2$ 号妖怪需要送 $4$ 号妖怪和 $6$ 号妖怪各一份报纸，她已经从 $1$ 号妖怪手中获得了一份报纸。于是她还需要买 $1$ 份报纸，这份报纸的收益是 $a_2\times b_2=5$。

+ $3$ 号妖怪需要送 $6$ 号妖怪一份报纸，她已经从 $1$ 号妖怪手中获得了一份报纸，不需要再买报纸。

+ $4$ 号妖怪到 $6$ 号妖怪都不需要送出报纸，也不需要再买报纸。

总收益为 $12$。

### 数据规模与约定

**本题采用捆绑测试。** 仅当你通过了该子任务的全部测试数据才能获得该子任务的分值。

对于 $100\%$ 的数据，$1 \leq T \leq 10^5$，$1 \leq x,n\leq 10^6$，$1\le y\le 10^9$。

对于不同的子任务，作如下约定：

| 子任务编号 |  特殊性质                  | 子任务分值 |
| :-----: | :----------------------------------: | :----: |
|    $1$    |      没有修改操作                      | $10$ |
|    $2$    | 第一种操作中的每个 $n$ 都相等 | $20$ |
|    $3$    |    $n,T \leq 10^5$                   | $30$ |
|    $4$    | 无 | $40$ |


---

---
title: "「Stoi2025」爱的飞行日记"
layout: "post"
diff: 省选/NOI-
pid: P11888
tag: ['2025', '数论', 'O2优化', '莫比乌斯反演', '容斥原理', '逆元', '洛谷比赛', '整除分块', 'Dirichlet 卷积', '筛法']
---
# 「Stoi2025」爱的飞行日记
## 题目背景

![](bilibili:BV1fx411N7bU?page=125)
## 题目描述

$t$ 组询问，每次询问给定正整数 $n,m$，计算

$$\prod_{a_1=1}^{m}\prod_{a_2=1}^{m}\cdots\prod_{a_n=1}^{m}\operatorname{lcm}(f_{a_1},f_{a_2},\dots,f_{a_n})\bmod{37426667}$$

的值。其中 $f_i$ 是斐波那契数，满足 $f_1=f_2=1$，且 $f_i=f_{i-1}+f_{i-2},\forall n\ge3$。
## 输入格式

第一行输入一个正整数 $t$ 表示询问组数。

接下来 $t$ 行，每行两个正整数 $n,m$ 表示一次询问。
## 输出格式

每次询问输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2
1 3
2 3

```
### 样例输出 #1
```
2
32

```
## 提示

#### 样例解释

对于第一组询问，有答案为 $f_1f_2f_3=1\times1\times2=2$。

对于第二组询问，当 $a_1,a_2\in\{1,2\}$ 时 $\operatorname{lcm}(f_{a_1},f_{a_2})=1$，否则 $\operatorname{lcm}(f_{a_1},f_{a_2})=2$。故答案为 $2^5=32$。

#### 数据范围与限制

**本题采用捆绑测试，各 Subtask 的限制与分值如下。**

| Subtask No. | $t\le$ | $n\le$ | $m\le$ | 分值 |
| :-: | :-: | :-: | :-: | :-: |
| $1$ | $1$ | $2$ | $2 \times 10^3$ | $13$ |
| $2$ | $5$ | $2 \times 10^5$ | $2 \times 10^5$ | $24$ |
| $3$ | $5$ | $2 \times 10^7$ | $2 \times 10^7$ | $36$ |
| $4$ | $300$ | $2 \times 10^{17}$ | $2 \times 10^7$ | $27$ |

对于所有数据，满足 $1 \le t \le 300, 1 \le n \le 2 \times 10^{17}, 1 \le m \le 2 \times 10^7$。


---

---
title: "「CZOI-R6」抽奖"
layout: "post"
diff: 省选/NOI-
pid: P13791
tag: ['数学', 'O2优化', '期望', '整除分块']
---
# 「CZOI-R6」抽奖
## 题目描述

公园里出现了一台抽奖机！根据小道消息，抽奖机在接下来的 $n$ 天的某一天晚上会撤走。抽奖机最终在每天晚上撤走的概率都相等。

你想在这 $n$ 天进行抽奖。初始时，你有一个中奖概率 $p = 0$。

每一天上午，你都会积攒运气，使得 $p$ 增加 $\frac{1}{n}$。

每一天下午，你都可以选择抽奖或不抽奖。若抽奖，设当前为第 $i$ 天，则你需要花费 $\frac{n}{n-i+1}$ 的代价，以 $p$ 的概率使得你的收益增加 $w$，且让 $p$ 重置为 $0$。$w$ 是一个固定的常量。

你制订了一个最优的策略以最大化你获得的收益减你付出的代价。你想知道假如你按照此策略，期望的收益减代价为多少。

**出于某种原因，你需要输出期望值乘 $\boldsymbol{n^2}$ 后对 $\boldsymbol{10^9 + 7}$ 取模的结果**。
## 输入格式

**本题有多组测试数据。**

第一行 $1$ 个整数 $T$，表示数据组数。

接下来 $T$ 行，每行 $2$ 个整数，依次为 $n, w$。
## 输出格式

输出 $T$ 行。每行输出 $1$ 个整数，表示期望值乘 $n^2$ 后对 $10^9 + 7$ 取模的结果。
## 样例

### 样例输入 #1
```
7
1 2
2 1
5 3
10 15
347 1562
724 15
283917 192034
```
### 样例输出 #1
```
1
0
2
400
87949316
1579768
172877821

```
## 提示

**【数据范围】**

**本题采用捆绑测试。**



| 子任务编号 |    $T \leq$    | $n \leq$ |    $w \leq$     | 分值 |
| :--------: | :------------: | :------: | :-------------: | :--: |
|    $1$     |      $5$       |   $20$   |      $50$       | $15$ |
|    $2$     |      $5$       |  $10^3$  | $3 \times 10^3$ | $15$ |
|    $3$     |      $20$      |  $10^6$  |     $10^6$      | $30$ |
|    $4$     | $5\times 10^3$ |  $10^6$  |     $10^6$      | $40$ |

对于 $100\%$ 的数据，$1\leq T\leq 5\times 10^3$，$1\leq n,w\leq10^6$。


---

---
title: "[清华集训 2012] 模积和"
layout: "post"
diff: 省选/NOI-
pid: P2260
tag: ['数学', '2012', 'CTT（清华集训/北大集训）', '整除分块']
---
# [清华集训 2012] 模积和
## 题目背景

数学题，无背景。

## 题目描述

求

$$\sum_{i=1}^{n} \sum_{j=1}^{m} (n \bmod i) \times (m \bmod j), i \neq j$$

mod 19940417 的值
## 输入格式

输入只有一行两个整数 $n$，$m$。
## 输出格式

答案 mod 19940417

## 样例

### 样例输入 #1
```
3 4
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
123456 654321
```
### 样例输出 #2
```
116430
```
## 提示

#### 数据规模与约定

- 对于 $10\%$ 的数据，保证 $n,m \leq 10^3$。
- 对于 $30\%$ 的数据，保证 $n,m \leq 10^6$。
- 另有 $30\%$ 的数据，保证 $n \leq 100$。
- 对于 $100\%$ 的数据，保证 $1 \leq n,m \leq 10^9$。




---


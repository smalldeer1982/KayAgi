---
title: "[UESTCPC 2024] 打字"
layout: "post"
diff: 省选/NOI-
pid: P10333
tag: ['2024', 'O2优化', '斜率优化', '高校校赛']
---
# [UESTCPC 2024] 打字
## 题目描述

给定一颗 $n$ 个节点的 trie 树，以 $1$ 号节点为根，其余每个节点到父亲的边上都有一个字符，且父亲相同的节点到父亲的边上的字符互不相同。从根到每个节点的路径都代表一个单词，这个单词由路径上的字符顺序拼接而成。在每个节点 $i$ 处有一个权值 $c_i$，表示该节点所代表的单词需要写出的次数。

你有一个 cache，可以选择任意个单词放在 cache 里面。写单词时，每写一个字符需要花费 $a$ 的代价。当写出一个完整的单词时，就可以选择结束当前单词，转而拼写下一个单词。而 cache 会根据当前已经写出的字符，把 cache 中以这一部分字符为前缀且字典序最小的单词提示出来。此时你可以花费 $b$ 的代价直接写出这个单词，**并结束当前单词的拼写**，转而拼写下一个单词。注意一个字符串本身也看作它自己的前缀。

求完成 trie 树上所有单词的拼写所需的最小代价。
## 输入格式

第一行输入三个整数 $n,a,b$ $(1\leq n\leq 2\times 10^5,0\leq a,b\leq 10^4)$，分别表示 trie 树的大小、写一个字符的代价和使用 cache 写出单词的代价。

接下来 $n$ 行，其中第 $i$ 行首先输入两个整数 $c_i,k_i$ $(0\leq c_i\leq 10^4,0\leq k_i<n)$，分别表示第 $i$ 个节点上的权值和第 $i$ 个节点的儿子节点的个数。接下来输入 $k_i$ 个整数 $son_{i,1},son_{i,2},\ldots,son_{i,k_i}$，表示第 $i$ 个节点的儿子节点编号，按照第 $i$ 个节点到儿子节点的边上的字符之间的字典序从小到大依次给出。

保证 $c_1=0$。
## 输出格式

输出一行一个整数，表示完成 trie 树上所有单词的拼写所需的最小代价。
## 样例

### 样例输入 #1
```
4 2 3
0 2 3 2
3 0
2 1 4
4 0
```
### 样例输出 #1
```
22
```
## 提示

**【样例解释】**

假设每个节点的子节点按字典序从小到大按 $a,b,\ldots$ 编码。最优方案为将 $aa$ 放在 cache 中，于是 $aa$ 可以花费 $3\times 4$
的代价利用提示打出来，$a$ 和 $b$
都直接打出来。总代价为 $3\times 4+2\times 1\times 2+2\times 1\times 3=22$。


---

---
title: "[CEOI 2009] Harbingers"
layout: "post"
diff: 省选/NOI-
pid: P10602
tag: ['动态规划 DP', '2009', '二分', 'O2优化', 'CEOI（中欧）', '斜率优化', '单调栈']
---
# [CEOI 2009] Harbingers
## 题目描述

给定一颗树，树中每个结点有一个邮递员，每个邮递员要沿着唯一的路径走向 capital（$1$ 号结点），每到一个城市他可以有两种选择：

1. 继续走到下个城市；
2. 让这个城市的邮递员替他出发。

每个邮递员出发需要一个准备时间 $W_i$，他们的速度是 $V_i$，表示走一公里需要多少分钟。现在要你求出每个城市的邮递员到 capital 的最少时间（不一定是他自己到 capital，可以是别人帮他）？
## 输入格式

第一行一个正整数 $N$；

接下来 $N-1$ 行，每行三个正整数 $A,B,C$，表示结点 $A$ 和 $B$ 之间有一条长度为 $C$ 的边；

再接下来 $N-1$ 行，每行 $2$ 个整数 $W_i,V_i$。
## 输出格式

输出每个城市的邮递员到 capital 的最少时间。
## 样例

### 样例输入 #1
```
5
1 2 20
2 3 12
2 4 1
4 5 3
26 9
1 10
500 2
2 30
```
### 样例输出 #1
```
206 321 542 328
```
## 提示

对于 $20\%$ 的数据，$N\leq 2500$；

对于 $50\%$ 的数据，树是一条链；

对于所有数据，$3\leq N\leq 10^5$，$0\leq W_i,V_i\leq 10^9$，每条边长度不超过 $10^4$。


---

---
title: "[ROI 2017] 前往大都会 (Day 1)"
layout: "post"
diff: 省选/NOI-
pid: P10652
tag: ['动态规划 DP', '2017', 'O2优化', '斜率优化', '最短路', 'ROI（俄罗斯）']
---
# [ROI 2017] 前往大都会 (Day 1)
## 题目描述

ROI 国有 $n$ 个城市，以及 $m$ 条铁路，每条铁路都是**单向**运行的，第 $i$ 条铁路依次经过 $v_{i,1},v_{i,2},\dots,v_{i,l_i+1}$ 号城市并停靠，其中 $v_{i,j} \to v_{i,j+1}$ 的铁路长度是 $t_{i,j}$。

如果多条铁路经过 $u$ 号城市，那么你可以在 $u$ 号城市换乘其他铁路。（每条铁路都可以在停靠点任意上车/下车）

你需要找到一条从 $1$ 号城市到 $n$ 号城市的路径，这条路径需要满足其总长度最小，并且在此条件上路径上相邻两个**换乘点**间**火车上**距离的平方和最大。

注：起点和终点都是换乘点，题目保证有解。
## 输入格式

第一行两个整数 $n,m$ 表示有 $n$ 个城市，$m$ 条铁路。

接下来 $m$ 行，每行先是一个整数 $l_i$ 表示铁路长度，接下来 $2l_i+1$ 个整数形如 $v_{i,1},t_{i,1},v_{i,2},\dots,v_{i,l_i},t_{i,l_i},v_{i,l_i+1}$，含义如题所示。
## 输出格式

一行两个整数，第一个数表示最短路径长度，第二个数表示平方和最大值。
## 样例

### 样例输入 #1
```
2 1
1 1 3 2
```
### 样例输出 #1
```
3 9
```
### 样例输入 #2
```
5 2
4 1 3 2 3 3 5 5 10 4
3 4 2 2 1 3 4 1
```
### 样例输出 #2
```
9 35
```
### 样例输入 #3
```
5 2
3 1 1 2 2 3 3 4
3 2 2 3 3 4 4 5
```
### 样例输出 #3
```
10 82
```
## 提示

#### 【样例解释】

对于样例组 #2：

从 $1$ 号城市乘坐 $1$ 号线直达 $5$ 号城市并非最佳方案（无法达到最短时间）。最佳方案：

>从 $1$ 号城市乘坐 $1$ 号线到 $2$ 号城市；
>
> 换乘 $2$ 号线，坐到 $3$ 号城市；
>
> 再换乘 $1$ 号线，坐到 $5$ 号城市。

此时，平方和为 $3^2 + 1^2 + 5^2 = 35$。

对于样例组 #3：

无论是在中途哪一站转 $2$ 号线，结果都一样。平方和为 $1^2+9^2=81$。

#### 【数据范围】

注：本题只放部分数据，完整数据请左转 [LOJ P2769](https://loj.ac/p/2769) 评测。

对于所有数据：$1 \le m \le 10^6$，$1 \le v_{i,j} \le n$，$1 \le t_{i,j} \le 1000$，设 $sum=\sum l_i$。

| 子任务编号 | 分值 | $1 \le n \le $ | $1 \le sum \le $ |特殊性质|
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $10$ | $10$ | $20$ |$l_i=1$|
| $2$ | $10$ | $10^3$ | $10^3$ |$l_i=1$|
| $3$ | $17$ | $10^3$ | $10^3$ |无|
| $4$ | $17$ | $10^3$ | $10^5$ |无|
| $5$ | $19$ | $10^4$ | $2 \times 10^5$ |无|
| $6$ | $19$ | $2 \times 10^5$ | $2 \times 10^5$ |无|
| $7$ | $8$ | $10^6$ | $10^6$ |无|



---

---
title: "[COTS 2020] 王国 Kraljevstvo"
layout: "post"
diff: 省选/NOI-
pid: P11023
tag: ['2020', 'O2优化', '斜率优化', '四边形不等式', '凸包', 'COCI（克罗地亚）']
---
# [COTS 2020] 王国 Kraljevstvo
## 题目背景

译自 [Izborne Pripreme 2020 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2020/) D1T1。$\texttt{1s,0.5G}$。

## 题目描述


给定二维平面上的 $N$ 个点。选择 $K$ 个点，最大化这 $K$ 个点的凸包面积。

此外，要求必须选择平面上 $x$ 坐标最小/最大的两个点。保证这两个点所在的与 $y$ 轴平行的直线上没有其他点，且这两个点的 $y$ 坐标为 $0$。

只需要输出最大的面积。

## 输入格式


第一行，两个正整数 $N,K$。

接下来 $N$ 行，每行两个整数 $x_i,y_i$，描述一个点。

## 输出格式


输出一行一个实数，表示凸包的最大面积。

输出不应有多余的前导零或后导零。
## 样例

### 样例输入 #1
```
6 4
0 0
9 0
2 8
6 5
2 -7
8 -7
```
### 样例输出 #1
```
67.5
```
### 样例输入 #2
```
5 3
0 0
10 0
5 0
5 5
5 -5
```
### 样例输出 #2
```
25
```
### 样例输入 #3
```
8 5
0 0
15 0
2 -2
4 12
10 -14
6 -12
2 -10
13 10
```
### 样例输出 #3
```
238
```
## 提示

####

- 样例 $1$ 解释：选择 $(0, 0), (2, −7),(2, 8) , (9, 0) $ 即可。
- 样例 $2$ 解释：选择 $(0, 0), (10, 0) ,
(5, −5) $ 即可。

亦可参阅下图。

![](https://cdn.luogu.com.cn/upload/image_hosting/jp2ibsfe.png)



#### 数据范围

对于 $100\%$ 的数据，保证：

- $3\le K\le N\le 3\, 000$；
- 给出的点不重合；
- $x$ 坐标最小/最大的点唯一，且对应的点的 $y$ 坐标为 $0$。


| 子任务编号 | $N\le $ | 得分 |  
| :--: | :--: | :--: |
| $ 1 $    | $20$ |$ 11 $   |  
| $ 2 $    | $100$ | $ 25 $   |  
| $ 3 $    | $500$ | $ 15 $   |  
| $ 4 $    | $3\, 000$ | $ 49 $   |  


---

---
title: "[APC001] Ex - Separation"
layout: "post"
diff: 省选/NOI-
pid: P11142
tag: ['Special Judge', 'O2优化', '斜率优化']
---
# [APC001] Ex - Separation
## 题目描述

小 I 有 $n$ 个工厂，坐落在 $A$ 地到 $B$ 地，第 $i$ 个工厂距离 $A$ 地的距离为 $a_i$ 千米。加工厂位于 $B$ 地，距离 $A$ 地 $x$ 千米，小 I 要把这些工厂里的货物运送到 $B$ 地的加工厂。

但是这天下了暴雨，仓库里的货物受潮了，每份货物每在仓库中或小 I 的背包中存放 $1$ 分钟，价值就会减少 $m$ 元钱。已知今天晚上每个工厂会生产出 $b_i$ 份货物，也知道每份货物会在暴雨来临几分钟后生产出来。

小 I 的初始体力为 $c$，速度为每分钟 $1$ 千米，但是他每行走 $1$ 千米就会减少一点体力（当体力为 $0$ 时不允许行走）。每次出发小 I 都要从 $A$ 地前往 $B$ 地，再返回 $A$ 地，他**只**在从 $A$ 地前往 $B$ 地时会带走沿途的工厂的仓库内所有被生产出的货物。他到达 $A$ 地后可以立刻再次出发。特别的，他可以在**负数时间点**出发，假定他的背包是无限大的，且货物重量与体力消耗无关。

小 I 为了亏损更少，制造了一个分身制造器。这个机器可以制造无数个他的分身，但是每一次出发最多只能制造一个分身，制造的分身与本体共用体力，**完全遵循第 $3$ 段所描述的操作**。小 I 需要保证在任何时候，现有体力都能支持每一个分身（包括本体）返回 $A$ 地的家。

小 I 做完准备工作后，发现暴雨已经下了 $k$ 分钟了，他迫切想要知道他最少要亏损（即货物减少的价值）多少元。他不会这个问题，于是他向你求助，想让你给出一种方案。
## 输入格式

**本题单测试点内有多组测试数据**。

第一行一个整数 $t$，表示数据组数。

接下来，对于每组数据：

第一行五个整数 $n,m,x,c,k$。

接下来一行 $n$ 个整数 $a_1\sim a_n$。

接下来一行 $n$ 个整数 $b_1\sim b_n$。

接下 $n$ 行，每行 $b_i$ 个整数，表示第 $i$ 个工厂内的货物在第 $t_{i,j}$ 分钟后生产。
## 输出格式

对于每组数据：

若小 I 不可能将所有货物运送至加工厂并回家，输出一行一个 `-1`。

否则第一行一个整数，表示小 I 最少要亏损多少元。

接下来若干行，每行两个数，对于第 $i$ 行：

- 第一个数表示小 I 第 $i$ 次出发的时间（从他向你求助时计算），必须从小到大输出，时间可以为负。

- 第二个数表示这次出发是否需要制造一个新的分身，如果需要，输出 $1$，否则输出 $0$。

如果存在方案且方案输出完后，输出一行 `-1 -1`，表示方案结束。
## 样例

### 样例输入 #1
```
1
1 2 2 5 1
1
2
3 4
```
### 样例输出 #1
```
6
2 0
-1 -1
```
### 样例输入 #2
```
1
1 1 1 5 1
1
2
3 4
```
### 样例输出 #2
```
0
1 0
2 1
-1 -1
```
### 样例输入 #3
```
4
1 1 2 5 1
1
2
3 4
1 1 4 8 2
1
2
5 8
2 2 3 9 9
1 2
2 1
3 7
5
1 1 2 8 4
1
3
1 2 3
```
### 样例输出 #3
```
3
2 0
-1 -1
9
5 0
-1 -1
24
-3 0
-1 -1
4
-3 0
-2 1
-1 -1
```
## 提示

**【样例解释】**

对于样例 $3$ 的第一组数据解释：

小 I 在暴雨来临后 $1$ 分钟向你求助，你给出的方案是在暴雨来临后 $3$ 分钟，小 I 出门，在 $4$ 分钟到达 $1$ 号仓库，在 $5$ 分钟到达 $B$ 地，在 $7$ 分钟回到家，亏损 $3$ 元。

**【数据范围】**

对于全部数据，保证 $1\leq t\leq 10$，$1\leq n\leq 2\times 10^5,1\leq m,k,x\leq 10^6$，$1\le a_i\le x$，$0\leq c\leq 200$，$1\leq b_i\leq 10^5$，$\sum b_i\leq 2\times 10^5$，$0\leq t_{i,j}\leq 10^6$。

**本题输入量较大，请使用较快的读入方式。**

本题题面已更新，[赛时原题面](https://www.luogu.com.cn/paste/iebvx9ko)


---

---
title: "[ZJOI2007] 仓库建设"
layout: "post"
diff: 省选/NOI-
pid: P2120
tag: ['2007', '各省省选', '浙江', '动态规划优化', '斜率优化']
---
# [ZJOI2007] 仓库建设
## 题目描述

L 公司有 $n$ 个工厂，由高到低分布在一座山上，工厂 $1$ 在山顶，工厂 $n$ 在山脚。

由于这座山处于高原内陆地区（干燥少雨），L公司一般把产品直接堆放在露天，以节省费用。突然有一天，L 公司的总裁 L 先生接到气象部门的电话，被告知三天之后将有一场暴雨，于是 L 先生决定紧急在某些工厂建立一些仓库以免产品被淋坏。

由于地形的不同，在不同工厂建立仓库的费用可能是不同的。第 $i$ 个工厂目前已有成品 $p_i$ 件，在第 $i$ 个工厂位置建立仓库的费用是 $c_i$。

对于没有建立仓库的工厂，其产品应被运往其他的仓库进行储藏，而由于 L 公司产品的对外销售处设置在山脚的工厂 $n$，故产品只能往山下运（即**只能运往编号更大的工厂的仓库**），当然运送产品也是需要费用的，一件产品运送一个单位距离的费用是 $1$。

假设建立的仓库容量都都是足够大的，可以容下所有的产品。你将得到以下数据：

- 工厂 $i$ 距离工厂 $1$ 的距离 $x_i$（其中 $x_1=0$）。
- 工厂 $i$ 目前已有成品数量 $p_i$。
- 在工厂 $i$ 建立仓库的费用 $c_i$。

请你帮助 L 公司寻找一个仓库建设的方案，使得总的费用（建造费用 + 运输费用）最小。
## 输入格式

输入的第一行是一个整数 $n$，代表工厂的个数。

第 $2$ 到 $(n + 1)$ 行，每行有三个用空格隔开的整数，第 $(i + 1)$ 行的整数依次代表 $x_i,~p_i,~c_i$。
## 输出格式

仅输出一行一个整数，代表最优方案的费用。
## 样例

### 样例输入 #1
```
3
0 5 10
5 3 100
9 6 10
```
### 样例输出 #1
```
32

```
## 提示

#### 样例输入输出 $1$ 解释

在工厂 $1$ 和工厂 $3$ 建立仓库，建立费用为 $10+10=20$ ，运输费用为 $(9-5) \times 3 = 12$，总费用 $32$。

#### 数据范围与约定

对于 $20\%$ 的数据，保证 $n \leq 500$。

对于 $40\%$ 的数据，保证 $n \leq 10^4$。

对于 $100\%$ 的数据，保证 $1 \leq n \leq 10^6$，$0 \leq x_i,p_i,c_i < 2^{31}$。

对于任意的 $1 \leq i < n$，保证 $x_i < x_{i + 1}$。

设答案为 $ans$，保证 $ans + \sum\limits_{i = 1}^{n} p_ix_i < 2^{63}$。


---

---
title: "[SDOI2012] 基站建设"
layout: "post"
diff: 省选/NOI-
pid: P2497
tag: ['动态规划 DP', '2012', '线段树', '各省省选', '平衡树', '山东', 'cdq 分治', '斜率优化']
---
# [SDOI2012] 基站建设
## 题目描述

up 主家终于买电脑了，但是接下来有各种问题要处理。首要解决的问题就是网络问题。他要从移动公司开始，通过一些基站来传递网络到他家。

为了简化问题，我们假设移动公司，所有的基站、up 主家位于同一条直线上，他们都位于这一条直线上的某一点 $x$，这些点**可能**会重合。每个基站发射和接收的范围都是一个切于地面的圆，发射的半径 $r$ 是固定的，接收半径 $r'$ 是可调的的。如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/nh8yxjx5.png)

一个点 $i$ 如果能从另一个点 $j$ 接收到信号（当且仅当 $x_j<x_i$），必须满足 $i$ 的接收范围与 $j$ 的发射范围相切，并且需要付 $\sqrt{r'_i}$ 的额外费用。同时启动每一个点 $i$ 都需要费用 $v_i$。

当然一个点如果能够发射的 up 主家只需要这个点的发射范围与 up 主家所在的竖线相切或相交即可，如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/5t4v8687.png)

当然费用越少就越好咯，于是 up 主想要请你帮他的忙。
## 输入格式

第一行两个整数 $n, m$。表示基站个数（包括移动公司），up 主家的坐标。（保证大于等于所有基站的坐标）

记下来 $n$ 行，每行三个整数 $x_i$，$r_i$，$v_i$，表示每个基站的坐标，发射范围以及费用。

$x_i$ 是按照坐标从小到大输入的，移动公司位于最小的那个坐标。

$r$ 为 $1\dots n$ 的排列。
## 输出格式

一个实数，保留小数点后三位。
## 样例

### 样例输入 #1
```
10 33
5 4 660
10 2 2040
11 6 3207
14 5 2006
18 3 6130
19 9 3363
22 1 1265
25 8 2836
27 10 7961
29 7 9075
```
### 样例输出 #1
```
3501.000
```
## 提示

对于 $100\%$ 的数据 $n\le5\times 10^5$，$x_i,m \le 10^{12}$，$v_i \le 10000$


---

---
title: "[USACO08MAR] Land Acquisition G"
layout: "post"
diff: 省选/NOI-
pid: P2900
tag: ['动态规划 DP', '2008', 'USACO', '斜率优化']
---
# [USACO08MAR] Land Acquisition G
## 题目描述

Farmer John 准备扩大他的农场，眼前他正在考虑购买 $N$ 块长方形的土地。

如果 FJ 单买一块土地，价格就是土地的面积。但他可以选择并购一组土地，并购的价格为这些土地中最大的长乘以最大的宽。比如 FJ 并购一块 $3 \times 5$ 和一块 $5 \times 3$ 的土地，他只需要支付 $5 \times 5=25$ 元， 比单买合算。

FJ 希望买下所有的土地。他发现，将这些土地分成不同的小组来并购可以节省经费。 给定每份土地的尺寸，请你帮助他计算购买所有土地所需的最小费用。
## 输入格式

第一行一个整数 $N$（$1 \leq N \leq 5 \times 10^4$）。

接下来 $N$ 行，每行两个整数 $w_i$ 和 $l_i$，代表第 $i$ 块土地的长和宽。保证土地的长和宽不超过 $10^6$。
## 输出格式

输出买下所有土地的最小费用。
## 样例

### 样例输入 #1
```
4 
100 1 
15 15 
20 5 
1 100 

```
### 样例输出 #1
```
500 

```
## 提示

将所有土地分为三组：

- 第一块土地为第一组，花费 $100 \times 1=100$；
- 第二，三块土地为第二组，花费 $20 \times 15=300$；
- 第四块土地为第三组，花费 $1 \times 100=100$；

总花费为 $500$，可以证明不存在更优的方案。


---

---
title: "[USACO11OPEN] Soldering G"
layout: "post"
diff: 省选/NOI-
pid: P3023
tag: ['动态规划 DP', '动态规划 DP', '2011', 'USACO', '斜率优化', '斜率优化', '树形 DP', '树形 DP']
---
# [USACO11OPEN] Soldering G
## 题目描述

The cows are playing with wires! They have learned a technique called soldering, in which they connect two pieces of wire together by attaching the endpoint of one wire to a location along the length of the other. (Soldering endpoint to endpoint is not allowed.) There can be multiple solder junctions at the same point.

The cows have a plan for an Amazing Structure they would like to build. It is in the form of a graph with N (1 <= N <= 50,000) nodes and N-1 edges of unit length so that each pair of nodes is connected. Each edge is described by a pair of integers, A and B (1 <= A <= N; 1 <= B <= N; A != B).

The cows are able to buy wire from a local store; however longer wire is more expensive. In particular the cows can buy a wire of length L with cost L\*L, but they cannot cut wires or join wires together.

Given the plan, the cows would like solder wires together to build their Amazing Structure. Please help them find the minimum possible cost!

Test data worth at least 50% of the points will have N <= 2,000.

Partial feedback will be provided on your first 50 submissions to this problem.

TIME LIMIT: 2 seconds

MEMORY LIMIT: 64 MB

奶牛决定用电线焊接出一个特殊图形，这个图形是连通的，由N个点，N -1条边组成， 每条边的长度都是1。焊接所用的电线要从当地的商店里买。越长的电线越贵，一条长度为 L的电线售价为L^2 。 奶牛们已经学会了基本的焊接方法， 她们会把某条电线的一个端点焊接到另一条电线的 中间某个位置， 但她们没有学会如何把两条电线的端点直接焊接起来， 也没有学会怎么把电 线剪断。 告诉你奶牛准备焊接的图形，请告诉奶牛怎么焊接才能最节约材料费用。

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N: Two space-separated integers describing an edge: A and B

## 输出格式

\* Line 1: A single integer, the cost of soldering the tree together. Note that this number may not always fit in a 32-bit integer.

## 样例

### 样例输入 #1
```
6 
1 2 
1 3 
1 4 
1 5 
1 6 

```
### 样例输出 #1
```
7 

```
## 提示

Since all nodes in the structure are connected to node 1, we only need to buy one wire of length 2 and three of length 1, for a total cost of 2 \* 2 + 1 \* 1 + 1 \* 1 + 1 \* 1 = 7.



---

---
title: "[HNOI2008] 玩具装箱"
layout: "post"
diff: 省选/NOI-
pid: P3195
tag: ['动态规划 DP', '2008', '单调队列', '湖南', '斜率优化']
---
# [HNOI2008] 玩具装箱
## 题目描述

P 教授要去看奥运，但是他舍不下他的玩具，于是他决定把所有的玩具运到北京。他使用自己的压缩器进行压缩，其可以将任意物品变成一堆，再放到一种特殊的一维容器中。

P 教授有编号为 $1 \cdots n$ 的 $n$ 件玩具，第 $i$ 件玩具经过压缩后的一维长度为 $C_i$。

为了方便整理，P 教授要求：

- 在一个一维容器中的玩具编号是连续的。

- 同时如果一个一维容器中有多个玩具，那么两件玩具之间要加入一个单位长度的填充物。形式地说，如果将第 $i$ 件玩具到第 $j$ 个玩具放到一个容器中，那么容器的长度将为 $x=j-i+\sum\limits_{k=i}^{j}C_k$。

制作容器的费用与容器的长度有关，根据教授研究，如果容器长度为 $x$，其制作费用为 $(x-L)^2$。其中 $L$ 是一个常量。P 教授不关心容器的数目，他可以制作出任意长度的容器，甚至超过 $L$。但他希望所有容器的总费用最小。
## 输入格式

第一行有两个整数，用一个空格隔开，分别代表 $n$ 和 $L$。

第 $2$ 到 第 $(n + 1)$ 行，每行一个整数，第 $(i + 1)$ 行的整数代表第 $i$ 件玩具的长度 $C_i$。
## 输出格式

输出一行一个整数，代表所有容器的总费用最小是多少。
## 样例

### 样例输入 #1
```
5 4
3
4
2
1
4
```
### 样例输出 #1
```
1
```
## 提示

对于全部的测试点，$1 \leq n \leq 5 \times 10^4$，$1 \leq L \leq 10^7$，$1 \leq C_i \leq 10^7$。


---

---
title: "[APIO2010] 特别行动队"
layout: "post"
diff: 省选/NOI-
pid: P3628
tag: ['动态规划 DP', '2010', '单调队列', 'APIO', '斜率优化', '前缀和', '队列']
---
# [APIO2010] 特别行动队
## 题目描述

你有一支由 $n$ 名预备役士兵组成的部队，士兵从 $1$ 到 $n$ 编号，你要将他们拆分成若干特别行动队调入战场。出于默契的考虑，同一支特别行动队中队员的编号**应该连续**，即为形如 $(i, i + 1, \cdots i + k)$的序列。所有的队员都应该属于且仅属于一支特别行动队。

编号为 $i$ 的士兵的初始战斗力为 $x_i$ ，一支特别行动队的初始战斗力 $X$ 为队内士兵初始战斗力之和，即 $X = x_i + x_{i+1} + \cdots + x_{i+k}$。

通过长期的观察，你总结出对于一支初始战斗力为 $X$ 的特别行动队，其修正战斗力 $X'= aX^2+bX+c$，其中 $a,~b,~c$ 是已知的系数（$a < 0$）。 作为部队统帅，现在你要为这支部队进行编队，使得所有特别行动队的修正战斗力之和最大。试求出这个最大和。
## 输入格式

输入的第一行是一个整数 $n$，代表士兵的人数。

输入的第二行有三个用空格隔开的整数，依次代表 $a,~b,~c$，即修正战斗力的系数。

输入的第三行有 $n$ 个用空格隔开的整数，第 $i$ 个整数代表编号为 $i$ 的士兵的初始战斗力 $x_i$。
## 输出格式

输出一行一个整数，代表最大的所有特别行动队战斗力之和。
## 样例

### 样例输入 #1
```
4 
-1 10 -20 
2 2 3 4 
```
### 样例输出 #1
```
9
```
## 提示

#### 样例输入输出 $1$ 解释

你有 $4$ 名士兵，$x_1 = 2,~x_2 = 2,~x_3 = 3,~x_4=4$。修正战斗力公式中的参数为  $a = -1,~b = 10,~c = -20$。

此时，最佳方案是将士兵组成 $3$ 个特别行动队：第一队包含士兵 $1$ 和士兵 $2$，第二队包含士兵 $3$，第三队包含士兵 $4$。特别行动队的初始战斗力分别为 $4,~3,~4$，修正后的战斗力分别为 $-4^2 + 10 \times 4 -20 = 4$，$-3^2 + 10 \times 3 - 20 = 1$，$-4^2 + 10 \times 4 -20 = 4$。修正后的战斗力和为 $4 + 1 + 4 = 9$，没有其它方案能使修正后的战斗力和更大。


#### 数据范围与约定

对于 $20\%$ 的数据，$n \leq 10^3$。

对于 $50\%$ 的数据，$n \leq 10^4$

对于 $100\%$ 的数据，$1 \leq n \leq 10^6$，$-5 \leq a \leq -1$，$-10^7 \leq b \leq 10^7$，$-10^7 \leq c \leq 10^7$，$1 \leq x_i \leq 100$。


---

---
title: "[APIO2014] 序列分割"
layout: "post"
diff: 省选/NOI-
pid: P3648
tag: ['2014', 'APIO', 'Special Judge', '枚举', '斜率优化', '前缀和']
---
# [APIO2014] 序列分割
## 题目描述

你正在玩一个关于长度为 $n$ 的非负整数序列的游戏。这个游戏中你需要把序列分成 $k + 1$ 个非空的块。为了得到 $k + 1$ 块，你需要重复下面的操作 $k$ 次：

选择一个有超过一个元素的块（初始时你只有一块，即整个序列）

选择两个相邻元素把这个块从中间分开，得到两个非空的块。

每次操作后你将获得那两个新产生的块的元素和的乘积的分数。你想要最大化最后的总得分。

## 输入格式

第一行包含两个整数 $n$ 和 $k$。保证 $k + 1 \leq n$。

第二行包含 $n$ 个非负整数 $a_1, a_2, \cdots, a_n$ $(0 \leq a_i \leq 10^4)$，表示前文所述的序列。

## 输出格式

第一行输出你能获得的最大总得分。

第二行输出 $k$ 个介于 $1$ 到 $n - 1$ 之间的整数，表示为了使得总得分最大，你每次操作中分开两个块的位置。第 $i$ 个整数 $s_i$ 表示第 $i$ 次操作将在 $s_i$ 和 $s_{i} + 1$ 之间把块分开。

如果有多种方案使得总得分最大，输出任意一种方案即可。

## 样例

### 样例输入 #1
```
7 3
4 1 3 4 0 2 3
```
### 样例输出 #1
```
108
1 3 5
```
## 提示

你可以通过下面这些操作获得 $108$ 分：

初始时你有一块 $(4, 1, 3, 4, 0, 2, 3)$。在第 $1$ 个元素后面分开，获得 $4 \times (1 + 3 + 4 + 0 + 2 + 3) = 52$ 分。

你现在有两块 $(4), (1, 3, 4, 0, 2, 3)$。在第 $3$ 个元素后面分开，获得 $(1 + 3) \times (4 + 0 + 2 + 3) = 36$ 分。

你现在有三块 $(4), (1, 3), (4, 0, 2, 3)$。在第 $5$ 个元素后面分开，获得 $(4 + 0) \times (2 + 3) = 20$ 分。

所以，经过这些操作后你可以获得四块 $(4), (1, 3), (4, 0), (2, 3)$ 并获得 $52 + 36 + 20 = 108$ 分。

限制与约定

第一个子任务共 11 分，满足 $1 \leq k < n \leq 10$。

第二个子任务共 11 分，满足 $1 \leq k < n \leq 50$。

第三个子任务共 11 分，满足 $1 \leq k < n \leq 200$。

第四个子任务共 17 分，满足 $2 \leq n \leq 1000, 1 \leq k \leq \min\{n - 1, 200\}$。

第五个子任务共 21 分，满足 $2 \leq n \leq 10000, 1 \leq k \leq \min\{n - 1, 200\}$。

第六个子任务共 29 分，满足 $2 \leq n \leq 100000, 1 \leq k \leq \min\{n - 1, 200\}$。

感谢@larryzhong  提供的加强数据



---

---
title: "高速公路（疑似错题）"
layout: "post"
diff: 省选/NOI-
pid: P3994
tag: ['单调队列', 'O2优化', '斜率优化', '队列']
---
# 高速公路（疑似错题）
## 题目描述

C 国拥有一张四通八达的高速公路树。

C 国有 $n$ 个城市，城市之间由一共 $n-1$ 条高速公路连接。除了首都 $1$ 号城市，每个城市都有一家本地的客运公司，可以发车前往全国各地。你可以把它认作以 $1$ 为根的树。两城市的距离定义为它们之间简单路径的长度。

假设有一个人要从 $i$ 号城市坐车出发前往与其距离为 $D$ 的 $j$ 号城市，那么他要花费 $P_i \times D+Q_i$ 元。由于距离首都越远，国家的监管就越松，所以距离首都越远，客运公司的 $P_i$ 越大，如果 $i$ 号城市是 $j$ 号城市的某个祖先，那么一定存在 $P_i \leq P_j$。

小 T 成为了国家统计局的调查人员，他需要对现在的高速路网进行一次调查，了解从其他每一个城市到达首都 $1$ 号城市所花费的金钱。

因为可能出现多转车（或不转车）的抵达首都的方法，所以人工计算这个结果是十分复杂的。大宁非常的懒，所以请你编写一个程序解决它。
## 输入格式

第 $1$ 行包含一个整数 $n$，表示城市的个数。

第 $2$ 到 $n$ 行，每行描述一个除首都之外的城市。其中第 $i$ 行包含 $4$ 个整数 $F_i,S_i,P_i,Q_i$，分别表示 $i$ 号城市的父亲城市，它到父亲城市高速公路的长度，以及乘车价格的两个参数。
## 输出格式

输出包含 $n-1$ 行，每行包含一个整数。

其中第 $i$ 行表示从 $i+1$ 号城市出发，到达首都最少的乘车费用。
## 样例

### 样例输入 #1
```
6
1 9 3 0
1 17 1 9
1 1 1 6
4 13 2 15
4 9 2 4

```
### 样例输出 #1
```
27
26
7
43
24

```
## 提示

#### 数据规模与约定

- 对于前 $40\%$ 的数据 $n \leq 1000$。
- 对于另外 $20\%$ 的数据，$F_i=i-1$
- 对于所有的数据，$1 \leq n \leq 10^6$，$0 \leq Pi,Qi \lt 2^{31}$，保证结果不会大于 $2^{63}-1$。


---

---
title: "[NOI2007] 货币兑换"
layout: "post"
diff: 省选/NOI-
pid: P4027
tag: ['2007', 'NOI', 'Special Judge', '分治', '斜率优化', '凸包']
---
# [NOI2007] 货币兑换
## 题目描述

小 Y 最近在一家金券交易所工作。该金券交易所只发行交易两种金券：A 纪念券（以下简称 A 券）和 B 纪念券（以下简称 B 券）。每个持有金券的顾客都有一个自己的帐户。金券的数目可以是一个实数。

每天随着市场的起伏波动，两种金券都有自己当时的价值，即每一单位金券当天可以兑换的人民币数目。我们记录第 $K$ 天中 A 券和 B 券的价值分别为 $A_K$ 和 $B_K$（元/单位金券）。

为了方便顾客，金券交易所提供了一种非常方便的交易方式：比例交易法。

比例交易法分为两个方面：

a)  卖出金券：顾客提供一个 $[0, 100]$ 内的实数 $OP$ 作为卖出比例，其意义为：将 $OP\%$ 的 A 券和 $OP\%$ 的 B 券以当时的价值兑换为人民币；

b)  买入金券：顾客支付 $IP$ 元人民币，交易所将会兑换给用户总价值为 $IP$ 的金券，并且，满足提供给顾客的 A 券和 B 券的比例在第 $K$ 天恰好为 $\mathrm{Rate}_ K$；

例如，假定接下来 $3$ 天内的 $A_K,B_K,\mathrm{Rate}_ K$ 的变化分别为：

| 时间 | $A_K$ | $B_K$ | $\mathrm{Rate}_ K$ |
| ----- | ----- | ----- | ----- |
| 第一天 | $1$ | $1$ | $1$ |
| 第二天 | $1$ | $2$ | $2$ |
| 第三天 | $2$ | $2$ | $3$ |



假定在第一天时，用户手中有 $100$ 元人民币但是没有任何金券。

用户可以执行以下的操作：

| 时间 | 用户操作 | 人民币(元) | A 券的数量 | B 券的数量 |
| ----- | ----- | ----- | ----- | ----- |
| 开户 | 无 | $100$ | $0$ | $0$ |
| 第一天 | 买入 $100$ 元 | $0$ | $50$ | $50$ |
| 第二天 | 卖出 $50\%$ | $75$ | $25$ | $25$ |
| 第二天 | 买入 $60$ 元 | $15$ | $55$ | $40$ |
| 第三天 | 卖出 $100\%$ | $205$ | $0$ | $0$ |

注意到，同一天内可以进行多次操作。

小 Y 是一个很有经济头脑的员工，通过较长时间的运作和行情测算，他已经知道了未来 $N$ 天内的 A 券和 B 券的价值以及 $\mathrm{Rate}$。他还希望能够计算出来，如果开始时拥有 $S$ 元钱，那么 $N$ 天后最多能够获得多少元钱。

## 输入格式

第一行两个正整数 $N,S$，分别表示小 Y 能预知的天数以及初始时拥有的钱数。

接下来 $N$ 行，第 $K$ 行三个实数 $A_K,B_K,\mathrm{Rate} _ K$ ，意义如题目中所述。

## 输出格式

只有一个实数 $\mathrm{MaxProfit}$，表示第 $N$ 天的操作结束时能够获得的最大的金钱数目。答案保留 $3$ 位小数。

## 样例

### 样例输入 #1
```
3 100
1 1 1
1 2 2
2 2 3
```
### 样例输出 #1
```
225.000
```
## 提示

| 时间 | 用户操作 | 人民币(元) | A 券的数量 | B 券的数量 |
| ----- | ----- | ----- | ----- | ----- |
| 开户 | 无 | $100$ | $0$ | $0$ |
| 第一天 | 买入 $100$ 元 | $0$ | $50$ | $50$ |
| 第二天 | 卖出 $100\%$ | $150$ | $0$ | $0$ |
| 第二天 | 买入 $150$ 元 | $0$ | $75$ | $37.5$ |
| 第三天 | 卖出 $100\%$ | $225$ | $0$ | $0$ |


本题没有部分分，你的程序的输出只有和标准答案相差不超过 $0.001$ 时，才能获得该测试点的满分，否则不得分。


测试数据设计使得精度误差不会超过 $10^{-7}$ 。

对于 $40\%$ 的测试数据，满足 $N \le 10$。

对于 $60\%$ 的测试数据，满足 $N \le 1 000$。

对于 $100\%$ 的测试数据，满足 $N \le 10^5$。

对于 $100\%$ 的测试数据，满足：

$0 < A_K \leq 10$，$0 < B_K\le 10$，$0 < \mathrm{Rate}_K \le 100$，$\mathrm{MaxProfit}  \leq 10^9$。

输入文件可能很大，请采用快速的读入方式。

必然存在一种最优的买卖方案满足：

每次买进操作使用完所有的人民币，每次卖出操作卖出所有的金券。



---

---
title: "[JSOI2009] 火星藏宝图"
layout: "post"
diff: 省选/NOI-
pid: P4056
tag: ['动态规划 DP', '2009', '各省省选', '江苏', '斜率优化']
---
# [JSOI2009] 火星藏宝图
## 题目背景

JSOI2009第三轮二试

## 题目描述

在火星游玩多日,jyy 偶然地发现了一张藏宝图。根据藏宝图上说法，宝藏被埋藏在一个巨大的湖里的 $N$ 个岛上 $(2\le N \le 2 \times 10^{5})$。为了方便描述，地图把整个湖划分成 $M$ 行 $M$ 列 $(1\le M\le 1000)$,共 $M \times M$ 个小块，并把所有岛按照 $1...N$ 编了号。第 $i$ 个岛位于第 $X_i$ 行 $Y_i$ 列 (设其坐标为 $(X_i,Y_i)$的格子 （ $X_i,Y_i$ 均为整数，并且满足 $1<=X_i,Y_i<=M$ ）,岛上藏有价值财富 $V_i(1\le V_i\le 10,000)$。湖的左上角 $(1,1)$ 和右下角 $(M,M)$ 都有岛，有桥将它们与陆地相连。

jyy 没费多大劲，就找到了那个湖，同时哭笑不得地发现，所谓的财富，是各个岛上出产的珍稀水果。jyy 在左上角的岛的岸边找到了一条小木船，他可以划船到其他岛上去。划船是要消耗体力的，具体地说，等于两岛 Euclidean 距离的平方(即，从 $(X_1,Y_1)$ 划船到 $(X_2,Y_2)$ 所耗费的体力为 $(X_1-X_2)^2+(Y_1-Y_2)^2$ 个单位)。jyy 可以吃水果来恢复体力，吃掉 $1$ 单位价值的水果能恢复 $1$ 单位体力。

现在 jyy 打算从 $(1,1)$ 旅行到 $(M,M)$，沿途收集珍稀水果。按藏宝图上的提示，jyy 离开一个岛后，就只能去该岛右下方的区域（正下和正右方向也是允许的），否则会遭遇水怪。jyy 可以在旅行途中饿一段时间，即体力为负。但抵达终点后，只要身边有足够多的水果，他就会通过吃水果将体力恢复到旅行前的水平。

jyy想知道，经过一次旅行，他最多能得到多少收益，即 `jyy 收集到的水果总价值- jyy 在旅途中花的总体力` 。(如果吃完所有水果他还饿着，收益就是负数，具体的例子见样例)
## 输入格式

第 $1$ 行：两个整数 $N,M$。第 $2...N+1$ 行：每行 $3$ 个整数，第 $i+1$ 行的 $3$ 个整数分别为 $ X_i$，$Y_i$，$V_i$。每个岛的坐标不同。保证存在坐标 $(1,1)$ 和 $(M,M)$ 的岛。
## 输出格式

第 $1$ 行：输出一个整数，表示最大收益。
## 样例

### 样例输入 #1
```
4  10 
1  1  20 
10 10 10 
3  5  60 
5  3  30
```
### 样例输出 #1
```
-4
```
## 提示

### 样例解释

$20+60+10-\left ( \left(3-1 \right )^2+\left (5-1 \right )^2 \right )-\left ( \left (10-3 \right )^2+\left (10-5 \right )^2 \right )=-4$

### 数据范围

对 $20\%$ 的数据 $M\le 200$，且 $N\le 2\times 10^3$。

对 $50\%$ 的数据 $M\le 200$，且 $N\le 2\times 10^4$。

对 $100\%$ 的数据 $M\le 1000$，且 $N\le 2\times 10^5$。


---

---
title: "[SDOI2016] 征途"
layout: "post"
diff: 省选/NOI-
pid: P4072
tag: ['2016', '各省省选', '单调队列', '山东', 'O2优化', '斜率优化', '前缀和', '凸包']
---
# [SDOI2016] 征途
## 题目描述

Pine 开始了从 $S$ 地到 $T$ 地的征途。

从 $S$ 地到 $T$ 地的路可以划分成 $n$ 段，相邻两段路的分界点设有休息站。

Pine 计划用 $m$ 天到达 $T$ 地。除第 $m$ 天外，每一天晚上 Pine 都必须在休息站过夜。所以，一段路必须在同一天中走完。

Pine 希望每一天走的路长度尽可能相近，所以他希望每一天走的路的长度的方差尽可能小。

帮助 Pine 求出最小方差是多少。

设方差是 $v$，可以证明，$v\times m^2$ 是一个整数。为了避免精度误差，输出结果时输出 $v\times m^2$。
## 输入格式

第一行两个数 $n, m$。

第二行 $n$ 个数，表示 $n$ 段路的长度。
## 输出格式

一个数，最小方差乘以 $m^2$ 后的值。
## 样例

### 样例输入 #1
```
5 2
1 2 5 8 6
```
### 样例输出 #1
```
36
```
## 提示

### 数据范围及约定

- 对于 $30\%$ 的数据，$1 \le n \le 10$；
- 对于 $60\%$ 的数据，$1 \le n \le 100$；
- 对于 $100\%$ 的数据，$1 \le n \le 3000$。

保证从 $S$ 到 $T$ 的总路程不超过 $3\times 10^4$。

$2 \leq m \leq n+1$，每段路的长度为不超过 $3 \times 10^4$ 的**正整数**。


---

---
title: "[CEOI 2004] 锯木厂选址"
layout: "post"
diff: 省选/NOI-
pid: P4360
tag: ['模拟', '动态规划 DP', '2004', '单调队列', 'CEOI（中欧）', '模拟退火', '斜率优化']
---
# [CEOI 2004] 锯木厂选址
## 题目描述

从山顶上到山底下沿着一条直线种植了 $n$ 棵老树。当地的政府决定把他们砍下来。为了不浪费任何一棵木材，树被砍倒后要运送到锯木厂。 

木材只能朝山下运。山脚下有一个锯木厂。另外两个锯木厂将新修建在山路上。你必须决定在哪里修建这两个锯木厂，使得运输的费用总和最小。假定运输每公斤木材每米需要一分钱。 

你的任务是编写一个程序，从输入文件中读入树的个数和他们的重量与位置，计算最小运输费用。
## 输入格式

输入的第一行为一个正整数 $n$ ——树的个数 $(2\leq n\leq 20000)$。树从山顶到山脚按照 $1,2,\dots,n$ 标号。 

接下来 $n$ 行，每行有两个正整数（用空格分开）。 

第 $i+1$ 行含有：$w_i$ ——第 $i$ 棵树的重量（公斤为单位）和 $d_i$——第 $i$ 棵树和第 $i+1$ 棵树之间的距离， $1\leq w_i\leq 10000,0\leq d_i\leq 10000$。 

最后一颗树的 $d_n$，表示第 $n$ 棵树到山脚的锯木厂的距离。保证所有树运到山脚的锯木厂所需要的费用小于 $2\times 10^9$ 分。
## 输出格式

输出最小的运输费用。
## 样例

### 样例输入 #1
```
9 
1 2 
2 1 
3 3 
1 1 
3 2 
1 6 
2 1 
1 2 
1 1

```
### 样例输出 #1
```
26
```
## 提示

样例图示，黑点为锯木厂

![](https://cdn.luogu.com.cn/upload/pic/16339.png)

本题共有 $13$ 个测试点，每个测试点的数据范围如下

测试点 $1\sim 5$：$n\leq 200$；

测试点 $6\sim7$：$n\leq 1000$；

测试点 $7\sim13$：$2\leq n\leq 20000$；


---

---
title: "[CEOI 2017] Building Bridges"
layout: "post"
diff: 省选/NOI-
pid: P4655
tag: ['动态规划 DP', '2017', '线段树', 'cdq 分治', 'CEOI（中欧）', '斜率优化']
---
# [CEOI 2017] Building Bridges
## 题目描述

有 $n$ 根柱子依次排列，每根柱子都有一个高度。第 $i$ 根柱子的高度为 $h_i$。

现在想要建造若干座桥，如果一座桥架在第 $i$ 根柱子和第 $j$ 根柱子之间，那么需要 $(h_i-h_j)^2$​​ 的代价。

在造桥前，所有用不到的柱子都会被拆除，因为他们会干扰造桥进程。第 $i$ 根柱子被拆除的代价为 $w_i$，注意 $w_i$ 不一定非负，因为可能政府希望拆除某些柱子。

现在政府想要知道，通过桥梁把第 $1$ 根柱子和第 $n$ 根柱子连接的最小代价。注意桥梁不能在端点以外的任何地方相交。
## 输入格式

第一行一个正整数 $n$。

第二行 $n$ 个空格隔开的整数，依次表示 $h_1,h_2,\cdots,h_n$​​。

第三行 $n$ 个空格隔开的整数，依次表示 $w_1,w_2,\cdots,w_n$​​。
## 输出格式

输出一行一个整数表示最小代价，注意最小代价不一定是正数。
## 样例

### 样例输入 #1
```
6
3 8 7 1 6 6
0 -1 9 1 2 0
```
### 样例输出 #1
```
17
```
## 提示

对于 $100\%$ 的数据，有 $2\le n\le 10^5;0\le h_i,\vert w_i\vert\le 10^6$。


---

---
title: "忘情"
layout: "post"
diff: 省选/NOI-
pid: P4983
tag: ['斜率优化', '凸完全单调性（wqs 二分）', '凸包']
---
# 忘情
## 题目背景

 “为什么要离开我！”

 “因为你没玩儿转！”

 “我玩儿转了！”

 “那好，你现在就给我维护这么一个式子！”

 “为什么要出这么毒瘤的东西。”

 “为了恶心你。”

 “......”

$…………………………….$

## 题目描述

你的 $npy$ 为了恶心你，特地请了四位大神和一个辣鸡！

 $\rm hdxrie$ 说：“我们得求和。”于是有了 $\sum\limits_{i=1}^{n}x_i $ 。

 $\rm Imagine$ 说：“我们得有平均数。”于是有了 $\bar x $ 。

 $\rm TimeTraveller$ 说：“我们得有加减乘除。”于是有了一些恶心的组合。

 $\rm Althen·Way·Satan$ 说：“我们还得有平方。”于是我们将它平方。

最垃圾的 $\rm ZredXNy$ 说：“那我帮你们整合一下。”

于是，我们得到了这么一个式子 $:$

$$\frac{\left((\sum\limits_{i=1}^{n}x_i×\bar x)+\bar x\right)^2}{\bar x^2}$$


我们定义一段序列的值为这个，其中  $n$为此序列的元素个数。

我们给定一段长度为 $n$ 的序列,现在要求将它分成 $m$ 段，要求每一段的值的总和最小，求出这个最小值。

## 输入格式

第一行两个正整数，分别为 $n$，$m$，定义见题面。

接下来一行为 $n$ 个正整数，依次给出这个序列的每个元素的值 $x_i$ 。
## 输出格式

一个整数，求出这个最小值。
## 样例

### 样例输入 #1
```
3 2
1 2 3

```
### 样例输出 #1
```
32
```
### 样例输入 #2
```
10 3
1 2 3 4 5 6 7 8 9 10

```
### 样例输出 #2
```
1140
```
## 提示

- 对于 $30 \%$ 的数据，$m≤n≤500$；

- 另有 $20 \%$ 的数据，保证 $m=2$；

- 对于 $100 \%$ 的数据，$m≤n≤100000$，$1≤x_i≤1000$。



---

---
title: "[USACO19FEB] Cow Dating P"
layout: "post"
diff: 省选/NOI-
pid: P5242
tag: ['2019', 'USACO', '三分', '斜率优化']
---
# [USACO19FEB] Cow Dating P
## 题目描述

由于目前可供奶牛们使用的约会网站并没有给 Farmer John 留下深刻印象，他决定推出一个基于新匹配算法的奶牛交友网站，该算法可基于公牛和母牛间的共同兴趣对公牛和母牛进行匹配。

Bessie 在寻找情人节 Barn Dance 的合作伙伴时，决定试用这个网站。在注册账户之后，FJ 的算法为他给出了一个长度为 $ N $（$1 \leq N \leq 10^6$） 的匹配列表，列表上每头公牛接受她舞蹈邀请的概率为 $ p $（$0 < p < 1$）。

Bessie 决定向列表中的一个连续区间内的奶牛发送邀请，但Bessie希望**恰好只有一个奶牛**接受邀请。请帮助 Bessie 求出**恰好只有一个奶牛**接受邀请的最大概率是多少。
## 输入格式

第一行输入一个整数 $ N $ 。

接下来 $ N $ 行，每行包含一个整数，它的含义是 $ p_i $ 乘以 $ 10^6 $ 后的结果。
## 输出格式

请输出**恰好只有一个奶牛**接受邀请的最大概率乘以 $ 10^6 $ 后向下取整后的结果。
## 样例

### 样例输入 #1
```
3
300000
400000
350000

```
### 样例输出 #1
```
470000
```
## 提示

样例的最优方案是向第二和第三只奶牛发送邀请。

子任务：对于 $ 25\% $ 的数据， $ N \leq 4000 $ 。


---

---
title: "[SDOI2012] 任务安排"
layout: "post"
diff: 省选/NOI-
pid: P5785
tag: ['动态规划 DP', '2012', '二分', '各省省选', '单调队列', '山东', '斜率优化']
---
# [SDOI2012] 任务安排
## 题目描述

机器上有 $n$ 个需要处理的任务，它们构成了一个序列。这些任务被标号为 $1$ 到 $n$，因此序列的排列为 $1 , 2 , 3 \cdots n$。这 $n$ 个任务被分成若干批，每批包含相邻的若干任务。从时刻 $0$ 开始，这些任务被分批加工，第 $i$ 个任务单独完成所需的时间是 $T_i$。在每批任务开始前，机器需要启动时间 $s$，而完成这批任务所需的时间是各个任务需要时间的总和。

**注意，同一批任务将在同一时刻完成**。每个任务的费用是它的完成时刻乘以一个费用系数 $C_i$。

请确定一个分组方案，使得总费用最小。
## 输入格式

第一行一个整数 $n$。
第二行一个整数 $s$。

接下来 $n$ 行，每行有一对整数，分别为 $T_i$ 和 $C_i$，表示第 $i$ 个任务单独完成所需的时间是 $T_i$ 及其费用系数 $C_i$。
## 输出格式

一行，一个整数，表示最小的总费用。
## 样例

### 样例输入 #1
```
5
1
1 3
3 2
4 3
2 3
1 4

```
### 样例输出 #1
```
153

```
## 提示

对于 $100\%$ 数据，$1 \le n \le 3 \times 10^5$，$1 \le s \le 2^8$，$ \left| T_i \right| \le 2^8$，$0 \le C_i \le 2^8$。


---

---
title: "丝之割"
layout: "post"
diff: 省选/NOI-
pid: P6047
tag: ['动态规划 DP', '贪心', '2020', '排序', '斜率优化']
---
# 丝之割
## 题目背景

Pharloom 是一个神秘的王国，[丝线与歌](https://www.bilibili.com/video/av43623335)是那里最强大的力量。多弦琴是 Pharloom 的一种强大武器，正如多项式是 OI 中的强大武器。

因为你很讨厌多项式，你决定摧毁多弦琴。
## 题目描述

下面这部分题面只是为了帮助你理解题意，并没有详细的解释。更为严谨清晰的叙述见形式化题意。

多弦琴由两根支柱和连接两根支柱的 $m$ 条弦组成。每根支柱上都均匀安放着 $n$ 个固定点，第 $i$ 条弦连接上方支柱的第 $u_i$ 个固定点和下方支柱的第 $v_i$ 个固定点。

![](https://cdn.luogu.com.cn/upload/image_hosting/14igq7bn.png)

> 上图是一把多弦琴

为了摧毁多弦琴，你可以进行若干次切割操作。在一次切割操作中，你可以选择上方支柱的某一个固定点 $u$ 和下方支柱的一个固定点 $v$，所有被 $u$ 到 $v$ 的连线**从左到右**穿过的弦都将被破坏。但同时，你需要付出 $a_u \times b_v$ 的代价。

形式化题意：有 $m$ 条弦，一条弦可以抽象为一个二元组 $(u,v)$，你可以进行任意次切割操作，一次切割操作你将选择两个下标 $i$ 和 $j$ 满足 $i,j \in [1,n]$，然后所有满足 $u>i,v<j$ 的弦 $(u,v)$ 都将被破坏，同时你将付出 $a_i \times b_j​$ 的代价。求破坏所有弦的最小代价和。
## 输入格式

第一行两个整数 $n,m$。

第二行 $n$ 个整数 $a_1,a_2,\dots,a_n$。

第三行 $n$ 个整数 $b_1,b_2,\dots,b_n$。

接下来 $m$ 行每行两个整数 $u,v$，表示有一条弦 $(u,v)$。

以上输入的意义见题目描述。
## 输出格式

一行一个整数，答案。
## 样例

### 样例输入 #1
```
5 2
3 9 1 9 9
9 9 1 9 3
2 1
5 4
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
5 1
9 9 9 9 1
1 9 9 9 9
3 3
```
### 样例输出 #2
```
81
```
## 提示

#### 样例解释

对于第一组样例，使用两次切割，分别为 $(1,3)$，$(3,5)$，花费代价 $3 \times 1 + 1 \times 3 = 6$。

对于第二组样例，注意切割 $(5,1)$ 不能使弦 $(3,3)$ 消失。

---

#### 数据范围

**「本题采用捆绑测试」**

对于所有测试点，保证 $1 \leq n, m \leq 3\times 10^5$，$2 \leq u \leq n$，$1 \leq v \leq n-1$，$1 \leq a_i,b_i \leq 10^6$。

$\text{Subtask 1 (21 pts)}$ $n,m \leq 6$。

$\text{Subtask 2 (3 pts)}$ $m=1$。

$\text{Subtask 3 (1 pts)}$ $a_1=b_n = 1$。

$\text{Subtask 4 (25 pts)}$ $n,m \leq 100$。

$\text{Subtask 5 (29 pts)}$ $n,m \leq 10^3$。

$\text{Subtask 6 (21 pts)}$ 无特殊限制。

---
#### 提示

如果你认真观察了数据范围，你会发现这把多弦琴一定能够被破坏。


---

---
title: "[USACO16FEB] Circular Barn P"
layout: "post"
diff: 省选/NOI-
pid: P6173
tag: ['动态规划 DP', '2016', 'USACO', '分治', '动态规划优化', '斜率优化', '四边形不等式']
---
# [USACO16FEB] Circular Barn P
## 题目描述

作为当代建筑的爱好者，Farmer John 建造了一个圆形新谷仓，谷仓内部 $n$ 个房间排成环形（$3 \leq n \leq 1000$），按顺时针顺序编号为 $1\ldots n$，每个房间都有通往与其相邻的左右房间的门，还有一扇门通往外面。

FJ 准备让第 $i$ 个房间里恰好有 $r_i$ 头奶牛（$1 \le r_i \le {10}^6$）。为了有序地让奶牛进入谷仓，他打算解锁 $k$ 个从外界进入谷仓的门（$1 \le k \le 7$）。然后，每头奶牛**顺时针**走动，直到到达目的地。FJ 的目标是让所有奶牛走动的距离和最小（奶牛从哪个门进入可以随意安排，这里走动的距离只包含进入谷仓后走动的距离），现在请你求出这个最小距离。
## 输入格式

第一行两个整数 $n,k$。

接下来 $n$ 行，第 $i$ 行一个整数 $r_i$。
## 输出格式

输出所有奶牛最小走动距离和。
## 样例

### 样例输入 #1
```
6 2
2
5
4
2
6
2
```
### 样例输出 #1
```
14
```
## 提示

FJ 打开 $2,5$ 两个门。$11$ 头奶牛从 $2$ 号门进入，前往 $2,3,4$ 号房间，总距离 $8$。$10$ 头奶牛从 $5$ 号门进入，前往 $5,6,1$ 号房间，总距离 $6$。


---

---
title: "[NOI2019] 回家路线 加强版"
layout: "post"
diff: 省选/NOI-
pid: P6302
tag: ['动态规划 DP', '2019', 'NOI', 'O2优化', '斜率优化']
---
# [NOI2019] 回家路线 加强版
## 题目背景

本题是 NOI 2019 回家路线的加强版，除数据范围外均与原题相同。
## 题目描述

猫国的铁路系统中有 $n$ 个站点，从 $1 - n$ 编号。小猫准备从 $1$ 号站点出发，乘坐列车回到猫窝所在的 $n$ 号站点。它查询了能够乘坐的列车，这些列车共 $m$ 班，从 $1 - m$ 编号。小猫将在 $0$ 时刻到达 $1$ 号站点。对于 $i$ 号列车，它将在时刻 $p_i$ 从站点 $x_i$ 出发，在时刻 $q_i$ 直达站点 $y_i$，小猫只能在时刻 $p_i$ 上 $i$ 号列车，也只能在时刻 $q_i$ 下 $i$ 号列车。小猫可以通过多次换乘到达 $n$ 号站点。一次换乘是指对于两班列车，假设分别为 $u$ 号与 $v$ 号列车，若 $y_u = x_v$ 并且 $q_u \leq p_v$，那么小猫可以乘坐完 $u$ 号列车后在 $y_u$ 号站点等待 $p_v - q_u$ 个时刻，并在时刻 $p_v$ 乘坐 $v$ 号列车。

小猫只想回到猫窝并且减少途中的麻烦，对此它用烦躁值来衡量。

 - 小猫在站点等待时将增加烦躁值，对于一次 $t (t \geq 0)$ 个时刻的等待，烦躁值将增加 $At^2 + Bt + C$，其中 $A, B,C$ 是给定的常数。注意：小猫登上第一班列车前，即从 $0$ 时刻起停留在 $1$ 号站点的那些时刻也算作一次等待。

 - 若小猫最终在时刻 $z$ 到达 $n$ 号站点，则烦躁值将再增加 $z$。

形式化地说，若小猫共乘坐了 $k$ 班列车，依次乘坐的列车编号可用序列 $s_1, s_2, \cdots , s_k$ 表示。该方案被称作一条可行的回家路线，当且仅当它满足下列两个条件：

 - $x_{s1} = 1,y_{sk} = n$

 - 对于所有 $j (1 \leq j < k)$，满足 $y_{sj} = x_{s_{j+1}}$ 且 $q_{sj}\leq p_{s_{j+1}}$ 

对于该回家路线，小猫得到的烦躁值将为：

$$q_{s_k}+(A\times p_{s_1}^2+B\times p_{s_1}+C)+\sum_{j=1}^{k-1}(A(p_{s_{j+1}}-q_{s_j})^2+B(p_{s_{j+1}}-q_{s_j})+C)$$

小猫想让自己的烦躁值尽量小，请你帮它求出所有可行的回家路线中，能得到的最 小的烦躁值。题目保证至少存在一条可行的回家路线。
## 输入格式

第一行五个整数 $n, m, A, B,C$，变量意义见题目描述。

接下来 $m$ 行，第 $i$ 行四个整数 $x_i, y_i, p_i, q_i$，分别表示 $i$ 号列车的出发站、到达站、出发时刻与到达时刻。
## 输出格式

输出仅一行一个整数，表示所求的答案。
## 样例

### 样例输入 #1
```
3 4 1 5 10
1 2 3 4
1 2 5 7
1 2 6 8
2 3 9 10
```
### 样例输出 #1
```
94
```
### 样例输入 #2
```
4 3 1 2 3
1 2 2 3
2 3 5 7
3 4 7 9
```
### 样例输出 #2
```
34
```
## 提示

对于所有的测试点，保证 $2\le n\le 10^5$，$1\le m\le  10^6$，$0\le 
A\le 10$，$0\le B,C\le 10^7$，$1\le x_i,y_i\le n$，$x_i\neq y_i$，$0\le p_i<q_i\le 4\times 10^4$。


---

---
title: "「EVOI-RD2」大胃王"
layout: "post"
diff: 省选/NOI-
pid: P7926
tag: ['2021', 'O2优化', '斜率优化']
---
# 「EVOI-RD2」大胃王
## 题目描述

又到了一日三度的吃饭时间，大胃王开始因为吃什么饭而犯难了。

现有 $n$ 个材料，每个材料有一定的质量。大胃王可以把这 $n$ 个材料分为**连续**的任意段，然后每一段配一段质量为 $L$ 的主食。每一段的不和谐度定义为这段材料的质量和减去该段主食的质量（就是 $L$）的平方。一顿饭的不和谐度为所有段的不和谐度之和。



不用担心饭的多少的问题，因为某Code 是大胃王，所以做多少他都能吃完。

接下来，某Code 向你发起了挑战，要求你回答前 $i$ 道菜所做出的一顿饭的**最小和第二小**不和谐度。如果你回答正确，你将获得与他共享这顿饭菜的机会。

当两种分配方法得出同样最小的不和谐度时，则输出两个最小的不和谐度。即所输出的并非严格第二小不和谐度。
## 输入格式

第一行，两个正整数 $n$ 和 $L$，分别表示有 $n$ 个材料和每份主食的质量 $L$。

第二行 $n$ 个整数，第 $i$ 个整数代表第 $i$ 个材料的质量 $a_i$。
## 输出格式

输出共 $n$ 行。

其中第一行一个整数，为前 $1$ 道菜做出的饭的最小不和谐度。

在第 $i$ 行输出两个整数，为前 $i$ 道菜所做出的一顿饭的**最小和第二小**不和谐度，中间用空格隔开。
## 样例

### 样例输入 #1
```
5 5
3 6 2 4 8

```
### 样例输出 #1
```
4
5 16
13 14
6 14
15 23
```
### 样例输入 #2
```
10 7
4 6 9 1 5 9 5 1 7 1 

```
### 样例输出 #2
```
9
9 10
13 14
18 19
14 15
18 19
22 23
19 20
19 20
20 21
```
## 提示

**样例 1 解释**

第一行：$4=(3-5)^2$  
第二行：$5=(3-5)^2+(6-5)^2$，$16=(3+6-5)^2$  
第三行：$13=(3-5)^2+(6+2-5)^2$，$14=(3-5)^2+(6-5)^2+(2-5)^2$  
第四行：$6=(3-5)^2+(6-5)^2+(2+4-5)^2$，$14=(3-5)^2+(6+2-5)^2+(4-5)^2$  
第五行：$15=(3-5)^2+(6-5)^2+(2+4-5)^2+(8-5)^2$，$23=(3-5)^2+(6+2-5)^2+(4-5)^2+(8-5)^2$


**【数据规模与约定】**

**本题采用捆绑测试。**

+ Subtask 1 (10 pts)：$1 \le n \le 10$。
+ Subtask 2 (20 pts)：$1 \le n \le 200$。
+ Subtask 3 (20 pts)：$1 \le n \le 3000$。
+ Subtask 4 (40 pts)：数据随机生成。
+ Subtask 5 (10 pts)：无特殊性质。

对于 $100\%$ 的数据，$1 \le n \le 2 \times 10^5$，$1 \le L,a_i \le 10^4$。


---

---
title: "[蓝桥杯 2015 国 B] 居民集会"
layout: "post"
diff: 省选/NOI-
pid: P8632
tag: ['动态规划 DP', '2015', '斜率优化', '蓝桥杯国赛']
---
# [蓝桥杯 2015 国 B] 居民集会
## 题目描述

蓝桥村的居民都生活在一条公路的边上，公路的长度为 $L$，每户家庭的位置都用这户家庭到公路的起点的距离来计算，第 $i$ 户家庭距起点的距离为 $d_i$。

每年，蓝桥村都要举行一次集会。今年，由于村里的人口太多，村委会决定要在 $4$ 个地方举行集会，其中 $3$ 个位于公路中间，$1$ 个位最公路的终点。

已知每户家庭都会向着远离公路起点的方向去参加集会，参加集会的路程开销为家庭内的人数 $t_i$ 与距离的乘积。

给定每户家庭的位置 $d_i$ 和人数 $t_i$，请为村委会寻找最好的集会举办地：$p_1,p_2,p_3,p_4(p_1 \le p_2 \le p_3 \le p_4=L),$ 使得村内所有人的路程开销和最小。
## 输入格式

输入的第一行包含两个整数 $n,L$，分别表示蓝桥村的家庭数和公路长度。

接下来 $n$ 行，每行两个整数 $d_i,t_i$，分别表示第 $i$ 户家庭距离公路起点的距离和家庭中的人数。
## 输出格式

输出一行，包含一个整数，表示村内所有人路程的开销和。
## 样例

### 样例输入 #1
```
6 10
1 3
2 2
4 5
5 20
6 5
8 7
```
### 样例输出 #1
```
18
```
## 提示

【样例说明】

在距起点 $2,5,8,10$ 这 $4$ 个地方集会，$6$ 个家庭需要的走的距离分别为 $1,0,1,0,2,0$，总的路程开销为 $1 \times 3+0 \times 2+1 \times 5+0 \times 20+2 \times 5+0 \times 7=18$。

【数据规模与约定】

对于 $10\%$ 的评测数据，$1 \le n \le 300$。

对于 $30\%$ 的评测数据，$1 \le n \le 2000$，$1 \le L \le 10000$，$0 \le d_i \le L$，$d_i \le d_i+1$，$0 \le t_i \le 20$。

对于 $100\%$ 的评测数据，$1 \le n \le 10^5$，$1 \le L \le 10^6$，$0 \le d_i \le L$，$d_i \le d_i+1$，$0 \le t_i \le 10^6$。


---

---
title: "[蓝桥杯 2020 省 AB3] 旅行家"
layout: "post"
diff: 省选/NOI-
pid: P8726
tag: ['动态规划 DP', '2020', '斜率优化', '蓝桥杯省赛', '李超线段树']
---
# [蓝桥杯 2020 省 AB3] 旅行家
## 题目描述

从前，在海上有 $n$ 个岛屿，编号 $1$ 至 $n$。居民们深受洋流困扰，无法到达比自己当前所在岛屿编号更小的岛屿。经过数年以后，岛屿上的人数随着岛屿的编号递增（可能相等）。作为一名出色的旅行家（$\mathrm{RP}$ 学家），你想从 $1$ 号岛屿出发开启一次旅程，以获得更多的 $\mathrm{RP}$，因为受到海洋的洋流影响，你只能去到比当前岛屿编号更大的岛屿。因为你比较善良，你会在离开一个岛屿的时候将你的 $\mathrm{RP}$ 分散给岛民，具体地：你的 $\mathrm{RP}$ 会除以 $2$（用去尾法取整，或者说向零取整）（当你的 $\mathrm{RP}$ 小于零时，岛民也依旧要帮你分担，毕竟你们已经建立起了深厚的友谊)。

第 $i$ 号岛屿有 $T_{i}$ 人，但是你很挑剔，每次你从 $j$ 号岛屿到达 $i$ 号岛屿时，你只会在到达的岛屿上做 $T_{i} \times T_{j}$ 件好事（一件好事可以获得 $1$ 点 $\mathrm{RP}$ )。

唯一不足的是，由于你在岛上住宿，劳民伤财，你会扣除巨量 RP，第 $i$ 号岛屿的住宿扣除 $F_{i}$ 点 $\mathrm{RP}$。

注意: 将离开一个岛屿时，先将 $\mathrm{RP}$ 扣除一半，再扣除住宿的 $\mathrm{RP}$，最后在新到达的岛屿上做好事，增加 $\mathrm{RP}$。离开 $1$ 号岛屿时需要扣除在 $1$ 号岛屿住宿的 $\mathrm{RP}$，当到达这段旅程的最后一个岛屿上时，要做完好事，行程才能结束，也就是说不用扣除在最后到达的岛屿上住宿的 $\mathrm{RP}$ 。

你因为热爱旅行（RP），所以从 $1$ 号岛屿开始旅行，初始时你有 $0$ 点 $\mathrm{RP}$。你希望选择一些岛屿经过，最终选择一个岛屿停下来，求最大的 $\mathrm{RP}$ 值是多少?
## 输入格式

输入的第一行包含一个数 $n$，表示岛屿的总数。

第二行包含 $n$ 个整数 $T_{1},T_{2},\cdots,T_{n}$，表示每个岛屿的人口数。

第三行包含 $n$ 个整数 $F_{1},F_{2},\cdots,F_{n}$，表示每个岛屿旅馆损失的 $\mathrm{RP}$。 

## 输出格式


输出一个数，表示最大获得的 $\mathrm{RP}$ 值。
## 样例

### 样例输入 #1
```
3
4 4 5
1 10 3
```
### 样例输出 #1
```
19
```
### 样例输入 #2
```
5
969 980 1013 1016 1021
888423 945460 865822 896150 946615
```
### 样例输出 #2
```
246172
```
## 提示

**【样例说明】**

从一号岛屿直接走到三号岛屿最优，初始 $0$ 点 $\mathrm{RP}$，扣除一半取整变成 $0$ 点。扣除在一号节点住宿的 $1 \mathrm{RP}$，在三号岛屿做好事产生 $4 \times 5=20$ 点 $\mathrm{RP}$。最终得到 $19$ 点 $R P$ 。

**【评测用例规模与约定】**

对于 $20 \%$ 的评测用例，$1 \leq n \leq 15$;

对于 $70 \%$ 的评测用例，$1 \leq n \leq 5000$;

对于所有评测用例，$1 \leq n \leq 5\times10^5,1 \leq T_{i} \leq 20000,1 \leq F_{i} \leq 2\times 10^8$。给定的 $T_{i}$ 已经按照升序排序。

建议使用 64 位有符号整数进行运算。

蓝桥杯 2020 第三轮省赛 AB 组 J 题。

Upd.2024.7.13 已添加hack数据


---

---
title: "[_-0 B] 地铁"
layout: "post"
diff: 省选/NOI-
pid: P9476
tag: ['动态规划 DP', 'O2优化', '动态规划优化', '斜率优化', '树形 DP']
---
# [_-0 B] 地铁
## 题目背景

小 $\mathfrak{f}$ 的家乡 A 市最近开通了地铁。
## 题目描述

A 市共有 $n (2\le n \le 10^5)$ 个居民点，第 $i$ 个居民点的人口为 $s_i (1 \le s_i \le 10^7)$，同时有 $n-1$ 条双向道路，构成一棵树，第 $i $ 条双向道路连接居民点 $u_i$ 和 $v_i$，人步行走过这条道路需要 $w_i (1 \le w_i\le 10^7)$ 的时间。

现 A 市政府决定开通一条地铁线路。地铁线路是树上的一条简单路径，若路径经过第 $i$ 条道路，那么地铁从这条道路下方经过只需要 $w_i^{\prime} (1 \le w_i^{\prime} \le 10^7)$ 的时间，同时，地铁的进出站**共**需要花费 $t (0 \le t \le 10^7)$ 的时间。

已知，若一个人从一个居民点前往另一个居民点，如果这条路径与地铁经过的路径有至少一条公共**边**，那么就**一定**会选择**尽可能多地**乘坐地铁。如果没有公共边，那么就会选择完全步行。**题目保证对于第 $i$ 条道路有 $w_i^{\prime} \le w_i - t$。** 我们认为，如果两个居民点的人口的乘积越大，那么有人想要在它们之间流动的可能性也越大。

现在，小 $\mathfrak{f}$ 想知道在所有 $\frac{n(n-1)}{2}$ 种建造地铁线路的方案中，$\sum_{a=1}^{n-1}\sum_{b=a+1}^{n}(s_a \cdot s_b \cdot d_{a,b})$ 的最小值，其中 $d_{a,b}$ 表示从居民点 $a$ 前往 $b$（或者从 $b$ 前往 $a$，两者是相等的）所需要的时间。

但是他不会，所以他来求助万能的你。
## 输入格式

第一行，三个用空格分隔的整数 $id,n,t$，表示子任务编号，居民点个数和进出站所需要花费的时间。

接下来 $n$ 行，每行一个整数 $s_i$，表示每个居民点的人口。

接下来 $n - 1$ 行，每行四个用空格分隔的整数 $u_i,v_i,w_i,w_i^{\prime}$，表示每条道路的两个端点，步行所需时间和地铁所需时间。
## 输出格式

一行，一个整数，表示所求的最小值。

答案可能超过 $64$ 位整形表示范围，您可以使用 `__int128` 类型，其表示范围为 $[-2^{127},2^{127}-1]$。

以下为 `__int128` 类型的输出模板：

```cpp
#include <bits/stdc++.h>
using namespace std;
__int128 ans;
int main() {
    /* Your code here */
    string str;
    if (!ans) {
        str = "0";
    } else {
        str = "";
        while (ans) {
            str = ((char)(48 + ans % 10)) + str;
            ans /= 10;
        }
    }
    cout << str << endl;
    return 0;
}
```
## 样例

### 样例输入 #1
```
0 5 0
9
9
3
2
3
1 2 7 6
1 3 8 5
1 4 6 5
2 5 9 9
```
### 样例输出 #1
```
2262
```
### 样例输入 #2
```
0 10 86
50
6
84
50
83
67
93
55
93
70
1 2 94 7
1 3 97 4
1 10 98 12
2 4 89 1
2 7 98 1
4 5 99 13
4 6 96 5
5 8 95 5
5 9 97 7
```
### 样例输出 #2
```
33600416
```
## 提示

**样例 $1$ 解释：**

修建地铁前如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/3oh0y5mn.png)

一种最优的修建地铁的方案为从 $2$ 到 $3$ 修建地铁。如下图所示（实线表示修建了地铁）：

![](https://cdn.luogu.com.cn/upload/image_hosting/ian9c6po.png)

从 $1$ 到 $2$ 经过地铁，所需时间为：$6+0=6$，对答案的贡献为：$9\times9\times6=486$。

从 $1$ 到 $3$ 经过地铁，所需时间为：$5+0=5$，对答案的贡献为：$9\times3\times5=135$。

从 $1$ 到 $4$ 不经过地铁，所需时间为：$6$，对答案的贡献为：$9\times2\times6=108$。

从 $1$ 到 $5$ 经过地铁，所需时间为：$6+9+0=15$，对答案的贡献为：$9\times3\times15=405$。

从 $2$ 到 $3$ 经过地铁，所需时间为：$6+5+0=11$，对答案的贡献为：$9\times3\times11=297$。

从 $2$ 到 $4$ 经过地铁，所需时间为：$6+6+0=12$，对答案的贡献为：$9\times2\times12=216$。

从 $2$ 到 $5$ 不经过地铁，所需时间为：$9$，对答案的贡献为：$9\times3\times9=243$。

从 $3$ 到 $4$ 经过地铁，所需时间为：$5+6+0=11$，对答案的贡献为：$3\times2\times11=66$。

从 $3$ 到 $5$ 经过地铁，所需时间为：$5+6+9+0=20$，对答案的贡献为：$3\times3\times20=180$。

从 $4$ 到 $5$ 经过地铁，所需时间为：$6+6+9+0=21$，对答案的贡献为：$2\times3\times21=126$。

综上，答案为：$486+135+108+405+297+216+243+66+180+126=2262$。

可以证明不存在更优的修建地铁的方案。

**本题采用捆绑测试且使用子任务依赖。**

| 编号 | 分值 | $n \le$ | 性质 | 依赖 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $0$ | N/A | 样例 | 无 |
| $1$ | $5$ | $10$ | 无 | 无 |
| $2$ | $5$ | $500$ | 无 | $1$ |
| $3$ | $10$ | $5000$ | 无 | $1,2$ |
| $4$ | $30$ | $10^5$ | A | 无 |
| $5$ | $5$ | $10^5$ | B | 无 |
| $6$ | $20$ | $10^5$ | C | 无 |
| $7$ | $15$ | $10^5$ | D | 无 |
| $8$ | $10$ | $10^5$ | 无 | $0,1,2,3,4,5,6,7$ |

特殊性质 A：$t=0$

特殊性质 B：$u_i=i,v_i=i+1$

特殊性质 C：每一个点的度数都不超过 $100$

特殊性质 D：$u_i=1,v_i=i+1$


---


---
title: "[NOIP 2016 提高组] 天天爱跑步"
layout: "post"
diff: 省选/NOI-
pid: P1600
tag: ['2016', '线段树', 'NOIP 提高组', '最近公共祖先 LCA', '树链剖分', '动态树 LCT', '差分']
---
# [NOIP 2016 提高组] 天天爱跑步
## 题目背景

NOIP2016 提高组 D1T2
## 题目描述

小 C 同学认为跑步非常有趣，于是决定制作一款叫做《天天爱跑步》的游戏。《天天爱跑步》是一个养成类游戏，需要玩家每天按时上线，完成打卡任务。

这个游戏的地图可以看作一棵包含 $n$ 个结点和 $n-1$ 条边的树，每条边连接两个结点，且任意两个结点存在一条路径互相可达。树上结点编号为从 $1$ 到 $n$ 的连续正整数。

现在有 $m$ 个玩家，第 $i$ 个玩家的起点为 $s_i$，终点为 $t_i$。每天打卡任务开始时，所有玩家在第 $0$ 秒同时从自己的起点出发，以每秒跑一条边的速度，不间断地沿着最短路径向着自己的终点跑去，跑到终点后该玩家就算完成了打卡任务。（由于地图是一棵树，所以每个人的路径是唯一的）

小 C 想知道游戏的活跃度，所以在每个结点上都放置了一个观察员。在结点 $j$ 的观察员会选择在第 $w_j$ 秒观察玩家，一个玩家能被这个观察员观察到当且仅当该玩家在第 $w_j$ 秒也正好到达了结点 $j$。小 C 想知道每个观察员会观察到多少人?

注意：我们认为一个玩家到达自己的终点后该玩家就会结束游戏，他不能等待一 段时间后再被观察员观察到。 即对于把结点 $j$ 作为终点的玩家：若他在第 $w_j$ 秒前到达终点，则在结点 $j$ 的观察员不能观察到该玩家；若他正好在第 $w_j$ 秒到达终点，则在结点 $j$ 的观察员可以观察到这个玩家。

## 输入格式

第一行有两个整数 $n$ 和 $m$。其中 $n$ 代表树的结点数量, 同时也是观察员的数量, $m$ 代表玩家的数量。

接下来 $n-1$ 行每行两个整数 $u$ 和 $v$，表示结点 $u$ 到结点 $v$ 有一条边。

接下来一行 $n$ 个整数，其中第 $j$ 个整数为 $w_j$ , 表示结点 $j$ 出现观察员的时间。

接下来 $m$ 行，每行两个整数 $s_i$，和 $t_i$，表示一个玩家的起点和终点。

对于所有的数据，保证 $1\leq s_i,t_i\leq n, 0\leq w_j\leq n$。

## 输出格式

输出 $1$ 行 $n$ 个整数，第 $j$ 个整数表示结点 $j$ 的观察员可以观察到多少人。

## 样例

### 样例输入 #1
```
6 3
2 3
1 2 
1 4 
4 5 
4 6 
0 2 5 1 2 3 
1 5 
1 3 
2 6 
```
### 样例输出 #1
```
2 0 0 1 1 1 
```
### 样例输入 #2
```
5 3 
1 2 
2 3 
2 4 
1 5 
0 1 0 3 0 
3 1 
1 4
5 5 
```
### 样例输出 #2
```
1 2 1 0 1 
```
## 提示

**样例 1 说明**

对于 $1$ 号点，$w_i=0$，故只有起点为 $1$ 号点的玩家才会被观察到，所以玩家 $1$ 和玩家 $2$ 被观察到，共有 $2$ 人被观察到。

对于 $2$ 号点，没有玩家在第 $2$ 秒时在此结点，共 $0$ 人被观察到。

对于 $3$ 号点，没有玩家在第 $5$ 秒时在此结点，共 $0$ 人被观察到。

对于 $4$ 号点，玩家 $1$ 被观察到，共 $1$ 人被观察到。

对于 $5$ 号点，玩家 $1$ 被观察到，共 $1$ 人被观察到。

对于 $6$ 号点，玩家 $3$ 被观察到，共 $1$ 人被观察到。

**子任务**

每个测试点的数据规模及特点如下表所示。 

提示：数据范围的个位上的数字可以帮助判断是哪一种数据类型。

| 测试点编号 | $n=$ | $m=$ | 约定 |
| :--------: | :----: | :----: | :----: |
|     $1\sim 2$      |  $991$   |  $991$   | 所有人的起点等于自己的终点，即 $\forall i,\ s_i=t_i$  |
|     $3\sim 4$      |  $992$   |  $992$   | 所有 $w_j=0$  |
|     $5$      |  $993$   |  $993$   | 无  |
|     $6\sim 8$      |  $99994$   |  $99994$   | $\forall i\in[1,n-1]$，$i$ 与 $i+1$ 有边。即树退化成 $1,2,\dots,n$ 按顺序连接的链  |
|     $9\sim 12$      |  $99995$   |  $99995$   | 所有 $s_i=1$  |
|     $13\sim 16$      |  $99996$   |  $99996$   | 所有 $t_i=1$  |
|     $17\sim 19$      |  $99997$   |  $99997$   | 无  |
|     $20$      |  $299998$   |  $299998$   | 无  |



**提示**

（提示：由于原提示年代久远，不一定能完全反映现在的情况，现在已经对该提示做出了一定的修改，提示的原文可以在[该剪贴板](https://www.luogu.com.cn/paste/3fneb8m6)查看）

在最终评测时，调用栈占用的空间大小不会有单独的限制，但在我们的工作环境中默认会有 $1 \text{MiB}$ 的限制。 这可能会引起**函数调用层数较多时，程序发生栈溢出崩溃**，程序中**较深层数的递归**往往会导致这个问题。如果你的程序需要用到较大的栈空间，请务必注意该问题。

我们可以使用一些方法修改调用栈的大小限制。

- Linux

我们可以在终端中输入下列命令：`ulimit -s 1048576`。此命令的意义是，将调用栈的大小限制修改为 $1048576\text{KiB}=1 \text{GiB}$。

例如，对于如下程序 `sample.cpp`：

```cpp
#include <bits/stdc++.h>
using namespace std;
int f[1000005];
void dfs(int a){
	if(a == 0){
		f[a] = 0;
		return;
	}
	dfs(a - 1);
	f[a] = f[a - 1] + 1;
}
int main(){
	dfs(1000000);
	return 0;
}
```

将上述源代码用命令 `g++ sample.cpp -o sample` 编译为可执行文件 `sample` 后，使用 `./sample` 执行程序。

如果在没有使用命令 `ulimit -s 1048576` 的情况下运行该程序，`sample` 会因为栈溢出而崩溃；如果使用了上述命令后运行该程序，该程序则不会崩溃。

特别地，当你打开多个终端时，它们并不会共享该命令，你需要分别对它们运行该命令。

请注意，调用栈占用的空间会计入总空间占用中，和程序其他部分占用的内存共同受到内存限制。

- Windows

如果你使用 Windows 下的 Dev-C++，请选择 `工具-编译选项` 并在如下区域填入以下命令 `-Wl,--stack=1073741824`，填入后注意确认“编译时加入以下命令的”的框是**已勾选**状态。

此处 `1073741824` 的单位是 $\text{B/Bytes}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/z6mbzfqo.png)  ![](https://cdn.luogu.com.cn/upload/image_hosting/zvrzkyq5.png)


---

---
title: "跳跳棋"
layout: "post"
diff: 省选/NOI-
pid: P1852
tag: ['二分', '最近公共祖先 LCA', 'CTT（清华集训/北大集训）']
---
# 跳跳棋
## 题目描述

跳跳棋是在一条数轴上进行的。棋子只能摆在整点上。每个点不能摆超过一个棋子。

![](https://cdn.luogu.com.cn/upload/image_hosting/hyfzn745.png)

我们用跳跳棋来做一个简单的游戏：棋盘上有 $3$ 颗棋子，分别在 $a,b,c$ 这三个位置。我们要通过最少的跳动把他们的位置移动成 $x,y,z$。（棋子是没有区别的）

跳动的规则很简单，任意选一颗棋子，对一颗中轴棋子跳动。跳动后两颗棋子距离不变。一次只允许跳过 $1$ 颗棋子。

写一个程序，首先判断是否可以完成任务。如果可以，输出最少需要的跳动次数。
## 输入格式

第一行包含三个整数，表示当前棋子的位置 $a,b,c$。（互不相同）

第二行包含三个整数，表示目标位置 $x,y,z$。（互不相同）
## 输出格式

如果无解，输出一行 `NO`。

如果可以到达，第一行输出 `YES`，第二行输出最少步数。

## 样例

### 样例输入 #1
```
1 2 3
0 3 5
```
### 样例输出 #1
```
YES
2
```
## 提示

### 数据范围及约定

- $20\%$ 输入整数的绝对值均不超过 $10$；
- $40\%$ 输入整数的绝对值均不超过 $10000$；
- $100\%$ 绝对值不超过 $10^9$。


---

---
title: "[SDOI2011] 消耗战"
layout: "post"
diff: 省选/NOI-
pid: P2495
tag: ['2011', '各省省选', '山东', '最近公共祖先 LCA', '虚树', '栈']
---
# [SDOI2011] 消耗战
## 题目描述

在一场战争中，战场由 $n$ 个岛屿和 $n-1$ 个桥梁组成，保证每两个岛屿间有且仅有一条路径可达。现在，我军已经侦查到敌军的总部在编号为 $1$ 的岛屿，而且他们已经没有足够多的能源维系战斗，我军胜利在望。已知在其他 $k$ 个岛屿上有丰富能源，为了防止敌军获取能源，我军的任务是炸毁一些桥梁，使得敌军不能到达任何能源丰富的岛屿。由于不同桥梁的材质和结构不同，所以炸毁不同的桥梁有不同的代价，我军希望在满足目标的同时使得总代价最小。  

侦查部门还发现，敌军有一台神秘机器。即使我军切断所有能源之后，他们也可以用那台机器。机器产生的效果不仅仅会修复所有我军炸毁的桥梁，而且会重新随机资源分布（但可以保证的是，资源不会分布到 $1$ 号岛屿上）。不过侦查部门还发现了这台机器只能够使用 $m$ 次，所以我们只需要把每次任务完成即可。  
## 输入格式

第一行一个整数 $n$，表示岛屿数量。  

接下来 $n-1$ 行，每行三个整数 $u,v,w$ ，表示 $u$ 号岛屿和 $v$ 号岛屿由一条代价为 $w$ 的桥梁直接相连。  

第 $n+1$ 行，一个整数 $m$ ，代表敌方机器能使用的次数。  

接下来 $m$ 行，第 $i$ 行一个整数 $k_i$ ，代表第 $i$ 次后，有 $k_i$ 个岛屿资源丰富。接下来 $k_i$ 个整数 $h_1,h_2,..., h_{k_i}$ ，表示资源丰富岛屿的编号。  
## 输出格式

输出共 $m$ 行，表示每次任务的最小代价。  
## 样例

### 样例输入 #1
```
10
1 5 13
1 9 6
2 1 19
2 4 8
2 3 91
5 6 8
7 5 4
7 8 31
10 7 9
3
2 10 6
4 5 7 8 3
3 9 4 6

```
### 样例输出 #1
```
12
32
22

```
## 提示

#### 数据规模与约定

- 对于 $10\%$ 的数据，$n\leq 10, m\leq 5$ 。  
- 对于 $20\%$ 的数据，$n\leq 100, m\leq 100, 1\leq k_i\leq 10$ 。  
- 对于 $40\%$ 的数据，$n\leq 1000, 1\leq k_i\leq 15$ 。  
- 对于 $100\%$ 的数据，$2\leq n \leq 2.5\times 10^5, 1\leq m\leq 5\times 10^5, \sum k_i \leq 5\times 10^5, 1\leq k_i< n, h_i\neq 1, 1\leq u,v\leq n, 1\leq w\leq 10^5$ 。  


---

---
title: "[AHOI2005] 航线规划"
layout: "post"
diff: 省选/NOI-
pid: P2542
tag: ['2005', '线段树', '各省省选', '安徽', 'O2优化', '最近公共祖先 LCA', '树链剖分']
---
# [AHOI2005] 航线规划
## 题目描述

对 Samuel 星球的探险已经取得了非常巨大的成就，于是科学家们将目光投向了 Samuel 星球所在的星系——一个巨大的由千百万星球构成的 Samuel 星系。

星际空间站的 Samuel II 巨型计算机经过长期探测，已经锁定了 Samuel 星系中 $n$ 个星球的空间坐标，并对这些星球以 $1$ 至 $n$ 依次编号。

一些先遣飞船已经出发，在星球之间开辟探险航线。

探险航线是双向的，例如从 $1$ 号星球到 $3$ 号星球开辟探险航线，那么从 $3$ 号星球到 $1$ 号星球也可以使用这条航线。

例如下图所示：

 ![](https://cdn.luogu.com.cn/upload/pic/1644.png) 

在 $5$ 个星球之间，有 $5$ 条探险航线。

$A,B$ 两星球之间，如果某条航线不存在，就无法从 $A$ 星球抵达 $B$ 星球，我们则称这条航线为关键航线。

显然上图中，$1$ 号与 $5$ 号星球之间的关键航线有 $1$ 条：即为 $4\leftrightarrow5$ 航线。

然而，在宇宙中一些未知的磁暴和行星的冲撞，使得已有的某些航线被破坏，随着越来越多的航线被破坏，探险飞船又不能及时恢复这些航线，可见两个星球之间的关键航线会越来越多。

假设在上图中，航线 $4\leftrightarrow2$（从 $4$ 号星球到 $2$ 号星球）被破坏。此时，$1$ 号与 $5$ 号星球之间的关键航线就有 $3$ 条：$1 \leftrightarrow 3$，$3 \leftrightarrow 4$，$4 \leftrightarrow 5$。

小联的任务是，不断关注航线被破坏的情况，并随时给出两个星球之间的关键航线数目。现在请你帮助完成。

## 输入格式

第一行有两个整数，分别表示星球个数 $n$ 和初始时的航线条数 $m$。

接下来 $m$ 行，每行有两个不相同的整数 $u, v$，表示星球 $u$ 和星球 $v$ 之间存在一条航线。

接下来有若干行，每行首先给出一个整数 $op$，表示一次操作的类型。

- 若 $op = 1$，则后接两个整数 $u, v$，表示询问当前 $u, v$ 两星球之间有多少关键航线。
- 若 $op = 0$，则后接两个整数 $u, v$，表示 $u, v$ 之间的航线被破坏。
- 若 $op = -1$，则表示输入结束，后面不再存在操作。

## 输出格式

对每个 $op = 1$ 的询问，输出一行一个整数表示关键航线数目。

## 样例

### 样例输入 #1
```
5 5
1 2
1 3
3 4
4 5
4 2
1 1 5
0 4 2
1 5 1
-1
```
### 样例输出 #1
```
1
3
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 3 \times 10^4$，$1 \leq m \leq 10^5$。
- $-1 \leq op \leq 1$，$1 \leq u, v \leq n$。
- 无论航线如何被破坏，任意时刻任意两个星球都能够相互到达。在整个数据中，任意两个星球之间最多只可能存在一条直接的航线。
- 对于 $op = 0$ 的操作，保证操作前航线 $u \leftrightarrow v$ 存在。
- 询问与破坏航线的总次数不超过 $4 \times 10^4$。


---

---
title: "[ZJOI2012] 灾难"
layout: "post"
diff: 省选/NOI-
pid: P2597
tag: ['2012', '倍增', '各省省选', '浙江', 'O2优化', '拓扑排序', '最近公共祖先 LCA']
---
# [ZJOI2012] 灾难
## 题目背景

阿米巴是小强的好朋友。

阿米巴和小强在草原上捉蚂蚱。小强突然想，如果蚂蚱被他们捉灭绝了，那么吃蚂蚱的小鸟就会饿死，而捕食小鸟的猛禽也会跟着灭绝，从而引发一系列的生态灾难。

学过生物的阿米巴告诉小强，草原是一个极其稳定的生态系统。如果蚂蚱灭绝了，小鸟照样可以吃别的虫子，所以一个物种的灭绝并不一定会引发重大的灾难。
## 题目描述

我们现在从专业一点的角度来看这个问题。我们用一种叫做食物网的有向图来描述生物之间的关系：

- 一个食物网有 $n$ 个点，代表 $n$ 种生物，生物从 $1$ 到 $n$ 编号。
- 如果生物 $x$ 可以吃生物 $y$，那么从 $y$ 向 $x$ 连一个有向边。
- 这个图没有环。
- 图中有一些点没有连出边，这些点代表的生物都是生产者，可以通过光合作用来生存。
- 而有连出边的点代表的都是消费者，它们必须通过吃其他生物来生存。
- 如果某个消费者的所有食物都灭绝了，它会跟着灭绝。

我们定义一个生物在食物网中的“灾难值”为，如果它突然灭绝，那么会跟着一起灭绝的生物的种数。

举个例子：在一个草场上，生物之间的关系如下

![](https://cdn.luogu.com.cn/upload/image_hosting/oiw4lh97.png)

如果小强和阿米巴把草原上所有的羊都给吓死了，那么狼会因为没有食物而灭绝，而小强和阿米巴可以通过吃牛、牛可以通过吃草来生存下去。所以，羊的灾难值是 $1$。但是，如果草突然灭绝，那么整个草原上的 $5$ 种生物都无法幸免，所以，草的灾难值是 $4$。

给定一个食物网，你要求出每个生物的灾难值。
## 输入格式

第一行有一个整数，表示食物网的结点个数 $n$。

第 $2$ 到第 $(n + 1)$ 行，每行若干个互不相同的整数，第 $(i + 1)$ 行的整数 $a_{i, j}$ 表示编号为 $i$ 的生物可以吃编号为 $a_{i, j}$ 的生物。每行结尾有一个整数 $0$ 表示本行结束。
## 输出格式

输出 $n$ 行，每行一个整数，第 $i$ 行输出编号为 $i$ 的生物的灾难值。
## 样例

### 样例输入 #1
```
5
0
1 0
1 0
2 3 0
2 0

```
### 样例输出 #1
```
4
1
0
0
0
```
## 提示

### 样例 1 解释

样例输入描述了题目描述中举的例子。

### 数据规模与约定

- 对于 $50\%$ 的数据，保证 $n \leq 10^4$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 65534$，$1 \leq a_{i, j} \leq n$，输入的文件大小不超过 1 MB，且图上不存在环。


---

---
title: "Count on a tree"
layout: "post"
diff: 省选/NOI-
pid: P2633
tag: ['线段树', '最近公共祖先 LCA', '可持久化线段树', '可持久化']
---
# Count on a tree
## 题目描述

给定一棵 $n$ 个节点的树，每个点有一个权值。有 $m$ 个询问，每次给你 $u,v,k$，你需要回答 $u \text{ xor last}$ 和 $v$ 这两个节点间第 $k$ 小的点权。  

其中 $\text{last}$ 是上一个询问的答案，定义其初始为 $0$，即第一个询问的 $u$ 是明文。

## 输入格式

第一行两个整数 $n,m$。

第二行有 $n$ 个整数，其中第 $i$ 个整数表示点 $i$ 的权值。

后面 $n-1$ 行每行两个整数 $x,y$，表示点 $x$ 到点 $y$ 有一条边。

最后 $m$ 行每行三个整数 $u,v,k$，表示一组询问。

## 输出格式

$m$ 行，每行一个正整数表示每个询问的答案。

## 样例

### 样例输入 #1
```
8 5
105 2 9 3 8 5 7 7
1 2
1 3
1 4
3 5
3 6
3 7
4 8
2 5 1
0 5 2
10 5 3
11 5 4
110 8 2
```
### 样例输出 #1
```
2
8
9
105
7
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,m \le 10^5$，点权在 $[1, 2 ^ {31} - 1]$ 之间。

暴力自重。。。

来源：bzoj2588 Spoj10628.

本题数据为洛谷自造数据，使用 [CYaRon](https://github.com/luogu-dev/cyaron) 耗时 5 分钟完成数据制作。



---

---
title: "[USACO09JAN] Safe Travel G"
layout: "post"
diff: 省选/NOI-
pid: P2934
tag: ['2009', 'USACO', '并查集', '最短路', '最近公共祖先 LCA']
---
# [USACO09JAN] Safe Travel G
## 题目描述

Gremlins have infested the farm. These nasty, ugly fairy-like

creatures thwart the cows as each one walks from the barn (conveniently located at pasture\_1) to the other fields, with cow\_i traveling to from pasture\_1 to pasture\_i. Each gremlin is personalized and knows the quickest path that cow\_i normally takes to pasture\_i. Gremlin\_i waits for cow\_i in the middle of the final cowpath of the quickest route to pasture\_i, hoping to harass cow\_i.

Each of the cows, of course, wishes not to be harassed and thus chooses an at least slightly  different route from pasture\_1 (the barn) to pasture\_i.

Compute the best time to traverse each of these new not-quite-quickest routes that enable each cow\_i that avoid gremlin\_i who is located on the final cowpath of the quickest route from pasture\_1 to

pasture\_i.

As usual, the M (2 <= M <= 200,000) cowpaths conveniently numbered 1..M are bidirectional and enable travel to all N (3 <= N <= 100,000) pastures conveniently numbered 1..N. Cowpath i connects pastures a\_i (1 <= a\_i <= N) and b\_i (1 <= b\_i <= N) and requires t\_i (1 <= t\_i <= 1,000) time to traverse. No two cowpaths connect the same two pastures, and no path connects a pasture to itself (a\_i != b\_i). Best of all, the shortest path regularly taken by cow\_i from pasture\_1 to pasture\_i is unique in all the test data supplied to your program.

By way of example, consider these pastures, cowpaths, and [times]:

```cpp
1--[2]--2-------+ 
|       |       | 
[2]     [1]     [3] 
|       |       | 
+-------3--[4]--4
```
``` 
TRAVEL     BEST ROUTE   BEST TIME   LAST PATH 
p_1 to p_2       1->2          2         1->2 
p_1 to p_3       1->3          2         1->3 
p_1 to p_4      1->2->4        5         2->4 
```
When gremlins are present:

```cpp
TRAVEL     BEST ROUTE   BEST TIME    AVOID 
p_1 to p_2     1->3->2         3         1->2 
p_1 to p_3     1->2->3         3         1->3 
p_1 to p_4     1->3->4         6         2->4 
```
For 20% of the test data, N <= 200. 

For 50% of the test data, N <= 3000. 

TIME LIMIT: 3 Seconds

MEMORY LIMIT: 64 MB
## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..M+1: Three space-separated integers: a\_i, b\_i, and t\_i

## 输出格式

\* Lines 1..N-1: Line i contains the smallest time required to travel from pasture\_1 to pasture\_i+1 while avoiding the final cowpath of the shortest path from pasture\_1 to pasture\_i+1. If no such path exists from pasture\_1 to pasture\_i+1, output -1 alone on the line.

## 样例

### 样例输入 #1
```
4 5 
1 2 2 
1 3 2 
3 4 4 
3 2 1 
2 4 3 

```
### 样例输出 #1
```
3 
3 
6 

```
## 题目翻译

**【题目描述】**

给定一张有 $n$ 个节点，$m$ 条边的无向图，对于任意的 $i$（$2\le i\le n$），请求出在不经过原来 $1$ 节点到 $i$ 节点最短路上最后一条边的前提下，$1$ 节点到 $i$ 节点的最短路。

特别地，保证 $1$ 到任何一个点 $i$ 的最短路都是唯一的。

保证图中没有重边和自环。

**【输入格式】**

第一行，两个整数 $n,m$。

之后 $m$ 行，每行三个整数 $a_i,b_i,t_i$ 表示有一条 $a_i$ 到 $b_i$，边权为 $t_i$ 的无向边。

**【输出格式】**

共 $n-1$ 行，第 $i$ 行表示 $1$ 到 $i+1$ 在不经过原来 $1$ 节点到 $i+1$ 节点最短路上最后一条边的前提下的最短路。如果最短路不存在，则在对应行输出 `-1`。

翻译贡献者：@[cryozwq](/user/282751)。


---

---
title: "[HNOI2014] 世界树"
layout: "post"
diff: 省选/NOI-
pid: P3233
tag: ['动态规划 DP', '2014', '倍增', '湖南', '最近公共祖先 LCA', '虚树']
---
# [HNOI2014] 世界树
## 题目描述

世界树是一棵无比巨大的树，它伸出的枝干构成了整个世界。在这里，生存着各种各样的种族和生灵，他们共同信奉着绝对公正公平的女神艾莉森，在他们的信条里，公平是使世界树能够生生不息、持续运转的根本基石。

世界树的形态可以用一个数学模型来描述：世界树中有 $n$ 个种族，种族的编号分别从 $1$ 到 $n$，分别生活在编号为 $1$ 到 $n$ 的聚居地上，种族的编号与其聚居地的编号相同。有的聚居地之间有双向的道路相连，道路的长度为 $1$。保证连接的方式会形成一棵树结构，即所有的聚居地之间可以互相到达，并且不会出现环。定义两个聚居地之间的距离为连接他们的道路的长度；例如，若聚居地 $a$ 和 $b$ 之间有道路，$b$ 和 $c$ 之间有道路，因为每条道路长度为 $1$ 而且又不可能出现环，所以 $a$ 与 $c$ 之间的距离为 $2$。

出于对公平的考虑，第 $i$ 年，世界树的国王需要授权 $m_i$ 个种族的聚居地为临时议事处。对于某个种族 $x$（$x$ 为种族的编号），如果距离该种族最近的临时议事处为 $y$（$y$ 为议事处所在聚居地的编号），则种族 $x$ 将接受 $y$ 议事处的管辖（如果有多个临时议事处到该聚居地的距离一样，则 $y$ 为其中编号最小的临时议事处）。

现在国王想知道，在 $q$ 年的时间里，每一年完成授权后，当年每个临时议事处将会管理多少个种族（议事处所在的聚居地也将接受该议事处管理）。 现在这个任务交给了以智慧著称的灵长类的你：程序猿。请帮国王完成这个任务吧。
## 输入格式

第一行为一个正整数 $n$，表示世界树中种族的个数。接下来 $n-1$ 行，每行两个正整数 $x，y$，表示 $x$ 聚居地与 $y$ 聚居地之间有一条长度为 $1$ 的双向道路。接下来一行为一个正整数 $q$，表示国王询问的年数。接下来 $q$ 块，每块两行：第 $i$ 块的第一行为 $1$ 个正整数 $m_i$，表示第 $i$ 年授权的临时议事处的个数。第 $i$ 块的第二行为 $m_i$ 个正整数 $h_1, h_2,\ldots,h_{m_i}$，表示被授权为临时议事处的聚居地编号（保证互不相同）。

## 输出格式

输出包含 $q$ 行，第 $i$ 行为 $m_i$ 个整数，该行的第 $j$ ($j=1, 2,\ldots, m_i$) 个数表示第 $i$ 年被授权的聚居地 $h_j$ 的临时议事处管理的种族个数。

## 样例

### 样例输入 #1
```
10
2 1
3 2
4 3
5 4
6 1
7 3
8 3
9 4
10 1
5
2
6 1
5
2 7 3 6 9
1
8
4
8 7 10 3
5
2 9 3 5 8
```
### 样例输出 #1
```
1 9   
3 1 4 1 1   
10  
1 1 3 5   
4 1 3 1 1
```
## 提示

对于 $100\%$ 的数据，$N\leq 300000$, $q\leq 300000$, $\sum^q_{i=1}m_i \leq 300000$。



---

---
title: "[HNOI2015] 开店"
layout: "post"
diff: 省选/NOI-
pid: P3241
tag: ['2015', '湖南', '分治', '最近公共祖先 LCA', '动态树 LCT']
---
# [HNOI2015] 开店
## 题目描述

风见幽香有一个好朋友叫八云紫，她们经常一起看星星看月亮从诗词歌赋谈到人生哲学。最近她们灵机一动，打算在幻想乡开一家小店来做生意赚点钱。

这样的想法当然非常好啦，但是她们也发现她们面临着一个问题，那就是店开在哪里，面向什么样的人群。很神奇的是，幻想乡的地图是一个树形结构，幻想乡一共有 $n$ 个地方，编号为 $1$ 到 $n$，被 $n-1$ 条带权的边连接起来。每个地方都住着一个妖怪，其中第 $i$ 个地方的妖怪年龄是 $x_i$。

妖怪都是些比较喜欢安静的家伙，所以它们并不希望和很多妖怪相邻。所以这个树所有顶点的度数都小于或等于 $3$。妖怪和人一样，兴趣点随着年龄的变化自然就会变化，比如我们的 $18$ 岁少女幽香和八云紫就比较喜欢可爱的东西。幽香通过研究发现，基本上妖怪的兴趣只跟年龄有关，所以幽香打算选择一个地方 $u$（$u$ 为编号），然后在 $u$ 开一家面向年龄在 $L$ 到 $R$ 之间（即年龄大于等于 $L$ 小于等于 $R$）的妖怪的店。

也有可能 $u$ 这个地方离这些妖怪比较远，于是幽香就想要知道所有年龄在 $L$ 到 $R$ 之间的妖怪，到点 $u$ 的距离的和是多少（妖怪到 $u$ 的距离是该妖怪所在地方到 $u$ 的路径上的边的权之和），幽香把这个称为这个开店方案的方便值。

幽香她们还没有决定要把店开在哪里，八云紫倒是准备了很多方案，于是幽香想要知道，对于每个方案，方便值是多少呢。

## 输入格式

第一行三个用空格分开的数 $n,Q$ 和 $A$，表示树的大小、开店的方案个数和妖怪的年龄上限。

第二行 $n$ 个用空格分开的数 $x_1,x_2,\ldots,x_n$；$x_i$ 表示第 $i$ 个地点妖怪的年龄，满足 $0\le x_i\lt A$。(年龄是可以为 $0$ 的，例如刚出生的妖怪的年龄为 $0$。) 

接下来 $n-1$  行，每行三个用空格分开的数 $a$、$b$、$c$，表示树上的顶点 $a$ 和 $b$ 之间有一条权为 $c(1\le c\le1000)$ 的边，$a$ 和 $b$ 是顶点编号。 

接下来 $Q$ 行，每行三个用空格分开的数 $u,a,b$。

对于这 $Q$ 行的每一行，用 $a,b,A$ 计算出 $L$ 和 $R$，表示询问”在地方 $u$ 开店，面向妖怪的年龄区间为 $[L,R]$ 的方案的方便值是多少“。

对于其中第 $1$ 行，$L$ 和 $R$ 的计算方法为：$L=\min(a\bmod A,b\bmod A),R=\max(a\bmod A,b\bmod A)$ 。

对于第 $2$ 到第 $Q$ 行，假设前一行得到的方便值为 $ans$，那么当前行的 $L$ 和 $R$ 计算方法为： $L=\min((a+ans)\bmod A,(b+ans)\bmod A), R=\max((a+ans)\bmod A,(b+ans)\bmod A)$ 。
## 输出格式

对于每个方案，输出一行表示方便值。

## 样例

### 样例输入 #1
```
10 10 10
0 0 7 2 1 4 7 7 7 9
1 2 270
2 3 217
1 4 326
2 5 361
4 6 116
3 7 38
1 8 800
6 9 210
7 10 278
8 9 8
2 8 0
9 3 1
8 0 8
4 2 7
9 7 3
4 7 0
2 2 7
3 2 1
2 3 4
```
### 样例输出 #1
```
1603 
957 
7161 
9466 
3232 
5223 
1879 
1669 
1282 
0
```
## 提示

满足 $n\le1.5 \times 10^5,Q\le2 \times 10^5$。对于所有数据，满足 $A\le 10^9$。 


---

---
title: "[HNOI2015] 接水果"
layout: "post"
diff: 省选/NOI-
pid: P3242
tag: ['2015', '湖南', '深度优先搜索 DFS', '最近公共祖先 LCA', '树套树']
---
# [HNOI2015] 接水果
## 题目描述

风见幽香非常喜欢玩一个叫做 osu! 的游戏，其中她最喜欢玩的模式就是接水果。由于她已经 DT FC 了 The big black，她觉得这个游戏太简单了，于是发明了一个更加难的版本。

首先有一个地图，是一棵由 $n$ 个顶点，$n-1$ 条边组成的树。

这颗树上有 $p$ 个盘子，每个盘子实际上是一条路径，并且每个盘子还有一个权值。第 $i$ 个盘子就是顶点 $a_i$ 到顶点 $b_i$ 的路径（由于是树，所以从 $a_i$ 到 $b_i$ 的路径是唯一的），权值为 $c_i$。

接下来依次会有 $q$ 个水果掉下来，每个水果本质上也是一条路径，第 $i$ 个水果是从顶点 $u_i$ 到顶点 $v_i$ 的路径。

幽香每次需要选择一个盘子去接当前的水果：一个盘子能接住一个水果，当且仅当盘子的路径是水果的路径的子路径。这里规定：从 $a$ 到 $b$ 的路径与从 $b$ 到 $a$ 的路径是同一条路径。

当然为了提高难度，对于第 $i$ 个水果，你需要选择能接住它的所有盘子中，权值第 $k_i$ 小的那个盘子，每个盘子可重复使用（没有使用次数的上限：一个盘子接完一个水果后，后面还可继续接其他水果，只要它是水果路径的子路径）。幽香认为这个游戏很难，你能轻松解决给她看吗？

## 输入格式

第一行三个数 $n$ 和 $p$ 和 $q$，表示树的大小和盘子的个数和水果的个数。

接下来 $n-1$ 行，每行两个数 $a,b$，表示树上的 $a$ 和 $b$ 之间有一条边。树中顶点按 $1$ 到 $n$ 标号。

接下来 $p$ 行，每行三个数 $a,b,c$，表示路径为 $a$ 到 $b$、权值为 $c$ 的盘子，其中 $a \neq b$。

接下来 $q$ 行，每行三个数 $u,v,k$，表示路径为 $u$ 到 $v$ 的水果，其中 $u \neq v$，你需要选择第 $k$ 小的盘子，第 $k$ 小一定存在。

## 输出格式

对于每个果子，输出一行表示选择的盘子的权值。

## 样例

### 样例输入 #1
```
10 10 10
1 2
2 3
3 4
4 5
5 6
6 7
7 8
8 9
9 10
3 2 217394434
10 7 13022269
6 7 283254485
6 8 333042360
4 6 442139372
8 3 225045590
10 4 922205209
10 8 808296330
9 2 486331361
4 9 551176338
1 8 5
3 8 3
3 8 4
1 8 3
4 8 1
2 3 1
2 3 1
2 3 1
2 4 1
1 4 1
```
### 样例输出 #1
```
442139372 
333042360 
442139372 
283254485 
283254485 
217394434 
217394434 
217394434 
217394434 
217394434
```
## 提示

对于 $100\%$ 的数据，$1\leq n,p,q \leq4\times 10^4$，$0 \le c \le 10^9$。



---

---
title: "[HNOI2016] 树"
layout: "post"
diff: 省选/NOI-
pid: P3248
tag: ['2016', '各省省选', '湖南', '最近公共祖先 LCA', '树套树', '可持久化线段树']
---
# [HNOI2016] 树
## 题目描述

小A想做一棵很大的树，但是他手上的材料有限，只好用点小技巧了。开始，小A只有一棵结点数为 $N$ 的树，结点的编号为 $1,2,...,N$，其中结点 $1$ 为根；我们称这颗树为模板树。小A决定通过这棵模板树来构建一颗大树。构建过程如下：

1. 将模板树复制为初始的大树。

2. 以下(2.1)(2.2)(2.3)步循环执行 $M$ 次

（2.1）选择两个数字 $a,b$，其中 $1 \leq a \leq N, 1 \leq b \leq \text{当前大树的结点数}$。

（2.2）将模板树中以结点 $a$ 为根的子树复制一遍，挂到大树中结点 $b$ 的下方(也就是说，模板树中的结点 $a$ 为根的子树复制到大树中后，将成为大树中结点 $b$ 的子树)。

（2.3）将新加入大树的结点按照在模板树中编号的顺序重新编号。例如，假设在进行2.2步之前大树有 $L$ 个结点，模板树中以 $a$ 为根的子树共有 $C$ 个结点，那么新加入模板树的 $C$ 个结点在大树中的编号将是 $L+1,L+2,...,L+C$ ；大树中这C个结点编号的大小顺序和模板树中对应的 $C$ 个结点的大小顺序是一致的。下面给出一个实例。假设模板树如下图：![](https://cdn.luogu.com.cn/upload/image_hosting/mchs3i55.png)

根据第(1)步，初始的大树与模板树是相同的。

在(2.1)步，假设选择了 $a=4, b=3$。运行(2.2)和(2.3)后，得到新的大树如下图所示

![](https://cdn.luogu.com.cn/upload/image_hosting/ey2lqez8.png)

现在他想问你，树中一些结点对的距离是多少。

## 输入格式

第一行三个整数：$N,M,Q$，以空格隔开，$N$ 表示模板树结点数，$M$ 表示第(2)中的循环操作的次数，$Q$ 表示询问数量。

接下来 $N-1$ 行，每行两个整数 $fr,to$，表示模板树中的一条树边。

再接下来$M$行，每行两个整数$x,to$，表示将模板树中 $x$ 为根的子树复制到大树中成为结点 $to$ 的子树的一次操作。

再接下来 $Q$ 行，每行两个整数 $fr,to$，表示询问大树中结点 $fr$ 和 $to$ 之间的距离是多少。

$N,M,Q \leq 100000$

## 输出格式

输出 $Q$ 行，每行一个整数，第 $i$ 行是第 $i$ 个询问的答案。

## 样例

### 样例输入 #1
```
5 2 3
1 4
1 3
4 2
4 5
4 3
3 2
6 9
1 8
5 3
```
### 样例输出 #1
```
6
3
3
```
## 提示

经过两次操作后，大树变成了下图所示的形状：

![](https://cdn.luogu.com.cn/upload/image_hosting/370xfnn2.png)

结点6到9之间经过了6条边，所以距离为6；类似地，结点1到8之间经过了3条边；结点5到3之间也经过了3条边。



---

---
title: "[HNOI2016] 网络"
layout: "post"
diff: 省选/NOI-
pid: P3250
tag: ['2016', '线段树', '湖南', '最近公共祖先 LCA', '树链剖分']
---
# [HNOI2016] 网络
## 题目描述

一个简单的网络系统可以被描述成一棵无根树。每个节点为一个服务器。连接服务器与服务器的数据线则看做一条树边。两个服务器进行数据的交互时，数据会经过连接这两个服务器的路径上的所有服务器（包括这两个服务器自身）。

由于这条路径是唯一的，当路径上的某个服务器出现故障，无法正常运行时，数据便无法交互。此外，每个数据交互请求都有一个重要度，越重要的请求显然需要得到越高的优先处理权。现在，你作为一个网络系统的管理员，要监控整个系统的运行状态。系统的运行也是很简单的，在每一个时刻，只有可能出现下列三种事件中的一种：

1. 在某两个服务器之间出现一条新的数据交互请求；  
2. 某个数据交互结束请求；
3. 某个服务器出现故障。系统会在任何故障发生后立即修复。也就是在出现故障的时刻之后，这个服务器依然是正常的。但在服务器产生故障时依然会对需要经过该服务器的数据交互请求造成影响。

你的任务是在每次出现故障时，维护未被影响的请求中重要度的最大值。注意，如果一个数据交互请求已经结束，则不将其纳入未被影响的请求范围。

## 输入格式

第一行两个正整数 $n,m$，分别描述服务器和事件个数。服务器编号是从 $1$ 开始的，因此 $n$ 个服务器的编号依次是 $1,2,3,\cdots,n$。

接下来 $n-1$ 行，每行两个正整数 $u,v$，描述一条树边。$u$ 和 $v$ 是服务器的编号。

接下来 $m$ 行，按发生时刻依次描述每一个事件；即第 $i$ 行（$i=1,2,3,...,m$）描述时刻 $i$ 发生的事件。每行的第一个数 $\mathrm{type}$ 描述事件类型，共 $3$ 种类型：

1. 若 $\mathrm{type}=0$，之后有三个正整数 $a,b,v$，表示服务器 $a,b$ 之间出现一条重要度为 $v$ 的数据交互请求；
2. 若 $\mathrm{type}=1$，之后有一个正整数 $t$，表示时刻 $t$（也就是第 $t$ 个发生的事件）出现的数据交互请求结束；
3. 若 $\mathrm{type}=2$，之后有一个正整数 $x$，表示服务器 $x$ 在这一时刻出现了故障。

对于每个 $\mathrm{type}$ 为 $2$ 的事件，就是一次询问，即询问“当服务器 $x$ 发生故障时，未被影响的请求中重要度的最大值是多少？”注意可能有某个服务器自身与自身进行数据交互的情况。$2 \le n \le 10^5$，$1 \le m \le 2\times 10^5$，其他的所有输入值不超过 $10^9$。

## 输出格式

对于每个 $\mathrm{type}=2$ 的事件，即服务器出现故障的事件，输出一行一个整数，描述未被影响的请求中重要度的最大值。如果此时没有任何请求，或者所有请求均被影响，则输出 $-1$。

## 样例

### 样例输入 #1
```
13 23
1 2
1 3
2 4
2 5
3 6
3 7
4 8
4 9
6 10
6 11
7 12
7 13
2 1
0 8 13 3
0 9 12 5
2 9
2 8
2 2
0 10 12 1
2 2
1 3
2 7
2 1
0 9 5 6
2 4
2 5
1 7
0 9 12 4
0 10 5 7
2 1
2 4
2 12
1 2
2 5
2 3
```
### 样例输出 #1
```
-1 
3 
5 
-1 
1 
-1 
1 
1 
3 
6 
7 
7 
4 
6
```
## 提示

样例给出的树如下所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ka4zpxia.png)

解释其中的部分询问；下面的解释中用 $(a,b;t,v)$ 表示在 $t$ 时刻出现的服务器 $a$ 和 $b$ 之间的重要度为 $v$ 的请求：

对于第一个询问（在时刻 $1$），此时没有任何请求，输出 $-1$。

对于第四个询问（在时刻 $6$），此时有两条交互$(8,13;2,3),(9,12;3,5)$，所有询问均经过 $2$ 号服务器，输出 $-1$。

对于第五个询问（在时刻 $8$），此时有三条交互 $(8,13;2,3),(9,12;3,5),(10,12;7,1)$，只有交互 $(10,12;7,1)$ 没有经过 $2$ 号服务器，因此输出其重要度 $1$。

对于最后一个询问（在时刻 $23$），此时有三条交互 $(9,5;12,6),(9,12;16,4),(10,5;17,7)$。当 $3$ 号服务器出现故障时，只有交互 $(9,5;12,6)$ 没有经过 $3$ 号服务器，因此输出 $6$。

$\text{upd 2016.5.20}$：新加一组 $\text{Hack}$ 数据。


---

---
title: "[SDOI2015] 寻宝游戏"
layout: "post"
diff: 省选/NOI-
pid: P3320
tag: ['2015', '山东', '深度优先搜索 DFS', '最近公共祖先 LCA', '虚树']
---
# [SDOI2015] 寻宝游戏
## 题目描述

小 B 最近正在玩一个寻宝游戏，这个游戏的地图中有 $N$ 个村庄和 $N-1$ 条道路，并且任何两个村庄之间有且仅有一条路径可达。游戏开始时，玩家可以任意选择一个村庄，瞬间转移到这个村庄，然后可以任意在地图的道路上行走，若走到某个村庄中有宝物，则视为找到该村庄内的宝物，直到找到所有宝物并返回到最初转移到的村庄为止。

小 B 希望评测一下这个游戏的难度，因此他需要知道玩家找到所有宝物需要行走的最短路程。但是这个游戏中宝物经常变化，有时某个村庄中会突然出现宝物，有时某个村庄内的宝物会突然消失，因此小 B 需要不断地更新数据，但是小 B 太懒了，不愿意自己计算，因此他向你求助。为了简化问题，我们认为最开始时所有村庄内均没有宝物。
## 输入格式

第一行，两个整数 $N,M$，其中 $M$ 为宝物的变动次数。

接下来的 $N-1$ 行，每行三个整数 $x,y,z$，表示村庄 $x,y$ 之间有一条长度为 $z$ 的道路。

接下来的 $M$ 行，每行一个整数 $t$，表示一个宝物变动的操作。若该操作前村庄 $t$ 内没有宝物，则操作后村庄内有宝物；若该操作前村庄 $t$ 内有宝物，则操作后村庄内没有宝物。
## 输出格式

$M$ 行，每行一个整数，其中第 $i$ 行的整数表示第 $i$ 次操作之后玩家找到所有宝物需要行走的最短路程。若只有一个村庄内有宝物，或者所有村庄内都没有宝物，则输出 `0`。
## 样例

### 样例输入 #1
```
4 5
1 2 30
2 3 50
2 4 60
2
3
4
2
1
```
### 样例输出 #1
```
0
100
220
220
280
```
## 提示

- 对于 $10\%$ 的数据，$1 \leq N \leq 100, 1 \leq M \leq 100$；
- 对于 $20\%$ 的数据，$1 \leq N \leq 1000, 1 \leq M \leq 1000$；
- 对于另外 $15\%$ 的数据，每个村庄最多成为两条道路的端点；
- 对于 $100\%$ 的数据，$1 \leq N \leq 100000,\ 1 \leq M \leq 100000,\ 1 \leq z \leq 10^9$。


---

---
title: "[POI 2012] RAN-Rendezvous"
layout: "post"
diff: 省选/NOI-
pid: P3533
tag: ['2012', '倍增', 'POI（波兰）', '最近公共祖先 LCA']
---
# [POI 2012] RAN-Rendezvous
## 题目描述

Byteasar is a ranger who works in the Arrow Cave - a famous rendezvous destination among lovers.

The cave consists of $n$ chambers connected with one-way corridors.

In each chamber exactly one outgoing corridor is marked with an arrow.

Every corridor leads directly to some (not necessarily different) chamber.

The enamoured couples that agree to meet in the Arrow Cave are notorious for forgetting to agree upon    specific chamber, and consequently often cannot find their dates.

In the past this led to many mix-ups and misunderstandings\dots    But ever since each chamber is equipped with an emergency telephone line to the ranger on duty,    helping the enamoured find their dates has become the rangers' main occupation.

The rangers came up with the following method.

Knowing where the enamoured are, they tell each of them how many times they should follow the corridor marked with an arrow in order to meet their date.

The lovers obviously want to meet as soon as possible - after all, they came to the cave to spend time together, not to wander around alone!

Most rangers are happy to oblige: they do their best to give each couple a valid pair of numbers such that their maximum is minimal.

But some rangers, among their numbers Byteasar, grew tired of this extracurricular activity and ensuing puzzles.  Byteasar has asked you to write a program    that will ease the process.  The program, given a description of the cave and the current location of $k$ couples,    should determine $k$ pairs of numbers $x_i$ and $y_i$ such that if the $i$-th couple follows respectively: he $x_i$ and she $y_i$ corridors marked with arrows,then they will meet in a single chamber of the cave $max(x_i,y_i)$ is minimal,subject to above $min(x_i,y_i)$ is minimal,if above conditions do not determine a unique solution, then the woman should cover smaller distance ($x_i\ge y_i$).

It may happen that such numbers $x_i$ and $y_i$ do not exist - then let $x_i=y_i=-1$.  Note that it is fine for several couples    to meet in a single chamber.  Once the lovers have found their dates, they will be happy to lose themselves in the cave again...
## 输入格式

In the first line of the standard input there are two positive integers $n$ and $k$($1\le n,k\le 500\ 000$), separated by a single space, that denote   the number of chambers in the Arrow Cave and the number of couples who want to find their dates, respectively.

The chambers are numbered from 1 to $n$, while the enamoured couples are numbered from 1 to $k$.

The second line of input contains $n$ positive integers separated by single spaces:

the $i$-th such integer determines the number of chamber to which the corridor marked with an arrow going out of chamber $i$ leads.

The following $k$ lines specify the queries by the separated couples. Each such query consists of two positive integers separated by a single space - these denote the numbers of chambers where the lovers are - first him, then her.

In the tests worth 40% of the total points it additionally holds that $n,k\le 2\ 000$.

## 输出格式

Your program should print exactly $k$ lines to the standard output,   one line per each couple specified in the input:

the $i$-th line of the output should give the instructions for the $i$-th couple on the input.

I.e., the $i$-th line of output should contain the integers $x_i,y_i$, separated by a single space.

## 样例

### 样例输入 #1
```
12 5
4 3 5 5 1 1 12 12 9 9 7 1
7 2
8 11
1 2
9 10
10 5
```
### 样例输出 #1
```
2 3
1 2
2 2
0 1
-1 -1
```
## 题目翻译

### 题目描述

**译自 POI 2012 Stage 1. 「[Rendezvous](https://szkopul.edu.pl/problemset/problem/MZTXfOVnJmac175TTH5Lr9Q3/site/?key=statement)」**

给定一个有 $n$ 个顶点的有向图，每个顶点有且仅有一条出边。每次询问给出两个顶点 $a_i$ 和 $b_i$，求满足以下条件的 $x_i$ 和 $y_i$：
* 从顶点 $a_i$ 沿出边走 $x_i$ 步与从顶点 $b_i$ 沿出边走 $y_i$ 步到达的顶点相同。
* $\max(x_i, y_i)$ 最小。
* 满足以上条件的情况下 $\min(x_i, y_i)$ 最小。
* 如果以上条件没有给出一个唯一的解，则还需要满足 $x_i \ge y_i$.

如果不存在这样的 $x_i$ 和 $y_i$，则 $x_i = y_i = -1$.

### 输入格式

第一行两个正整数 $n$ 和 $k$（$1 \le n \le 500\ 000,1 \le k \le 500\ 000$），表示顶点数和询问个数。

接下来一行 $n$ 个正整数，第 $i$ 个数表示 $i$ 号顶点出边指向的顶点。

接下来 $k$ 行表示询问，每行两个整数 $a_i$ 和 $b_i$.

### 输出格式

对每组询问输出两个整数 $x_i$ 和 $y_i$.

### 数据范围

对于 $40\%$ 的数据，$n \le 2000,k \le 2000$.

对于 $100\%$ 的数据，$1 \le n \le 500\ 000,1 \le k \le 500\ 000$.


---

---
title: "雪辉"
layout: "post"
diff: 省选/NOI-
pid: P3603
tag: ['洛谷原创', 'O2优化', '最近公共祖先 LCA', '洛谷月赛']
---
# 雪辉
## 题目背景

**时间限制3s，空间限制512MB**


三周目的由乃被钦定成为了卡密，她立刻赶去二周目的世界寻找雪辉

但是按照设定，两个平行世界是没法互相影响的，也就是原则上由乃是没法去二周目世界的

这时候Deus又跳出来说，其实设定是作者骗你的，只要爱的力量足够强大什么都可以做到（好狗血）


Deus：由乃你为了雪辉是不是什么都可以做呀

yuno：当然啦这还用想

Deus：那你帮我做个题吧

yuno：只要不是数据结构，什么题我都做

Deus：出题人是那个n????????呀，他出（抄）的题除了傻逼数据结构还有啥。。。

yuno：你说的很有道理。。。

Deus：上次那个题你不是两分钟就秒了吗，这个题比那个还简单

yuno：（小声）其实那个是bzoj上面的大佬帮我做的

Deus：好吧就这么愉快的钦定了

![](https://cdn.luogu.com.cn/upload/pic/4134.png)

## 题目描述

给一个n个点的树，点有点权，有m次询问，每次询问多条链的并有多少种不同的点权以及它的mex

mex就是一个集合中最小的没有出现的非负整数，注意0要算

比如说集合是1,9,2,6,0,8,1,7，则出现了0,1,2,6,7,8,9这7种不同的点权，因为没有3所以mex是3

![](https://cdn.luogu.com.cn/upload/pic/4132.png)

## 输入格式

第一行三个数n，m，意义如题所述，和一个数f

如果f是0，代表Deus没有使用膜法，如果f是1，代表Deus使用了膜法

之后一行n个数，表示点权

之后n-1行，每行两个数x，y，表示x和y节点之间有一条边，保证是一个树

之后m行，每行先是一个数a，表示这次输入a条链，紧接着2a个数(x1,y1)(x2,y2)...表示每条树链

如果数据被Deus施了膜法，这2a个数都要异或上上一个询问的答案lastans，如果是第一次询问则这个lastans = 0，因为每次询问有两个答案，lastans为这两个答案的和

如果没有膜法，则-1s并且不异或

## 输出格式

m行，每行两个数表示点权种类数以及mex

## 样例

### 样例输入 #1
```
10 1 0
0 0 0 1 1 0 2 2 1 2 
2 3
1 2
4 5
3 4
7 8
6 7
5 6
9 10
8 9
1
6 8
```
### 样例输出 #1
```
2 1
```
### 样例输入 #2
```
10 1 1
0 0 1 0 0 2 2 0 0 0 
2 3
1 2
4 5
3 4
7 8
6 7
5 6
9 10
8 9
4
1 7
3 3
1 1
9 3

```
### 样例输出 #2
```
3 3
```
## 提示

设a的和为q

对于20%的数据，n,q<=1000，f=0

对于另外30%的数据，n,q<=100000，树是一条链，f=0

对于所有数据n,q<=100000,且点权<=30000


最后，由乃祝大家新年快乐

![](https://cdn.luogu.com.cn/upload/pic/4135.png)



---

---
title: "遥远的国度"
layout: "post"
diff: 省选/NOI-
pid: P3979
tag: ['线段树', '倍增', '最近公共祖先 LCA', '树链剖分']
---
# 遥远的国度
## 题目描述

`zcwwzdjn` 在追杀 `zhx` ，而 `zhx` 逃入了一个遥远的国度。当 `zcwwzdjn` 准备进入遥远的国度继续追杀时，守护神 `RapiD` 阻拦了 `zcwwzdjn` 的去路，他需要 `zcwwzdjn` 完成任务后才能进入遥远的国度继续追杀。

问题是这样的：遥远的国度有 $n$ 个城市，这些城市之间由一些路连接且这些城市构成了一颗树。这个国度有一个首都，我们可以把这个首都看做整棵树的根，但遥远的国度比较奇怪，首都是随时有可能变为另外一个城市的。遥远的国度的每个城市有一个防御值，第 $i$ 个的防御值为 $val_i$，有些时候 `RapiD` 会使得某两个城市之间的路径上的所有城市的防御值都变为某个值。

`RapiD` 想知道在某个时候，如果把首都看做整棵树的根的话，那么以某个城市为根的子树的所有城市的防御值最小是多少。

由于 `RapiD` 无法解决这个问题，所以他拦住了 `zcwwzdjn` 希望他能帮忙。但 `zcwwzdjn` 还要追杀 `zhx`，所以这个重大的问题就被转交到了你的手上。
## 输入格式

第 $1$ 行两个整数 $n\ m$，代表城市个数和操作数。

第 $2$ 行至第 $n$ 行，每行两个整数 $u\ v$，代表城市 $u$ 和城市 $v$ 之间有一条路。

第 $n+1$ 行，有 $n$ 个整数，第 $i$ 个代表第 $i$ 个点的初始防御值 $val_i$。

第 $n+2$ 行一个整数 $id$，代表初始的首都为 $id$。

第 $n+3$ 行至第 $n+m+2$ 行，首先有一个整数 $opt$。

如果 $opt=1$，接下来有一个整数 $id$，代表把首都修改为 $id$；

如果 $opt=2$，接下来有三个整数 $x\ y\ v$，代表将 $x\ y$ 路径上的所有城市的防御值修改为 $v$；

如果 $opt=3$，接下来有一个整数 $id$，代表询问以城市 $id$ 为根的子树中的最小防御值。
## 输出格式

对于每个 $opt=3$ 的操作，输出一行代表对应子树的最小点权值。
## 样例

### 样例输入 #1
```
3 7
1 2
1 3
1 2 3
1
3 1
2 1 1 6
3 1
2 2 2 5
3 1
2 3 3 4
3 1
```
### 样例输出 #1
```
1
2
3
4
```
## 提示

对于 $20\%$ 的数据，$n\le 1000,m\le 1000$。

对于另外 $10\%$ 的数据，$n\le 100000,m\le 100000$，保证修改为单点修改。

对于另外 $10\%$ 的数据，$n\le100000,m \le 100000$，保证树为一条链。

对于另外 $10\%$ 的数据，$n\le 100000,m\le100000$，没有修改首都的操作。

对于 $100\%$ 的数据，$1 \leq n\le 100000,1 \leq m \le 100000,0<val_i<2^{31}$。


---

---
title: "[SDOI2016] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P4069
tag: ['2016', '线段树', '各省省选', '山东', '最近公共祖先 LCA', '树链剖分']
---
# [SDOI2016] 游戏
## 题目描述

Alice 和 Bob 在玩一个游戏。

游戏在一棵有 $n$ 个点的树上进行。最初，每个点上都只有一个数字，那个数字是 $123456789123456789$。

有时，Alice 会选择一条从 $s$ 到 $t$ 的路径，在这条路径上的每一个点上都添加一个数字。对于路径上的一个点 $r$，若 $r$ 与 $s$ 的距离是 $dis$，那么 Alice 在点 $r$ 上添加的数字是 $a\times dis+b$。

有时，Bob 会选择一条从 $s$ 到 $t$ 的路径。他需要先从这条路径上选择一个点，再从那个点上选择一个数字。

Bob 选择的数字越小越好，但大量的数字让 Bob 眼花缭乱。Bob 需要你帮他找出他能够选择的最小的数字。

## 输入格式

第一行两个数字 $n,m$，表示树的点数和进行的操作数。

接下来 $n-1$ 行，每行三个数字 $u,v,w$，表示树上有一条连接 $u,v$ 的边，长度是 $w$。

接下来 $m$ 行。每行第一个数字是 $1$ 或 $2$。

若第一个数是 $1$，表示 Alice 进行操作，接下来四个数字 $s,t,a,b$。

若第一个数是 $2$，表示 Bob 进行操作，接下来两个数字 $s,t$。

## 输出格式

每当 Bob 进行操作，输出一行一个数，表示他能够选择的最小的数字

## 样例

### 样例输入 #1
```
3 5
1 2 10
2 3 20
2 1 3
1 2 3 5 6
2 2 3
1 2 3 -5 -6
2 2 3
```
### 样例输出 #1
```
123456789123456789
6
-106
```
## 提示

测试点 1 ~ 2：$ n \leq 10 $，$ m \leq 10 $，$ | a | \leq 10000 $；

测试点 3 ~ 4：$ n \leq 1000 $，$ m \leq 1000 $，$ | a | \leq 10000 $；

测试点 5：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 0 $，树是一条链；

测试点 6 ~ 7：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 0 $；

测试点 8：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 1 $，树是一条链；

测试点 9 ~ 10：$ n \leq 100000 $，$ m \leq 100000 $，$ a = 1 $；

测试点 11 ~ 13：$ n \leq 100000 $，$ m \leq 100000 $，$ | a | \leq 10000 $，树是一条链；

测试点 14 ~ 20：$ n \leq 100000 $，$ m \leq 100000 $，$ | a | \leq 10000 $。

对于所有数据，$0\le w, |b|\le 10^9$。


---

---
title: "[WC2013] 糖果公园"
layout: "post"
diff: 省选/NOI-
pid: P4074
tag: ['2013', '莫队', '最近公共祖先 LCA', '分块', 'WC']
---
# [WC2013] 糖果公园
## 题目描述

Candyland 有一座糖果公园，公园里不仅有美丽的风景、好玩的游乐项目，还有许多免费糖果的发放点，这引来了许多贪吃的小朋友来糖果公园游玩。

糖果公园的结构十分奇特，它由 $n$ 个游览点构成，每个游览点都有一个糖果发放处，我们可以依次将游览点编号为 $1$ 至 $n$。有 $n - 1$ 条双向道路连接着这些游览点，并且整个糖果公园都是连通的，即从任何一个游览点出发都可以通过这些道路到达公园里的所有其它游览点。

糖果公园所发放的糖果种类非常丰富，总共有 $m$ 种，它们的编号依次为 $1$ 至 $m$。每一个糖果发放处都只发放某种特定的糖果，我们用 $C_i$ 来表示 $i$ 号游览点的糖果。

来到公园里游玩的游客都不喜欢走回头路，他们总是从某个特定的游览点出发前往另一个特定的游览点，并游览途中的景点，这条路线一定是唯一的。他们经过每个游览点，都可以品尝到一颗对应种类的糖果。

大家对不同类型糖果的喜爱程度都不尽相同。 根据游客们的反馈打分，我们得到了糖果的美味指数， 第 $i$ 种糖果的美味指数为 $V_i$。另外，如果一位游客反复地品尝同一种类的糖果，他肯定会觉得有一些腻。根据量化统计，我们得到了游客第 $i$ 次品尝某类糖果的新奇指数 $W_i$。如果一位游客第 $i$ 次品尝第 $j$ 种糖果，那么他的愉悦指数 $H$ 将会增加对应的美味指数与新奇指数的乘积，即 $V_j \times W_i$。这位游客游览公园的愉悦指数最终将是这些乘积的和。

当然，公园中每个糖果发放点所发放的糖果种类不一定是一成不变的。有时，一些糖果点所发放的糖果种类可能会更改（也只会是 $m$ 种中的一种），这样的目的是能够让游客们总是感受到惊喜。

糖果公园的工作人员小 A 接到了一个任务，那就是根据公园最近的数据统计出每位游客游玩公园的愉悦指数。但数学不好的小 A 一看到密密麻麻的数字就觉得头晕，作为小 A 最好的朋友，你决定帮他一把。

## 输入格式

从文件 `park.in` 中读入数据。

第一行包含三个正整数 $n, m, q$， 分别表示游览点个数、 糖果种类数和操作次数。

第二行包含 $m$ 个正整数 $V_1, V_2, \ldots, V_m$。

第三行包含 $n$ 个正整数 $W_1, W_2, \ldots, W_n$。

第四行到第 $n + 2$ 行，每行包含两个正整数 $A_i, B_i$，表示这两个游览点之间有路径可以直接到达。

第 $n + 3$ 行包含 $n$ 个正整数 $C_1, C_2, \ldots, C_n$。

接下来 $q$ 行， 每行包含三个整数 $Type, x, y$，表示一次操作：

- 若 $Type$ 为 $0$，则 $1 \leq x \leq n$， $1 \leq y \leq m$，表示将编号为 $x$ 的游览点发放的糖果类型改为 $y$；
- 若 $Type$ 为 $1$，则 $1 \leq x, y \leq n$，表示对出发点为 $x$，终止点为 $y$ 的路线询问愉悦指数。

## 输出格式

输出到文件 `park.out` 中。

按照输入的先后顺序，对于每个 $Type$ 为 $1$ 的操作输出一行，用一个正整数表示答案。

## 样例

### 样例输入 #1
```
4 3 5
1 9 2
7 6 5 1
2 3
3 1
3 4
1 2 3 2
1 1 2
1 4 2
0 2 1
1 1 2
1 4 2
```
### 样例输出 #1
```
84
131
27
84
```
## 提示

【样例解释】

我们分别用

![](https://cdn.luogu.com.cn/upload/image_hosting/isw3ib3u.png)

代表 $C_i$ 为 $1$、 $2$、 $3$ 的节点，在修改之前：

![](https://cdn.luogu.com.cn/upload/image_hosting/ttkzii1u.png)

在将 $C_2$ 修改为 $1$ 之后：

![](https://cdn.luogu.com.cn/upload/image_hosting/izro364w.png)

【数据规模与约定】

对于所有的数据： $1 \leq V_i, W_i \leq 10^6$，$1 \leq A_i, B_i \leq n$， $1 \leq C_i \leq m$， $W_1, W_2, \ldots, W_n$ 是非递增序列，即对任意 $1 < i \leq n$， 满足 $W_i \le W_{i-1}$。

其它的限制条件如下表所示：

![QQ20180113072014.png](https://cdn.luogu.com.cn/upload/image_hosting/g6884nx1.png)



---

---
title: "[WC2006] 水管局长"
layout: "post"
diff: 省选/NOI-
pid: P4172
tag: ['图论', '2006', '平衡树', 'O2优化', '生成树', '最近公共祖先 LCA', '动态树 LCT', 'WC']
---
# [WC2006] 水管局长
## 题目背景

SC 省 MY 市有着庞大的地下水管网络，嘟嘟是 MY 市的水管局长（就是管水管的啦）。
## 题目描述

每天供水公司可能要将一定量的水从 $u$ 处送往 $v$ 处，嘟嘟需要为供水公司找到一条从 $u$ 至 $v$ 的水管的路径，接着通过信息化的控制中心通知路径上的水管进入准备送水状态，等到路径上每一条水管都准备好了，供水公司就可以开始送水了。嘟嘟一次只能处理一项送水任务，等到当前的送水任务完成了，才能处理下一项。

在处理每项送水任务之前，路径上的水管都要进行一系列的准备操作，如清洗、消毒等等。嘟嘟在控制中心一声令下，这些水管的准备操作同时开始，但由于各条管道的长度、内径不同，进行准备操作需要的时间可能不同。

供水公司总是希望嘟嘟能找到这样一条送水路径，路径上的所有管道全都准备就绪所需要的时间尽量短。嘟嘟希望你能帮助他完成这样的一个选择路径的系统，以满足供水公司的要求。另外，由于 MY 市的水管年代久远，一些水管会不时出现故障导致不能使用，你的程序必须考虑到这一点。

不妨将 MY 市的水管网络看作一幅简单无向图（即没有自环或重边）：水管是图中的边，水管的连接处为图中的结点。整张图共有 $n$ 个节点和 $m$ 条边，节点从 $1$ 至 $n$ 编号。

## 输入格式

第一行有三个整数，分别表示管道连接处（结点）的数目 $n$，目前水管（无向边）的数目 $m$，以及你的程序需要处理的任务数目（包括寻找一条满足要求的路径和接受某条水管坏掉的事实）$q$。

以下 $m$ 行，每行三个整数 $u, v, t$，表示存在一条连接 $(u, v)$ 的水管，准备时间为 $t$。

以下 $q$ 行，每行三个整数 $k, u, v$，描述一项任务。其中 $k$ 表示任务类型：

- 若 $k = 1$，则表示你需要为供水公司寻找一条满足要求的从 $u$ 到 $v$ 的水管路径，满足准备时间最短；
- 若 $k = 2$，则表示直接连接 $u$ 和 $v$ 的水管宣布报废。

## 输出格式

对于每个 $k = 1$ 的任务，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 4 3
1 2 2
2 3 3
3 4 2
1 4 2
1 1 4
2 1 4
1 1 4

```
### 样例输出 #1
```
2
3
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 10^3$，$1 \leq m, q \leq 10^5$。
- $1 \leq k \leq 2$，$1 \leq u, v \leq n$，$1 \leq t \leq 10^9$。
- 给出的图无重边无自环，保证在宣布一条水管报废之前，该水管一定存在于图上且没有报废，
- 宣布报废的水管不超过 $5 \times 10^3$ 条，且在任意时刻，图一定是联通的。





---

---
title: "[LNOI2014] LCA"
layout: "post"
diff: 省选/NOI-
pid: P4211
tag: ['2014', '线段树', '各省省选', '辽宁', '最近公共祖先 LCA', '树链剖分', '差分', '离线处理']
---
# [LNOI2014] LCA
## 题目描述

给出一个 $n$ 个节点的有根树（编号为 $0$ 到 $n-1$，根节点为 $0$）。

一个点的深度定义为这个节点到根的距离 $+1$。 

设 $dep[i]$ 表示点 $i$ 的深度，$\operatorname{LCA}(i, j)$ 表示 $i$ 与 $j$ 的最近公共祖先。 

有 $m$ 次询问，每次询问给出 $l, r, z$，求 $\sum_{i=l}^r dep[\operatorname{LCA}(i,z)]$ 。
## 输入格式

第一行 $2$ 个整数，$n, m$。

接下来 $n-1$ 行，分别表示点 $1$ 到点 $n-1$ 的父节点编号。

接下来 $m$ 行，每行 $3$ 个整数，$l, r, z$。
## 输出格式

输出 $m$ 行，每行表示一个询问的答案。每个答案对 $201314$ 取模输出。
## 样例

### 样例输入 #1
```
5 2
0
0
1
1
1 4 3
1 4 2
```
### 样例输出 #1
```
8
5
```
## 提示

### 数据范围及约定

- 对于 $20\%$ 的数据，$n\le 10000,m\le 10000$；
- 对于 $40\%$ 的数据，$n\le 20000,m\le 20000$；
- 对于 $60\%$ 的数据，$n\le 30000,m\le 30000$；
- 对于 $80\%$ 的数据，$n\le 40000,m\le 40000$；
- 对于 $100\%$ 的数据，$1\le n\le 50000,1\le m\le 50000$。


---

---
title: "[USACO18FEB] New Barns P"
layout: "post"
diff: 省选/NOI-
pid: P4271
tag: ['2018', 'USACO', '并查集', '连通块', '最近公共祖先 LCA', '树的直径', '动态树 LCT']
---
# [USACO18FEB] New Barns P
## 题目描述

给你一棵树，初始没有节点。你需要支持两种操作：  

- `B p` 表示新建一个节点，将它与 $p$  节点连接；若 $p=-1$，则表示不与其它节点相连  

- `Q k` 表示查询在 $k$ 节点所在的连通块中，距它最远的点的距离。这里距离的定义是两点间经过的边数。
## 输入格式

第一行一个正整数 $q$，表示操作个数。  
接下来 $q$ 行，每行表示一个操作。
## 输出格式

对于每个询问操作，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
7
B -1
Q 1
B 1
B 2
Q 3
B 2
Q 2
```
### 样例输出 #1
```
0
2
1

```
## 提示

【数据范围】  

对于 $100%$ 的数据，$1 \le q \le 10^5$。  
保证操作合法。

The example input corresponds to this network of barns:
```
  (1) 
    \   
     (2)---(4)
    /
  (3)
```
In query 1, we build barn number 1. In query 2, we ask for the distance of 1 to the farthest connected barn. Since barn 1 is connected to no other barns, the answer is 0. In query 3, we build barn number 2 and connect it to barn 1. In query 4, we build barn number 3 and connect it to barn 2. In query 5, we ask for the distance of 3 to the farthest connected barn. In this case, the farthest is barn 1, which is 2 units away. In query 6, we build barn number 4 and connect it to barn 2. In query 7, we ask for the distance of 2 to the farthest connected barn. All three barns 1, 3, 4 are the same distance away, which is 1, so this is our answer.

Problem credits: Anson Hu


---

---
title: "[IOI 2007] training 训练路径 "
layout: "post"
diff: 省选/NOI-
pid: P4649
tag: ['动态规划 DP', '2007', 'IOI', '仙人掌', '最近公共祖先 LCA']
---
# [IOI 2007] training 训练路径 
## 题目描述

马克(Mirko)和斯拉夫克(Slavko)正在为克罗地亚举办的每年一次的双人骑车马拉松赛而紧张训练。他们需要选择一条训练路径。

他们国家有$N$个城市和$M$条道路。每条道路连接两个城市。这些道路中恰好有$N-1$条是铺设好的道路，其余道路是未经铺设的土路。幸运的是，每两个城市之间都存在一条由铺设好的道路组成的通路。换句话说，这$N$个城市和$N-1$条铺设好的道路构成一个树状结构。

此外，每个城市最多是$10$条道路的端点。

一条训练路径由某个城市开始，途经一些道路后在原来起始的城市结束。因为马克和斯拉夫克喜欢去看新城市，所以他们制定了一条规则：绝不中途穿越已经去过的城市，并且绝不在相同的道路上骑行两次（不管方向是否相同）。训练路径可以从任何一个城市开始，并且不需要访问所有城市。

显然，坐在后座的骑行者更为轻松，因为坐在前面的可以为他挡风。为此，马克和斯拉夫克在每个城市都要调换位置。为了保证他们的训练强度相同，他们要选择一条具有偶数条道路的路径。

马克和斯拉夫克的竞争者决定在某些未经铺设的土路上设置路障，使得他们两人不可能找到满足上述要求的训练路径。已知在每条土路上设置路障都有一个费用值（一个正整数），并且竞争者不能在铺设好的道路上设置路障。

给定城市和道路网的描述，写一个程序计算出为了使得满足上述要求的训练路径不存在，而需要的设置路障的最小总费用。
## 输入格式

输入的第一行包含两个整数$N$和$M$，（$2\leq N\leq 1000$，$N-1\leq M\leq5000$），分别表示城市和道路的个数。 接下来的$M$行每行包含$3$个整数$A, B$和$C$（$1\leq A\leq N, 1\leq B\leq N, 0\leq C\leq10 000$）, 用来描述一条道路。$A$和$B$是不同的整数，表示由这条道路直接相连的两个城市。对于铺设好的道路$C$是$0$；对于土路，$C$是在该条路上设置路障所需的费用值。 每个城市最多是$10$条道路的端点。任意两个城市都不会有多于一条直接相连的道路。 
## 输出格式

输出包含一个整数，表示求出的最小总费用。
## 样例

### 样例输入 #1
```
5 8 
2 1 0 
3 2 0 
4 3 0 
5 4 0 
1 3 2 
3 5 2 
2 4 5 
2 5 1 
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
9 14 
1 2 0 
1 3 0 
2 3 14 
2 6 15 
3 4 0 
3 5 0 
3 6 12 
3 7 13 
4 6 10 
5 6 0 
5 7 0 
5 8 0 
6 9 11 
8 9 0 
```
### 样例输出 #2
```
48
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/20676.png )

第一个样例中道路与城市的布置。已被铺设好的道路以粗边显示。

![](https://cdn.luogu.com.cn/upload/pic/20677.png )

共有5种可能的路线。如果边1-3、3-5和2-5被封锁，则两人将会不能使用5种路线的任何一种。封锁这三条边的代价是5。

只封锁两条边，像是2-4和2-5，也是可以的，但这样会导致较高的代价，6。

在前30分的测试数据中，铺设好的道路会形成一条链。


---

---
title: "[CCC 2017] 最小费用流"
layout: "post"
diff: 省选/NOI-
pid: P4806
tag: ['2017', 'CCC（加拿大）', '生成树', '最近公共祖先 LCA']
---
# [CCC 2017] 最小费用流
## 题目描述

 **译自 [CCC2017](https://cemc.math.uwaterloo.ca/contests/computing/2017/index.html) Senior T4「[Minimum Cost Flow](https://cemc.math.uwaterloo.ca/contests/computing/2017/stage%201/seniorEF.pdf)」**

Watermoo 中有编号为 $1,2,\dots,N$ 的建筑物。其中还有 $M$ 条管道将建筑物两两连接。由于城市规划的疏漏，$1$ 号建筑是全市唯一的污水处理厂。每条管道可能是*活动的*或是*非活动的*。如果建筑 $1$ 通过活动管道直接或是间接地与其他每个建筑连通，则称活动管道集是一个有效的方案。（每条管道将两个建筑直接连接。如果建筑 $X$ 直接或间接连接建筑 $Y$，且建筑 $Y$ 直接或间接连接建筑 $Z$，那么我们说 $X$ 和 $Z$ 间接连接。）

Watermoo 的市政府正在使用一个 $N-1$ 条管道组成的显然有效的方案，但是这使得政府已经透支很多经费了！每条管道都有各自的月维修费，这是在其活动时必须支付的，一个有效方案的总成本为所有有效管道的维修费的总和。（非活动的管道不花费一分钱。）

此外，一个好消息是：Watermoo 大学的研究人员开发出了一种不完善的管道推进器，你可以在一条管道上使用它。它将从 $C$ 到 $\mathrm{max}(0,C-D)$ 降低该管道的维修成本，$D$ 为该推进器的强度。

市政府希望将成本降到最低，同时也希望你能尽快完成这个任务。每天，城市会允许你激活一条管道并关闭另一条管道。问：你需要多少天才能使一组活动管道形成一个有效方案并使其在所有有效方案和推进方案中费用最小？

请注意，在你规划的过程中方案可能会无效，但是到最后，他应该是一个有效的方案。
## 输入格式

第一行，三个整数 $N,M$ 和 $D(1 \le N \le 100\ 000,N - 1 \le M \le 200\ 000,0 \le D \le 10^9)$。

接下来 $M$ 行，每行三个整数 $A_i,B_i$ 和 $C_i$，表示有一条月维修成本为 $C_i$ 的管道从建筑 $A_i$ 连接到建筑 $B_i(1 \le A_i,B_i \le N,1 \le C_i \le 10^9)$。

前 $N-1$ 行表示 Watermoo 正在使用的有效方案。

保证数据没有重边和自环。
## 输出格式

输出一行，一个整数，表示完成任务的最小天数。如果初始方案即最优方案，输出`0`。
## 样例

### 样例输入 #1
```
4 4 0
1 2 1
2 3 2
3 4 1
4 1 1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5 6 2
1 2 5
2 3 5
1 4 5
4 5 5
1 3 1
1 5 1
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
4 4 0
1 2 715827882
2 3 715827882
3 4 715827882
4 1 715827884
```
### 样例输出 #3
```
0
```
## 提示

#### 样例解释 1
因为 $D=0$，所以管道推进器一无是处。

第一天，你应当关闭建筑 $2$ 到 $3$ 的管道并激活建筑 $4$ 到 $1$ 的管道。

#### 样例解释 2
一个可行的解为：首先在连接建筑 $1,2$ 的管道上安装推进器，使成本降低到 $3$。第一天，以连接 $1,3$ 的管道替换连接 $2,3$ 的管道。第二天，以连接 $1,5$ 的管道替换连接 $1,4$ 的管道。

此外，在连接 $1,3$ 或连接 $1,5$ 的管道上安装推进器毫无意义。这样做将会使得该管道的维修成本为 $0$，最优的费用为 $11$ （如你所见，我们已经找到了费用为 $10$ 的方案）。

#### 样例解释 3
初始的方案即最优方案。请注意整数上溢。

对于 $\frac3{15}$ 的数据，$N \le 8,M \le 28,D=0$。

对于另外 $\frac5{15}$ 的数据，$N \le 1\ 000,M \le 5\ 000,D=0$。

对于另外 $\frac3{15}$ 的数据，$D=0$。

对于另外 $\frac2{15}$ 的数据，$N \le 1\ 000,M \le 5\ 000$。


---

---
title: "[USACO19JAN] Exercise Route P"
layout: "post"
diff: 省选/NOI-
pid: P5203
tag: ['2019', 'USACO', '最近公共祖先 LCA', '容斥原理']
---
# [USACO19JAN] Exercise Route P
## 题目背景

USACO 19 年一月月赛铂金组第二题。
## 题目描述

奶牛 Bessie 意识到为了保持好的体形她需要更多地进行锻炼。她需要你帮助她选择在农场里每天用来晨跑的路线。 农场由 $n$ 块草地组成，方便起见编号为 $1\sim n$，由 $m$ 条双向的小路连接。作为一种遵循规律的生物，奶牛们倾向于使用其中特定的 $n−1$ 条小路作为她们日常在草地之间移动的路线——她们管这些叫“常规的”小路。从每块草地出发都可以仅通过常规的小路到达所有其他草地。

为了使她的晨跑更加有趣，Bessie 觉得她应该选择一条包含一些非常规的小路的路线。然而，使用常规的小路能够使她感到舒适，所以她不是很想在她的路线中使用过多非常规的小路。经过一些思考，她认为一条好的路线应当形成一个简单环（能够不经过任何草地超过一次的情况下回到起点），其中包含恰好两条非常规的小路。

请帮助 Bessie 计算她可以使用的好的路线的数量。两条路线被认为是相同的，如果它们包含的小路的集合相等。
## 输入格式

输入的第一行包含 $n$ 和 $m$。以下 $m$ 行每行包含两个整数 $a_i$ 和 $b_i$，描述了一条小路的两端。其中前 $(n−1)$ 条是常规的小路。
## 输出格式

输出一行一个整数表示 Bessie 可以选择的路线的总数。
## 样例

### 样例输入 #1
```
5 8
1 2
1 3
1 4
1 5
2 3
3 4
4 5
5 2
```
### 样例输出 #1
```
4
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq n \leq 2 \times 10^5$，$1 \leq m \leq 2 \times 10^5$，$m \geq n - 1$，$1 \leq a_i, b_i \leq n$。


---

---
title: "【XR-1】逛森林"
layout: "post"
diff: 省选/NOI-
pid: P5344
tag: ['倍增', '洛谷原创', 'O2优化', '最短路', '最近公共祖先 LCA', 'ST 表']
---
# 【XR-1】逛森林
## 题目背景

NaCly_Fish 和 PinkRabbit 是好朋友。

有一天她去森林里游玩，回去跟 PinkRabbit 说：“我发现好多棵会动的树耶！”

PinkRabbit 动了动一只兔耳朵：“这有什么好稀奇的，我用一只兔耳朵就能维护每棵树的形态。”

NaCly_Fish 不服：“不止这样，我还看到有一些传送门，能从一条树枝跳到另一条树枝上呢！”

PinkRabbit 动了动另一只兔耳朵：“这有什么好稀奇的，我用两只兔耳朵就能统计每个传送门的信息。”

![](https://cdn.luogu.com.cn/upload/pic/57782.png)

于是 NaCly_Fish 很郁闷，她向你求助，请帮帮她吧。

什么？你不愿意帮？

那她就不给你这题的分了。
## 题目描述

给你 $n$ 个节点的森林，初始没有边。

有 $m$ 个操作，分为两种：

$1\ u_1\ v_1\ u_2\ v_2\ w$：表示构建一个单向传送门，从 $u_1 \rightarrow v_1$ 简单路径上的所有节点，可以花费 $w$ 的代价，到达 $u_2 \rightarrow v_2$ 简单路径上的所有节点。若 $u_1$ 到 $v_1$ 或 $u_2$ 到 $v_2$ 不连通(由 $2$ 操作产生的边不连通)，则忽略此次操作。

$2\ u\ v\ w$：表示将 $u$ 和 $v$ 节点间连一条花费为 $w$ 的无向边，若 $u$ 和 $v$ 之间已连通(由 $2$ 操作产生的边连通)则忽略此次操作。

经过这 $m$ 次操作后，请你求出从 $s$ 节点出发，到每个节点的最小花费。
## 输入格式

第一行三个正整数 $n, m, s$，分别表示树的节点数、操作数、和起始节点。

接下来 $m$ 行，每行若干个正整数，表示一次操作。
## 输出格式

输出一行 $n$ 个整数，第 $i$ 个整数表示从 $s$ 节点出发，到 $i$ 节点的最小花费。特别地，若不能到达$i$节点，则输出 `-1`。
## 样例

### 样例输入 #1
```
9 11 5
2 2 1 2
2 3 1 5
2 4 2 10
2 5 3 9
2 6 5 3
2 7 6 6
2 8 7 2
2 9 4 2
1 1 1 4 9 2
1 8 5 1 6 1
1 3 6 9 6 1
```
### 样例输出 #1
```
1 1 1 1 0 1 7 9 1
```
## 提示

【样例说明】

这是样例中给出的树（严格来讲，这棵树也是一条链）：

![](https://cdn.luogu.com.cn/upload/image_hosting/g1kmzdbv.png)

有三个传送门，其中两个是这样的：

- 从 $1$ 号点可以花费 $2$ 的代价到达 $4 \rightarrow 9$ 简单路径上的所有节点（即 $4, 9$ 号点）。
- 从 $8 \rightarrow 5$ 简单路径上的所有节点（即 $8, 7, 6, 5$ 号点）可以花费 $1$ 的代价到达 $1 \rightarrow 6$ 简单路径上的所有节点（即 $1, 3, 5, 6$ 号点）。

容易看出从 $5$ 号节点出发，到达其它节点的最小花费分别为：$1, 1, 1, 1, 0, 1, 7, 9, 1$。

【数据规模与约定】

对于第 $1, 2$ 个测试点，$1 \le n \le 100$，$1 \le m \le 300$。

对于第 $3, 4$ 个测试点，$1 \le n \le 1000$，$1 \le m \le 3000$。

对于 $100\%$ 的数据，$1\le n \le 50000$，$1\le m \le 10^6$，$1\le u,v \le n$，$1\le w \le 100$。

对于第 $1$ ~ $10$ 个测试点，每个 $5$ 分。

对于第 $11, 12$ 个测试点，每个 $25$ 分。


---

---
title: "【AFOI-19】跳闸"
layout: "post"
diff: 省选/NOI-
pid: P5630
tag: ['图论', '生成树', '最近公共祖先 LCA']
---
# 【AFOI-19】跳闸
## 题目背景

面基完毕后已经是晚上了，IY 和 SY在机房划水写板子。

然后机房跳闸了。

然后他们核善的信息老师叫他们修闸。

IY 和 SY 迫于威胁不得不修闸。

于是有了下面这一幕。
## 题目描述

IY 和 SY 发现总闸的电路已经完全损坏了，于是他们不得不重新设置一个电路。

机房里有 $n$ 个电流传导节点，每个节点可以用电线连向其他节点。**相通的节点可以互相传递电流**。

由于预留空间的问题，导致有些节点是不能直接连接的。现在 IY 和 SY 知道有 $m$ 组节点可以直接连接，并且知道连接这一组节点需要的电线长度。

光有电流传导节点肯定不行。SY 掏出了她珍藏已久的电源发生器。电源发生器可以附着在结点上，给那个节点供电。但是电源发生器也有一些缺陷，**它只能附着在 $s$ 号节点上，且只有 $k$ 个接口，也就是说附着的节点只能连 $k$ 条电线**，而且由于联动原因，**只有发生器所有的接口都连上电线，发生器才会供电**。

**IY 和 SY 的目标是让所有节点都可以被供电**。他们需要电线，然而电线越长，其价格就以指数倍增长。**所以他们都想让最长的电线尽量短。**

SY 接下了铺设电线的任务，IY 则被分配去买电线，**他需要知道他总共要买多长的电线**。由于 SY 忙于铺设电路，**所以 IY 还要回答 SY 的每个询问：让 $u$ 结点和 $v$ 结点相通所需要的电线的总长度为多少**。但是 IY 太弱了，他根本不知道这些答案是多少。

请你帮助弱弱的 IY 回答这些问题。作为奖励，这道题他会给你满分哦。
## 输入格式

第一行四个数$n,m,k,s$，表示有$n$个节点，$m$组可以直接连接的节点，电源发生器有$k$个接口，电源发生器附着在 $s$ 节点上。

下面的 $m$ 行，每行三个数 $u,v,w$，表示 $u$ 和 $v$ 节点可以用电线直接相连，在这两个节点之间铺设电线，需要的电线长度为 $w$ 。

再下面一行有一个数 $q$，表示 SY 有 $q$ 个询问。

下面的 $q$ 行每行两个数 $u,v$，表示 SY 询问 IY ： 让$u$ 结点和 $v$ 结点相通需要多长的电线。
## 输出格式

第一行输出一个数，代表所有电线的总长度。

下面的 $q$ 行，每行一个数，表示对 SY 每个询问的回答。

**可能存在无解的情况，如果无解，则输出"can not fix it."**，然后什么都不要输出。
## 样例

### 样例输入 #1
```
5 7 1 1
1 3 1
2 1 5
4 2 3
2 5 4
5 1 2
3 5 7
4 1 6
2
3 5
1 4
```
### 样例输出 #1
```
15
7
15
```
## 提示

- **样例解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/irpqvatr.png)

如图，发生器附着在节点$1$上且只能连一条电线，其中红线表示连的电线，可以看出这样连是最优的。

- **数据范围**

对于$30\%$ 的数据：$n \le 10, m \le 30, q \le 10$

对于$50\%$ 的数据：$n \le 2000, m \le 20000, q \le 2000$

对于$100\%$ 的数据：$n \le 30000, m \le 500000, q \le 30000, 1 \le s \le n, 1 \le k \le 150$

对于$100\%$ 的数据：满足连接两组不同的节点所需电线长度不同（即边权全部不相等），保证运算过程中不会爆$int$

- **出题人的温馨提醒**

题目要满足最长的电线尽量短，在此基础上还要满足次长的电线尽量短，以此类推。

不保证没有重边，但是保证边数足够，不会选择重边。

保证没有自环，保证数据全随机。


---

---
title: "『MdOI R1』Treequery"
layout: "post"
diff: 省选/NOI-
pid: P6071
tag: ['最近公共祖先 LCA', '可持久化线段树']
---
# 『MdOI R1』Treequery
## 题目描述

给定一棵 $n$ 个点的无根树，边有边权。

令 $E(x,y)$ 表示树上 $x,y$ 之间的简单路径上的所有边的集合，特别地，当 $x=y$ 时，$E(x,y) = \varnothing$。

你需要 **实时** 回答 $q$ 个询问，每个询问给定 $p,l,r$，请你求出集合 $\bigcap_{i=l}^r E(p,i)$ 中所有边的边权和，即 $E(p, l\dots r)$ 的交所包含的边的边权和。

通俗的讲，你需要求出 $p$ 到 $[l,r]$ 内每一个点的简单路径的公共部分长度。


## 输入格式

第一行两个整数 $n,q$，表示树的结点数和询问数。

接下来 $n-1$ 行，每行三个整数 $x,y,w$，表示 $x$ 与 $y$ 之间有一条权值为 $w$ 的边。

接下来 $q$ 行，每行三个整数 $p_0,l_0,r_0$。第 $i$ 个询问的 $p,l,r$ 分别为 $p_0,l_0,r_0$ 异或上 $lastans$ 的值，其中 $lastans$ 是上次询问的答案，初始时为 $0$。
## 输出格式

对于每个询问，一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 4
3 1 2
1 5 1
2 3 3
3 4 4
2 3 5
2 1 7
0 7 7
5 5 2
```
### 样例输出 #1
```
3
2
6
0
```
### 样例输入 #2
```
10 10
2 1 9907
3 2 8329
4 2 8402
5 4 3636
6 4 8747
7 4 3080
8 6 780
9 6 5414
10 9 3545
2 10 10
26107 26106 26101
4 9 10
14171 14166 14169
8958 8949 8949
36008 36014 36013
11485 11485 11472
3 9 9
30888 30894 30895
8404 8404 8411

```
### 样例输出 #2
```
26108
0
14161
8959
36015
11482
0
30892
8402
0

```
## 提示

【样例 1 说明】

样例中的树如图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/g6l15zpv.png)

下面解释中的询问参数均为异或 $lastans$ 之后得到的真实值。

对于第一个询问，$p=2$，$l=3$，$r=5$，$\bigcap_{i=3}^5 E(2,i)$ 为边 $(2,3)$，长度为 $3$。

对于第二个询问，$p=1$，$l=2$，$r=4$，$\bigcap_{i=2}^4 E(1,i)$ 为边 $(1,3)$，长度为 $2$；

对于第三个询问，$p=2$，$l=5$，$r=5$，$\bigcap_{i=5}^5 E(2,i)$ 为边集 $\{(2,3),(3,1),(1,5)\}$，长度为 $6$；

对于第四个询问，$p=3$，$l=3$，$r=4$，$\bigcap_{i=3}^4 E(3,i)=\varnothing$，长度为 $0$。


---

【数据范围】

**本题采用捆绑测试。**

| 子任务编号 |   $n,q\leq$    | 特殊性质 | 分值 |
| :--------: | :------------: | :------: | :--: |
|     1      |     $10^5$     |  $l=r$   |  8   |
|     2      |     $10^5$     |  $p=1$   |  20  |
|     3      |     $10^3$     |    无    |  20  |
|     4      |     $10^5$     |    无    |  26  |
|     5      | $2\times 10^5$ |    无    |  26  |

对于 $100\%$ 的数据，$1\leq n,q\leq 2\times 10^5$，$1\leq x,y,p\leq n$，$1\leq l\leq r\leq n$，$1\leq w\leq 10^4$。


---

---
title: "Count on a tree II/【模板】树分块"
layout: "post"
diff: 省选/NOI-
pid: P6177
tag: ['倍增', '最近公共祖先 LCA', '树链剖分', '可持久化', '分块']
---
# Count on a tree II/【模板】树分块
## 题目背景

原 bzoj2589。
## 题目描述

给定一个 $n$ 个节点的树，每个节点上有一个整数，$i$ 号点的整数为 $val_i$。

有 $m$ 次询问，每次给出 $u',v$，您需要将其解密得到 $u,v$，并查询 $u$ 到 $v$ 的路径上有多少个不同的整数。

解密方式：$u=u' \operatorname{xor} lastans$。

$lastans$ 为上一次询问的答案，若无询问则为 $0$。
## 输入格式

第一行有两个整数 $n$ 和 $m$。

第二行有 $n$ 个整数。第 $i$ 个整数表示 $val_i$。

在接下来的 $n-1$ 行中，每行包含两个整数 $u,v$，描述一条边。

在接下来的 $m$ 行中，每行包含两个整数 $u',v$，描述一组询问。
## 输出格式

对于每个询问，一行一个整数表示答案。
## 样例

### 样例输入 #1
```
8 2
105 2 9 3 8 5 7 7 
1 2
1 3
1 4
3 5
3 6
3 7
4 8
2 5
3 8
```
### 样例输出 #1
```
4
4
```
## 提示

对于 $100\%$ 的数据，$1\le u,v\le n\le 4\times 10^4$，$1\le m\le 10^5$，$0\le u',val_i<2^{31}$。


---

---
title: "「EZEC-1」越狱"
layout: "post"
diff: 省选/NOI-
pid: P6436
tag: ['搜索', '图论', '二分', '最短路', 'Tarjan', '最近公共祖先 LCA']
---
# 「EZEC-1」越狱
## 题目背景

由于监狱长 PF 的疏忽，罪犯小 E 找到了机会越狱。

然而，不学无术的小 E 不懂得保密。PF 很快发现了他的计划，并对他展开了追捕。

因为小 E 自己造船，而狱长 PF 坐的是官方的船，所以在每条航道上的表现不一样，通过时间可能不同。具体见输入格式。

为了不饿肚子，小 E 准备买一个包来装食物。
## 题目描述

小 E 的逃跑路线可以被看作是在 $n$ 个岛屿上，这些岛屿由 $n-1$ 条航线两两相连。

每个岛上都有足够的补给。**假设他每在海上航行一天，就要花费一个单位的食物**。黑心老板规定，**能装 $k$ 单位的食物的背包将会卖 $k$ 万元**。

PF 可以命令在任意两个**通过时间不超过 $d$**，**并且岛 $v$ 到岛 $u$ 的航线上至少有 $q$ 个岛屿**（**不包括 $u$ 和 $v$**）的岛屿 $u$ 与 $v$ 之间建立一条双向航线，通过这条航线的时间为 $\left\lfloor \dfrac{time(u \to v)}{2}\right\rfloor$。由于经济问题，**他只能建造一条额外的航线**。

小 E 可以根据官方给出的航线（**包括新增的航线**）确认 PF 到每个岛上的**最短时间**。

PF 将会在 $t$ 时发现小 E 逃走并开始追击。

为了节省钱，同时逃脱 PF 的追捕，小 E 想请你帮他编一个程序，计算最小的 $k$，使得他能够顺利逃脱到至少 $l$ 个岛屿。

**补给不需要时间，中途抓住也算抓住，同时到达则不算。**

**在岛屿上进行补给不需要时间，可以无限进行补给，只要背包装得下。**

题意概括：

有两个人 $a$，$b$ 和一颗 $n$ 个节点组成的树，$a$ 比 $b$早出发 $t$ 秒。如果两个节点之间通过时间不超过 $d$ 则 $b$ 可以在这两点之间建一条通过时间为 $\left\lfloor \dfrac{time(u \to v)}{2}\right\rfloor$ 的线路，求一个方案使 $a$ 至少到 $l$ 个点的最短时间不比 $b$ 长，并在此基础下要求岛屿之间距离最大值尽量小。
## 输入格式

第一行五个整数，$n,t,d,l,q$，表示岛屿的数量，PF 发现的时间，建立航线要求的通过时间范围，至少要到达的岛屿数量，以及建立航线所要求的中间岛屿的数量。他们的出发点均为点 $1$ 。

接下来 $n-1$ 行，每行四个整数 $u,v,p_i,e_i$，表示岛屿 $u$ 和岛屿 $v$ 之间有一条道路。$p_i$ 表示小 E 走这条航线的时间，$e_i$ 表示 PF 走这条航线的时间。**航线为双向** 。
## 输出格式

若有解，输出共两行。

第一行一个整数 $k$，表示最小能够逃脱所需要的钱数（单位：万元）。

第二行一个整数 $r$，表示用 $k$ 万元买背包时的能跑到的岛屿数量（ $1$ 号岛也算在内）。

若无解，只需输出 "no solution" (引号不需要输出)。
## 样例

### 样例输入 #1
```
5 3 20 4 2
1 2 5 5
2 3 5 5
2 4 7 10
1 5 4 1
```
### 样例输出 #1
```
7
4
```
### 样例输入 #2
```
5 2 6 3 2
1 2 5 3
2 3 8 6
1 4 8 2
2 5 4 6
```
### 样例输出 #2
```
5
3
```
### 样例输入 #3
```
5 0 23 4 1
1 2 21 26
1 3 14 16
3 4 4 5
1 5 19 18
```
### 样例输出 #3
```
no solution
```
## 提示

【样例解释】

样例 $1$：

![](https://cdn.luogu.com.cn/upload/image_hosting/sc3vdm8k.png)

对于样例 $1$，最后能到的点为 $1,2,4,5$，最小花费为 $7$。由于狱长 PF 从点 $3\to 5$ 要经过点为 $5\to1\to2\to3$，满足中间的点数 $\ge q$，故狱长 PF 可以连边点 $3$ 和点 $5$。如果狱长 PF 选择连边 $5\to3$，那么到点 $3$ 的时间为 $3+1+ \left\lfloor \dfrac{1+5+5}{2}\right\rfloor = 9$。而小 E 到点 $3$ 的最短时间为 $5 + 5 = 10$，不满足条件，故无论 $k$ 的大小，点 $3$ 都是不可到达的。


------------

【数据范围】

| 测试点编号 | $n\le$ | $t\le$ | $p_i,e_i\le$ |    $d\le$    | 时间限制| 空间限制 |特点|
| :----------: | :----------: | :----------: | :----------: | :----------: |:-----: | :----------: |:----------: |
|$1$ | $10$ | $50$ | $50$ | $50$ |$1s$ | $128M$ |加边操作 不影响答案|
|$2$ | $16$ | $50$ | $50$ | $50$ |$1s$ | $128M$ |无|
| $3,4$ | $500$ | ${500}$ | ${500}$ |$500$ | $1s$ |  $128M$ |加边操作 不影响答案|
| $5$ | $500$ | ${500}$ | ${500}$ |${500}$ | $1s$ |  $128M$ |$q = 0$|
| $6,7$ | $500$ | ${500}$ | ${500}$ |${500}$ | $1s$ |  $128M$ |无|
| $8$ | $\small{2.5 \times 10^3}$ | $10^8$ | $10^8$ |$10^8$ | $1s$ | $128M$ |加边操作 不影响答案|
| $9,10$ | $\small{2.5 \times 10^3}$ | $10^8$ | $10^8$ |$10^8$ | $1s$ | $128M$ |$q = 0$|
| $11 \sim 14$ | $\small{2.5 \times 10^3}$ | $10^8$ | $10^8$ |$10^8$ | $1s$ | $128M$ |无|
| $15$ | $\small{2.5 \times 10^3}$ | $10^8$ | $10^8$ |$10^8$ | $1s$ | $256M$ |无|
| $16$ | $\small{7.5 \times 10^3}$ | $10^8$ | $10^8$ |$10^8$ |  $2s$ | $256M$ |无|
| $17$ | $\small{7.5 \times 10^3}$ | $10^8$ | $10^8$ |$10^8$ |  $1s$ | $256M$ |无|
| $18 \sim 20$ | $\small{7.5 \times 10^3}$ | $10^8$ | $10^8$ |$10^8$ |  $3s$ |$512M$ |无|

对于 $100 \%$ 的数据，$n\le 7.5\times 10^3$，$1\le l\le n$，$0\le t \le 10^8$，$0 \le u_i<v_i \le n$，$1\le p_i,e_i,d\le 10^8$，$0\le q\le 20$。

**保证可能新建立的双向航线方案数不超过 $5 \times 10^6$**。



---

---
title: "[COCI 2020/2021 #3] Specijacija"
layout: "post"
diff: 省选/NOI-
pid: P7172
tag: ['2020', '最近公共祖先 LCA', '可持久化线段树', 'COCI（克罗地亚）']
---
# [COCI 2020/2021 #3] Specijacija
## 题目描述

给定一个正整数 $n$ 个一个满足 $\frac{i(i-1)}{2} \lt a_i \le \frac{i(i+1)}{2}$ 的正整数序列 $a_1, a_2, \cdots, a_n$。

该序列是一棵包含 $\frac{(n+1)(n+2)}{2}$ 个节点的树参数化而来的，它包括 $n+1$ 层，每层分别包括 $1, 2, \cdots, n+1$ 个节点，如图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/bvug13ny.png)

它由 $a=(1,2,6)$ 参数化而来。

第 $i$ 层包含节点 $\frac{i(i-1)}{2}+1, \cdots, \frac{i(i+1)}{2}$。节点 $a_i$ 有两个孩子，而其他同层的节点都只有一个孩子。

请回答 $q$ 个询问，求 $x,y$ 的最大公共祖先，即既是 $x$ 的祖先，又是 $y$ 的祖先且权值最大的节点。
## 输入格式

第一行包含三个整数 $n,q,t$，分别表示参数的数量、询问次数和用来决定节点权值的参数。

第二行输入一个长度为 $n$ 的序列 $a$（其中对于每一个数 $a_i$ 有 $\frac{i(i-1)}{2} \lt a_i \le \frac{i(i+1)}{2}$）。

接下来的 $q$ 行中的第 $i$ 行包含两个整数 $\tilde x_i$ 和 $\tilde y_i$（$1 \le \tilde x_i, \tilde y_i \le \frac{(n+1)(n+2)}{2}$），用来决定询问时节点的权值。

设 $z_i$ 为第 $i$ 次询问的结果，规定 $z_0=0$。第 $i$ 次询问的权值为：

$$x_i=[(\tilde x_i-1+t \times z_{i-1}) \bmod \frac{(n+1)(n+2)}{2}]+1$$

$$x_i=[(\tilde y_i-1+t \times z_{i-1}) \bmod \frac{(n+1)(n+2)}{2}]+1$$

注：当参数 $t=0$ 时，满足 $x_i=\tilde x_i$，$y_i=\tilde y_i$。当 $t=1$ 时，权值应通过先前的答案来决定。
## 输出格式

输出共 $q$ 行，其中第 $i$ 行，输出 $x_i$ 和 $y_i$ 的最大公共祖先。
## 样例

### 样例输入 #1
```
3 5 0
1 2 6
7 10
8 5
6 2
9 10
2 3
```
### 样例输出 #1
```
1
5
1
6
1
```
### 样例输入 #2
```
3 5 1
1 2 6
7 10
8 5
6 2
9 10
2 3
```
### 样例输出 #2
```
1
6
2
1
1
```
## 提示

**【样例解释 #1 / #2】**

两个样例所表示的树的形状在题目描述的图中已经呈现。

第二个样例中各个节点的权值：

$x_1=7$，$y_1=10$；  
$x_2=9$，$y_2=6$；  
$x_3=2$，$y_3=8$；  
$x_4=1$，$y_4=2$；  
$x_5=3$，$y_5=4$。

**【数据范围】**

| Subtask | 分值 | 数据范围及约定 |
| :----------: | :----------: | :----------: |
| $1$ | $10$ | $q=1, t=0$ |
| $2$ | $10$ | $n \le 1000, t=0$ |
| $3$ | $30$ | $t=0$ |
| $4$ | $60$ | $t=1$ |

对于 $100\%$ 的数据，$1 \le n,q \le 2 \times 10^5$，$t \in \{0,1\}$。

**【说明】**

**本题分值按 COCI 原题设置，满分 $110$。**

**题目译自 [COCI2020-2021](https://hsin.hr/coci/) [CONTEST #4](https://hsin.hr/coci/contest3_tasks.pdf)  _T5 Specijacija_。**


---

---
title: "[CEOI 2011] Treasure Hunt"
layout: "post"
diff: 省选/NOI-
pid: P7543
tag: ['2011', '交互题', 'Special Judge', 'CEOI（中欧）', '最近公共祖先 LCA']
---
# [CEOI 2011] Treasure Hunt
## 题目描述

现在有一棵树，初始时只有一个根节点 $1$，你需要完成下列两种操作：

* `path u s` 表示在 $u$ 下面依次加入了 $s$ 个节点：其中的第 $i$ 个节点作为第 $i-1$ 个节点的孩子（$2\le i\le s$），特别地，第 $1$ 个节点会作为 $u$ 的孩子。设加入前时，树中节点的最大编号为 $n$，则新加入的 $s$ 个点会被依次编号为 $n+1,n+2,\cdots,n+s$；
* `dig u v` 表示询问 $u,v$ 的中点。形式化地，设 $u,v$ 间的距离为 $d$，则你需要求出 $u,v$的路径上，距离 $u$ 为 $\lfloor \frac d2\rfloor$ 的节点编号。
## 输入格式

本题是一道交互题，首先你需要从标准输入读入操作次数 $n$。  
接下来 $n$ 次，你会得到以下两种格式的指令之一：

* `P u s` 表示一次 `path u s` 的操作；
* `D u v` 表示一次 `dig u v` 的操作。

对于第一种操作，你不需要输出任何东西。对于第二种操作，你必须给出答案并清空缓冲区后，才可以读取后续操作。

在您输出一行后，请清空缓冲区：

- 在 C++ 中，使用 fflush(stdout) 或 cout.flush()。  
- 在 Pascal 中，使用 flush(output)。  
- 在 Python 中，使用 stdout.flush()。  
- 其它语言请自行查阅文档。
## 输出格式

对于每一次 `D u v` 的操作，输出一行表示答案，保证至少有一次这样的操作。
## 样例

### 样例输入 #1
```
11
P 1 2
D 1 3
P 2 5
D 7 3
D 3 7
P 1 2
P 3 3
D 10 11
P 5 1
D 14 8
D 2 4
```
### 样例输出 #1
```
2
5
4
1
6
2
```
## 提示

对于 $20\%$ 的数据，保证最终点的编号最大不超过 $5000$，且 $n\le 5000$；  
对于 $50\%$ 的数据，保证最终点的编号最大不超过 $400\ 000$；  
对于 $100\%$ 的数据，保证最终点的编号最大不超过 $10^9$，且 $n\le 400\ 000$。

#### 说明
题目译自 [CEOI 2011 day 1 T3 _Treasure Hunt_](http://ceoi.inf.elte.hu/probarch/11/trezad.pdf)。


---

---
title: "『GROI-R1』 古朴而优雅"
layout: "post"
diff: 省选/NOI-
pid: P8974
tag: ['数学', '图论', 'O2优化', '最近公共祖先 LCA', '基环树']
---
# 『GROI-R1』 古朴而优雅
## 题目背景


会馆内忽地安静了下来。

「敝姓言，名杉。」

他的声音沉稳而凝重，略带沙哑，却不失力度，极具穿透力。每个字都重重地打在耳畔，渗进头脑里，让人想不认真听都难。

「这所学院的院长。」
## 题目描述

杉虽然年事已高，但是还是保持与时俱进。他学习了深度优先遍历算法，觉得这种新潮的东西在一所古朴而优雅的学院里会很受欢迎。所以，他找到了在走廊里晃荡的寒，向他提出了一个问题：

「我们知道，对一棵树进行深度优先遍历可以用下面的伪代码很好地解决。」

$$
\begin{array}{l}
\text{DFS-TREE}(u)\\
\begin{array}{ll}
1 & p\gets p+1\\
2 & t_p\gets u\\
3 & vis_u\gets 1\\
4 & \textbf{for }\text{each edge }(u,v)\in E \\
5 & \qquad \textbf{if }vis_v=0\\
6 & \qquad \qquad \text{DFS-TREE}(v)\\
7 & p\gets p+1\\
8 & t_p\gets u\\
\end{array}
\end{array}
$$

起初，所有变量或数组的值均为 $0$。

「我们把调用 $\text{DFS-TREE}(1)$ 在遍历过程中得到的数组 $t$ 称为这棵树的**遍历顺序**。」

「你看这段代码的第 $4$ 行，这句话**遍历每一条边的顺序是不固定的**。」

寒素来最讨厌不确定的东西，可是碍于院长的颜面，还是继续听下去。

「你能数出这段代码**会生成多少种不同的遍历顺序**吗？」

寒发现他曾经做过这个题，很快地报出了解法。本以为就结束了，可是杉继续说：

「如果我**在树上增加一条边**，你还会做吗？」

寒发现他的那点水平完全不够了，于是他去请教玘。玘却认为这道题目依然很简单，他告诉了寒这道题的做法。可是寒找不到杉了。

这个世界到底怎么了呢？
## 输入格式

第一行，两个整数 $n$ 和 $q$，表示树上有 $n$ 个结点，编号为 $1\sim n$，有 $q$ 次询问。

接下来 $n-1$ 行，每行两个整数 $u,v$，描述这棵树上的一条边。

接下来 $q$ 行，每行两个整数 $x,y$，表示在树上添加连接 $x$ 和 $y$ 的一条边，询问有多少种可能的遍历顺序。注意：每次询问是**互相独立的**，也就是说，上一次询问添加的边不会保留到下一次询问。
## 输出格式

共 $q$ 行，每行一个整数表示这次询问的答案对 $10^9+7$ 取模后得到的值。
## 样例

### 样例输入 #1
```
4 2
1 2
1 3
1 4
2 3
1 4
```
### 样例输出 #1
```
4
6
```
## 提示

**样例解释**

对于第一次询问可以得到如图：

![](https://cdn.luogu.com.cn/upload/image_hosting/ojeiswc8.png)

能得到的遍历顺序有：

- $\{1,2,3,3,2,4,4,1\}$
- $\{1,4,4,2,3,3,2,1\}$
- $\{1,3,2,2,3,4,4,1\}$
- $\{1,4,4,3,2,2,3,1\}$

对于第二次询问可以得到如图：

![](https://cdn.luogu.com.cn/upload/image_hosting/6dut5s4r.png)

能得到的遍历顺序有：

- $\{1,2,2,3,3,4,4,1\}$
- $\{1,2,2,4,4,3,3,1\}$
- $\{1,3,3,2,2,4,4,1\}$
- $\{1,3,3,4,4,2,2,1\}$
- $\{1,4,4,2,2,3,3,1\}$
- $\{1,4,4,3,3,2,2,1\}$

**数据范围**

**本题采用捆绑测试。**

| 测试点编号 | 数据范围 | 特殊性质 | 分值 |
| :-----------: | :-----------: | :-----------: | :-----------: |
| $\text{Subtask1}$ | $n,q\le8$ |  | $5$ |
| $\text{Subtask2}$ | $n,q\le20$ |  | $10$ |
| $\text{Subtask3}$ | $n,q\le500$ |  | $10$ |
| $\text{Subtask4}$ | $n,q\le3000$ |  | $15$ |
| $\text{Subtask5}$ | $n,q\le2\times10^5$ | $\text{A}$ | $15$ |
| $\text{Subtask6}$ | $n,q\le2\times10^5$ | $\text{B}$ | $10$ |
| $\text{Subtask7}$ | $n,q\le2\times10^5$ |  | $35$ |

特殊性质 $\text{A}$：保证每一次询问的边 $(x,y)\in E$。

特殊性质 $\text{B}$：保证树退化成一条链。

对于 $100\%$ 的数据保证 $1\le n,q\le2\times10^5$，$1\le u,v,x,y\le n$，$x\ne y$。


---

---
title: "『GROI-R2』 Beside You"
layout: "post"
diff: 省选/NOI-
pid: P9655
tag: ['并查集', '树上启发式合并', '洛谷原创', 'O2优化', '树形 DP', '最近公共祖先 LCA', '树论', '虚树', '洛谷月赛']
---
# 『GROI-R2』 Beside You
## 题目背景

記憶の森

始まりの謎 いつか

この未知の果てに告げ知らせて

——江口孝宏《Beside You》
## 题目描述

我相信所有读过这一段剧情的人都不想让别人也经历一样的痛苦，但是坦尼尔还是只能消失，对吗？

坦尼尔最后留下了一棵以 $1$ 为根的有根树，在树的每个结点上，都有一个记忆碎片。有的碎片表示着一个世界记忆的开始，而另外的碎片表示着一个世界记忆的终结。

这时，树上飞来了一只蝴蝶~~モリモリあつし~~。蝴蝶在树上飞舞的过程中，经过了一些结点。爱丽丝能确定蝴蝶经过的结点个数至少有 $2$ 个，但是她忘记了具体的点数。

爱丽丝发现，蝴蝶经过的所有点都是互相连通的。当她把目光朝向每一条经过点数大于 $1$ 的从连通块**深度最小的结点**通往**连通块的任意一个叶子结点**（一个点是连通块的叶子结点，当且仅当它在树上没有子结点，或者它在树上的任意子结点均不在该连通块内）的简单路径时，她发现这些路径上的记忆都是完整的。爱丽丝认为一条路径上的记忆是完整的，当且仅当这条路径上既没有出现一个世界的记忆**没开始就结束**（路径中途在没有未结束的记忆的时候，出现了表示记忆终结的碎片）的情况，也没有出现一个世界的记忆**开始之后没有终结**（路径结束之后还有没结束的记忆）的情况。

可惜她已经遗忘了蝴蝶经过了哪些点，所以你需要告诉她蝴蝶**最多**可能经过多少点。

**形式化题面**

给定一棵以 $1$ 为根的 $n$ 个节点的树 $T=(V,E)$，每个节点上的点权 $c_i$ 为一个**左括号或一个右括号**，节点编号为 $1\sim n$。

我们定义点集 $V'\subseteq V$ 合法，当且仅当 $|V'|>1$（**即 $V'$ 的大小大于 $1$**） 且 $\forall u,v \in V'$，从 $u$ 到 $v$ 的简单路径只经过 $V'$ 中的点。

同时我们定义 $E'\subseteq E$ 为能使得 $\forall u,v \in V'$，从 $u$ 到 $v$ 的简单路径，只经过 $E'$ 中的边的大小最小的边集。

定义一个合法点集 $V'$ 的根为 $V'$ 中深度最小的结点。

定义 $u$ 为合法点集 $V'$ 的叶子节点，当且仅当 $u$ 不是 $V'$ 的根，且满足 $v \in V', (u,v) \in E'$ 的 $v$ 的数量为 $1$。

求一个合法点集 $S$，**满足其根节点到其任意一个叶子的路径上，每个点的点权顺次相接为一个合法的括号序列**，并**最大化** $|S|$。

我们通过如下规则定义一个合法的括号序列：

- 空串（即长度为 $0$ 的串）是一个合法的括号序列。

- 若串 $\text{A,B}$ 都是合法的括号序列，则字符串 $\text{AB}$ （即将字符串 $\text{A}$ 与 $\text{B}$ 按顺序拼接起来）也是合法的括号序列。

- 若串 $\text{A}$ 是合法的括号序列，则字符串 $\text{(A)}$ 是一个合法的括号序列。

你需要输出符合要求的最大 $|S|$。
## 输入格式

第一行输入一个正整数 $n$ 表示树上结点个数。

第二行输入一个长度为 $n$ 的字符串 $c$。$c_i$ 为 ``(`` 表示这个结点上有一个标志着记忆开始的碎片，$c_i$ 为 ``)`` 表示这个结点上有一个标志着记忆终结的碎片。

接下来 $n-1$ 行，每行输入两个正整数 $u,v$，表示结点 $u,v$ 之间有一条边。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3
())
1 2
1 3
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
8
()))())(
1 2
1 3
3 4
3 5
3 6
5 7
2 8
```
### 样例输出 #2
```
5
```
## 提示

**样例解释**

![](https://s1.ax1x.com/2023/08/07/pPEj56K.png)

蝴蝶经过的最大合法点集 $S$ 为 $\{1,2,3\}$。

![](https://s1.ax1x.com/2023/08/07/pPEv90g.png)

蝴蝶经过的最大合法点集 $S$ 为 $\{1,2,3,5,7\}$。

**数据范围**

**本题采用捆绑测试**。

| $\text{Subtask}$ | $n\le$ | 特殊性质 | 分值 |
| :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $20$ |  | $5$ |
| $2$ | $3000$ |  | $20$ |
| $3$ | $5\times10^5$ | $\text{A}$ | $15$  |
| $4$ | $5\times10^5$ | $\text{B}$ |  $10$ |
| $5$ | $2\times10^5$ |  | $15$ |
| $6$ | $5\times10^5$ |  | $35$ |

特殊性质 $\text{A}$：保证树退化成一条链（不保证 $1$ 号节点为其一个端点）。

特殊性质 $\text{B}$：保证原树上任意结点到叶子的路径上右括号数量不少于左括号数量。

对于 $100\%$ 的数据满足 $1\le n\le 5\times 10^5$，$1\le u,v \le n$，$c_i$ 为 ``(`` 或 ``)``。


---

---
title: "[ICPC 2020 Shanghai R] Traveling Merchant"
layout: "post"
diff: 省选/NOI-
pid: P9829
tag: ['2020', '上海', 'O2优化', '双连通分量', '最近公共祖先 LCA', 'ICPC']
---
# [ICPC 2020 Shanghai R] Traveling Merchant
## 题目描述

Mr. Lawrence is a traveling merchant who travels between cities and resells products. Basically, to earn from it, he needs to buy products at a very low price and sell them at a higher price. Your task is to tell him whether there exists an endless traveling path that can earn money all the time.

To make things simple, suppose there are $n$ cities named from $0$ to $n-1$ and $m$ undirected roads each of which connecting two cities. Mr. Lawrence can travel between cities along the roads. Initially he is located at city $0$ and each of the city $i$ has a starting price $c_i$, either $\text{Low}$ or $\text{High}$. Due to the law of markets, the price status at city $i$ will change (i.e. $\text{High}$ price will become $\text{Low}$ price, or vice versa) after he departs for a neighboring city $j$ from $i$. (City $j$ is a neighboring city of city $i$ when one of the $m$ roads connects city $i$ and city $j$.) For some reasons (e.g. product freshness, traveling fee, tax), he $\textbf{must}$:

- Start at city $0$ and buy products at city $0$. It is guaranteed that $c_0$ is $\text{Low}$.
- When he arrives some city, he either sells products or buys products. It is not allowed for him to do nothing before he leaves the city.
- After buying products at some city $i$, he must travel to some neighboring city $j$ whose price $c_j$ is $\text{High}$ and sell the products at city $j$.
- After selling products at some city $i$, he must travel to some neighboring city $j$ whose price $c_j$ is $\text{Low}$ and buy the products at city $j$.

As a result, the path will look like an alternation between ``buy at low price'' and ``sell at high price''.

An endless earning path is defined as a path consisting of an endless sequence of cities $p_0, p_1,\dots$ where city $p_i$ and city $p_{i+1}$ has a road, $p_0=0$, and the price alternates, in other words $c_{p_{2k}}=\text{Low}$ (indicates a buy-in) and $c_{p_{2k+1}}=\text{High}$ (indicates a sell-out) for $k\geq0$. Please note here $c_{p_i}$ is the price when $\textbf{arriving}$ city $p_i$ and this value may be different when he arrives the second time.

Your task is to determine whether there exists any such path.
## 输入格式

There are several test cases. The first line contains a positive integer $T$ indicating the number of test cases. Each test case begins with two positive integers $n$ and $m$ indicating the number of cities and the number of roads. 

The next line is a string $c$ of length $n$ containing `H' or `L'. The $i$-th ($0\le i<n$) charactor of $c$ is $H$ if the starting price $c_i$ at city $i$ is $\text{High}$. The $i$-th ($0\le i<n$) charactor of $c$ is $L$ if the starting price $c_i$ at city $i$ is $\text{Low}$. 

The $i$-th line ($1\le i\le m$) of the following $m$ lines contains two different cities $u_i$ and $v_i$, indicating a road between $u_i$ and $v_i$.

The sum of the values of $n$ over all test cases is no more than $200,000$. The sum of the values of $m$ over all test cases is no more than $200,000$. For each test case, $c_i\in\{\text{H},\text{L}\}$ holds for each $i\in \{0, \ldots, n-1\}$. $c_0$ is always $L$. $0\leq u_i,v_i<n$ and $u_i\neq v_i$ hold for each $i\in \{1,\ldots, m\}$. No two roads connect the same pair of cities.
## 输出格式

For each test case, output a line of ``yes`` or ``no``, indicating whether there exists an endless earning path.
## 样例

### 样例输入 #1
```
2
4 4
LHLH
0 1
1 2
1 3
2 3
3 3
LHH
0 1
0 2
1 2
```
### 样例输出 #1
```
yes
no
```
## 提示

In the first sample test case, the endless earning path is $0\rightarrow 1\rightarrow 2\rightarrow 3\rightarrow 1\rightarrow 2\rightarrow 3\rightarrow \dots$. In the illustration, cities with $\text{Low}$ price are filled with stripe.

![](https://cdn.luogu.com.cn/upload/image_hosting/2ohq2wfi.png)

In the second sample test case, Mr. Lawrence can only make one move from city $0$ and after that all cities will have $\text{High}$ price. Thus, no further moves can be made.

![](https://cdn.luogu.com.cn/upload/image_hosting/fcv1tw87.png)

## 题目翻译

### 题目描述

劳伦斯先生是一位在不同城市转售商品的旅行商人。基本地，为了赚钱，他需要以低价买进商品，再以高价卖出。现在请你为他规划一条可以一直盈利的旅行路线。

简单地说，假设有 $n$ 座城市，标号为 $0$ 到 $n-1$ ，以及 $m$ 条连接特定两座城市的路，劳伦斯先生可以通过这些路到访每座城市。最初劳伦斯先生位于第 $0$ 座城市，并且对于城市 $i$ 都有一个起始价格 $c_i$ 。根据市场规律，当他从城市 $i$ 来到相邻的城市 $j$ 时（当且仅当城市 $i$ 与城市 $j$ 之间有路径相连时，才称 $i$ 与 $j$ 为相邻城市），城市 $i$ 的价格状况会发生变化（高价会变成低价，低价也可能变成高价）。而因为一些原因（比如商品的新鲜程度，旅行费用，税务等），他**必须**：

- 从城市 $0$ 出发并在城市 $0$ 购买一些商品。保证城市 $0$ 的起始价格很**低**。
- 每当他到达一座城市后，他**必须**售卖**或**购买一些商品。
- 若他在城市 $i$ 购买了商品，他就必须去一座与 $i$ 相邻且价格 $c_j$ **高于** $c_i$ 的城市 $j$ ，并在那里卖掉手中来自城市 $i$ 的商品。
- 若他在城市 $i$ 售卖了商品，他就必须去一座与 $i$ 相邻且价格 $c_j$ **低于** $c_i$ 的城市 $j$，并在那里购买一些商品。


因此，最终路径会始终重复 ``低价购入`` 和 ``高价卖出`` 。

一条无尽的盈利路线由无尽的城市序列 $p_0,p_1 \dots$ 组成。其中，城市 $p_i$ 与城市 $p_{p+1}$ 之间有路径相连，$p_0 = 0$，且价格高低是交替循环的，也就是说当 $k \ge 0$ 时，城市 $p_{2k}$ 的价格 $c_{p_{2k}} = \text{Low}$ (要在这个城市购买商品) 而相邻城市 $p_{2k+1}$ 的价格 $c_{p_{2k+1}} = \text{Hign}$ (要在这个城市卖出商品)。

**注意**：$c_{p_i}$ 是 **到达** 城市 $p_i$ 时的价格，而当他第二次到达城市 $p_i$ 时，这个价格可能会因为市场规律而变化。

你需要写一个程序，判断是否有这样一条永远盈利的路径存在。
### 输入格式

输入有多组数据。所有数据的第一行是一个整型 $T$ 表示数据组数。每组数据的第一行是两个整型 $n$ 和 $m$，表示城市的数量和道路的数量。

每组数据的第二行是一个长度为 $n$ ，由 $H$ 或 $L$ 组成的字符串 $c$ 。字符串 $c$ 的第 $i$ 个字符若为 $H$，则表示城市 $i$ 的起始价格 $c_i$ **高**，反之若为 $L$ 则表示城市 $i$ 的起始价格 $c_i$ **低**。

接下来 $m$ 行，每行输入一组 $u_i$ 和 $v_i$ ，表示一条连接城市 $u_i$ 和城市 $v_i$ 的双向路径。

所有数据中 $n$ 的总和不超过 $200,000$ ，$m$ 的总和也不超过 $200,000$ 。对于每组数据，$c_i\in\{\text{H}, \text{L}\}$ 对应每个 $i\in\{0, \dots, n-1\}$ ，保证 $c_0$ 总为 $L$ 。保证对于每个 $i\in\{1,\dots,m\}$ ，都有 $0 \leq u_i,v_i < n$ 且 $u_i \neq v_i$ 。保证每两座城市之间只有一条路径相连。

### 输出格式
对于每组数据，输出一行 ``yes`` 或者 ``no`` ，表示是否存在一条无尽的盈利路径。


---


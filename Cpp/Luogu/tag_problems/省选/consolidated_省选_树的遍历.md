---
title: "[COTS 2016] 搜索树 Jelka"
layout: "post"
diff: 省选/NOI-
pid: P11306
tag: ['2016', '线段树', '倍增', '树状数组', '树的遍历', '树链剖分', 'COCI（克罗地亚）']
---
# [COTS 2016] 搜索树 Jelka
## 题目背景

译自 [Izborne Pripreme 2016 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2016/) D2T1。$\texttt{1s,0.5G}$。

## 题目描述


给定一棵 $n$ 个点的二叉树，点有点权，其中 $1$ 号点为根节点。

$m$ 次操作修改某个点的点权。在每次修改后询问：这棵树上有多少个节点的子树（包含自身）是二叉搜索树（BST）？

我们给定 BST 的定义：

- 含有一个节点的树是 BST。
- 对于大于一个节点的树，它是 BST 当且仅当：
	- 根节点的左子树为空，或者左子树是二叉搜索树，且左子树内所有点的点权均**不大于**根节点的点权；
   - 根节点的右子树为空，或者右子树是二叉搜索树，且右子树内所有点的点权均**不小于**根节点的点权。


## 输入格式


第一行，两个正整数 $n,m$。

接下来 $n$ 行，每行两个整数 $l_i,r_i$，表示 $i$ 号点的左儿子和右儿子编号。
- 特别地，若不存在，则为 $0$。

接下来一行，$n$ 个整数 $a_1,\cdots,a_n$，表示每个点的点权。

接下来 $m$ 行，每行两个整数 $x,v$，表示一次操作 $a_x\gets v$。

## 输出格式

输出 $m$ 行 $m$ 个整数，表示答案。

## 样例

### 样例输入 #1
```
6 5
2 3
4 0
5 6
0 0
0 0
0 0
4 1 3 2 2 5
3 3
2 2
3 5
5 4
6 1
```
### 样例输出 #1
```
4
5
5
6
4
```
### 样例输入 #2
```
8 10
4 5
8 0
0 0
3 7
0 6
0 0
2 0
0 0
7 0 9 3 6 0 6 2
3 0
4 0
8 2
2 3
7 6
1 6
5 7
6 9
1 1
1 7
```
### 样例输出 #2
```
3
3
3
6
6
6
6
8
7
8
```
## 提示


#### 样例解释

样例 $1$ 解释如图所示。

其中节点内的数字表示 BST 权值，节点外的数字表示节点编号。

![](https://cdn.luogu.com.cn/upload/image_hosting/yabnaj75.png)

#### 数据范围

对于 $100\%$ 的数据，保证：
- $1\le n,m\le 2\times 10^5$；
- $0\le a_i,v\le 10^9$；
- 操作和树的形态均合法。


| 子任务编号 | $n,m\le  $ | 特殊性质 | 得分 |  
| :--: | :--: | :--: | :--: |
| $ 1 $    | $ 5\, 000$    |  | $ 16 $   |  
| $ 2 $    | $ 2\times 10^5 $   | A |  $ 24 $   |  
| $ 3 $    | $ 2\times 10^5$ | | $ 60 $   |  

特殊性质 A：$\forall 1\le i\le n$，$l_i=0\lor r_i=0$。




---

---
title: "[迷宫寻路 Round 3] 游戏"
layout: "post"
diff: 省选/NOI-
pid: P11627
tag: ['贪心', '线段树', '平衡树', '树状数组', 'O2优化', '树的遍历']
---
# [迷宫寻路 Round 3] 游戏
## 题目描述

小 L 正在玩游戏，游戏地图是一颗 $n$ 个节点的树，定义一条树上路径的长度为路径上所有边的边权之和，路径可以重复经过点和边。特别的，若路径不包含任何边，则其长度为 $0$。

小 L 会选择一个点作为必经点 $t$，接着，小 L 会设置每条边的边权，使得边的边权构成一个 $1$ 到 $n-1$ 的**排列**。

定义：小 L 的得分为 $\sum_{1 \leq u,v \leq n} \operatorname{dist}(u,v)$，其中 $\operatorname{dist}(u,v)$ 为在经过必经点 $t$ 的前提下，长度**最小的**从 $u$ 到 $v$ 的路径的长度。

小 L 希望最大化自己的得分，请你解答以下问题：

第一问：求他得分的**最大值**对 $998244353$ 取模的值。

第二问：求若要最大化他的得分，小 L 应该选择的必经点 $t$ 和小 L 每条边应设置的边权。

## 输入格式

一行一个整数 $n$，表示节点数。

接下来 $n-1$ 行，每行两个整数 $u,v$ 表示树上一条连接点 $u$ 和点 $v$ 的边。
## 输出格式

输出共三行。

第一行一个整数，表示【小 L 得分的最大值】对 $998244353$ 取模的值。

第二行一个整数，表示小 L 应该选择的必经点 $t$，如有多种 $t$ 符合题意，请输出最小的 $t$。

第三行 $n-1$ 个整数，**按边的输入顺序**依次给出小 L 每条边应设置的边权。如有多种答案，请输出边权的字典序最小的答案。

注意：在小 L 得分最大的前提下，请首先最小化 $t$，其次最小化边权的字典序。

这里“边权的字典序”是指按边的输入顺序将边的边权看作一个排列，这个排列的字典序。
## 样例

### 样例输入 #1
```
5
1 2
1 3
2 4
2 5
```
### 样例输出 #1
```
280
3
3 4 1 2
```
### 样例输入 #2
```
7
5 1
1 7
6 2
2 1
4 5
3 2
```
### 样例输出 #2
```
1106
4
5 1 2 4 6 3
```
### 样例输入 #3
```
10
3 6
7 3
8 10
5 9
9 1
4 8
1 8
2 3
6 10
```
### 样例输出 #3
```
5240
5
4 1 6 9 8 2 7 3 5
```
### 样例输入 #4
```
10
1 2
1 3
3 4
3 5
2 6
6 7
7 8
8 9
9 10
```
### 样例输出 #4
```
5660
10
4 3 1 2 5 6 7 8 9
```
### 样例输入 #5
```
20
5 18
16 11
6 15
7 14
8 7
10 20
3 4
14 6
9 8
18 11
17 4
11 10
4 11
2 13
13 12
12 15
15 20
19 9
1 8
```
### 样例输出 #5
```
79480
19
1 2 14 16 17 12 3 15 18 7 4 11 9 5 8 10 13 19 6
```
### 样例输入 #6
```
10
7 8
3 2
6 7
2 10
8 3
4 1
9 2
1 3
5 7

```
### 样例输出 #6
```
4340
5
8 6 1 2 7 3 4 5 9 
```
### 样例输入 #7
```
见附件
```
### 样例输出 #7
```
见附件
```
## 提示

**本题采用捆绑测试。**

对于所有数据，$1\le n\le 10^5$。

| 子任务编号 | $n\leq$ | 特殊性质 1 | 特殊性质 2 | 分数 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $50$ | 否 | 否 | $10$ |
| $1$ | $1000$ | 否 | 否 | $20$ |
| $2$ | $10^5$ | 是 | 否 | $10$ |
| $3$ | $10^5$ | 否 | 是 | $10$ |
| $4$ | $10^5$ | 否 | 否 | $50$ |

特殊性质 1：存在一个对点重标号的方案，使得第 $i$ 条边为 $(1,i+1)$。

特殊性质 2：存在一个对点重标号的方案，使得第 $i$ 条边为 $(i,i+1)$。



---


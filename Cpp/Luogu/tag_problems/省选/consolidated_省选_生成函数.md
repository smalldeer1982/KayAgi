---
title: "「ALFR Round 2」D 超立方体"
layout: "post"
diff: 省选/NOI-
pid: P10588
tag: ['数学', 'O2优化', '组合数学', '生成函数']
---
# 「ALFR Round 2」D 超立方体
## 题目背景

>  映入眼帘的是一棵硕大的樱花树。   
>
> 树下站着一个少女，她正抬头仰望着那棵樱花树。  
> 我想：她是位新生吧，大概和我一样也是溜出来的。  
> 我也抬着头望了望那棵樱花树。模模糊糊的花色遮住了天空。  
> 刮起一阵风，飘舞着的樱花花瓣将少女裹住。  
> 少女也看到了我……
## 题目描述

那是你与米尔嘉最初的邂逅。  

一如既往，米尔嘉又给你出了一道数列题。  
洁白的信封上留着柑橘的芳香，  
你小心翼翼地拆开信封阅读。

------------

在三维中，我们有三维立方体。  
它的 $2^3$ 个点的坐标都可以写成 $(x,y,z)$ 的形式。  

同理在 $n$ 维中，我们有 $n$ 维超立方体，它有 $2^n$ 个点。  
其棱长为 $1$，且所有顶点的各维坐标都是非负整数。

我们从点 $(0,0,\dots,0)$ 出发，走过 $m$ 条棱，求到达点 $(1,1,\dots,0)$ 的方案总数。

其中要到达的点的坐标中有 $l$ 个数字 $1$。

由于答案可能很大，你只需要输出方案数对 $998244353$ 取模后的结果就可以了。
## 输入格式

第一行为一个整数 $T$，表示数据组数。

接下来 $T$ 行，每行三个非负整数 $n,m,l$。
## 输出格式

对于每组数据，输出一行一个整数答案。
## 样例

### 样例输入 #1
```
5
3 3 1
3 4 0
114 514 86
19198 10101 7211
604800 4089470473293004800 443520 
```
### 样例输出 #1
```
7
21
191637399
939162608
305624040
```
## 提示

### 样例解释

第一个例子中的 $7$ 种方案分别是：

- $(0,0,0) \to (1,0,0) \to (0,0,0) \to (1,0,0)$
- $(0,0,0) \to (0,1,0) \to (0,0,0) \to (1,0,0)$
- $(0,0,0) \to (0,0,1) \to (0,0,0) \to (1,0,0)$
- $(0,0,0) \to (1,0,0) \to (1,1,0) \to (1,0,0)$
- $(0,0,0) \to (1,0,0) \to (1,0,1) \to (1,0,0)$
- $(0,0,0) \to (0,1,0) \to (1,1,0) \to (1,0,0)$
- $(0,0,0) \to (0,0,1) \to (1,0,1) \to (1,0,0)$

### 数据范围

| 子任务 | 分值 | 限制 |
| :----------: | :----------: | :----------: |
| $0$ | $10$ | $\sum nm\le2^{26}$，$n\le2^{13}$ |
| $1$ | $20$ | $l=0$ |
| $2$ | $30$ | $\sum n^2\le2^{26}$ |
| $3$ | $40$ | - |

对于 $100\%$ 数据，$1\le T\le600$，$\sum n\log_2 n\le2^{25}$，$n\in[1,2^{21}]$，$m\in[0,2^{64}-1]$，$l\in[0,n]$。

---

你翻到背面，发现一行小字：

请不要忘记考虑特殊情形。


---

---
title: "[COTS 2024] 奇偶矩阵 Tablica"
layout: "post"
diff: 省选/NOI-
pid: P10681
tag: ['动态规划 DP', '递推', '2024', 'O2优化', '生成函数', '线性递推', 'COCI（克罗地亚）']
---
# [COTS 2024] 奇偶矩阵 Tablica
## 题目背景

译自 [Izborne Pripreme 2024 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2024/) D1T2。$\texttt{1s,1G}。$
## 题目描述

考虑只包含 $0$ 和 $1$ 的 $N\times M$ 矩阵 $A$。

我们称满足以下条件的矩阵是好的：

- $\forall 1\le i\le N$，$\displaystyle \sum_{j=1}^M A_{i,j}\in \{1,2\}$；
- $\forall 1\le j\le M$，$\displaystyle \sum_{i=1}^N A_{i,j}\in \{1,2\}$。

求出 $N$ 行 $M$ 列的好的矩阵的数量，对 $(10^9+7)$ 取模。


## 输入格式

输入共一行两个正整数，即 $N,M$。
## 输出格式

输出一行一个整数，表示答案对 $(10^9+7)$ 取模后的结果。

## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
3 3
```
### 样例输出 #2
```
102
```
### 样例输入 #3
```
15 20
```
### 样例输出 #3
```
415131258
```
## 提示


#### 样例解释

样例 $1$ 解释如图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/xufx7ad6.png)

#### 数据范围

对于 $100\%$ 的数据，$1\le N,M\le 3\, 000$。

| 子任务编号 | 分值 | 约束  |
|:-----:|:------:|:-------:|
| $1$  | $10$  | $N, M \leq 6$   |
| $2$  | $18$  | $N, M \leq 50$  |
| $3$  | $31$  | $N, M \leq 200$ |
| $4$  | $41$  | 无额外约束 |




---

---
title: "BZOJ3028 食物"
layout: "post"
diff: 省选/NOI-
pid: P10780
tag: ['生成函数']
---
# BZOJ3028 食物
## 题目描述

明明这次又要出去旅游了，和上次不同的是，他这次要去宇宙探险！我们暂且不讨论他有多么 NC，他又幻想了他应该带一些什么东西。理所当然的，你当然要帮他计算携带 $n$ 件物品的方案数。

他这次又准备带一些受欢迎的食物，如：蜜桃多啦，鸡块啦，承德汉堡等等。

当然，他又有一些稀奇古怪的限制：

每种食物的限制如下：
- 承德汉堡：偶数个；
- 可乐：$0$ 个或 $1$ 个；
- 鸡腿：$0$ 个，$1$ 个或 $2$ 个；
- 蜜桃多：奇数个；
- 鸡块：$4$ 的倍数个；
- 包子：$0$ 个，$1$ 个，$2$ 个或 $3$ 个；
- 土豆片炒肉：不超过一个；
- 面包：$3$ 的倍数个；

注意，这里我们懒得考虑明明对于带的食物该怎么搭配着吃，也认为每种食物都是以『个』为单位（反正是幻想嘛），只要总数加起来是 $n$ 就算一种方案。因此，对于给出的 $n$，你需要计算出方案数，并对 $10007$ 取模。
## 输入格式

一个整数 $n$，表示总数。
## 输出格式

一个整数，表示方案数模 $10007$。
## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5
```
### 样例输出 #2
```
35
```
## 提示

- 对于 $40\%$ 的数据，但是 $1\leq n\leq 10^5$；
- 对于所有数据，$1\leq n\leq 10^{500}$；


---

---
title: "[PA 2019 Final] 数图 / Grafy"
layout: "post"
diff: 省选/NOI-
pid: P11817
tag: ['递推', '2019', '组合数学', '容斥原理', '生成函数', '高斯消元', 'PA（波兰）']
---
# [PA 2019 Final] 数图 / Grafy
## 题目背景

译自 PA 2019 Final。$\texttt{5s,256M}$。


本题数据为自造。

std: joke3579，validator & generator: Starrykiller。

加强版：P11821。**请勿提交 OEIS 题解。**
## 题目描述

求出 $n$ 个节点的满足以下条件的**有标号有向简单图**的数量：

- $\forall 1\le i\le n$，$\operatorname{deg_{out}}(i)=\operatorname{deg_{in}}(i)=2$。

这里，$\operatorname{deg_{out}}(u)$ 指节点 $u$ 的出度，$\operatorname{deg_{in}}(u)$ 指节点 $u$ 的入度。

你只需要输出答案对给定大素数 $p$ 取模后的结果。


注意我们是对**有标号**的「有向简单图」计数。也就是说，这张图中无重边自环。注意 $u\to v$ 和 $v\to u$ 同时出现是允许的。



## 输入格式

一行两个正整数 $n,p$。
## 输出格式

一行一个非负整数，表示答案。
## 样例

### 样例输入 #1
```
4 1000000007
```
### 样例输出 #1
```
9
```
## 提示

- $3\le n\le 500$；
- $10^8+7\le p\le 10^9+7$，$p$ 为素数。




---

---
title: "「HCOI-R2」巡回演出"
layout: "post"
diff: 省选/NOI-
pid: P12355
tag: ['洛谷原创', 'O2优化', '组合数学', 'Catalan 数', '生成函数', '洛谷月赛', 'Prüfer 序列']
---
# 「HCOI-R2」巡回演出
## 题目背景

小 A 是 HCOI 国著名的演唱家，她打算开展一场巡回演出。
## 题目描述

HCOI 国由 $n$ 个城市构成，可以被抽象为一棵 $n$ 个节点的有根树，首都是树的根 $r$。小 A 打算从 $r$ 开始，遍历全国进行演出。

具体地，设 $x$ 是小 A 当前在的位置，记录一个序列 $s$：
- 初始时，$x=r$，$s=[r]$。
- 如果 $x$ 存在没有被访问过的儿子，任意选择一个儿子 $y$，在 $s$ 的最后插入 $y$，并前往 $y$。
- 如果不存在如上的 $y$：若 $x=r$，演出结束；否则前往 $x$ 的父亲。

我们称最后得到的 $s$ 是 $T$ 的一种**遍历方法**，选择不同的儿子可以得到多种遍历方法。可以发现遍历方法实际上是 $T$ 的 DFS 序。

小 A 的助手给出一张收费表 $\{w_{n-1}\}$，可以如下计算这次巡回演出的收入 $w(T,s)$：
- 对于 $i\in[1,n]$，小 A 经过 $T$ 上 $s_{i}\to s_{i\bmod n+1}$ 的简单路径上的点（**不**包含 $s_{i}$，包含 $s_{i\bmod n+1}$）。
- 每次到达一个节点时，若当前是第 $i$ 次到达，小 A 收获  $w_i$ 枚金币作为报酬。
- $w(T,s)$ 为小 A 收到的金币枚数的总和。

小 A 的助手还给出了本次演出的遍历方法 $\{s_n\}$，定义一棵树 $T$ 合法当且仅当 $\{s_n\}$ 是它的一种**遍历方法**。你需要求出所有不同的合法 $T$ 的 $w(T,s)$ 之和对 $998244353$ 取模后的结果。

两棵有根树 $T$ 和 $T'$ 不相同当且仅当它们的根节点不同或存在一条在 $T$ 中出现而 $T'$ 中未出现的边。
## 输入格式

**本题包含多组数据。**

第一行一个正整数 $T$ 代表数据组数。对于每组测试数据：

第一行一个正整数 $n$，表示 HCOI 国的城市数。

第二行 $n$ 个正整数 $s_1,s_2,\cdots,s_n$，表示小 A 本次演出的遍历方法。

第三行 $n-1$ 个非负整数 $w_1,w_2,\cdots,w_{n-1}$，表示演出的收费表。
## 输出格式

对于每组测试数据，输出一行一个整数表示所有合法的 $T$ 的 $w(T,s)$ 之和对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
7
2
1 2
1
3
1 2 3
1 2
4
1 2 3 4
1 2 3
5
1 3 5 2 4
1 3 2 1
6
6 2 3 4 1 5
3 2 4 7 4
7
1 3 2 4 5 6 7
12 32 84 27 83 11
8
1 7 3 2 8 4 6 5
11 45 14 19 19 8 10
```
### 样例输出 #1
```
2
10
42
182
1240
41336
124348
```
### 样例输入 #2
```
2
9
1 2 3 4 5 6 7 8 9
18 48 72 49 83 59 74 80
12
1 12 2 4 3 6 5 7 8 9 11 10
120 938 283 920 462 748 932 784 178 904 442
```
### 样例输出 #2
```
787978
522215784
```
### 样例输入 #3
```
1
4
1 2 3 4
1 0 0
```
### 样例输出 #3
```
20
```
## 提示

#### 【样例解释 #1】

下文用 $(r,E)$ 来表示一棵有根树，其中 $E$ 是树的边集，$r$ 是树的根。

对于第一组数据，唯一一种合法的 $T$ 是 $(1,\{(1,2)\})$。小 A 经过两条路径 $1\to 2$ 和 $2\to 1$，经过了 $1,2$ 各一遍，故答案为 $1+1=2$。

对于第二组数据，合法的 $T$ 有 $(1,\{(1,2),(2,3)\}),(1,\{(1,2),(2,3)\})$，$w(T,s)$ 都是 $5$，故答案为 $5+5=10$。

对于第三组数据，合法的 $T$ 有 $(1,\{(1,2),(1,3),(1,4)\}),(1,\{(1,2),(1,3),(3,4)\}),(1,\{(1,2),$ $(2,3),(1,4)\}),(1,\{(1,2),(2,3),(2,4)\}),(1,\{(1,2),(2,3),(3,4)\})$，$w(T,s)$ 分别为 $9,8,8,$ $9,8$，故答案为 $9+8+8+9+8=42$。

对于第四组数据，一种合法的 $T$ 是 $(1,\{(1,3),(2,4),(3,2),(3,5)\})$，它的收入 $w(T,s)=13$。

#### 【数据范围与约定】

**本题采用捆绑测试。**

| 子任务编号 | $\boldsymbol{n\le}$ | $\boldsymbol{\sum n\le}$ | 特殊性质 | 得分 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $4$ | $10^6$ | A | $5$ |
| $2$ | $8$ | $40$ | A | $15$ |
| $3$ | $12$ | $60$ | 无 | $10$ |
| $4$ | $50$ | $200$ | 无 | $10$ |
| $5$ | $100$ | $500$ | 无 | $10$ |
| $6$ | $10^3$ | $5\times 10^3$ | B | $10$ |
| $7$ | $10^3$ | $5\times 10^3$ | 无 | $5$ |
| $8$ | $10^5$ | $2\times 10^5$ | B | $5$ |
| $9$ | $10^5$ | $2\times 10^5$ | 无 | $15$ |
| $10$ | $5\times10^5$ | $10^6$ | 无 | $15$ |

- 特殊性质 A：$i\in[1,n]$，$s_i=i$。
- 特殊性质 B：$w_1=1$，对于 $i\in[2,n-1]$，$w_i=0$。

对于所有数据，$1\le T\le 10^5$，$2\le n\le 5\times10^5$，$\sum n\le 10^6$，$0\le w_i<998244353$，$\{s_n\}$ 是一个 $1\sim n$ 的排列。


---

---
title: "多项式高手"
layout: "post"
diff: 省选/NOI-
pid: P12416
tag: ['动态规划 DP', '多项式', '组合数学', '生成函数', '根号分治']
---
# 多项式高手
## 题目描述

好像新旧不通，就不在这里写了。
## 输入格式

好像新旧不通，就不在这里写了。
## 输出格式

好像新旧不通，就不在这里写了。
## 样例

### 样例输入 #1
```
1 6
7
```
### 样例输出 #1
```
42
```
### 样例输入 #2
```
2 6
9 7
```
### 样例输出 #2
```
180
```
### 样例输入 #3
```
3 3
9 5 7
```
### 样例输出 #3
```
61
```
### 样例输入 #4
```
6 6
250863180 814744283 795773454 638846422 603293402 952439325
```
### 样例输出 #4
```
162287374
```
## 提示

好像新旧不通，就不在这里写了。


---

---
title: "[Math×Girl] 互质与整除"
layout: "post"
diff: 省选/NOI-
pid: P12470
tag: ['多项式', '数论', 'O2优化', '背包 DP', '生成函数', 'Dirichlet 卷积', '欧拉函数']
---
# [Math×Girl] 互质与整除
## 题目背景

>“还可以连接一个东西。”米尔嘉说，“$1$ 的原始 $n$ 次方根的个数是欧拉老师 $\varphi$ 函数的值。函数 $\varphi(n)$ 在 $1\le k<n$ 的范围内表示与 $n$ 互质的自然数的个数，也表示循环群的生成元的个数。”米尔嘉像是描绘 $\varphi$ 似地挥动手指，“最喜欢互质的尤里不在这里真可惜，今天你怎么没带她来？”  
>米尔嘉瞪我。

“互质？”米尔嘉看着窗外说，“我们来做道有趣的题吧！”  
## 题目描述

给定一个数 $n$，求出满足以下方程的 $x$ 的个数。
$$\varphi(x)\mid n$$

其中 $\mid$ 为整除符号，$a\mid b$ 表示 $a$ 整除 $b$。  
$\varphi(x)$ 为欧拉 $\varphi$ 函数，详见题目背景。
## 输入格式

本题有多组数据，第一行输入一个整数 $T$，表示数据组数。  

_米尔嘉已经帮你实现了 Pollard-Rho 算法，_  
所以输入给出的是 $n$ 的标准质因子分解形式 $n=\prod_{i=1}^s p_i^{\alpha_i}$。

对于每一组询问，我们首先给出一个整数 $s$。  
后面 $s$ 行每行两个整数表示 $p_i,\alpha_i$，保证 $p_i<p_{i+1}$。
## 输出格式

对于每组数据，一行输出一个数表示解的个数。  

_为了节约你的时间，米尔嘉已经封装好了 modint 以进行中国剩余定理合并答案。_  
所以输出对 $998244353$ 取模后的结果即可。  
## 样例

### 样例输入 #1
```
3
1
2 3
3
2 3
11 1
23 1
6
2 1
3 2
5 1
7 1
101 2
178187 1
```
### 样例输出 #1
```
14
53
53
```
## 提示

### 样例解释

质因数分解前 $n$ 分别为：  
$8,2024,1145141919810$

第一个例子中的 $14$ 个解是：  
$\varphi(15)=\varphi(16)=\varphi(20)=\varphi(24)=\varphi(30)=8\mid 8$  
$\varphi(5)=\varphi(8)=\varphi(10)=\varphi(12)=4\mid 8$  
$\varphi(3)=\varphi(4)=\varphi(6)=2\mid 8$  
$\varphi(1)=\varphi(2)=1\mid 8$

### 数据范围

| 子任务 | 分值 | 限制 |
| :----------: | :----------: | :----------: |
| $0$ | $10$ | $n\in[1,10^7]$ |
| $1$ | $10$ | $n\in[1,10^9]$ |
| $2$ | $20$ | $n\in[1,10^{12}]$ |
| $3$ | $20$ | $n\in[1,10^{14}]$ |
| $4$ | $20$ | $n\in[1,10^{16}]$ |
| $5$ | $20$ | - |

对于 $100\%$ 数据，保证 $T=5$，$n\in[1,10^{18}],s\ge 1$。 


---

---
title: "[TJOI2015] 概率论"
layout: "post"
diff: 省选/NOI-
pid: P3978
tag: ['递推', '2015', '各省省选', 'Special Judge', 'Catalan 数', '生成函数', '期望', '天津']
---
# [TJOI2015] 概率论
## 题目描述

为了提高智商，ZJY 开始学习概率论。有一天，她想到了这样一个问题：对于一棵随机生成的 $n$ 个结点的有根二叉树（所有互相不同构的形态等概率出现），它的叶子节点数的期望是多少呢？

判断两棵树是否同构的伪代码如下：

$$
\def\arraystretch{1.2}
    \begin{array}{ll}
    \hline
    \textbf{算法 1}&\text{Check}(T1,T2) \\
    \hline
    1&\textbf{Require: }\text{ 两棵树的节点}T1,T2\\
    2&\qquad\textbf{if}\ \ T1=\text{null}\textbf{ or }T2=\text{null}\textbf{ then }\\
    3&\qquad\qquad\textbf{return}\ \ T1=\text{null}\textbf{ and }T2=\text{null}\\
    4&\qquad\textbf{else}\\
    5&\qquad\qquad\textbf{return}\ \text{Check}(T1\to\mathit{leftson},T2\to\mathit{leftson}) \\ 
    & \qquad\qquad\qquad \textbf{ and }\text{Check}(T1\to\mathit{rightson},T2\to\mathit{rightson})\\
    6&\qquad\textbf{endif}\\
    \hline
    \end{array} 
    $$


## 输入格式

输入一个正整数 $n$，表示有根树的结点数。

## 输出格式

输出这棵树期望的叶子节点数，要求误差小于 $10^{-9}$。

## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
1.000000000
```
### 样例输入 #2
```
3
```
### 样例输出 #2
```
1.200000000
```
## 提示

## 数据范围

对于 $30\%$ 的数据，$1 \le n \le 10$。

对于 $70\%$ 的数据，$1 \le n \le 100$。

对于 $100\%$ 的数据，$1 \le n \le 10^9$。


---

---
title: "付公主的背包"
layout: "post"
diff: 省选/NOI-
pid: P4389
tag: ['数学', 'O2优化', '背包 DP', '生成函数', '快速傅里叶变换 FFT']
---
# 付公主的背包
## 题目背景

付公主有一个可爱的背包qwq


## 题目描述

这个背包最多可以装 $10^5$ 大小的东西

付公主有 $n$ 种商品，她要准备出摊了

每种商品体积为 $v_i$，都有无限件

给定 $m$，对于 $s\in [1,m]$，请你回答用这些商品恰好装 $s$ 体积的方案数

## 输入格式

第一行两个正整数 $n,m$。
第二行 $n$ 个正整数，表示每种商品的体积。

## 输出格式

输出 $m$ 行，第 $i$ 行代表 $s=i$ 时方案数，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
2 4
1 2
```
### 样例输出 #1
```
1
2
2
3
```
## 提示

【数据范围】  
对于 $30\%$ 的数据，$1\le n,m \le 3000$；  
对于 $60\%$ 的数据，纯随机生成；   
对于 $100\%$ 的数据， $1\le n,m \le 10^5$，$1\le v_i \le m$。


---

---
title: "[国家集训队] 整数的lqp拆分"
layout: "post"
diff: 省选/NOI-
pid: P4451
tag: ['递推', '斐波那契数列', '生成函数', '线性递推']
---
# [国家集训队] 整数的lqp拆分
## 题目背景

来源：2011中国国家集训队命题答辩
## 题目描述

lqp在为出题而烦恼，他完全没有头绪，好烦啊…

他首先想到了整数拆分。整数拆分是个很有趣的问题。给你一个正整数 $N$ ，对于N的一个整数拆分就是满足任意 $m>0$，$a_1 ,a_2 ,a_3…a_m>0$，且 $a_1+a_2+a_3+…+a_m=n$ 的一个有序集合。通过长时间的研究我们发现了计算对于 $n$ 的整数拆分的总数有一个很简单的递推式，但是因为这个递推式实在太简单了，如果出这样的题目，大家会对比赛毫无兴趣的。  

然后 lqp 又想到了斐波那契数。定义 $F_0=0,F_1=1,F_n=F_{n-1}+F_{n-2} (n>1)$，$F_n$就是斐波那契数的第$n$项。但是求出第 $n$ 项斐波那契数似乎也不怎么困难…

lqp 为了增加选手们比赛的欲望，于是绞尽脑汁，想出了一个有趣的整数拆分，我们暂且叫它：整数的lqp拆分。

和一般的整数拆分一样，整数的 lqp 拆分是满足任意 $m>0$，$a_1 ,a_2 ,a_3…a_m>0$，且 $a_1+a_2+a_3+…+a_m=n$ 的一个有序集合。但是整数的lqp拆分要求的不是拆分总数，相对更加困难一些。

对于每个拆分，lqp 定义这个拆分的权值 $F_{a_1}F_{a_2}…F_{a_m}$，他想知道对于所有的拆分，他们的权值之和是多少？

简单来说，就是求  
$\sum\prod_{i=1}^m F_{a_i}$   
$m>0$    
$a_1,a_2...a_m>0$   
$a_1+a_2+...+a_m=n$     
由于答案可能非常大，所以要对 $10^9 + 7$ 取模。
## 输入格式

输入的第一行包含一个整数 $n$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
5
```
## 提示

【数据范围】  
对于 $60\%$ 的数据，$1\le n \le 10^9$；  
对于 $100\%$ 的数据，$1\le n \le 10^{10000}$。

【样例解释】  
$F_0=0,F_1=1,F_2=1,F_3=2$。

对于 $n=3$，有这样几种 lqp 拆分：

$3=1+1+1$，权值是 $F_1\times F_1\times F_1=1\times1\times1=1$

$3=1+2$，权值是 $F_1\times F_2=1\times1=1$

$3=2+1$，权值是 $F_2\times F_1=1\times1=1$

$3=3$，权值是 $F_3=2$

所以答案是 $1+1+1+2=5$


---

---
title: "[集训队互测 2012] calc"
layout: "post"
diff: 省选/NOI-
pid: P4463
tag: ['动态规划 DP', '数学', '2012', '集训队互测', '生成函数']
---
# [集训队互测 2012] calc
## 题目描述

一个序列 $a_1,a_2,\dots,a_n$ 是合法的，当且仅当：

- $a_1,a_2,\dots,a_n$ 都是 $[1,k]$ 中的整数。
- $a_1,a_2,\dots,a_n$ 互不相等。

一个序列的值定义为它里面所有数的乘积，即 $a_1\times a_2\times\dots\times a_n$。

求所有不同合法序列的值的和对 $p$ 取模后的结果。两个序列不同当且仅当他们任意一位不同。
## 输入格式

一行三个正整数 $k, n, p$。意义为上面所说的。
## 输出格式

一行结果。
## 样例

### 样例输入 #1
```
9 7 10007
```
### 样例输出 #1
```
3611
```
## 提示

【数据范围】

对于 $5\%$ 的数据，$k \le 10$，$n \le 10$。

对于 $20\%$ 的数据，$k \le 1000$，$n \le 20$。

对于 $50\%$ 的数据，$k \le 10^9$，$n \le 20$。

对于 $100\%$ 的数据，$k \le 10 ^ 9$，$n \le 500$，$p \le 10 ^ 9$，保证 $p$ 为素数，保证 $n + 1 < k < p$。

by WJMZBMR
****
$\mathsf i \color{red}\mathsf{ostream}$ 觉得这题数据太弱了，于是他造了个[加强版](https://www.luogu.com.cn/problem/P5850)


---

---
title: "[HAOI2018] 染色"
layout: "post"
diff: 省选/NOI-
pid: P4491
tag: ['2018', '河南', '各省省选', 'O2优化', '容斥原理', '生成函数', '快速数论变换 NTT']
---
# [HAOI2018] 染色
## 题目背景

HAOI2018 Round2 第二题
## 题目描述

为了报答小 C 的苹果，小 G 打算送给热爱美术的小 C 一块画布，这块画布可以抽象为一个长度为 $N$ 的序列，每个位置都可以被染成 $M$ 种颜色中的某一种。

然而小 C 只关心序列的 $N$ 个位置中出现次数恰好为 $S$ 的颜色种数，如果恰好出现了 $S$ 次的颜色有 $K$ 种，则小 C 会产生 $W_k$ 的愉悦度。

小 C 希望知道对于所有可能的染色方案，他能获得的愉悦度的和对 $1004535809$
取模的结果是多少。
## 输入格式

从标准输入读入数据。第一行三个整数 $N, M, S$。

接下来一行 $M + 1$ 个整数，第 $i$ 个数表示 $W_{i-1}$。
## 输出格式

输出到标准输出中。输出一个整数表示答案。
## 样例

### 样例输入 #1
```
8 8 3
3999 8477 9694 8454 3308 8961 3018 2255 4910
```
### 样例输出 #1
```
524070430
```
### 样例输入 #2
```
见 sample.zip/data2.in
```
### 样例输出 #2
```
见 sample.zip/data2.ans
```
## 提示

特殊性质: $\forall 1 \le i \le m, W_i = 0$。

对于 $100\%$ 的数据，满足 $1 \le N \le 10 ^ 7$，$1 \le M \le 10 ^ 5$，$1 \le S \le 150$，$0 \le W_i < 1004535809$。

![Data](https://cdn.luogu.com.cn/upload/pic/18057.png)



---

---
title: "【模板】分治 FFT"
layout: "post"
diff: 省选/NOI-
pid: P4721
tag: ['分治', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】分治 FFT
## 题目背景

也可用多项式求逆解决。
## 题目描述

给定序列 $g_{1\dots n - 1}$，求序列 $f_{0\dots n - 1}$。

其中 $f_i=\sum_{j=1}^if_{i-j}g_j$，边界为 $f_0=1$。

答案对 $998244353$ 取模。
## 输入格式

第一行一个整数 $n$ 。

第二行 $n-1$ 个整数 $g_{1\dots n - 1}$。
## 输出格式

一行 $n$ 个整数，表示 $f_{0\dots n - 1}$ 对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
4
3 1 2
```
### 样例输出 #1
```
1 3 10 35
```
### 样例输入 #2
```
10
2 456 32 13524543 998244352 0 1231 634544 51
```
### 样例输出 #2
```
1 2 460 1864 13738095 55389979 617768468 234028967 673827961 708520894
```
## 提示

$2\leq n\leq 10^5$，$0\leq g_i<998244353$。


---

---
title: "[集训队作业2013] 城市规划"
layout: "post"
diff: 省选/NOI-
pid: P4841
tag: ['数学', '2013', '集训队互测', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [集训队作业2013] 城市规划
## 题目描述

刚刚解决完电力网络的问题，阿狸又被领导的任务给难住了。

刚才说过，阿狸的国家有 $n$ 个城市，现在国家需要在某些城市对之间建立一些贸易路线，使得整个国家的任意两个城市都直接或间接的连通。

为了省钱, 每两个城市之间最多只能有一条直接的贸易路径。对于两个建立路线的方案，如果存在一个城市对，在两个方案中是否建立路线不一样，那么这两个方案就是不同的，否则就是相同的。现在你需要求出一共有多少不同的方案。

好了，这就是困扰阿狸的问题。换句话说，你需要求出 $n$ 个点的简单 (无重边无自环) 有标号无向连通图数目。

由于这个数字可能非常大, 你只需要输出方案数对 $1004535809$ ( $479 \times 2 ^{21} + 1$ ) 取模即可。
## 输入格式

仅一行一个整数 $n$
## 输出格式

仅一行一个整数，为方案数 $\bmod \space 1004535809$。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
38
```
### 样例输入 #3
```
100000
```
### 样例输出 #3
```
829847355

```
## 提示

【数据范围】   
对于 $20\%$ 的数据，$n \le 10$    
对于 $40\%$ 的数据，$n \le 1000$     
对于 $60\%$ 的数据，$n \le 30000$    
对于 $80\%$ 的数据，$n \le 60000$     
对于 $100\%$ 的数据，$n \le 130000$   

试题来源：$2013$ 中国国家集训队第二次作业


---

---
title: "[MtOI2019] 幻想乡数学竞赛"
layout: "post"
diff: 省选/NOI-
pid: P5517
tag: ['数学', '2019', '洛谷原创', 'O2优化', '矩阵加速', '生成函数', '线性递推']
---
# [MtOI2019] 幻想乡数学竞赛
## 题目背景

一年一度的幻想乡数学竞赛 (thMO) 又要开始了。

幻想乡中学习数学的少 (lao) 女 (tai) 们 (po) 和冰之妖精 baka 一起准备着 thMO。

但是在那一刻，幻想乡日复一日的宁静被打破了。

广播里，播放起了死亡的歌曲！

在那一刻，人们又回想起了被算数支配的恐惧。  

就剩下 baka，baka，baka，baka 的声音在幻想乡里回荡。  
 

---  

河城 荷取 (Kawashiro Nitori) 正坐在 thMO2019 的考场上！  
因为荷取有着她的[超级计算机](https://www.luogu.org/problemnew/show/P4911)，在成功地用光学迷彩覆盖了计算机之后，荷取在 thMO2019 的考场上所向披靡。  

* 荷取用她的超级计算机 $0 \,\mathrm{ms}$ 跑出了这么一道题：  

  * $\exists \{ a_n\} (n=0,1,\cdots ,10^{18})$，已知 $a_0=2,a_1=5,a_{n+2}=3a_{n+1}-2a_n$，求 $a_n\bmod 10^{9}+7$

* 荷取：显然，这个题可以用矩阵乘法 + 快速幂，可以 $O(\log n)$ 水过去，差不多就这样：

$$
\begin{bmatrix} a_n & a_{n+1} \end{bmatrix}=\begin{bmatrix} a_0 & a_1 \end{bmatrix} \times \begin{bmatrix} 3 & 1 \\ -2 & 0 \end{bmatrix}^n
$$      
  
但是荷取遇到了一道她不会的题，她正在寻求你的帮助呢！ 
## 题目描述

存在一个数列 $\{ a_n\} (n\in \{ 0,1,2,\cdots ,2^{64}-1\} )$。  
已知 $a_0=-3,a_1=-6,a_2=-12,a_n=3a_{n-1}+a_{n-2}-3a_{n-3}+3^n$。  

* 现在给你一个非负整数 $n$ ，令 $p=10^{9}+7$，请你求出 $a_n \bmod p$。 

* **注：若 $a_n<0$ ，请输出 $(a_n \bmod p+p)\bmod p$。**    
  
  
为了更充分地考验你的水平，荷取设置了 $T$ 组询问。

* 为了在某种程度上减少你的输入和输出量，我们采用以下的代码来生成询问：  
  
```cpp
namespace Mker
{
//  Powered By Kawashiro_Nitori
//  Made In Gensokyo, Nihon
	#include<climits>
	#define ull unsigned long long
	#define uint unsigned int
	ull sd;int op;
	inline void init() {scanf("%llu %d", &sd, &op);}
	inline ull ull_rand()
	{
		sd ^= sd << 43;
		sd ^= sd >> 29;
		sd ^= sd << 34;
		return sd;
	}
	inline ull rand()
	{
		if (op == 0) return ull_rand() % USHRT_MAX + 1;
		if (op == 1) return ull_rand() % UINT_MAX + 1; 
		if (op == 2) return ull_rand();
	}
}
```  

在调用 `Mker::init()` 函数之后，你第 $i$ 次调用 `Mker::rand()` 函数时返回的便是第 $i$ 次询问的 $n_i$。

在这里给出 $op$ 的限制：

* 如果 $op=0$，满足 $n_i \leq 2^{16}$。

* 如果 $op=1$，满足 $n_i \leq 2^{32}$。

* 如果 $op=2$，满足 $n_i \leq 2^{64}-1$。

为了减少你的输出量，你只需要输出所有询问答案的**异或和**。




## 输入格式

第一行三个整数，输入 $T$ ， $seed$ 和 $op$。
## 输出格式

第一行一个整数，输出 $T$ 组询问的答案的**异或和**。  
## 样例

### 样例输入 #1
```
142857 1145141919 0
```
### 样例输出 #1
```
562611141
```
### 样例输入 #2
```
142857 1145141919 1
```
### 样例输出 #2
```
894946216
```
### 样例输入 #3
```
142857 1145141919 2
```
### 样例输出 #3
```
771134436
```
## 提示

### 子任务  

![png](https://i.loli.net/2019/04/19/5cb9bb2c6c1d6.png)  

### 题目来源

[迷途之家 2019 联赛](https://www.luogu.org/contest/20135)(MtOI2019) T4

出题人：disangan233

验题人：suwakow



---

---
title: "集合划分计数"
layout: "post"
diff: 省选/NOI-
pid: P5748
tag: ['数学', 'Special Judge', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT']
---
# 集合划分计数
## 题目描述

一个有 $n$ 个元素的集合，将其分为任意个非空子集，求方案数。  
注意划分出的集合间是无序的，即 $\{\{1,2\},\{3\}\}$ 和 $\{\{3\},\{2,1\}\}$ 算作一种方案。

由于答案可能会很大，所以要对 $998244353$ 取模。
## 输入格式

第一行一个正整数 $T$，表示数据组数。  
接下来 $T$ 行，每行一个正整数 $n$。
## 输出格式

输出 $T$ 行，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
2
3
7
9
233
```
### 样例输出 #1
```
2
5
877
21147
53753544

```
## 提示

【数据范围】  
$T = 1000$，$1\le n \le 10^5$。

【样例解释】  
对于 $n=3$，有五种方案：$\{\{1,2,3\}\},\{\{1,2\},\{3\}\},\{\{1\},\{2,3\}\},\{\{1\},\{2\},\{3\}\},\{\{1,3\},\{2\}\}$。

本题只有一个测试点，假设你答对了 $x$ 组数据，你将得到 $\lfloor x/(T/100) \rfloor$ 分。   
如果你不能解决所有数据，也请输出 $T$ 个整数。

~~TLE不要怪我，是你常数太大了~~


---

---
title: "排列计数"
layout: "post"
diff: 省选/NOI-
pid: P5825
tag: ['动态规划 DP', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 排列计数
## 题目描述

我们记一个排列 $P$ 的升高为 $k$ 当且仅当存在 $k$ 个位置 $i$ 使得 $P_i<P_{i+1}$。

现在给定排列长度 $n$，对于所有整数 $k\in [0,n]$ 求有多少个排列的升高为 $k$。
## 输入格式

一个整数 $n$。
## 输出格式

一行，$n+1$ 个整数，第 $i$ 个整数表示长度为 $n$ 且升高为 $i-1$ 个排列的个数，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
1 11 11 1 0
```
## 提示

对于 $100\%$ 的数据，$1\leq n\leq 2\times 10^5$。


---

---
title: "[USACO19DEC] Tree Depth P"
layout: "post"
diff: 省选/NOI-
pid: P5853
tag: ['数学', '2019', 'USACO', '组合数学', '生成函数']
---
# [USACO19DEC] Tree Depth P
## 题目背景

For the new year, Farmer John decided to give his cows a festive binary search tree
(BST)! 

To generate the BST, FJ starts with a permutation $a=\{a_1,a_2,\ldots,a_N\}$
of the integers $1\ldots N$, where $N\le 300$.  He then runs the following
pseudocode with arguments $1$ and $N.$

```
generate(l,r):
  if l > r, return empty subtree;
  x = argmin_{l <= i <= r} a_i; // index of min a_i in {a_l,...,a_r}
  return a BST with x as the root, 
    generate(l,x-1) as the left subtree,
    generate(x+1,r) as the right subtree;
```
For example, the permutation $\{3,2,5,1,4\}$ generates the following BST:

```
    4
   / \
  2   5
 / \ 
1   3
```
Let $d_i(a)$ denote the depth of node $i$ in the tree corresponding to $a,$ 
meaning the number of nodes on the path from $a_i$ to the root. In the above
example, $d_4(a)=1, d_2(a)=d_5(a)=2,$ and $d_1(a)=d_3(a)=3.$

The number of inversions of $a$ is equal to the number of pairs of integers
$(i,j)$ such that $1\le i<j\le N$ and $a_i>a_j.$ The cows know that the $a$ that
FJ will use to generate the BST has exactly $K$ inversions
$(0\le K\le \frac{N(N-1)}{2})$.  Over all $a$ satisfying this condition, compute
the remainder when $\sum_ad_i(a)$ is divided by $M$ for each $1\le i\le N.$
## 题目描述

为了迎接新年，Farmer John 决定给他的奶牛们一个节日二叉搜索树！

为了生成这个二叉搜索树，Farmer John 从一个 $1 \dots N$ 的排列 $a= \{1,2, \dots ,N\}$ 开始，然后以参数 $l$ 和 $r$ 开始运行如下的伪代码：
```
generate(l,r):
  if l > r, return empty subtree;
  x = argmin_{l <= i <= r} a_i; // index of min a_i in {a_l,...,a_r}
  return a BST with x as the root, 
    generate(l,x-1) as the left subtree,
    generate(x+1,r) as the right subtree;
```
例如，排列 $\{ 3,2,5,1,4 \}$ 将产生如下的二叉搜索树：

![](https://cdn.luogu.com.cn/upload/image_hosting/gw6ursc0.png)

令 $d_i(a)$ 表示节点 $i$ 在用排列 $a$ 生成的二叉搜索树中的深度。深度定义为这个节点到根节点的路径上的点数。在上述例子中，$d_4(a)=1,d_2(a)=d_5(a)=2,d_1(a)=d_3(a)=3$。

$a$ 中的逆序对数等于满足 $1 \le i<j \le N$ 且 $a_i>a_j$ 的数对 $(i,j)$ 的个数。奶牛们知道 Farmer John 用来生成二叉搜索树的排列 $a$ 中恰好有 $K$ 个逆序对。对于所有满足条件的 $a$，请计算对于每个 $1 \le i \le N$，$\sum_a d_i(a)$ 对 $M$ 取模后的结果。
## 输入格式

输入只有一行，包含三个整数 $N,K,M$。
## 输出格式

输出一行 $N$ 个整数，第 $i$ 个整数表示 $\sum_a d_i(a) \bmod M$。两个整数之间用一个空格隔开。
## 样例

### 样例输入 #1
```
3 0 192603497

```
### 样例输出 #1
```
1 2 3

```
### 样例输入 #2
```
3 1 144408983

```
### 样例输出 #2
```
3 4 4

```
## 提示

#### 样例解释 1

对于这个样例，唯一满足条件的排列为 $a=\{1,2,3\}$。

#### 样例解释 2

对于这个样例，满足条件的两个排列分别为 $a=\{1,3,2\}$ 和 $a=\{2,1,3\}$。

#### 数据范围

对于全部数据，$1\le N\le 300$，$0\le K\le \frac{N(N-1)}{2}$，保证 $M$ 是一个 $\left[ 10^8,10^9+9 \right]$ 范围中的质数。

对于测试点 $3,4$，满足 $N \le 8$；

对于测试点 $5-7$，满足 $N \le 20$；

对于测试点 $8-10$，满足 $N \le 50$。

USACO 2019 December 铂金组T3


---

---
title: "直接自然溢出啥事没有 加强版"
layout: "post"
diff: 省选/NOI-
pid: P6112
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '生成函数']
---
# 直接自然溢出啥事没有 加强版
## 题目背景

[原题链接](https://www.luogu.com.cn/problem/P6103)    
本题与原题的区别，只有模数和数据范围不同。

![](https://cdn.luogu.com.cn/upload/image_hosting/hu0gfpdv.png)
## 题目描述

给定一个正整数 $n$，问有多少个长度为 $n$ 的字符串，满足这个字符串是一个「程序片段」。

具体定义如下：

单个分号 `;` 是一个「语句」。

空串 是一个「程序片段」。

如果字符串 `A` 是「程序片段」，字符串 `B` 是「语句」，则 `AB` 是「程序片段」。

如果字符串 `A` 是「程序片段」，则 `{A}` 是「语句块」。

如果字符串 `A` 是「语句块」，则 `A` 是「语句」，`[]A` 和 `[]()A` 都是「函数」。

如果字符串 `A` 是「函数」，则 `(A)` 是「函数」，`A` 和 `A()` 都是「值」。

如果字符串 `A` 是「值」，则 `(A)` 是「值」，`A;` 是「语句」。

**注意：`A` 是 `B` 并不代表 `B` 是 `A`。**
## 输入格式

输入一行一个正整数 $n$。
## 输出格式

输出一行一个整数表示答案，作为良心出题人，你只需要对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
7
```
### 样例输出 #2
```
140
```
### 样例输入 #3
```
8923
```
### 样例输出 #3
```
424180943
```
### 样例输入 #4
```
114514
```
### 样例输出 #4
```
552971057
```
## 提示

【样例一解释】  
合法的「程序片段」有：`;;;;`，`;;{}`，`;{;}`，`;{};`，`{;;}`，`{;};`，`{{}}`，`{};;`，`{}{}`。

【数据范围】  
对于 $30\%$ 的数据，$1\le n \le 10^5$；   
对于 $100\%$ 的数据，$1\le n \le 10^7$。  


---

---
title: "强迫症"
layout: "post"
diff: 省选/NOI-
pid: P6694
tag: ['数学', '2020', 'O2优化', '生成函数', '快速数论变换 NTT']
---
# 强迫症
## 题目背景

小 L 是一个严重的强迫症患者。

由于他严重的强迫症，所以他画图时总是要把点画在一个圆上。
## 题目描述

一天，他问了小 H 和小 W 这样一个问题：

如果在一个圆上有 $n$ 个不同的点，依次标号为 $1$ 到 $n$，有多少种方案能把它们连成一棵树？

小 H & 小 W：这不是sb题吗？

小 L：那如果**连边不能相交**呢？

小 H & 小 W：这不是sb题吗？

小 L：那如果把「树」换成「图」呢呢？

小 H & 小 W：这不是sb题吗？

小 L：那如果给每个点一个权值 $a_i$，连接 $(i,j)$ 的边权值为 $a_i\times a_j$，求**满足上面**的图的**期望所有边权值之和**呢？

小 H & 小 W：这不是sb题吗？

小 L 见自己辛苦做了许久都没写出的题目被 dalao 轻松秒杀后十分郁闷。为了安慰他，你需要帮他做出这个问题。

**注意**：
1. 两条边在端点处**不视作相交**。
1. **没有边的图（即只有 $n$ 个点，之间没有边相连）也合法**
1. 点**按顺时针从 $1$ 到 $n$** 编号。
1. 图中**不能有自环和重边**
## 输入格式

第一行一个正整数 $n$，意义如上。

接下来一行 $n$ 个非负整数，第 $i$ 个数为 $a_i$，表示第 $i$ 个点的点权。
## 输出格式

一个正整数，表示结果。答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4
1 1 1 1
```
### 样例输出 #1
```
665496238
```
### 样例输入 #2
```
13
1 1 4 5 1 4 1 9 1 9 8 1 0
```
### 样例输出 #2
```
748867567
```
## 提示

对于样例一，全部 $64$ 张图如下：
![](https://cdn.luogu.com.cn/upload/image_hosting/zfa8hs0v.png)

其中左侧 $48$ 张图合法，右侧 $16$ 张图不合法，所有边的权值均为 $1$。

期望边权和为 $\dfrac{8}{3}$，模 $998244353$ 意义下结果为 $665496238$。

### 数据范围

**本题采用捆绑测试。**

- Subtask 1( $10\%$ )：$n\leq 6$。
- Subtask 2( $30\%$ )：$n\leq 3000$。
- Subtask 3( $60\%$ )：无特殊限制。

对于 $100\%$ 的数据，$2\leq n\leq 10^5,0\leq a_i\leq10^6$。

Subtask 1 和 Subtask 2 时限 $1s$，Subtask 3 时限 $2s$。

------------
如果你不知道如何对一个有理数取模，请自行百度「乘法逆元」


---

---
title: "「PMOI-2」简单构造题"
layout: "post"
diff: 省选/NOI-
pid: P7423
tag: ['数学', 'O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「PMOI-2」简单构造题
## 题目描述

某次模拟赛中，NaCly\_Fish 遇见这样一道题：
****
定义一个长度为 $n$ 的序列 $A$ 的权值为：

$$\sum_{l=1}^n\sum_{r=l}^n f_A(l,r)$$
其中 $f_A(l,r)$ 就是在 $A$ 的区间 $[l,r]$ 中，「所有**在该区间内出现过的**元素出现次数的乘积」再乘上「区间内所有元素的乘积」。  

要求构造一个长为 $n$ 的序列，其中每个元素都是 $[1,m]$ 中的整数，最大化其权值。
****
她并不会，只好均匀随机 $n$ 个 $[1,m]$ 中的整数组成一个数列，然后输出其权值。

当然，她的这份程序一分都没拿到；但她想知道，生成出的序列期望权值是多少。

为了防止精度问题，答案需要对 $998244353$ 取模。
## 输入格式

一行两个正整数 $n,m$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 2
```
### 样例输出 #1
```
623902740
```
### 样例输入 #2
```
5 3
```
### 样例输出 #2
```
887328630
```
### 样例输入 #3
```
80 233
```
### 样例输出 #3
```
913763047
```
### 样例输入 #4
```
114514 19260817
```
### 样例输出 #4
```
850727003
```
## 提示

【样例一解释】  

显然有 $8$ 种可能的序列：  
$[1,1,1],[1,1,2],[1,2,1],[1,2,2],[2,1,1],[2,1,2],[2,2,1],[2,2,2]$。

权值分别为 $10,12,12,23,12,17,23,46$，期望值就是 $\frac{155}{8}$。

【样例二解释】

期望值是 $\frac{76842}{243}$。

【数据范围】  

**本题采用捆绑测试**。

- Subtask 1（5 pts）：$1\le n,m \le 8$；  
- Subtask 2（7 pts）：$1\le n,m \le 100$；  
- Subtask 3（11 pts）：$1 \le n,m \le 400$； 
- Subtask 4（13 pts）：$1\le n,m \le 5000$；
- Subtask 5（25 pts）：$1\le n \le 5000$；
- Subtask 6（39 pts）：无特殊限制。

对于 $100\%$ 的数据满足，$1\le n \le 2 \times 10^5$，$1\le m \le 10^8$。




---

---
title: "简单的排列计数"
layout: "post"
diff: 省选/NOI-
pid: P7435
tag: ['动态规划 DP', '数学', 'O2优化', '动态规划优化', '组合数学', '排列组合', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 简单的排列计数
## 题目描述

设 $\text{inv}_{\pi}$ 表示排列 $\pi$ 的逆序对数。如果 $\pi$ 长度为 $n$ 则有

$$\text{inv}_{\pi}=\sum\limits_{i=1}^{n}\sum\limits_{j=i+1}^{n}[\pi_i>\pi_j]$$

给定两个正整数 $n,k$，和一个排列 $\pi^\prime$，定义一个长度为 $n$ 的排列 $\pi$ 的权值 $\text{val}_{\pi}$ 为

$$\text{val}_{\pi}=\prod\limits_{i=1}^{n}\prod_{j=i+1}^{n}\pi_i^{[\pi_{i}>\pi_j]}$$

对于 $0\leq m\leq k$ 求

$$\sum\limits_{\pi}[\text{inv}_\pi=m]\text{val}_\pi$$

其中 $\pi$ 是长度为 $n$ 的排列。
## 输入格式

第一行两个整数 $n,k$。
## 输出格式

一行 $k+1$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 3
```
### 样例输出 #1
```
1 5 15 18
```
## 提示

### 样例解释 1

$$\text{inv}_{(1,2,3)}=0,\text{inv}_{(1,3,2)}=1,\text{inv}_{(2,1,3)}=1,\text{inv}_{(2,3,1)}=2,\text{inv}_{(3,1,2)}=2,\text{inv}_{(3,2,1)}=3$$

$$\text{val}_{(1,2,3)}=1,\text{val}_{(1,3,2)}=3,\text{val}_{(2,1,3)}=2,\text{val}_{(2,3,1)}=6,\text{val}_{(3,1,2)}=9,\text{val}_{(3,2,1)}=18$$

所以当 $m=0$ 时答案为 $1$，$m=1$ 时为 $5$， $m=2$ 时为 $15$，$m=3$ 时为 $18$。

### 数据范围

| 子任务编号 | 分值 | $n\leq $ | $k\leq $ |
| :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $6$ |  |
| Subtask 2 | $12$ | $40$ |  |
| Subtask 3 | $1$ | $998244352$ | $1$ |
| Subtask 4 | $16$ | $998244352$ | $10$ |
| Subtask 5 | $24$ | $2\times 10^5$ |  |
| Subtask 6 | $46$ | $998244352$ |  |

对于 $100\%$ 的数据，$2\leq n\leq 998244352$，$1\leq k\leq \min(2\times 10^5,\frac{n(n-1)}{2})。$


---


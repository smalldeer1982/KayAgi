---
title: "[COTS 2016] 建造费 Pristojba"
layout: "post"
diff: 省选/NOI-
pid: P11307
tag: ['2016', '线段树', '生成树', '生成树的另类算法', '特殊生成树', 'ST 表', 'COCI（克罗地亚）']
---
# [COTS 2016] 建造费 Pristojba
## 题目背景

译自 [Izborne Pripreme 2016 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2016/) D2T2。$\texttt{5s,0.5G}$。

## 题目描述


有一张 $n$ 个点的简单无向图 $G$。

给定数列 $p$，边 $(i,j)$（$i\neq j$）的边权为 $p_i+p_j$。

然而，不是所有 $i,j$ 间都有边连接。给定 $m$ 个三元组形如 $x,l,r$，表示「$\forall l\le y\le r$，$x,y$ 间有边连接」。

求出这张无向图的[最小生成树](https://www.luogu.com.cn/user/398152)的边权和。

## 输入格式


第一行，两个正整数 $n,m$。

第二行，$n$ 个非负整数 $p_1,\cdots,p_n$。

接下来 $m$ 行，每行三个正整数 $x,l,r$。

**不保证三元组两两不同**，但保证 $x\not\in [l,r]$。

**输入数据保证有解。**
## 输出格式

输出一行一个整数，表示答案。

## 样例

### 样例输入 #1
```
4 4
2 4 1 0
1 2 3
1 3 4
3 1 1
4 1 2
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
6 8
3 5 8 2 9 4
3 1 2
6 3 3
3 1 1
6 2 2
2 3 6
3 1 2
3 2 2
4 1 1
```
### 样例输出 #2
```
46
```
### 样例输入 #3
```
12 10
9 2 7 5 5 9 3 6 5 7 8 8
6 3 3
9 1 1
6 10 11
1 3 11
5 6 12
3 5 5
12 3 7
6 1 4
4 6 6
10 4 6
```
### 样例输出 #3
```
126
```
## 提示



对于 $100\%$ 的数据，保证：
- $1\le n,m\le  10^5$；
- $0\le p_i\le 10^6$；
- $1\le x\le n$；
- $1\le l\le r\le n$，$x\not\in [l,r]$；
- 存在一组解。


| 子任务编号 | $n,m\le  $ |  得分 |  
| :--: | :--: | :--: | 
| $ 1 $    | $ 10^3$  |   $ 20 $   |  
| $ 2 $    | $ 10^5 $  | $ 80 $   |  



---

---
title: "[蓝桥杯 2024 国 Java B] 最优路径"
layout: "post"
diff: 省选/NOI-
pid: P12259
tag: ['2024', '生成树', '线性基', '蓝桥杯国赛']
---
# [蓝桥杯 2024 国 Java B] 最优路径
## 题目描述

给出一个具有 $N$ 个点、$M$ 条边的无向图（可能存在重边和自环）。其中每条边都有一个 $w$ 属性表示无向边的权重。

你可以从这个图中任意选两个不同的点 $start$、$end$，并以 $start$ 作为起点，$end$ 作为终点找出一条从 $start$ 到 $end$ 的路径（这条路径可以多次经过同一个点，也可以多次经过同一条边），将这条路径上经过的所有边的权重求一个异或和便得到了这条路径的风险值。

小蓝想要找到一条风险值最小的路径，请问最小的风险值是多少？
## 输入格式

第一行输入两个整数 $N$，$M$。

接下来输入 $M$ 行，每行三个整数 $u$、$v$、$w$，表示一条无向边连接 $u$、$v$ 两个点，权重为 $w$。
## 输出格式

输出一个整数表示最小的风险值。如果不存在任何一条满足题意的路径，输出 $-1$。
## 样例

### 样例输入 #1
```
3 4
1 1 9
2 3 3
2 3 8
3 3 1
```
### 样例输出 #1
```
2
```
## 提示

### 样例说明

先走第二条边，再走第四条边，风险值 $3 \oplus 1 = 2$。

### 评测用例规模与约定

- 对于 $60\%$ 的评测用例，$1 \leq N \leq 50$，$1 \leq M \leq 10^3$。
- 对于 $100\%$ 的评测用例，$1 \leq N \leq 500$，$1 \leq M \leq 10^4$，$1 \leq u, v \leq N$，$1 \leq w \leq 10^3$。


---

---
title: "[POI 2017 R3] 奇偶路口 Crossroads of parity"
layout: "post"
diff: 省选/NOI-
pid: P12758
tag: ['2017', 'POI（波兰）', '生成树', '位运算']
---
# [POI 2017 R3] 奇偶路口 Crossroads of parity
## 题目背景

翻译来自于 [LibreOJ](https://loj.ac/p/5066)。
## 题目描述

**题目译自 [XXIV Olimpiada Informatyczna — III etap](https://sio2.mimuw.edu.pl/c/oi24-3/dashboard/) [Rozdroża parzystości](https://szkopul.edu.pl/problemset/problem/-7cqC3RrH4e-Ar7DWy4GKzLv/statement/)**

Bajtazar 掌管拜托尼亚王国新设立的公国，辖内有 $n$ 座城市。公国尚在建设初期，尚未修筑任何道路。Bajtazar 规划了 $m$ 条双向道路，每条连接两座城市。若全部建成，可实现任意城市间连通。然而，他缺乏设计经验，道路规划效率低下，每条新路的建设难度远超之前所有道路之和。他估算第 $i$ 条路的建设成本为 $2^i$ 拜托币。

不幸的是，拜托尼亚掀起一股「奇偶」热潮，居民对道路数的奇偶性极度执着。部分城市的居民认为偶数道路象征和谐与平静，要求其城市连出的道路数为偶数；其他城市居民则视奇数为独立与活力的象征，要求道路数为奇数。

Bajtazar 需重新规划，选择部分道路，满足所有城市的奇偶要求，并尽量降低总成本。但拜托尼亚公共采购法有时要求剔除 $k-1$ 个最便宜的方案，因此他需构建满足居民要求的第 $k$ 便宜的道路网。注意，居民不再要求道路网连通所有城市，尽管原计划具备此特性，但奇偶要求可能与之冲突。

更糟的是，拜托尼亚议会频繁修改采购法，变更 $k$ 值，居民也常改变偏好，忽而崇尚偶数，忽而迷恋奇数。Bajtazar 必须随之调整规划。帮助他展现慷慨与高效的治理能力，适应居民多变的需求，设计应建的道路网！
## 输入格式

第一行包含两个整数 $n, m$ $(1 \leq n, m \leq 500000)$，分别表示城市数量和可建道路数量。

接下来的 $m$ 行描述道路，第 $i$ 行包含两个整数 $a_i, b_i$ $(1 \leq a_i, b_i \leq n, a_i \neq b_i)$，表示可建连接城市 $a_i$ 和 $b_i$ 的双向道路，成本为 $2^i$ 拜托币。每对城市至多出现一次。

下一行包含 $n$ 个整数 $p_1, \ldots, p_n$，若 $p_i=0$，第 $i$ 个城市居民偏好偶数道路数；若 $p_i=1$，偏好奇数。

下一行包含整数 $k$ $(1 \leq k \leq 10^{18})$，表示 Bajtazar 考虑第 $k$ 便宜的满足居民要求的道路网（$k=1$ 为最便宜）。不同方案成本均不同。

下一行包含整数 $q$ $(0 \leq q \leq 500000)$，表示查询数量，随后 $q$ 行描述查询。每行包含字符 $c$ 和整数 $v$：
- 若 $c=\texttt{M}$，城市 $v$ $(1 \leq v \leq n)$ 的居民改变偏好（偶变奇，奇变偶）。
- 若 $c=\texttt{K}$，采购法变更，Bajtazar 考虑第 $v$ $(1 \leq v \leq 10^{18})$ 便宜的道路网。
- 若 $c=\texttt{D}$，Bajtazar 询问当前道路网是否包含第 $v$ $(1 \leq v \leq m)$ 条路（成本 $2^v$）。
## 输出格式

第一行输出初始道路网（居民偏好变更前），包含 $m$ 个整数，第 $i$ 个为 $1$ 表示建第 $i$ 条路，为 $0$ 表示不建，保证存在合法方案。

接下来的行对应 $c=\texttt{D}$ 的查询。若当前道路网不存在（因居民偏好变更或方案不足被剔除），输出 $-1$；若存在，输出 $1$ 表示当前方案包含第 $v$ 条路，输出 $0$ 表示不包含。
## 样例

### 样例输入 #1
```
3 3
1 2
2 3
3 1
1 1 0
1
7
D 1
M 2
D 1
M 3
D 2
K 2
D 2
```
### 样例输出 #1
```
1 0 0
1
-1
1
0
```
## 提示

**样例 1 解释**

有三座城市和三条路形成环。最便宜的道路网满足城市 $1,2$ 奇数、城市 $3$ 偶数要求，仅包含路 $1-2$（成本 $2$）。不存在仅一个城市有奇数道路的方案。城市 $1,3$ 奇数、城市 $2$ 偶数的方案有两种：较便宜的包含路 $1-2, 2-3$（成本 $2+4=6$），较贵的包含路 $1-3$（成本 $8$）。

**附加样例**

1. $n=6, m=15, q=50$，每对城市间有路，无 $\texttt{K}$ 类型查询。
2. $n=10, m=10, q=84$，路形成环，$\texttt{D}$ 类型查询时总有两种可行方案。
3. $n=101, m=150$，$50$ 个三角形，每相邻三角形共享一顶点，全为偶数要求，$k=2^{50}$，无查询。

详细子任务附加限制及分值如下表所示。

| 子任务 | 附加限制 | 分值 |
| :---: | :--: | :---: |
| $1$    | $k=1, q=0$（仅最便宜方案，无查询） | $32$ |
| $2$    | $q=0$（无查询）          | $25$ |
| $3$    | 仅 $\texttt{M}$ 或 $\texttt{D}$ 类型查询 | $30$ |
| $4$    | 无附加限制               | $13$ |


---

---
title: "[GDCPC 2024] 图"
layout: "post"
diff: 省选/NOI-
pid: P13356
tag: ['图论', '二分', '2024', '广东', 'Special Judge', '生成树', 'XCPC']
---
# [GDCPC 2024] 图
## 题目背景

数据、标程、题解等资源的获取：<https://gitlink.org.cn/thusaa/gdcpc2024>
## 题目描述

给定一张 $n$ 个点 $m$ 条边的无向图，令 $k=\lceil\frac{m}{n-1}\rceil$，你需要判断能否找到两个不同的点 $u,v$，满足它们之间存在 $k$ 条**边不相交**路径，如果可以找到这样的 $u,v$，你需要输出这些路径，如果存在多种构造方案，输出任意一种即可。

额外需要注意的是输入**可能存在重边**，也就是对于同一个无序对 $(u,v)$，它们之间可能存在多条边，如果它们之间存在 $s$ 条边那么你可以理解为这条边可以经过 $s$ 次。

不过我们保证输入**不存在自环**。
## 输入格式

**本题包含多组输入数据。**

输入第一行一个正整数 $T(1\le T\le 10^4)$ 表示数据组数。

对于每组输入数据，第一行输入两个正整数 $n,m(2\le n\le 10^5,1\le m\le 2\times 10^5)$ 表示点数和边数，接下来 $m$ 行每行两个正整数 $u,v(1\le u,v\le n,u\not=v)$ 描述 $u,v$​ 间存在的一条边。

保证 $\sum n\le 10^5$，$\sum m\le 2\times 10^5$。其中 $\sum n,\sum m$ 分别表示同一个测试点内所有输入数据的 $n,m$ 之和。
## 输出格式

对于每组输入数据，如果不存在这样的 $u,v$，那么输出一行一个整数 `-1`，否则先输出一行两个正整数 $u,v$ 表示你找到的两个点，接下来输出 $k=\lceil\frac{m}{n-1}\rceil$ 行，每行第一个正整数 $t$ 描述你选出来的路径长度，接下来 $t$ 个正整数 $x_1,x_2,\dots,x_t$，表示你选择了 $x_1\to x_2\to\cdots\to x_t$ 这条路径，你需要保证 $x_1=u$ 且 $x_t=v$。且你需要保证输出的 $k$ 条路径满足边不相交的条件。
## 样例

### 样例输入 #1
```
3
3 1
1 3
4 7
1 2
2 3
3 4
4 1
1 3
2 4
1 4
5 5
1 2
2 3
3 4
4 5
3 5
```
### 样例输出 #1
```
1 3
2 1 3
1 4
4 1 2 3 4
2 1 4
2 1 4
3 5
3 3 4 5
2 3 5
```
## 提示

第一组输入数据，存在 $\lceil\frac{m}{n-1}\rceil=\lceil\frac{1}{3-1}\rceil=1$ 条 $1$ 到 $3$ 的边不相交路径 $1\to 3$。

第二组输入数据，存在 $\lceil\frac{m}{n-1}\rceil=\lceil\frac{7}{4-1}\rceil=3$ 条 $1$ 到 $4$ 的边不相交路径 $1\to 2\to 3\to 4,1\to 4,1\to 4$，注意到 $1\to 4$ 这条边虽然经过了两次，但是在原输入中这条边也输入了两次，所以认为它们还是不同的边。

第三组输入数据，存在 $\lceil\frac{m}{n-1}\rceil=\lceil\frac{5}{5-1}\rceil=2$ 条 $3$ 到 $5$ 的边不相交路径 $3\to 4\to 5,3\to 5$。


---

---
title: "[NOI2014] 魔法森林"
layout: "post"
diff: 省选/NOI-
pid: P2387
tag: ['2014', 'NOI', '生成树', '动态树 LCT']
---
# [NOI2014] 魔法森林
## 题目背景

[hack数据的提交link](https://www.luogu.com.cn/problem/U163126)
## 题目描述

为了得到书法大家的真传，小 E 同学下定决心去拜访住在魔法森林中的隐士。魔法森林可以被看成一个包含 $n$ 个节点 $m$ 条边的无向图，节点标号为 $1,2,3,…,n$，边标号为 $1,2,3,…,m$。初始时小 E 同学在 $1$ 号节点，隐士则住在 $n$ 号节点。小 E 需要通过这一片魔法森林，才能够拜访到隐士。

魔法森林中居住了一些妖怪。每当有人经过一条边的时候，这条边上的妖怪 就会对其发起攻击。幸运的是，在 $1$ 号节点住着两种守护精灵：A 型守护精灵与 B 型守护精灵。小 E 可以借助它们的力量，达到自己的目的。

只要小 E 带上足够多的守护精灵，妖怪们就不会发起攻击了。具体来说，无向图中的每一条边 $e_i$ 包含两个权值 $a_i$ 与 $b_i$ 。若身上携带的 A 型守护精灵个数不少于 $a_i$ ，且 B 型守护精灵个数不少于 $b_i$ ，这条边上的妖怪就不会对通过这条边的人发起攻击。当且仅当通过这片魔法森林的过程中没有任意一条边的妖怪向 小 E 发起攻击，他才能成功找到隐士。

由于携带守护精灵是一件非常麻烦的事，小 E 想要知道，要能够成功拜访到 隐士，最少需要携带守护精灵的总个数。守护精灵的总个数为 A 型守护精灵的个数与 B 型守护精灵的个数之和。

## 输入格式

输入文件的第 $1$ 行包含两个整数 $n,m$，表示无向图共有 $n$ 个节点，$m$ 条边。 接下来 $m$ 行，第 $i+1$ 行包含 $4$ 个正整数 $X_i,Y_i,a_i,b_i$，描述第 $i$ 条无向边。 其中 $X_i$ 与 $Y_i$ 为该边两个端点的标号，$a_i$ 与 $b_i$ 的含义如题所述。 注意数据中可能包含重边与自环。

## 输出格式

输出一行一个整数：如果小 E 可以成功拜访到隐士，输出小 E 最少需要携 带的守护精灵的总个数；如果无论如何小 E 都无法拜访到隐士，输出 `-1`。

## 样例

### 样例输入 #1
```
4 5 
1 2 19 1 
2 3 8 12 
2 4 12 15 
1 3 17 8 
3 4 1 17 
```
### 样例输出 #1
```
32

```
### 样例输入 #2
```
3 1 
1 2 1 1 
```
### 样例输出 #2
```
-1
```
## 提示

\* 解释1

如果小 E 走路径 $1\to 2\to 4$，需要携带 $19+15=34$ 个守护精灵； 如果小 E 走路径 $1\to 3\to 4$，需要携带 $17+17=34$ 个守护精灵； 如果小 E 走路径 $1\to 2\to 3\to 4$，需要携带 $19+17=36$ 个守护精灵； 如果小 E 走路径  $1\to 3\to 2\to 4$，需要携带 $17+15=32$ 个守护精灵。 综上所述，小 E 最少需要携带 $32$ 个守护精灵。

\* 解释2

小 E 无法从 $1$ 号节点到达 $3$ 号节点，故输出 `-1`。

![](https://cdn.luogu.com.cn/upload/pic/2593.png)



---

---
title: "[JSOI2008] 小店购物"
layout: "post"
diff: 省选/NOI-
pid: P2792
tag: ['图论', '2008', '各省省选', '江苏', '生成树']
---
# [JSOI2008] 小店购物
## 题目背景

JSOI集训队的队员发现，在他们经常活动的集训地，有一个小店因为其丰富的经营优惠方案深受附近居民的青睐，生意红火。

## 题目描述

小店的优惠方案十分简单有趣：

一次消费过程中，如您在本店购买了精制油的话，您购买香皂时就可以享受 $2.00$ 元 / 块的优惠价；如果您在本店购买了香皂的话，您购买可乐时就可以享受 $1.50$ 元 / 听的优惠价……诸如此类的优惠方案可概括为：如果您在本店购买了商品 $A$ 的话，您就可以以 $P$ 元 / 件的优惠价格购买商品 $B$（购买的数量不限）。

有趣的是，你需要购买同样一些商品，由于不同的买卖顺序，老板可能会叫你付不同数量的钱。比如你需要一块香皂（原价 $2.50$ 元）、一瓶精制油（原价 $10.00$ 元）、一听可乐（原价 $1.80$ 元），如果你按照可乐、精制油、香皂这样的顺序购买的话，老板会问你要 $13.80$ 元；而如果你按照精制油、香皂、可乐这样的顺序购买的话，您只需付 $13.50$ 元。

该处居民发现 JSOI 集训队的队员均擅长电脑程序设计，于是他们请集训队的队员编写一个程序：在告诉你该小店商品的原价，所有优惠方案及所需的商品后，计算至少需要花多少钱（不允许购买任何不必要的商品，即使这样做可能使花的钱更少）。
## 输入格式

输入文件第一行为一个整数 $n\ (1 \le n \le 50)$，表示小店的商品总数。

接下来是 $n$ 行，其中第 $i+1$ 行由一个实数 $c_i\ (0<c_i \le 1000)$ 和一个整数 $m_i\ (0 \le m_i \le 100)$ 组成，其间由一个空格分隔，分别表示第 $i$ 种商品的原价和所需数量。第 $n+2$ 行又是一个整数 $k\ (1 \le k \le 500)$，表示小店的优惠方案总数。

接着 $k$ 行，每行有二个整数 $A,B(1 \le A,B \le n)$ 和一个实数 $P(0 \le P<1000)$，表示一种优惠方案，即如果您购买了商品 $A$，您就可以以 $P$ 元 / 件的优惠价格购买商品 $B$，$P$ 小于商品 $B$ 的原价。所有优惠方案的 $(A,B)$ 都是不同的。为了方便老板不收分币，所以所有价格都不出现单位分。
## 输出格式

输出只有一个实数，表示最少需要花多少钱。输出实数须保留两位小数。

## 样例

### 样例输入 #1
```
4
10.00 1
1.80 1
3.00 0
2.50 2
2
1 4 2.00
4 2 1.50
```
### 样例输出 #1
```
15.50
```
## 提示

数据范围见输入格式



---

---
title: "[USACO08OPEN] Cow Neighborhoods G"
layout: "post"
diff: 省选/NOI-
pid: P2906
tag: ['2008', 'USACO', '并查集', '平衡树', '生成树']
---
# [USACO08OPEN] Cow Neighborhoods G
## 题目描述

了解奶牛的人都知道奶牛是如何组成「奶牛社区」的。他们观察了 Farmer John 的 $N$ 头奶牛（编号为 $1 \sim N$），它们在 $X$ 和 $Y$ 坐标范围为 $1$ 的牧场上放牧，每头奶牛都在自己唯一的整数直线坐标上。

如果满足以下两个标准中的至少一个，则两头奶牛是邻居：

1. 两只奶牛的曼哈顿距离不超过 $C$，即 $|X_i - x_i| + |Y_i - y_i| \leq C$；
2. 两只奶牛有共同的邻居。即存在一只奶牛 $k$，使 $i$ 与 $k$，$j$ 与 $k$ 均同属一个群。

给定奶牛的位置和距离 $C$，确定「奶牛社区」的数量和最大的「奶牛社区」中的奶牛数量。

例如，考虑下面的牧场。 当 $C = 4$ 时，这个牧场有四个社区：左边的一个大社区，两个大小为 1 的社区，右边有一个巨大的社区，里面有 $60$ 头不同的奶牛。

```text
.....................................*.................
....*...*..*.......................***.................
......*...........................****.................
..*....*..*.......................*...*.******.*.*.....
........................*.............***...***...*....
*..*..*...*..........................*..*...*..*...*...
.....................................*..*...*..*.......
.....................................*..*...*..*.......
...*................*..................................
.*..*............................*.*.*.*.*.*.*.*.*.*.*.
.*.....*..........................*.*.*.*.*.*.*.*.*.*.*
....*..................................................
```
## 输入格式

第 $1$ 行包含两个用空格分隔的整数 $N, C$。

第 $2$ 到第 $N + 1$ 行每行包含两个用空格分隔的整数 $X_i, Y_i$，表示一头牛的坐标。

## 输出格式


共一行，为两个用空格分隔的整数，为「奶牛社区」的数量和最大的「奶牛社区」内牛的数量。
## 样例

### 样例输入 #1
```
4 2 
1 1 
3 3 
2 2 
10 10 

```
### 样例输出 #1
```
2 3 

```
## 提示

### 样例说明 #1

样例中有 $2$ 个社区，一个由前三头奶牛组成，另一个是最后一头奶牛。因此，最大的社区大小为 $3$。

### 数据范围与约定

对于 $100\%$ 的数据，$1 \leq N \leq 10^5$，$1 \leq C \leq 10^9$，$1 \leq X_i, Y_i \leq 10^9$，$X_i, Y_i$ 均为整数。


---

---
title: "[USACO08NOV] Toys G"
layout: "post"
diff: 省选/NOI-
pid: P2917
tag: ['贪心', '2008', 'USACO', '生成树', '状压 DP']
---
# [USACO08NOV] Toys G
## 题目描述

Bessie's birthday is coming up, and she wishes to celebrate for the next D (1 <= D <= 100,000; 70% of testdata has 1 <= D <= 500) days. Cows have short attention spans so Bessie wants to provide toys to entertain them. She has calculated that she will require T\_i (1 <= T\_i <= 50) toys on day i.

Bessie's kindergarten provides many services to its aspiring bovine programmers, including a toy shop which sells toys for Tc (1 <= Tc <= 60) dollars. Bessie wishes to save money by reusing toys, but Farmer John is worried about transmitting diseases and requires toys to be disinfected before use. (The toy shop disinfects the toys when it sells them.)

The two disinfectant services near the farm provide handy complete services. The first one charges C1 dollars and requires N1 nights to complete; the second charges C2 dollars and requires N2 nights to complete (1 <= N1 <= D; 1 <= N2 <= D; 1 <= C1 <= 60; 1 <= C2 <= 60). Bessie takes the toys to the disinfecters after the party and can pay and pick them back up the next morning if one night service is rendered, or on later mornings if more nights are required for disinfecting.

Being an educated cow, Bessie has already learned the value of saving her money. Help her find the cheapest way she can provide toys for her party.

POINTS: 400

## 输入格式

\* Line 1: Six space-separated integers: D, N1, N2, C1, C2, Tc

\* Lines 2..D+1: Line i+1 contains a single integer: T\_i

## 输出格式

\* Line 1: The minimum cost to provide safe and sanitary toys for Bessie's birthday parties.

## 样例

### 样例输入 #1
```
4 1 2 2 1 3 
8 
2 
1 
6 

```
### 样例输出 #1
```
35 

```
## 提示

Bessie wishes to party for 4 days, and requires 8 toys the first day, 2 toys the second, 1 toy the third, and 6 toys on the fourth day. The first disinfectant service takes 1 day and charges $2, and the second takes 2 days and charges $1. Buying a new toy costs $3.


Day 1   Purchase 8 toys in the morning for $24; party in the

afternoon. Take 2 toys to the fast cleaner (overnight) and 

the other 6 toys to the slow cleaner (two nights). 

Day 2   Pick up the two toys at the fast cleaner; pay $4. Party in the afternoon. Take 1 toy to the slow cleaner. 

Day 3   Pick up 6 toys from the slow cleaner and pay $6. Party in the afternoon.

Day 4   Pick up the final remaining toy from the slow cleaner

(bringing the number of toys onsite back to 6); pay $1. Party hearty with the realization that a minimum amount of money was spent.

## 题目翻译

Bessie 的生日快到了，她希望用 $D$（$1 \le D \le 100000$）天来庆祝。奶牛们的注意力不会太集中，因此 Bessie 想通过提供玩具的方式来使它们高兴。她已经计算出了第 $i$ 天需要的玩具数 $T_i$（$1 \le T_i \le 50$）。

Bessie 的幼儿园给它们的奶牛程序员们提供了许多服务，包括一个每天以 $T_c\ (1 \le T_c \le 60)$ 美元卖出商品的玩具店。Bessie 想尽可能地节省钱。但是 FarmerJohn 担心没有经过消毒的玩具会带来传染病。（玩具店卖出的玩具是经过消毒的）

有两种消毒的方式。

- 第 $1$ 种方式需要收费 $C_1$ 美元，需要 $N_1$ 个晚上的时间；
- 第 $2$ 种方式需要收费 $C_2$ 美元，需要 $N_2$ 个晚上的时间（$1 \le N_1,N_2 \le D$，$1 \le C_1,C_2 \le 60$）。

Bessie 在派对结束之后把她的玩具带去消毒。如果消毒只需要一天，那么第二天就可以拿到；如果还需要一天，那么第三天才可以拿到。

作为一个受过教育的奶牛，Bessie 已经了解到节约的意义。帮助她找到提供玩具的最便宜的方法。


---

---
title: "[HNOI2010] 城市建设"
layout: "post"
diff: 省选/NOI-
pid: P3206
tag: ['2010', '湖南', '分治', '生成树', '动态树 LCT']
---
# [HNOI2010] 城市建设
## 题目描述

PS 国是一个拥有诸多城市的大国。国王 Louis 为城市的交通建设可谓绞尽脑汁。Louis 可以在某些城市之间修建道路，在不同的城市之间修建道路需要不同的花费。

Louis 希望建造最少的道路使得国内所有的城市连通。但是由于某些因素，城市之间修建道路需要的花费会随着时间而改变。Louis 会不断得到某道路的修建代价改变的消息。他希望每得到一条消息后能立即知道使城市连通的最小花费总和。Louis 决定求助于你来完成这个任务。

## 输入格式

第一行包含三个整数 $n,m,q$，分别表示城市的数目，可以修建的道路个数，及收到的消息个数。

接下来 $m$ 行，第 $i+1$ 行有三个用空格隔开的整数 $x_i,y_i,z_i$，表示在城市 $x_i$ 与城市 $y_i$ 之间修建道路的代价为 $z_i$。接下来 $q$ 行，每行包含两个数 $k,d$，表示输入的第 $k$ 个道路的修建代价修改为 $d$（即将 $z_k$ 修改为 $d$）。
## 输出格式

输出包含 $q$ 行，第 $i$ 行输出得知前 $i$ 条消息后使城市连通的最小花费总和。
## 样例

### 样例输入 #1
```
5 5 3
1 2 1
2 3 2
3 4 3
4 5 4
5 1 5
1 6
1 1
5 3
```
### 样例输出 #1
```
14
10
9
```
## 提示

### 数据规模与约定
- 对于 $20\%$ 的数据，$n\le 10^3$，$m,q\le 6\times 10^3$。
- 对于另外 $20\%$ 的数据，$n\le 10^3$，$m\le 5\times 10^4$，$q\le 8\times 10^3$。修改后的代价不会比之前的代价低。
- 对于 $100\%$ 的数据，$1\le n\le 2\times 10^4$，$1\le m,q\le 5\times 10^4$，$1\le x_i,y_i\le n$，$0\le z_i\le 5\times 10^7$。


---

---
title: "[HNOI2016] 矿区"
layout: "post"
diff: 省选/NOI-
pid: P3249
tag: ['2016', '湖南', '枚举', '深度优先搜索 DFS', '生成树']
---
# [HNOI2016] 矿区
## 题目描述

平面上的矿区划分成了若干个开发区域。

简单地说，你可以将矿区看成一张连通的平面图，平面图划分为了若干平面块，每个平面块即为一个开发区域，平面块之间的边界必定由若干整点(坐标值为整数的点)和连接这些整点的线段组成。每个开发区域的矿量与该开发区域的面积有关：具体而言，面积为 $ s $ 的开发区域的矿量为 $ s^2 $。

现在有 $ m $ 个开采计划。每个开采计划都指定了一个由若干开发区域组成的多边形，一个开采计划的优先度被规定为矿量的总和÷开发区域的面积和；例如，若某开采计划指定两个开发区域，面积分别为 $ a $ 和 $ b $，则优先度为 $ (a^2+b^2)/(a+b) $。由于平面图是按照划分开发区域边界的点和边给出的，因此每个开采计划也只说明了其指定多边形的边界，并未详细指明是哪些开发区域（但很明显，只要给出了多边形的边界就可以求出是些开发区域）。

你的任务是求出每个开采计划的优先度。为了避免精度问题，你的答案必须按照分数的格式输出，即求出分子和分母，且必须是最简形式（分子和分母都为整数，而且都消除了最大公约数；例如，若矿量总和是 $ 1.5 $，面积和是 $ 2 $，那么分子应为 $ 3 $，分母应为 $ 4 $；又如，若矿量和是 $ 2 $，面积和是 $ 4 $，那么分子应为 
 $ 1 $，分母应为 $ 2 $）。

由于某些原因，你必须依次对每个开采计划求解（即下一个开采计划会按一定格式加密，加密的方式与上一个开采计划的答案有关）。具体的加密方式见输入格式。
## 输入格式

第一行三个正整数 $ n, m, k $，分别描述平面图中的点和边，以及开采计划的个数。  

接下来 $ n $ 行，第 $ i $ 行 ( $ i = 1, 2, \cdots , n $)有两个整数 $x_i, y_i$,  表示点 $ i $ 的坐标为 $(x_i, y_i)$。  

接下来 $ m $ 行，第 $ i $ 行有两个正整数 $a, b$，表示点 $ a $ 和 $ b $ 之间有一条边。  

接下来一行若干个整数，依次描述每个开采计划。每个开采计划的第一个数 $ c $ 指出该开采计划由开发区域组成的多边形边界上的点的个数为 $ d=(c+P) \bmod n \mathrel{+} 1 $；接下来 $ d $ 个整数，按逆时针方向描述边界上的每一个点：设其中第 $ i $ 个数为 $ z_i $，则第 $ i $ 个点的编号为 $(z_i+P)\bmod n \mathrel{+} 1$。其中 $ P $ 是上一个开采计划的答案中分子的值；对于第 $ 1 $ 个开采计划，$ P = 0 $。
## 输出格式

对于每个开采计划，输出一行两个正整数，分别描述分子和分母。

## 样例

### 样例输入 #1
```
9 14 5
0 0
1 0
2 0
0 1
1 1
2 1
0 2
1 2
2 2
1 2
2 3
5 6
7 8
8 9
1 4
4 7
5 8
3 6
6 9
4 8
1 5
2 6
6 8
3 3 0 4 7 1 3 4 6 4 8 0 4 3 6 2 3 8 0 4 6 2 5 0 4 5 7 6 3
```
### 样例输出 #1
```
1 1 
1 2 
1 1 
9 10 
3 4
```
## 提示

### 样例解释

输入文件给出的 $9$ 个点和 $14$ 条边描述的平面图如下所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/cg70enmo.png)

第一个开采计划，输入的第 $1$ 个值为 $3$，所以该开采计划对应的多边形有 $(3+0)\bmod 8+1=4$ 个点，将接下的 $4$ 个数 $3,0,4,7$，分别代入 $(z_i+0)\bmod n+1$ 得到 $4$ 个点的编号为 $4,1,5,8$。计算出第一个开采计划的分子为 $1$，分母为 $1$。

类似地，可计算出余下开采计划的多边形的点数和点的编号：第二个开采计划对应的多边形有 $3$ 个点，编号分别为 $5,6,8$。第三个开采计划对应的多边形有 $6$ 个点，编号分别为 $1,2,6,5,8,4$。第四个开采计划对应的多边形有 $5$ 个点，编号分别为 $1,2,6,8,4$。第五个开采计划对应的多边形有 $6$ 个点，编号分别为 $1,5,6,8,7,4$。

### 数据范围及约定


对于 $ 100 \% $ 的数据，$ n, k \leq 2 \times 10^5, \  m \leq 3n-6, \  |x_i|, |y_i| \leq 3×10^4$。

所有开采计划的 $ d $ 之和不超过 $2 \times 10^6$。保证任何开采计划都包含至少一个开发区域，且这些开发区域构成一个连通块。

保证所有开发区域的矿量和不超过 $ 2^{63}-1 $。

保证平面图中没有多余的点和边。

保证数据合法。由于输入数据量较大，建议使用读入优化。





---

---
title: "[JLOI2015] 管道连接"
layout: "post"
diff: 省选/NOI-
pid: P3264
tag: ['2015', '吉林', '生成树', '状压 DP']
---
# [JLOI2015] 管道连接
## 题目描述

小铭铭最近进入了某情报部门，该部门正在被如何建立安全的通道连接困扰。该部门有 $n$ 个情报站，用 $1$ 到 $n$ 的整数编号。给出 $m$ 对情报站 $(u_i,v_i)$ 和费用 $w_i$，表示情报站 $u_i$ 和 $v_i$ 之间可以花费 $w_i$ 单位资源建立通道。

如果一个情报站经过若干个建立好的通道可以到达另外一个情报站，那么这两个情报站就建立了通道连接。形式化地，若 $u_i$ 和 $v_i$ 建立了通道，那么它们建立了通道连接；若 $u_i$ 和 $v_i$ 均与 $t_i$ 建立了通道连接，那么 $u_i$ 和 $v_i$ 也建立了通道连接。

现在在所有的情报站中，有 $p$ 个重要情报站，其中每个情报站有一个特定的频道。小铭铭面临的问题是，需要花费最少的资源，使得任意相同频道的情报站之间都建立通道连接。
## 输入格式

第一行包含三个整数 $n,m,p$，表示情报站的数量，可以建立的通道数量和重要情报站的数量。

接下来 $m$ 行，每行包含三个整数 $u_i,v_i,w_i$，表示可以建立的通道。

最后有 $p$ 行，每行包含两个整数 $c_i,d_i$，表示重要情报站的频道和情报站的编号。
## 输出格式

输出一行一个整数，表示任意相同频道的情报站之间都建立通道连接所花费的最少资源总量。

## 样例

### 样例输入 #1
```
5 8 4
1 2 3
1 3 2
1 5 1
2 4 2
2 5 1
3 4 3
3 5 1
4 5 1
1 1
1 2
2 3
2 4
```
### 样例输出 #1
```
4
```
## 提示

选择 $(1,5),(3,5),(2,5),(4,5)$ 这 $4$ 对情报站连接。

对于 $100\%$ 的数据，$1\le c_i\le p\le10$，$1\le u_i,v_i,d_i \le n \le 1000$，$0\le m \le 3000$，$0\le w_i \le2\times 10^4$。


---

---
title: "[SCOI2013] 摩托车交易"
layout: "post"
diff: 省选/NOI-
pid: P3280
tag: ['模拟', '2013', '四川', '倍增', '生成树']
---
# [SCOI2013] 摩托车交易
## 题目描述

mzry1992 在打完吊针出院之后，买了辆新摩托车，开始了在周边城市的黄金运送生意。在 mzry1992 生活的地方，城市之间是用双向高速公路连接的。另外，每条高速公路有一个载重上限，即在不考虑驾驶员和摩托车重量的情况下，如果所载货物的量超过某个值，则不能驶上该条高速公路。

今年，mzry1992 一共收到了来自 $n$ 个不同城市的 $n$ 份定订单，每个订单要求卖出上限为一定量的黄金，或是要求买入上限为一定量的黄金。由于订单并不是同时发来的，为了维护生意上的名声，mzry1992 不得不按照订单发来的顺序与客户进行交易。他与第i 个客户进行交易的具体步骤是：

1. 前往第 $i$ 个客户所在城市。当然，中途是完全允许经过其他城市的。 
2. 与第 $i$ 个客户进行交易，在此过程中他希望有限制的让交易额尽量大。具体的限制有两个：    
(a) 他希望与最后一个客户完成交易后，手上没有剩余黄金。  
(b) 由于黄金是很贵重的物品，不能出现因为买入过多黄金而造成在以后的运送过程中不得不丢弃黄金的情况。

一开始，mzry1992 位于第一个订单客户所在的城市。现在有一个好消息，有人提供了 mzry1992 免费试用周边城市的列车系统的资格。具体来讲，如果mzry1992希望从 $A$ 城市到达 $B$ 城市，且 $A$、$B$ 城市均有列车站的话，他可以携带着黄金与摩托车从 $A$ 城市乘坐列车到 $B$ 城市，这里假定乘坐列车没有载重限制。

现在已知城市间的交通系统情况和订单情况，请帮助 mzry1992 计算每个向 mzry1992 购买黄金的客户的购买量。

## 输入格式

输入的第一行有三个整数 $n,m,q$，分别表示城市数，连通城市的高速公路数和有列车站的城市数。

接下来的一行有 $n$ 个数，每个数均不相同，且值介于 $1$ 到 $n$ 之间，代表订单的顺序。

第三行有 $n$ 个数，第 $i$ 个数表示 $i$ 号城市的订单的上限额 $b_i$，$b_i$ 为正值表示该订单为买入交易（针对mzry1992 而言），上限为 $b_i$，$b_i$ 为负值表示该订单为卖出交易（同样针对mzry1992 而言）上限为 $-b_i$。

接下来的 $m$ 行每行有三个数，$u, v, w$，表示城市 $u$ 和城市 $v$ 之间有一条载重上限为 $w$ 的高速公路，这里假定所有高速公路都是双向的，城市的序号是从 $1$ 到 $n$ 的。

输入的最后一行有 $q$ 个数，代表有列车站城市的序号。

## 输出格式

按照订单顺序对于每个卖出交易，输出一行，该行只有一个整数 $x$，表示卖出黄金的量。

## 样例

### 样例输入 #1
```
Sample #1
3 3 2
2 3 1
-6 5 -3
1 3 5
2 3 2
2 1 6
1 3

```
### 样例输出 #1
```
3
2


```
### 样例输入 #2
```
4 4 0
1 2 3 4
5 4 -6 -1
1 2 4
2 3 100
3 4 1
4 1 4
```
### 样例输出 #2
```
6
1 

```
## 提示

### 样例解释

第一组样例：其中一种合法的方案是最初从 $2$ 号城市买入 $5$ 单位的黄金，先走第三条高速公路到 $1$ 号城市，然后再坐列车到 $3$ 号城市，在 $3$ 号城市卖出 $3$ 单位的黄金，然后乘坐列车到 $1$ 城市，在 $1$ 号城市卖出 $2$ 单位的黄金。


第二组样例：其中一种合法的方案是最初从 $1$ 号城市买入 $4$ 单位的黄金，走第一条高速公路，在 $2$ 号城市买入 $3$ 单位的黄金，走第二条高速公路，在三城市点卖出 $6$ 单位的黄金，走第三条高速公路，在 $4$ 号城市卖出 $1$ 单位的黄金。

### 数据范围与约定

- 对于 $20\%$ 数据，$n \le 100$，$m \le 200$。
- 对于 $50\%$ 数据，$n \le 3000$，$m \le 6000$。
- 对于 $100\%$ 数据，$1 \le n \le 10^5$，$n - 1 \le m \le 2\times 10^5$，$0 \le q \le n$，$0 < |b_i| < 10^9$，$0 < w < 10^9$，保证任意两个城市之间是通过高速公路连通的。



---

---
title: "[SDOI2014] 重建"
layout: "post"
diff: 省选/NOI-
pid: P3317
tag: ['2014', '矩阵树定理', '山东', 'Special Judge', '生成树', '期望']
---
# [SDOI2014] 重建
## 题目描述

T 国有 $N$ 个城市，用若干双向道路连接。一对城市之间至多存在一条道路。    

在一次洪水之后，一些道路受损无法通行。虽然已经有人开始调查道路的损毁情况，但直到现在几乎没有消息传回。    

幸运的是，此前 T 国政府调查过每条道路的强度，现在他们希望只利用这些信息估计灾情。具体地，给定每条道路在洪水后仍能通行的概率，请计算仍能通行的道路恰有 $N-1$ 条，且能联通所有城市的概率。

## 输入格式

输入的第一行包含整数 $N$。  

接下来 $N$ 行，每行 $N$ 个实数，第 $i+1$ 行，列的数 $G_{i,j}$ 表示城市 $i$ 与 $j$ 之间仍有道路联通的概率。    

输入保证 $G_{i,j}=G_{j,i}$，且 $G_{i,i}=0$。$G_{i, j}$ 至多包含两位小数。

## 输出格式

输出一个任意位数的实数表示答案。    

你的答案与标准答案相对误差不超过 $10^{-4}$ 即视为正确。

## 样例

### 样例输入 #1
```
3
0 0.5 0.5
0.5 0 0.5
0.5 0.5 0
```
### 样例输出 #1
```
0.375
```
## 提示

$1<N\leq 50$。

数据保证答案非零时，答案不小于 $10^{-4}$。



---

---
title: "[POI 2005] KOS-Dicing"
layout: "post"
diff: 省选/NOI-
pid: P3425
tag: ['2005', 'POI（波兰）', '网络流', 'Special Judge', '生成树', '最小割']
---
# [POI 2005] KOS-Dicing
## 题目描述

Dicing is a two-player game and its outcome is fully random. Lately its popularity increases all over Byteotia. There is even a special club for dicing amateurs in the capital city of Byteotia. The club patrons take their time talking to each other and playing their favourite game with a randomly chosen opponent every once in a while. Everyone who wins the most games one day gains the title of the lucky chap. Sometimes it happens that the night at the club is a quiet one and only few games are played. It is a time when even one win can make you a lucky chap.

Once upon a time a most unlucky fellow, Byteasar, won the glorious title. He was so deeply shocked that he completely forgot how many games he had won. Now he is wondering how good his luck was and whether fortune finally smiled upon him - perhaps his luck changed for good? He knows exactly how many games and between whom were played that lucky night. However, he does not know the results. Byteasar desires to find out what is the smallest number of wins that could provide the title of the lucky chap. Be a good fellow and help him satisfy his curiosity!

TaskWrite a programme that:

for each game played reads from the standard input the pair of players who competed in it.

finds the smallest number $k$, such that a set of games' outcomes exists in which each player wins $k$ games at the most,writes the number $k$ and the results of games in the found set to the standard output.

Dicing 是一个两人玩的游戏,这个游戏在Byteotia非常流行. 甚至人们专门成立了这个游戏的一个俱乐部. 俱乐部的人时常在一起玩这个游戏然后评选出玩得最好的人.现在有一个非常不走运的家伙,他想成为那个玩的最好的人,他现在知道了所有比赛的安排,他想知道,在最好的情况下,他最少只需要赢几场就可以赢得冠军,即他想知道比赛以后赢的最多的那个家伙最少会赢多少场.

## 输入格式

In the first line of the standard input there is a pair of integers $n$ and $m$ separated by a single space, $1\le n\le 10000$, $0\le m\le 10000$; $n$ denotes the number of players, while $m$ is the number of games. The players are numbered from $1$ to $n$. In the following $m$ lines there are pairs of players' numbers depicting the sequence of games, separated by single spaces. One pair may occur many times in the sequence.

## 输出格式

The first line of the standard output should contain the determined number $k$. For each pair of players' numbers $a$, $b$ specified in the $i$'th line of the input, in the $i$'th line of the output the number $1$ should be written if the player no. $a$ wins against player no. $b$ in the found set of outcomes, or $0$ otherwise.

## 样例

### 样例输入 #1
```
4 4
1 2
1 3
1 4
1 2
```
### 样例输出 #1
```
1
0
0
0
1
```
## 题目翻译

描述

掷骰子是一种双人游戏，它的结果是完全随机的。最近它在整个Byteotia变得非常流行。在Byteotia的首都甚至有一个特别的掷骰子业余爱好者俱乐部。俱乐部的老主顾们花时间互相聊天并每隔一阵子就和一个随机选择的对手玩这他们最喜欢的游戏。一天中赢得最多游戏的人会得到“幸运者”头衔。有时晚上俱乐部很安静，只有很少的比赛。这是哪怕赢一场也能获得“幸运者”头衔的时间。

很久很久以前有一个很不走运的人，叫Byteasar，赢得了这个光荣的头衔。他被深深地震惊了以至于完全忘了他已经赢了多少场。现在他想知道他有多幸运，以及幸运之神是否最终会向他微笑——也许他的运气会变好？他确切地知道在那个幸运的晚上有多少场游戏以及是谁玩的。然而，他不知道结果。Byteasar希望查明至少要赢几场才能获得“幸运者”头衔。做个好人，帮他满足他的好奇心吧！

任务：写一个程序：

对于每场游戏从stdin读入这场游戏的一对玩家 找到最小的数k，使得存在一个游戏结果的集合，其中赢最多的玩家赢了k场。向stdout输出数k和找到的集合中游戏的结果

输入

stdin的第一行有一个一对由一个空格分开整数n和m (1 <= n, m <= 10000) 。n表示玩家数，m表示游戏数。玩家从1到n编号。在接下来的m行中有每场游戏的一对玩家的编号，由一个空格分开，描述了游戏的序列。一对玩家可能会在这个序列中多次出现。

输出

stdout的第一行应该包含一个确定的数k。对于在输入的第i行指定的一对玩家a, b，如果在找到的结果集合中a胜过b，则在输出的第i行输出1, 否则输出0.

感谢 @zyt1253679098  提供的翻译。


---

---
title: "[APIO2008] 免费道路"
layout: "post"
diff: 省选/NOI-
pid: P3623
tag: ['2008', '并查集', 'APIO', 'Special Judge', '背包 DP', '生成树']
---
# [APIO2008] 免费道路
## 题目描述

 
新亚（New Asia）王国有 N 个村庄，由 M 条道路连接。其中一些道路是鹅卵石路，而其它道路是水泥路。保持道路免费运行需要一大笔费用，并且看上去 王国不可能保持所有道路免费。为此亟待制定一个新的道路维护计划。

国王已决定保持尽可能少的道路免费，但是两个不同的村庄之间都应该一条且仅由一条 且仅由一条免费道路的路径连接。同时，虽然水泥路更适合现代交通的需 要，但国王也认为走在鹅卵石路上是一件有趣的事情。所以，国王决定保持刚好 K 条鹅卵石路免费。

举例来说，假定新亚王国的村庄和道路如图 3(a)所示。如果国王希望保持两 条鹅卵石路免费，那么可以如图 3(b)中那样保持道路(1, 2)、(2, 3)、(3, 4)和(3, 5) 免费。该方案满足了国王的要求，因为：(1)两个村庄之间都有一条由免费道 路组成的路径；(2)免费的道路已尽可能少；(3)方案中刚好有两条鹅卵石道路 (2, 3)和(3, 4)

 ![](https://cdn.luogu.com.cn/upload/pic/4393.png) 

图 3: (a)新亚王国中村庄和道路的一个示例。实线标注的是水泥路，虚线标注 的是鹅卵石路。(b)一个保持两条鹅卵石路免费的维护方案。图中仅标出了免 费道路。


给定一个关于新亚王国村庄和道路的述以及国王决定保持免费的鹅卵石 道路数目，写一个程序确定是否存在一个道路维护计划以满足国王的要求，如果 存在则任意输出一个方案。

## 输入格式

输入第一行包含三个由空格隔开的整数：

N，村庄的数目(1≤N≤20,000)；

M，道路的数目(1≤M≤100,000)；

K，国王希望保持免费的鹅卵石道路数目(0≤K≤N - 1)。

此后 M 行述了新亚王国的道路，编号分别为 1 到 M。第(i+1)行述了第 i 条 道路的情况。用 3 个由空格隔开的整数述：

ui 和 vi，为第 i 条道路连接的两个村庄的编号，村庄编号为 1 到 N；

ci，表示第 i 条道路的类型。ci = 0 表示第 i 条道路是鹅卵石路，ci = 1 表 示第 i 条道路是水泥路。

输入数据保证一对村庄之间至多有一条道路连接

## 输出格式

如果满足国王要求的道路维护方案不存在，你的程序应该在输出第一行打印 no solution。 否则，你的程序应该输出一个符合要求的道路维护方案，也就是保持免费的 道路列表。按照输入中给定的那样输出免费的道路。如果有多种合法方案，你可 以任意输出一种。

## 样例

### 样例输入 #1
```
5 7 2 
1 3 0 
4 5 1 
3 2 0 
5 3 1 
4 3 0 
1 2 1 
4 2 1
```
### 样例输出 #1
```
3 2 0 
4 3 0 
5 3 1 
1 2 1 
```


---

---
title: "[APIO2013] 道路费用"
layout: "post"
diff: 省选/NOI-
pid: P3639
tag: ['2013', 'APIO', '生成树', '连通块', '强连通分量']
---
# [APIO2013] 道路费用
## 题目描述

幸福国度可以用 N 个城镇（用 1 到 N 编号）构成的集合来描述，这些城镇 最开始由 M 条双向道路（用 1 到 M 编号）连接。城镇 1 是中央城镇。保证一个 人从城镇 1 出发，经过这些道路，可以到达其他的任何一个城市。这些道路都是 收费道路，道路 i 的使用者必须向道路的主人支付 ci分钱的费用。已知所有的这 些ci是互不相等的。最近有K条新道路建成，这些道路都属于亿万富豪Mr. Greedy。 Mr. Greedy 可以决定每条新道路的费用（费用可以相同），并且他必须在明天宣 布这些费用。

两周以后，幸福国度将举办一个盛况空前的嘉年华！大量的参与者将沿着这 些道路游行并前往中央城镇。共计 pj个参与者将从城镇 j 出发前往中央城镇。这 些人只会沿着一个选出的道路集合前行，并且这些选出的道路将在这件事的前一 天公布。根据一个古老的习俗，这些道路将由幸福国度中最有钱的人选出，也就 是 Mr. Greedy。同样根据这个习俗，Mr. Greedy 选出的这个道路集合必须使所有 选出道路的费用之和最小，并且仍要保证任何人可以从城镇 j 前往城镇 1（因此， 这些选出的道路来自将费用作为相应边边权的“最小生成树”）。如果有多个这样 的道路集合，Mr. Greedy 可以选其中的任何一个，只要满足费用和是最小的。

Mr. Greedy 很明确地知道，他从 K 条新道路中获得的收入不只是与费用有 关。一条道路的收入等于所有经过这条路的人的花费之和。更准确地讲，如果 p 个人经过道路 i，道路 i 产生的收入为 ci p 的积。注意 Mr. Greedy 只能从新道路 收取费用，因为原来的道路都不属于他。

Mr. Greedy 有一个阴谋。他计划通过操纵费用和道路的选择来最大化他的收 入。他希望指定每条新道路的费用（将在明天公布），并且选择嘉年华用的道路 （将在嘉年华的前一天公布），使得他在 K 条新道路的收入最大。注意 Mr. Greedy 仍然需要遵循选出花费之和最小的道路集合的习俗。

你是一个记者，你想揭露他的计划。为了做成这件事，你必须先写一个程序 来确定 Mr. Greedy 可以通过他的阴谋获取多少收入。

## 输入格式

你的程序必须从标准输入读入。第一行包含三个由空格隔开的整数 N，M 和 K。接下来的 M 行描述最开始的 M 条道路。这 M 行中的第 i 行包含由空格隔开 的整数 ai，bi和 ci，表示有一条在 ai 和 bi之间，费用为 ci 的双向道路。接下来的 K 行描述新建的 K 条道路。这 K 行中的第 i 行包含由空格隔开的整数 xi和 yi，表 示有一条连接城镇 xi 和 yi 新道路。最后一行包含 N 个由空格隔开的整数，其中 的第 j 个为 pj，表示从城镇 j 前往城镇 1 的人数。

输入也满足以下约束条件。 

1 ≤ N ≤ 100000； 

1 ≤ K ≤ 20； 

1 ≤ M ≤ 300000； 

对每个 i 和 j，1 ≤ ci, pj ≤ 10^6；


如果 i ≠ i'，则 ci ≠ ci'； 

在任意两个城市之间，最多只有一条道路（包括新建的道路）。

## 输出格式

你的程序必须输出恰好一个整数到标准输出，表示能获得的最大的收入。

## 样例

### 样例输入 #1
```
5 5 1 
3 5 2 
1 2 3 
2 3 5 
2 4 4 
4 3 6 
1 3 
10 20 30 40 50
```
### 样例输出 #1
```
400
```
## 提示

在样例中，Mr. Greedy 应该将新道路(1,3)的费用设置为 5 分钱。在这个费用 下，他可以选择道路(3,5)，(1,2)，(2,4)和(1,3)来最小化总费用，这个费用为 14。 从城镇 3 出发的 30 个人和从城镇 5 出发的 50 个人将经过新道路前往城镇 1，因 此他可以获得为(30+50)×5=400 分钱的最好收入。

如果我们这样做，将新道路(1,3)的费用设置为 10 分钱。根据传统的限制， Mr. Greedy 必须选择(3,5)，(1,2)，(2,4)和(2,3)，因为这是唯一费用最小的集合。 因此，在嘉年华的过程中道路(1,3)将没有任何收入。


我们将使用以下 5 类测例测试你的程序。

1. （国际 16 分，国内 15 分）N ≤ 10，M ≤ 20 且 K = 1；

2. （国际 18 分，国内 20 分）N ≤ 30，M ≤ 50 且 K ≤ 10；

3. （国际 22 分，国内 20 分）N ≤ 1,000，M ≤ 5,000 且 K ≤ 10；

4. （国际 22 分，国内 20 分）N ≤ 100,000，M ≤ 300,000 且 K ≤ 15；

5. （国际 22 分，国内 25 分）N ≤ 100,000，M ≤ 300,000 且 K ≤ 20。

**update: 2024/07/04 删除了两个测试点，并且改为捆绑。**



---

---
title: "[USACO17OPEN] Switch Grass P"
layout: "post"
diff: 省选/NOI-
pid: P3665
tag: ['2017', '线段树', 'USACO', 'Kruskal 重构树', '生成树']
---
# [USACO17OPEN] Switch Grass P
## 题目描述

Farmer John has recently been experimenting with cultivating different types of grass on his farm, realizing that different types of cows like different types of grass. However, he must be careful to ensure that different types of grass are planted sufficiently far away from each-other, in order to prevent them from being inextricably mixed.


FJ's farm consists of $N$ fields ($1 \leq N \leq 200,000$), where $M$ pairs of  fields are connected by bi-directional pathways ($1 \leq M \leq 200,000$).  Using these pathways, it is possible to walk from any field to any other field. Each pathway has an integer length in the range $1 \ldots 1,000,000$. Any pair of fields will be linked by at most one direct pathway.


In each field, FJ initially plants one of $K$ types of grass ($1 \leq K \leq N$). Over time, however, he might decide to switch the grass in some field to a different type. He calls this an "update"  peration. He might perform several updates over the course of time, which are all cumulative in nature.


After each update, FJ would like to know the length of the shortest path between two fields having different grass types. That is, among all pairs of fields having different grass types, he wants to know which two are closest. Ideally,

this number is large, so he can prevent grass of one type from mixing with grass of another type. It is guaranteed that the farm will always have at least two fields with different grass types.


In 30 percent of the input cases, each field will be directly connected to at most 10 pathways.



## 输入格式

The first line of input contains four integers, $N$, $M$, $K$, and $Q$, where $Q$ is the number of updates ($1 \leq Q \leq 200,000$).

The next $M$ lines describe the paths; each one contains three integers $A$, $B$, and $L$, indicating a path from field $A$ to field $B$ (both integers in the range $1 \ldots N$) of length $L$.

The next line indicates the initial type of grass growing in each field ($N$ integers in the range $1 \ldots K$).

Finally, the last $Q$ lines each describe an update, specified by two integers $A$ and $B$, where the grass in field $A$ is to be updated to type $B$.

## 输出格式

For each update, print the length of the shortest path between two fields with different types of grass, after the update is applied.

## 样例

### 样例输入 #1
```
3 2 3 4
1 2 3
2 3 1
1 1 2
3 3
2 3
1 2
2 2
```
### 样例输出 #1
```
1
3
3
1
```
## 题目翻译

### 题目描述

Farmer John 最近在他的农场尝试种植不同类型的草，发现不同类型的奶牛喜欢不同类型的草。然而，他必须小心确保不同类型的草种植得足够远，以防止它们不可分割地混合在一起。

FJ 的农场由 $N$ 块田地组成（$1 \leq N \leq 200,000$），其中 $M$ 对田地通过双向路径连接（$1 \leq M \leq 200,000$）。使用这些路径，可以从任何田地走到任何其他田地。每条路径的长度是一个在 $1 \ldots 1,000,000$ 范围内的整数。任何一对田地之间最多只有一条直接路径。

在每块田地中，FJ 最初种植了 $K$ 种草中的一种（$1 \leq K \leq N$）。然而，随着时间的推移，他可能会决定将某块田地的草更换为另一种类型。他称这种操作为“更新”操作。他可能会在一段时间内执行多次更新，这些更新都是累积性质的。

每次更新后，FJ 想知道种植不同草类型的两块田地之间的最短路径长度。也就是说，在所有种植不同草类型的田地对中，他希望知道哪两块田地最接近。理想情况下，这个数字应该较大，以便他可以防止一种类型的草与另一种类型的草混合。保证农场中始终至少有两块田地种植不同的草类型。

在 30% 的输入案例中，每块田地最多直接连接 10 条路径。

### 输入格式

输入的第一行包含四个整数 $N$、$M$、$K$ 和 $Q$，其中 $Q$ 是更新的次数（$1 \leq Q \leq 200,000$）。

接下来的 $M$ 行描述路径；每行包含三个整数 $A$、$B$ 和 $L$，表示从田地 $A$ 到田地 $B$（两者都是 $1 \ldots N$ 范围内的整数）的长度为 $L$ 的路径。

接下来的一行表示每块田地最初种植的草类型（$N$ 个 $1 \ldots K$ 范围内的整数）。

最后，最后的 $Q$ 行每行描述一个更新，由两个整数 $A$ 和 $B$ 指定，表示将田地 $A$ 的草更新为类型 $B$。

### 输出格式

对于每次更新，输出更新后种植不同草类型的两块田地之间的最短路径长度。


---

---
title: "小清新计数题"
layout: "post"
diff: 省选/NOI-
pid: P3673
tag: ['洛谷原创', 'O2优化', '枚举', '生成树', '基环树', '洛谷月赛']
---
# 小清新计数题
## 题目描述

小 A 正在电脑上玩一个叫做 Truth or Lie 的游戏。

游戏开始时电脑会给出 $n$ 句话，每句话形如“第 $x$ 句话为真”或“第 $x$ 句话为假”，其中 $x$ 是一个 $1$ 到 $n$ 的整数，你只要选择“Good”或者“Bad”，“Good”表示可以决定每句话的真假使每句话的内容都成立，“Bad”反之。

作为一个菜鸡，小 A 只会不停地点“Good”，靠脸过关。

在无数次失败后，非洲人小 A 发现游戏每关中，每句话包含的是“真”还是“假”是固定的，但是每句话中的 $x$ 是在 $1$ 到 $n$ 均匀随机的。

现在小 A 告诉了你某一关每句话的真假，用一个 $01$ 序列表示。第 $i$ 位为 $0$ 表示第 $i$ 句话包含“假”，否则表示包含“真”。现在他想要知道使得点击“Good”正确的方案数。

由于方案数可能比较大，你需要输出方案数对 $998244353$ 取模的结果。

（读不懂题的请移步样例解释）
## 输入格式

一行一个 $01$ 序列，它的长度即为 $n$。
## 输出格式

输出方案数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
01
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
10101
```
### 样例输出 #2
```
1154
```
### 样例输入 #3
```
10101101010111110100110100101010110001010010101001
```
### 样例输出 #3
```
322173207
```
## 提示

### 样例解释

第一句话的内容为“某句话为假”，第二句话的内容为“某句话为真”。所有可能情况如下：

1. 第一句话的内容为“第一句话为假”，第二句话的内容为“第一句话为真”，结果应为 Bad。

2. 第一句话的内容为“第一句话为假”，第二句话的内容为“第二句话为真”，结果应为 Bad。

3. 第一句话的内容为“第二句话为假”，第二句话的内容为“第一句话为真”，结果应为 Bad。

4. 第一句话的内容为“第二句话为假”，第二句话的内容为“第二句话为真”，结果应为 Good，因为只需认为第一句话为假，第二句话为真就符合两句话，所以是 Good。

所以共有一种合法方案。

### 数据范围

- 对于$10\%$ 的数据，$n \leq 7$；
- 对于$20\%$ 的数据，$n \leq 9$；
- 对于$60\%$ 的数据，$n \leq 20$；
- 对于$100\%$ 的数据，$1 \leq n \leq 50$。



---

---
title: "文艺数学题"
layout: "post"
diff: 省选/NOI-
pid: P3790
tag: ['洛谷原创', 'O2优化', '枚举', '剪枝', '生成树', '洛谷月赛']
---
# 文艺数学题
## 题目背景

小Y在AK曼哈顿OI，CTSC和APIO之后，开始研究数学题。

## 题目描述

小Y有一张N个点，M条边的无向图（**可能有重边、自环**），每条边都有一个权值w。


你需要计算：所有**生成树的边权的最大公约数**之和，具体操作见样例。


由于答案可能很大，需要**对1000000007取模**。

## 输入格式

第一行两个正整数N，M，表示点数和边数。


接下来M行，每行三个正整数u，v，w，表示一条边连接u和v，权值为w。

## 输出格式

输出一行一个数，表示答案**对1000000007取模**的值。

## 样例

### 样例输入 #1
```
4 5  
1 2 12  
1 3 9  
2 4 6  
3 4 8  
1 4 4  
```
### 样例输出 #1
```
15
```
## 提示

### 样例1的解释



 ![](https://cdn.luogu.com.cn/upload/pic/13639.png) 

显然，这张图有8个不同的生成树。


用$(x,y,z)$表示x,y,z的最大公约数，则答案


$=(12,6,8)+(6,8,9)+(8,9,12)+(9,12,6)+(9,4,6)+(12,4,8)+(12,4,9)+(6,4,8)$


$=2+1+1+3+1+4+1+2$


$=15$

### 数据范围


对于20%的数据，$N\le 10, M\le 20$；

对于另外10%的数据，$N\le 12, M\le 24$；

对于另外20%的数据，$N\le 60, M\le 3000$，且满足$u_i+1=v_i$；

对于另外20%的数据，$N\le 40, M\le 1000, W\le 1000$；

对于另外15%的数据，$N\le 50, M\le 2000$；

对于所有100%的数据，$N\le 60, M\le 3000, W\le 1000000$；




---

---
title: "[Code+#2] 白金元首与独舞"
layout: "post"
diff: 省选/NOI-
pid: P4033
tag: ['搜索', '图论建模', '生成树', 'Code+']
---
# [Code+#2] 白金元首与独舞
## 题目背景

```cpp
到河北省 见斯大林 / 在月光下 你的背影 / 让我们一起跳舞吧
```
うそだよ~ 河北省怎么可能有 Stalin。


可是…… 可是如果 Stalin 把自己当作炸弹扔到地堡花园里来了呢？


怀揣着这份小小的希望，元首 Adolf 独自走进了花园。终有一天会重逢的吧，Stalin。或许是在此处，或许是在遥远的彼方。


无论如何，在此之前，好好装点一番花园，编排一段优美的舞步吧！

## 题目描述

元首把花园分为 $n$ 行 $m$ 列的网格。每个格子中都可以放置一个标识，指向上、下、左、右四个方向中的任意一个。元首位于一个格子时，会按照其中标识所指的方向进入周围的格子，或者走出花园（即目的格子不在网格之内）。举个例子 —— 对于下面的放置方式，元首从第 $3$ 行第 $2$ 列的格子开始，会沿着以红色标出的路径走出花园；从第 $2$ 行第 22 列的格子开始，则会在以蓝色标出的环路内不断地行走。

 ![](https://cdn.luogu.com.cn/upload/pic/12659.png) 

元首已经设计好了大部分格子的标识。元首用字符 L、R、U、D 分别表示指向左、右、上、下四个方向的标识，用字符 . 表示未决定的格子。现在，元首希望将每个 . 替换为 L、R、U、D 中任意一种，使得从花园中的任意一个格子出发，按照上述规则行走，都可以最终走出花园。


你需要编写程序帮助元首计算替换的不同方案数。两个方案不同当且仅当存在一个格子，使得两个方案中该格子内的标识不同。当然，由于答案可能很大，只需给出方案数除以 $10^9 + 7$所得的余数即可。

## 输入格式

从标准输入读入数据。


输入的第一行包含一个正整数 $T$ —— 测试数据的组数。接下来包含 $T$ 组测试数据，格式如下，测试数据间没有空行。


第 $1$ 行：两个空格分隔的正整数 $n$、$m$ —— 依次表示花园被分成的行数和列数。

接下来 $n$ 行：每行一个长度为 $m$ 的由字符 L、R、U、D 和 . 组成的字符串 —— 表示花园内已经确定的格子状态。

## 输出格式

输出到标准输出。


对于每组测试数据输出一行 —— 满足条件的方案数除以 $10^9 + 7 $所得的余数。

## 样例

### 样例输入 #1
```
5
3 9
LLRRUDUUU
LLR.UDUUU
LLRRUDUUU
4 4
LLRR
L.LL
RR.R
LLRR
4 3
LRD
LUL
DLU
RDL
1 2
LR
2 2
..
..
```
### 样例输出 #1
```
3
8
0
1
192
```
## 提示

**样例解释**

第 $1$ 组数据中，将惟一的 . 替换成 R、U 或 D 均满足要求。


第 $2$ 组数据中，将左上方和右下方的两个 . 分别替换成 LR、LU、LD、UR、UU、UD、DR 或 DD 均满足要求。


第 $3$ 组数据中，没有待决定的格子，原本的安排会使得元首陷入无尽的环路，故答案为 $0$。该组数据与**题目描述**中的例子相同。


第 $4$ 组数据中，也没有待决定的格子，但原本的安排已经满足要求，故答案为 $1$。


令 $k$ 表示标记未确定（即包含 “.”）的格子总数。


对于所有数据，有 $1 \leq T \leq 10$，$1 \leq n, m \leq 200$，$0 \leq k \leq \min(nm, 300)$。

 ![](https://cdn.luogu.com.cn/upload/pic/12660.png) 

“... wie Stalin!”


题面与史实无关。


来自 CodePlus 2017 12 月赛，清华大学计算机科学与技术系学生算法与竞赛协会 荣誉出品。

Credit：idea/吕时清 命题/吕时清 验题/王聿中，杨景钦

Git Repo：https://git.thusaac.org/publish/CodePlus201712

感谢腾讯公司对此次比赛的支持。



---

---
title: "[HEOI2015] 小 Z 的房间"
layout: "post"
diff: 省选/NOI-
pid: P4111
tag: ['2015', '各省省选', '河北', '生成树', '素数判断,质数,筛法', '高斯消元']
---
# [HEOI2015] 小 Z 的房间
## 题目描述

你突然有了一个大房子，房子里面有一些房间。事实上，你的房子可以看做是一个包含 $n\times m$ 个格子的格状矩形，每个格子是一个房间或者是一个柱子。在一开始的时候，相邻的格子之间都有墙隔着。

你想要打通一些相邻房间的墙，使得所有房间能够互相到达。在此过程中，你不能把房子给打穿，或者打通柱子（以及柱子旁边的墙）。同时，你不希望在房子中有小偷的时候会很难抓，所以你希望任意两个房间之间都只有一条通路。现在，你希望统计一共有多少种可行的方案，答案对 $10^9$ 取模。

## 输入格式

第一行两个整数 $n,m$。

接下来 $n$ 行，每行 $m$ 个字符 `.` 或 `*`，其中 `.` 代表房间，`*` 代表柱子。

## 输出格式

一行一个整数，表示合法的方案数对 $10^9$ 取模后的值。
## 样例

### 样例输入 #1
```
2 2
..
..

```
### 样例输出 #1
```
4

```
### 样例输入 #2
```
2 2
*.
.*

```
### 样例输出 #2
```
0

```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，$n,m \le 3$。
- 对于 $50\%$ 的数据，$n,m \le 5$。
- 有 $40\%$ 的数据，$\min(n,m) \le 3$。
- 有 $30\%$ 的数据，不存在柱子。
- 对于 $100\%$ 的数据，$1 \le n,m \le 9$。



---

---
title: "[WC2005] 双面棋盘"
layout: "post"
diff: 省选/NOI-
pid: P4121
tag: ['2005', '线段树', '并查集', '生成树', '动态树 LCT', 'WC']
---
# [WC2005] 双面棋盘
## 题目描述

佳佳有一个 $n$ 行 $n$ 列的黑白棋盘，每个格子都有两面，一面白色，一面黑色。佳佳把棋盘平放在桌子上，因此每个格子恰好一面朝上，如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/rcejbuct.png)

我们把每行从上到下编号为 $1$，$2$，$3$，……，$n$，各列从左到右编号为 $1$，$2$，$3$，……，$n$，则每个格子可以用棋盘坐标$(x, y)$表示。在上图中，有 $8$ 个格子黑色朝上，另外 $17$ 个格子白色朝上。

如果两个同色格子有一条公共边，我们称这两个同色格子属于同一个连通块。上图共有 $5$ 个黑色连通块和 $3$ 个白色连通块。

佳佳可以每分钟将一个格子翻转（即白色变成黑色，黑色变成白色），然后计算当前有多少个黑色连通块和白色连通块，你能算得更快吗？

## 输入格式

输入文件的第一行包含一个正整数 $n$，为格子的边长。以下 $n$ 行每行 $n$ 个整数，非 $0$ 即 $1$，表示初始状态。$0$ 表示白色，$1$ 表示黑色。  

下一行包含一个整数 $m$，表示操作的数目。以下 $m$ 行每行两个整数 $x$, $y$ ( $1 \le x,y \le n$ )，表示把坐标为 $(x, y)$ 的格子翻转。

## 输出格式

输出文件包含 $m$ 行，每行对应一个操作。该行包括两个整数 $b$, $w$，表示黑色区域和白色区域数目。

## 样例

### 样例输入 #1
```
5
0 1 0 0 0
0 1 1 1 0
1 0 0 0 1
0 0 1 0 0
1 0 0 0 0
2
3 2
2 3
```
### 样例输出 #1
```
4 3
5 2
```
## 提示

【样例说明】

翻转 $(3, 2)$ 之后，棋盘变为：

![](https://cdn.luogu.com.cn/upload/image_hosting/9oqt0zsv.png)

有 $4$ 个黑色区域和 $3$ 个白色区域

翻转 $(2, 3)$ 之后，棋盘变为：

![](https://cdn.luogu.com.cn/upload/image_hosting/f335hulm.png)

有 $5$ 个黑色区域和 $2$ 个白色区域

【数据范围】   
对于 $100\%$ 的数据，$1\le n \le 200$，$1\le m \le 10^4$。



---

---
title: "[WC2006] 水管局长"
layout: "post"
diff: 省选/NOI-
pid: P4172
tag: ['图论', '2006', '平衡树', 'O2优化', '生成树', '最近公共祖先 LCA', '动态树 LCT', 'WC']
---
# [WC2006] 水管局长
## 题目背景

SC 省 MY 市有着庞大的地下水管网络，嘟嘟是 MY 市的水管局长（就是管水管的啦）。
## 题目描述

每天供水公司可能要将一定量的水从 $u$ 处送往 $v$ 处，嘟嘟需要为供水公司找到一条从 $u$ 至 $v$ 的水管的路径，接着通过信息化的控制中心通知路径上的水管进入准备送水状态，等到路径上每一条水管都准备好了，供水公司就可以开始送水了。嘟嘟一次只能处理一项送水任务，等到当前的送水任务完成了，才能处理下一项。

在处理每项送水任务之前，路径上的水管都要进行一系列的准备操作，如清洗、消毒等等。嘟嘟在控制中心一声令下，这些水管的准备操作同时开始，但由于各条管道的长度、内径不同，进行准备操作需要的时间可能不同。

供水公司总是希望嘟嘟能找到这样一条送水路径，路径上的所有管道全都准备就绪所需要的时间尽量短。嘟嘟希望你能帮助他完成这样的一个选择路径的系统，以满足供水公司的要求。另外，由于 MY 市的水管年代久远，一些水管会不时出现故障导致不能使用，你的程序必须考虑到这一点。

不妨将 MY 市的水管网络看作一幅简单无向图（即没有自环或重边）：水管是图中的边，水管的连接处为图中的结点。整张图共有 $n$ 个节点和 $m$ 条边，节点从 $1$ 至 $n$ 编号。

## 输入格式

第一行有三个整数，分别表示管道连接处（结点）的数目 $n$，目前水管（无向边）的数目 $m$，以及你的程序需要处理的任务数目（包括寻找一条满足要求的路径和接受某条水管坏掉的事实）$q$。

以下 $m$ 行，每行三个整数 $u, v, t$，表示存在一条连接 $(u, v)$ 的水管，准备时间为 $t$。

以下 $q$ 行，每行三个整数 $k, u, v$，描述一项任务。其中 $k$ 表示任务类型：

- 若 $k = 1$，则表示你需要为供水公司寻找一条满足要求的从 $u$ 到 $v$ 的水管路径，满足准备时间最短；
- 若 $k = 2$，则表示直接连接 $u$ 和 $v$ 的水管宣布报废。

## 输出格式

对于每个 $k = 1$ 的任务，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 4 3
1 2 2
2 3 3
3 4 2
1 4 2
1 1 4
2 1 4
1 1 4

```
### 样例输出 #1
```
2
3
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 10^3$，$1 \leq m, q \leq 10^5$。
- $1 \leq k \leq 2$，$1 \leq u, v \leq n$，$1 \leq t \leq 10^9$。
- 给出的图无重边无自环，保证在宣布一条水管报废之前，该水管一定存在于图上且没有报废，
- 宣布报废的水管不超过 $5 \times 10^3$ 条，且在任意时刻，图一定是联通的。





---

---
title: "[BJWC2010] 严格次小生成树"
layout: "post"
diff: 省选/NOI-
pid: P4180
tag: ['2010', '倍增', '各省省选', '北京', 'O2优化', '生成树']
---
# [BJWC2010] 严格次小生成树
## 题目描述

小 C 最近学了很多最小生成树的算法，Prim 算法、Kruskal 算法、消圈算法等等。正当小 C 洋洋得意之时，小 P 又来泼小 C 冷水了。小 P 说，让小 C 求出一个无向图的次小生成树，而且这个次小生成树还得是严格次小的，也就是说：如果最小生成树选择的边集是 $E_M$，严格次小生成树选择的边集是 $E_S$，那么需要满足：($value(e)$ 表示边 $e$ 的权值) $\sum_{e \in E_M}value(e)<\sum_{e \in E_S}value(e)$。

这下小 C 蒙了，他找到了你，希望你帮他解决这个问题。

## 输入格式

第一行包含两个整数 $N$ 和 $M$，表示无向图的点数与边数。

接下来 $M$ 行，每行 $3$ 个数 $x,y,z$ 表示，点 $x$ 和点 $y$ 之间有一条边，边的权值为 $z$。

## 输出格式

包含一行，仅一个数，表示严格次小生成树的边权和。

## 样例

### 样例输入 #1
```
5 6
1 2 1 
1 3 2 
2 4 3 
3 5 4 
3 4 3 
4 5 6 
```
### 样例输出 #1
```
11
```
## 提示

数据中无向图**不保证无自环**。

对于 $50\%$ 的数据， $N\le 2000$，$M\le 3000$。

对于 $80\%$ 的数据， $N\le 5\times 10^4$，$M\le 10^5$。

对于 $100\%$ 的数据， $N\le 10^5$，$M\le 3\times10^5$，边权  $\in [0,10^9]$，数据保证必定存在严格次小生成树。


---

---
title: "Peaks"
layout: "post"
diff: 省选/NOI-
pid: P4197
tag: ['倍增', '生成树', '可持久化线段树']
---
# Peaks
## 题目描述

在 Bytemountains 有 $n$ 座山峰，每座山峰有他的高度 $h_i$。有些山峰之间有双向道路相连，共 $m$ 条路径，每条路径有一个困难值，这个值越大表示越难走。  

现在有 $q$ 组询问，每组询问询问从点 $v$ 开始只经过困难值小于等于 $x$ 的路径所能到达的山峰中第 $k$ 高的山峰，如果无解输出 $-1$。
## 输入格式

第一行三个数 $n,m,q$。
第二行 $n$ 个数，第 $i$ 个数为 $h_i$。

接下来 $m$ 行，每行三个整数 $a,b,c$，表示从 $a \to b$ 有一条困难值为 $c$ 的双向路径。
接下来 $q$ 行，每行三个数 $v,x,k$，表示一组询问。
## 输出格式

对于每组询问，输出一个整数表示能到达的山峰中第 $k$ 高的山峰的高度。
## 样例

### 样例输入 #1
```
10 11 4
1 2 3 4 5 6 7 8 9 10
1 4 4
2 5 3
9 8 2
7 8 10
7 1 4
6 7 1
6 4 8
2 1 5
10 8 10
3 4 7
3 4 6
1 5 2
1 5 6
1 5 8
8 9 2
```
### 样例输出 #1
```
6
1
-1
8

```
## 提示

### 数据规模与约定
对于 $100\%$ 的数据，$n \le 10^5$，$0 \le m,q \le 5\times 10^5$，$h_i,c,x \le 10^9$。


---

---
title: "[JSOI2008] 最小生成树计数"
layout: "post"
diff: 省选/NOI-
pid: P4208
tag: ['2008', '并查集', '各省省选', '江苏', '生成树', '素数判断,质数,筛法', '高斯消元']
---
# [JSOI2008] 最小生成树计数
## 题目描述

现在给出了一个简单无向加权图。你不满足于求出这个图的最小生成树，而希望知道这个图中有多少个不同的最小生成树。（如果两棵最小生成树中至少有一条边不同，则这两个最小生成树就是不同的）。由于不同的最小生成树可能很多，所以你只需要输出方案数对 $31011$ 的模就可以了。
## 输入格式

第一行包含两个数，$n$ 和 $m$，其中 $1 \le n \le 100$，$1 \le m \le 1000$，表示该无向图的节点数和边数。每个节点用 $1 \sim n$ 的整数编号。

接下来的 $m$ 行，每行包含两个整数：$a,b,c$，表示节点 $a,b$ 之间的边的权值为 $c$，其中 $1 \le c \le 10^9$。

数据保证不会出现自回边和重边。注意：具有相同权值的边不会超过 $10$ 条。
## 输出格式

输出不同的最小生成树有多少个。你只需要输出数量对 $31011$ 的模就可以了。
## 样例

### 样例输入 #1
```
4 6
1 2 1
1 3 1
1 4 1
2 3 2
2 4 1
3 4 1
```
### 样例输出 #1
```
8

```
## 提示

### 数据范围及约定

对于全部数据，$1 \le n \le 100$，$1 \le m \le 1000$，$1\leq c_i\leq 10^9$。


---

---
title: "最小差值生成树"
layout: "post"
diff: 省选/NOI-
pid: P4234
tag: ['图论', 'O2优化', '枚举', '深度优先搜索 DFS', '生成树', '动态树 LCT']
---
# 最小差值生成树
## 题目描述

给定一个点标号从 $1$ 到 $n$ 的、有 $m$ 条边的无向图，求边权最大值与最小值的差值最小的生成树。图可能存在自环。
## 输入格式

第一行有两个整数，表示图的点数 $n$ 和边数 $m$。

接下来 $m$ 行，每行三个整数 $u, v, w$，表示存在一条连接 $u, v$ 长度为 $w$ 的边。
## 输出格式

输出一行一个整数，表示答案。

## 样例

### 样例输入 #1
```
4 6 
1 2 10 
1 3 100 
1 4 90 
2 3 20 
2 4 80 
3 4 40 

```
### 样例输出 #1
```
20
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n \leq 100$，$m \leq 10^3$。
- 对于 $97\%$ 的数据，保证 $n \leq 500$，$m \leq 10^5$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 5 \times 10^4$，$1 \leq m \leq 2 \times 10^5$，$1 \leq u, v \leq n$，$1 \leq w \leq 10^4$。


---

---
title: "变化的道路"
layout: "post"
diff: 省选/NOI-
pid: P4319
tag: ['线段树', 'O2优化', '生成树', '动态树 LCT', '可持久化']
---
# 变化的道路
## 题目描述

小 w 和小 c 在 H 国，近年来，随着 H 国的发展，H 国的道路也在不断变化着

根据 H 国的道路法，H 国道路都有一个值 $w$，表示如果小 w 和小 c 通过这条道路，那么他们的 L 值会减少 $w$，但是如果小 w 和
小 c 在之前已经经过了这条路，那么他们的 L 值不会减少

H 国有 $N$ 个国家，最开始 H 国有 $N-1$ 条道路，这 $N-1$ 条道路刚好构成一棵树

小 w 将和小 c 从 H 国的城市 1 出发，游览 H 国的所有城市，总共游览 32766 天，对于每一天，他们都希望游览结束后 L 值还是一个正数，
那么他们出发时 L 值至少为多少

H 国的所有边都是无向边，没有一条道路连接相同的一个城市
## 输入格式

输入第 1 行，一个整数$N$

输入第 2 至第 $N$ 行，每行三个正整数$u, v, w$，表示城市 $u$ 与城市 $v$ 有一条值为 $w$ 道路
	
输入第 $N+1$ 行，一个整数 $M$，表示 H 国有 $M$ 条正在变化的道路

输入第 $N+2$ 行到第 $N+M+1$ 行，每行 5 个整数 $u, v, w, l, r$，表示城市 $u$ 到城市 $v$ 有一条值为 $w$ 的道路，
这条道路存在于第 $l$ 天到第 $r$ 天
## 输出格式

输出共 32766 行，第 $i$ 行表示第 $i$ 天游览的 L 值至少为多少
## 样例

### 样例输入 #1
```
4
1 3 3
3 4 4
2 4 5
3
1 2 1 1 2
2 3 8 2 3
3 4 2 1 1
```
### 样例输出 #1
```
7
9
13
由于版面原因，仅显示三行，接下来32763行都是13
```
## 提示

第一天，选择 1 -(1)> 2 -(0)> 1 -(3)> 3 -(2)> 4，L 值总共减少了 6，所以 L 值至少为 7

第二天，选择 1 -(1)> 2 -(0)> 1 -(3)> 3 -(4)> 4，L 值总共减少了 8，所以 L 值至少为 9

第三天及之后，选择 1 -(3)> 3 -(4)> 4 -(5)> 2，L 值总共减少了 12，所以 L 值至少为 13

subtask1 : 15分，$N = 100, rm = 233$

subtask2 : 15分，$N = 1000, rm = 2333$

subtask3 : 20分，$N = 49998, rm = 32766, l = r$

subtask4：20分，$N = 49999, rm = 32766, r = rm$

subtask5：30分，$N = 50000, rm = 32766$

对于subtask3 : $M = rm$，对于其他subtask：$M=3\times rm$

对于所有数据 : $1\leq N\leq 50000, 1\leq l\leq r\leq rm\leq 32766, 1\leq w\leq 10^9$


---

---
title: "[SHOI2016] 黑暗前的幻想乡"
layout: "post"
diff: 省选/NOI-
pid: P4336
tag: ['2016', '各省省选', '矩阵树定理', '上海', '生成树', '容斥原理']
---
# [SHOI2016] 黑暗前的幻想乡
## 题目背景

四年一度的幻想乡大选开始了，最近幻想乡最大的问题是很多来历不明的妖怪涌入了幻想乡，扰乱了幻想乡昔日的秩序。但是幻想乡的建制派妖怪（人类）博丽灵梦和八云紫等人整日高谈所有妖怪平等，幻想乡多元化等等，对于幻想乡目前面临的种种大问题却给不出合理的解决方案。

风见幽香是幻想乡里少有的意识到了问题严重性的大妖怪。她这次勇敢地站了出来参加幻想乡大选，提出包括在幻想乡边境建墙（并让人类出钱），大力开展基础设施建设挽回失业率等一系列方案，成为了大选年出人意料的黑马并顺利地当上了幻想乡的大统领。
## 题目描述

幽香上台以后，第一项措施就是要修建幻想乡的公路。幻想乡一共有 $n$ 个城市，之前原来没有任何路。幽香向选民承诺要减税，所以她打算只修 $n-1$ 条公路将这些城市连接起来。但是幻想乡有正好 $n-1$ 个建筑公司，每个建筑公司都想在修路的过程中获得一些好处。虽然这些建筑公司在选举前没有给幽香钱，幽香还是打算和他们搞好关系，因为她还指望他们帮她建墙。所以她打算让每个建筑公司都负责一条路来修。

每个建筑公司都告诉了幽香自己有能力负责修建的路是哪些城市之间的。所以幽香打算 $n - 1$ 条能够连接幻想乡所有城市的边，然后每条边都交给一个能够负责该边的建筑公司修建，并且每个建筑公司都恰好修建一条边。

幽香现在想要知道一共有多少种可能的方案呢？两个方案不同当且仅当它们要么修的边的集合不同，要么边的分配方式不同。
## 输入格式

第一行包含一个整数 $n$，表示城市个数。

第 $2$ 到第 $n$ 行，第 $(i + 1)$ 行表示 第 $i$ 个建筑公司可以修建的路的列表：以一个非负整数 $m_i$ 开头，表示其可以修建条路的条数；接下来有 $m_i$ 对整数 $u, v$，每对数表示一条边的两个端点。其中不会出现重复的边，也不会出现自环。
## 输出格式

输出一行一个整数，表示所有可能的方案数对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
4
2 3 2 4 2
5 2 1 3 1 3 2 4 1 4 3
4 2 1 3 2 4 1 4 2
```
### 样例输出 #1
```
17
```
## 提示

#### 数据规模与约定

+ 对于 $20\%$ 的测试点，$n \le 5$。
+ 对于 $50\%$ 的测试点，$n \le 8$。
+ 对于 $60\%$ 的测试点，$n \le 10$。
+ 对于 $100\%$ 的测试点，$2 \leq n \le 17$，$0 \leq m_i \leq \frac{n(n - 1)}{2}$，$1 \leq u, v \leq n$。


---

---
title: "[CQOI2018] 社交网络"
layout: "post"
diff: 省选/NOI-
pid: P4455
tag: ['2018', '重庆', '各省省选', '生成树', '向量', '构造']
---
# [CQOI2018] 社交网络
## 题目背景

当今社会，在社交网络上看朋友的消息已经成为许多人生活的一部分。通常，一个用户在社交网络上发布一条消息后，他的好友们也可以看见这条消息，并可能转发。转发的消息还可以继续被人转发，进而扩散到整个社交网络中。
## 题目描述

在一个实验性的小规模社交网络中我们发现，有时一条热门消息最终会被所有人转发。为了研究这一现象发生的过程，我们希望计算一条消息所有可能的转发途径有多少种。为了编程方便，我们将初始消息发送者编号为 $1$，其他用户编号依次递增。

该社交网络上的所有好友关系是已知的，也就是说对于 $a, b$ 两个用户，我们知道 $a$ 用户可以看到 $b$ 用户发送的消息。注意可能存在单向的好友关系，即 $a$ 能看到 $b$ 的消息，但 $b$ 不能看到 $a$ 的消息。

还有一个假设是，如果某用户看到他的多个好友转发了同一条消息，他只会选择从其中一个转发，最多转发一次消息。从不同好友的转发，被视为不同的情况。

如果用箭头表示好友关系，下图展示了某个社交网络中消息转发的所有可能情况。（初始消息是用户 $1$ 发送的，加粗箭头表示一次消息转发）

![](https://cdn.luogu.com.cn/upload/pic/17549.png)
![](https://cdn.luogu.com.cn/upload/pic/17550.png)
![](https://cdn.luogu.com.cn/upload/pic/17551.png)
![](https://cdn.luogu.com.cn/upload/pic/17552.png)
![](https://cdn.luogu.com.cn/upload/pic/17553.png)
![](https://cdn.luogu.com.cn/upload/pic/17554.png)

答案对 $10^4 + 7$ 取模。
## 输入格式

第一行有一个整数，表示用户的数量 $n$。  
第二行有一个整数，表示好友关系数目 $m$。  
接下来 $m$ 行，每行两个整数 $a, b$，表示一组好友关系，即用户 $a$ 可以看到用户 $b$ 发送的信息。
## 输出格式

输出一行一个整数表示答案对 $10^4 + 7$ 取模的结果。
## 样例

### 样例输入 #1
```
4
7
2 1
3 1
1 3
2 3
3 2
4 3
4 2

```
### 样例输出 #1
```
6
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n \leq 10$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 250$，$1 \leq m \leq n \times (n - 1)$，$1 \leq a, b \leq n$。


---

---
title: "[BalticOI 2016] 城市 (Day2)"
layout: "post"
diff: 省选/NOI-
pid: P4784
tag: ['2016', '枚举', '生成树', 'BalticOI（波罗的海）']
---
# [BalticOI 2016] 城市 (Day2)
## 题目描述

在 Byteland 有 $n$ 个城市，并且其中有 $k$ 个国王经常来访的主要城市。

其中有 $m$ 条道路，每条道路连接两个城市。然而不幸的是，这些道路的环境极差使得国王无法全速驶过。

对于每条道路，翻修的成本是已知的。你的任务是选择性的翻修道路使得 $k$ 个主要城市都可以经过翻修后的道路互相连通，且总成本尽量小。
## 输入格式

第一行，三个整数 $n,k$ 和 $m$，分别表示城市的个数，主要城市的个数和道路的个数。城市的编号分别为 $1,2,\dots,n$。

第二行，$k$ 个整数，表示主要城市。

接下来 $m$ 行，每行三个整数 $a,b$ 和 $c$，表示有一条双向道路从城市 $a$ 连接到城市 $b$，且翻修成本为 $c$。
## 输出格式

输出一行，表示满足以上条件的最小的总成本。


## 样例

### 样例输入 #1
```
4 3 6
1 3 4
1 2 4
1 3 9
1 4 6
2 3 2
2 4 5
3 4 8
```
### 样例输出 #1
```
11
```
## 提示

对于所有子任务，$1 \leq c \leq 10^9$ 且 $n \geq k$。

|子任务|分数|数据范围|
|:-:|:-:|-|
|1|22|$2 \leq k \leq 5,n \leq 20,1 \leq m \leq 40$|
|2|14|$2 \leq k \leq 3,n \leq 10^5,1 \leq m \leq 2 \cdot 10^5$|
|3|15|$2 \leq k \leq 4,n \leq 1000,1 \leq m \leq 2000$|
|4|23|$k = 4,n \leq 10^5,1 \leq m \leq 2 \cdot 10^5$|
|5|26|$k = 5,n \leq 10^5,1 \leq m \leq 2 \cdot 10^5$|



---

---
title: "[CCC 2017] 最小费用流"
layout: "post"
diff: 省选/NOI-
pid: P4806
tag: ['2017', 'CCC（加拿大）', '生成树', '最近公共祖先 LCA']
---
# [CCC 2017] 最小费用流
## 题目描述

 **译自 [CCC2017](https://cemc.math.uwaterloo.ca/contests/computing/2017/index.html) Senior T4「[Minimum Cost Flow](https://cemc.math.uwaterloo.ca/contests/computing/2017/stage%201/seniorEF.pdf)」**

Watermoo 中有编号为 $1,2,\dots,N$ 的建筑物。其中还有 $M$ 条管道将建筑物两两连接。由于城市规划的疏漏，$1$ 号建筑是全市唯一的污水处理厂。每条管道可能是*活动的*或是*非活动的*。如果建筑 $1$ 通过活动管道直接或是间接地与其他每个建筑连通，则称活动管道集是一个有效的方案。（每条管道将两个建筑直接连接。如果建筑 $X$ 直接或间接连接建筑 $Y$，且建筑 $Y$ 直接或间接连接建筑 $Z$，那么我们说 $X$ 和 $Z$ 间接连接。）

Watermoo 的市政府正在使用一个 $N-1$ 条管道组成的显然有效的方案，但是这使得政府已经透支很多经费了！每条管道都有各自的月维修费，这是在其活动时必须支付的，一个有效方案的总成本为所有有效管道的维修费的总和。（非活动的管道不花费一分钱。）

此外，一个好消息是：Watermoo 大学的研究人员开发出了一种不完善的管道推进器，你可以在一条管道上使用它。它将从 $C$ 到 $\mathrm{max}(0,C-D)$ 降低该管道的维修成本，$D$ 为该推进器的强度。

市政府希望将成本降到最低，同时也希望你能尽快完成这个任务。每天，城市会允许你激活一条管道并关闭另一条管道。问：你需要多少天才能使一组活动管道形成一个有效方案并使其在所有有效方案和推进方案中费用最小？

请注意，在你规划的过程中方案可能会无效，但是到最后，他应该是一个有效的方案。
## 输入格式

第一行，三个整数 $N,M$ 和 $D(1 \le N \le 100\ 000,N - 1 \le M \le 200\ 000,0 \le D \le 10^9)$。

接下来 $M$ 行，每行三个整数 $A_i,B_i$ 和 $C_i$，表示有一条月维修成本为 $C_i$ 的管道从建筑 $A_i$ 连接到建筑 $B_i(1 \le A_i,B_i \le N,1 \le C_i \le 10^9)$。

前 $N-1$ 行表示 Watermoo 正在使用的有效方案。

保证数据没有重边和自环。
## 输出格式

输出一行，一个整数，表示完成任务的最小天数。如果初始方案即最优方案，输出`0`。
## 样例

### 样例输入 #1
```
4 4 0
1 2 1
2 3 2
3 4 1
4 1 1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5 6 2
1 2 5
2 3 5
1 4 5
4 5 5
1 3 1
1 5 1
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
4 4 0
1 2 715827882
2 3 715827882
3 4 715827882
4 1 715827884
```
### 样例输出 #3
```
0
```
## 提示

#### 样例解释 1
因为 $D=0$，所以管道推进器一无是处。

第一天，你应当关闭建筑 $2$ 到 $3$ 的管道并激活建筑 $4$ 到 $1$ 的管道。

#### 样例解释 2
一个可行的解为：首先在连接建筑 $1,2$ 的管道上安装推进器，使成本降低到 $3$。第一天，以连接 $1,3$ 的管道替换连接 $2,3$ 的管道。第二天，以连接 $1,5$ 的管道替换连接 $1,4$ 的管道。

此外，在连接 $1,3$ 或连接 $1,5$ 的管道上安装推进器毫无意义。这样做将会使得该管道的维修成本为 $0$，最优的费用为 $11$ （如你所见，我们已经找到了费用为 $10$ 的方案）。

#### 样例解释 3
初始的方案即最优方案。请注意整数上溢。

对于 $\frac3{15}$ 的数据，$N \le 8,M \le 28,D=0$。

对于另外 $\frac5{15}$ 的数据，$N \le 1\ 000,M \le 5\ 000,D=0$。

对于另外 $\frac3{15}$ 的数据，$D=0$。

对于另外 $\frac2{15}$ 的数据，$N \le 1\ 000,M \le 5\ 000$。


---

---
title: "基地建设"
layout: "post"
diff: 省选/NOI-
pid: P4966
tag: ['2018', 'Special Judge', 'O2优化', '模拟退火', '生成树']
---
# 基地建设
## 题目背景

在茫茫宇宙中……
## 题目描述

有一群生物 ccj，他们发现了一个超星系群。其中有 $n$ 个恒星，$m$ 条双向星际航线，每条星际航线都需要消耗 $val_i$ 的燃料值。两个恒星不属于同一个星系当且仅当他们之间没有任何航线，且没有任何路径可以到达。只有每个恒星才可以为飞船补充燃料。每次航行的路线都是一条简单路径。由于燃料系统过于简陋，每个燃料罐只能用于一次航行。他们的首长 ccj 想在其中一个恒星上建立基地。但是 ccj 花了太多钱购买高速飞船，没有太多钱购买燃料罐，所以他对于两个恒星之间的航行一定选择最经济的航行方式，购买最小的燃料罐。他想问你，在基地要备多少的燃料总量，使得在任意一个恒星上建立基地都能从那个基地分别到达那个星系的其他所有恒星。

但是，这个超星系群发生了战争，一些黑洞改变了这里的空间结构。这群生物只知道每条航线花费的燃料值，找不到连接的两个恒星。但是他们的科学家发现了一个性质：每个战争有一个标志值 $q$，航线有不同的排列方式，对于其中一种排列，第 $i$ 条航线连接着 $((q^{i} \bmod 2^{32}+i \times val_i) \bmod n+n) \bmod n+1$ 和 $((q^{i} \bmod 2^{32}-i \times val_i) \bmod n+n) \bmod n+1$ 两个恒星。**运算方式为无符号整型运算**。如果连接的两个恒星一样，说明科学家计算有误，忽略这条航线。ccj 的目标改变了。他想知道对于所有星系的构成情况，最少需要准备多少的燃料总量，使得在这种结构中，在任意一个恒星上建立基地都能分别到达该结构下那个恒星所处星系的其他所有恒星。

你需要输出航线排列顺序。

## 输入格式

第一行三个正整数 $n$，$m$ 和 $q$，表示有 $n$ 个恒星，$m$ 条航线，战争标志值 $q$。

第二行 $m$ 个正整数 $val_i$，表示第 $i$ 条航线消耗 $val_i$ 的燃料值。
## 输出格式

第一行一个正整数 $ans$，表示 ccj 需要你求的数值。

从第二行到第 $m+1$ 行，每行输出一个整数，第 $i$ 行输出这个排列下的 $val_{i-1}$。
## 样例

### 样例输入 #1
```
3 5 2
1 2 3 4 5

```
### 样例输出 #1
```
1
5
4
2
3
1

```
## 提示

**样例解释：**

这 $5$ 条航线分别是：

$2$ 与 $2$ 往返，花费燃料 $5$

$1$ 与 $1$ 往返，花费燃料 $4$

$3$ 与 $3$ 往返，花费燃料 $2$

$2$ 与 $2$ 往返，花费燃料 $3$

$1$ 与 $2$ 往返，花费燃料 $1$

前四条航线被忽略，故有四个恒星系，$\{1,2\},\{3\},\{4\},\{5\}$

基地建在 $1$ 时，从 $1$ 到 $2$ 需要购买燃料量为 $1$ 的燃料罐，可以发现，没有其他比这个更优的答案。

$2 \le n \le 100\quad 1 \le m \le 40\quad 0 \le q \le 10^9\quad 0 \le val_i \le 1000$

你的答案只需要比std优秀或者和std一样且方案正确即可

1~4数据都为最优答案，5~10数据都为次优答案

~~此题会给出第10个数据的输入~~
[输入数据](https://www.luogu.org/paste/3xkq6bar)

详细范围参见”标程“

数据均为随机构造，请注意常数！


---

---
title: "【XR-2】约定"
layout: "post"
diff: 省选/NOI-
pid: P5437
tag: ['数学', '生成树', '期望', '逆元']
---
# 【XR-2】约定
## 题目背景

>「小圆，不要走！这一分离，我们何时才能重逢？」
>
>「小焰，我们一定还会相见的！在那之前，我们只是短暂的离别啊......」
## 题目描述

只因为那一句约定，小焰开始了看不到尽头的等待。

约定在小焰心中幻化成了一张 $n$ 个点的图。一开始，这是一张完全图，其中点的编号从 $1$ 到 $n$，连接点 $i,j$ 的边的权值为 $(i+j)^k$。

然而等待的过程中，岁月也在逐渐消磨着她的信仰，因此图中的一些边被随机地删掉了。最终，图变成了一棵 $n$ 个点的树，永远地留在了小焰的心中。

很久很久以后，小焰的魔力耗尽，在痛苦与绝望之中濒临崩溃。而就在这时，小圆终于来找小焰了。为了拯救自己唯一的朋友，她必须知道这棵树边权和的期望值对 $998244353$ 取模的结果是多少。

你能帮小圆求出答案，让她完成那个约定吗？
## 输入格式

一行两个正整数 $n,k$。
## 输出格式

一行一个整数，表示答案对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
3 1

```
### 样例输出 #1
```
8

```
### 样例输入 #2
```
4 3

```
### 样例输出 #2
```
450

```
### 样例输入 #3
```
1926 817

```
### 样例输出 #3
```
984167516

```
## 提示

【样例 $1$ 说明】

这个完全图有 $3$ 个节点，$3$ 条边，形成了一个环。  
这些边的权分别为：$3,4,5$   
最后形成的树也有 $3$ 种可能，权值分别为：$7,8,9$  
期望值为 $8$。

【数据规模与约定】

**本题采用捆绑测试。**

Subtask 1（5 points）：$1 \le n \le 5$，$1\le k \le 10$。     
Subtask 2（11 points）：$k = 1$。  
Subtask 3（11 points）：$1 \le n,k \le 20000$。  
Subtask 4（13 points）：$1 \le n,k \le 10^5$。   
Subtask 5（23 points）：$1 \le k \le 10^5$。  
Subtask 6（37 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le n \le 998244352,1\le k \le 10^7$。
****
>「抱歉，让你久等了...... 你一直努力到了今天吧......」  
>
>「小圆......」
>
>「来，我们走吧。今后我们永不分离......」
>
>「是啊，我等这一刻——望眼欲穿。」


---

---
title: "[NOI2019] 回家路线"
layout: "post"
diff: 省选/NOI-
pid: P5468
tag: ['动态规划 DP', '2019', 'NOI', 'O2优化', '深度优先搜索 DFS', '生成树']
---
# [NOI2019] 回家路线
## 题目背景

本题原题数据强度较低，若想要测试较强数据可以去 [P6302](https://www.luogu.com.cn/problem/P6302)，除数据范围外均与原题相同。
## 题目描述

猫国的铁路系统中有 $n$ 个站点，从 $1 - n$ 编号。小猫准备从 $1$ 号站点出发，乘坐列车回到猫窝所在的 $n$ 号站点。它查询了能够乘坐的列车，这些列车共 $m$ 班，从$1 - m$编号。小猫将在 $0$ 时刻到达 $1$ 号站点。对于 $i$ 号列车，它将在时刻 $p_i$ 从站点 $x_i$ 出发，在时刻 $q_i$ 直达站点 $y_i$，小猫只能在时刻 $p_i$ 上 $i$ 号列车，也只能在时刻 $q_i$ 下 $i$ 号列车。小猫可以通过多次换乘到达 $n$ 号站点。一次换乘是指对于两班列车，假设分别为 $u$ 号与 $v$ 号列车，若 $y_u = x_v$ 并且 $q_u \leq p_v$，那么小猫可以乘坐完 $u$ 号列车后在 $y_u$ 号站点等待 $p_v - q_u$ 个时刻，并在时刻 $p_v$ 乘坐 $v$ 号列车。

小猫只想回到猫窝并且减少途中的麻烦，对此它用烦躁值来衡量。

- 小猫在站点等待时将增加烦躁值，对于一次 $t (t \geq 0)$ 个时刻的等待，烦躁值将增加 $At^2 + Bt + C$，其中 $A, B,C$ 是给定的常数。注意：小猫登上第一班列车前，即从 $0$ 时刻起停留在 $1$ 号站点的那些时刻也算作一次等待。

- 若小猫最终在时刻 $z$ 到达 $n$ 号站点，则烦躁值将再增加 $z$。

形式化地说，若小猫共乘坐了 $k$ 班列车，依次乘坐的列车编号可用序列 $s_1, s_2, \cdots , s_k$表示。该方案被称作一条可行的回家路线，当且仅当它满足下列两个条件：

1. $x_{s1} = 1$ , $y_{sk} = n$

2. 对于所有 $j (1 \leq j < k)$，满足 $y_{sj} = x_{s_{j+1}}$ 且 $q_{sj}\leq p_{s_{j+1}}$

对于该回家路线，小猫得到的烦躁值将为：

$$q_{s_k}+(A\times p_{s_1}^2+B\times p_{s_1}+C)+\sum_{j=1}^{k-1}(A(p_{s_{j+1}}-q_{s_j})^2+B(p_{s_{j+1}}-q_{s_j})+C)$$

小猫想让自己的烦躁值尽量小，请你帮它求出所有可行的回家路线中，能得到的最
小的烦躁值。题目保证至少存在一条可行的回家路线。

## 输入格式

第一行五个整数 $n, m, A, B,C$，变量意义见题目描述。

接下来 $m$ 行，第 $i$ 行四个整数 $x_i, y_i, p_i, q_i$，分别表示 $i$ 号列车的出发站、到达站、出发时刻与到达时刻。
## 输出格式

输出仅一行一个整数，表示所求的答案。

## 样例

### 样例输入 #1
```
3 4 1 5 10
1 2 3 4
1 2 5 7
1 2 6 8
2 3 9 10
```
### 样例输出 #1
```
94
```
### 样例输入 #2
```
4 3 1 2 3
1 2 2 3
2 3 5 7
3 4 7 9
```
### 样例输出 #2
```
34
```
## 提示

### 更多样例

您可以通过附加文件获得更多样例。

#### 样例 3

见附加文件的 `route/route3.in` 与 `route/route3.ans`。

该样例的数据类型与最终测试点 $5 \sim 8$ 一致。

#### 样例 4

见附加文件的 `route/route4.in` 与 `route/route4.ans`。

该样例的数据类型与最终测试点 $11 \sim 14$ 一致。

#### 样例 5

见附加文件的 `route/route5.in` 与 `route/route5.ans`。

该样例的数据类型与最终测试点 $18 \sim 20$ 一致。

### 样例 1 解释

共有三条可行的回家路线：

- 依次乘坐 1，4 号列车，得到的烦躁值为：$10 + (1 \times 3^2 + 5 \times 3 + 10) + (1 \times (9 - 4)^2 + 5 \times (9 - 4) + 10)= 104$
- 依次乘坐 2，4 号列车，得到的烦躁值为：$10 + (1 \times 5^2 + 5 \times 5 + 10) + (1 \times (9 - 7)^2 + 5 \times (9 - 7) + 10)= 94$
- 依次乘坐 3，4 号列车，得到的烦躁值为：$10 + (1 \times 6^2 + 5 \times 6 + 10) + (1 \times (9 - 8)^2 + 5 \times (9 - 8) + 10)= 102$

第二条路线得到的烦躁值最小为 $94$。

### 数据范围

对于所有测试点：$2\le n\le 10^5,1\le m\le 2\times 10^5,0 \le A \le 10 , 0 \le B, C \le 10^6,1 \le x_i, y_i \le n , x_i \neq y_i , 0 \le p_i < q_i \le 10^3$。

每个测试点的具体限制见下表：

| 测试点编号  |        $n$         |          $m$          | $A,B,C$ 的特殊限制 | 其他特殊条件 |
| :---------: | :----------------: | :-------------------: | :----------------: | :----------: |
|  $1\sim 2$  |     $\le 100$      |        $=n-1$         |         无         | $y_i=x_i+1$  |
|  $3\sim 4$  |     $\le 100$      | $\le 100$ |     $A=B=C=0$      | $y_i=x_i+1$  |
|  $5\sim 8$  | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |     $A=B=C=0$      |  $x_i<y_i$   |
|     $9$     | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |      $A=B=0$       |  $x_i<y_i$   |
|    $10$     | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |       $A=0$        |  $x_i<y_i$   |
| $11\sim 14$ | $\le 2\times 10^3$ |  $\le 4\times 10^3$   |         无         |      无      |
|    $15$     |     $\le 10^5$     |  $\le 2\times 10^5$   |      $A=B=0$       |      无      |
| $16\sim 17$ |     $\le 10^5$     |  $\le 2\times 10^5$   |       $A=0$        |      无      |
| $18\sim 20$ |     $\le 10^5$     |  $\le 2\times 10^5$   |         无         |      无      |


---

---
title: "【AFOI-19】跳闸"
layout: "post"
diff: 省选/NOI-
pid: P5630
tag: ['图论', '生成树', '最近公共祖先 LCA']
---
# 【AFOI-19】跳闸
## 题目背景

面基完毕后已经是晚上了，IY 和 SY在机房划水写板子。

然后机房跳闸了。

然后他们核善的信息老师叫他们修闸。

IY 和 SY 迫于威胁不得不修闸。

于是有了下面这一幕。
## 题目描述

IY 和 SY 发现总闸的电路已经完全损坏了，于是他们不得不重新设置一个电路。

机房里有 $n$ 个电流传导节点，每个节点可以用电线连向其他节点。**相通的节点可以互相传递电流**。

由于预留空间的问题，导致有些节点是不能直接连接的。现在 IY 和 SY 知道有 $m$ 组节点可以直接连接，并且知道连接这一组节点需要的电线长度。

光有电流传导节点肯定不行。SY 掏出了她珍藏已久的电源发生器。电源发生器可以附着在结点上，给那个节点供电。但是电源发生器也有一些缺陷，**它只能附着在 $s$ 号节点上，且只有 $k$ 个接口，也就是说附着的节点只能连 $k$ 条电线**，而且由于联动原因，**只有发生器所有的接口都连上电线，发生器才会供电**。

**IY 和 SY 的目标是让所有节点都可以被供电**。他们需要电线，然而电线越长，其价格就以指数倍增长。**所以他们都想让最长的电线尽量短。**

SY 接下了铺设电线的任务，IY 则被分配去买电线，**他需要知道他总共要买多长的电线**。由于 SY 忙于铺设电路，**所以 IY 还要回答 SY 的每个询问：让 $u$ 结点和 $v$ 结点相通所需要的电线的总长度为多少**。但是 IY 太弱了，他根本不知道这些答案是多少。

请你帮助弱弱的 IY 回答这些问题。作为奖励，这道题他会给你满分哦。
## 输入格式

第一行四个数$n,m,k,s$，表示有$n$个节点，$m$组可以直接连接的节点，电源发生器有$k$个接口，电源发生器附着在 $s$ 节点上。

下面的 $m$ 行，每行三个数 $u,v,w$，表示 $u$ 和 $v$ 节点可以用电线直接相连，在这两个节点之间铺设电线，需要的电线长度为 $w$ 。

再下面一行有一个数 $q$，表示 SY 有 $q$ 个询问。

下面的 $q$ 行每行两个数 $u,v$，表示 SY 询问 IY ： 让$u$ 结点和 $v$ 结点相通需要多长的电线。
## 输出格式

第一行输出一个数，代表所有电线的总长度。

下面的 $q$ 行，每行一个数，表示对 SY 每个询问的回答。

**可能存在无解的情况，如果无解，则输出"can not fix it."**，然后什么都不要输出。
## 样例

### 样例输入 #1
```
5 7 1 1
1 3 1
2 1 5
4 2 3
2 5 4
5 1 2
3 5 7
4 1 6
2
3 5
1 4
```
### 样例输出 #1
```
15
7
15
```
## 提示

- **样例解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/irpqvatr.png)

如图，发生器附着在节点$1$上且只能连一条电线，其中红线表示连的电线，可以看出这样连是最优的。

- **数据范围**

对于$30\%$ 的数据：$n \le 10, m \le 30, q \le 10$

对于$50\%$ 的数据：$n \le 2000, m \le 20000, q \le 2000$

对于$100\%$ 的数据：$n \le 30000, m \le 500000, q \le 30000, 1 \le s \le n, 1 \le k \le 150$

对于$100\%$ 的数据：满足连接两组不同的节点所需电线长度不同（即边权全部不相等），保证运算过程中不会爆$int$

- **出题人的温馨提醒**

题目要满足最长的电线尽量短，在此基础上还要满足次长的电线尽量短，以此类推。

不保证没有重边，但是保证边数足够，不会选择重边。

保证没有自环，保证数据全随机。


---

---
title: "最小度限制生成树"
layout: "post"
diff: 省选/NOI-
pid: P5633
tag: ['图论', 'Kruskal 重构树', '凸完全单调性（wqs 二分）', '生成树']
---
# 最小度限制生成树
## 题目描述

给你一个有 $n$ 个节点，$m$ 条边的带权无向图，你需要求得一个生成树，使边权总和最小，且满足编号为 $s$ 的节点正好连了 $k$ 条边。
## 输入格式

第一行四个数：$n,m,s,k$

下面的 $m$ 行，每行三个整数：$u,v,w$，表示有一条 $u$ 连向 $v$ 权值为 $w$ 的边。
## 输出格式

输出一个数：满足要求的生成树的总边权。

可能会出现无解的情况，如果无解，则输出 `Impossible`。
## 样例

### 样例输入 #1
```
5 7 1 1
1 3 1
2 1 5
4 2 3
2 5 4
5 1 2
3 5 7
4 1 6
```
### 样例输出 #1
```
15
```
## 提示

### 数据范围

对于 $20\%$ 的数据，$n \le 10$，$m \le 30$。  
对于 $50\%$ 的数据，$n \le 1000$，$m \le 5000$。  
对于 $100\%$ 的数据，$1\leq s \leq n \le 5\times 10^4$，$1\leq m \le 5\times 10^5 $，$1\leq k \le 100$，$0\leq w\leq 3\times 10^4$。

### 注意

本题设有 hack 数据（Subtask $2$），计 $0$ 分，但若没有通过 hack 数据则不算通过本题。


---

---
title: "【模板】Matrix-Tree 定理"
layout: "post"
diff: 省选/NOI-
pid: P6178
tag: ['图论', '矩阵树定理', '生成树', '高斯消元']
---
# 【模板】Matrix-Tree 定理
## 题目描述

给定一张 $n$ 个结点 $m$ 条边的带权图（可能为无向图，可能为有向图）。

定义其一个生成树 $T$ 的权值为 $T$ 中所有边权的乘积。

求其所有不同生成树的权值之和，对 $10^9+7$ 取模。

---

注意：

1. 本题中，有向图的生成树指的是 **以 $1$ 为根的外向树**；

2. 两棵生成树 $T_1,T_2$ 不同，当且仅当存在存在一条边 $e$，满足 $e\in T_1,\ \ e\notin T_2$。
## 输入格式

第一行：三个整数 $n,m,t$，分别表示图的结点数量，边的数量和图的类型（$t=0$ 时为无向图，$t=1$ 时为有向图）。

接下来 $m$ 行：每行三个整数 $u,v,w$。

如果 $t=0$，表示 $u,v$ 之间有一条权值为 $w$ 的无向边；

如果 $t=1$，表示从 $u$ 到 $v$ 有一条权值为 $w$ 的有向边。
## 输出格式

第一行：一个整数 $ans$，表示给定的图的生成树权值和对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
5 8 0
2 3 1
1 2 3
4 5 1
4 2 2
3 5 2
3 4 3
3 4 1
3 3 5

```
### 样例输出 #1
```
144

```
### 样例输入 #2
```
5 9 1
1 2 3
3 2 1
1 3 1
2 4 2
3 5 1
4 3 4
3 5 1
5 4 1
4 4 6

```
### 样例输出 #2
```
72

```
## 提示

【样例 $1$ 解释】

样例 $1$ 中的无向图如左图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/pxtx9z5a.png)

右图为其一个权值为 $3\times 1\times 2\times 3=18$ 的生成树的例子。

---

【样例 $2$ 解释】

样例 $2$ 中的有向图如左图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/4276yln3.png)

右图为其一个权值为 $1\times 1\times 1\times 2=2$ 的生成树（以 $1$ 为根的外向树）的例子。

---

【数据范围】

对于 $100\%$ 的数据：$1\leq n\leq 300,\ \ 1\leq m\leq 10^5,\ \ t\in \{0,1\},\ \ 1\leq u,v\leq n,\ \ 1\leq w\leq 10^9$。

对于测试点 $1,2,3,4,5,6$，$t=0$；对于测试点 $7,8,9,10,11$，$t=1$。

图中 **可能** 存在重边和自环，重边算作多条边。


---

---
title: "[省选联考 2020 B 卷] 丁香之路"
layout: "post"
diff: 省选/NOI-
pid: P6628
tag: ['贪心', '2020', '并查集', '各省省选', '生成树', '欧拉回路']
---
# [省选联考 2020 B 卷] 丁香之路
## 题目描述

春暖花开，万物复苏，随着疫情的逐渐过去，Yazid 带着他的 $n$ 个好朋友来到 T 大校园参观游览。方便起见，我们将他们从 $1$ 至 $n$ 编号。

T 大校园的版图可以抽象成一张 $n$ 个顶点的无向图（顶点编号从 $1$ 至 $n$）。且对于任意两个不同顶点，设它们的编号分别为 $i, j(i\neq j)$，则它们之间有一条需要花费 $|i - j|$ 单位时间通过的无向边。

丁香花是 T 大的校花之一。时下正值丁香花盛开之际，校园内的 $m$ 条道路上都开有丁香花。Yazid 的朋友们对丁香花十分感兴趣，因此他们都希望遍历**所有**开有丁香花的 $m$ 条道路。

Yazid 的朋友们从顶点 $s$ 出发。其中，第 $i$ 个朋友希望以顶点 $i$ 为终点终止他的参观。与此同时，如上面所述，每个朋友都必须经过开着丁香花的 $m$ 条道路各至少一次。

Yazid 的朋友不想太过疲累，因此他们希望花尽可能少的时间来完成他们的目标。

请你计算 Yazid 的朋友们分别需要花费多少单位时间完成他们的目标。
## 输入格式

第一行 $3$ 个非负整数 $n, m, s$。保证 $1\le s\le n$；保证 $m\le \frac {n(n-1)}2$。

第 $2$ 行至第 $m+1$ 行，每行 $2$ 个整数 $u, v$，描述一条开有丁香花的，连接顶点 $u, v$ 的无向边。保证 $1\le u, v\le n$ 且 $u\neq v$；保证每条无向边至多被描述一次。

对于输入的所有行，用单个空格将行内的多个整数隔开。
## 输出格式

输出一行 $n$ 个用单个空格隔开的整数，其中第 $i$ 个整数描述 Yazid 的第 $i$ 个朋友完成目标所需花费的最少时间。

## 样例

### 样例输入 #1
```
4 3 1
1 2
4 2
3 1
```
### 样例输出 #1
```
6 7 8 7
```
### 样例输入 #2
```
6 0 2
```
### 样例输出 #2
```
1 0 1 2 3 4
```
### 样例输入 #3
```
5 4 1
1 2
3 4
4 5
3 5
```
### 样例输出 #3
```
8 7 6 7 8
```
## 提示

**样例解释 1**

第 $1$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $2, 4, 3$，最终回到 $1$，消耗 $|1-2|+|2-4|+|4-3|+|3-1| = 6$ 单位时间。

第 $2$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $2, 4, 3, 1$，最终来到 $2$，消耗 $7$ 单位时间。

第 $3$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $2, 4, 1$，最终来到 $3$，消耗 $8$ 单位时间。

第 $4$ 个朋友的一种最优路线是从 $1$ 出发依次途径 $3, 1, 2$，最终来到 $4$，消耗 $7$ 单位时间。

**样例解释 2**

由于 $m = 0$，没有必经之路，因此每个朋友直接通过一条边直达目的地即可。


**数据范围与约定**

| 测试点编号  |  $n=$  | 其他特殊限制 |
| --------- | ---- | ---------- |
|  $1\sim 3$  |  $50$  |    $m=9$     |
|  $4\sim 6$  |  $50$  |    $m=15$    |
|  $7\sim 8$  |  $50$  |              |
| $9\sim 10$  | $300$  |              |
|    $11$     | $1600$ |    $m=0$     |
| $12\sim 14$ | $1600$ |    $m=1$     |
| $15\sim 17$ | $1600$ |              |
| $18\sim 20$ | $2500$ |              |


---

---
title: "既见君子"
layout: "post"
diff: 省选/NOI-
pid: P7437
tag: ['O2优化', '生成树', '线性代数', '高斯消元', '状压 DP']
---
# 既见君子
## 题目背景

友情客串：wygz（无忧公主）

wygz 每次从进校到机房，都要尽量避开“屠夫”老师。然而，有一天，她忽然发现一些门上居然贴了“请勿从此门进出”的标签！
## 题目描述

校园可以抽象成一张 $n$ 个点 $m$ 条无向边（可能有重边，无自环）的**连通**无向图，点从 $1$ 标号到 $n$。校门在 $1$ 号点，而机房在 $n$ 号点，屠老师的办公室在点 $z$（$z\ne 1,n$）。

然而，工作人员（~~其实是樱初音~~）封锁了其中的 $m-n+1$ 条边，使得剩余的图（包括所有点以及剩余的边）仍然连通，此时任意两点之间有且仅有一条简单路径。工作人员会**等概率地**选择一种封锁方案。（若 $m=n-1$ 则不封锁任何边，保持不变）

wygz 当然不希望屠老师的办公室出现在她的必经之路上。她希望你算出从校门到机房的路径**必须**经过屠老师的办公室的概率。答案对 $998244353$ 取模。
## 输入格式

第一行三个正整数 $n$、$m$ 和 $z$，表示点数、边数和屠老师的办公室的位置。

以下 $m$ 行，每行两个正整数 $u$、$v$，表示一条连接 $u$ 和 $v$ 的无向边。
## 输出格式

一行一个非负整数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
4 5 2
1 2
1 3
2 3
2 4
3 4
```
### 样例输出 #1
```
374341633
```
### 样例输入 #2
```
6 8 4
1 2
1 3
2 3
2 4
2 5
4 5
4 6
5 6
```
### 样例输出 #2
```
374341633
```
## 提示

#### 样例解释：
样例 #1：生成树共 $8$ 个，有 $5$ 个满足 $1$ 到 $4$ 经过 $2$。$\dfrac 5 8\equiv 374341633\pmod {998244353}$。

样例 #2：生成树共 $24$ 个，有 $15$ 个满足 $1$ 到 $6$ 经过 $4$。$\dfrac {15} {24}\equiv 374341633\pmod {998244353}$。

#### 数据范围：

| 数据点编号 | $n$ | $m$ |
| :----------: | :----------: | :----------: |
| $1$ | $=3$ | $\le 5$ |
| $2$ | $=3$ | $\le 10^5$ |
| $3,4$ | $=7$ | $\le 15$ |
| $5,6$ | $=7$ | $\le 10^5$ |
| $7$ | $=20$ | $=n-1$ |
| $8,9$ | $=20$ | $=n$ |
| $10,11,12$ | $=18$ | $\le 10^5$ |
| $13,14,15,16$ | $=19$ | $\le 10^5$ |
| $17,18,19,20$ | $=20$ | $\le 10^5$ |

对 $100\%$ 的数据，$3\le n\le 20$，$n-1\le m\le 10^5$，$z\ne 1$ 且 $z\ne n$。

**数据保证输入的图的生成树个数模 $998244353$ 非零。**


---

---
title: "[蓝桥杯 2015 省 A] 灾后重建"
layout: "post"
diff: 省选/NOI-
pid: P8626
tag: ['2015', '生成树', '蓝桥杯省赛', '根号分治']
---
# [蓝桥杯 2015 省 A] 灾后重建
## 题目描述

Pear 市一共有 $N$（$ \le 50000$）个居民点，居民点之间有 $M$（$ \le 2\times 10^5$）条双向道路相连。这些居民点两两之间都可以通过双向道路到达。这种情况一直持续到最近，一次严重的地震毁坏了全部 $M$ 条道路。

震后，Pear 打算修复其中一些道路，修理第 $i$ 条道路需要 $P_i$ 的时间。不过，Pear 并不打算让全部的点连通，而是选择一些标号特殊的点让他们连通。

Pear 有 $Q$（$ \le 50000$）次询问，每次询问，他会选择所有编号在 $[l,r]$ 之间，并且编号 $\bmod{K}=C$ 的点，修理一些路使得它们连通。由于所有道路的修理可以同时开工，所以完成修理的时间取决于花费时间最长的一条路，即涉及到的道路中 $P_i$ 的最大值。

你能帮助 Pear 计算出每次询问时需要花费的最少时间么？这里询问是独立的，也就是上一个询问里的修理计划并没有付诸行动。
## 输入格式

第一行三个正整数 $N$、$M$、$Q$，含义如题面所述。

接下来 $M$ 行，每行三个正整数 $X_i$、$Y_i$、$P_i$，表示一条连接 $X_i$ 和 $Y_i$ 的双向道路，修复需要 $P_i$ 的时间。可能有自环，可能有重边。$1 \le P_i \le 10^6$。

接下来 $Q$ 行，每行四个正整数 $L_i$、$R_i$、$K_i$、$C_i$，表示这次询问的点是 $[L_i,R_i]$ 区间中所有编号 $\bmod{K_i}=C_i$ 的点。保证参与询问的点至少有两个。
## 输出格式

输出 $Q$ 行，每行一个正整数表示对应询问的答案。
## 样例

### 样例输入 #1
```
7 10 4
1 3 10
2 6 9
4 1 5
3 7 4
3 6 9
1 5 8
2 7 4
3 2 10
1 7 6
7 6 9
1 7 1 0
1 7 3 1
2 5 1 0
3 7 2 1
```
### 样例输出 #1
```
9
6
8
8
```
## 提示

对于 $20\%$ 的数据，$N,M,Q \le 30$。

对于 $40\%$ 的数据，$N,M,Q \le 2000$。

对于 $100\%$ 的数据，$N \le 50000,M \le 2 \times 10^5,Q \le 50000.P_i \le 10^6.L_i,R_i,K_i$ 均在 $[1,N]$ 范围内，$C_i$ 在 $[0,K_i)$ 范围内。

时限 5 秒, 256M。

蓝桥杯 2015 年省赛 A 组 J 题。


---

---
title: "[YsOI2022] 道路修建"
layout: "post"
diff: 省选/NOI-
pid: P8950
tag: ['堆', '洛谷原创', '生成树', '可并堆']
---
# [YsOI2022] 道路修建
## 题目背景

Ysuperman 正在给他幼儿园里的小朋友们准备一场模板测试，下面是一道模板题，他希望你可以帮他验一下题目。
## 题目描述

某地新建了 $n$ 座城市，拟定建造 $m$ 条**单向**道路，其中第 $i$ 条道路起点为 $u_i$，终点为 $v_i$，建造费用为正整数 $w_i$。

然而在道路开始修建之前突发紧急情况，需要马上选择这些道路中的一些来修建使得所有城市的人都可以走到某 $k$ 座城市中（也就是说，所有城市的人都可以走到这 $k$ 座城市中的**至少一座**城市中），你想要知道，如果这 $k$ 座城市是等概率随机在 $n$ 座城市中的选定的，那么期望的最小修建费用是多少。

为了避免分数输入输出，你只需要输出答案对 $998244353$ 取模的结果。
## 输入格式

第一行三个非负整数 $n,m,k$ 表示城市数量、拟定建造公路数量以及待选定的城市数量。

接下来 $m$ 行，每行三个正整数 $u_i,v_i,w_i$ 描述一条拟定建造的单向公路。
## 输出格式

特别的，如果存在一种选定 $k$ 座城市的方式使得无论如何修建道路都总存在某座城市无法到达这 $k$ 座城市中的任意一座，请输出 `-1`。

否则输出一行一个整数表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3 4 1
1 2 1
2 1 2
2 3 3
3 1 4
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4 6 2
1 2 1
1 3 3
2 3 2
3 4 5
4 1 4
4 2 6
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
8 16 3
5 6 7
7 2 10
4 6 4
5 7 5
8 4 12
1 3 8
2 3 6
4 1 8
1 7 2
8 3 1
2 5 3
6 4 11
7 3 14
3 8 9
8 1 13
6 7 16
```
### 样例输出 #3
```
160432162
```
### 样例输入 #4
```
4 1 3
2 4 1
```
### 样例输出 #4
```
-1
```
## 提示

#### 样例 1 解释

总共有三种选定集合城市的方案：

1. 选定集合在城市 $1$，那么选择建造 $2\to 1,3\to 1$ 两条道路花费最少，为 $2+4=6$。

2. 选定集合在城市 $2$，那么选择建造 $1\to 2,3\to 1$ 两条道路花费最少，为 $1+4=5$。

3. 选定集合在城市 $3$，那么选择建造 $1\to 2,2\to 3$ 两条道路花费最少，为 $1+3=4$。

所以期望最小花费为 $(6+5+4)/3=5$。

#### 样例 2 解释

有 $6$ 种选择集合城市的方法：

1. 选城市 $1,2$，最小花费 $9$。

2. 选城市 $1,3$，最小花费 $6$。

3. 选城市 $1,4$，最小花费 $7$。

4. 选城市 $2,3$，最小花费 $5$。

5. 选城市 $2,4$，最小花费 $6$。

6. 选城市 $3,4$，最小花费 $3$。

所以期望最小花费为 $(9+6+7+5+6+3)\div 6=6$。

#### 样例 3 解释

这里太小写不下，只配个图算了：

![](https://cdn.luogu.com.cn/upload/image_hosting/cdnuoook.png)

#### 样例 4 解释

当集合城市选在 $1,2,3$ 时，城市 $4$ 无论如何都无法达到 $1,2,3$ 中的任意一个，所以答案为 $-1$。

#### 数据范围

对于 $10\%$ 的数据，满足 $n\le 15$，$m\le 30$。

对于 $30\%$ 的数据，满足 $n\le 20$，$m\le 50$。

另有 $5\%$ 的数据，满足所有 $w_i$ 相等。

另有 $5\%$ 的数据，满足 $k=n$。

另有 $5\%$ 的数据，满足 $k=n-1$。

另有 $10\%$ 的数据，满足 $m=n$。

另有 $20\%$ 的数据，满足 $k=1$。

对于 $100\%$ 的数据，满足 $2\le n\le 10^5$，$1\le m\le 2\times 10^5$，$1\le k\le n$，$1\le u_i,v_i\le n$，$0\le w_i\le 998244352$。


---

---
title: "[ICPC 2021 Macao R] LCS Spanning Tree"
layout: "post"
diff: 省选/NOI-
pid: P9664
tag: ['2021', '后缀自动机 SAM', 'O2优化', '生成树', '后缀数组 SA', '后缀树', 'ICPC', '澳门']
---
# [ICPC 2021 Macao R] LCS Spanning Tree
## 题目描述

Given a complete undirected graph of $n$ vertices and $n$ strings $s_1, s_2, \cdots, s_n$, the weight of edge connecting vertices $i$ and $j$ is equal to the length of the longest common substring (LCS) between $s_i$ and $s_j$. Compute the maximum total weight of any spanning tree on this graph.

A substring of a string can be obtained by removing some (possibly zero) characters from the beginning and/or the end of that string. For example, ``maca``, ``aca`` and ``cau`` are all substrings of ``macau``, while ``acu`` is not.
## 输入格式

There is only one test case in each test file.

The first line of the input contains one integer $n$ ($1 \leq n \leq 2 \times 10^6$) indicating the number of vertices and strings.

For the following $n$ lines, the $i$-th line contains one string $s_i$ ($1 \le |s_i| \le 2 \times 10^6$) consisting only of lowercase English letters.

It's guaranteed that the sum of lengths of all strings will not exceed $2 \times 10^6$.
## 输出格式

Output one line containing one integer indicating the answer.
## 样例

### 样例输入 #1
```
4
icpc
macau
regional
contest
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
3
ababa
babab
aba
```
### 样例输出 #2
```
7
```
## 题目翻译

**【题目描述】**

给定一个有 $n$ 个顶点的完全无向图和 $n$ 个字符串 $s_1, s_2, \cdots, s_n$，连接顶点 $i$ 和 $j$ 的边的权重等于字符串 $s_i$ 和 $s_j$ 的最长公共子串（LCS）的长度。计算此图上任意生成树的最大总权重。

一个字符串的子串可以通过从该字符串的开头和/或结尾删除一些（可能为零）字符来获得。例如，“maca”、“aca” 和“cau”都是“macau”的子串，而“acu”不是。

**【输入格式】**

每个测试文件中包含一个测试用例。

输入的第一行包含一个整数 $n$ ($1 \leq n \leq 2 \times 10^6$)，表示顶点和字符串的数量。

接下来的 $n$ 行，第 $i$ 行包含一个字符串 $s_i$ ($1 \le |s_i| \le 2 \times 10^6$)，由小写英文字母组成。

保证所有字符串的长度之和不超过 $2 \times 10^6$。

**【输出格式】**

输出一行，包含一个整数，表示答案。

翻译来自于：[ChatGPT](https://chatgpt.com/)


---

---
title: "[GDCPC 2023] Classic Problem"
layout: "post"
diff: 省选/NOI-
pid: P9701
tag: ['2023', '广东', 'O2优化', '生成树', 'XCPC']
---
# [GDCPC 2023] Classic Problem
## 题目描述

Given an undirected complete graph with $n$ vertices and $m$ triples $P_1, P_2, \cdots, P_m$ where $P_i = (u_i, v_i, w_i)$, it's guaranteed that $1 \leq u_i < v_i \leq n$, and for any two triples $P_i$ and $P_j$ with different indices we have $(u_i, v_i) \ne (u_j, v_j)$.

For any two vertices $x$ and $y$ in the graph ($1 \leq x < y \leq n$), define the weight of the edge connecting them as follows:

- If there exists a triple $P_i$ satisfying $u_i = x$ and $v_i = y$, the weight of edge will be $w_i$.
- Otherwise, the weight of edge will be $|x - y|$.

Calculate the total weight of edges in the minimum spanning tree of the graph.
## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$ ($1 \le T \le 10^5$) indicating the number of test cases. For each test case:

The first line contains two integers $n$ and $m$ ($1 \leq n \leq 10^9$, $0 \leq m \leq 10^5$) indicating the number of vertices in the graph and the number of triples.

For the following $m$ lines, the $i$-th line contains three integers $u_i$, $v_i$ and $w_i$ ($1 \leq u_i < v_i \leq n$, $0 \leq w_i \leq 10^9$) indicating the $i$-th triple. It's guaranteed that for all $1 \leq i < j \leq m$ we have $(u_i, v_i) \ne (u_j, v_j)$.

It's guaranteed that the sum of $m$ of all test cases will not exceed $5 \times 10^5$.
## 输出格式

For each test case output one line containing one integer indicating the total weight of edges in the minimum spanning tree of the graph.
## 样例

### 样例输入 #1
```
3
5 3
1 2 5
2 3 4
1 5 0
5 0
5 4
1 2 1000000000
1 3 1000000000
1 4 1000000000
1 5 1000000000
```
### 样例输出 #1
```
4
4
1000000003
```
## 提示

The first sample test case is illustrated as follows. The minimum spanning tree is marked by red segments.

![](https://cdn.luogu.com.cn/upload/image_hosting/4gvbji8a.png)

The second sample test case is illustrated as follows. The minimum spanning tree is marked by red segments.

![](https://cdn.luogu.com.cn/upload/image_hosting/5cfsvoie.png)

The third sample test case is illustrated as follows. The minimum spanning tree is marked by red segments.

![](https://cdn.luogu.com.cn/upload/image_hosting/iyzb4xpg.png)
## 题目翻译

**【题目描述】**

给定一张 $n$ 个点的无向完全图与 $m$ 个三元组 $P_1, P_2, \cdots, P_m$，其中 $P_i = (u_i, v_i, w_i)$。保证 $1 \leq u_i < v_i \leq n$，且对于任意两个编号不同的三元组 $P_i$ 和 $P_j$，有 $(u_i, v_i) \ne (u_j, v_j)$。

对于图中的任意两个节点 $x$ 与 $y$（$1 \leq x < y \leq n$），定义它们之间的无向边的边权如下：

- 如果存在一个三元组 $P_i$ 满足 $u_i = x$ 且 $v_i = y$，那么边权为 $w_i$。
- 否则，边权为 $|x - y|$。

求这张图的最小生成树的边权之和。

**【输入格式】**

有多组测试数据。第一行输入一个整数 $T$（$1 \le T \le 10^5$）表示测试数据组数。对于每组测试数据：

第一行输入两个整数 $n$ 和 $m$（$1 \leq n \leq 10^9$，$0 \leq m \leq 10^5$）表示图的点数与三元组的数量。

对于接下来 $m$ 行，第 $i$ 行输入三个整数 $u_i$，$v_i$ 和 $w_i$（$1 \leq u_i < v_i \leq n$，$0 \leq w_i \leq 10^9$）表示第 $i$ 个三元组。保证对于所有 $1 \leq i < j \leq m$ 都有 $(u_i, v_i) \ne (u_j, v_j)$。

保证所有数据 $m$ 之和不超过 $5 \times 10^5$。

**【输出格式】**

每组数据输出一行一个整数，表示这张图的最小生成树的边权之和。

**【样例解释】**

第一组样例数据如下图所示，最小生成树用红色线段标出。

![](https://cdn.luogu.com.cn/upload/image_hosting/4gvbji8a.png)

第二组样例数据如下图所示，最小生成树用红色线段标出。

![](https://cdn.luogu.com.cn/upload/image_hosting/5cfsvoie.png)

第三组样例数据如下图所示，最小生成树用红色线段标出。

![](https://cdn.luogu.com.cn/upload/image_hosting/iyzb4xpg.png)


---


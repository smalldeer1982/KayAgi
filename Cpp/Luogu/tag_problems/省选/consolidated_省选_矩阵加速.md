---
title: "[信息与未来 2024] AI 机器人"
layout: "post"
diff: 省选/NOI-
pid: B3983
tag: ['模拟', '搜索', '2024', '矩阵运算', '江苏', '分治', '记忆化搜索', '矩阵加速', '信息与未来']
---
# [信息与未来 2024] AI 机器人
## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/27icb51c.png)

在 $n$ 行 $m$ 列的矩形空间中有一个机器人。矩形空间的每一个格子要么是平地（用半角点号 `.` 表示），要么是障碍物 （用井号表示 `#`）。以下是一个 $n = 3, m = 7$ 的例子：

```
...#...
...#...
.......
```

初始时,机器人位于矩形的左上角 （第一行、第一列）。每一时刻，机器人可以遵照程序执行 `U`（Up，向上）、`L` （Left，向左）、 `D` （Down，向下）、`R` （Right，向右） 四种指令中的一个，尝试向某个方向移动一格；如果移动的目标格子超出了边界或是障碍物，则保持原地不动，例如执行程序：

`LLLRRRRRRRRRDDDDRRRRRRRRR`

后，机器人会从空间的左上角移动到右下角。Dr. X 扩展了机器人程序的表达能力,引入了循环。给定程序 `P`，`(P)n` 相当于把程序 `P`“复制粘贴”$n$ 次。循环可以嵌套。例如，在足够大且无阻挡的空间中执行程序：

`(R(DRUL)7)5`

会重复 $5$ 次执行“向右移动一格、转圈 $7$ 次”，而如果机器人在 $n = 1, m = 2$ 的空间中执行上述程序，就会表现为“左右横跳”。

Dr. X 还给机器人装备了人工智能，对于某些指定的循环，机器人可以由深度神经网络自主决定循环的次数（$0$ 次或任意多次），用星号 `*` 表示，例如

`(DR(R)*)3`

外层循环会执行 $3$ 次，由于循环“复制粘贴”的特性，每次向下向右移动一格后，机器人可以根据自己的想法向右移动 $0$ 格或任意多格。人工智能循环也可以嵌套，根据循环“先外层后里层”的执行顺序，总是先确定外层人工智能循环的执行次数，再按照“复制粘贴”的规则执行内层循环代码。

人工智能模块使机器人的行为变得难以预测。给定一个机器人程序，Dr. X 想知道，哪些格子是机器人在执行程序过程中绝无可能经过的（即无论机器人如何选择循环执行的次数，都不会经过）？这样他可以在这些格子上安装监控，并在观察到机器人行为失控的时候及时制止。
## 输入格式

输入第一行两个空格分隔的整数 $n$ 和 $m$，代表矩形空间的大小为 $n$ 行、$m$ 列。

接下来 $n$ 行，每行 $m$ 个字符，描述了矩形空间。其中半角点号为平地、井号为障碍物。

输入最后一行是一个字符串，为机器人执行的程序。程序由 $\tt{U/L/D/R}$、圆括号、正整数、星号组成。输入程序保证合法：圆括号总是正确配对，且之后紧跟一个正整数或一个星号。除此之外，程序中所有的字符都是 $\tt{U,L,D}$ 或 $\tt{R}$。机器人初始时位于左上角，输入保证左上角不是障碍物。**固定次数循环的次数总是在 $1$ 到 $9$ 之间。**
## 输出格式

输出 $n$ 行，每行 $m$ 个字符，按顺序输出矩形空间中每个格子的计算结果。如果是障碍物格子，输出井号 `#`。如果是机器人选择适当的循环次数可以到达的平地格子，输出加号 `+`。否则输出半角点号 `.`。
## 样例

### 样例输入 #1
```
3 7
...#...
...#...
.......
LLLRRRRRRRRRDDDDRRRRRRRRR
```
### 样例输出 #1
```
+++#...
..+#...
..+++++
```
### 样例输入 #2
```
3 7
...#...
##.....
.......
(R(DRUL)7)5
```
### 样例输出 #2
```
+++#...
##+++++
..+++++
```
### 样例输入 #3
```
3 7
.......
.#####.
.......
(R)*(D)*
```
### 样例输出 #3
```
+++++++
+#####+
+.....+
```
## 提示

对于 $30\%$ 的数据，输入程序不含星号 `*` 且在 $10^5$ 步内终止。

对于另外 $30\%$ 的数据，输入程序中不含星号 `*`。

对于 $100\%$ 的数据，$1 \leq n, m \leq 10$，且输入程序的长度不超过 $1000$。

>本题原始满分为 $20\text{pts}$。


---

---
title: "「FAOI-R5」波特检测"
layout: "post"
diff: 省选/NOI-
pid: P11658
tag: ['动态规划 DP', '2025', '洛谷原创', 'O2优化', '矩阵加速', '组合数学', '快速数论变换 NTT', '洛谷比赛']
---
# 「FAOI-R5」波特检测
## 题目背景

正在验证您是否是真人。这可能需要几秒钟时间。
## 题目描述

小 H 是一个 bot，他内置一个序列 $\{A_n\}$ 和一个长度为 $n$ 的 01 串 $H$。询问他一个区间 $[l,r]$，他可以给出一个**集合** $g(l,r)$:
- 设置序列 $\{B_n\}$，对于 $i=1,2,\ldots,n$，执行以下操作：
  - 如果 $H_i=\tt{0}$，$B_i=A_i$（即小 H 不能修改 $A_i$ 的值）；
  - 如果 $H_i=\tt{1}$，可以任意选择一个非负整数 $v$，令 $B_i=v$（即小 H 可以任意修改 $A_i$ 的值，**修改后的值可以不在 $\boldsymbol{[0,2^k-1]}$ 范围内**）。
- $g(l,r)=\{B_l\operatorname{xor}B_{l+1},B_{l+1}\operatorname{xor}B_{l+2},\cdots,B_{r-1}\operatorname{xor}B_{r}\}$。

喵仔牛奶需要对小 H 进行若干次检测，每次选取 $[l,r],[L,R]$ 两个区间，满足 $r\le L$，并向小 H 询问得出 $g(l,r),g(L,R)$。若 $g(l,r)\cap g(L,R)\neq\varnothing$，则检测失败，小 H 的 bot 身份会被发现。

若小 H 存在一种策略可以回答所有可能的询问并不存在检测失败（也就是对于任意满足 $r\le L$ 区间 $[l,r],[L,R]$ 都不会检测失败），我们就称这个 01 串 $H$ 是「可用的」。

给定 $n,k$，序列 $\{A_n\}$ 的每一项都在 $[0,2^k-1]$ 中均匀随机选取。你需要求出「可用的」01 串 $H$ 的个数的期望值。答案对 $998244353$ 取模。
## 输入格式

一行两个非负整数 $n,k$，表示序列长度与值域大小。
## 输出格式

一行一个非负整数，表示「可用的」01 串 $H$ 的个数的期望值对 $998244353$ 取模后的结果。

如果你不知道如何进行有理数取模：
- 令 $M=998244353$。可以证明，答案可以被表示为最简分数 $\frac{p}{q}$，其中 $p$ 和 $q$ 是正整数且 $q\not\equiv 0\pmod M$。你只需要输出一个非负整数 $x\in[0,M)$ 使得 $x\cdot q\equiv p\pmod M$。
- 如果你不知道如何找出所述的 $x$，可以参考 P2613。
## 样例

### 样例输入 #1
```
1 0
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
2 1
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
3 1
```
### 样例输出 #3
```
499122184
```
### 样例输入 #4
```
5 2
```
### 样例输出 #4
```
655097885
```
### 样例输入 #5
```
10 3
```
### 样例输出 #5
```
972670600
```
### 样例输入 #6
```
114 514
```
### 样例输出 #6
```
802524221
```
## 提示

### 样例 1 解释

唯一一种可能的情况是 $A=[0]$，此时 $H=\tt 0$ 和 $H=\tt 1$ 都是「可用的」，故答案为 $2$。

### 样例 2 解释

有以下 $4$ 种可能的情况：

- $A=[0,0]$。
- $A=[0,1]$。
- $A=[1,0]$。
- $A=[1,1]$。

在不修改的情况下，它们都能通过检测（对应的答案均为 $2^2=4$），故答案为 $2^2=4$。

### 样例 3 解释

有以下 $8$ 种可能的情况：
- $A=[0,0,0]$，$H$ 的个数为 $7$。
- $A=[0,0,1]$，$H$ 的个数为 $8$。
- $A=[0,1,0]$，$H$ 的个数为 $7$。
- $A=[0,1,1]$，$H$ 的个数为 $8$。
- $A=[1,0,0]$，$H$ 的个数为 $8$。
- $A=[1,0,1]$，$H$ 的个数为 $7$。
- $A=[1,1,0]$，$H$ 的个数为 $8$。
- $A=[1,1,1]$，$H$ 的个数为 $7$。

当 $A=[0,1,0]$ 时，$H=\tt{000}$ 不是「可用的」。当询问 $[1,2],[2,3]$ 时：
- 小 H 每次只能原封不动地保留 $A$。
- 当询问 $[1,2]$ 时，$g(1,2)=\{1\}$。
- 当询问 $[2,3]$ 时，$g(2,3)=\{1\}$。
- $g(1,2)\cap g(2,3)=\{1\}$，检测失败。

当 $A=[1,1,1]$ 时，$H=\tt{010}$ 是「可用的」。当询问 $[1,2],[2,3]$ 时：
- 小 H 可以任意修改 $A$ 的值，**并且每次询问时修改的值可以不一样**。
- 当询问 $[1,2]$ 时，小 H 令 $B=[1,2,1]$，$g(1,2)=\{3\}$。
- 当询问 $[2,3]$ 时，小 H 令 $B=[1,1,1]$，$g(2,3)=\{0\}$。
- $g(1,2)\cap g(2,3)=\varnothing$，检测成功。

故答案为 $(7\times 4+8\times 4)\times\dfrac{1}{8}=\dfrac{15}{2}$。

注意到 $2\times 499122184\equiv 15\pmod{998244353}$，答案即为 $499122184$。

### 样例 4 解释

答案为 $\dfrac{907}{32}\equiv655097885\pmod{998244353}$。

### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（10 pts）：$n\leq2$。
- Subtask 2（10 pts）：$n\leq 6$，$k\leq 2$。
- Subtask 3（10 pts）：$n\leq 50$，$k\leq6$。
- Subtask 4（10 pts）：$n\leq 500$，$k\leq 20$。
- Subtask 5（20 pts）：$n\leq 2\times10^3$。
- Subtask 6（20 pts）：$n\leq 5\times10^4$。
- Subtask 7（20 pts）：无特殊限制。

对于所有数据，$1\leq n\leq 10^6$，$0\leq k\leq 10^9$。


---

---
title: "[USTCPC 2025] 生成树！"
layout: "post"
diff: 省选/NOI-
pid: P12046
tag: ['数学', '2025', '矩阵加速', '高校校赛']
---
# [USTCPC 2025] 生成树！
## 题目背景

克露丝卡尔酱喜欢生成树！

克露丝卡尔酱认为对称结构十分完美！

克露丝卡尔酱可爱！
## 题目描述

克露丝卡尔酱想要计数 **$n+1$ 个点的 $k$ 阶轮**的生成树个数。

**$n+1$ 个点的 $k$ 阶轮**的定义为：

- $0$ 为中心，$1\sim n$ 构成一个环（对于 $1 \le i <n$，$i$ 和 $i+1$ 之间有连边，$1$ 和 $n$ 之间有连边）。
- 对于 $1 \le i \le \dfrac{n}{k}$，$0$ 和 $ik$ 之间有额外连边。

**保证 $n \bmod k = 0$，答案对 $10^9+7$ 取模。**
## 输入格式

一行两个正整数 $n,k$。$1 \le k \le n \le 10^{18}$，$n \ge 3$，**保证 $n \bmod k = 0$**。
## 输出格式

一行一个正整数，表示答案。**答案对 $10^9+7$ 取模。**
## 样例

### 样例输入 #1
```
4 1
```
### 样例输出 #1
```
45
```
### 样例输入 #2
```
6 2
```
### 样例输出 #2
```
50
```
## 提示

两个样例中的轮分别为：

![](https://cdn.luogu.com.cn/upload/image_hosting/4fgbshrn.png)


---

---
title: "[NWRRC2024] Capybara Cozy Carnival"
layout: "post"
diff: 省选/NOI-
pid: P12107
tag: ['动态规划 DP', '2024', '分治', '矩阵加速', '组合数学', 'ICPC', '俄罗斯西北']
---
# [NWRRC2024] Capybara Cozy Carnival
## 题目描述

Chilling capybaras celebrate Capybara Cozy Carnival. Chairman capybara cuts convex cake. Cake contains $n$ colorful corners. Countless colors comprise $k$ choices. Creating $m$ continuous crossing-free corner-to-corner cuts, chairman cuts cake chunks, catering $m + 1$ comrades. Curiously, consecutive cake chunks corners contain contrasting colors. 

Calculate cake corners color combinations, considering cuts conditions.

In other words, you are given a cake in the shape of a regular $n$-sided polygon and $m$ non-intersecting diagonal cuts, which divide it into $m + 1$ slices.

Calculate the number of ways to color each corner of the original cake with one of the $k$ colors, such that no two neighboring corners of the resulting slices have the same color. Two corners are considered neighboring if they are either consecutive in the original cake, or they are the endpoints of the same cut. It is not necessary to use all the colors. As the number of ways might be large, find it modulo $998\,244\,353$.
## 输入格式

Each test contains multiple test cases. The first line contains the number of test cases $t$ ($1 \le t \le 10^4$). The description of the test cases follows.

The first line of each test case contains three integers $n$, $m$, and $k$, denoting the number of cake corners, the number of cuts, and the number of available colors ($3 \le n \le 10^9$; $0 \le m \le 2\cdot 10^5$; $2 \le k \le 10^6$).

The $i$-th of the following $m$ lines contains two integers $u_i$ and $v_i$, denoting the corners connected by the $i$-th cut ($1 \le u_i < v_i \le n$). No two cuts may coincide or intersect except at the ends of the cuts. All cuts are straight, going strictly inside the cake.

It is guaranteed that the sum of $m$ over all test cases does not exceed $2\cdot 10^5$.
## 输出格式

For each test case, print the number of ways to color the cake corners such that no two neighboring corners have the same color, modulo $998\,244\,353$. Remember that you don't have to use all the colors.
## 样例

### 样例输入 #1
```
4
4 1 3
1 3
5 0 2
9 4 3
1 3
1 6
4 6
6 8
3 0 1001
```
### 样例输出 #1
```
6
0
54
1754647
```


---

---
title: "[NOI2007] 生成树计数"
layout: "post"
diff: 省选/NOI-
pid: P2109
tag: ['动态规划 DP', '2007', 'NOI', 'O2优化', '矩阵加速', '状压 DP']
---
# [NOI2007] 生成树计数
## 题目描述

最近，小栋在无向连通图的生成树个数计算方面有了惊人的进展，他发现：

- $n$ 个结点的环的生成树个数为 $n$。
- $n$ 个结点的完全图的生成树个数为 $n^{n-2}$ 。

这两个发现让小栋欣喜若狂，由此更加坚定了他继续计算生成树个数的想法，他要计算出各种各样图的生成树数目。

一天，小栋和同学聚会，大家围坐在一张大圆桌周围。小栋看了看，马上想到了生成树问题。如果把每个同学看成一个结点，邻座（结点间距离为 $1$）的同学间连一条边，就变成了一个环。可是，小栋对环的计数已经十分娴熟且不再感兴趣。于是，小栋又把图变了一下：不仅把邻座的同学之间连一条边，还把相隔一个座位（结点间距离为 $2$）的同学之间也连一条边，将结点间有边直接相连的这两种情况统称为 有边相连，如图 $1$ 所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/5lvvgbor.png) 

小栋以前没有计算过这类图的生成树个数，但是，他想起了老师讲过的计算任意图的生成树个数的一种通用方法：构造一个 $n\times n$ 的矩阵 $A=\{ a_{i,j}\}$，其中：

$$a_{i,j}=\begin{cases}
d_i & i=j \\
-1 & \text{$i, j$ 之间有边直接相连} \\
0 & \text{其他情况}
\end{cases}$$

与图 1 相应的 $A$ 矩阵如下所示。为了计算图 1 所对应的生成数的个数，只要去掉矩阵 $A$ 的最后一行和最后一列，得到一个 $(n-1)\times(n-1)$ 的矩阵 $B$，计算出矩阵 $B$ 的行列式的值便可得到图 1 的生成树的个数。

$$
A=\begin{bmatrix}
4 & -1 & -1 & 0 & 0 & 0 & -1 & -1 \\
-1 & 4 & -1 & -1 & 0 & 0 & 0 & -1 \\
-1 & -1 & 4 & -1 & -1 & 0 & 0 & 0 \\
0 & -1 & -1 & 4 & -1 & -1 & 0 & 0 \\
0 & 0 & -1 & -1 & 4 & -1 & -1 & 0 \\
0 & 0 & 0 & -1 & -1 & 4 & -1 & -1 \\
-1 & 0 & 0 & 0 & -1 & -1 & 4 & -1 \\
-1 & -1 & 0 & 0 & 0 & -1 & -1 & 4 \\
\end{bmatrix},\\
B=\begin{bmatrix}
4 & -1 & -1 & 0 & 0 & 0 & -1  \\
-1 & 4 & -1 & -1 & 0 & 0 & 0  \\
-1 & -1 & 4 & -1 & -1 & 0 & 0 \\
0 & -1 & -1 & 4 & -1 & -1 & 0 \\
0 & 0 & -1 & -1 & 4 & -1 & -1 \\
0 & 0 & 0 & -1 & -1 & 4 & -1 \\
-1 & 0 & 0 & 0 & -1 & -1 & 4 \\
\end{bmatrix},
$$

所以生成树的个数为 $\det B =3528$。小栋发现利用通用方法，因计算过于复杂而很难算出来，而且用其他方法也难以找到更简便的公式进行计算。于是，他将图做了简化，从一个地方将圆桌断开，这样所有的同学形成了一条链，连接距离为 1 和距离为 2 的点。例如八个点的情形如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/cfo7z7yu.png) 

这样生成树的总数就减少了很多。小栋不停的思考，一直到聚会结束，终于找到了一种快捷的方法计算出这个图的生成树个数。可是，如果把距离为 $3$ 的点也连起来，小栋就不知道如何快捷计算了。现在，请你帮助小栋计算这类图的生成树的数目。

## 输入格式

输入文件中包含两个整数 $k,n$，由一个空格分隔。$k$ 表示要将所有距离不超过 $k$（含 $k$）的结点连接起来，$n$ 表示有 $n$ 个结点。
## 输出格式

输出文件输出一个整数，表示生成树的个数。由于答案可能比较大，所以你只要输出答案除 $65521$ 的余数即可。
## 样例

### 样例输入 #1
```
3 5
```
### 样例输出 #1
```
75
```
## 提示

样例对应的图如下：

$$
A = \begin{bmatrix}
3 & -1 & -1 & -1 & 0 \\
-1 & 4 & -1 & -1 & -1 \\
-1 & -1 & 4 & -1 & -1 \\
-1 & -1 & -1 & 4 & -1 \\
0 & -1 & -1 & -1 & 3 \\
\end{bmatrix},
B = \begin{bmatrix}
3 & -1 & -1 & -1 \\
-1 & 4 & -1 & -1  \\
-1 & -1 & 4 & -1  \\
-1 & -1 & -1 & 4  \\
\end{bmatrix}, \det B = 75
$$

### 数据规模和约定

| 测试点编号 |   $k$   |      $n$      |
| :--------: | :-----: | :-----------: |
|     1      |  $=2$   |   $\le 10$    |
|     2      |  $=3$   |     $=5$      |
|     3      |  $=4$   |   $\le 10$    |
|     4      |  $=5$   |     $=10$     |
|     5      | $\le 3$ |   $\le 100$   |
|     6      | $\le 5$ |   $\le 100$   |
|     7      | $\le 3$ |  $\le 2000$   |
|     8      | $\le 5$ |  $\le 10000$  |
|     9      | $\le 3$ | $\le 10^{15}$ |
|     10     | $\le 5$ | $\le 10^{15}$ |

此外，对于所有数据，$2\le k\le n$。

### 提示

以下为行列式的一种计算方法。记 $\sigma(\bm P)$ 表示排列 $\bm P$ 中逆序对的数量，那么可以求得矩阵 $B$ 的行列式如下：

$$\det B=\sum_{\bm P=[p_1,p_2,\cdots,p_n]} (-1)^{\sigma(\bm P)} \prod_{i=1}^n b_{i,p_i}$$

例如，对于 $B=\begin{bmatrix}1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 0\end{bmatrix}$，其行列式计算如下：

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|c|}\hline
\bm P & \sigma(\bm P) & b_{1,p_1} & b_{2,p_2} & b_{3,p_3} & (-1)^{\sigma(\bm P)}\prod_{i=1}^n b_{i,p_i} \\ \hline
[1, 2, 3] & 0 & 1 & 5 & 0 & 0 \\ \hline
[1, 3, 2] & 1 & 1 & 6 & 8 & -48 \\\hline
[2, 1, 3] & 1 & 2 & 4 & 0 & 0 \\\hline
[2, 3, 1] & 2 & 2 & 6 & 7 & 84 \\\hline
[3, 1, 2] & 2 & 3 & 4 & 8 & 96 \\\hline
[3, 2, 1] & 3 & 3 & 5 & 7 & -105 \\\hline
\end{array}
$$

所以 $B$ 的行列式值为 $0-48+0+84+96-105=27$。



---

---
title: "[CQOI2015] 多项式"
layout: "post"
diff: 省选/NOI-
pid: P3169
tag: ['数学', '递推', '2015', '重庆', '各省省选', '矩阵加速']
---
# [CQOI2015] 多项式
## 题目描述

在学习完二项式定理后，数学老师给出了一道题目：已知整数 $n,t$ 和 $a_k$（$0\le k\le n$），求 $b_k$（$0\le k\le n$）的表达式使得:

$$
\sum_{k=0}^n a_kx^k=\sum_{k=0}^nb_k(x-t)^k
$$

同学们很快算出了答案。见大家这么快就搞定了，老师便布置了一个更 BT 的作业：计算某个 $b_k$ 的具体数值！接着便在黑板上写下了 $n,t$ 的数值，由于 $a_k$ 实在太多，不能全写在黑板上，老师只给出了一个 $a_k$ 的递推式，让学生自行计算:

$$
a_k=
\begin{cases}
(1234\cdot a_{k-1}+5678)\bmod 3389 & k\gt 0 \\
1 & k=0 \\
\end{cases}
$$

正在学习信息竞赛的你觉得这个作业实在不适合手工完成，便敲起了代码……

## 输入格式

输入文件共三行，第一行为一个正整数 $n$，第二行为一个非负整数 $t$，第三行为一个非负整数 $m$。

## 输出格式

输出一行，为 $b_m$ 的值。
## 样例

### 样例输入 #1
```
3
2
2
```
### 样例输出 #1
```
10536
```
## 提示

数据范围：

对于 $20\%$ 的数据，$t=0$。

对于另外 $30\%$ 的数据，$n\le 10^5$。

对于 $100\%$ 的数据，$0\lt n\le 10^{3000}$，$0\le t\le 10^4$，$0\le n-m\le 5$。



---

---
title: "[POI 2010] CHO-Hamsters"
layout: "post"
diff: 省选/NOI-
pid: P3502
tag: ['2010', 'POI（波兰）', '矩阵加速', 'AC 自动机']
---
# [POI 2010] CHO-Hamsters
## 题目描述

Byteasar breeds hamsters.

Each hamster has a unique name,    consisting of lower case letters of the English alphabet.

    The hamsters have a vast and comfortable cage.

    Byteasar intends to place a display under the cage to visualize the names of his hamsters.

    This display is simply a sequence of letters, each of which can be either lit or not independently.

Only one name will be displayed simultaneously.

The lit letters forming the name have to stand next to each other,    i.e., form a contiguous subsequence.

Byteasar wants to be able to display the names of the hamsters on at least ![](http://main.edu.pl/images/OI17/cho-en-tex.1.png) different positions.

However, he allows displaying the same name on multiple different positions,    and does not require to be able to display each and every hamster's name.

Note that the occurrences of the names on the display can overlap.

You can assume that no hamster's name occurs (as a contiguous fragment) in any other hamster's name.

Bytesar asks your help in determining the minimum number of letters the display has to have.

In other words, you are to determine the minimum length of a string    (consisting of non-capital letters of the English alphabet)    that has at least ![](http://main.edu.pl/images/OI17/cho-en-tex.2.png) total occurrences of the hamsters' names (counting multiplicities).

(We say that a string ![](http://main.edu.pl/images/OI17/cho-en-tex.3.png) occurs in the string ![](http://main.edu.pl/images/OI17/cho-en-tex.4.png) if ![](http://main.edu.pl/images/OI17/cho-en-tex.5.png) forms a contiguous fragment of ![](http://main.edu.pl/images/OI17/cho-en-tex.6.png).)


## 输入格式

The first line of the standard input holds two integers ![](http://main.edu.pl/images/OI17/cho-en-tex.7.png) and ![](http://main.edu.pl/images/OI17/cho-en-tex.8.png)      (![](http://main.edu.pl/images/OI17/cho-en-tex.9.png), ![](http://main.edu.pl/images/OI17/cho-en-tex.10.png)), separated by a single space, that denote      the number of Byteasar's hamsters and the minimum number of occurrences of the hamsters' names on the display.

Each of the following ![](http://main.edu.pl/images/OI17/cho-en-tex.11.png) lines contains a non-empty string of non-capital letters of the English alphabet      that is the hamster's name.

The total length of all names does not exceed ![](http://main.edu.pl/images/OI17/cho-en-tex.12.png) letters.

## 输出格式

The first and only line of the standard output should hold a single integer      - the minimum number of letters the display has to have.

## 样例

### 样例输入 #1
```
4 5
monika
tomek
szymon
bernard
```
### 样例输出 #1
```
23
```
## 提示

$1\le n\le 200$，$1\le m\le 10^9$ ，所有字符串的总长 $\le 10^5$。

## 题目翻译

给出 $n$ 个互不包含的字符串，要求你求出一个最短的字符串 $S$，使得这 $n$ 个字符串在 $S$ 中总共至少出现 $m$ 次，问 $S$ 最短是多少。


---

---
title: "[BJOI2017] 魔法咒语"
layout: "post"
diff: 省选/NOI-
pid: P3715
tag: ['字符串', '2017', '各省省选', '矩阵加速', 'AC 自动机', '构造']
---
# [BJOI2017] 魔法咒语
## 题目描述

Chandra 是一个魔法天才。

从一岁时接受火之教会洗礼之后，Chandra 就显示出对火元素无与伦比的亲和力，轻而易举地学会种种晦涩难解的法术。这也多亏 Chandra 有着常人难以企及的语言天赋，让她能轻松流利地说出咒语中那些极其拗口的魔法词汇。

直到十四岁，开始学习威力强大的禁咒法术时，Chandra 才遇到了障碍。

根据火之魔法规则，禁咒的构成单位是 $N$ 个基本词汇。施法时只要凝聚精神力，说出一段用这些词语组成的长度恰好等于 $L$ 的语言，就能释放威力超乎想象的火法术。过去的魔法师们总结了几种表达起来最连贯的组合方式，方便施法者以最快语速完成法术。

但具有魔法和语言双重天才的 Chandra 不满足于这几种流传下来的禁咒，因为她可以毫无困难地说出普通人几乎不可能表达的禁咒语句。然而，在实际施法时，Chandra 发现有些自创禁咒念出后不但没有预期效果，反而会使自己的精神力迅速枯竭，十分难受。

这个问题令 Chandra 万分不解。她大量阅读典籍，到处走访魔法学者，并且不顾精神折磨一次又一次尝试新咒语，希望找出问题的答案。

很多年过去了，在一次远古遗迹探险中，Chandra 意外闯进了火之神艾利克斯的不知名神殿。根据岩土特征分析，神殿应该有上万年的历史，这是极其罕见的。Chandra 小心翼翼地四处探索，沿着魔力流动来到一间密室。她看见密室中央悬浮着一本书籍。在魔法保护下书籍状况完好。精通上古语言的 Chandra 读过此书，终于解开了多年的困惑。


禁咒法术之所以威力强大，是因为咒语借用了火之神艾利克斯的神力。这本书里记载了艾利克斯生平忌讳的 $M$ 个词语，比如情敌的名字、讨厌的植物等等。使用禁咒法术时，如果语言中含有任何忌讳词语，就会触怒神力而失效，施法者也一并遭受惩罚。

例如，若 `banana` 是唯一的忌讳词语，`an`、`ban`、`analysis` 是基本词汇，禁咒长度须是 $11$，则 `bananalysis` 是无效法术，`analysisban`、`anbanbanban` 是两个有效法术。注意：一个基本词汇在禁咒法术中可以出现零次、一次或多次；只要组成方式不同就认为是不同的禁咒法术，即使书写形式相同。

谜题破解，Chandra 心情大好。她决定计算一共有多少种有效的禁咒法术。

由于答案可能很大，你只需要输出答案模 $10 ^ 9 + 7$ 的结果。

## 输入格式

第一行，三个正整数 $N, M, L$。

接下来 $N$ 行，每行一个只含小写英文字母的字符串，表示一个基本词汇。

接下来 $M$ 行，每行一个只含小写英文字母的字符串，表示一个忌讳词语。

## 输出格式

仅一行，一个整数，表示答案（模 $10^9+7$）。

## 样例

### 样例输入 #1
```
4 2 10
boom
oo
ooh
bang
ob
mo
```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
3 1 3
a
ab
aba
aaa
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
3 1 14
ban
an
analysis
banana
```
### 样例输出 #3
```
15
```
## 提示

【样例解释 1】

有效的禁咒法术共有 $14$ 种：`boom/bang/oo`，`oo/oo/oo/oo/oo`，`oo/oo/ooh/ooh`，`oo/ooh/oo/ooh`，`oo/ooh/ooh/oo`，`ooh/oo/oo/ooh`，`ooh/oo/ooh/oo`，`
ooh/ooh/boom`，`ooh/ooh/oo/oo`，`ooh/ooh/bang`，`ooh/bang/ooh`，`bang/oo/oo/oo`，`bang/ooh/ooh`，`bang/bang/oo`。

【样例解释 2】

有效的禁咒法术有 `a/ab`，`ab/a`，`aba` 共三种。注意，`ab/a` 和 `aba` 算成两种不同的禁咒法术。

【数据规模与约定】

本题一共有 $10$ 个测试点。

下表是每个测试点的数据规模和约定：

 ![](https://cdn.luogu.com.cn/upload/pic/5191.png) 

对于 $100\%$ 的数据，$1 \le N, M \le 50，1 \le L \le 10^8$，基本词汇的长度之和不超过 $100$，忌讳词语的长度之和不超过 $100$。保证基本词汇不重复，忌讳词语不重复。



---

---
title: "[TJOI2015] 棋盘"
layout: "post"
diff: 省选/NOI-
pid: P3977
tag: ['递推', '2015', '各省省选', '枚举', '矩阵加速', '进制', '天津', '状压 DP']
---
# [TJOI2015] 棋盘
## 题目描述

为了提高智商，ZJY 去新世界旅游了。可是旅游过后的 ZJY 杯具地发现要打开通往原来世界的门，必须要解开门上面画的谜题。谜题是这样的：

有个 $n$ 行 $m$ 列的棋盘，棋盘上可以放许多特殊的棋子。每个棋子的攻击范围是 $3$ 行 $p$ 列。输入数据用一个 $3\times p$ 的矩阵给出了棋子攻击范围的模板，棋子被默认为模板中的第 $1$ 行，第 $k$ 列，则棋子能攻击到的位置是 $1$，不能攻击到的位置是 $0$。输入数据保证第 $1$ 行第 $k$ 列的位置是 $1$。打开门的密码就是，在要求棋子互相不能攻击到的前提下，摆放棋子的方案数。注意什么棋子都不摆放也算作一种可行方案。由于方案数可能很大,而密码为 $32$ 位的二进制密码,所以 ZJY 仅需要知道方案数对 $2^{32}$ 次方取余数的结果即可。

注意：编号从 $0$ 开始，即第 $1$ 行指的是中间那行。
## 输入格式

输入数据的第一行为两个整数 $n$ 和 $m$，表示棋盘的大小。

第二行为两个整数 $p$ 和 $k$，表示接下来的攻击范围模板的大小，以及棋子在模板中的位置。

接下来三行,每行有 $p$ 个数,表示攻击范围的模版。每个数字后有一个空格。
## 输出格式

输出数据仅有一行，一个整数，表示可行的方案数模 $2^{32}$ 的余数。
## 样例

### 样例输入 #1
```
5 5
3 1
0 1 0
1 1 1
0 1 0

```
### 样例输出 #1
```
55447

```
## 提示

### 数据范围

对于 $10\%$ 的数据，$1 \leq n \leq 5$，$1 \leq m \leq5$。

对于 $50\%$ 的数据，$1 \leq n \leq 1000$，$1 \leq m \leq 6$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^{6}$，$1 \leq m \leq 6$。


---

---
title: "小 Y 和恐怖的奴隶主"
layout: "post"
diff: 省选/NOI-
pid: P4007
tag: ['2017', 'O2优化', '矩阵加速', '概率论', '期望', 'CTT（清华集训/北大集训）']
---
# 小 Y 和恐怖的奴隶主
## 题目背景

“A fight? Count me in!” 要打架了，算我一个。

“Everyone, get in here!” 所有人，都过来！

## 题目描述

小 Y 是一个喜欢玩游戏的 OIer。一天，她正在玩一款游戏，要打一个 Boss。

虽然这个 Boss 有 $10^{100}$ 点生命值，但它只带了一个随从——一个只有 $m$ 点生命值的“恐怖的奴隶主”。

这个“恐怖的奴隶主”有一个特殊的技能：每当它被扣减生命值但没有死亡（死亡即生命值 $\leq 0$），且 Boss 的随从数量小于上限 $k$，便会召唤一个新的具有 $m$ 点生命值的“恐怖的奴隶主”。

现在小 Y 可以进行 $n$ 次攻击，每次攻击时，会从 Boss 以及 Boss 的所有随从中的等概率随机选择一个，并扣减 $1$ 点生命值，她想知道进行 $n$ 次攻击后扣减 Boss 的生命值点数的期望。为了避免精度误差，你的答案需要对 $998244353$ 取模。
## 输入格式

输入第一行包含三个正整数 $T, m, k$，$T$ 表示询问组数，$m, k$ 的含义见题目描述。

接下来 $T$ 行，每行包含一个正整数 $n$，表示询问进行 $n$ 次攻击后扣减Boss的生命值点数的期望。
## 输出格式

输出共 $T$ 行，对于每个询问输出一行一个非负整数，表示该询问的答案对 $998244353$ 取模的结果。

可以证明，所求期望一定是一个有理数，设其为 $p / q$ $(\mathrm{gcd}(p,q) = 1)$，那么你输出的数 $x$ 要满足 $p \equiv qx \pmod{998244353}$。
## 样例

### 样例输入 #1
```
3 2 6
1
2
3
```
### 样例输出 #1
```
499122177
415935148
471393168
```
## 提示

【样例 $1$ 解释】

对于第一次询问，第一次攻击有 $\frac{1}{2}$ 的概率扣减 Boss 的生命值，有 $\frac{1}{2}$ 的概率扣减随从的生命值，所以答案为 $\frac{1}{2}$。$1 \equiv 2 \times 499122177 \pmod{998244353}$。

对于第二次询问，如果第一次攻击扣减了 Boss 的生命值，那么有 $\frac{1}{2}$ 的概率第二次攻击仍扣减 Boss 的生命值，有 $\frac{1}{2}$ 的概率第二次攻击扣减随从的生命值；如果第一次攻击扣减了随从的生命值，那么现在又新召唤了一个随从（“恐怖的奴隶主”），于是有 $\frac{1}{3}$ 的概率第二次攻击扣减 Boss 的生命值，有 $\frac{2}{3}$ 的概率第二次攻击扣减随从的生命值。所以答案为 $\frac{1}{2}\times\frac{1}{2}\times2+\frac{1}{2}\times\frac{1}{2}\times1+\frac{1}{2}\times\frac{1}{3}\times1+\frac{1}{2}\times\frac{2}{3}\times0 = \frac{11}{12}$。 $11 \equiv 12 \times 415935148\pmod{998244353}$。

【提示】

题目顺序可能与难度无关。

【子任务】

在所有测试点中，$1 \leq T \leq 1000, 1 \leq n \leq {10}^{18}, 1 \leq m \leq 3, 1 \leq k \leq 8$。

各个测试点的分值和数据范围如下：

![12058](https://cdn.luogu.com.cn/upload/pic/12058.png)


---

---
title: "黑暗打击"
layout: "post"
diff: 省选/NOI-
pid: P4967
tag: ['2018', 'O2优化', '矩阵加速', '线性递推', '构造']
---
# 黑暗打击
## 题目背景

注，此题和 CQOI 的鼹鼠不一样，请仔细看题！本题只是借用背景！

在茫茫宇宙中……
## 题目描述

有一群生物 ccj，他们在上次的星系中，发现了一群低等生物，于是想进行一波黑暗森林打击。这群低等生物即是 $\mathsf{Hilbert}$ 鼹鼠，生活在 $\mathsf{Hilbert}$ 星球，住在 $\mathsf{Hilbert}$ 曲线土壤内。  
这群生物决定用最傻的办法——灌水，来淹死他们。现在“高等”生物想知道，对于 $n$ 阶的 $\mathsf{Hilbert}$ 曲线，从上往下灌水，能淹没几个单位面积？

这是 $1 \sim 4$ 阶的 $\mathsf{Hilbert}$ 曲线：  

![](https://cdn.luogu.com.cn/upload/pic/28912.png)

$h_1$，如最左图所示，是一个缺上口的正方形，这个正方形的边长为 $1$。 从$h_2$ 开始，按照以下方法构造曲线 $h_i$： 将 $h_{i-1}$ 复制四份，按 $2\times2$ 摆放。  
把左上一份逆时针转 $90^{\circ }$，右上一份顺时针转 $90^{\circ }$，然后用三条单位线段将四分曲线按照左上-左下-右下-右上的顺序连接起来。如图所示，分别展示的是 $h_2$，$h_3$，$h_4$。加粗的线段是额外用于连接的线段。

灌水方式：

（显然这个是 $h_3$ 的灌水面积）绿色即为无法被灌到的地方，红色为可以灌到的地方，灰色为墙，所以答案是 $26$，即为样例1。

![](https://cdn.luogu.com.cn/upload/pic/40229.png)

一个方格有水当且仅当在它的上，左，右方格中有至少一个方格有水，最上面一层的空格都有水。

注，此题要求对 $9223372036854775783$ 取模
## 输入格式

一个整数 $n$，表示这个洞穴是 $n$ 阶的 $\mathsf{Hilbert}$ 曲线。
## 输出格式

一个整数 $ans$，表示有 $ans$ 个单位面积被淹没。
## 样例

### 样例输入 #1
```
3

```
### 样例输出 #1
```
26

```
### 样例输入 #2
```
4

```
### 样例输出 #2
```
100

```
### 样例输入 #3
```
12
```
### 样例输出 #3
```
2137408
```
## 提示

**样例解释：**

自己数一数嘛……

$n \le 10^{10000}$

详细范围参见“标程”

数据均为手动构造，请注意常数！


---

---
title: "[COCI 2009/2010 #4] PALACINKE"
layout: "post"
diff: 省选/NOI-
pid: P5188
tag: ['2009', '矩阵加速', '容斥原理', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #4] PALACINKE
## 题目描述

 **译自 [COCI 2010.02](http://hsin.hr/coci/archive/2009_2010/) T6「[PALACINKE](http://hsin.hr/coci/archive/2009_2010/contest4_tasks.pdf)」**

安娜有几个同学过来吃可丽饼，然而安娜忘了这事。当安娜发现时，留给她烤可丽饼的时间只剩下 $T$ 分钟了。她马上跑出去采购四样原材料：面粉 `B`，鸡蛋 `J`，牛奶 `M` 和果酱 `P`。

安娜周边有 $N$ 个路口，编号为 $1\ldots N$，还有 $M$ 条单向道路连接它们。已知每条路上的商店会卖哪些材料，保证每条路上的商店至少会卖（上述四种材料中）的一种。


![](https://cdn.luogu.com.cn/upload/image_hosting/dy9d4iw5.png)

安娜穿过一条道路时，如果她进入了这条路上的商店买东西，则她通过这条路耗时  $2$ 分钟，否则耗时  $1$ 分钟。即使她买完了所有原材料仍可以进店买东西。

安娜需要从 $1$ 开始，最终回到 $1$。

安娜需要在 $T$ 分钟内采购到四种原材料。请问她有多少种「采购方式」，答案对 $5557$ 取模。采购方式包含了她经过的结点的次序，以及她在每条路上买不买材料，但不计她在哪个商店买了什么。例如，当 $T=7$ 时，在上图中有 $5$ 种采购方式：

![](https://cdn.luogu.com.cn/upload/image_hosting/ug3bvehg.png)
## 输入格式

第一行：$N,M$。  
接下来 $M$ 行，每行两个整数 $u,v$ 和一个仅可能包含 `BJMP` 四种字符的字符串 $s$，$u,v$ 表示一条单向道路，$s$ 表示这条道路上的商店会卖哪些材料。保证没有两条单向道路相同（但可能有两条连接的结点相同，而方向相反的道路）。  
第 $N+2$ 行：$T$。
## 输出格式

一行，一个答案，表示安娜有多少种采购方式。
## 样例

### 样例输入 #1
```
3 3
1 2 BMJ
2 3 MJP
3 1 JPB
5
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3 4
1 2 B
2 1 P
1 3 J
3 1 M
8
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
5 7
1 2 B
2 4 M
1 3 J
3 4 MB
4 1 JP
4 5 J
5 1 P
7
```
### 样例输出 #3
```
5
```
## 提示

$1\le N\le 25,$ $1\le M\le 500,$ $1\le T\le 10^9$.  
保证没有两条单向道路相同（但可能有两条连接的结点相同，而方向相反的道路）。


---

---
title: "[Cnoi2019] 雪松树之约"
layout: "post"
diff: 省选/NOI-
pid: P5392
tag: ['2019', 'O2优化', '矩阵加速', '状态合并', '状压 DP']
---
# [Cnoi2019] 雪松树之约
## 题目背景

由于 Cirno 突然犯懒, 所以背景故事咕咕咕了。
## 题目描述

Cirno 定义了一种图：圆柱网络 $G( L, x )$ 。

$G(L, x)$ 表示一个有 $L \times x$ 个节点的图。

其中每个节点用一个整数二元组 $( a, b )$ 表示 $( 1 \le a \le L, 1 \le b \le x )$。

对于 $ \forall i \in (1,L], \ j \in (0,x]$ , 节点 $(i, j)$ 与节点 $(i - 1, j)$ 之间有一条边。

对于 $ \forall i \in [1,L], \ j \in (0,x)$ , 节点 $(i, j)$ 与节点 $(i, j +1)$ 之间有一条边。

对于 $ \forall i \in [1,L]$ 节点 $(i, x)$ 与 节点 $(i, 1)$ 之间有一条边。

现在 Cirno 想知道 $G( L, x )$ 的 **独立集** 的个数。

由于你不会高精度，所以你需要将答案对 $998244353$ 取模。

## 输入格式

一行，两个整数，$L$，$x$。
## 输出格式

一行，一个整数，表示 $G(L,x)$ 的独立集的个数对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
3 4
```
### 样例输出 #1
```
181
```
### 样例输入 #2
```
1000 8
```
### 样例输出 #2
```
124141757
```
## 提示

对于 前 $10\%$ 的数据 $ L, x \le 8 $。

对于 前 $30\%$ 的数据 $ x \le 8 $。

对于 前 $50\%$ 的数据 $ x \le 11 $。

对于 $100\%$ 的数据 $0 < L \le 10^{18}, 0 <x \le 17 $。

本题采用捆绑测试。

下图 是 $G( 3, 4 )$ 的示例图。

![](https://cdn.luogu.com.cn/upload/pic/56163.png)


---

---
title: "[MtOI2019] 幻想乡数学竞赛"
layout: "post"
diff: 省选/NOI-
pid: P5517
tag: ['数学', '2019', '洛谷原创', 'O2优化', '矩阵加速', '生成函数', '线性递推']
---
# [MtOI2019] 幻想乡数学竞赛
## 题目背景

一年一度的幻想乡数学竞赛 (thMO) 又要开始了。

幻想乡中学习数学的少 (lao) 女 (tai) 们 (po) 和冰之妖精 baka 一起准备着 thMO。

但是在那一刻，幻想乡日复一日的宁静被打破了。

广播里，播放起了死亡的歌曲！

在那一刻，人们又回想起了被算数支配的恐惧。  

就剩下 baka，baka，baka，baka 的声音在幻想乡里回荡。  
 

---  

河城 荷取 (Kawashiro Nitori) 正坐在 thMO2019 的考场上！  
因为荷取有着她的[超级计算机](https://www.luogu.org/problemnew/show/P4911)，在成功地用光学迷彩覆盖了计算机之后，荷取在 thMO2019 的考场上所向披靡。  

* 荷取用她的超级计算机 $0 \,\mathrm{ms}$ 跑出了这么一道题：  

  * $\exists \{ a_n\} (n=0,1,\cdots ,10^{18})$，已知 $a_0=2,a_1=5,a_{n+2}=3a_{n+1}-2a_n$，求 $a_n\bmod 10^{9}+7$

* 荷取：显然，这个题可以用矩阵乘法 + 快速幂，可以 $O(\log n)$ 水过去，差不多就这样：

$$
\begin{bmatrix} a_n & a_{n+1} \end{bmatrix}=\begin{bmatrix} a_0 & a_1 \end{bmatrix} \times \begin{bmatrix} 3 & 1 \\ -2 & 0 \end{bmatrix}^n
$$      
  
但是荷取遇到了一道她不会的题，她正在寻求你的帮助呢！ 
## 题目描述

存在一个数列 $\{ a_n\} (n\in \{ 0,1,2,\cdots ,2^{64}-1\} )$。  
已知 $a_0=-3,a_1=-6,a_2=-12,a_n=3a_{n-1}+a_{n-2}-3a_{n-3}+3^n$。  

* 现在给你一个非负整数 $n$ ，令 $p=10^{9}+7$，请你求出 $a_n \bmod p$。 

* **注：若 $a_n<0$ ，请输出 $(a_n \bmod p+p)\bmod p$。**    
  
  
为了更充分地考验你的水平，荷取设置了 $T$ 组询问。

* 为了在某种程度上减少你的输入和输出量，我们采用以下的代码来生成询问：  
  
```cpp
namespace Mker
{
//  Powered By Kawashiro_Nitori
//  Made In Gensokyo, Nihon
	#include<climits>
	#define ull unsigned long long
	#define uint unsigned int
	ull sd;int op;
	inline void init() {scanf("%llu %d", &sd, &op);}
	inline ull ull_rand()
	{
		sd ^= sd << 43;
		sd ^= sd >> 29;
		sd ^= sd << 34;
		return sd;
	}
	inline ull rand()
	{
		if (op == 0) return ull_rand() % USHRT_MAX + 1;
		if (op == 1) return ull_rand() % UINT_MAX + 1; 
		if (op == 2) return ull_rand();
	}
}
```  

在调用 `Mker::init()` 函数之后，你第 $i$ 次调用 `Mker::rand()` 函数时返回的便是第 $i$ 次询问的 $n_i$。

在这里给出 $op$ 的限制：

* 如果 $op=0$，满足 $n_i \leq 2^{16}$。

* 如果 $op=1$，满足 $n_i \leq 2^{32}$。

* 如果 $op=2$，满足 $n_i \leq 2^{64}-1$。

为了减少你的输出量，你只需要输出所有询问答案的**异或和**。




## 输入格式

第一行三个整数，输入 $T$ ， $seed$ 和 $op$。
## 输出格式

第一行一个整数，输出 $T$ 组询问的答案的**异或和**。  
## 样例

### 样例输入 #1
```
142857 1145141919 0
```
### 样例输出 #1
```
562611141
```
### 样例输入 #2
```
142857 1145141919 1
```
### 样例输出 #2
```
894946216
```
### 样例输入 #3
```
142857 1145141919 2
```
### 样例输出 #3
```
771134436
```
## 提示

### 子任务  

![png](https://i.loli.net/2019/04/19/5cb9bb2c6c1d6.png)  

### 题目来源

[迷途之家 2019 联赛](https://www.luogu.org/contest/20135)(MtOI2019) T4

出题人：disangan233

验题人：suwakow



---

---
title: "心上秋"
layout: "post"
diff: 省选/NOI-
pid: P5558
tag: ['动态规划 DP', '倍增', 'O2优化', '矩阵加速', '树链剖分']
---
# 心上秋
## 题目背景

辗转经由他人唇齿

多少日夜听闻你的故事

难道这情之一字

竟连抛生死亦不可探知

听说北国的那座城池

被冬雪覆了终日

等到故人长诀渐行渐远

转眼已隔两世

谁向生而死 谁患得患失

相顾也再无多时

画中人暗自 竟心荡神痴

一滴泪氤氲满纸

挥墨描眉目 提笔勾鬓丝

寥寥几笔竟如此

夜半无人处 对月展卷时

忽然看懂这相思

落款谁提了名字

————《心上秋》
## 题目描述

竟宁元年（前33年）正月，昭君出塞前一晚。

画师跌跌撞撞地来到昭君居住的宫殿。

     听说北国的那座城池
     被冬雪覆了终日
     等到故人长诀渐行渐远
     转眼已隔两世
                ——《心上秋》

如果再也不能相见的话，画师想着，他想给昭君留下些什么。

他想把他的画笔送给昭君。

**昭君的宫殿里有$N$个房间，有$N-1$条道路连接这些房间。**

**画师现在在宫殿的入口大厅$S$房间，他依稀记得，昭君的房间在$T$号。**

窗外，风雨大作，宫内忽暗忽明，一个人影也没有。

画家走进晦暗的通道，每条通道里的墙壁上都画有若干片枫叶，这是之前昭君让画师画的。昭君说，她特别喜欢秋天，尤其喜欢秋天的枫叶。

      并肩长谈过多少往事，恍然间黄昏已至    ——《心上秋》

通道内晦暗无比，画师想点亮通道内备好的蜡烛，他记得昭君有个习惯，**每个通道内的蜡烛数量就是墙上枫叶的数量。昭君若想点燃一条通道内的蜡烛，就会全部点燃，此时昭君认为这条通道已被点亮，并且不会再点亮任何枫叶数少于这条通道的通道**。

这应该是最后一次来到这个地方了，画师想着，他要按昭君的习惯，走到昭君的房间。

**现在画师想知道，他从宫殿大厅$S$走到昭君房间$T$，最多可以点亮多少通道。**
## 输入格式

第一行一个数$N$，表示宫殿房间数量。

接下来有$N-1$行，每行三个数$u_{i},v_{i},leaf_{i}$，表示$u,v$之间有一条通道，通道上画有$leaf_{i}$片枫叶。

接下来一个数$M$。

最后$M$行，每行两个数$S_{i},T_{i}$
## 输出格式

输出$M$行，对于每组$S_{i},T_{i}$，输出最多能够点亮的通道数。
## 样例

### 样例输入 #1
```
5
1 2 5
2 3 1
1 4 1
3 5 4
3
2 1
4 2
1 1

```
### 样例输出 #1
```
1
2
0

```
### 样例输入 #2
```
7
1 2 1
1 3 5
2 4 1
4 5 4
5 6 1
1 7 1
5
7 5
7 6
2 7
1 1
2 4
```
### 样例输出 #2
```
4
4
2
0
1

```
### 样例输入 #3
```
20
1 2 1
1 3 3
2 4 5
1 5 1
5 6 5
1 7 5
1 8 4
7 9 1
8 10 2
1 11 1
2 12 5
3 13 1
3 14 3
3 15 3
10 16 1
5 17 1
12 18 5
7 19 4
7 20 5
10
10 3
17 16
11 9
4 6
16 17
11 16
11 11
13 11
2 1
10 11
```
### 样例输出 #3
```
2
3
2
3
3
2
0
2
1
2

```
## 提示

| 数据编号 | N | M | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $100$ | $100$ | 无 |
| $2$ | $100$ | $100$ | 无 |
| $3$ | $100$ | $1000$ | 无 |
| $4$ | $10000$ | $10000$ | 无 |
| $5$ | $10000$ | $10000$ | $1$ |
| $6$ | $10000$ | $10000$ | $1,2$ |
| $7$ | $10000$ | $10000$ | $1,2$ |
| $8$ | $30000$ | $100000$ | 无 |
| $9$ | $30000$ | $100000$ | 无 |
| $10$ | $30000$ |$300000$  | 无 |
特殊性质$1$：$1<=leaf_{i}<=2$

特殊性质$2$：$u_{i}+1=v_{i}$

对于所有的数据，保证$1<=leaf_{i}<=5$

样例一解析：

![](https://cdn.luogu.com.cn/upload/image_hosting/eaxwdth6.png)

询问$1$：从$2$走到$1$最多点亮$1$条通道（$2-1$）

询问$2$：从$4$走到$2$最多点亮$2$条通道（$4-1,1-2$）

询问$3$：显然无法点亮通道。

样例二解析：

![](https://cdn.luogu.com.cn/upload/image_hosting/8z9tovt5.png))

询问$1$：从$7$走到$5$，可以点亮$4$个通道（$7-1,1-2,2-4,4-5$）

询问$2$：从$7$走到$6$，可以点亮$4$个通道（$7-1,1-2,2-4,4-5$），不点亮（$5-6$）是因为已经点亮（$4-5$）后无法点亮比枫叶数小于$4$的通道，易知这样是最优的，或者不点亮（$4-5$）而点亮（$5-6$），这同样是最优解。

询问$3$：从$2$走到$7$，可以点亮$2$个通道（$2-1$,$1-7$）

询问$4$：不经过任何通道。

询问$5$：经过$1$条通道（$2-4$）


     何处合成愁。离人心上秋。纵芭蕉，不雨也飕飕。都道晚凉天气好，有明月，怕登楼。

     年事梦中休。花空烟水流。燕辞归，客尚淹留。垂柳不萦裙带住。漫长是，系行舟。



---

---
title: "洪水"
layout: "post"
diff: 省选/NOI-
pid: P6021
tag: ['动态规划 DP', '线段树', '二分', '矩阵加速', '树链剖分']
---
# 洪水
## 题目描述

小 A 走到一个山脚下，准备给自己造一个小屋。这时候，小 A 的朋友（`op`，又叫管理员）打开了创造模式，然后飞到山顶放了格水。于是小 A 面前出现了一个瀑布。作为平民的小 A 只好老实巴交地爬山堵水。那么问题来了：我们把这个瀑布看成是一个 $n$ 个节点的树，每个节点有权值（爬上去的代价）。小 A 要选择一些节点，以其权值和作为代价将这些点删除（堵上），使得根节点与所有叶子结点不连通。问最小代价。不过到这还没结束。小 A 的朋友觉得这样子太便宜小 A 了，于是他还会不断地修改地形，使得某个节点的权值发生变化。不过到这还没结束。小 A 觉得朋友做得太绝了，于是放弃了分离所有叶子节点的方案。取而代之的是，每次他只要在某个子树中（和子树之外的点完全无关）。于是他找到你。
## 输入格式

输入文件第一行包含一个数 $n$，表示树的大小。

接下来一行包含 $n$ 个数，表示第 $i$ 个点的权值。

接下来 $n-1$ 行每行包含两个数 $fr,to$ 。表示树中有一条边 $(fr,to)$ 。

接下来一行一个整数，表示操作的个数。

接下来 $m$ 行每行表示一个操作，若该行第一个数为 $Q$，则表示询问操作，后面跟一个参数 $x$ ，表示对应子树的根；若为 $C$ ，则表示修改操作，后面接两个参数 $x,t$ ，表示将点 $x$ 的权值加上 $t$。
## 输出格式

对于每次询问操作，输出对应的答案，答案之间用换行隔开。
## 样例

### 样例输入 #1
```
4
4 3 2 1
1 2
1 3
4 2
4
Q 1
Q 2
C 4 10
Q 1
```
### 样例输出 #1
```
3
1
4
```
## 提示

$1 \leq n \leq 200000,1 \leq fr,to \leq n,1 \leq x \leq n$，权值和 $t$ 均在 `int` 范围内且非负。

BZOJ4712


---

---
title: "[NOI Online #1 入门组] 魔法"
layout: "post"
diff: 省选/NOI-
pid: P6190
tag: ['动态规划 DP', '图论', '2020', '倍增', '矩阵加速', '最短路', 'NOI Online']
---
# [NOI Online #1 入门组] 魔法
## 题目描述

C 国由 $n$ 座城市与 $m$ 条有向道路组成，城市与道路都从 $1$ 开始编号，经过 $i$ 号道路需要 $t_i$ 的费用。

现在你要从 $1$ 号城市出发去 $n$ 号城市，你可以施展最多 $k$ 次魔法，使得通过下一条道路时，需要的费用变为原来的相反数，即费用从 $t_i$ 变为 $-t_i$。请你算一算，你至少要花费多少费用才能完成这次旅程。

注意：使用魔法只是改变一次的花费，而不改变一条道路自身的 $t_i$；最终的费用可以为负，并且一个城市可以经过多次（包括 $n$ 号城市）。 
## 输入格式

输入的第一行有三个整数，分别代表城市数 $n$，道路数 $m$ 和魔法次数限制 $k$。

第 $2$ 到第 $(m + 1)$ 行，每行三个整数。第 $(i + 1)$ 行的整数 $u_i, v_i, t_i$ 表示存在一条从 $u_i$ 到 $v_i$ 的单向道路，经过它需要花费 $t_i$。
## 输出格式

输出一行一个整数表示最小的花费。
## 样例

### 样例输入 #1
```
4 3 2
1 2 5
2 3 4
3 4 1

```
### 样例输出 #1
```
-8
```
### 样例输入 #2
```
2 2 2
1 2 10
2 1 1

```
### 样例输出 #2
```
-19
```
## 提示

#### 输入输出样例 1 解释

依次经过 $1$ 号道路、$2$ 号道路、$3$ 号道路，并在经过 $1,2$ 号道路前使用魔法。 

#### 输入输出样例 2 解释

依次经过 $1$ 号道路、$2$ 号道路、$1$ 号道路，并在两次经过 $1$ 号道路前都使用魔法。 

#### 数据规模与约定

本题共 $20$ 个测试点，各测试点信息见下表。

| 测试点编号 | $n \leq$ | $m \leq$ | $k \leq$ | 无环 |
| :----------: | :--------: | :---------: | :--------: | :----: |
| $1 \sim 2$ | $5$ | $20$ | $0$ | 不保证 |
| $3 \sim 4$ | $10$ | $20$ | $50$ | 不保证 |
| $5 \sim 6$ | $10$ | $20$ | $0$| 不保证 |
| $7 \sim 8$ | $20$ | $200$ | $50$ | 是 |
| $9 \sim 10$ | $20$ | $200$ | $0$ | 不保证 |
| $11 \sim 12$ | $100$ | $200$ | $50$ | 是 |
| $13 \sim 14$ | $100$ | $200$ | $50$ | 不保证 |
| $15 \sim 18$ | $100$ | $2500$ | $1000$ | 不保证 |
| $19 \sim 20$ | $100$ | $2500$ | $10^6$ | 不保证 |

对于【无环】一栏为“是”的测试点，保证给出的图是一张有向无环图，否则不对图的形态做任何保证。

对于全部的测试点，保证：
- $1 \leq n \leq 100$，$1 \leq m \leq 2500$，$0 \leq k \leq 10^6$。
- $1 \leq u_i, v_i \leq n$，$1 \leq t_i \leq 10^9$。
- 给出的图无重边和自环，且至少存在一条能从 $1$ 到达 $n$ 的路径。

**民间数据使用 [CYaRon](https://github.com/luogu-dev/cyaron) 在 5 分钟内生成。如果发现数据有问题，请在讨论版发帖或私信 @[StudyingFather](/user/22030)**


---

---
title: "「Wdsr-2」阴阳玉"
layout: "post"
diff: 省选/NOI-
pid: P6734
tag: ['动态规划 DP', '数学', '2020', '矩阵运算', '洛谷原创', '分治', '动态规划优化', '矩阵加速', '矩阵乘法']
---
# 「Wdsr-2」阴阳玉
## 题目背景

博丽灵梦有一块好大好大的阴阳玉，它是是博丽灵梦的主要武器之一。

但是阴阳玉的能量来源，源自主人的灵力聚集力量，因此，灵梦在平时总是需要对其进行保养。简单来说，灵梦会使用灵力，来获取阴阳玉所需的能量。


## 题目描述

灵力有阴阳之分。初始的时候，灵梦只有两个阳灵力，它们围成了一个圈。每次，灵梦可以进行以下两种操作：

- 在两个灵力直接加入一个阳灵力。

- 移走一个阳灵力。

为了保持稳定，任何时候这个圈上的灵力都**不应该少于两个**。

由于灵力的阴阳并不稳定，因此一旦某个灵力周围发生改变（多出一个灵力，或减少一个灵力），它就会从阳变成阴，或从阴变成阳。不过，如果只是周边灵力的性质改变，那么它就不会发生变化。

灵梦会不断调节灵力，直到它**最终**变成 $n$ 个（中途可能多于 $n$ 个）。然后，灵梦会从某个点**依次**按照顺时针或逆时针取下每个灵力。它会形成一条链。灵梦会用链上的能量，来加强她的阴阳玉。

做到这一点非常容易。但是灵梦非常好奇，一共可能形成多少种不同的**链**。

由于灵梦的偏好，她可能会有 $m$ 个限制条件。第 $i$ 个条件 $(p_i,c_i)$ ，规定了链上第 $p_i$ 个灵力应该为何种灵力。若 $c_i=0$ ，则应该为阴灵力；否则为阳。

由于可能结果太大，灵梦只需要得到答案对 $998244353$ 取模的结果。

两个链不同，当且仅当存在一个位置的点颜色不同。
## 输入格式

第一行为一个正整数 $n$ 和一个非负整数 $m$ 。

当 $m=0$ 时无约束条件。否则接下来会有 $m$ 行，每行两个非负整数 $p_i,c_i$ ，含义如上。
## 输出格式

一行，一个非负整数，表示所有链的可能种类总数对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
4 0
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4 1
1 1
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
20 10
5 1
12 0
17 0
3 1
7 1
13 0
8 1
18 1
2 1
19 0
```
### 样例输出 #3
```
344
```
## 提示

#### 样例解释

对于样例一，可能存在以下两种构造方式：

![pic3.JPG/The "2"-th of the "1"-st.](https://i.loli.net/2020/07/17/VQn8MB7fxJsA1Rr.jpg)

其中， $\tt ADD$ 表示增加一个阳灵力，$\tt RMV$ 表示移走一个阳灵力。

将得到的两个环分别拆开，一共可以得到以下五种链：

- 环一：**阳—阳—阳—阳**。

- 环二：**阳—阳—阴—阴**，**阳—阴—阴—阳**，**阴—阴—阳—阳**，**阴—阳—阳—阴**。

因此答案为 $5$ 。

对于样例二，我们限定了链上第一个灵力为阳。因此结果为 $3$ 。

#### 数据范围

$$\def{\t}{\text}\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|}\hline
\textbf{Subtask} & n\t{ 的范围} & m\t{ 的范围} & \t{分值}\cr\hline
1 & n\le 16 & m\le 16 & 15 \cr \hline
2 & n\le 10^6 &  m\le 5\times 10^3 & 40 \cr \hline
3 & n\le 10^{18} & m=0 & 15 \cr \hline
4 & n\le 10^{18} & m\le 5\times 10^3 & 30 \cr \hline
\end{array}$$

此外，对于全部数据，有 $1\le p_i\le n,c_i\in \{0,1\}, 0\le m\le n$ 且 $p_i$ 各不相同。


---

---
title: "[CEOI 2020] 星际迷航"
layout: "post"
diff: 省选/NOI-
pid: P6803
tag: ['2020', 'CEOI（中欧）', '矩阵加速', '树形 DP']
---
# [CEOI 2020] 星际迷航
## 题目背景

原时空限制：0.2s，32m
## 题目描述

星际联邦由 $N$ 颗行星组成，分别编号为 $1 \sim N$。一些行星间由星际通道相连。通过这些星际通道，飞船可以在短时间内往返于各星球之间。整个星际联邦中恰好有 $N-1$ 条星际通道，并且通过这些星际通道，任意两颗行星之间均能相互抵达。

除了我们所处的宇宙之外，还有 $D$ 个平行宇宙，这些平行宇宙是我们的宇宙的完全复刻，它们的行星，星际通道都和我们的完全相同。我们将这些平行宇宙编号为 $1 \sim D$（我们的宇宙编号为 $0$），记第 $i$ 个宇宙的第 $x$ 颗行星为 $P_{x}^i$。通过星门，我们可以在这些平行宇宙间穿梭。$\forall i \in [0,D)$，我们将选择一个 $A_i$ 和一个 $B_i$（要求 $1 \leq A_i,B_i \leq N$），在 $P_{A_i}^i$ 和 $P_{B_i}^{i+1}$ 之间搭建一个**单向**（只能从 $P_{A_i}^i$ 前往 $P_{B_i}^{i+1}$）星门。

当所有的星门都准备就绪后，联邦星舰 Batthyány 号将会开始它的处女航，它目前正环绕着 $P_1^0$ 行星。Ágnes 舰长准备和 Gábor 中尉玩这样一个游戏：两个人交替选择星舰接下来前往的目的地，要求该目的地可以通过星际通道或星门直接抵达。他们希望每次前往的星球都是之前未抵达过的。即，如果星舰抵达了 $P_{x}^i$，他们将不再经过这个星球（但是可以抵达 $x$ 在其他平行宇宙中的相应星球）。由 Ágnes 舰长作为先手开始游戏，Gábor 中尉作为后手，当一位玩家在他的回合中，不能选择一个合法的目的地时，他就输掉了游戏。

舰长和中尉都是绝对聪明的，他们知道所有星际通道和星门的排布方案，并且他们每次都按照最优方案行动。你需要求出，有多少种布置星门的方案，使得作为先手的 Ágnes 舰长必胜？两种布置星门的方案是不同的，当且仅当存在一个整数 $i$，使得 $A_i$ 或 $B_i$ 不同。
## 输入格式

第一行两个整数 $N,D$，分别代表星际联邦拥有的行星数和平行宇宙的数量。

接下来 $N-1$ 行，每行两个整数 $u,v$，表示 $\forall i \in [0,D]$，$P_u^i,P_v^i$ 之间有星际通道相连。
## 输出格式

输出能使舰长必胜的星门布置方案数对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
3 1
1 2
2 3
```
### 样例输出 #1
```
4
```
## 提示

### 样例解释

共有 $3 \times 3=9$ 种本质不同的布置星门的方案，下面列出四种舰长必胜的情况。

![](https://cdn.luogu.com.cn/upload/image_hosting/vblsc4g6.png)

### 子任务

所有数据均满足：$1 \leq N \leq 10^5$，$1 \leq D \leq 10^{18}$，$1 \leq u,v \leq N$。

各子任务的约束条件如下：

| 子任务编号 | 分值 | 约束                         |
| ---------- | ---- | ---------------------------- |
| $1$        | $0$  | 样例                         |
| $2$        | $7$  | $N=2$                        |
| $3$        | $8$  | $N \leq 100$，$D=1$          |
| $4$        | $15$ | $N \leq 1000$，$D=1$         |
| $5$        | $15$ | $D=1$                        |
| $6$        | $20$ | $N \leq 1000$，$D \leq 10^5$ |
| $7$        | $20$ | $D \leq 10^5$                |
| $8$        | $15$ | 无特殊约束                   |


---

---
title: "「JZOI-1」旅行"
layout: "post"
diff: 省选/NOI-
pid: P7359
tag: ['矩阵加速', '树形 DP']
---
# 「JZOI-1」旅行
## 题目背景

新年快到了，小僖要做一个长远的旅行，至于从哪里开始，到哪里，他还没有想好。
## 题目描述

这次旅行是在一个由 $N$ 个城市和 $(N-1)$ 条双向道路组成的一个国家中，其中保证任意两个城市可以互达。

为了美化环境，所有道路都是沿河修建的，这意味着小僖可以自己制造一艘船，然后划船通过这条路，所以小僖每走一条边都可以从陆上走过去，也可以划船通过。

当然，因为顺流和逆流的原因，所以有一个参数 $z_i$，换句话讲，如果从陆上走过这条边所花费的时间为 $a_i$，那么顺流而下划船所花费的时间为 $a_i-z_i$ (保证结果大于 $0$)，逆流而上花费的时间为 $a_i+z_i$。不过，造船需要 $L$ 的时间，且人一旦上了岸，就必须放弃这条船只。

现在小僖想你帮忙算一下从 $u$ 走到 $v$ 的最短时间。

注意：一条船可以连续走多段水路（只要你不下船）
## 输入格式

第一行三个数，$N,L,T$。

接下来 $(N-1)$ 行，每行五个数，$x_i,y_i,a_i,z_i,type_i$，其中 $type_i=1$ 表示水从 $x_i$ 流向 $y_i$，$type_i=0$ 表示水从 $y_i$ 流向 $x_i$。

接下来 $T$ 行，每行两个数 $u_i,v_i$，表示每个计划的起点和终点。
## 输出格式

$T$ 行，每行一个数，表示每一个询问的答案。
## 样例

### 样例输入 #1
```
3 2 2
1 2 2 1 0
1 3 3 2 1
2 3
1 2
```
### 样例输出 #1
```
4
2
```
### 样例输入 #2
```
4 1 1
1 2 100 99 1
2 3 100 99 0
3 4 100 99 1
1 4
```
### 样例输出 #2
```
104
```
## 提示

### 样例1解释
图长这样：

![](https://cdn.luogu.com.cn/upload/image_hosting/2sp03gic.png)

对于第一组询问，也就是从 $2$ 到 $3$，我们可以在 $2$ 号节点造船，花费 $2$ 的时间，然后从节点 $2$ 顺流而下到 $1$，花费 $2-1=1$，在顺流而下到 $3$，花费 $3-2=1$，所以总花费为 $2+1+1=4$。
## 数据范围
对于 $10\%$ 的数据，$N,T\leq10^3$。

对于另外 $10\%$ 的数据，树的形态随机。

对于另外 $20\%$ 的数据，所有的 $u$ 或所有的 $v$ 都相等。

最后一个测试点给出了一条链。

对于 $100\%$ 的数据，$N,T\leq2\times10^5$，且 $0
<a_i,L\leq10^5$。


---

---
title: "「PMOI-3」期望乘积"
layout: "post"
diff: 省选/NOI-
pid: P7576
tag: ['动态规划 DP', '线段树', 'O2优化', '动态规划优化', '矩阵加速', '矩阵乘法']
---
# 「PMOI-3」期望乘积
## 题目描述

ducati 热爱定义一些奇奇妙妙的东西。

- 定义两个序列不同，当且仅当它们的长度不同，或者它们长度相同但存在至少一组对应位上的值不同。

- 定义序列 $A$ 的权值为 $A$ 中所有数的**乘积**。

- 定义序列间的**可达**如下：

  - 做**恰好** $t$ 次操作，每次操作选择 $A$ 的一个子区间（**注意，选定的子区间可以为空**）并将子区间中的数加 $1$ ；若存在一种操作方案，使得操作结束后 $A$ 与 $B$ 完全相同 ，则称 $A$ 可达 $B$。
  
- 定义序列 $A$ 的优美值为 $A$ 可达的**所有不同**序列的**权值**和。

现在，ducati 拥有了一个长度为 $n$ 的序列 $a$。他会多次查询一段区间的优美值。

你能帮帮好奇的他吗？你只需要输出每个答案对 $10007$ 取模的值就行啦。
## 输入格式

第一行三个整数 $n,q,t$，表示序列的长度、询问的次数与每次询问的可修改次数。

第二行 $n$ 个整数，表示序列 $a$。

下面 $q$ 行，每行两个正整数 $l,r$，描述一次询问。
## 输出格式

对于每次询问，输出答案对 $10007$ 取模的值。
## 样例

### 样例输入 #1
```
2 1 1
1 2
1 2
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
10 3 3
1 5 3 2 2 4 6 3 2 3
1 7
4 9
3 10
```
### 样例输出 #2
```
3850
1166
3893
```
## 提示

【样例解释1】

$a$ 为 $\{1,2\}$。共 $1$ 次询问。

所有 $a$ 可达的 $b$ 如下：

$$\{1,3 \} \{2,2 \} \{2,3 \}\{1,2 \}$$

它们的权值之和为 $3+4+6+2=15$ 。

【样例解释2】

关于第二个样例，我有一个绝妙的解释，可惜这里空白太小，我写不下。

【数据范围】

**本题采用捆绑测试**。
- Subtask1（10pts）：$n,q\le8$；
- Subtask2（20pts）：$q=1$；
- Subtask3（30pts）：$n,q\le5\times10^4$，$t\le2$；
- Subtask4（40pts）：无特殊限制。

对于 $100\%$ 的数据满足，$1\le n,q\le10^5$，$1\le a_i\le10^4$，$1\le t\le3$，对于所有询问，$1\le l\le r\le n$。


---

---
title: "「SvR-2」G64"
layout: "post"
diff: 省选/NOI-
pid: P9090
tag: ['动态规划 DP', '贪心', '洛谷原创', 'O2优化', '矩阵加速', '洛谷月赛']
---
# 「SvR-2」G64
## 题目描述

定义对于两棵有根二叉树 $T_1,T_2$，$\operatorname{merge}(T_1,T_2)$ 的结果是一棵二叉树，满足其根节点的左子树为 $T_1$，右子树为 $T_2$，显然 $\operatorname{merge}(T_1,T_2)$ 的结果唯一且必然存在。

定义对于一棵有根二叉树 $T$，有函数 $G_x(T)$。其中 $G_1(T)$ 表示沿着 $T$ 的根向右儿子走，直到走到某个不存在右儿子的节点，将其右子树变为 $T$，这棵新树即为 $G_1(T)$ ，而当 $x>1$ 时，$G_x(T)$ 满足如下关系：

$$G_x(T)=G_1(\operatorname{merge}(G_{x-1}(T),G_{x-1}(T)))$$

给一棵 $n$ 个节点的以 $1$ 为根的有根二叉树，记以 $i$ 为根的子树为 $T_i$，$q$ 次询问，每次询问给定 $x,i$，求 $G_x(T_i)$ 的最大独立集。

## 输入格式

第一行两个整数 $n,q$。

之后 $n$ 行，每行两个整数 $ls_i,rs_i$ 表示其左儿子和右儿子，若为 $0$ 则说明没有对应儿子。

之后 $q$ 行，每行两个整数 $x,i$ ，表示一次询问。
## 输出格式

$q$ 行，每行一个数，表示这次询问的  $G_x(T_i)$ 的最大独立集大小对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
5 3
2 3
0 4
5 0
0 0 
0 0
2 5 
2 1
1 1
```
### 样例输出 #1
```
5
24
6
```
### 样例输入 #2
```
5 1
2 3
0 4
5 0
0 0 
0 0
64 1
```
### 样例输出 #2
```
592424678
```
## 提示

### 样例解释

对于第一组样例，$G_2(T_5)$ 的结果如下图（忽略编号）：
![](https://cdn.luogu.com.cn/upload/image_hosting/fcjnzc23.png) 
 

对于第二组样例，我有一个绝妙的解释，可惜 $G_{64}$ 太大了，这里写不下。

#### 数据规模与约定

**本题开启捆绑测试和 O2 优化。**

| Subtask | 数据范围/特殊性质 | 分值 |
| :------: | :------: | :------: |
| $1$ |  $n,q,x\le 10$| $10 \operatorname{pts}$ |
| $2$ | $x =1$ | $5 \operatorname{pts}$ |
| $3$ |$x\le 3$ | $10 \operatorname{pts}$ |
| $4$ | $x\le 10$ | $15 \operatorname{pts}$ |
| $5$ | 保证 $T_i$ 大小为 $1$ | $10 \operatorname{pts}$ |
| $6$ | 无特殊限制 | $50 \operatorname{pts}$ |


对于 $100\%$ 的数据，
$1\le x\le 10^9$，$1\le n\le 5\times 10^5$，$1\le q\le 5\times 10^5$。


---

---
title: "[USACO23OPEN] Pareidolia P"
layout: "post"
diff: 省选/NOI-
pid: P9192
tag: ['动态规划 DP', '线段树', 'USACO', '2023', '矩阵加速']
---
# [USACO23OPEN] Pareidolia P
## 题目描述

Pareidolia is the phenomenon where your eyes tend to see familiar patterns in images where none really exist -- for example seeing a face in a cloud. As you might imagine, with Farmer John's constant proximity to cows, he often sees cow-related patterns in everyday objects. For example, if he looks at the string `bqessiyexbesszieb`, Farmer John's eyes ignore some of the letters and all he sees is `bessiebessie`.

Given a string $s$, let $B(s)$ represent the maximum number of repeated copies of `bessie` one can form by deleting zero or more of the characters from $s$. In the example above, $B(bqessiyexbesszieb)=2$. Furthermore, given a string $t$, let $A(t)$ represent the sum of $B(s)$ over all contiguous substrings $s$ of $t$.

Farmer John has a string t of length at most $2\times10^5$ consisting only of characters a-z. Please compute A(t), and how A(t) would change after $U (1\le U\le2\times10^5)$ updates, each changing a character of t. Updates are cumulative.
## 输入格式

The first line of input contains $t$.

The next line contains $U$, followed by $U$ lines each containing a position $p$ $(1\le p\le N)$ and a character $c$ in the range a-z, meaning that the pth character of $t$ is changed to $c$.
## 输出格式

Output $U+1$ lines, the total number of bessies that can be made across all substrings of $t$ before any updates and after each update.
## 样例

### 样例输入 #1
```
bessiebessie
3
3 l
7 s
3 s
```
### 样例输出 #1
```
14
7
1
7
```
## 提示

Before any updates, twelve substrings contain exactly $1$ `bessie` and $1$ string contains exactly $2$ `bessie`s, so the total number of bessies is $12⋅1+1⋅2=14$.

After one update, $t$ is `belsiebessie`. Seven substrings contain exactly one `bessie`.

After two updates, $t$ is `belsiesessie`. Only the entire string contains `bessie`.


Input $2$: $|t|,U\le300$;

Inputs $3-5$: $U\le10$;

Inputs $6-13$: $|t|,U\le10^5$;

Inputs $14-21$: No additional constraints.
## 题目翻译

### 题目描述

Pareidolia 是一种现象，指的是人们倾向于在并不真正存在的地方看到熟悉的图案——例如在云中看到一张脸。可以想象，由于农夫 John 经常与奶牛接触，他常常在日常物品中看到与奶牛相关的图案。例如，如果他看到字符串 `bqessiyexbesszieb`，农夫 John 的眼睛会忽略其中的一些字母，而他看到的只是 `bessiebessie`。

给定一个字符串 $s$，令 $B(s)$ 表示通过删除 $s$ 中的零个或多个字符后，能够形成的 `bessie` 的最大重复次数。在上面的例子中，$B(bqessiyexbesszieb)=2$。此外，给定一个字符串 $t$，令 $A(t)$ 表示所有连续子串 $s$ 的 $B(s)$ 之和。

农夫 John 有一个长度不超过 $2 \times 10^5$ 的字符串 $t$，且仅由字符 a-z 组成。请计算 $A(t)$，以及在 $U (1 \le U \le 2 \times 10^5)$ 次更新后 $A(t)$ 的变化情况，每次更新会修改 $t$ 中的一个字符。更新是累积的。

### 输入格式

第一行输入包含 $t$。

接下来的一行包含 $U$，随后是 $U$ 行，每行包含一个位置 $p$ $(1 \le p \le N)$ 和一个字符 $c$（范围为 a-z），表示将 $t$ 的第 $p$ 个字符修改为 $c$。

### 输出格式

输出 $U+1$ 行，分别表示在没有任何更新之前以及每次更新后，$t$ 的所有子串中能够形成的 `bessie` 的总数。

### 提示

在没有任何更新之前，有 12 个子串恰好包含 $1$ 个 `bessie`，有 $1$ 个子串恰好包含 $2$ 个 `bessie`，因此 `bessie` 的总数为 $12 \cdot 1 + 1 \cdot 2 = 14$。

第一次更新后，$t$ 变为 `belsiebessie`。有 7 个子串恰好包含一个 `bessie`。

第二次更新后，$t$ 变为 `belsiesessie`。只有整个字符串包含 `bessie`。

输入 $2$：$|t|, U \le 300$；

输入 $3-5$：$U \le 10$；

输入 $6-13$：$|t|, U \le 10^5$；

输入 $14-21$：没有额外限制。


---

---
title: "『STA - R3』高维立方体"
layout: "post"
diff: 省选/NOI-
pid: P9510
tag: ['数学', 'O2优化', '矩阵加速', '斐波那契数列']
---
# 『STA - R3』高维立方体
## 题目描述

如下定义斐波那契数列：
$$\operatorname{fib}(n)=\begin{cases}1&n\le 2\\\operatorname{fib}(n-1)+\operatorname{fib}(n-2)&n>2\end{cases}$$

现在我们定义一个函数（注意在 $n<1$ 时这个函数的值是 $0$）：

$$f(n)=\sum_{i=1}^n\operatorname{fib}^2(i)$$

由于求斐波那契数列的前缀和太简单了，你需要求出：
$$\sum_{i=1}^n\operatorname{fib}(i)\cdot(f(i-2)+\operatorname{fib}^2(i)+\operatorname{fib}(i))$$
的值，答案对输入的 $p$ 取模。

注：$\operatorname{fib}^2(x)$ 表示 $\operatorname{fib}(x)$ 的平方。
## 输入格式

**本题有多组数据**。

第一行一个整数 $T$，表示数据的组数。

对于每组数据，一行两个整数 $n,p$。
## 输出格式

对于每组数据，输出一行一个整数，表示答案对 $p$ 取模后的结果。
## 样例

### 样例输入 #1
```
3
2 100
3 100
4 100
```
### 样例输出 #1
```
4
18
60
```
## 提示

样例解释：

对于第一组数据，$1\times(0+1^2+1)+1\times(0+1^2+1)=4$。

对于第二组数据，$1\times(0+1^2+1)+1\times(0+1^2+1)+2\times(1+2^2+2)=18$。  
### 数据范围

**本题采用捆绑测试。**

- Subtask 1（5 points）：$n \le 10^7$，$p=10^9+7$。
- Subtask 2（20 points）：$T\le 10^4$，$n \le 10^8$，$p=10^9+7$。
- Subtask 3（5 points）：$p=2$。
- Subtask 4（15 points）：$p\le 5$。
- Subtask 5（30 points）：$T\le 10^4$，$n \le 10^8$。
- Subtask 6（25 points）：无特殊限制。

对于所有数据，$1\le T\le 2\times 10^5$，$1\le n\le 10^{18}$，$2\le p\le 10^9+7$。



---


---
title: "[信息与未来 2024] AI 机器人"
layout: "post"
diff: 省选/NOI-
pid: B3983
tag: ['模拟', '搜索', '2024', '矩阵运算', '江苏', '分治', '记忆化搜索', '矩阵加速', '信息与未来']
---
# [信息与未来 2024] AI 机器人
## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/27icb51c.png)

在 $n$ 行 $m$ 列的矩形空间中有一个机器人。矩形空间的每一个格子要么是平地（用半角点号 `.` 表示），要么是障碍物 （用井号表示 `#`）。以下是一个 $n = 3, m = 7$ 的例子：

```
...#...
...#...
.......
```

初始时,机器人位于矩形的左上角 （第一行、第一列）。每一时刻，机器人可以遵照程序执行 `U`（Up，向上）、`L` （Left，向左）、 `D` （Down，向下）、`R` （Right，向右） 四种指令中的一个，尝试向某个方向移动一格；如果移动的目标格子超出了边界或是障碍物，则保持原地不动，例如执行程序：

`LLLRRRRRRRRRDDDDRRRRRRRRR`

后，机器人会从空间的左上角移动到右下角。Dr. X 扩展了机器人程序的表达能力,引入了循环。给定程序 `P`，`(P)n` 相当于把程序 `P`“复制粘贴”$n$ 次。循环可以嵌套。例如，在足够大且无阻挡的空间中执行程序：

`(R(DRUL)7)5`

会重复 $5$ 次执行“向右移动一格、转圈 $7$ 次”，而如果机器人在 $n = 1, m = 2$ 的空间中执行上述程序，就会表现为“左右横跳”。

Dr. X 还给机器人装备了人工智能，对于某些指定的循环，机器人可以由深度神经网络自主决定循环的次数（$0$ 次或任意多次），用星号 `*` 表示，例如

`(DR(R)*)3`

外层循环会执行 $3$ 次，由于循环“复制粘贴”的特性，每次向下向右移动一格后，机器人可以根据自己的想法向右移动 $0$ 格或任意多格。人工智能循环也可以嵌套，根据循环“先外层后里层”的执行顺序，总是先确定外层人工智能循环的执行次数，再按照“复制粘贴”的规则执行内层循环代码。

人工智能模块使机器人的行为变得难以预测。给定一个机器人程序，Dr. X 想知道，哪些格子是机器人在执行程序过程中绝无可能经过的（即无论机器人如何选择循环执行的次数，都不会经过）？这样他可以在这些格子上安装监控，并在观察到机器人行为失控的时候及时制止。
## 输入格式

输入第一行两个空格分隔的整数 $n$ 和 $m$，代表矩形空间的大小为 $n$ 行、$m$ 列。

接下来 $n$ 行，每行 $m$ 个字符，描述了矩形空间。其中半角点号为平地、井号为障碍物。

输入最后一行是一个字符串，为机器人执行的程序。程序由 $\tt{U/L/D/R}$、圆括号、正整数、星号组成。输入程序保证合法：圆括号总是正确配对，且之后紧跟一个正整数或一个星号。除此之外，程序中所有的字符都是 $\tt{U,L,D}$ 或 $\tt{R}$。机器人初始时位于左上角，输入保证左上角不是障碍物。**固定次数循环的次数总是在 $1$ 到 $9$ 之间。**
## 输出格式

输出 $n$ 行，每行 $m$ 个字符，按顺序输出矩形空间中每个格子的计算结果。如果是障碍物格子，输出井号 `#`。如果是机器人选择适当的循环次数可以到达的平地格子，输出加号 `+`。否则输出半角点号 `.`。
## 样例

### 样例输入 #1
```
3 7
...#...
...#...
.......
LLLRRRRRRRRRDDDDRRRRRRRRR
```
### 样例输出 #1
```
+++#...
..+#...
..+++++
```
### 样例输入 #2
```
3 7
...#...
##.....
.......
(R(DRUL)7)5
```
### 样例输出 #2
```
+++#...
##+++++
..+++++
```
### 样例输入 #3
```
3 7
.......
.#####.
.......
(R)*(D)*
```
### 样例输出 #3
```
+++++++
+#####+
+.....+
```
## 提示

对于 $30\%$ 的数据，输入程序不含星号 `*` 且在 $10^5$ 步内终止。

对于另外 $30\%$ 的数据，输入程序中不含星号 `*`。

对于 $100\%$ 的数据，$1 \leq n, m \leq 10$，且输入程序的长度不超过 $1000$。

>本题原始满分为 $20\text{pts}$。


---

---
title: "[USACO20JAN] Non-Decreasing Subsequences P"
layout: "post"
diff: 省选/NOI-
pid: P6009
tag: ['动态规划 DP', '2020', 'USACO', '矩阵运算', '分治']
---
# [USACO20JAN] Non-Decreasing Subsequences P
## 题目描述

Bessie 最近参加了一场 USACO 竞赛，遇到了以下问题。当然 Bessie 知道怎么做。那你呢？

考虑一个仅由范围在 $1 \ldots K$（$1 \leq K \leq 20$）之间的整数组成的长为 $N$ 的序列 $A_1,A_2, \ldots ,A_N$（$1 \leq N \leq 5 \times 10^4$）。给定 $Q$（ $1 \leq Q \leq 2 \times 10^5$ ）个形式为 $[L_i,R_i]$（$1 \leq L_i \leq R_i \leq N$）的询问。对于每个询问，计算 $A_{L_i},A_{L_i+1}, \ldots ,A_{R_i}$ 中不下降子序列的数量模 $10^9+7$ 的余数。

$A_L,\ldots ,A_R$ 的一个不下降子序列是一组索引 （$j_1,j_2, \ldots ,j_x$），满足 $L\le j_1<j_2<\ldots<j_x\le R$ 以及 $A_{j_1}\le A_{j_2}\le \ldots \le A_{j_x}$。确保你考虑了空子序列！
## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $K$。

第二行包含 $N$ 个空格分隔的整数 $A_1,A_2, \ldots ,A_N$。

第三行包含一个整数 $Q$。

以下 $Q$ 行每行包含两个空格分隔的整数 $L_i$ 和 $R_i$。
## 输出格式

对于每个询问 $[L_i,R_i]$，你应当在新的一行内输出 $A_{L_i},A_{L_i+1},\ldots, A_{R_i}$ 的不下降子序列的数量模 $10^9+7$ 的余数。
## 样例

### 样例输入 #1
```
5 2
1 2 1 1 2
3
2 3
4 5
1 5
```
### 样例输出 #1
```
3
4
20
```
## 提示

### 样例解释

对于第一个询问，不下降子序列为 $()$、$(2)$ 和 $(3)$。$(2,3)$ 不是一个不下降子序列，因为 $A_2\not \le A_3$。

对于第二个询问，不下降子序列为 $()$、$(4)$、$(5)$ 和 $(4,5)$。

### 子任务

- 测试点 $2 \sim 3$ 满足 $N \leq 1000$。
- 测试点 $4 \sim 6$ 满足 $K \leq 5$。
- 测试点 $7 \sim 9$ 满足 $Q \leq 10^5$。
- 测试点 $10 \sim 12$ 没有额外限制。


---

---
title: "[BalticOI 2017] Toll"
layout: "post"
diff: 省选/NOI-
pid: P6573
tag: ['动态规划 DP', '2017', '线段树', '矩阵运算', 'O2优化', 'BalticOI（波罗的海）']
---
# [BalticOI 2017] Toll
## 题目背景

作为一个合格的货运公司，在送达货物的同时也要让花的钱最少。
## 题目描述

这座城市有 $n$ 个地点，这 $n$ 个地点之间有 $m$ 条边。  
货运公司接到了 $o$ 个订单，他们要想方设法的让路途中花的钱最少。  
对于每条路，都有三个信息：  
- $a,b$ 代表从 $a$ 连到 $b$；
- $t$ 代表这条路需要多少钱。  

并且对于每个订单，都给出 $a$ 和 $b$ 代表要把物品从 $a$ 运到 $b$ ，求每个订单需要花的最少的钱；如果无法送达就输出 $-1$。  
特别的，对于两个编号为 $a,b$ 的路，一定满足：
$$\left\lfloor\dfrac{b}{k}\right\rfloor=1+\left\lfloor\dfrac{a}{k}\right\rfloor$$
（$k$ 是一个给定的常数）。
## 输入格式

第一行四个整数 $k,n,m,o$ 代表一个常数，地点的个数，边的个数，订单的个数。  
点的编号为从 $0$ 到 $n - 1$。  
接下来 $m$ 行每行三个整数 $a,b,t$ 代表从 $a$ 连向 $b$ 要花费 $t$，保证满足 $\left\lfloor\dfrac{b}{k}\right\rfloor=1+\left\lfloor\dfrac{a}{k}\right\rfloor$，并且两点之间连接的边数不超过 $1$ 条边。  
接下来 $o$ 行每行两个整数 $a,b$ 代表要从 $a$ 运货到 $b$。
## 输出格式

对于每个订单，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 14 5 5
0 5 9
5 12 10
0 7 7
7 12 8
4 7 10
0 12
0 5
0 7
7 12
0 13
```
### 样例输出 #1
```
15
9
7
8
-1
```
## 提示

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（7 pts）：$k=1$。
- Subtask 2（10 pts）：每个订单中的 $a=0$。
- Subtask 3（8 pts）：$o \le 100$。
- Subtask 4（31 pts）：$o \le 3000$。
- Subtask 5（44 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n \le 50000$，$1 \le o \le 10000$，$1 \le k \le 5$，$0 \le a < b < n$，$1 \le t \le 10000$。

#### 说明

**翻译自 [BOI 2017 D1](https://boi.cses.fi/files/boi2017_day1.pdf) T3 Toll。**  
翻译者：@[一只书虫仔](https://www.luogu.com.cn/user/114914)。   
**本题强制 $O2$ 优化。**


---

---
title: "「Wdsr-2」阴阳玉"
layout: "post"
diff: 省选/NOI-
pid: P6734
tag: ['动态规划 DP', '数学', '2020', '矩阵运算', '洛谷原创', '分治', '动态规划优化', '矩阵加速', '矩阵乘法']
---
# 「Wdsr-2」阴阳玉
## 题目背景

博丽灵梦有一块好大好大的阴阳玉，它是是博丽灵梦的主要武器之一。

但是阴阳玉的能量来源，源自主人的灵力聚集力量，因此，灵梦在平时总是需要对其进行保养。简单来说，灵梦会使用灵力，来获取阴阳玉所需的能量。


## 题目描述

灵力有阴阳之分。初始的时候，灵梦只有两个阳灵力，它们围成了一个圈。每次，灵梦可以进行以下两种操作：

- 在两个灵力直接加入一个阳灵力。

- 移走一个阳灵力。

为了保持稳定，任何时候这个圈上的灵力都**不应该少于两个**。

由于灵力的阴阳并不稳定，因此一旦某个灵力周围发生改变（多出一个灵力，或减少一个灵力），它就会从阳变成阴，或从阴变成阳。不过，如果只是周边灵力的性质改变，那么它就不会发生变化。

灵梦会不断调节灵力，直到它**最终**变成 $n$ 个（中途可能多于 $n$ 个）。然后，灵梦会从某个点**依次**按照顺时针或逆时针取下每个灵力。它会形成一条链。灵梦会用链上的能量，来加强她的阴阳玉。

做到这一点非常容易。但是灵梦非常好奇，一共可能形成多少种不同的**链**。

由于灵梦的偏好，她可能会有 $m$ 个限制条件。第 $i$ 个条件 $(p_i,c_i)$ ，规定了链上第 $p_i$ 个灵力应该为何种灵力。若 $c_i=0$ ，则应该为阴灵力；否则为阳。

由于可能结果太大，灵梦只需要得到答案对 $998244353$ 取模的结果。

两个链不同，当且仅当存在一个位置的点颜色不同。
## 输入格式

第一行为一个正整数 $n$ 和一个非负整数 $m$ 。

当 $m=0$ 时无约束条件。否则接下来会有 $m$ 行，每行两个非负整数 $p_i,c_i$ ，含义如上。
## 输出格式

一行，一个非负整数，表示所有链的可能种类总数对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
4 0
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4 1
1 1
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
20 10
5 1
12 0
17 0
3 1
7 1
13 0
8 1
18 1
2 1
19 0
```
### 样例输出 #3
```
344
```
## 提示

#### 样例解释

对于样例一，可能存在以下两种构造方式：

![pic3.JPG/The "2"-th of the "1"-st.](https://i.loli.net/2020/07/17/VQn8MB7fxJsA1Rr.jpg)

其中， $\tt ADD$ 表示增加一个阳灵力，$\tt RMV$ 表示移走一个阳灵力。

将得到的两个环分别拆开，一共可以得到以下五种链：

- 环一：**阳—阳—阳—阳**。

- 环二：**阳—阳—阴—阴**，**阳—阴—阴—阳**，**阴—阴—阳—阳**，**阴—阳—阳—阴**。

因此答案为 $5$ 。

对于样例二，我们限定了链上第一个灵力为阳。因此结果为 $3$ 。

#### 数据范围

$$\def{\t}{\text}\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|}\hline
\textbf{Subtask} & n\t{ 的范围} & m\t{ 的范围} & \t{分值}\cr\hline
1 & n\le 16 & m\le 16 & 15 \cr \hline
2 & n\le 10^6 &  m\le 5\times 10^3 & 40 \cr \hline
3 & n\le 10^{18} & m=0 & 15 \cr \hline
4 & n\le 10^{18} & m\le 5\times 10^3 & 30 \cr \hline
\end{array}$$

此外，对于全部数据，有 $1\le p_i\le n,c_i\in \{0,1\}, 0\le m\le n$ 且 $p_i$ 各不相同。


---


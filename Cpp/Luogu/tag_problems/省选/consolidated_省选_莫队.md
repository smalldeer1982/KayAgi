---
title: "符卡对决"
layout: "post"
diff: 省选/NOI-
pid: P10268
tag: ['莫队', '并查集']
---
# 符卡对决
## 题目背景

灵梦正在和魔理沙进行符卡对决。

![Card](https://cdn.luogu.com.cn/upload/image_hosting/xu68nj8k.png)

> 永夜の报い，Pixiv76062895，作者是 minusT，侵删。
## 题目描述

灵梦一共有 $n$ 张符卡，每张卡都有一个能力值，对于第 $i$ 张卡，它的能力值为 $a_i$，现在她想从中选出两张符卡并使用它们，灵梦发现，如果她同时打出了两张符卡 $i, j$，这两张符卡造成的伤害将会是 $a_i\times a_j$。

这些符卡之间有能力的冲突，灵梦会告诉你这些符卡的兼容性，具体而言这些符卡之间有 $m$ 条关系，这些关系表明某两张符卡之间是兼容的，**注意**，如果符卡 $i, j$ 兼容且符卡 $j, k$ 兼容，那么符卡 $i, k$ 也是兼容的，如果打出的两张符卡之间不是兼容的，那么它们造成的伤害为 $0$。

她很好奇符卡之间的兼容性会造成什么样的影响，所以她会询问你 $q$ 次，每次告诉你一对正整数 $l, r$，意味着只有编号在区间 $[l, r]$ 内的关系才会生效。

灵梦不想把魔理沙虐得太惨，所以她会随机从所有符卡中选出两张**不同**的符卡来打出，她想知道每次询问造成的伤害的期望值对 $10^9 + 7$ 取模后是多少。
## 输入格式

第一行三个整数 $n, m, q$ 分别表示符卡总数，符卡间的关系总数，灵梦的询问次数。

接下来一行 $n$ 个正整数，第 $i$ 个表示 $a_i$。

接下来 $m$ 行，每行两个正整数 $u_i, v_i$，表示第 $u_i$ 张符卡与第 $v_i$ 张符卡是兼容的。

接下来 $q$ 行，每行两个正整数 $l_i, r_i$，表示灵梦询问的编号区间 $[l_i, r_i]$。
## 输出格式

一共 $q$ 行，第 $i$ 行一个整数，表示第 $i$ 次询问中，随机选择两张**不同**的符卡，造成伤害的期望值对 $10^9 + 7$ 取模后的结果。
## 样例

### 样例输入 #1
```
4 4 4
5 8 2 7 
3 1
1 4
3 2
1 4
2 4
1 2
2 3
3 3
```
### 样例输出 #1
```
500000012
833333349
500000012
666666674
```
### 样例输入 #2
```
14 16 15
1 2 7 3 2 4 6 2 5 7 2 4 3 3 
5 12
2 9
2 10
7 10
6 12
12 3
11 1
4 8
1 13
6 8
6 10
4 1
1 10
12 11
3 5
9 7
14 14
2 16
5 6
2 3
5 10
1 6
5 16
13 15
1 2
3 7
3 4
14 14
3 7
6 7
11 14
```
### 样例输出 #2
```
318681321
263736277
868131875
725274731
32967035
384615390
637362648
780219786
967032974
406593411
208791211
318681321
406593411
945054952
681318687
```
## 提示

#### 样例 1 解释

对于第三组询问，只有 $(1, 4), (2, 3)$ 两对符卡之间是兼容的。

如果选择的符卡是 $(1, 2)$，那么它们不兼容，伤害值为 $0$，这种情况的概率是 $\dfrac16$。

如果选择的符卡是 $(1, 3)$，那么它们不兼容，伤害值为 $0$，这种情况的概率是 $\dfrac16$。

如果选择的符卡是 $(1, 4)$，它们兼容，伤害值为 $a_1\times a_4 = 35$，这种情况的概率是 $\dfrac16$。

如果选择的符卡是 $(2, 3)$，它们兼容，伤害值为 $a_2\times a_3 = 16$，这种情况的概率是 $\dfrac16$。

如果选择的符卡是 $(2, 4)$，那么它们不兼容，伤害值为 $0$，这种情况的概率是 $\dfrac16$。

以此类推，最终的期望值是 $\dfrac{17}{2}$，其在模 $10^9 + 7$ 意义下等于 $500000012$。

#### 数据范围

**本题采用捆绑测试。**

对于所有数据，$1\le n, q\le 10^5, 1\le m\le 2n, 1\le a_i\le 10^9, 1\le l_i\le r_i\le m, 1\le u_i, v_i\le n$。

对于不同的子任务，我们如下约定：

| 子任务编号 | $n$         | $q$         | 特殊性质 | 子任务分值 |
| ---------- | ----------- | ----------- | -------- | ---------- |
| $0$        | $\le300$    | $\le300$    | 无       | $5$        |
| $1$        | $\le 2000$  | $\le 2000$  | A        | $10$       |
| $2$        | $\le 2000$  | $\le 2000$  | B        | $5$       |
| $3$        | $\le 2000$  | $\le 2000$  | 无       | $10$       |
| $4$        | $\le 30000$ | $\le 30000$ | 无       | $10$       |
| $5$        | $\le 50000$ | $\le 50000$ | A        | $10$       |
| $6$        | $\le 50000$ | $\le 50000$ | B        | $10$       |
| $7$        | $\le 50000$ | $\le 50000$ | 无       | $15$       |
| $8$        | $\le 10^5$  | $\le 10^5$  | 无       | $25$       |

- **特殊性质 A**：保证 $u_i = 1, v_i = i + 1, m = n - 1$。
- **特殊性质 B**：保证 $l_i = 1$。



---

---
title: "[Code+#6] 校门外的树"
layout: "post"
diff: 省选/NOI-
pid: P11443
tag: ['莫队', '根号分治', 'Code+']
---
# [Code+#6] 校门外的树
## 题目背景

搬运自 [Code+ 第 6 次网络赛](https://gitlink.org.cn/thusaa/codeplus6/)。
## 题目描述

L 校门外有一条大马路，路边种了许多的树。L 校的新校长 Lsy 认为学校应该在校门内的马路边种许多的树来绿化环境。在他的植树计划中，共需种植 $n$ 棵树，每棵树都有一个高度 $h_{i}$。然而他是一个很信风水的人，为了保证校园的风水，他请来了作为风水大师的你来为他计算这个植树方案的幸运值。


对于 $n$ 棵树组成的序列，定义其中一个区间 $[u ,v]$ 的幸运值为：

$$\prod\limits_{i=u}^{v-1}\prod\limits_{j=i+1}^{v}\operatorname{gcd}(h_i,h_j)$$

如果 $u = v$ 则幸运值为 $1$。

现在你需要回答 L 校长对于 $q$ 个区间的询问，对于每个询问回答该区间幸运值 $\bmod 998244353$ 的值。
## 输入格式

第一行为两个整数 $n,q$。

第二行为 $n$ 个整数 $h_{i}$。

接下来 $q$ 行，每行两个整数 $u,v$，表示 $q$ 次询问。
## 输出格式

对于每个询问输出一行，为该区间的幸运值 $\bmod 998244353$ 的值。
## 样例

### 样例输入 #1
```
6 2
7 9 10 6 2 5
1 4
2 5
```
### 样例输出 #1
```
6
24
```
## 提示

### 数据范围

任何时候，保证 $1 \leq n,q, h_{i}\leq 10^5$。

每个子任务的额外约定：

- Subtask1（$10$ 分）：$n,q \leq 100$。
- Subtask2（$10$ 分）：$h_{i}$ 全部相等。
- Subtask3（$15$ 分）：$h_{i} \leq 10^3$。
- Subtask4（$10$ 分）：$q = 1$。
- Subtask5（$25$ 分）：$n, q \leq3\times10^4$。
- Subtask6（$30$ 分）：无额外约束。


---

---
title: "无聊"
layout: "post"
diff: 省选/NOI-
pid: P11661
tag: ['莫队', 'O2优化', '分治', 'ST 表', '笛卡尔树', '根号分治']
---
# 无聊
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/f9kqwg7m.png)
## 题目描述

白很无聊呢，于是她给空出了道题。

给出 $n$ 个数的序列 $a,b$。

求 $b_l\equiv b_r\pmod {\displaystyle\max_{l\le i\le r}a_i}$ 的 $(l,r)$ 个数。
## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个整数表示 $a$ 序列。

第三行 $n$ 个整数表示 $b$ 序列。
## 输出格式

一个整数。
## 样例

### 样例输入 #1
```
10
5 5 7 8 6 7 2 1 7 2 
4 11 7 19 13 8 10 11 10 7 
```
### 样例输出 #1
```
15
```
## 提示

对于所有测试数据，保证：$1\le n,a_i,b_i\le 5\times10^5$。

| Subtask | $n\le$ | 限制 | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| $0$ | $10^4$ | - | $5$ |
| $1$ | $10^5$ | $a_i\ge a_{i+1}$ | $15$ |
| $2$ | $10^5$ | - | $30$ |
| $3$ | $5\times10^5$ | - | $50$ |


---

---
title: "[IAMOI R1] 家庭矛盾"
layout: "post"
diff: 省选/NOI-
pid: P11763
tag: ['莫队', '分块']
---
# [IAMOI R1] 家庭矛盾
## 题目背景

小 L 和小 C 发生了一些家庭矛盾，小 C 和小 L 徘徊在分手的边缘。
## 题目描述

小 L 和小 C 在一起生活的的每一天都可以用一个二元组 $(a_i,c_i)$ 表示。$c_i$ 要么是 $0$ ，要么是 $1$，代表这天小 L 和小 C 有没有吵架。而 $a_i$ 则是一个整数，代表这一天小 C 的心情值。

小 L 和小 C 正在同时进行 $m$ 场家庭战争。第 $k$ 场战争从第 $l_k$ 天开始。

由于他们的战争非常激烈，你不知道他们在第几天会结束这场战争。但如果这场战争于第 $r$ 天结束，且从第 $l_k$ 天到第 $r$ 天吵架的天数恰好为 $d_k$，那么这场战争就会给小 C 带来一定的怨气值。怨气值为第 $l_k$ 天到第 $r$ 天小 C 心情值的逆序对个数。否则，小 C 的怨气值就为 $0$。

现在，小 L 把这 $n$ 天的 $(a_i,c_i)$ 和 $m$ 场战争的 $l_k$ 和 $d_k$ 告诉了你。对于每场战争，小 L 希望知道对于所有可能的结束时间，小 C 的怨气值之和，以便他挽回和小 L 的感情。他会非常感激你的帮助，并给你 $7420738134810 \bmod 12673$ 元作为感谢。

### 形式化题意

你有 $n$ 个二元组 $(a_{i},c_{i})$，其中满足 $c_{i} \in \{0,1\}$。

现在有 $m$ 个询问，每次询问给出两个整数 $l_{k},d_{k}$，求：

$$
\sum_{r=l_{k}}^{n} \left[\left(\sum_{i=l_{k}}^{r} c_{i}\right)=d_{k}\right] \sum_{i=l_{k}}^{r} \sum_{j=i+1}^{r} [a_{j}<a_{i}]
$$
其中中括号内的式子若为真，则其值为 $1$，否则为 $0$。
## 输入格式

第一行一个整数 $n$，表示序列长度。

接下来 $n$ 行，每行两个整数 $a_{i},c_{i}$，表示小 L 和小 C 在一起生活的第 $n$ 天的描述二元组。

然后一行一个整数 $m$，表示战争的场数。

接下来 $m$ 行，每行两个整数 $l_{k},d_{k}$，代表一次战争。
## 输出格式

输出 $m$ 行，表示每次战争中，对于的所有可能的结束时间，小 C 的怨气值之和。
## 样例

### 样例输入 #1
```
4
4 0
5 1
3 0
2 1
2
3 1
1 2
```
### 样例输出 #1
```
1
5
```
## 提示

### 样例解释 $1$

对于询问 $1$，只有区间 $[3,4]$ 符合条件，所以答案为 $1$。

对于询问 $2$，只有区间 $[1,4]$ 符合条件，所以答案为 $5$。

### 数据范围

|测试点编号| $n,m\le$ | 特殊性质 |
| :-----------: | :-----------: | :-----------: |
| $1$ | $100$ | 无 | 
| $2,3$ | $10^3$ | 无 |
| $4,5$ | $10^5$ | A |
| $6\sim8$ | $10^5$ | B |
| $9,10$ | $10^5$ | CD |
| $11,12$ | $5\times10^4$ | C |
| $13,14$ | $10^5$ | C |
| $15\sim 17$ | $10^5$ | D |
| $18\sim20$ | $5\times10^4$ | 无 |
| $21\sim25$ | $10^5$ | 无 |

特殊性质 A：保证 $c_i=0$。

特殊性质 B：保证 $d_{k}=1$。

特殊性质 C：保证 $c_i=1$。

特殊性质 D：保证询问中 $\forall k<m,l_{k} \le l_{k+1},d_{k} \le d_{k+1}$。

对于 $100\%$ 的数据，$1\le n,m\le10^5$，$1\le l_k\le n$，$1\le a_i\le10^9$，$c_{i} \in \{0,1\}$，$0\le d_k\le 10^9$。

保证此题的时空限制是标程的 **2** 倍及以上。


---

---
title: "在小小的奶龙山里面挖呀挖呀挖（加强版）"
layout: "post"
diff: 省选/NOI-
pid: P12003
tag: ['莫队', '洛谷原创', 'O2优化', '洛谷月赛', '根号分治']
---
# 在小小的奶龙山里面挖呀挖呀挖（加强版）
## 题目背景

夏天快要到了，去兴绍奶龙山参加 ION5202 的 0p 决定探究奶龙山的性质。
## 题目描述

奶龙山内部存在复杂的奶龙山隧道，但是聪明的 0p 一眼就看出了 $n-1$ 条奶龙山隧道的结构是一颗树。其中任意两个隧道只在 $n$ 个休息点处相交，两两休息点之间都有路径联通，第 $i$ 个休息点有一个权值 $a_i$，对于每一个素数 $p$，若 $p\mid a_i$ 则说明 $p$ 公司参与了休息点建设。想要经过一个休息点，就必须和所有参与了休息点建设的公司搞好关系。

0p 有 $q$ 条心仪的路线，第 $i$ 条是从休息点 $u$ 走到休息点 $v$，对于每一条路线，0p 想知道，他需要与多少公司搞好关系才可以成功地走完这一条路线。

**请注意算法常数对时间效率的影响**。
## 输入格式

第一行，两个正整数 $n,q$。

第二行，共 $n$ 个正整数，第 $i$ 个正整数表示 $a_i$。

接下来 $n-1$ 行，每行两个正整数 $u,v$，表示一条树边。

接下俩 $q$ 行，每行两个正整数 $u,v$，表示一条路线。
## 输出格式

输出共 $q$ 行，对于每一条路线，输出所求的答案。
## 样例

### 样例输入 #1
```
3 1
7 2 1
1 2
1 3
2 3
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
10 7
9 9 8 2 4 4 3 5 3 97
1 2
1 3
3 4
5 2
6 4
7 5
9 1
10 2
3 8
4 5
2 3
4 6
2 4
1 2
4 10
1 1
```
### 样例输出 #2
```
2
2
1
2
1
3
1
```
## 提示

对于 $100\%$ 的数据，满足 $1\leq n,q\leq 3\times10^5$，$1\leq a_i\leq 10^8$。


---

---
title: "[Aboi Round 1] I なんです"
layout: "post"
diff: 省选/NOI-
pid: P12524
tag: ['莫队', 'O2优化', '根号分治']
---
# [Aboi Round 1] I なんです
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/r38iwta6.png)
## 题目描述

有一个长度为 $n$ 的序列 $\{a\}$，$q$ 次询问，每次给你一个区间 $[l,r]$，求该区间内所有长度为奇数的子序列的 $\gcd$ 的平方之积，答案对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,q$。

第二行 $n$ 个正整数 $a_i$。

之后 $q$ 行，每行两个正整数 $l,r$。
## 输出格式

对于每次询问，输出对应的答案。
## 样例

### 样例输入 #1
```
10 5
1 3 5 2 4 6 8 8 8 10
1 3
5 7
3 6
8 10
7 10
```
### 样例输出 #1
```
225
147456
230400
1638400
562036629
```
### 样例输入 #2
```
10 5
2 2 2 2 2 2 2 2 2 2
1 2
1 4
1 5
1 6
1 7
```
### 样例输出 #2
```
16
65536
301989884
932051910
299560064
```
## 提示

对于 $100\%$ 的数据，$1\leq n,q,a_i\leq10^5$。

本题采用捆绑测试，你需要通过一个子任务的所有测试点才能得到该子任务的分数。

| 子任务编号 | $n$ | $q$ | $a_i$ | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $\le20$ | $\le20$ | $\le10^5$ | / | $10$ |
| $2$ | $\le10^3$ | $\le10^3$ | $\le10^5$ | / | $10$ |
| $3$ | $\le3\times10^4$ | $\le3\times10^4$ | $\le10^5$ | / | $10$ |
| $4$ | $\le10^5$ | $\le10^5$ | $\le10^5$ | $\text{A}$ | $5$ | 
| $5$ | $\le10^5$ | $\le10^5$ | $\le300$ | / | $10$ |
| $6$ | $\le10^5$ | $\le10^5$ | $\le10^5$ | / | $55$ |

特殊性质 $\text{A}$：所有 $a_i$ 均相同。


---

---
title: "参数要吉祥"
layout: "post"
diff: 省选/NOI-
pid: P12598
tag: ['莫队']
---
# 参数要吉祥
## 题目描述


扶苏是一个大型语言模型。她共有 $n$ 个参数，依次为 $a_1, a_2, \dots a_n$。现在，你要和她进行 $q$ 次交互。扶苏有先进的混合专家模型（MoE）技术，每轮交互你都会给定一个区间 $[l, r]$，扶苏只有 $a_l, a_{l + 1}, \dots a_r$ 这些参数会被激活。

对于整数 $x$，我们定义其吉祥程度为在一组激活的参数里出现次数为 $x$ 的数的种类数，记为 $c(x)$。对于每次交互，你要找到一个 $x$ 使 $x \times c(x)$ 最大，输出 $x \times c(x)$。

例如，对于一组参数 $[1,1,2,2,33,33,444,444,444]$，则有 $1,2,33$ 这三种数出现了 $2$ 次，取 $x = 2$，得到 $x \times c(x) = 6$。

## 输入格式


第一行是两个整数，表示参数个数 $n$ 和交互次数 $q$。  
第二行有 $n$ 个整数，表示 $a_1, a_2, \dots a_n$。  
接下来 $q$ 行，每行两个整数，表示一次交互激活的参数区间 $[l, r]$。

## 输出格式


对每次交互，输出一行一个整数，表示最大的 $x \times c(x)$。

## 样例

### 样例输入 #1
```
9 2
1 1 2 2 3 3 4 4 4
1 9
5 9
```
### 样例输出 #1
```
6
3
```
## 提示

### 数据规模与约定

|测试点编号| $n,q\leq$|特殊约定|
|:-: | :-: | :-: | 
| $1 \sim 4$ | $100$ | 无  |
| $5 \sim 9$ | $10^3$ | 无 |
| $10 \sim 15$ | $3 \times 10^4$ | 无|
| $16 \sim 21$ | $2 \times 10^5$ | 每个数出现次数均不超过 $100$|
| $22 \sim 25$ | $2 \times 10^5$ | 无 |

对全部的测试数据，保证 $1 \leq n,a_i, q \leq 2 \times 10^5$，$1 \leq l \leq r \leq n$。


---

---
title: "K-LCA"
layout: "post"
diff: 省选/NOI-
pid: P13644
tag: ['莫队', 'O2优化', '树链剖分']
---
# K-LCA
## 题目背景

成本越低，赚的越多！
## 题目描述

T 国由 $n$ 座城市组成，首都在 $1$ 号城市，有 $(n-1)$ 条道路连接着这些城，且所有城市都可以通过这些道路到达首都。

有 $q$ 轮旅行活动，第 $i$ 次旅游会有一个参数 $(l_i,r_i)$，每次都有 $k$ 个人，他们每个人都会在编号在 $[l_i,r_i]$ 的城市中选择一个城市作为出发点。为了让每个人都有独处空间，任意两人不会选择同一个城市。

然后他们开始进行旅行。由于靠近首都的城市更高级，所以旅行者会向首都方向移动。

最终他们会在一个城市会聚，然后旅行结束。旅游公司没有足够经费让旅行者去更高级的城市，所以旅游公司会让他们会聚的城市离首都尽可能远。

现在旅游公司问你，他们会聚的地方，离首都距离最远是多少？两个城市之间的距离定义为最短路径上城市的个数（包括路径端点的两个城市）。
## 输入格式

第一行三个数 $n,q,k$。

接下来 $(n-1)$ 行，每行两个正整数 $u,v$ 表示一条边。

接下来 $q$ 行，每行两个正整数 $l,r$ 表示一次询问。
## 输出格式

共 $q$ 行，第 $i$ 行表示第 $i$ 次询问的答案。
## 样例

### 样例输入 #1
```
5 7 2
1 2
1 3
2 4
2 5
1 3
1 4
1 5
2 4
2 5
3 5
4 5

```
### 样例输出 #1
```
1
2
2
2
2
2
2

```
## 提示

**本题有捆绑测试**，每个子任务均为 $20$ 分。

| 子任务编号 | $n$ | $q$ | 特殊性质 | 时间限制 | 子任务依赖 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $0$ | $10^4$ | $10^4$ | 无 | 3s | 无 |
| $1$ | $2\times10^4$ | $5\times10^4$ | 无 | 3s | $0$ |
| $2$ | $5\times10^4$ | $5\times10^4$ | 无 | 5s | $1$ |
| $3$ | $10^5$ | $10^5$ | **有** | 7s | 无 |
| $4$ | $10^5$ | $10^5$ | 无 | 7s | $2,3$ |

特殊性质：树的形态是以 $1$ 结点为链顶的一条链

对于 $100\%$ 的数据，$n\le 10^5,q\le10^5,1< k\le n,r-l+1\ge k$。


---

---
title: "【MX-X16-T6】「DLESS-3」XOR and Powerless Suffix Mode"
layout: "post"
diff: 省选/NOI-
pid: P13688
tag: ['莫队', 'O2优化', '组合数学', 'Lucas 定理', '根号分治', '梦熊比赛']
---
# 【MX-X16-T6】「DLESS-3」XOR and Powerless Suffix Mode
## 题目描述

我们称 $x$ 是序列 $a$ 的一个子序列中的 Powerless Suffix Mode，当且仅当：

- $x$ 是该子序列的众数$^{\dagger}$。
- 不存在满足 $i < j$ 的下标 $i, j$ 使得 $a_i = a_j = x$ 且 $a_i$ 属于该子序列、$a_j$ 不属于该子序列。
- $x$ 在子序列中出现次数不超过 $x$ 在整个序列中出现次数的 $p\%$。

给定长度为 $n$ 的非负整数序列 $a_1, \ldots, a_n$。给出 $q$ 次询问，每次询问给出整数 $l,r,p$（$1 \le l \le r \le n$，$1 \le p \le 100$），求序列 $b=[a_l,a_{l+1},\dots,a_{r-1},a_r]$ 所有非空子序列 Powerless Suffix Mode 的异或和（若某个子序列有多个 Powerless Suffix Mode 则全部异或，若没有则异或 $0$）。

**注意，此时判定一个数是否是 Powerless Suffix Mode 的条件中，“整个序列”为序列 $b$。**

---
$^{\dagger}$一个序列的众数是指序列中出现次数最多的数，一个序列可以有多个众数，例如序列 $[1,2,1,3,2]$ 的众数有 $1$ 和 $2$。
## 输入格式

第一行，两个整数 $n,q$。

第二行，$n$ 个整数 $a_1, \ldots, a_n$。

接下来 $q$ 行，每行三个整数 $l,r,p$，表示一次询问。
## 输出格式

对于每次询问，输出一行一个数，表示答案。
## 样例

### 样例输入 #1
```
13 6
1 1 4 5 1 4 1 9 1 9 8 1 0
7 9 100
3 6 50
7 11 100
7 11 99
1 3 100
2 4 100
```
### 样例输出 #1
```
9
0
8
0
4
0
```
### 样例输入 #2
```
18 1
1 1 1 1 1 1 2 2 2 2 2 2 4 4 4 4 4 4
1 18 40
```
### 样例输出 #2
```
7
```
## 提示

**【样例解释 #1】**

为了方便说明，以下简称 Powerless Suffix Mode 为 PSM。

对于第一组询问，考察的序列是 $b=[1, 9, 1]$。该序列的非空子序列有 $[1]$、$[9]$、$[1]$、$[1,9]$、$[1,1]$、$[9,1]$、$[1,9,1]$。子序列 $[9]$ 的 PSM 是 $9$；子序列 $[1,9]$ 的众数是 $1$ 和 $9$，但是由于 $b_1=b_3=1$ 且 $b_1$ 在子序列中而 $b_3$ 不在，所以其中只有 $9$ 是 PSM。枚举可得，将所有子序列的 PSM 全部异或起来，最终结果为 $9$。

对于第二组询问，考察的序列是 $b=[4, 5, 1, 4]$。$p=50\%$ 的限制意味着，若一个数在子序列中成为 PSM，它的出现次数不能超过它在 $b$ 中出现次数的 $50\%$。例如，对于数 $4$，它在 $b$ 中出现 $2$ 次，那么在子序列中最多出现 $2\times 50\%=1$ 次。枚举可得，所有非空子序列的 PSM 的异或和为 $0$。


**【数据范围】**

**本题采用捆绑测试。**

对于所有数据，保证 $1\le n\le 2.5\times10^5$，$1\le q\le 2.5\times10^5$，$0\le a_i<2^{24}$，$1\le l\le r\le n$，$1 \le p\le100$。

各子任务特殊限制如下：

| 子任务编号 | $n\le$ | $q\le$ | $a_i<$ | 分值 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $18$ | $20$ | $2^{24}$ | $7$ |
| $2$ | $500$ | $500$ | $2^{24}$ | $11$ |
| $3$ | $5000$ | $5000$ | $2^{24}$ | $15$ |
| $4$ | $2.5\times10^5$ | $2.5\times10^5$ | $2$ | $13$ |
| $5$ | $2.5\times10^5$ | $2.5\times10^5$ | $2^6$ | $14$ |
| $6$ | $2.5\times10^5$ | $2.5\times10^5$ | $2^8$ | $14$ |
| $7$ | $5\times10^4$ | $2.5\times10^5$ | $2^{24}$ | $14$ |
| $8$ | $2.5\times10^5$ | $2.5\times10^5$ | $2^{24}$ | $12$ |



---

---
title: "[SCOI2012] 喵星球上的点名"
layout: "post"
diff: 省选/NOI-
pid: P2336
tag: ['2012', '四川', '莫队', '各省省选', 'AC 自动机', '后缀数组 SA']
---
# [SCOI2012] 喵星球上的点名
## 题目描述

a180285 幸运地被选做了地球到喵星球的留学生。他发现喵星人在上课前的点名现象非常有趣。

假设课堂上有 $n$ 个喵星人，每个喵星人的名字由**姓**和**名**构成。喵星球上的老师会选择 $m$ 个串来点名，每次读出一个串的时候，如果这个串是一个喵星人的姓或名的**子串**，那么这个喵星人就必须答到。

然而，由于喵星人的字码如此古怪，以至于不能用 ASCII 码来表示。为了方便描述，a180285 决定用数串来表示喵星人的名字。



现在你能帮助 a180285 统计每次点名的时候有多少喵星人答到，以及 $m$ 次点名结束后每个喵星人答到多少次吗？

## 输入格式

首先定义喵星球上的字符串给定方法：

先给出一个正整数 $l$，表示字符串的长度，接下来 $l$ 个整数，第 $i$ 个整数 $a_i$ 表示字符串的第 $i$ 个字符。

输入的第一行有两个整数，分别表示喵星人的个数 $n$ 个点名次数 $m$。  
接下来 $n$ 行，每行两个喵星球上的字符串，按照定义的方法给出，依次表示第 $i$ 只喵的姓和名。  
接下来 $m$ 行，每行一个喵星球上的字符串，表示一个老师点名的串。
## 输出格式

对于每个老师点名的串，输出一行一个整数表示有多少只喵答到。  
然后在最后一行输出 $n$ 个用空格隔开的整数，第 $i$ 个整数表示第 $i$ 个喵星人被点到的次数。

## 样例

### 样例输入 #1
```
2 3
6 8 25 0 24 14 8 6 18 0 10 20 24 0
7 14 17 8 7 0 17 0 5 8 25 0 24 0
4 8 25 0 24
4 7 0 17 0
4 17 0 8 25

```
### 样例输出 #1
```
2
1
0
1 2
```
## 提示

#### 样例 1 解释

事实上样例给出的数据如果翻译成地球上的语言可以这样来看

```plain
2 3
izayoi sakuya
orihara izaya
izay
hara
raiz
```

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n, m \le 10^3$，喵星人的名字总长不超过 $4\times10^3$，点名串的总长不超过 $2\times10^3$。
- 对于$100\%$ 的数据，保证 $1 \leq n\le 5 \times 10^4$，$1 \leq m \le 10^5$，喵星人的名字总长和点名串的总长分别不超过 $10^5$，保证喵星人的字符串中作为字符存在的数不超过 $10^4$ 。


---

---
title: "美好的每一天"
layout: "post"
diff: 省选/NOI-
pid: P3604
tag: ['莫队', '洛谷原创', '洛谷月赛', '状压 DP']
---
# 美好的每一天
## 题目背景

**时间限制3s,空间限制162MB**


素晴らしき日々

我们的情人，不过是随便借个名字，用幻想吹出来的肥皂泡，把信拿去吧，你可以使假戏成真。我本来是无病呻吟，漫无目的的吐露爱情---现在这些漂泊不定的鸟儿有地方栖息了，你可以从信里看出来。拿去吧---由于不是出自真心，话就说得格外动听，拿去吧，就这么办吧...


由于世界会在7月20日完结，作为救世主，间宫卓司要在19日让所有人回归天空

现在已经是19日傍晚，大家集合在C栋的天台上，一共n个人

在他们面前，便是终之空，那终结的天空

![](https://cdn.luogu.com.cn/upload/pic/4139.png)

## 题目描述

回归天空是一件庄重的事情，所以卓司决定让大家分批次进行，给每个人给了一个小写字母'a'->'z'作为编号

一个区间的人如果满足他们的**编号重排之后可以成为一个回文串**，则他们可以一起回归天空，即这个区间可以回归天空

由于卓司是一个喜欢妄想的人，他妄想了m个区间，每次他想知道每个区间中有多少个子区间可以回归天空

因为世界末日要来了，所以卓司的信徒很多

![](https://cdn.luogu.com.cn/upload/pic/4138.png)

## 输入格式

第一行两个数n,m

之后一行一个长为n的字符串，代表每个人的编号

之后m行每行两个数l,r代表每次卓司妄想的区间

## 输出格式

m行，每行一个数表示答案

## 样例

### 样例输入 #1
```
6 6
zzqzzq
1 6
2 4
3 4
2 3
4 5
1 1
```
### 样例输出 #1
```
16
4
2
2
3
1
```
### 样例输入 #2
```
6 6
aaabbb
1 2
2 3
3 4
4 5
5 6
1 6
```
### 样例输出 #2
```
3
3
2
3
3
17
```
### 样例输入 #3
```
4 1
yuno
1 4
```
### 样例输出 #3
```
4
```
## 提示

对于10%的数据，n,m<=100

对于30%的数据，n,m<=2000

对于100%的数据，n,m<=60000

**字符集大小有梯度**


在大家回归天空之后，彩名露出了阴冷的笑容

![](https://cdn.luogu.com.cn/upload/pic/4137.png)



---

---
title: "小清新人渣的本愿"
layout: "post"
diff: 省选/NOI-
pid: P3674
tag: ['莫队', '洛谷原创', 'O2优化', '枚举', '洛谷月赛']
---
# 小清新人渣的本愿
## 题目背景

**本题时限3s，空间128MB**

我感觉我要挂省选

人渣的本愿是一个有趣的番

可爱的花火喜欢从小和她谈♂笑♂风♂生的欧♂尼♂酱鸣海，欧尼酱特别想当老师，然后剧本安排当了花火的班主任。

然而有个叫做皆川茜的奇怪的人抢走了欧尼酱！

花火就很失落呀，然后看到一个叫做麦的人也很失落，原来麦喜欢茜老师。。。

花火和麦从此天天谈笑风生，然后决定在一起，把对方当做自己喜欢的人的替代品

因为花火很可爱，所以有许多奇怪的人喜欢花火，比如一个叫做绘鸠早苗的妹子

因为麦长的也不错，所以有许多奇怪的人喜欢麦，比如一个叫做最可的妹子

然后就开始愉快的生♂活了~

以上内容如果你没有看过这个番可以无视掉


按照套路，现在欧尼酱会问花火一个OI问题（一般是数据结构），然后花火肯定不会OI，所以会来请教您这位IOI Au选手，然后您肯定会帮助她

但是
这个套路太无聊了，我们来换一个（但是不会改变您是IOI Au选手的事实）

花火有一天看了几个有趣的番，叫做“在W??身上寻找女装是否搞错了什么”，“从女装开始的?X?”，“我家大佬不可能那么可爱”，然后发现??H太厉害了，然后就穿越到了异世界，和???谈笑风生

花火就和???做了一个交♂易，花火帮???做一道题，然后???帮花火改写地球online的程序，让花火和欧尼酱在♂一♂起

???虽然非常厉害，但是不会数据结构题，他最近刚刚遇到一道有趣的数据结构题，于是他接受了交易

但是花火也不会数据结构题呀

所以又回到了这个老套路，就靠您这个IOI Au选手来帮她了！

以上内容如果你没有看过这个番还是可以无视掉

这里用一个经典的图来解释这个关系（其实没那么蛋疼的）

![](https://cdn.luogu.com.cn/upload/pic/4628.png)

## 题目描述

这个题是这样的：

给你一个序列 $a$，长度为 $n$，有 $m$ 次操作，每次询问一个区间是否可以选出两个数它们的差为 $x$，或者询问一个区间是否可以选出两个数它们的和为 $x$，或者询问一个区间是否可以选出两个数它们的乘积为 $x$ ，这三个操作分别为操作 $1,2,3$。

选出的这两个数可以是同一个位置的数。

![](https://cdn.luogu.com.cn/upload/pic/4629.png)

## 输入格式

第一行两个数 $n,m$。

后面一行 $n$ 个数表示 $a_i$。

后面 $m$ 行每行四个数 `opt l r x`。

$opt$ 表示这个是第几种操作，$l,r$ 表示操作的区间，$x$ 表示这次操作的 $x$。
## 输出格式

对于每个询问，如果可以，输出 `hana`，否则输出 `bi`。

## 样例

### 样例输入 #1
```
10 10
1 1 8 9 9 1 1 1 1 9 
3 5 9 42
2 1 3 14
2 3 5 2
2 3 3 6
1 6 10 18
3 4 9 14
2 1 4 22
3 1 3 32
2 5 6 32
3 1 9 17
```
### 样例输出 #1
```
bi
bi
bi
bi
bi
bi
bi
bi
bi
bi

```
### 样例输入 #2
```
5 5
1 1 2 3 4
2 1 1 2
1 1 2 2
3 1 1 1
3 5 5 16
1 2 3 4
```
### 样例输出 #2
```
hana
bi
hana
hana
bi
```
## 提示

定义 $c$ 为每次的 $x$ 和 $a_i$ 中的最大值，$a_i \geq 0$，每次的 $x\geq 2$。

对于 $10\%$ 的数据，$n,m,c \leq 100$。

对于另外 $10\%$ 的数据，$n,m,c \leq 3\times 10^3$。

对于另外 $10\%$ 的数据，只有 $1$ 操作。

对于另外 $10\%$ 的数据，只有 $2$ 操作。
 
对于另外 $10\%$ 的数据，只有 $3$ 操作。

对于 $100\%$ 的数据，$n,m,c \leq 10^5$。

![](https://cdn.luogu.com.cn/upload/pic/4630.png)



---

---
title: "大爷的字符串题"
layout: "post"
diff: 省选/NOI-
pid: P3709
tag: ['莫队', '离散化', '洛谷原创', 'O2优化', '洛谷月赛']
---
# 大爷的字符串题
## 题目背景

在那遥远的西南有一所学校，

/\*被和谐部分\*/

然后去参加该省省选虐场，

然后某蒟蒻不会做，所以也出了一个字符串题：
## 题目描述

给你一个字符串 $a$，每次询问一段区间的贡献。

贡献定义：

每次从这个区间中拿出一个字符 $x$ ，然后把 $x$ 从这个区间中删除，直到区间为空。你要维护一个集合 $S$。

- 如果 $S$ 为空，你 rp 减 $1$。 
- 如果 $S$ 中有一个元素不小于 $x$，则你 rp 减 $1$，清空 $S$。
- 之后将 $x$ 插入 $S$。

由于你是大爷，平时做过的题考试都会考到，所以每次询问你搞完这段区间的字符之后最多还有多少 rp？rp 初始为 $0$。

询问之间不互相影响~
## 输入格式

第一行两个整数 $n$，$m$，表示字符串长度与询问次数。

之后一行 $n$ 个数，第 $i$ 个整数表示给出的字符串的第 $i$ 个字符 $x_i$。

接下来 $m$ 行，每行两个整数 $l, r$，表示一次询问的区间。
## 输出格式

对于每次询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3
3 3 3
3 3
3 3
3 3
```
### 样例输出 #1
```
-1
-1
-1
```
## 提示

#### 数据规模与约定

- 对于 $10\%$ 的数据，是样例。
- 对于另外 $10\%$ 的数据，保证 $n,m \le 100$；
- 对于另外 $10\%$ 的数据，保证 $n,m \le 10^3$；
- 对于另外 $10\%$ 的数据，保证 $n,m \le 10^4$；
- 对于另外 $10\%$ 的数据，保证 $n,m \le 10^5$；
- 对于 $100\%$ 的数据，$1 \leq n,m \le 2 \times10^5$，$1 \leq a_i \leq 10^9$，$1 \leq l, r \leq n$。

保证数据像某省省选 day1T2 一样 sb，大家尽情用暴力水过题吧！

没事，你只要在一个好学校，就算这题只能拿到 10 分，也可以进队了。


---

---
title: "曼哈顿交易"
layout: "post"
diff: 省选/NOI-
pid: P3730
tag: ['莫队', '洛谷原创', '分块']
---
# 曼哈顿交易
## 题目背景

will 在曼哈顿开了一家交易所，每天，前来买卖股票的人络绎不绝。


现在，will 想要了解持股的情况。由于来交♂易的人实在是太多了，需要你写一个程序来帮他完成这个任务。

## 题目描述

- 前来交易的 $N$ 个人排成了一行，为了简便起见，每个人都只持有一种股票。
- 不同的的人可能会持有相同的股票。
- 定义一种股票的热度为持有该股票的人数。
- 每次，will 会给出这样的询问：在一段连续区间的人之中，热度第 $k$ 小的股票的热度是多少？

## 输入格式

- 第一行两个正整数 $N,M$，分别表示人数和询问的次数。
- 接下来一行 $N$ 个正整数，表示每个人所持的股票 $a_i$。
- 接下来 $M$ 行，每行三个正整数 $l,r,k$，表示询问区间 $[l, r]$ 中的第 $k$ 小的热度，保证 $l\leq r$。

## 输出格式

- 对于每个询问，输出一行一个数，表示区间 $[l, r]$ 中的第 $k$ 小的热度值。
- 如果 $k$ 大于区间里股票的种类数，输出 $-1$。

## 样例

### 样例输入 #1
```
4 4  
2 3 3 3  
1 4 1  
1 4 2  
1 3 2
1 3 3
```
### 样例输出 #1
```
1  
3  
2  
-1
```
## 提示

对于 $20\%$ 的数据，$N,M\leq 1000$。

对于另外 $10\%$ 的数据，所有的 $l=1, r=N$。

对于 $100\%$ 的数据，$1\leq N, M\leq 10^5$，$1\leq a_i\leq 10^9$。



---

---
title: "[WC2013] 糖果公园"
layout: "post"
diff: 省选/NOI-
pid: P4074
tag: ['2013', '莫队', '最近公共祖先 LCA', '分块', 'WC']
---
# [WC2013] 糖果公园
## 题目描述

Candyland 有一座糖果公园，公园里不仅有美丽的风景、好玩的游乐项目，还有许多免费糖果的发放点，这引来了许多贪吃的小朋友来糖果公园游玩。

糖果公园的结构十分奇特，它由 $n$ 个游览点构成，每个游览点都有一个糖果发放处，我们可以依次将游览点编号为 $1$ 至 $n$。有 $n - 1$ 条双向道路连接着这些游览点，并且整个糖果公园都是连通的，即从任何一个游览点出发都可以通过这些道路到达公园里的所有其它游览点。

糖果公园所发放的糖果种类非常丰富，总共有 $m$ 种，它们的编号依次为 $1$ 至 $m$。每一个糖果发放处都只发放某种特定的糖果，我们用 $C_i$ 来表示 $i$ 号游览点的糖果。

来到公园里游玩的游客都不喜欢走回头路，他们总是从某个特定的游览点出发前往另一个特定的游览点，并游览途中的景点，这条路线一定是唯一的。他们经过每个游览点，都可以品尝到一颗对应种类的糖果。

大家对不同类型糖果的喜爱程度都不尽相同。 根据游客们的反馈打分，我们得到了糖果的美味指数， 第 $i$ 种糖果的美味指数为 $V_i$。另外，如果一位游客反复地品尝同一种类的糖果，他肯定会觉得有一些腻。根据量化统计，我们得到了游客第 $i$ 次品尝某类糖果的新奇指数 $W_i$。如果一位游客第 $i$ 次品尝第 $j$ 种糖果，那么他的愉悦指数 $H$ 将会增加对应的美味指数与新奇指数的乘积，即 $V_j \times W_i$。这位游客游览公园的愉悦指数最终将是这些乘积的和。

当然，公园中每个糖果发放点所发放的糖果种类不一定是一成不变的。有时，一些糖果点所发放的糖果种类可能会更改（也只会是 $m$ 种中的一种），这样的目的是能够让游客们总是感受到惊喜。

糖果公园的工作人员小 A 接到了一个任务，那就是根据公园最近的数据统计出每位游客游玩公园的愉悦指数。但数学不好的小 A 一看到密密麻麻的数字就觉得头晕，作为小 A 最好的朋友，你决定帮他一把。

## 输入格式

从文件 `park.in` 中读入数据。

第一行包含三个正整数 $n, m, q$， 分别表示游览点个数、 糖果种类数和操作次数。

第二行包含 $m$ 个正整数 $V_1, V_2, \ldots, V_m$。

第三行包含 $n$ 个正整数 $W_1, W_2, \ldots, W_n$。

第四行到第 $n + 2$ 行，每行包含两个正整数 $A_i, B_i$，表示这两个游览点之间有路径可以直接到达。

第 $n + 3$ 行包含 $n$ 个正整数 $C_1, C_2, \ldots, C_n$。

接下来 $q$ 行， 每行包含三个整数 $Type, x, y$，表示一次操作：

- 若 $Type$ 为 $0$，则 $1 \leq x \leq n$， $1 \leq y \leq m$，表示将编号为 $x$ 的游览点发放的糖果类型改为 $y$；
- 若 $Type$ 为 $1$，则 $1 \leq x, y \leq n$，表示对出发点为 $x$，终止点为 $y$ 的路线询问愉悦指数。

## 输出格式

输出到文件 `park.out` 中。

按照输入的先后顺序，对于每个 $Type$ 为 $1$ 的操作输出一行，用一个正整数表示答案。

## 样例

### 样例输入 #1
```
4 3 5
1 9 2
7 6 5 1
2 3
3 1
3 4
1 2 3 2
1 1 2
1 4 2
0 2 1
1 1 2
1 4 2
```
### 样例输出 #1
```
84
131
27
84
```
## 提示

【样例解释】

我们分别用

![](https://cdn.luogu.com.cn/upload/image_hosting/isw3ib3u.png)

代表 $C_i$ 为 $1$、 $2$、 $3$ 的节点，在修改之前：

![](https://cdn.luogu.com.cn/upload/image_hosting/ttkzii1u.png)

在将 $C_2$ 修改为 $1$ 之后：

![](https://cdn.luogu.com.cn/upload/image_hosting/izro364w.png)

【数据规模与约定】

对于所有的数据： $1 \leq V_i, W_i \leq 10^6$，$1 \leq A_i, B_i \leq n$， $1 \leq C_i \leq m$， $W_1, W_2, \ldots, W_n$ 是非递增序列，即对任意 $1 < i \leq n$， 满足 $W_i \le W_{i-1}$。

其它的限制条件如下表所示：

![QQ20180113072014.png](https://cdn.luogu.com.cn/upload/image_hosting/g6884nx1.png)



---

---
title: "Rmq Problem / mex"
layout: "post"
diff: 省选/NOI-
pid: P4137
tag: ['莫队', '线段树', '可持久化', '分块', 'CTT（清华集训/北大集训）']
---
# Rmq Problem / mex
## 题目描述

有一个长度为 $n$ 的数组 $\{a_1,a_2,\ldots,a_n\}$。

$m$ 次询问，每次询问一个区间内最小没有出现过的自然数。
## 输入格式

第一行，两个正整数 $n,m$。  
第二行，$n$ 个非负整数 $a_1, a_2, \ldots , a_n$。  
接下来 $m$ 行，每行两个正整数 $l,r$，表示一次询问。
## 输出格式

输出 $m$ 行，每行一个数，依次表示每个询问的答案。
## 样例

### 样例输入 #1
```
5 5
2 1 0 2 1
3 3
2 3
2 4
1 2
3 5
```
### 样例输出 #1
```
1
2
3
0
3
```
## 提示

对于 $30\%$ 的数据：$1\leq n,m\leq 1000$。  
对于 $100\%$ 的数据：$1\leq n,m\leq 2\times {10}^5$，$1\leq l\leq r\leq n$，$0\leq a_i\leq 2\times 10^5$。


---

---
title: "[AHOI2013] 作业"
layout: "post"
diff: 省选/NOI-
pid: P4396
tag: ['2013', '莫队', '各省省选', '树状数组', '安徽', '分块']
---
# [AHOI2013] 作业
## 题目描述

此时己是凌晨两点，刚刚做了 Codeforces 的小 A 掏出了英语试卷。英语作业其实不算多，一个小时刚好可以做完。然后是一个小时可以做完的数学作业，接下来是分别都是一个小时可以做完的化学，物理，语文……小 A 压力巨大。

这时小 A 碰见了一道非常恶心的数学题，给定了一个长度为 $n$ 的数列和若干个询问，每个询问是关于数列的区间表示数列的第 $l$ 个数到第 $r$ 个数)，首先你要统计该区间内大于等于 $a$，小于等于 $b$ 的数的个数，其次是所有大于等于 $a$，小于等于 $b$ 的，且在该区间中出现过的数值的个数。

小 A 望着那数万的数据规模几乎绝望，只能向大神您求救，请您帮帮他吧。
## 输入格式

第一行两个整数 $n,m$

接下来 $n$ 个不超过 $10^5$ 的正整数表示数列

接下来 $m$ 行，每行四个整数 $l,r,a,b$，具体含义参见题意。

## 输出格式

输出 $m$ 行，分别对应每个询问，输出两个数，分别为在 $l$ 到 $r$ 这段区间中大小在 $[a,b]$ 中的数的个数，以及大于等于 $a$，小于等于 $b$ 的，且在该区间中出现过的数值的个数（具体可以参考样例）。

## 样例

### 样例输入 #1
```
3 4
1 2 2
1 2 1 3
1 2 1 1
1 3 1 3
2 3 2 3
```
### 样例输出 #1
```
2 2
1 1
3 2
2 1
```
## 提示

$N\leq 100000,M\leq 100000$，读入的数字均为 $[1,10^5]$ 内的正整数。


---

---
title: "[BJWC2018] 基础匹配算法练习题"
layout: "post"
diff: 省选/NOI-
pid: P4477
tag: ['2018', '莫队', '北京', '枚举']
---
# [BJWC2018] 基础匹配算法练习题
## 题目描述

小 S 最近学会了二分图匈牙利匹配算法。

现在二分图的 X 部有 $N$ 个数字 $A_i$，Y 部有 $K$ 个数字 $C_i$。

已知如果 $A_i + C_j \le  Z$，那么 $A_i$ 和 $C_j$ 之间就有一条边，求二分图（X，E，Y）的最大匹配数。

小 S 是初学者，所以她想做多做一些练习来巩固知识。于是她找到了一个长度为 $M$ 的正整数数组 $B$，每次她会在 $B$ 数组中抽取一段连续的区间 $[L_i,R_i]$，把区间 $[L_i,R_i]$ 的所有数字作为二分图 Y 部的 $K$ 个数字 $C_i$，然后重新求一次二分图最大匹配数。

小 S 打算一共做 $Q$ 次练习，但是她不知道每次计算出的答案对不对，你能帮帮她吗？
## 输入格式

第一行为三个正整数 $N,M,Z$。

第二行为 $N$ 个正整数，第 $i$ 个正整数表示 $A_i$。

第三行为 $M$ 个正整数，第 $i$ 个正整数表示 $B_i$。

第四行为一个整数 $Q$ 表示询问个数。

接下来 $Q$ 行每行两个正整数，第 $i$ 行的两个正整数分别表示 $L_i,R_i$。
## 输出格式

对于每次练习，输出该次练习的答案。
## 样例

### 样例输入 #1
```
4 10 8
1 2 4 6
6 3 6 2 8 4 9 10 6 8
4
1 4
2 5
5 6
1 6
```
### 样例输出 #1
```
4
3
1
4
```
## 提示

测试数据编号|$N$|$M$|$Q$
:-:|:-:|:-:|:-:
$1 \sim 4$|$\le 50$|$\le 50$|$\le 50$
$5 \sim 10$|$\le 2501$|$\le 2501$|$\le 2501$
$11\sim 14$|$\le 152501$|$\le 45678$|$\le 45678$
$15 ,16$|$\le 152501$|$\le 50$|$\le 52501$
$17 \sim 20$|$\le 152501$|$\le 52501$|$\le 52501$

对于 $100\%$ 的数据，$1 \le A_i,B_i,Z \le 10^9$，$1 \le L_i \le R_i \le Q$。

保证数据有一定梯度。


---

---
title: "[Ynoi Easy Round 2016] 掉进兔子洞"
layout: "post"
diff: 省选/NOI-
pid: P4688
tag: ['2016', '莫队', '离散化', 'O2优化', 'Ynoi']
---
# [Ynoi Easy Round 2016] 掉进兔子洞
## 题目背景

5.632

我（或者是在读这篇文字的你）不属于这个世界

这是世界的界限

6.41

世界的意义必定存在于世界之外

世界中的一切事物如其所存在般而存在，如其所发生般而发生

世界之中不存在价值

——《逻辑哲学论》

我们的情人，不过是随便借个名字，用幻想吹出来的肥皂泡

把信拿去吧，你可以使假戏成真

我本来是无病呻吟，漫无目的的吐露爱情---现在这些漂泊不定的鸟儿有地方栖息了，你可以从信里看出来

拿去吧---由于不是出自真心，话就说得格外动听，拿去吧，就这么办吧...

![](https://cdn.luogu.com.cn/upload/pic/21091.png)

果然……好女人要有的是，烟、楼顶……还有轻飘飘的衣服呀……

某一天，水上由岐看见天上掉下了个布制玩偶

为了被天空接受而投掷出的她的布偶，不知在天空飞舞了多少次，已经遍体鳞伤

“被天空接受”——那是为了寻找不知何时开始在这个城市流传的“回归天空之路”的行为

![](https://cdn.luogu.com.cn/upload/pic/21102.png)

为了被天空接受而被扔出去的木偶，在空中飞舞并最终坠落

那是为了将其本身即为世界的少女送予天空的少女的行为

![](https://cdn.luogu.com.cn/upload/pic/21093.png)

横跨银河，被称作Vega与Altair，或是织女星与牛郎星的两颗星星，再加上北十字星之顶的天鹅座构成了夏之大三角

它被称作譬如三位一体的神圣的图形

只有神圣的图形在天空闪耀之时，世界才与天空相遇

![](https://cdn.luogu.com.cn/upload/pic/21094.png)

我想试一试，第一次，也是最后一次的恶作剧

![](https://cdn.luogu.com.cn/upload/pic/21095.png)

那是...什么？

什么事也没有哦，只是，间宫君他自己主动跳下去了而已哦~

怎么回事？

什么事也没有哦，只是，间宫君他自己主动跳下去了而已哦~

但是我看到了，是那个杀死了大家吗？

什么事也没有哦，只是，间宫君他自己主动跳下去了而已哦~

不，那个东西，什么都没有做，只是...

什么事也没有哦，只是，间宫君他自己主动跳下去了而已哦~

只是...怎么回事...

什么事也没有哦，只是，间宫君他自己主动跳下去了而已哦~

我确实听到了头盖骨破碎的声音

但是那个，并非是外面的世界

而是总自己的里面传来的

![](https://cdn.luogu.com.cn/upload/pic/21096.png)

水上同学...我偶尔会思考这种事情...

世界的极限到底在哪里呢...

世界的...世界的尽头的更尽头...

要是能有那种地方...

要是假如我能够站在那个地方的话...我还是能跟平时一样看着那个尽头的风景吗？我有这种想法....

我理所当然的想着这种事...然后决定似乎是有些奇怪啊

因为那里是世界的尽头哦

是世界的极限哦

如果我能够看到那个的话...世界的极限...是否就等同于我的极限呢？

因为，从那里看到的世界...我所看见的...不就是我的世界吗？

世界的极限...就会变成我的极限吧~

世界就是我看到的摸到的，并且感受到的东西

那样的话，世界到底是什么呢

世界和我到底有什么不同呢...我有这种想法

有吗？

世界和我的差别

是一样的

但是，或许其他人也有相同的感觉...

就连你，或许也认为世界就是你自己吧

并且，我觉得那个大概是正确的...

虽然我不太清楚...大概是你也站在世界的尽头，跟我一样在看着它吧

所以，你也和世界一样

但是啊，那样果然很奇怪啊...

如果世界就是我的话...为什么我会看不到你看到的世界呢？

明明我的世界里有你存在...却看不到你看到的世界

我从来没有看到过你看到的世界

那个，简直就像是两者不会交集的平行宇宙一样...

即使有现象暗示着那个东西存在...却是绝对的无法触碰...

我...看不到你所在的世界...

但是...

那个也是真的是真的吗？

我真的没有看到过你的世界吗...

既然所有的人都平等的拥有她们自己的世界的话

那么为什么世界会变成一个呢？

为什么那么多的世界会存在于这里呢？

世界变成一个的理由

...我偶尔会思考这种事情

所以...我才能够喜欢上你


## 题目描述

您正在打 galgame，然后突然发现您今天太颓了，于是想写个数据结构题练练手：

一个长为 $n$ 的序列 $a$。

有 $m$ 个询问，每次询问三个区间，把三个区间中同时出现的数一个一个删掉，问最后三个区间剩下的数的个数和，询问独立。

注意这里删掉指的是一个一个删，不是把等于这个值的数直接删完，比如三个区间是  $[1,2,2,3,3,3,3]$，$[1,2,2,3,3,3,3]$ 与 $[1,1,2,3,3]$，就一起扔掉了 $1$ 个 $1$，$1$ 个 $2$，$2$ 个 $3$。
## 输入格式

第一行两个整数表示 $n,m$。

第二行 $n$ 个整数表示 $a_i$。

之后 $m$ 行，每行 $6$ 个整数 $l_1,r_1,l_2,r_2,l_3,r_3$ 表示这三个区间。
## 输出格式

对于每个询问，输出一个整数表示答案。
## 样例

### 样例输入 #1
```
5 2
1 2 2 3 3
1 2 2 3 3 4
1 5 1 5 1 5
```
### 样例输出 #1
```
3
0
```
## 提示

Idea：nzhtl1477，Solution：nzhtl1477，Code：nzhtl1477，Data：nzhtl1477

$1\leq n , m \leq 10^5$，$1 \leq a_i\leq 10^9$，$1\leq l_1,r_1,l_2,r_2,l_3,r_3\leq n$，$l_1\leq r_1$，$l_2\leq r_2$，$l_3\leq r_3$。


---

---
title: "[Ynoi Easy Round 2016] 这是我自己的发明"
layout: "post"
diff: 省选/NOI-
pid: P4689
tag: ['2016', '莫队', '离散化', 'O2优化', '构造', 'Ynoi']
---
# [Ynoi Easy Round 2016] 这是我自己的发明
## 题目背景

一切伟大的世界历史事件与人物，可以说都会出现两次

第一次是作为悲剧出现

第二次，则是作为笑剧出现

——《路易.波拿巴的雾月十八日》

感动、

痛苦、

以及快乐、

都只是遥不可及的宝石

即便如此，人们啊，

获得幸福吧！

![](https://cdn.luogu.com.cn/upload/pic/21098.png)

世界将在7月20日终结

世界回归天空的日子

万物被天空侵染的日子

回归天空的日子

世界必须回归

世界的极限

世界的尽头

世界的终结

![](https://cdn.luogu.com.cn/upload/pic/21099.png)

你看…那就是极限…最尽头的天空

如今，已无应该之事了如今，已无忘却之物了

不需要的话语

![](https://cdn.luogu.com.cn/upload/pic/21100.png)

告别了永不相交的平行，我被吸进了…

垂直下落的世界

![](https://cdn.luogu.com.cn/upload/pic/21101.png)

虽哭亦喜

虽悲亦喜

各种感情混在一起...

比起其他所有，想必还是高兴占多吧

她高兴地抱着我

紧紧地抱着

再也不会松开了...

想永远这样...

她的思绪，以比语言更快的速度，传达给了我

有些东西，比语言更快

她的思绪，以比语言更快的速度，传达给了我

有些东西，比语音更准确

世界上无论多么短暂的瞬间，都有意义

有意义

块临近终结了

最后的瞬间

啊啊...

远方的警笛声

黑色的天空

月正笑

地正润潮

星正舞

风正凉

在我怀中，温暖的，

橘希实香

![](https://cdn.luogu.com.cn/upload/pic/21103.png)

她在我的怀中...静静地合上了双眼

然后我也...

静静地合上了双眼
## 题目描述

您正在打 galgame，然后突然家长进来了，于是您假装在写数据结构题：

给一个树，$n$ 个点，有点权，初始根是 1。

$m$ 个操作，种类如下：

`1 x` 将树根换为 $x$。

`2 x y` 给出两个点 $x,y$，从 $x$ 的子树中选每一个点，$y$ 的子树中选每一个点，求点权相等的情况数。

## 输入格式

第一行两个数表示 $n,m$。

第二行 $n$ 个数，表示每个点的点权 $a_i$。

之后 $n-1$ 行 , 每行两个数 $x,y$ , 表示一条边。

之后 $m$ 行，每行表示一个操作。
## 输出格式

对于每个询问，输出一个数表示答案。
## 样例

### 样例输入 #1
```
5 5
1 2 3 4 5
1 2
1 3
3 4
3 5
2 4 5
2 1 5
2 3 5
1 5
2 4 5
```
### 样例输出 #1
```
0
1
1
1
```
## 提示

Idea：nzhtl1477，Solution：nzhtl1477，Code：nzhtl1477，Data：nzhtl1477

【数据范围】   
对于 $100\%$ 的数据，$1\le n \le 10^5$，$1 \le m \le 5\times 10^5$ , $1 \le a_i \le 10^9$。


---

---
title: "Gty的妹子序列"
layout: "post"
diff: 省选/NOI-
pid: P4867
tag: ['莫队', '分块']
---
# Gty的妹子序列
## 题目描述

Autumn 和 Bakser 又在研究 Gty 的妹子序列了！但他们遇到了一个难题。

对于一段妹子们，他们想让你帮忙求出这之内美丽度 $\in[a,b]$ 的妹子的美丽度的种类数。

为了方便，我们规定妹子们的美丽度全都在 $[1,n]$ 中。

给定一个长度为 $n(1\le n\leq 10^5)$ 的正整数序列 $s(1\le s_i\le n)$，对于 $m(1\le m\le 10^6)$ 次询问 $l,r,a,b$，每次输出 $s_l\cdots s_r$ 中，权值 $\in[a,b]$ 的权值的种类数。
## 输入格式

第一行包括两个整数 $n,m(1 \le n \le 100000,1 \le m \le 1000000)$，表示数列 $s$ 中的元素数和询问数。  

第二行包括 $n$ 个整数 $s_1\cdots s_n(1 \le s_i\le n)$。  

接下来 $m$ 行,每行包括 $4$ 个整数 $l,r,a,b(1 \le l \le r \le n,1 \le a \le b \le n)$，意义见题目描述。  

保证涉及的所有数在 C++ 的 int 内。保证输入合法。  
## 输出格式

对每个询问，单独输出一行，表示 $s_l \cdots s_r$ 中权值 $\in [a,b]$ 的权值的种类数。
## 样例

### 样例输入 #1
```
10 10
4 4 5 1 4 1 5 1 2 1
5 9 1 2
3 4 7 9
4 4 2 5
2 3 4 7
5 10 4 4
3 9 1 1
1 4 5 9
8 9 3 3
2 2 1 6
8 9 1 4
```
### 样例输出 #1
```
2
0
0
2
1
1
1
0
1
2
```
## 提示

【样例的部分解释】
 
`5 9 1 2 `
子序列为`4 1 5 1 2`  
在[1,2]里的权值有1,1,2，有2种，因此答案为2。  

`3 4 7 9`  
子序列为`5 1 ` 
在[7,9]里的权值有5，有1种，因此答案为1。  

`4 4 2 5`  
子序列为`1`  
没有权值在[2,5]中的，因此答案为0。  

`2 3 4 7`  
子序列为`4 5`  
权值在[4,7]中的有4,5，因此答案为2。  

建议使用输入/输出优化。  


---

---
title: "【模板】莫队二次离线（第十四分块(前体)）"
layout: "post"
diff: 省选/NOI-
pid: P4887
tag: ['递推', '莫队', 'O2优化', '前缀和', '洛谷月赛']
---
# 【模板】莫队二次离线（第十四分块(前体)）
## 题目描述

珂朵莉给了你一个序列 $a$，每次查询给一个区间 $[l,r]$，查询 $l \leq i< j \leq r$，且 $a_i \oplus a_j$ 的二进制表示下有 $k$ 个 $1$ 的二元组 $(i,j)$ 的个数。$\oplus$ 是指按位异或。
## 输入格式

第一行三个数表示 $n,m,k$。

第二行 $n$ 个数表示序列 $a$。

之后 $m$ 行，每行两个数 $l,r$ 表示一次查询。
## 输出格式

输出 $m$ 行，每行一个数表示查询的结果。
## 样例

### 样例输入 #1
```
5 5 2
3 4 8 0 2
4 5
3 5
1 4
2 5
1 5
```
### 样例输出 #1
```
0
1
2
3
4
```
## 提示

对于5%的数据，为样例。

对于30%的数据，$1 \leq n , m \leq 5000$。

对于50%的数据，空间限制为 512 MiB。

对于100%的数据，$1 \leq n, m \leq 100000$，$0 \leq a_i, k < 16384$。


---

---
title: "[Ynoi Easy Round 2015] 盼君勿忘"
layout: "post"
diff: 省选/NOI-
pid: P5072
tag: ['2015', '莫队', 'O2优化', '分块', 'Ynoi', '链表']
---
# [Ynoi Easy Round 2015] 盼君勿忘
## 题目背景

说起来，幸福本身就是因人而异的  
有些人认为只要能混口饭吃就行了  
有些人只要有书读就能满足  
![](https://cdn.luogu.com.cn/upload/pic/45571.png)  
有些人认为只有全力地生存才是最重要的  
有些人只要得到克服某种目标的瞬间就能满足  
有些人只要某个人得到幸福，自己就会跟着幸福  
也有些人则令人伤透脑筋地刚好相反  
![](https://cdn.luogu.com.cn/upload/pic/45572.png)
但是，大部分人都没有自觉  
他们不知道究竟什么能给自己带来幸福  
但是，他们会异口同声地表示想要获得幸福  
那样的人即使能察觉到幸福  
也没办法变得幸福  
最重要的是要敢于正视自己的内心  
![](https://cdn.luogu.com.cn/upload/pic/45573.png)  
【珂朵莉已经基本上不剩什么了】  
![](https://cdn.luogu.com.cn/upload/pic/45574.png)  
【心灵和身体，珂朵莉基本上快要全部失去了】  
![](https://cdn.luogu.com.cn/upload/pic/45575.png)  
【全部被我替换了】  
![](https://cdn.luogu.com.cn/upload/pic/45576.png)  
【幸好你在失去一切之前，回到了这里】  
【喜悦和悲伤】  
【还有喜欢某个人的情绪】  
【现在依旧还残存着一些吧？】  
嗯...  
确实还有那么一丝...  
【那就没问题了】  
【珂朵莉你，依旧是珂朵莉】  
![](https://cdn.luogu.com.cn/upload/pic/45578.png)  
![](https://cdn.luogu.com.cn/upload/pic/45579.png)  
威...廉...？   
![](https://cdn.luogu.com.cn/upload/pic/45580.png)  

## 题目描述

珂朵莉给了你一个序列，每次查询一个区间 $[l,r]$ 中所有子序列分别去重后的和 $\bmod\ p$。
## 输入格式

第一行两个整数 $n,m$。

第二行 $n$ 个整数表示这个序列。

之后 $m$ 行，每行三个整数 $l,r,p$ 表示查询的区间与模数。

## 输出格式

$m$ 行，每行输出一个整数表示答案。
## 样例

### 样例输入 #1
```
5 5
1 2 2 3 4
1 2 233333
2 3 333333
1 5 5
3 5 15
2 4 8
```
### 样例输出 #1
```
6
6
1
6
0
```
## 提示

Idea：nzhtl1477，Solution：nzhtl1477，Code：nzhtl1477，Data：nzhtl1477

对于 $100\%$ 的数据，$1\leq n,m,a_i \leq 10^5$，$1\leq p\leq 10^9$，$1\leq l\leq r\leq n$。


---

---
title: "[LnOI2019] 来者不拒，去者不追"
layout: "post"
diff: 省选/NOI-
pid: P5501
tag: ['莫队', 'O2优化']
---
# [LnOI2019] 来者不拒，去者不追
## 题目背景

题目提供者：朝田诗乃

![avartar](https://cdn.luogu.com.cn/upload/pic/66100.png)
## 题目描述

给定一个长度为$n$的序列$a$。给定$m$个询问，每次询问一个区间中$[l,r]$中所有数的“Abbi值”之和

Abbi值定义为：若$a_i$在询问区间$[l,r]$中是第$k$小，那么它的“Abbi值”等于$k \times a_i$。

为了消除歧义举个例子：

有序列1 2 2 3，那么1是第1小，2是第2小，3是第4小，序列Abbi值和为

$$1 \times 1+2 \times 2+2 \times 2+3 \times 4=21$$
## 输入格式

第一行两个整数，$n$和$m$，分别表示序列长度和询问组数。

第二行$n$个数，第$i$个数为$a_i$，表示序列的初始值。

接下来$m$行，每行两个数$l$和$r$，表示询问区间。
## 输出格式

对于每个询问，输出一行表示答案
## 样例

### 样例输入 #1
```
4 2
1 2 2 3
1 4
1 2
```
### 样例输出 #1
```
21
5
```
### 样例输入 #2
```
10 5
8 6 9 8 1 1 3 10 7 9
5 8
1 3
5 7
9 9
5 6

```
### 样例输出 #2
```
51
49
11
7
2

```
## 提示

前2个数据点，$1≤n,m≤1000$，时限1s。

接下来14个数据点，$1≤n,a_i,m≤100000$，$1≤l≤r≤n$，时限1s。

最后两个数据点，$1≤a_i≤100000$，$1≤l≤r≤n$，$1≤n,m≤500000$，时限3s。

建议使用读入优化。建议开启O2优化。

数据已经过加强。


---

---
title: "【模板】回滚莫队&不删除莫队"
layout: "post"
diff: 省选/NOI-
pid: P5906
tag: ['莫队', 'O2优化']
---
# 【模板】回滚莫队&不删除莫队
## 题目背景

这是一道模板题。
## 题目描述

给定一个序列，多次询问一段区间 $[l,r]$，求区间中**相同的数的最远间隔距离**。

序列中两个元素的**间隔距离**指的是**两个元素下标差的绝对值**。
## 输入格式

第一行一个整数 $n$，表示序列长度。

第二行 $n$ 个整数，描述这个序列。

第三行一个整数 $m$，表示询问个数。

之后 $m$ 行，每行两个整数 $l,r$ 表示询问区间。
## 输出格式

共 $m$ 行，每行一个整数表示答案。如果区间内不存在两个数相同，则输出 $0$。
## 样例

### 样例输入 #1
```
8
1 6 2 2 3 3 1 6
5
1 4
2 5
2 8
5 6
1 7
```
### 样例输出 #1
```
1
1
6
1
6

```
## 提示

记 $a_i$ 表示序列元素。

对于 $40\%$ 的数据，满足 $1\leq a_i \leq 400$，$1\leq n,m\leq 60000$。

对于 $100\%$ 的数据，满足 $1\leq n,m\leq 2\cdot 10^5$，$1\leq a_i\leq 2\cdot 10^9$。




---

---
title: "『MdOI R1』Path"
layout: "post"
diff: 省选/NOI-
pid: P6072
tag: ['莫队', 'O2优化', '分治', '字典树 Trie']
---
# 『MdOI R1』Path
## 题目描述

给定一棵 $n$ 个点的无根树，边有边权。

令 $V(x,y),E(x,y)$ 分别表示树上 $x,y$ 之间的简单路径上的所有点的集合和所有边的集合，特别地，当 $x=y$ 时，$V(x,y) = \{x\}$，$E(x,y) = \varnothing$。

再令边集 $E$ 的权值 $f(E)$ 为 $E$ 中所有边的权值的 **异或和**，当 $E = \varnothing$ 时，$f(E) = 0$。

现在，要你求出
$$
\max_{1\le x,y,u,v \le n,V(x,y)\cap V(u,v) = \varnothing}(f(E(x,y)) + f(E(u,v)))
$$
通俗的讲，你要选择两条简单路径，满足没有重合的点，且边权异或和之和最大。
## 输入格式

第一行一个整数 $n$，表示树上点的个数。

接下来 $n-1$ 行，每行三个整数 $x,y,w$，表示编号为 $x$ 和 $y$ 的点之间有一条权值为 $w$ 的边。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
9
1 2 1
1 3 7
2 4 8
3 5 3
4 6 3
3 7 3
7 8 5
7 9 2

```
### 样例输出 #1
```
21

```
### 样例输入 #2
```
3
1 2 2
2 3 1

```
### 样例输出 #2
```
2

```
## 提示

【样例 1 解释】

样例中的树如图所示，选择标红色和蓝色的两条路径，满足没有重合的点，且边权异或和之和最大，为 $(7\oplus 1\oplus 8)+(5\oplus 2)=21$（其中 $\oplus$ 表示异或运算）。

![](https://cdn.luogu.com.cn/upload/image_hosting/jen9sxcf.png)

【样例 2 解释】

样例中的树如图所示，为一条链的形状，选择标红色和蓝色的两条路径，蓝色路径退化成了一个点，使异或和之和达到最大值 $2+0=2$。注意红色路径并不能延申到 $3$，否则蓝色路径将无法存在。

![](https://cdn.luogu.com.cn/upload/image_hosting/1xzo1lh2.png)

---

【数据范围】

**本题采用捆绑测试。**

| 子任务编号 |    $n\leq$     |  特殊性质   | 分值 | 时限 |
| :--------: | :------------: | :---------: | :--: | :--: |
|     1      |      $50$      |     无      |  12  |  1s  |
|     2      | $2\times 10^3$ |     无      |  28  |  2s  |
|     3      | $2\times 10^4$ | $y = x + 1$ |  20  |  3s  |
|     4      | $3\times 10^4$ |     无      |  40  | 3.5s |

对于 $100\%$ 的数据，$2\leq n\leq 3\times 10^4$，$1\leq x,y\leq n$，$0\leq w\leq 10^9$。


---

---
title: "[PA 2011] Kangaroos"
layout: "post"
diff: 省选/NOI-
pid: P6349
tag: ['2011', '莫队', 'O2优化', 'K-D Tree', 'PA（波兰）']
---
# [PA 2011] Kangaroos
## 题目描述

给出长为 $n$ 的序列 $a$，第 $i$ 个元素是一个区间 $[l_i,r_i]$。

$m$ 次询问，给出 $A,B$，求出 $a$ 中最长的区间（即这个序列中的一段），使得这个区间内每个区间都与 $[A,B]$ 有交集。输出这个最长区间的长度。
## 输入格式

第一行两个整数 $n,m$。

接下来 $n$ 行，第 $i$ 行两个整数 $l_i,r_i$。

接下来 $m$ 行，每行两个整数 $A,B$，为一次询问。
## 输出格式

输出 $m$ 行，每行一个整数，为询问的答案。
## 样例

### 样例输入 #1
```
3 3
2 5
1 3
6 6
3 5
1 10
7 9
```
### 样例输出 #1
```
2
3
0
```
## 提示

$1\le n\le 5\times 10^4$，$1\le m\le 2\times 10^5$，$1\le l_i\le r_i\le 10^9$，$1\le A\le B\le 10^9$


---

---
title: "「Wdsr-2.7」八云蓝自动机 Ⅰ"
layout: "post"
diff: 省选/NOI-
pid: P7708
tag: ['莫队', 'O2优化', '分块']
---
# 「Wdsr-2.7」八云蓝自动机 Ⅰ
## 题目背景

**注意：本题题意和 八云蓝自动机Ⅱ 并不一致，请仔细阅读**。

作为八云紫的式神，八云蓝有着不同于其他一般式神的强大的计算能力。也就是说，八云蓝可以用自己的心算能力模拟出一台在现世中的确定性状态自动机。

而这，就是传说中的

$$\textbf{\textsf{「八云蓝自动机」}}$$

当然，尽管八云蓝的计算能力可以用于模拟一台计算机的操作，但是由于其中并没有设定任何的程序，于是可以实现的功能只能通过学习得到。而作为幻想乡的闲者，八云紫教会了蓝有关于数组的知识。一个数组由若干个存储单元组成，每个单元都可以存储一个整数。

而为了检测这种「八云蓝自动机」的可靠性，紫准备了一条非常简单的模拟题，用于测试蓝的心算能力。

然而，尽管蓝可以很快（ $<10^{-9961}s$ ）得出结果，但是八云紫实在是懒得去构造标准答案了。因此，你被钦定计算出这条题目的答案。
## 题目描述

八云蓝自动机维护了一个长度为 $n$ 的序列 $A$ ，每个元素都有一个初始值。同时自动机会支持以下三种操作：

- $\colorbox{f0f0f0}{\verb!1 x k!}$ ：将 $A_x$ 的值修改为 $k$。

- $\colorbox{f0f0f0}{\verb!2 x y!}$ ：交换 $A_x$ 与 $A_y$ 的值。

- $\colorbox{f0f0f0}{\verb!3 x!}$ ：查询 $A_x$ 的值。

为了测试八云蓝自动机的效率，紫需要进行非常非常多次的测试。为了生成每个测试的所有操作，紫构造出了一个长度为 $m$ 的**操作序列** $B$ ， $B$ 中的元素就是八云蓝自动机可以执行的一个操作。

紫会向蓝发起一共 $q$ 次测试。每次测试，紫会给出一个二元组 $(l,r)$ ，含义是让八云蓝自动机**依次**执行 $B_l,B_{l+1},\cdots B_r$ 这一共 $(r-l+1)$ 个操作。当然，紫不希望自动机的输出会太长，于是对于每次测试，你只要告诉她这些操作中所有操作 $3$ 的结果之和即可。注意：任意两次测试并**不会互相干扰**，每次操作结束后数列 $A$ 会回到初始状态。

此外，紫不希望用非常非常大的数字刁难你，于是答案对 $2^{32}$ 取模就行了（即 $\text{unsigned int}$ 自然溢出）。
## 输入格式

- 第一行两个整数 $n,m$ ，含义如题面所示。

- 第二行 $n$ 个整数，表示序列 $A$ 的初始值。

- 接下来 $m$ 行，描述操作序列 $B$ 。对于每个操作，首先是一个整数 $op$ 描述操作的种类。

  - 如果 $op = 1$，接下来两个整数 $x,k$ ，描述一个操作 $1$ 。

  - 如果 $op = 2$，接下来两个整数 $x,y$ ，描述一个操作 $2$ 。

  - 如果 $op = 3$，接下来一个整数 $x$ ，描述一个操作 $3$ 。

- 接下来一行，一个整数 $q$，表示八云紫发起的测试总数。

- 接下来 $q$ 行，每行有两个整数 $l,r$，描述一次测试，具体的执行方式如题面所示。
## 输出格式

- 共 $q$ 行，每行一个整数，表示此次测试的结果。
## 样例

### 样例输入 #1
```
10 10
2 3 4 8 7 4 8 4 1 2 
3 5
2 8 7
1 3 6
1 2 10
2 2 4
3 6
2 8 2
1 8 7
3 7
3 10
10
5 10
1 7
8 10
1 10
9 10
2 9
5 5
8 9
1 9
2 7

```
### 样例输出 #1
```
14
11
10
17
10
8
0
8
15
4

```
## 提示

#### 数据范围及约定

$$\def{\arraystretch}{1.5}\begin{array}{|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n,m,q} & \textbf{特殊性质} & \textbf{分值}\cr\hline
1 & 1\le n,m,q\le 10^3 & \text{无} & 10 \cr\hline
2 & \text{无特殊限制} & \text{无操作 1} & 20\cr\hline
3 & \text{无特殊限制} & \text{无操作 2} & 20\cr\hline
4 & \text{无特殊限制} & \text{操作 3 次数}\le 10 & 20 \cr\hline
5 & \text{无特殊限制}& \text{无}& 30 \cr\hline
\end{array}$$

- 对于 $100\%$ 的数据，满足：

  - $1 \le n,m,q \le 2 \times 10 ^ 5$ 。
  
  - $1 \le a_i,k \le 10^9;1 \le op \le 3;1 \le x,y \le n;x \neq y $ 。
  
  - $1 \le l \le r \le m$ 。


---

---
title: "[WC2022] 秃子酋长"
layout: "post"
diff: 省选/NOI-
pid: P8078
tag: ['莫队', '2022', 'WC']
---
# [WC2022] 秃子酋长
## 题目背景

5s 512M -O2
## 题目描述

传说在明斯克航空航天局中，有一名强大的秃子酋长。

秃子酋长法力无边，他的头上没有头发，而且头特别硬，跑得还不慢。

这一天，豌豆射手来到了明斯克航空航天局。

秃子酋长为了考验这一位新人，给他出了这样一道题：

给一个长为 $n$ 的排列 $a_1,\dots, a_n$，有 $m$ 次询问，每次询问区间 $[l, r]$ 内，排序后相邻的数在原序列中的位置的差的绝对值之和。
## 输入格式

第一行两个数表示 $n, m$；

之后一行 $n$ 个数依次表示序列 $a$ 中的元素；

之后 $m$ 行，每行两个数 $l, r$ 表示一次查询。
## 输出格式

对于每次询问，输出一行一个数表示答案。
## 样例

### 样例输入 #1
```
5 2
5 4 2 3 1
3 4
2 5
```
### 样例输出 #1
```
1
5
```
## 提示

**【样例解释】**

第一个询问，$2,3$ 排序后为 $2,3$，在原序列中的位置为 $3,4$，相邻元素在原序列中位置差的绝对值之和为 $|3 - 4| = 1$。

第二个询问，$4, 2, 3, 1$ 排序后为 $1, 2, 3, 4$，在原序列中的位置为 $5, 3, 4, 2$，相邻元素在原序列中位置差的绝对值之和为 $|5 - 3| + |3 - 4| + |4 - 2| = 5$。

**【数据范围】**

对 $10\%$ 的数据，$n, m \leq 10^3$；  
对另外 $10\%$ 的数据，$n, m \leq 5 \times 10^4$；  
对另外 $10\%$ 的数据，$n, m \leq 10^5$；  
对另外 $10\%$ 的数据，$n, m \leq 2 \times 10^5$；  
对另外 $20\%$ 的数据，$|a_i - i| \leq 10$；  
对另外 $20\%$ 的数据，$m=\dfrac{n(n-1)}{2}$；  
对其余数据，无特殊限制。

对于 $100\%$ 的数据，满足 $1 \leq n, m \leq 5\times 10^5$，$1 \leq a_i \leq n$，$a_i$ 互不相同，$1 \leq l \leq r \leq n$，所有数值为整数。



---

---
title: "「TERRA-OI R1」神，不惧死亡"
layout: "post"
diff: 省选/NOI-
pid: P8930
tag: ['莫队', 'O2优化', '分块']
---
# 「TERRA-OI R1」神，不惧死亡
## 题目背景

战斗已经到了白热化阶段，你已经精疲力竭，手臂因承受不住手中巨剑重量不住地发抖，噬神者的紫色外壳已经脱落大半，似乎再承受几次重击就会碎落一地。天空中紫色的迷雾开始变得暗淡，空间由于被不断撕裂而逐渐扭曲。在你的身前，噬神者最后一次撕开裂缝，用最原始的方式向你发起最后一击。你握紧手中的巨剑，准备迎接这最后一击，即使你清楚这是神明吞噬者最后的倔强，可你依然不敢放松一分一毫。最后一击过后，远处响起了钟声，战斗终将落下帷幕......
## 题目描述

李子要在一个长度为 $n$ 的序列 $a$ 上玩游戏，他每次会把下标在 $[l,r]$ 范围内，且取值在 $[p,q]$ 范围内的所有数全部找出来，每次他可以选择其中两个相同的值，并进行**抵消**操作，将这两个数从数列中删除。当且仅当一个原本存在的值被消除掉后，所有值小于这个数的每个值全部要被删除一次（例如数列中原本有三个 $2$，进行一次删除后将会仅剩两个 $2$），并且这个游戏将会立即停止。

李子会不止一次的玩这个游戏，并且每次取的区间都不相同，而且，为了加大游戏难度，李子会时不时的修改序列中某个数的值。

现在李子想让剩下的数列中的最小值尽可能大，需要请你针对每次游戏，输出这个最大的最小值。特别地，如果这个游戏无法停止或者存在一种方案可以消除整个数列，输出 $-1$。
## 输入格式

第一行两个用空格分隔的正整数 $n,m$，含义见题目描述。

第二行 $n$ 个用空格分隔的正整数，表示对应 $a$ 序列。

第三行到第 $m+2$ 行，每行有以下两种情况：

- $1$ $p$ $x$ 表示给 $a_p$ 的值加上 $x$。
- $2$ $l$ $r$ $p$ $q$ 表示询问将下标属于 $[l,r]$，取值属于 $[p,q]$ 的数列取出进行游戏的结果。
## 输出格式

针对每个询问 $2$，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
6 5
1 1 4 5 1 4
2 1 6 1 5
2 1 4 1 4
1 1 1
2 1 4 1 4
2 2 6 1 5
```
### 样例输出 #1
```
5
4
-1
4
```
### 样例输入 #2
```
12 12
10 2 8 12 12 3 3 12 1 10 7 2
2 3 4 1 11
2 3 4 5 12
2 1 3 1 3
2 2 10 2 10
2 8 10 5 10
2 5 5 8 11
2 10 12 7 10
2 1 5 4 9
1 12 6
1 1 -6
2 5 8 5 12
2 5 8 2 12
```
### 样例输出 #2
```
-1
-1
-1
8
-1
-1
-1
-1
-1
12
```
## 提示

#### 【样例解释 #1】

第一个询问对应的数列为 $[1,1,4,5,1,4]$，我们将两个 $1$ 先抵消，再抵消两个 $4$，此时比 $4$ 小的 $1$ 将会删除一次，整个序列只剩一个 $5$。

第二个询问针对前 $4$ 个数，且由于 $5$ 不属于 $[1,4]$ 值域范围，所以数列为 $[1,1,4]$，将两个 $1$ 抵消后游戏直接结束，答案为 $4$。

第三次修改将 $a_1$ 加 $1$，修改后数列为 $[2,1,4,5,1,4]$。

第四次询问对应的数列为 $[2,1,4]$，所有数据都只出现一次，没办法进行抵消操作，游戏无法停止所以输出 $-1$。

第五次询问的数列为 $[1,4,5,1,4]$，我们选择将两个 $1$ 抵消，由于数列中不再有 $1$，游戏结束，最小为 $4$。你也可以抵消两个 $4$，但这样答案为 $1$，比 $4$ 要小。


------------

#### 【数据范围】

**本题采用捆绑测试。**

| Subtask | Score | $n,m\le$ | limit |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10$ | $10^3$ | 无 |
| $2$ | $20$ | $10^5$ | 保证不存在操作 $1$ |
| $3$ | $30$ | $10^5$ | 保证对于每个操作 $2$ ，$p=1,q=n$ |
| $4$ | $40$ | $10^5$ | 无 |

对于 $100\%$ 的数据，$1\le n,m\le10^5$，对于任何时刻 $\forall i,a_i\in[1,n]$。

对于每个操作 $1$，$1\le p\le n$，$-n+1\le x\le n-1$ 并且 $-a_p<x\le n-a_p$。

对于每个询问 $2$，$1\le l \le r \le n$，$1\le p \le q \le n$。



---

---
title: "「DROI」Round 2  进制与操作"
layout: "post"
diff: 省选/NOI-
pid: P9376
tag: ['莫队', '树状数组', 'O2优化', '可持久化线段树', '随机化']
---
# 「DROI」Round 2  进制与操作
## 题目背景

与其编写苍白无力的背景，不如出更有质量的题。
## 题目描述

定义数 $x$ 在 $B$ 进制下的一次操作为以下两种操作中的任意一种：

- 令 $x \rightarrow \lfloor \dfrac{x}{B} \rfloor$。

- 令 $x \rightarrow x \times B + t $。其中 $t \in [0,B-1]$。

现给定长度为 $n$ 的序列 $A$。$m$ 次询问，每次询问形如：

- `l r B` 表示询问将序列 $A$ 中下标在 $[l,r]$ 之内的数在 $B$ 进制下操作，至少多少次才能将所有数变为相同（注：每次操作是对**一个数**进行操作）。

**询问间相互独立，即操作不会真的进行。**


## 输入格式

第一个两个整数，分别表示 $n,m$。

第二行一行 $n$ 个数，表示序列 $A$。

接下来 $m$ 行，每行三个数，分别表示这次询问的 $l,r,B$。
## 输出格式

输出共 $m$ 行，其中第 $i$ 行表示第 $i$ 次询问的答案。
## 样例

### 样例输入 #1
```
5 5
7 6 5 8 9
1 3 2
2 5 2
4 4 6
3 5 4
1 5 3
```
### 样例输出 #1
```
5
8
0
5 
10
```
### 样例输入 #2
```
8 4
10 14 7 11 19 13 7 18 
1 7 4
3 8 2
1 4 4
1 4 2

```
### 样例输出 #2
```
15
18
8
11

```
## 提示

### 样例解释

对于样例一，五次询问分别将区间内所有数变为 $3$、$4$、$8$、$4$、$6$ 是一种最优操作。

------------

### 数据范围 

**「本题采用捆绑测试」**

- $\operatorname{Subtask} 1(10\%)$：$n,m \leq 1000$。

- $\operatorname{Subtask} 2(20\%)$：保证所有询问 $B=2$。

- $\operatorname{Subtask} 3(40\%)$：$n,m \leq 3 \times 10^4$。

- $\operatorname{Subtask} 4(30\%)$：无特殊限制。

对于 $100\%$ 的数据：$1 \leq n,m \leq 10^5$，$2 \leq A_i,B \leq 10^8$。



---


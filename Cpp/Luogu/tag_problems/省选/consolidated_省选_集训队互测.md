---
title: "[集训队互测 2023] Tree Topological Order Counting"
layout: "post"
diff: 省选/NOI-
pid: P10013
tag: ['集训队互测', '2023']
---
# [集训队互测 2023] Tree Topological Order Counting
## 题目描述

给定一颗 $n$ 个点的有根树，$1$ 是根，记 $u$ 的父亲是 $fa_u$。另给出一长度为 $n$ 的权值序列 $b$。

称一个长度为 $n$ 的排列 $a$ 为这颗树的合法拓扑序，当且仅当 $\forall 2 \le u \le n,a_u > a_{fa_u}$。

对每个点 $u$，定义 $f(u)$ 为，在所有这颗树的合法拓扑序中，$b_{a_u}$ 之和。

现在对 $1 \le u \le n$，求 $f(u) \bmod 10^9+7$。
## 输入格式

第一行一个整数 $n$ 表示树的点数。

第二行 $n-1$ 个整数，第 $i$ 个表示 $fa_{i+1}$，描述树的结构。

第三行 $n$ 个整数，第 $i$ 个表示 $b_i$，描述权值序列。
## 输出格式

一行 $n$ 个整数，第 $i$ 个表示 $f(i) \bmod 10^9+7$。
## 样例

### 样例输入 #1
```
5
1 1 3 2
3 5 4 4 1

```
### 样例输出 #1
```
18 27 27 15 15 

```
### 样例输入 #2
```
5
1 1 3 1
1 2 3 4 5

```
### 样例输出 #2
```
12 42 32 52 42

```
## 提示

| Subtask | $n \le$ | 特殊限制 | 分值 |
| :-----: | :-----: | :------: | :--: |
|   $1$   |  $10$   |    无    | $5$  |
|   $2$   |  $20$   |    无    | $10$ |
|   $3$   |  $100$  |    无    | $15$ |
|   $4$   |  $350$  |    无    | $15$ |
|   $5$   | $3000$  |    A     | $15$ |
|   $6$   | $3000$  |    无    | $20$ |
|   $7$   | $5000$  |    无    | $20$ |

特殊限制 A：$\forall 1 \le i \le n,b_i=i$。

对于所有数据：$2 \le n \le 5000$，$1 \le fa_i < i$，$0 \le b_i < 10^9+7$。


---

---
title: "[集训队互测 2015] Robot"
layout: "post"
diff: 省选/NOI-
pid: P11728
tag: ['2015', '集训队互测', '李超线段树']
---
# [集训队互测 2015] Robot
## 题目描述

小 q 有 $n$ 只机器人，一开始他把机器人放在了一条数轴上，第 $i$ 只机器人在 $a_i$ 的位置上静止，而自己站在原点。

在这之后小 q 会执行一些操作，他想要命令一个机器人向左或者向右移动 $x$ 格。但是机器人似乎听不清小 q 的命令，事实上它们会以每秒 $x$ 格的速度匀速移动。

看着自己的机器人越走越远，小 q 很着急，他想知道当前离他（原点）最远的机器人有多远。

具体的操作以及询问见输入格式。注意，不同的机器人之间互不影响，即不用考虑两个机器人撞在了一起的情况。
## 输入格式

共有 $m$ 个事件，输入将会按事件的时间顺序给出。

第一行两个正整数 $n,m$。

接下来一行 $n$ 个整数，第 $i$ 个数是 $a_i$，表示第 $i$ 个机器人初始的位置（初始移动速度为 $0$）。

接下来 $m$ 行，每行行首是一个非负整数 $t_i$，表示该事件点发生的时刻（以秒为单位）。第二个是一个字符串 $S$ ，代表操作的种类。数字与字符串之间用一个空格隔开。接下来的输入按 $S$ 的种类分类。

1. 若 $S$ 是 `command`，则接下来两个整数 $k_i,x_i$，表示小 q 对第 $k_i$ 个机器人执行了操作，该机器人的速度将会被重置，变为向数轴正方向每秒移动 $x_i$ 格（若 $x_i$ 为负数就相当于向数轴负方向每秒移动 $\lvert x_i \rvert$ 格）。保证 $1 \leq k_i \leq n$。
2. 若 $S$ 是 `query`，则你需要输出当前离原点最远的机器人有多远。

保证 $t_1 \leq t_2 \leq t_2 \leq \dots \leq t_m$。

（注：若同一时间发生多次操作，则按读入顺序依次执行）
## 输出格式

对于每个 `query` 询问，输出一行，包含一个整数表示正确的答案。

**由于本题数据量较大，建议使用高效的的输入输出方式。**
## 样例

### 样例输入 #1
```
4 5
-20 0 20 100
10 command 1 10
20 command 3 -10
30 query
40 command 1 -30
50 query
```
### 样例输出 #1
```
180
280
```
## 提示

### 样例解释

- 第一个命令执行时，各个机器人的位置为：$-20, 0, 20, 100$。
- 第二个命令执行时，各个机器人的位置为：$80, 0, 20, 100$。
- 第一个询问时，各个机器人的位置为：$180, 0, -80, 100$。
- 第三个命令执行时，各个机器人的位置为：$280, 0, -180, 100$。
- 第二个询问时，各个机器人的位置为：$-20, 0, -280, 100$。

### 数据范围

设 `command` 的个数为 $C$，`query` 的个数为 $Q$。（所以 $C + Q = m$）

对于所有的事件满足 $0 \leq t_i \leq 10^9$，对于所有的 `command` 满足 $\lvert x_i \rvert \leq 10^4$。

对于所有的机器人满足 $\lvert a_i \rvert \leq 10^9$。

所有测试数据的范围和特点如下表所示：

| 测试点编号 | 数据范围 | 特殊限制 |
| :----------: | :----------: | :----------: |
| $1$ | $n,m\leq 2000$ | 无 |
| $2$ | $n,m\leq 2000$ | 无 |
| $3$ | $n,m\leq 10^5$ | $-1 \leq x_i \leq 1$ |
| $4$ | $n,C\leq 10^5$，$Q\leq 5\times 10^5$ | 两个机器人发生碰面或者超越另一个的次数 $\leq 4\times 10^5$ |
| $5$ | $n,C\leq 10^5$，$Q\leq 5\times 10^5$ | 两个机器人发生碰面或者超越另一个的次数 $\leq 4\times 10^5$ |
| $6$ | $n,m\leq 10^5$ | 不会在 $t_i>0$ 时出现 `command` 操作 |
| $7$ | $n,m\leq 10^5$ | 不会在 $t_i>0$ 时出现 `command` 操作 |
| $8$ | $n,m\leq 10^5$ | 无 |
| $9$ | $n,C\leq 10^5$，$Q\leq 5\times 10^5$ | 无 |
| $10$ | $n,C\leq 10^5$，$Q\leq 5\times 10^5$ | 无 |



---

---
title: "[集训队互测 2015] 最大异或和"
layout: "post"
diff: 省选/NOI-
pid: P11731
tag: ['2015', '集训队互测', '线性基']
---
# [集训队互测 2015] 最大异或和
## 题目描述

我有一个数列 $a_1, a_2, \dots, a_n$，每个 $a_i$ 都是小于 $2^m$ 的非负整数。

现在请您实现三种操作，格式说明如下：

* $1$ $x$ $y$ $w$：对于所有 $x \leq i \leq y$，将 $a_i$ 修改为 $a_i \operatorname{xor} w$。其中 $w$ 是一个小于 $2^m$ 的非负整数。
* $2$ $x$ $y$ $w$：对于所有 $x \leq i \leq y$，将 $a_i$ 修改为 $w$。其中 $w$ 是一个小于 $2^m$ 的非负整数。
* $3$：从 $a_1, a_2, \dots, a_n$ 中选出若干个数，使得选出的数异或和最大。请输出这个最大值。

这里 $\operatorname{xor}$ 表示按位异或运算，$x_1, x_2, \dots, x_l$ 的异或和是指 $x_1 \operatorname{xor} x_2 \operatorname{xor} \dots \operatorname{xor} x_l$。
## 输入格式

第一行三个正整数 $n,m,q$。

接下来 $n$ 行为初始时 $a_1, a_2, \dots, a_n$ 的值。

接下来 $q$ 行，每行表示一个操作。操作的格式如前所述。保证 $1 \leq x \leq y \leq n$。

$a_1, \dots, a_n$ 和 $w$ 均用恰好 $m$ 位的 01 串表示这个数的二进制表示。左边是最高位，右边是最低位，不足 $m$ 位的在左边补 $0$。
## 输出格式

对于每个 $3$ 号操作，输出一个 $m$ 位 01 串表示答案的二进制表示。
## 样例

### 样例输入 #1
```
3 4 7
0000
0011
0110
3
1 2 3 0010
3
2 1 2 0010
3
2 1 3 0000
3
```
### 样例输出 #1
```
0110
0101
0110
0000
```
## 提示

| 测试点编号 | $n$    | $m$    | $q$    | 特殊限制               |
|:------------:|:--------:|:--------:|:--------:|:------------------------:|
| $1$          | $= 10$   | $= 10$   | $= 1000$  | 无                    |
| $2$          | $= 500$  | $= 500$  | $= 10$    | 无                    |
| $3$          | $= 120$  | $= 120$  | $= 120$   | 无                    |
| $4$          | $= 2000$ | $= 2000$ | $= 10$    | 无                    |
| $5$          | $= 1800$ | $= 1800$ | $= 1800$  | $1, 2$ 操作中 $x = y$ |
| $6$          | $= 1800$ | $= 1800$ | $= 1800$  | 只有 $1, 3$ 操作      |
| $7$          | $= 1800$ | $= 1800$ | $= 1800$  | 只有 $2, 3$ 操作      |
| $8$          | $= 1500$ | $= 1500$ | $= 1500$  | 无                    |
| $9$          | $= 1800$ | $= 1800$ | $= 1800$  | 无                    |
| $10$         | $= 2000$ | $= 2000$ | $= 2000$  | 无                    |



---

---
title: "[集训队互测 2015] 上帝之手"
layout: "post"
diff: 省选/NOI-
pid: P11733
tag: ['2015', '线段树', '二分', '集训队互测']
---
# [集训队互测 2015] 上帝之手
## 题目描述

上帝之手操纵着四维空间。假设四维空间中上帝关心的部分共 $n$ 天，定义第 $i$ 天结束时一个三维世界的混乱度为 $x_i$。由于一些自然的原因，第 $i$ 天该世界的混乱度会增加 $d_i$，但为了世界的平衡，每天该世界都有一个混乱度的上限值 $l_i$，即实际上 $x_i = \min\{x_{i-1}+d_i , l_i\}$。

上帝想对该四维空间作一系列测试，于是希望你帮忙建立一个模型。具体有以下三种测试：

1. 给定 $a, b$ 和 $k$，对于所有的 $c$ 满足 $a \leq c \leq b$，让世界以 $l_{c-1}$ 的初始混乱度从第 $c$ 天开始发展，把第 $b$ 天的混乱度 $x_b$ 写在一张纸上。你只需告诉上帝纸上第 $k$ 大的 $x_b$ 即可。保证 $1 \leq a \leq b \leq n$，且 $1 \leq k \leq b - a + 1$。
2. 给定 $a, b$ 和 $x_0$，对于所有的 $c$ 满足 $a \leq c \leq b$，让世界以 $x_0$ 的初始混乱度从第 $c$ 天开始发展，把第 $b$ 天的混乱度 $x_b$ 写在一张纸上。你只需告诉上帝纸上最大的 $x_b$ 即可。（注意：$x_0$ 可能大于 $l_{c-1}$）。保证 $1 \leq a \leq b \leq n$。
3. 给定 $a$ 和 $b$，对于所有的 $c$ 满足 $a \leq c \leq b$，让世界以 $l_{c-1}$ 的初始混乱度从第 $c$ 天开始发展，把第 $b$ 天的混乱度 $x_b$ 写在一张纸上。你只需告诉上帝纸上有多少种不同的 $x_b$ 即可。保证 $1 \leq a \leq b \leq n$。

当然，上帝还会修改某些位置的 $l_i$。你能成功帮助上帝完成测试吗？
## 输入格式

第一行包含两个正整数 $n$ 和 $m$，分别表示总天数和总操作（包含测试和修改）次数。

第二行为 $n$ 个非负整数 $d_1, \dots, d_n$。

第三行为 $n+1$ 个非负整数 $l_0, \dots, l_n$。含义见问题描述。

第四行起的 $m$ 行，每行第一个整数 $\mathrm{type}$ 表示操作种类。

若 $\mathrm{type}=0$，则后面跟有两个整数 $u$ 和 $x$，表示将 $l_u$ 改为 $x$。保证 $0 \leq u \leq n$。

若 $\mathrm{type}>0$，则 $\mathrm{type}$ 等于题目描述中对应的测试种类编号。$\mathrm{type} = 1$ 时后面跟有三个整数 $a, b$ 和 $k$；$\mathrm{type} = 2$ 时后面跟有三个整数 $a, b$ 和 $x_0$；$\mathrm{type} = 3$ 时后面跟有两个整数 $a$ 和 $b$。具体含义见问题描述。
## 输出格式

对于每个测试输出一行，包含一个整数表示测试结果。
## 样例

### 样例输入 #1
```
3 5
2 1 3
2 6 7 5
1 1 2 2
3 1 3
0 3 15
3 1 3
2 1 3 2
```
### 样例输出 #1
```
5
1
2
8
```
## 提示

- 对于前 $10\%$ 的数据，$n, m \leq 100$；
- 对于前 $20\%$ 的数据，$n, m \leq 5000$；
- 对于另 $10\%$ 的数据，$\mathrm{type} \leq 1$；
- 对于另 $20\%$ 的数据，$\mathrm{type} \leq 2$；
- 对于另 $15\%$ 的数据，$\mathrm{type} = 0$ 或 $3$；
- 对于 $100\%$ 的数据，$n \leq 10^5$，$m \leq 2 \times 10^5$，$0 \leq d_i \leq 10^4$，$0 \leq l_i \leq 10^9$。第二类测试操作中 $0 \leq x_0 \leq 10^9$，修改操作中 $0 \leq x \leq 10^9$。


---

---
title: "[集训队互测 2015] 胡策的统计"
layout: "post"
diff: 省选/NOI-
pid: P11734
tag: ['2015', '集训队互测', '快速沃尔什变换 FWT', '集合幂级数，子集卷积']
---
# [集训队互测 2015] 胡策的统计
## 题目描述

在 OI 界，有一位无人不知无人不晓，OI 水平前无古人后无来者的胡策，江湖人称一眼秒题胡大爷！

今天胡策在研究无向图的连通性。对于一个无向图定义它的连通值为该图连通块数的阶乘。

为了研究连通值的性质，胡策随手画了一个 $n$ 个结点的简单无向图 $G$，结点分别编号为 $1, \dots, n$，他想统计出 $G$ 的所有生成子图的连通值之和。

胡策当然会做啦！但是他想考考你。你只用输出结果对 $998244353$ （$7 \times 17 \times 2^{23} + 1$，一个质数） 取模后的结果。

简单无向图即无重边无自环的无向图。生成子图即原图中删去若干条边（可以是 $0$ 条）后形成的图。
## 输入格式

第一行两个整数 $n, m$，表示 $G$ 的结点数和边数。保证 $n \geq 1，m \geq 0$。

接下来 $m$ 行，每行两个整数 $v, u$，表示 $v$ 号结点和 $u$ 号结点之间有一条无向边。保证 $1 \leq v, u \leq n$，保证没有重边和自环。
## 输出格式

一行，一个整数表示答案。
## 样例

### 样例输入 #1
```
6 13
1 2
1 3
2 3
1 4
4 2
3 4
5 2
3 5
5 4
6 2
6 3
6 4
6 5
```
### 样例输出 #1
```
16974
```
## 提示

| 测试点编号 | $n \leq$ | 特殊限制 |
| :----------: | :----------: | :----------: |
| $1$ | $6$ | 无 |
| $2$ | $10$ | 无 |
| $3$ | $10$ | 无 |
| $4$ | $17$ | 无 |
| $5$ | $17$ | 无 |
| $6$ | $17$ | 无 |
| $7$ | $20$ | $G$ 为完全图 |
| $8$ | $20$ | 无 |
| $9$ | $20$ | 无 |
| $10$ | $20$ | 无 |



---

---
title: "[集训队互测 2015] 胡策的数列"
layout: "post"
diff: 省选/NOI-
pid: P11735
tag: ['2015', '平衡树', '集训队互测']
---
# [集训队互测 2015] 胡策的数列
## 题目描述

在 OI 界，有一个无人不知无人不晓，OI 水平前无古人后无来者的胡策，江湖人称一眼秒题胡大爷！

今天胡策正在研究一个远古传下来的数列：$a_0, a_1, a_2, \dots$，数列的第 $k$ 项为 $a_k$。这个数列有特别的性质，对于 $i > 1$ 有：$25 a_i + 20 a_{i - 1} = 12 a_{i - 2}$。因为流传的时间太过久远，$a_0$ 和 $a_1$ 的值都已经看不清了，但是在最后还记载着，这个数列有一个特别的性质：对于任意的 $i \geq 0$，都有  $a_i \geq 0$。

然而胡策已经看穿了一切：对于任意一个正数 $t$，满足 $a_0 = t$ 的数列 $a$ 是唯一的！但是，他想拿这个问题考一考拜胡策为师的你。

具体来说，胡策会给你一个长度为 $n$ 的表格，一开始每个格子都写着 $0$。有时他会让你将 $a_0 = t$ 时的数列 $a$ 从第 $p$ 项到第 $p + r - l$ 项的值分别写入表格中第 $l$ 到第 $r$ 格（覆盖原有的值），有时他会询问表格中某一段连续的格子中的数的和。

当然，作为胡策的弟子，你必须在胡策提出一个询问的时候马上作出回应。

因为这是一个远古的问题，胡策只给了你一台远古的计算机，它只有 64MB 的内存。
## 输入格式

第一行两个正整数 $n,m$。分别表示表格的长度和操作个数。

接下来 $m$ 行，每行描述一个操作。每行的第一个整数 $\mathrm{type}$ 描述了操作的类型，$\mathrm{type} = 1$ 表示是修改操作，$\mathrm{type} = 2$ 表示是询问操作。

如果是修改操作，接下来有四个整数 $l,r,t,p$，意义如上所述。

如果是询问操作，接下来有两个整数 $l,r$，意义如上所述。

由于胡策需要确定你是在线回答他的问题，输入中的 $l, r$ 是加密了的。于是你需要把输入中的 $l, r$ 分别异或 $\mathrm{lastans}$ 来得到实际的 $l, r$。$\mathrm{lastans}$ 表示上一次询问操作的答案，初始为 $0$。保证实际的 $l, r$ 满足 $1 \leq l \leq r \leq n$。
## 输出格式

对每个询问操作输出一行，表示询问的答案。

答案一定能写成 $\frac{v}{u}$ 的形式，其中 $v, u$ 是互质的整数，且 $u > 0$。为了避免分数，你只用输出一个介于 $0$ 到 $10^9 + 8$ 之间的整数 $x$ 满足 $ux \equiv v \pmod{10^9 + 9}$ 来表示答案。显然在本题中，这样的 $x$ 是唯一的。
## 样例

### 样例输入 #1
```
3 3
1 1 3 2 3
1 2 2 4 5
2 1 3
```
### 样例输出 #1
```
867840008
```
### 样例输入 #2
```
1000000000 3
1 1 12450 6666666 23333333
1 6666 99999 2333 44444
2 1 1000000000
```
### 样例输出 #2
```
431287288
```
## 提示

### 数据范围

- 对于 20% 的数据，$n,m \leq 1000$。
- 对于 50% 的数据，$n,m \leq 30000$。
- 对于 100% 的数据，$1 \leq n \leq 10^9$，$1 \leq m \leq 10^5$，$1 \leq t \leq 10^9$，$1 \leq p \leq 10^9$。


---

---
title: "[集训队互测 2024] 长野原龙势流星群"
layout: "post"
diff: 省选/NOI-
pid: P12479
tag: ['二分', '平衡树', '集训队互测', '2024', 'Special Judge', '树形 DP', '凸包']
---
# [集训队互测 2024] 长野原龙势流星群
## 题目描述

Naganohara Yoimiya 给了你一棵 $n$ 个节点的有根树，$1$ 号节点是根节点，每个点有点权 $w_i$。

你需要对每个点 $u$ 找到一个以 $u$ 为根的非空连通块，并最大化这个连通块内所有点的点权的平均值。

对每个点 $u$ 输出这个最大的平均值。
## 输入格式

第一行一个正整数 $n$。

接下来一行 $n-1$ 个正整数 $p_2,p_3,\cdots,p_n$，$p_i$ 表示 $i$ 的父节点的编号，保证 $p_i< i$。

接下来一行 $n$ 个正整数 $w_1,w_2,\cdots,w_n$。
## 输出格式

输出 $n$ 行，第 $i$ 行输出一个实数表示以节点 $i$ 为根的连通块内点权平均值的最大值。

如果你的答案和标准答案的相对误差或绝对误差不超过 $10^{-6}$ 则视为正确。
## 样例

### 样例输入 #1
```
6
1 2 2 1 4
3 1 5 6 6 7
```
### 样例输出 #1
```
4.6666666667
4.7500000000
5.0000000000
6.5000000000
6.0000000000
7.0000000000
```
## 提示

### 测试点约束

对于所有数据，$1\le n\le 2\times 10^5,1\le w_i\le 10^9$。

- Subtask 1（$10$ 分）：$1\le n\le 2000$。
- Subtask 2（$10$ 分）：$p_i=\lfloor i/2\rfloor$。
- Subtask 3（$40$ 分）：$1\le n\le 50000$。
- Subtask 4（$40$ 分）：无特殊限制。


---

---
title: "[集训队互测 2024] 线段树与区间加"
layout: "post"
diff: 省选/NOI-
pid: P12489
tag: ['线段树', '集训队互测', '2024', '全局平衡二叉树']
---
# [集训队互测 2024] 线段树与区间加
## 题目描述

普罗在图书馆找到了一本关于算法的书。书中介绍了一种名为“线段树”的数据结构。

>
>线段树是一种有根的二叉树，其每个节点对应了序列上的一个区间 $[l,r]$，其中根节点对应 $[1,n]$。
>
>对于每个节点，若其代表的序列区间 $[l,r]$ 满足 $l=r$，则其为叶节点；否则存在整数 $k(l\le k<r)$，满足其左儿子代表区间 $[l,k]$，右儿子代表区间 $[k+1, r]$。为了保证其时间复杂度，$k$ 一般会取 $\left\lfloor\frac{l+r}{2}\right\rfloor$。
>
>线段树可以实现单点修改，区间修改，区间查询等操作。其中区间修改操作的实现通常需要维护名为懒惰标记的额外信息。
>

在简单了解了线段树如何维护区间加之后，普罗想要实现一个维护区间加的线段树。于是他写下了如下的代码：

```cpp
#define len(i) (r[i]-l[i]+1)
void push_down(int i)
{
    a[lc[i]]+=len(lc[i])*lz[i];
    lz[lc[i]]+=lz[i];
    a[rc[i]]+=len(rc[i])*lz[i];
    lz[rc[i]]+=lz[i];
    lz[i]=0;
    return;
}
void add(int i,int ql,int qr,unsigned k)
{
    if(qr<l[i]||r[i]<ql) return;
    if(ql<=l[i]&&r[i]<=qr){
        a[i]+=len(i)*k;
        lz[i]+=k;
        return;
    }
    push_down(i);
    add(lc[i],ql,qr,k);
    add(rc[i],ql,qr,k);
    a[i]=a[lc[i]]+a[rc[i]];
    return;
}
```

为了检验这份代码的正确性，普罗构建了一个维护的序列长为 $n$ 的线段树，并在每个节点上设置两个额外的权值 $va_i,vb_i$，接下来他在线段树上进行了 $m$ 次区间加的操作，在每次区间加操作后输出了下面函数的返回值。

```cpp
unsigned foobar(){
	unsigned tot=0;
	for(int i=1;i<2*n;i++)tot+=va[i]*a[i]+vb[i]*lz[i];
	return tot;
}
```

因为 K 博士的电脑实在太快了，普罗的代码只花了 1ms 就得出了结果。但是他还是不知道代码是不是正确的，所以请你计算出上面的函数的结果和普罗得出的结果比较吧。
## 输入格式

第一行两个整数 $n,m$，表示线段树维护的序列长度和操作次数。

接下来 $2n-1$ 行，第 $i$ 行首先是四个整数 $l_i,r_i,va_i,vb_i$，表示线段树上第 $i$ 个节点对应的区间的左端点和右端点，以及节点上的两个额外权值。如果这个节点不是根节点，那么接下来还有两个整数 $lc_i,rc_i$，表示这个节点的左儿子编号和右儿子编号。

接下来 $m$ 行，每行三个整数 $ql_i,qr_i,k_i$，表示一次区间加操作的左端点，右端点和增加的值。
## 输出格式

在每次区间加操作后输出一行一个正整数表示 `foobar` 函数的返回值。
## 样例

### 样例输入 #1
```
4 4
1 4 0 1 2 3
1 2 3 5 4 5
3 4 2 2 6 7
1 1 1 4
2 2 3 2
3 3 2 0
4 4 5 3
1 3 3
2 4 1
1 4 2
2 3 1
```
### 样例输出 #1
```
45
74
76
154

```
### 样例输入 #2
```
4 4
1 4 2 4 2 3
1 3 1 3 4 5
4 4 5 4
1 1 3 3
2 3 2 1 6 7
2 2 0 3
3 3 2 5
1 3 3
2 4 1
1 4 2
2 3 1
```
### 样例输出 #2
```
36
82
106
155

```
## 提示

【数据规模与约定】

| 测试点编号 | $n,q$ | 其他约定 |
| :-----------: | :-----------: | :-----------: |
| $1\sim5$ | $\le2000$ | 无 |
| $6\sim10$ | $\le40000$ | 无 |
| $11\sim15$ | $\le2\times10^5$ | 保证存在一个线段树上的节点对应的区间为 $[ql,qr]$ |
| $16\sim20$ | $\le2\times10^5$ | 保证不同的 $ql,qr$ 不超过 $200$ 种 |
| $21\sim25$ | $\le2\times10^5$ | 无 |

如果测试点编号 $\bmod 5$ 为 $2$ 或 $3$，该测试点保证 $va_i=0$。

如果测试点编号 $\bmod 5$ 为 $4$ 或 $5$，该测试点保证 $vb_i=0$。

对于 $100\%$ 的数据，保证 $1\le n,q\le2\times10^5$，给出的线段树和区间加操作是合法的，$0\le va_i,vb_i,k_i<2^{32}$。


---

---
title: "[集训队互测 2024] 串联"
layout: "post"
diff: 省选/NOI-
pid: P12491
tag: ['点分治', '集训队互测', '2024']
---
# [集训队互测 2024] 串联
## 题目描述

给定一棵树，每个点有两个权值 $a_i,b_i$。对于树上的一条简单路径，若这条路径上 $b$ 之和乘上 $a$ 的最小值大于等于一个常数 $V$，那么这条路径被称作一条好的路径。

即：对于一条简单路径，设 $p_1,p_2,\dots,p_k$ 为路径上的点。这条简单路径是好的，当且仅当 $\min_{i=1}^k a_{p_i} \times \sum_{i=1}^k b_{p_i}\ge V$。

求所有好的路径中，$\sum b$ 的最小值。
## 输入格式

第一行两个整数 $n,V$。

接下来 $n$ 行每行两个整数 $a_i,b_i$。

接下来 $n−1$ 行每行两个整数 $x_i,y_i$，表示一条树边。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
10 100
4 8
7 6
4 6
5 5
4 4
7 4
5 4
8 8
5 5
6 4
1 8
1 2
2 3
2 6
10 9
4 1
4 9
5 7
5 4
```
### 样例输出 #1
```
25
```
## 提示

### 子任务

对于所有测试点均满足 $1\leq V\leq 10^{18},1\leq a_i,b_i\leq 10^9$。数据保证有解。

| Subtask |    $n\leq$    |           特殊性质           | 分值 |
| :-----: | :-----------: | :--------------------------: | :--: |
|   $1$   | $2\times10^3$ |             $/$              | $15$ |
|   $2$   |    $10^4$     |             $/$              | $15$ |
|   $3$   | $2\times10^5$ |    存在一个点度数为 $n-1$    | $15$ |
|   $4$   | $2\times10^5$ | 第 $i$ 条边连接 $i$ 和 $i+1$ | $15$ |
|   $5$   | $5\times10^4$ |             $/$              | $20$ |
|   $6$   | $2\times10^5$ |             $/$              | $20$ |


---

---
title: "[集训队互测 2000] 丘比特的烦恼"
layout: "post"
diff: 省选/NOI-
pid: P1500
tag: ['2000', '集训队互测']
---
# [集训队互测 2000] 丘比特的烦恼
## 题目背景

随着社会的不断发展，人与人之间的感情越来越功利化。最近，爱神丘比特发现，爱情也已不再是完全纯洁的了。这使得丘比特很是苦恼，他越来越难找到合适的男女，并向他们射去丘比特之箭。于是丘比特千里迢迢远赴中国，找到了掌管东方人爱情的神——月下老人，向他求教。

月下老人告诉丘比特，纯洁的爱情并不是不存在，而是他没有找到。在东方，人们讲究的是缘分。月下老人只要做一男一女两个泥人，在他们之间连上一条红线，那么它们所代表的人就会相爱——无论他们身处何地。而丘比特的爱情之箭只能射中两个距离相当近的人，选择的范围自然就小了很多，不能找到真正的有缘人。
## 题目描述

情人节（Valentine's day）的午夜零时，丘比特开始了自己的工作。他选择了一组数目相等的男女，感应到他们互相之间的缘分大小，并依此射出了神箭，使他们产生爱意。他希望能选择最好的方法，使被他选择的每一个人被射中一次，且每一对被射中的人之间的缘分的和最大。

当然，无论丘比特怎么改造自己的弓箭，总还是存在缺陷的。首先，弓箭的射程尽管增大了，但毕竟还是有限的，不能像月下老人那样，做到“千里姻缘一线牵”。其次，无论怎么改造，箭的轨迹终归只能是一条直线，也就是说，如果两个人之间的连线段上有别人，那么莫不可向他们射出丘比特之箭，否则，按月下老人的话，就是“乱点鸳鸯谱”了。

作为一个凡人，你的任务是运用先进的计算机为丘比特找到最佳的方案。
## 输入格式

输入第一行为正整数 $k$，表示丘比特之箭的射程。

第二行为正整数 $n$。

随后有 $2 \times n$ 行，表示丘比特选中的人的信息，其中前 $n$ 行为男子，后 $n$ 行为女子。

每个人的信息由两部分组成：他的姓名和他的位置。姓名是长度小于 $20$ 且仅包含字母的字符串，忽略大小写的区别，位置是由一对整数表示的坐标，它们之间用空格分隔。格式为 ```x y Name```。

输入文件剩下的部分描述了这些人的缘分。每一行的格式为 ```Name1 Name2 p```。

`Name1` 和 `Name2` 为有缘人的姓名，$p$ 是他们之间的缘分值（$p$ 为小于等于 $255$ 的正整数）。

以一个 ```End``` 作为文件结束标志。

每两个人之间的缘分至多只被描述一次。如果没有被描述，则说明他们缘分值为 $1$。
## 输出格式

输出仅一个正整数，表示每一对被射中的人之间的缘分的总和。这个和应当是最大的。
## 样例

### 样例输入 #1
```
2
3
0 0 Adam
1 1 Jack
0 2 George
1 0 Victoria
0 1 Susan
1 2 Cathy
Adam Cathy 100
Susan George 20
George Cathy 40
Jack Susan 5
Cathy Jack 30
Victoria Jack 20
Adam Victoria 15
End

```
### 样例输出 #1
```
65
```
## 提示

$1\le n\le 30$。

CTSC2000 第二试



---

---
title: "[国家集训队] Tree II"
layout: "post"
diff: 省选/NOI-
pid: P1501
tag: ['集训队互测', '动态树 LCT']
---
# [国家集训队] Tree II
## 题目描述

一棵 $n$ 个点的树，每个点的初始权值为 $1$。  
对于这棵树有 $q$ 个操作，每个操作为以下四种操作之一：

- `+ u v c`：将 $u$ 到 $v$ 的路径上的点的权值都加上自然数 $c$；
- `- u1 v1 u2 v2`：将树中原有的边 $(u_1,v_1)$ 删除，加入一条新边 $(u_2,v_2)$，保证操作完之后仍然是一棵树；
- `* u v c`：将 $u$ 到 $v$ 的路径上的点的权值都乘上自然数 $c$；
- `/ u v`：询问 $u$ 到 $v$ 的路径上的点的权值和，将答案对 $51061$ 取模。

## 输入格式

第一行两个整数 $n,q$。

接下来 $n-1$ 行每行两个正整数 $u,v$，描述这棵树的每条边。

接下来 $q$ 行，每行描述一个操作。

## 输出格式

对于每个询问操作，输出一行一个整数表示答案。

## 样例

### 样例输入 #1
```
3 2
1 2
2 3
* 1 3 4
/ 1 1
```
### 样例输出 #1
```
4

```
## 提示

【数据范围】   
对于 $10\%$ 的数据，$1\le n,q \le 2000$；   
另有 $15\%$ 的数据，$1 \le n,q \le 5\times 10^4$，没有 `-` 操作，并且初始树为一条链；    
另有 $35\%$ 的数据，$1 \le n,q \le 5\times 10^4$，没有 `-` 操作；  
对于 $100\%$ 的数据，$1\le n,q \le 10^5$，$0\le c \le 10^4$。

By (伍一鸣)



---

---
title: "[国家集训队] 矩阵乘法"
layout: "post"
diff: 省选/NOI-
pid: P1527
tag: ['集训队互测', 'O2优化', '整体二分']
---
# [国家集训队] 矩阵乘法
## 题目描述

给你一个 $n \times n$ 的矩阵，不用算矩阵乘法，但是每次询问一个子矩形的第 $k$ 小数。

## 输入格式

第一行有两个整数，分别表示矩阵大小 $n$ 和询问组数 $q$。

第 $2$ 到第 $(n + 1)$ 行，每行 $n$ 个整数，表示这个矩阵。第 $(i + 1)$ 行的第 $j$ 个数表示矩阵第 $i$ 行第 $j$ 列的数 $a_{i, j}$。

接下来 $q$ 行，每行五个整数 $x_1, y_1, x_2, y_2, k$，表示一组询问，要求找到以 $(x_1, y_1)$ 为左上角，$(x_2, y_2)$ 为右下角的子矩形中的第 $k$ 小数。
## 输出格式

对于每组询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2 2
2 1
3 4
1 2 1 2 1
1 1 2 2 3

```
### 样例输出 #1
```
1
3
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $n \leq 100$，$q \leq 10^3$。
- 对于 $40\%$ 的数据，保证 $n \leq 300$，$q \leq 10^4$。
- 对于 $60\%$ 的数据，保证 $n \leq 400$，$q \leq 3 \times 10^4$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 500$，$1 \leq q \leq 6 \times 10^4$，$0 \leq a_{i, j} \leq 10^9$。


---

---
title: "[国家集训队] happiness"
layout: "post"
diff: 省选/NOI-
pid: P1646
tag: ['集训队互测', '最小割']
---
# [国家集训队] happiness
## 题目描述

高一一班的座位表是个 $n\times m$ 的矩阵，经过一个学期的相处，每个同学和前后左右相邻的同学互相成为了好朋友。这学期要分文理科了，每个同学对于选择文科与理科有着自己的喜悦值，而一对好朋友如果能同时选文科或者理科，那么他们又将收获一些喜悦值。

作为计算机竞赛教练的 scp 大老板，想知道如何分配可以使得全班的喜悦值总和最大。
## 输入格式

第一行两个正整数 $n$，$m$。

接下来是六个矩阵。

- 第一个矩阵为 $n$ 行 $m$ 列。此矩阵的第 $i$ 行第 $j$ 列的数字表示座位在第 $i$ 行第 $j$ 列的同学选择文科获得的喜悦值。
- 第二个矩阵为 $n$ 行 $m$ 列。此矩阵的第 $i$ 行第 $j$ 列的数字表示座位在第 $i$ 行第 $j$ 列的同学选择理科获得的喜悦值。
- 第三个矩阵为 $n-1$ 行 $m$ 列。此矩阵的第 $i$ 行第 $j$ 列的数字表示座位在第 $i$ 行第 $j$ 列的同学与第 $i+1$ 行第 $j$ 列的同学同时选择文科获得的额外喜悦值。
- 第四个矩阵为 $n-1$ 行 $m$ 列。此矩阵的第 $i$ 行第 $j$ 列的数字表示座位在第 $i$ 行第 $j$ 列的同学与第 $i+1$ 行第 $j$ 列的同学同时选择理科获得的额外喜悦值。
- 第五个矩阵为 $n$ 行 $m-1$ 列。此矩阵的第 $i$ 行第 $j$ 列的数字表示座位在第 $i$ 行第 $j$ 列的同学与第 $i$ 行第 $j+1$ 列的同学同时选择文科获得的额外喜悦值。
- 第六个矩阵为 $n$ 行 $m-1$ 列。此矩阵的第 $i$ 行第 $j$ 列的数字表示座位在第 $i$ 行第 $j$ 列的同学与第 $i$ 行第 $j+1$ 列的同学同时选择理科获得的额外喜悦值。
## 输出格式

输出一个整数，表示喜悦值总和的最大值。

## 样例

### 样例输入 #1
```
1 2
1 1
100 110
1
1000
```
### 样例输出 #1
```
1210

```
## 提示

### 样例解释

两人都选理，则获得 $100+110+1000$ 的喜悦值。

对于 $100\%$ 的数据，$1\le n,m \le 100$，且所有喜悦值均为小于等于 $5000$ 的非负整数。


---

---
title: "[国家集训队] Crash的数字表格 / JZPTAB"
layout: "post"
diff: 省选/NOI-
pid: P1829
tag: ['数学', '2010', '集训队互测', 'O2优化', '莫比乌斯反演']
---
# [国家集训队] Crash的数字表格 / JZPTAB
## 题目描述

今天的数学课上，Crash 小朋友学习了最小公倍数（Least Common Multiple）。对于两个正整数 $a$ 和 $b$，$\text{lcm}(a,b)$ 表示能同时被 $a$ 和 $b$ 整除的最小正整数。例如，$\text{lcm}(6, 8) = 24$。

回到家后，Crash 还在想着课上学的东西，为了研究最小公倍数，他画了一张 $ n \times m$ 的表格。每个格子里写了一个数字，其中第 $i$ 行第 $j$ 列的那个格子里写着数为 $\text{lcm}(i, j)$。

看着这个表格，Crash 想到了很多可以思考的问题。不过他最想解决的问题却是一个十分简单的问题：这个表格中所有数的和是多少。当 $n$ 和 $m$ 很大时，Crash 就束手无策了，因此他找到了聪明的你用程序帮他解决这个问题。由于最终结果可能会很大，Crash 只想知道表格里所有数的和对 $20101009$ 取模后的值。


## 输入格式

输入包含一行两个整数，分别表示 $n$ 和 $m$。

## 输出格式

输出一个正整数，表示表格中所有数的和对 $20101009$ 取模后的值。

## 样例

### 样例输入 #1
```
4 5
```
### 样例输出 #1
```
122
```
## 提示

#### 样例输入输出 1 解释

该表格为：

|$1$|$2$|$3$|$4$|$5$|
|:-:|:-:|:-:|:-:|:-:|
|$2$|$2$|$6$|$4$|$10$|
|$3$|$6$|$3$|$12$|$15$|
|$4$|$4$|$12$|$4$|$20$|

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n, m \le 10^3$。
- 对于 $70\%$ 的数据，保证 $n, m \le 10^5$。
- 对于 $100\%$ 的数据，保证 $1\le n,m \le 10^7$。


---

---
title: "[国家集训队] 圈地计划"
layout: "post"
diff: 省选/NOI-
pid: P1935
tag: ['集训队互测', '最小割']
---
# [国家集训队] 圈地计划
## 题目描述

最近房地产商 GDOI(Group of Dumbbells Or Idiots) 从 NOI(Nuts Old Idiots) 手中得到了一块开发土地。据了解，这块土地是一块矩形的区域，可以纵横划分为 $N\times M$ 块小区域。GDOI 要求将这些区域分为商业区和工业区来开发。根据不同的地形环境，每块小区域建造商业区和工业区能取得不同的经济价值。更具体点，对于第 $i$ 行第 $j$ 列的区域，建造商业区将得到 $A_{i,j}$ 收益，建造工业区将得到 $B_{i,j}$ 收益。另外不同的区域连在一起可以得到额外的收益，即如果区域 $(i,j)$ 相邻（相邻是指两个格子有公共边）有 $k$ 块（显然 $k$ 不超过 $4$）类型不同于 $(i,j)$ 的区域，则这块区域能增加 $k\times C_{i,j}$ 收益。经过 Tiger.S 教授的勘察，收益矩阵 $A,B,C$ 都已经知道了。你能帮 GDOI 求出一个收益最大的方案么？

## 输入格式

输入第一行为两个整数，分别为正整数 $N$ 和 $M$，分别表示区域的行数和列数；

第 $2$ 到 $N+1$ 行，每行 $M$ 个整数，表示商业区收益矩阵 $A$；

第 $N+2$ 到 $2N+1$ 行，每行 $M$ 个整数，表示工业区收益矩阵 $B$；

第 $2N+2$ 到 $3N+1$ 行，每行 $M$ 个整数，表示相邻额外收益矩阵 $C$。

## 输出格式

输出只有一行，包含一个整数，为最大收益值。

## 样例

### 样例输入 #1
```
3 3
1 2 3
4 5 6
7 8 9
9 8 7
6 5 4
3 2 1
1 1 1
1 3 1
1 1 1
```
### 样例输出 #1
```
81
```
## 提示

$N,M\leq 100$，$0\leq A_{i,j},B_{i,j},C_{i,j}\leq 10^3$。

对于 $30\%$ 的数据有 $N, M\leq 6$；

对于 $50\%$ 的数据有 $N, M \leq 20$；

对于 $100\%$ 的数据有 $N,M\leq 100$。


---

---
title: "[国家集训队] 排队"
layout: "post"
diff: 省选/NOI-
pid: P1975
tag: ['集训队互测', '树套树', '分块']
---
# [国家集训队] 排队
## 题目描述

排排坐，吃果果，生果甜嗦嗦，大家笑呵呵。你一个，我一个，大的分给你，小的留给我，吃完果果唱支歌，大家乐和和。

红星幼儿园的小朋友们排起了长长地队伍，准备吃果果。不过因为小朋友们的身高有所区别，排成的队伍高低错乱，极不美观。设第 $i$ 个小朋友的身高为 $h_i$。

幼儿园阿姨每次会选出两个小朋友，交换他们的位置，请你帮忙计算出每次交换后，序列的逆序对数。为方便幼儿园阿姨统计，在未进行任何交换操作时，你也应该输出该序列的逆序对数。

## 输入格式

第一行为一个正整数 $n$，表示小朋友的数量；

第二行包含 $n$ 个由空格分隔的正整数 $h_1,h_2,\dots,h_n$，依次表示初始队列中小朋友的身高；

第三行为一个正整数 $m$，表示交换操作的次数；

以下m行每行包含两个正整数 $a_i,b_i$，表示交换位置 $a_i$ 和 $b_i$ 的小朋友。

## 输出格式

输出文件共 $m+1$ 行，第 $i$ 行一个正整数表示交换操作 $i$ 结束后，序列的逆序对数。

## 样例

### 样例输入 #1
```
3
130 150 140
2
2 3
1 3
```
### 样例输出 #1
```
1
0
3

```
## 提示

【样例说明】  
未进行任何操作时，$(2,3)$ 为逆序对；  
操作一结束后，序列为 $130 \ 140 \ 150$，不存在逆序对；  
操作二结束后，序列为 $150 \ 140 \ 130$，$(1,2),(1,3),(2,3)$ 共 $3$ 个逆序对。

【数据范围】  
对于 $10\%$ 的数据，$n,m \le 15$；  
对于 $25\%$ 的数据，$n,m \le 200$；    
另有 $25\%$ 的数据，$h_i$ 各不相同；  
另有 $15\%$ 的数据，$110 \le h_i \le 160$；  
以上两类数据交集为空。

对于100%的数据，$1 \le m \le 2\times 10^3$，$1 \le n \le 2 \times 10^4$，$1 \le h_i \le 10^9$，$a_i \ne b_i$，$1 \le a_i,b_i \le n$。



---

---
title: "[国家集训队] JZPFAR"
layout: "post"
diff: 省选/NOI-
pid: P2093
tag: ['集训队互测', 'K-D Tree']
---
# [国家集训队] JZPFAR
## 题目背景

原《零件分组》见 P1233。

## 题目描述

平面上有 $n$ 个点。现在有 $m$ 次询问，每次给定一个点 $(px, py)$ 和一个整数 $k$，输出 $n$ 个点中离 $(px, py)$ 的距离第 $k$ 大的点的标号。如果有两个(或多个)点距离 $(px, py)$ 相同，那么认为标号较小的点距离较大。

## 输入格式

第一行，一个整数 $n$，表示点的个数。

下面 $n$ 行，每行两个整数 $x_i,y_i$，表示 $n$ 个点的坐标。点的标号按照输入顺序，分别为 $1\ldots n$。

下面一行，一个整数 $m$，表示询问个数。

下面 $m$ 行，每行三个整数 $px_i,py_i,k_i$，表示一个询问。
## 输出格式

$m$ 行，每行一个整数，表示相应的询问的答案。
## 样例

### 样例输入 #1
```
3
0 0
0 1
0 2
3
1 1 2
0 0 3
0 1 1
```
### 样例输出 #1
```
3
1
1
```
## 提示

#### 数据规模与约定

- $50\%$ 的数据中，$n$ 个点的坐标在某范围内随机分布。
- $100\%$ 的数据中，$1\le n\le 10^5$，$1\le m\le 10^4$，$1\le k\le 20$，$-10^9\le x_i,y_i,px_i,py_i\le 10^9$，$n$ 个点中任意两点坐标不同，$m$ 个询问的点的坐标在某范围内随机分布。


---

---
title: "[国家集训队] 部落战争"
layout: "post"
diff: 省选/NOI-
pid: P2172
tag: ['集训队互测', '网络流']
---
# [国家集训队] 部落战争
## 题目背景

lanzerb 的部落在 A 国的上部，他们不满天寒地冻的环境，于是准备向A国的下部征战来获得更大的领土。
## 题目描述

A 国是一个 $M\times N$ 的矩阵，其中某些地方是城镇，某些地方是高山深涧无人居住。lanzerb 把自己的部落分成若干支军队，他们约定：

每支军队可以从任意一个城镇出发，并只能从上往向下征战，不能回头。途中只能经过城镇，不能经过高山深涧。

如果某个城镇被某支军队到过，则其他军队不能再去那个城镇了。
每支军队都可以在任意一个城镇停止征战。

所有军队都很奇怪，他们走的方法有点像国际象棋中的马。不过马每次只能走 $1\times2$ 的路线，而他们只能走 $R\times C$ 的路线。

lanzerb 的野心使得他的目标是统一全国，但是兵力的限制使得他们在配备人手时力不从心。假设他们每支军队都能顺利占领这支军队经过的所有城镇，请你帮 lanzerb 算算至少要多少支军队才能完成统一全国的大业。
## 输入格式

第一行包含 $4$ 个整数 $M,N,R,C$，意义见问题描述。接下来 $M$ 行每行一个长度为 $N$ 的字符串。如果某个字符是 `.` 表示这个地方是城镇；如果这个字符是 `x` 则表示这个地方是高山深涧。
## 输出格式

输出一个整数，表示最少的军队个数。
## 样例

### 样例输入 #1
```
3 3 1 2
...
.x.
...
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5 4 1 1
....
..x.
...x
....
x...
```
### 样例输出 #2
```
5

```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，$1\le M,N\le 50,1\le R,C\le 10$。


---

---
title: "[国家集训队] 礼物"
layout: "post"
diff: 省选/NOI-
pid: P2183
tag: ['数学', '集训队互测', '中国剩余定理 CRT', 'Lucas 定理']
---
# [国家集训队] 礼物
## 题目背景

一年一度的圣诞节快要来到了。每年的圣诞节小 E 都会收到许多礼物，当然他也会送出许多礼物。不同的人物在小 E 心目中的重要性不同，在小 E 心中分量越重的人，收到的礼物会越多。
## 题目描述

小 E 从商店中购买了 $n$ 件礼物，打算送给 $m$ 个人，其中送给第 $i$ 个人礼物数量为 $w_i$。请你帮忙计算出送礼物的方案数（两个方案被认为是不同的，当且仅当存在某个人在这两种方案中收到的礼物不同）。由于方案数可能会很大，你只需要输出模 $P$ 后的结果。

## 输入格式

输入的第一行包含一个整数 $P$，表示模数。  
第二行包含两个整数 $n$ 和 $m$，分别表示小 E 从商店购买的礼物数和接受礼物的人数。  
第 $3$ 到第 $(m + 2)$ 行，每行一个整数，第 $(i + 2)$ 行的整数 $w_i$ 表示送给第 $i$ 个人的礼物数量。
## 输出格式

若不存在可行方案，则输出 `Impossible`，否则输出一个整数，表示模 $P$ 后的方案数。

## 样例

### 样例输入 #1
```
100
4 2
1
2

```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
100
2 2
1
2
```
### 样例输出 #2
```
Impossible

```
## 提示

### 样例 1 解释
以 `/` 分割，`/` 前后分别表示送给第一个人和第二个人的礼物编号。$12$ 种方案详情如下：
```plain
1/23 1/24 1/34
2/13 2/14 2/34
3/12 3/14 3/24
4/12 4/13 4/23
```
### 数据规模与约定
设 $P= \prod_{i=1}^t p_i^{c_i}$，$p_i$ 为质数。

对于 $15\%$ 的数据，$n\leq 15$，$m\leq 5$，$p_i^{c_i}\leq 10^5$。

在剩下的 $85\%$ 数据中，约有 $60\%$ 的数据满足 $t\leq 2$，$c_i=1$，$p_i\leq 10^5$，约有 $30\%$ 的数据满足 $p_i\leq 200$。

对于 $100\%$ 的数据，$1\leq n\leq 10^9$，$1\leq m\leq 5$，$1\leq p_i^{c_i}\leq 10^5$，$1\leq w_i \leq P\leq 10^9$。



---

---
title: "[国家集训队] middle"
layout: "post"
diff: 省选/NOI-
pid: P2839
tag: ['二分', '集训队互测', '可持久化线段树']
---
# [国家集训队] middle
## 题目描述

一个长度为 $n$ 的序列 $a$，设其排过序之后为 $b$，其中位数定义为 $b_{n/2}$，其中 $a,b$ 从 $0$ 开始标号，除法下取整。

给你一个长度为 $n$ 的序列 $s$。

回答 $Q$ 个这样的询问：$s$ 的左端点在 $[a,b]$ 之间，右端点在 $[c,d]$ 之间的子区间中，最大的中位数。

其中 $a<b<c<d$。

位置也从 $0$ 开始标号。

我会使用一些方式强制你在线。

## 输入格式

第一行序列长度 $n$。

接下来 $n$ 行按顺序给出 $a$ 中的数。

接下来一行 $Q$。

然后 $Q$ 行每行 $a,b,c,d$，我们令上个询问的答案是 $x$（如果这是第一个询问则 $x=0$）。

令数组 $q=\{(a+x)\bmod n,(b+x)\bmod n,(c+x)\bmod n,(d+x)\bmod n\}$。

将 $q$ 从小到大排序之后，令真正的要询问的 $a=q_0$，$b=q_1$，$c=q_2$，$d=q_3$。

输入保证满足条件。

## 输出格式

$Q$ 行依次给出询问的答案。

## 样例

### 样例输入 #1
```
5
170337785
271451044
22430280
969056313
206452321
3
3 1 0 2
2 3 1 4
3 1 4 0
```
### 样例输出 #1
```
271451044
271451044
969056313
```
## 提示

对于 $5\%$ 的数据，$n,Q \leq 100$；

对于另 $25\%$ 的数据，$n \leq 2000$；

对于 $100\%$ 的数据，$1\leq n \leq 20000$，$1\leq Q \leq 25000$，$1\leq a_i\leq 10 ^ 9$。


---

---
title: "[国家集训队] 航班安排"
layout: "post"
diff: 省选/NOI-
pid: P4452
tag: ['2012', '集训队互测', '网络流', '费用流']
---
# [国家集训队] 航班安排
## 题目背景

1. wqs 爱好模拟飞行。
2. clj 开了一家神犇航空，由于 clj 还要玩游戏，所以公司的事务由你来打理。

注意：题目中只是用了这样一个背景，并不与真实 / 模拟飞行相符。
## 题目描述

神犇航空有 $K$ 架飞机，为了简化问题，我们认为每架飞机都是相同的。神犇航空的世界中有 $N$ 个机场，以 $0\cdots N-1$ 编号，其中 $0$ 号为基地机场，每天 $0$ 时刻起飞机才可以从该机场起飞，并不晚于 $T$ 时刻回到该机场。

一天，神犇航空接到了 $M$ 个包机请求，每个请求为在 $s$ 时刻从 $a$ 机场起飞，在恰好 $t$ 时刻到达 $b$ 机场，可以净获利 $c$。换言之，你只需要在 $s$ 时刻在 $a$ 机场选择提供一架飞机给请求方，那么这架飞机就会在 $t$ 时刻准时出现在 $b$ 机场，并且你将获得 $c$ 的净利润。

设计一种方案，使得总收益最大。
## 输入格式

第一行，$4$ 个正整数 $N,M,K,T$，如题目描述中所述；

以下 $N$ 行，每行 $N$ 个整数，描述一个 $N\times N$ 的矩阵 $t$，$t_{i,j}$ 表示从机场 $i$ 空载飞至机场 $j$，需要时间 $t_{i,j}$；

以下 $N$ 行，每行 $N$ 个整数，描述一个 $N\times N$ 的矩阵 $f$，$f_{i,j}$ 表示从机场 $i$ 空载飞至机场 $j$，需要费用 $f_{i,j}$；

以下 $M$ 行，每行 $5$ 个整数描述一个请求，依次为 $a,b,s,t,c$。
## 输出格式

　　仅一行，一个整数，表示最大收益。
## 样例

### 样例输入 #1
```
2 1 1 10
0 5
5 0
0 5
5 0
0 1 0 5 10
```
### 样例输出 #1
```
5
```
## 提示

对于 $10\%$ 的测试数据，$K=1$；

另有 $20\%$ 的测试数据，$K=2$；

对于全部的测试数据，$1\le N,M\le 200$，$1\le K\le 10$，$1\le T\le 3000$，$1\le t_{i,j}\le 200$，$f_{i,j}\le 2\times 10^3$，$0\le a,b<N$，$0\le s\le t\le T$，$0\le c\le 10000$，$t_{i,i}=f_{i,i}=0$，$t_{ij}\le t_{i,k}+t_{k,j}$，$f_{i,j}\le f_{i,k}+f_{k,j}$。


---

---
title: "[集训队互测 2012] calc"
layout: "post"
diff: 省选/NOI-
pid: P4463
tag: ['动态规划 DP', '数学', '2012', '集训队互测', '生成函数']
---
# [集训队互测 2012] calc
## 题目描述

一个序列 $a_1,a_2,\dots,a_n$ 是合法的，当且仅当：

- $a_1,a_2,\dots,a_n$ 都是 $[1,k]$ 中的整数。
- $a_1,a_2,\dots,a_n$ 互不相等。

一个序列的值定义为它里面所有数的乘积，即 $a_1\times a_2\times\dots\times a_n$。

求所有不同合法序列的值的和对 $p$ 取模后的结果。两个序列不同当且仅当他们任意一位不同。
## 输入格式

一行三个正整数 $k, n, p$。意义为上面所说的。
## 输出格式

一行结果。
## 样例

### 样例输入 #1
```
9 7 10007
```
### 样例输出 #1
```
3611
```
## 提示

【数据范围】

对于 $5\%$ 的数据，$k \le 10$，$n \le 10$。

对于 $20\%$ 的数据，$k \le 1000$，$n \le 20$。

对于 $50\%$ 的数据，$k \le 10^9$，$n \le 20$。

对于 $100\%$ 的数据，$k \le 10 ^ 9$，$n \le 500$，$p \le 10 ^ 9$，保证 $p$ 为素数，保证 $n + 1 < k < p$。

by WJMZBMR
****
$\mathsf i \color{red}\mathsf{ostream}$ 觉得这题数据太弱了，于是他造了个[加强版](https://www.luogu.com.cn/problem/P5850)


---

---
title: "[国家集训队] JZPSTR"
layout: "post"
diff: 省选/NOI-
pid: P4465
tag: ['2012', '集训队互测']
---
# [国家集训队] JZPSTR
## 题目描述

你要对一个字符串进行三种操作：

0. 在位置$x_i$处插入一个字符串$y_i$

1. 删除位置$[x_i, y_i)$的字符串

2. 查询位置$[x_i, y_i)$的字符串包含多少次给定的子串$z_i$
## 输入格式

第一行，一个整数$T$，表示操作个数。

下面$T$行，每行第一个数$p_i$，表示这个操作的类型：

若$p_i=0$，则接下来有一个整数$x_i$和一个字符串$y_i$，表示进行插入操作；

若$p_i=1$，则接下来有两个整数$x_i$和$y_i$，表示进行删除操作；

若$p_i=2$，则接下来有两个整数$x_i$和$y_i$，以及一个字符串$z_i$，表示进行询问。

字符串的下标从$0$开始(即第一个字符的下标为$0$)。

初始时字符串为空。

对于插入操作，插入后字符串$y_i$的首字符的下标应为$x_i$；

对于删除操作，删除的区间$[x_i, y_i)$为左闭右开区间；

对于查询操作，询问的区间$[x_i, y_i)$为左闭右开区间。

所有插入的和查询的字符串均不为空，且只包含0~9的字符。

所有询问的区间和删除的区间均不为空。

保证输入数据合法。

对于"左闭右开区间"不理解的可以去看样例解释。
## 输出格式

对每个询问操作，输出一行，表示这个询问的答案。
## 样例

### 样例输入 #1
```
8
0 0 894894894
2 0 2 894
2 0 9 894
0 2 6
2 0 9 64
2 0 9 894
1 2 6
2 0 6 894
```
### 样例输出 #1
```
0
3
1
1
2
```
## 提示

第一次操作后，字符串为894894894；

第二次操作，询问的区间为89，不包含任何894；

第三次操作，询问的区间为894894894，包含三个894；

第四次操作后，字符串为8964894894；

第五次操作，询问的区间为896489489，包含一个64；

第六次操作，询问的区间为896489489，包含一个894；

第七次操作后，字符串为894894；

第八次操作，询问的区间为894894，包含两个894。

50%的数据中，询问个数<=100 (不是操作个数)

100%的数据中，插入总长度<=2000000，任何时刻字符串长度<=1000000，插入次数<=1001，删除次数<=1000，询问的z_i的总长度<=10000

来源：2012集训队互测，by gyz


---

---
title: "[国家集训队] 和与积"
layout: "post"
diff: 省选/NOI-
pid: P4466
tag: ['2012', '集训队互测']
---
# [国家集训队] 和与积
## 题目描述

给出 $n$，统计满足下面条件的数对 $(a,b)$ 的个数：

1. $1\le a<b \le n$。
2. $a+b$ 整除 $a\times b$。
## 输入格式

一行一个整数数 $n$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
15
```
### 样例输出 #1
```
4
```
## 提示

| Test | $N$ | Test | $N$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $\leq 10$ | $11$ | $\leq 5\times 10^7$ |
| $2$ | $\leq 50$ | $12$ | $\leq 10^8$ |
| $3$ | $\leq 10^3$ | $13$ | $\leq 2\times 10^8$ |
| $4$ | $\leq 5\times 10^3$ | $14$ | $\leq 3\times 10^8$ |
| $5$ | $\leq 2\times 10^4$ | $15$ | $\leq 5\times 10^8$ |
| $6$ | $\leq 2\times 10^5$ | $16$ | $\leq 10^9$ |
| $7$ | $\leq 2\times 10^6$ | $17$ | $\leq 10^9$ |
| $8$ | $\leq 10^7$ | $18$ | $\leq 2^{31}-1$ |
| $9$ | $\leq 2\times 10^7$ | $19$ | $\leq 2^{31}-1$ |
| $10$ | $\leq 3\times 10^7$ | $20$ | $\leq 2^{31}-1$ |

来源：2012集训队互测，by ayq


---

---
title: "[国家集训队] 飞飞侠"
layout: "post"
diff: 省选/NOI-
pid: P4473
tag: ['2011', '线段树', '并查集', '集训队互测', 'O2优化', '最短路']
---
# [国家集训队] 飞飞侠
## 题目背景

来源：国家集训队 2011 何朴藩
## 题目描述

飞飞国是一个传说中的国度，国家的居民叫做飞飞侠。飞飞国是一个 $N\times M$ 的矩形方阵，每个格子代表一个街区。

然而飞飞国是没有交通工具的。飞飞侠完全靠地面的弹射装置来移动。  

每个街区都装有弹射装置。使用弹射装置是需要支付一定费用的。而且每个弹射装置都有自己的弹射能力。  

我们设第 $i$ 行第 $j$ 列的弹射装置有 $A_{i,j}$ 的费用和 $B_{i,j}$ 的弹射能力。并规定有相邻边的格子间距离是 $1$。那么，任何飞飞侠都只需要在 $(i,j)$ 支付 $A_{i,j}$ 的费用就可以任意选择弹到距离不超过 $B_{i,j}$ 的位置了。如下图  
![https://cdn.luogu.com.cn/upload/pic/17919.png](https://cdn.luogu.com.cn/upload/pic/17919.png)  
（从红色街区交费以后可以跳到周围的任意蓝色街区。）  

现在的问题很简单。有三个飞飞侠，分别叫做 $X, Y, Z$。现在它们决定聚在一起玩，于是想往其中一人的位置集合。告诉你 $3$ 个飞飞侠的坐标，求往哪里集合大家需要花的费用总和最低。（费用相同时优先 $X$，次优先 $Y$）
## 输入格式

输入的第一行包含两个整数 $N$ 和 $M$，分别表示行数和列数。

接下来是 $2$ 个 $N\times M$ 的自然数矩阵，为 $B_{i,j}$ 和 $A_{i,j}$。

最后一行六个数，分别代表 $X, Y, Z$ 所在地的行号和列号。
## 输出格式

第一行输出一个字符 $X, Y$ 或者 $Z$。表示最优集合地点。

第二行输出一个整数，表示最小费用。

如果无法集合，只输出一行 `NO`。  
## 样例

### 样例输入 #1
```
4 4
0 0 0 0
1 2 2 0
0 2 2 1
0 0 0 0
5 5 5 5
5 5 5 5
5 5 5 5
5 5 5 5
2 1 3 4 2 2
```
### 样例输出 #1
```
Z
15
```
## 提示

对于 $20\%$ 的数据，$N, M\leq 10$，$B_{i,j}\leq 20$。 

对于 $40\%$ 的数据，$N, M \leq 100$，$B_{i,j}\leq 20$。

对于 $100\%$ 的数据，$1\leq N, M\leq 150$，$0\leq B_{i, j}\leq 10^9$，$0\leq A_{i, j}\leq 1000$。  


---

---
title: "[国家集训队] 书堆"
layout: "post"
diff: 省选/NOI-
pid: P4820
tag: ['集训队互测']
---
# [国家集训队] 书堆
## 题目描述

蚂蚁是勤劳的动物，他们喜欢挑战极限?现在他们迎来了一个难题！蚂蚁居住在图书馆里，图书馆里有大量的书籍。书是形状大小质量都一样的矩形。蚂蚁要把这些书摆在水平桌子的边緣。蚂蚁喜欢整洁的布置，所以蚂蚁规定书本必须水平摆放，宽必须平行于桌緣（如图），而且不允许同一高度摆多本书。

![](https://cdn.luogu.com.cn/upload/pic/30575.png)

蚂蚁想要让书本伸出桌子边缘尽量远，同时不让书因为重力垮下来。它们己经用不知道什么方法测出了书的长度M(如图)。如果总共有N本书，请你帮忙计算如何摆放使得最多水平伸出桌缘多远。你不用考虑蚂蚁用什么方法搭建这堆书。

如果某本书以上的所有书的重心的竖直射影不在这本书上，或者正好落在在这本书的边界上，那么这堆书是不稳定的，会因为重力而垮下来。

考虑以下的假设：

- 不考虑地球自转，重力系数也不因高度改变；
- 书是质量均匀，质地坚硬的理想二维物体；
- 在不会垮的前提下，每本书的位置坐标可以是任意实数。
## 输入格式

第一行正整数 N M
## 输出格式

一行（有换行符），L，表示水平延伸最远的整数距离 (不大于答案的最大整数)
## 样例

### 样例输入 #1
```
1 100
```
### 样例输出 #1
```
49
```
### 样例输入 #2
```
2 100
```
### 样例输出 #2
```
74
```
## 提示

 N <= 10^18,数据保证答案 < 10^6


---

---
title: "[集训队作业2013] 城市规划"
layout: "post"
diff: 省选/NOI-
pid: P4841
tag: ['数学', '2013', '集训队互测', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [集训队作业2013] 城市规划
## 题目描述

刚刚解决完电力网络的问题，阿狸又被领导的任务给难住了。

刚才说过，阿狸的国家有 $n$ 个城市，现在国家需要在某些城市对之间建立一些贸易路线，使得整个国家的任意两个城市都直接或间接的连通。

为了省钱, 每两个城市之间最多只能有一条直接的贸易路径。对于两个建立路线的方案，如果存在一个城市对，在两个方案中是否建立路线不一样，那么这两个方案就是不同的，否则就是相同的。现在你需要求出一共有多少不同的方案。

好了，这就是困扰阿狸的问题。换句话说，你需要求出 $n$ 个点的简单 (无重边无自环) 有标号无向连通图数目。

由于这个数字可能非常大, 你只需要输出方案数对 $1004535809$ ( $479 \times 2 ^{21} + 1$ ) 取模即可。
## 输入格式

仅一行一个整数 $n$
## 输出格式

仅一行一个整数，为方案数 $\bmod \space 1004535809$。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
38
```
### 样例输入 #3
```
100000
```
### 样例输出 #3
```
829847355

```
## 提示

【数据范围】   
对于 $20\%$ 的数据，$n \le 10$    
对于 $40\%$ 的数据，$n \le 1000$     
对于 $60\%$ 的数据，$n \le 30000$    
对于 $80\%$ 的数据，$n \le 60000$     
对于 $100\%$ 的数据，$n \le 130000$   

试题来源：$2013$ 中国国家集训队第二次作业


---

---
title: "[清华集训 2014] 文学"
layout: "post"
diff: 省选/NOI-
pid: P5928
tag: ['计算几何', '2015', '集训队互测', '凸包', '半平面交']
---
# [清华集训 2014] 文学
## 题目描述

巨酱和主席是一对好朋友。他们都很喜欢读书，经常一起阅读相关领域书籍，进行系统的学习。一天主席列出了一份列表，里面共 $p$ 本书，其中不乏《约翰克里斯多夫》，《名人传》等名著。作为一名在文学上有很高修养的知名青年，巨酱打算用尽量少的时间把这份列表中的所有书籍都读完。

作为一名文化人，巨酱阅读书籍的方式也与一般人不同。他使用一种叫做“批量阅读”的阅读方式。首先他根据自己的喜好，对每本书给出了个参数 $x,y$，其中 $i$ 本书的两个参数为 $x_i,y_i$。当然，由于巨酱独特的口味，可能有两本不同的书，它们的 $x,y$ 参数均相同。而每次阅读的时候，他会设置三个系数 $a, b, c$，所有满足 $a \times x+b \times y \leq c$ 的书籍都可以通过这次“批量阅读”读完，这次批量阅读总共需要 $w$ 的时间。
现在，巨酱有 $n$ 种 “批量阅读”的方案，第 $i$ 种“批量阅读”三个参数为 $a_i,b_i,c_i$，需要的时间为 $w_i$。现在巨酱打算从这 $n$ 种“批量阅读”中选出若干，使得巨酱可以用尽量少的时间读完所有的书。现在我们想知道，巨酱最少用多少时间？
## 输入格式

第一行两个正整数 $n,p$，分别表示“批量阅读”的方案数以及书的数量。

接下来 $n$ 行，每行四个整数，其中第 $i$ 行包含四个整数 $a_i,b_i,c_i,w_i$，表示第 $i$ 种“批量阅读”的方案。

接下来 $p$ 行，每行两个整数，其中第 $i$ 行包含两个整数 $x_i,y_i$，表示第 $i$ 本书的参数。
## 输出格式

一行一个整数，表示最少需要的时间。若无论如何也无法读完全部书籍，则输出 $−1$。
## 样例

### 样例输入 #1
```
4 3
-1 0 0 10
-1 -1 -1 2
-1 1 -1 2
-1 -2 -1 1
0 2
0 -2
1 0
```
### 样例输出 #1
```
3
```
## 提示

对于 $100\%$ 的测试数据，$1 \leq n,p \leq 100，−10^6 \leq a_i,b_i,c_i,x_i,y_i \leq 10^6， 0 \lt w_i \leq 10^6$，且保证对于任何一种“批量阅读”方案，其 $a_i$ 与 $b_i$ 不会同时为 $0$。且不存在 $i, j$（$i$ 不等于 $j$）使得 $a_i \times b_j=a_j \times b_i$。


---

---
title: "[集训队互测 2022] 树链剖分"
layout: "post"
diff: 省选/NOI-
pid: P8821
tag: ['集训队互测', '2022', 'O2优化']
---
# [集训队互测 2022] 树链剖分
## 题目背景

请注意：**本题不是树链剖分模板题**。
## 题目描述

给定一棵 $n$ 个节点的树 $T$ 以及树上的 $m$ 条 **不同的** 路径 $I_i = (u_i, v_i)(u_i\neq v_i)$。具体地，$I_i$ 表示树上 $u_i$ 和 $v_i$ 之间的简单路径上所有点形成的点集。

考虑 $T$ 上某条路径 $I = (u, v)$，定义 $f(I) = \sum\limits_{i = 1} ^ m\sum\limits_{j = 1} ^ m [I_i\cup I = I_j\cup I]$。

对于 $T$ 上所有不同路径 $I$，求 $f(I)$ 之和，并将答案对 $998244353$ 取模。也就是说，你需要求 $\left(\sum\limits_{u = 1} ^ n\sum\limits_{v = u} ^ n f((u, v))\right) \bmod 998244353$。
## 输入格式

第一行一个整数 $S$，表示子任务编号。样例的子任务编号为 $-1$。

第二行两个整数 $n, m$，分别表示树的大小和路径条数。

接下来 $n - 1$ 行，每行两个整数 $x_i, y_i$ 表示 $T$ 上的一条边。

接下来 $m$ 行，每行两个整数 $u_i, v_i$ 表示第 $i$ 条路径 $I_i$。

**保证给定路径两两不同**。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
-1
3 3
1 2
2 3
1 2
2 3
1 3
```
### 样例输出 #1
```
32
```
### 样例输入 #2
```
-1
4 6
1 2
1 3
1 4
1 2
1 3
1 4
2 3
2 4
3 4
```
### 样例输出 #2
```
120
```
### 样例输入 #3
```
-1
7 7
1 2
1 3
2 4
4 5
5 6
5 7
5 7
3 1
4 7
7 1
2 6
3 6
3 5
```
### 样例输出 #3
```
330
```
## 提示

本题采用捆绑测试，共 $25$ 个子任务，分别编号为 $0\sim 24$。**注意评测子任务编号为实际子任务编号 $+1$**。

子任务编号模 $5$ 的余数将子任务按数据大小划分。

- 若子任务编号模 $5$ 余 $0$，则 $n, m\leq 100$，记为 A1。
- 若子任务编号模 $5$ 余 $1$，则 $n, m\leq 500$，记为 B1。依赖于 A1。
- 若子任务编号模 $5$ 余 $2$，则 $n, m\leq 1557$，记为 C1。依赖于 B1。
- 若子任务编号模 $5$ 余 $3$，则 $n, m\leq 85500$，记为 D1。依赖于 C1。
- 若子任务编号模 $5$ 余 $4$，则 $n, m\leq 2\times 10 ^ 5$，记为 E1。依赖于 D1。

子任务编号除以 $5$ 的商将子任务按特殊限制划分。

- 若子任务编号除以 $5$ 商 $0$，则 $T$ 是一条链，记为 A2。
- 若子任务编号除以 $5$ 商 $1$，则 $T$ 是一个菊花，记为 B2。
- 若子任务编号除以 $5$ 商 $2$，则所有路径端点互不相同，记为 C2。
- 若子任务编号除以 $5$ 商 $3$，则所有路径以同一点为一端，记为 D2。
- 若子任务编号除以 $5$ 商 $4$，则无特殊限制，记为 E2。依赖于 A2，B2，C2，D2。

对于 $100\%$ 的数据，$2\leq n\leq 2\times 10 ^ 5$，$1\leq m\leq \min(\frac {n(n - 1)} 2, 2\times 10 ^ 5)$，$1\leq u_i, v_i, x_i, y_i\leq n$，且所有 $(x_i, y_i)$ 形成一棵树，所有 $I_i = (u_i, v_i)$ 互不相同，$u_i\neq v_i$。

各子任务分值如下表所示。

| **得分** | **A1** | **B1** | **C1** | **D1** | **E1** | **总和** |
| :------: | :----: | :----: | :----: | :----: | :----: | :------: |
|  **A2**  |  $1$   |  $2$   |  $3$   |  $7$   |  $7$   |   $20$   |
|  **B2**  |  $1$   |  $2$   |  $3$   |  $4$   |  $4$   |   $14$   |
|  **C2**  |  $1$   |  $2$   |  $5$   |  $7$   |  $7$   |   $22$   |
|  **D2**  |  $1$   |  $3$   |  $5$   |  $4$   |  $5$   |   $18$   |
|  **E2**  |  $2$   |  $3$   |  $3$   |  $9$   |  $9$   |   $26$   |
| **总和** |  $6$   |  $12$  |  $19$  |  $31$  |  $32$  |  $100$   |

**注：洛谷评测无子任务依赖**。

来源：2022 年集训队互测 Round 4。

出题人：Alex_Wei。


---

---
title: "[集训队互测 2021] 数列重排"
layout: "post"
diff: 省选/NOI-
pid: P9055
tag: ['集训队互测', '2021', 'O2优化']
---
# [集训队互测 2021] 数列重排
## 题目背景

dottle bot。
## 题目描述

定义一个数列区间的 $\textrm{mex}$ 为区间中最小的没有出现过的自然数，定义一个数列的价值为其中 $\textrm{mex}\geq k$ 的区间数量。

给定 $n$ 个小于 $m$ 的自然数和一个区间 $[l,r]$，令 $f(k)$ 表示 $n$ 个数构成的数列所有重排列中数列价值的最大值，对于每一个 $k\in [l,r]$，求出 $f(k)$。

令 $a_i$ 表示数字 $i$ 出现的次数，保证存在正整数 $X$，使得  $\forall i\le m-1,a_i\in \{X,X+1\}$。
## 输入格式

由于 $n$ 可能很大，将采取如下方式减少读入量：

第一行四个整数 $m,l,r,X$。

第二行一个长度为 $m$ 的 $01$ 串，若其中第 $i$ 个位置为 $1$ 则数字 $i-1$ 的出现次数为 $X+1$，否则出现次数为 $X$。

根据输入可以推出 $n=mX+S$，其中 $S$ 为 $01$ 串中 $1$ 的数量。
## 输出格式

为了减少输出量，令 $ans=\displaystyle{\bigoplus_{i=l}^r}$$  (233^if(i)\bmod 998244353)$，其中 $\displaystyle\bigoplus$ 表示二进制下的按位异或，输出一行一个整数 $ans$。
## 样例

### 样例输入 #1
```
2 0 1 2
10
```
### 样例输出 #1
```
3034
```
### 样例输入 #2
```
14 1 14 13
10110101110101
```
### 样例输出 #2
```
379883349
```
## 提示

#### 样例 1 解释

在样例给出的数列中，有 $3$ 个 $0$ 和 $2$ 个 $1$，任意排列 $f(0)$ 均为 $15$，排列为 $\textrm{01010}$ 时 $f(1)$ 有最大值 $13$，答案为：
$$
\displaystyle (233^0\times 15\bmod 998244353)\oplus(233^1\times 13\bmod 998244353)=3034
$$

#### 数据范围

- Subtask 1（5 points）：$n,m\leq 9$。
- Subtask 2（15 points）：$n,m\leq 200$。
- Subtask 3（15 points）：$n,m\leq 5\times 10^3$。
- Subtask 4（5 points）：$m\leq 2$，$l=0$，$r=1$。
- Subtask 5（10 points）：$m\leq 10^6$，$l=m$，$r=m$。 
- Subtask 6（10 points）：$m\leq 10^6$，$X=1$，$s_i=0$。
- Subtask 7（15 points）：$m\leq 10^6$，$r-l+1\leq 10^4$。
- Subtask 8（15 points）：$m\leq 2\times 10^6$。
- Subtask 9（10 points）：无特殊限制。

对于所有数据，满足 $n\leq 10^9$，$m\leq 10^7$，$0\leq l\leq r\leq m$，$X\geq 1$。


---

---
title: "[集训队互测 2022] 在路上"
layout: "post"
diff: 省选/NOI-
pid: P9056
tag: ['集训队互测', '2022', '交互题', 'Special Judge', 'O2优化', '树论', '随机化']
---
# [集训队互测 2022] 在路上
## 题目背景

滥用本题评测者封号。

dottle bot。
## 题目描述

**这是一道交互题，仅支持 C++ 提交**。

有一棵未知的树，**保证树的大小为奇数，你需要找到这棵树重心的编号**。

你可以进行询问，每次询问你可以询问三个点 $(x,y,z)$，若不存在一条简单路径同时经过三个点，则交互器会返回 $0$，否则若存在，那么交互器会返回三个点在路径上相对顺序中间的一个点。

令 $dis(a,b)$ 表示 $a,b$ 两点在树上最短路径经过的边数，你也可以理解为:

若 $dis(x,y)+dis(x,z)=dis(y,z)$，则交互器会返回 $x$。

否则若 $dis(y,x)+dis(y,z)=dis(x,z)$，交互器会返回 $y$。

否则若 $dis(z,x)+dis(z,y)=dis(x,y)$，交互器会返回 $z$。

否则交互器会返回 $0$。

在最终的测试中，每个测试点会包含 $T$ 组测试数据，和一个常数 $M$，表示你在所有测试数据中询问次数总和的上限，具体细则见 输入格式 以及 数据范围。

#### 实现细节

~~你需要引用 `path.h` 头文件。~~ 本题中你只需要把 `path.h` 头文件的内容粘贴到程序开头即可，不要引用 `path.h` 头文件。

你需要实现下面的函数：

```
int centroid(int id,int N,int M);
```

其中 $id$ 为当前子任务的编号，$N$ 为当前询问树的大小，$M$ 为当前测试点剩余的询问次数，函数的返回值为当前树的重心编号。

具体的，在第一次调用时 $M$ 为当前测试点的询问次数上限，每次调用结束之后 $M$ 会减去当前测试点使用的询问次数。

你可以调用下面的函数：

```
int ask(int x,int y,int z);
```

表示你进行了一次询问，交互器会返回当前询问的答案，特别的，若询问次数已经超过了上限，交互器会返回 $-1$。

注意同一个测试点中 `centroid` 函数可能会被多次调用，请注意数组清空等情况。

**下发文件中有样例交互库，该交互库的实现与评测时的交互库几乎一致，如果对交互方式有不理解可以参照交互库的代码理解**。

## 输入格式

样例评测库将读入如下格式的输入数据：

第一行三个整数 $id,T,M$，表示当前的子任务编号以及测试数据的数量，以及询问次数的上界。

对于每一组测试数据，第一行一个正整数 $n$，表示当前测试数据中树的大小。

之后一行 $n-1$ 个正整数，第 $i$ 个数表示 $i+1$ 在以 $1$ 为根意义下的父亲节点。

数据的答案将在交互库内部计算。
## 输出格式

具体信息见交互库。
## 提示

#### 数据范围

![](https://cdn.luogu.com.cn/upload/image_hosting/f3d6b2zv.png?x-oss-process=image/resize,m_lfit,h_1700,w_2250)

特殊性质 $A$：保证树的形态为一条链，即每个点的度数均不超过 $2$。

保证每个 Subtask 里的测试数据数量均不超过 $20$。**请仔细阅读每一档子任务及其限制**。

#### 时空限制

Subtask 5 时限为 3s。

Subtask 7,8 时限为 4s。

其余 Subtask 时限为 1s。

空间限制：512MB。

保证最终交互库的时间使用不超过  2s，空间使用不超过 64MB。

#### 下发文件

下发文件中有一个样例交互库，提供的交互头文件，一份示例代码，以及一个满足子任务 $4$ 性质的样例，选手也可以按照题目的输入格式构造其他样例。

另外也有一份洛谷样式的交互库。

保证下发的交互库和最终使用的交互库除反作弊之外没有区别，你可以使用这个交互库输出调试信息。


---


# 题目信息

# Chinese Mahjong

## 题目描述

[problemUrl]: https://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&category=24&page=show_problem&problem=2151

[PDF](https://uva.onlinejudge.org/external/112/p11210.pdf)

![](https://cdn.luogu.com.cn/upload/vjudge_pic/UVA11210/00db9c6ee014cb07d2ff71e0aff3d224225bbbd1.png)

## 样例 #1

### 输入

```
1S 1S 2S 2S 2S 3S 3S 3S 7S 8S 9S FA FA
1S 2S 3S 4S 5S 6S 7S 8S 9S 1T 3T 5T 7T
0```

### 输出

```
Case 1: 1S 4S FA
Case 2: Not ready```

# AI分析结果



## 算法分类
**回溯算法/DFS**

---

## 题解思路与核心难点

### 核心思路
所有题解均采用以下步骤：
1. **枚举听牌**：遍历所有34种牌型，检查添加该牌后是否满足和牌条件。
2. **检查将牌**：从14张牌中选取一个对子作为将牌。
3. **DFS验证结构**：递归判断剩余牌是否可拆分为4个顺子/刻子。

### 关键难点与解决
1. **顺子边界处理**：  
   数牌（条、筒、万）的顺子必须连续且不跨类型。例如`8T 9T 1S`不合法。解决：在DFS中限定顺子编号范围（如仅允许i%9≤6）。
2. **牌数合法性**：  
   每种牌最多4张。解决：枚举听牌时跳过已达4张的牌。
3. **DFS剪枝优化**：  
   优先处理刻子再处理顺子，减少递归层数。部分题解采用按牌型顺序逐个处理，避免重复计算。

---

## 题解评分（≥4星）

### 1. Parabola（4星）
- **亮点**：使用统一牌型编号与映射表，代码结构清晰。通过`check(i)`函数限制顺子范围。
- **关键代码**：
  ```cpp
  bool dfs(int step) {
    if(step == 4) return true;
    for(int i = 0 ; i < 34 ; ++i) { // 优先处理刻子
        if(c[i] >= 3) { ... }
    }
    for(int i = 0 ; i <= 24 ; ++i) { // 处理顺子
        if(i % 9 <= 6 && c[i] >= 1 && c[i+1] >=1 ... )
    }
  }
  ```

### 2. 破忆（4星）
- **亮点**：代码简洁，分离对子检查与DFS逻辑。通过`dis(i)`函数处理边界。
- **关键代码**：
  ```cpp
  bool DFS(bool k, int s) { // k表示是否已选将牌
    if(!k) {
        for(int i=0;i<34;i++) if(num[i]>=2) { ... } // 枚举将牌
    }
    // 刻子与顺子处理
  }
  ```

### 3. SIGSEGV（4星）
- **亮点**：从字牌向数牌逆序处理，优先消除字牌刻子。特殊处理九莲宝灯等复杂牌型。
- **关键代码**：
  ```cpp
  bool dfs(int pos=34, bool has_pair=0) { // pos从字牌开始逆序处理
    if (pos > 27) { // 字牌只能组成刻子
        if (cnt[pos] == 3) return dfs(pos-1, has_pair);
    }
  }
  ```

---

## 最优思路与技巧

### 核心技巧
1. **牌型编码**：将牌统一映射为0-34，便于数组统计。
2. **DFS剪枝**：  
   - 优先处理刻子再处理顺子，减少分支。
   - 限制顺子生成范围（如i%9≤6）。
3. **回溯恢复**：每次递归调用后恢复牌数，避免污染全局状态。

### 同类型题
- **枚举+回溯**：LeetCode 37（数独）、LeetCode 51（N皇后）
- **麻将变种**：POJ 4006（麻将判胡）、HDU 4431（日本麻将）

---

## 推荐题目
1. **洛谷 P1784 数独**（回溯剪枝）
2. **洛谷 P1219 八皇后**（经典回溯）
3. **洛谷 P2142 高精度减法**（复杂模拟）

---

## 个人心得摘录
- **输入陷阱**：部分题解因行末空格导致WA，需注意UVa严格输出格式。
- **顺子边界**：调试中发现`8T 9T 1S`被误判为顺子，需额外限制类型连续性。

---

## 可视化算法演示

### 动画设计
1. **牌型展示**：  
   - Canvas绘制34个牌槽，初始显示13张牌。
   - 枚举听牌时，目标牌槽高亮（黄色边框）。
2. **DFS过程**：  
   - 刻子选择：三个相同牌闪烁后变灰（标记为已用）。
   - 顺子选择：连续三个牌横向滑动合并动画。
3. **回溯提示**：  
   - 失败时牌槽红色闪烁，成功时绿色渐入。

### 复古像素风格
- **调色板**：16色FC风格，牌面使用8x8像素图案。
- **音效设计**：  
  - 选择牌：8-bit "beep"声。
  - 成功/失败：分别使用上升/下降音阶。
- **自动演示**：  
  按牌型顺序自动枚举听牌，展示DFS搜索路径。

---
处理用时：82.77秒